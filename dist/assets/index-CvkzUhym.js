(function(){const na=document.createElement("link").relList;if(na&&na.supports&&na.supports("modulepreload"))return;for(const St of document.querySelectorAll('link[rel="modulepreload"]'))Ze(St);new MutationObserver(St=>{for(const ei of St)if(ei.type==="childList")for(const Le of ei.addedNodes)Le.tagName==="LINK"&&Le.rel==="modulepreload"&&Ze(Le)}).observe(document,{childList:!0,subtree:!0});function U(St){const ei={};return St.integrity&&(ei.integrity=St.integrity),St.referrerPolicy&&(ei.referrerPolicy=St.referrerPolicy),St.crossOrigin==="use-credentials"?ei.credentials="include":St.crossOrigin==="anonymous"?ei.credentials="omit":ei.credentials="same-origin",ei}function Ze(St){if(St.ep)return;St.ep=!0;const ei=U(St);fetch(St.href,ei)}})();function px(En){return En&&En.__esModule&&Object.prototype.hasOwnProperty.call(En,"default")?En.default:En}var Y_={exports:{}},_g={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Cv;function rb(){if(Cv)return _g;Cv=1;var En=Symbol.for("react.transitional.element"),na=Symbol.for("react.fragment");function U(Ze,St,ei){var Le=null;if(ei!==void 0&&(Le=""+ei),St.key!==void 0&&(Le=""+St.key),"key"in St){ei={};for(var r in St)r!=="key"&&(ei[r]=St[r])}else ei=St;return St=ei.ref,{$$typeof:En,type:Ze,key:Le,ref:St!==void 0?St:null,props:ei}}return _g.Fragment=na,_g.jsx=U,_g.jsxs=U,_g}var Lv;function ab(){return Lv||(Lv=1,Y_.exports=rb()),Y_.exports}var xg=ab(),$_={exports:{}},as={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rv;function sb(){if(Rv)return as;Rv=1;var En=Symbol.for("react.transitional.element"),na=Symbol.for("react.portal"),U=Symbol.for("react.fragment"),Ze=Symbol.for("react.strict_mode"),St=Symbol.for("react.profiler"),ei=Symbol.for("react.consumer"),Le=Symbol.for("react.context"),r=Symbol.for("react.forward_ref"),Ge=Symbol.for("react.suspense"),de=Symbol.for("react.memo"),Je=Symbol.for("react.lazy"),rt=Symbol.iterator;function ai(Ie){return Ie===null||typeof Ie!="object"?null:(Ie=rt&&Ie[rt]||Ie["@@iterator"],typeof Ie=="function"?Ie:null)}var bi={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ai=Object.assign,qt={};function xi(Ie,it,vt){this.props=Ie,this.context=it,this.refs=qt,this.updater=vt||bi}xi.prototype.isReactComponent={},xi.prototype.setState=function(Ie,it){if(typeof Ie!="object"&&typeof Ie!="function"&&Ie!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ie,it,"setState")},xi.prototype.forceUpdate=function(Ie){this.updater.enqueueForceUpdate(this,Ie,"forceUpdate")};function kt(){}kt.prototype=xi.prototype;function Tt(Ie,it,vt){this.props=Ie,this.context=it,this.refs=qt,this.updater=vt||bi}var ln=Tt.prototype=new kt;ln.constructor=Tt,Ai(ln,xi.prototype),ln.isPureReactComponent=!0;var Xi=Array.isArray,Dt={H:null,A:null,T:null,S:null},ni=Object.prototype.hasOwnProperty;function ci(Ie,it,vt,bt,pt,ti){return vt=ti.ref,{$$typeof:En,type:Ie,key:it,ref:vt!==void 0?vt:null,props:ti}}function Nn(Ie,it){return ci(Ie.type,it,void 0,void 0,void 0,Ie.props)}function Fi(Ie){return typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===En}function oi(Ie){var it={"=":"=0",":":"=2"};return"$"+Ie.replace(/[=:]/g,function(vt){return it[vt]})}var Ci=/\/+/g;function Zt(Ie,it){return typeof Ie=="object"&&Ie!==null&&Ie.key!=null?oi(""+Ie.key):it.toString(36)}function Yt(){}function vi(Ie){switch(Ie.status){case"fulfilled":return Ie.value;case"rejected":throw Ie.reason;default:switch(typeof Ie.status=="string"?Ie.then(Yt,Yt):(Ie.status="pending",Ie.then(function(it){Ie.status==="pending"&&(Ie.status="fulfilled",Ie.value=it)},function(it){Ie.status==="pending"&&(Ie.status="rejected",Ie.reason=it)})),Ie.status){case"fulfilled":return Ie.value;case"rejected":throw Ie.reason}}throw Ie}function ae(Ie,it,vt,bt,pt){var ti=typeof Ie;(ti==="undefined"||ti==="boolean")&&(Ie=null);var Wi=!1;if(Ie===null)Wi=!0;else switch(ti){case"bigint":case"string":case"number":Wi=!0;break;case"object":switch(Ie.$$typeof){case En:case na:Wi=!0;break;case Je:return Wi=Ie._init,ae(Wi(Ie._payload),it,vt,bt,pt)}}if(Wi)return pt=pt(Ie),Wi=bt===""?"."+Zt(Ie,0):bt,Xi(pt)?(vt="",Wi!=null&&(vt=Wi.replace(Ci,"$&/")+"/"),ae(pt,it,vt,"",function(vr){return vr})):pt!=null&&(Fi(pt)&&(pt=Nn(pt,vt+(pt.key==null||Ie&&Ie.key===pt.key?"":(""+pt.key).replace(Ci,"$&/")+"/")+Wi)),it.push(pt)),1;Wi=0;var mn=bt===""?".":bt+":";if(Xi(Ie))for(var fn=0;fn<Ie.length;fn++)bt=Ie[fn],ti=mn+Zt(bt,fn),Wi+=ae(bt,it,vt,ti,pt);else if(fn=ai(Ie),typeof fn=="function")for(Ie=fn.call(Ie),fn=0;!(bt=Ie.next()).done;)bt=bt.value,ti=mn+Zt(bt,fn++),Wi+=ae(bt,it,vt,ti,pt);else if(ti==="object"){if(typeof Ie.then=="function")return ae(vi(Ie),it,vt,bt,pt);throw it=String(Ie),Error("Objects are not valid as a React child (found: "+(it==="[object Object]"?"object with keys {"+Object.keys(Ie).join(", ")+"}":it)+"). If you meant to render a collection of children, use an array instead.")}return Wi}function ge(Ie,it,vt){if(Ie==null)return Ie;var bt=[],pt=0;return ae(Ie,bt,"","",function(ti){return it.call(vt,ti,pt++)}),bt}function Te(Ie){if(Ie._status===-1){var it=Ie._result;it=it(),it.then(function(vt){(Ie._status===0||Ie._status===-1)&&(Ie._status=1,Ie._result=vt)},function(vt){(Ie._status===0||Ie._status===-1)&&(Ie._status=2,Ie._result=vt)}),Ie._status===-1&&(Ie._status=0,Ie._result=it)}if(Ie._status===1)return Ie._result.default;throw Ie._result}var Re=typeof reportError=="function"?reportError:function(Ie){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var it=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Ie=="object"&&Ie!==null&&typeof Ie.message=="string"?String(Ie.message):String(Ie),error:Ie});if(!window.dispatchEvent(it))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Ie);return}console.error(Ie)};function ze(){}return as.Children={map:ge,forEach:function(Ie,it,vt){ge(Ie,function(){it.apply(this,arguments)},vt)},count:function(Ie){var it=0;return ge(Ie,function(){it++}),it},toArray:function(Ie){return ge(Ie,function(it){return it})||[]},only:function(Ie){if(!Fi(Ie))throw Error("React.Children.only expected to receive a single React element child.");return Ie}},as.Component=xi,as.Fragment=U,as.Profiler=St,as.PureComponent=Tt,as.StrictMode=Ze,as.Suspense=Ge,as.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Dt,as.act=function(){throw Error("act(...) is not supported in production builds of React.")},as.cache=function(Ie){return function(){return Ie.apply(null,arguments)}},as.cloneElement=function(Ie,it,vt){if(Ie==null)throw Error("The argument must be a React element, but you passed "+Ie+".");var bt=Ai({},Ie.props),pt=Ie.key,ti=void 0;if(it!=null)for(Wi in it.ref!==void 0&&(ti=void 0),it.key!==void 0&&(pt=""+it.key),it)!ni.call(it,Wi)||Wi==="key"||Wi==="__self"||Wi==="__source"||Wi==="ref"&&it.ref===void 0||(bt[Wi]=it[Wi]);var Wi=arguments.length-2;if(Wi===1)bt.children=vt;else if(1<Wi){for(var mn=Array(Wi),fn=0;fn<Wi;fn++)mn[fn]=arguments[fn+2];bt.children=mn}return ci(Ie.type,pt,void 0,void 0,ti,bt)},as.createContext=function(Ie){return Ie={$$typeof:Le,_currentValue:Ie,_currentValue2:Ie,_threadCount:0,Provider:null,Consumer:null},Ie.Provider=Ie,Ie.Consumer={$$typeof:ei,_context:Ie},Ie},as.createElement=function(Ie,it,vt){var bt,pt={},ti=null;if(it!=null)for(bt in it.key!==void 0&&(ti=""+it.key),it)ni.call(it,bt)&&bt!=="key"&&bt!=="__self"&&bt!=="__source"&&(pt[bt]=it[bt]);var Wi=arguments.length-2;if(Wi===1)pt.children=vt;else if(1<Wi){for(var mn=Array(Wi),fn=0;fn<Wi;fn++)mn[fn]=arguments[fn+2];pt.children=mn}if(Ie&&Ie.defaultProps)for(bt in Wi=Ie.defaultProps,Wi)pt[bt]===void 0&&(pt[bt]=Wi[bt]);return ci(Ie,ti,void 0,void 0,null,pt)},as.createRef=function(){return{current:null}},as.forwardRef=function(Ie){return{$$typeof:r,render:Ie}},as.isValidElement=Fi,as.lazy=function(Ie){return{$$typeof:Je,_payload:{_status:-1,_result:Ie},_init:Te}},as.memo=function(Ie,it){return{$$typeof:de,type:Ie,compare:it===void 0?null:it}},as.startTransition=function(Ie){var it=Dt.T,vt={};Dt.T=vt;try{var bt=Ie(),pt=Dt.S;pt!==null&&pt(vt,bt),typeof bt=="object"&&bt!==null&&typeof bt.then=="function"&&bt.then(ze,Re)}catch(ti){Re(ti)}finally{Dt.T=it}},as.unstable_useCacheRefresh=function(){return Dt.H.useCacheRefresh()},as.use=function(Ie){return Dt.H.use(Ie)},as.useActionState=function(Ie,it,vt){return Dt.H.useActionState(Ie,it,vt)},as.useCallback=function(Ie,it){return Dt.H.useCallback(Ie,it)},as.useContext=function(Ie){return Dt.H.useContext(Ie)},as.useDebugValue=function(){},as.useDeferredValue=function(Ie,it){return Dt.H.useDeferredValue(Ie,it)},as.useEffect=function(Ie,it){return Dt.H.useEffect(Ie,it)},as.useId=function(){return Dt.H.useId()},as.useImperativeHandle=function(Ie,it,vt){return Dt.H.useImperativeHandle(Ie,it,vt)},as.useInsertionEffect=function(Ie,it){return Dt.H.useInsertionEffect(Ie,it)},as.useLayoutEffect=function(Ie,it){return Dt.H.useLayoutEffect(Ie,it)},as.useMemo=function(Ie,it){return Dt.H.useMemo(Ie,it)},as.useOptimistic=function(Ie,it){return Dt.H.useOptimistic(Ie,it)},as.useReducer=function(Ie,it,vt){return Dt.H.useReducer(Ie,it,vt)},as.useRef=function(Ie){return Dt.H.useRef(Ie)},as.useState=function(Ie){return Dt.H.useState(Ie)},as.useSyncExternalStore=function(Ie,it,vt){return Dt.H.useSyncExternalStore(Ie,it,vt)},as.useTransition=function(){return Dt.H.useTransition()},as.version="19.0.0",as}var Iv;function Cy(){return Iv||(Iv=1,$_.exports=sb()),$_.exports}var mx=Cy(),K_={exports:{}},yg={},J_={exports:{}},Q_={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dv;function ob(){return Dv||(Dv=1,function(En){function na(ge,Te){var Re=ge.length;ge.push(Te);e:for(;0<Re;){var ze=Re-1>>>1,Ie=ge[ze];if(0<St(Ie,Te))ge[ze]=Te,ge[Re]=Ie,Re=ze;else break e}}function U(ge){return ge.length===0?null:ge[0]}function Ze(ge){if(ge.length===0)return null;var Te=ge[0],Re=ge.pop();if(Re!==Te){ge[0]=Re;e:for(var ze=0,Ie=ge.length,it=Ie>>>1;ze<it;){var vt=2*(ze+1)-1,bt=ge[vt],pt=vt+1,ti=ge[pt];if(0>St(bt,Re))pt<Ie&&0>St(ti,bt)?(ge[ze]=ti,ge[pt]=Re,ze=pt):(ge[ze]=bt,ge[vt]=Re,ze=vt);else if(pt<Ie&&0>St(ti,Re))ge[ze]=ti,ge[pt]=Re,ze=pt;else break e}}return Te}function St(ge,Te){var Re=ge.sortIndex-Te.sortIndex;return Re!==0?Re:ge.id-Te.id}if(En.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var ei=performance;En.unstable_now=function(){return ei.now()}}else{var Le=Date,r=Le.now();En.unstable_now=function(){return Le.now()-r}}var Ge=[],de=[],Je=1,rt=null,ai=3,bi=!1,Ai=!1,qt=!1,xi=typeof setTimeout=="function"?setTimeout:null,kt=typeof clearTimeout=="function"?clearTimeout:null,Tt=typeof setImmediate<"u"?setImmediate:null;function ln(ge){for(var Te=U(de);Te!==null;){if(Te.callback===null)Ze(de);else if(Te.startTime<=ge)Ze(de),Te.sortIndex=Te.expirationTime,na(Ge,Te);else break;Te=U(de)}}function Xi(ge){if(qt=!1,ln(ge),!Ai)if(U(Ge)!==null)Ai=!0,vi();else{var Te=U(de);Te!==null&&ae(Xi,Te.startTime-ge)}}var Dt=!1,ni=-1,ci=5,Nn=-1;function Fi(){return!(En.unstable_now()-Nn<ci)}function oi(){if(Dt){var ge=En.unstable_now();Nn=ge;var Te=!0;try{e:{Ai=!1,qt&&(qt=!1,kt(ni),ni=-1),bi=!0;var Re=ai;try{t:{for(ln(ge),rt=U(Ge);rt!==null&&!(rt.expirationTime>ge&&Fi());){var ze=rt.callback;if(typeof ze=="function"){rt.callback=null,ai=rt.priorityLevel;var Ie=ze(rt.expirationTime<=ge);if(ge=En.unstable_now(),typeof Ie=="function"){rt.callback=Ie,ln(ge),Te=!0;break t}rt===U(Ge)&&Ze(Ge),ln(ge)}else Ze(Ge);rt=U(Ge)}if(rt!==null)Te=!0;else{var it=U(de);it!==null&&ae(Xi,it.startTime-ge),Te=!1}}break e}finally{rt=null,ai=Re,bi=!1}Te=void 0}}finally{Te?Ci():Dt=!1}}}var Ci;if(typeof Tt=="function")Ci=function(){Tt(oi)};else if(typeof MessageChannel<"u"){var Zt=new MessageChannel,Yt=Zt.port2;Zt.port1.onmessage=oi,Ci=function(){Yt.postMessage(null)}}else Ci=function(){xi(oi,0)};function vi(){Dt||(Dt=!0,Ci())}function ae(ge,Te){ni=xi(function(){ge(En.unstable_now())},Te)}En.unstable_IdlePriority=5,En.unstable_ImmediatePriority=1,En.unstable_LowPriority=4,En.unstable_NormalPriority=3,En.unstable_Profiling=null,En.unstable_UserBlockingPriority=2,En.unstable_cancelCallback=function(ge){ge.callback=null},En.unstable_continueExecution=function(){Ai||bi||(Ai=!0,vi())},En.unstable_forceFrameRate=function(ge){0>ge||125<ge?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ci=0<ge?Math.floor(1e3/ge):5},En.unstable_getCurrentPriorityLevel=function(){return ai},En.unstable_getFirstCallbackNode=function(){return U(Ge)},En.unstable_next=function(ge){switch(ai){case 1:case 2:case 3:var Te=3;break;default:Te=ai}var Re=ai;ai=Te;try{return ge()}finally{ai=Re}},En.unstable_pauseExecution=function(){},En.unstable_requestPaint=function(){},En.unstable_runWithPriority=function(ge,Te){switch(ge){case 1:case 2:case 3:case 4:case 5:break;default:ge=3}var Re=ai;ai=ge;try{return Te()}finally{ai=Re}},En.unstable_scheduleCallback=function(ge,Te,Re){var ze=En.unstable_now();switch(typeof Re=="object"&&Re!==null?(Re=Re.delay,Re=typeof Re=="number"&&0<Re?ze+Re:ze):Re=ze,ge){case 1:var Ie=-1;break;case 2:Ie=250;break;case 5:Ie=1073741823;break;case 4:Ie=1e4;break;default:Ie=5e3}return Ie=Re+Ie,ge={id:Je++,callback:Te,priorityLevel:ge,startTime:Re,expirationTime:Ie,sortIndex:-1},Re>ze?(ge.sortIndex=Re,na(de,ge),U(Ge)===null&&ge===U(de)&&(qt?(kt(ni),ni=-1):qt=!0,ae(Xi,Re-ze))):(ge.sortIndex=Ie,na(Ge,ge),Ai||bi||(Ai=!0,vi())),ge},En.unstable_shouldYield=Fi,En.unstable_wrapCallback=function(ge){var Te=ai;return function(){var Re=ai;ai=Te;try{return ge.apply(this,arguments)}finally{ai=Re}}}}(Q_)),Q_}var zv;function lb(){return zv||(zv=1,J_.exports=ob()),J_.exports}var ey={exports:{}},Eu={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pv;function cb(){if(Pv)return Eu;Pv=1;var En=Cy();function na(Ge){var de="https://react.dev/errors/"+Ge;if(1<arguments.length){de+="?args[]="+encodeURIComponent(arguments[1]);for(var Je=2;Je<arguments.length;Je++)de+="&args[]="+encodeURIComponent(arguments[Je])}return"Minified React error #"+Ge+"; visit "+de+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function U(){}var Ze={d:{f:U,r:function(){throw Error(na(522))},D:U,C:U,L:U,m:U,X:U,S:U,M:U},p:0,findDOMNode:null},St=Symbol.for("react.portal");function ei(Ge,de,Je){var rt=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:St,key:rt==null?null:""+rt,children:Ge,containerInfo:de,implementation:Je}}var Le=En.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function r(Ge,de){if(Ge==="font")return"";if(typeof de=="string")return de==="use-credentials"?de:""}return Eu.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ze,Eu.createPortal=function(Ge,de){var Je=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!de||de.nodeType!==1&&de.nodeType!==9&&de.nodeType!==11)throw Error(na(299));return ei(Ge,de,null,Je)},Eu.flushSync=function(Ge){var de=Le.T,Je=Ze.p;try{if(Le.T=null,Ze.p=2,Ge)return Ge()}finally{Le.T=de,Ze.p=Je,Ze.d.f()}},Eu.preconnect=function(Ge,de){typeof Ge=="string"&&(de?(de=de.crossOrigin,de=typeof de=="string"?de==="use-credentials"?de:"":void 0):de=null,Ze.d.C(Ge,de))},Eu.prefetchDNS=function(Ge){typeof Ge=="string"&&Ze.d.D(Ge)},Eu.preinit=function(Ge,de){if(typeof Ge=="string"&&de&&typeof de.as=="string"){var Je=de.as,rt=r(Je,de.crossOrigin),ai=typeof de.integrity=="string"?de.integrity:void 0,bi=typeof de.fetchPriority=="string"?de.fetchPriority:void 0;Je==="style"?Ze.d.S(Ge,typeof de.precedence=="string"?de.precedence:void 0,{crossOrigin:rt,integrity:ai,fetchPriority:bi}):Je==="script"&&Ze.d.X(Ge,{crossOrigin:rt,integrity:ai,fetchPriority:bi,nonce:typeof de.nonce=="string"?de.nonce:void 0})}},Eu.preinitModule=function(Ge,de){if(typeof Ge=="string")if(typeof de=="object"&&de!==null){if(de.as==null||de.as==="script"){var Je=r(de.as,de.crossOrigin);Ze.d.M(Ge,{crossOrigin:Je,integrity:typeof de.integrity=="string"?de.integrity:void 0,nonce:typeof de.nonce=="string"?de.nonce:void 0})}}else de==null&&Ze.d.M(Ge)},Eu.preload=function(Ge,de){if(typeof Ge=="string"&&typeof de=="object"&&de!==null&&typeof de.as=="string"){var Je=de.as,rt=r(Je,de.crossOrigin);Ze.d.L(Ge,Je,{crossOrigin:rt,integrity:typeof de.integrity=="string"?de.integrity:void 0,nonce:typeof de.nonce=="string"?de.nonce:void 0,type:typeof de.type=="string"?de.type:void 0,fetchPriority:typeof de.fetchPriority=="string"?de.fetchPriority:void 0,referrerPolicy:typeof de.referrerPolicy=="string"?de.referrerPolicy:void 0,imageSrcSet:typeof de.imageSrcSet=="string"?de.imageSrcSet:void 0,imageSizes:typeof de.imageSizes=="string"?de.imageSizes:void 0,media:typeof de.media=="string"?de.media:void 0})}},Eu.preloadModule=function(Ge,de){if(typeof Ge=="string")if(de){var Je=r(de.as,de.crossOrigin);Ze.d.m(Ge,{as:typeof de.as=="string"&&de.as!=="script"?de.as:void 0,crossOrigin:Je,integrity:typeof de.integrity=="string"?de.integrity:void 0})}else Ze.d.m(Ge)},Eu.requestFormReset=function(Ge){Ze.d.r(Ge)},Eu.unstable_batchedUpdates=function(Ge,de){return Ge(de)},Eu.useFormState=function(Ge,de,Je){return Le.H.useFormState(Ge,de,Je)},Eu.useFormStatus=function(){return Le.H.useHostTransitionStatus()},Eu.version="19.0.0",Eu}var Ov;function ub(){if(Ov)return ey.exports;Ov=1;function En(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(En)}catch(na){console.error(na)}}return En(),ey.exports=cb(),ey.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bv;function hb(){if(Bv)return yg;Bv=1;var En=lb(),na=Cy(),U=ub();function Ze(u){var m="https://react.dev/errors/"+u;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var w=2;w<arguments.length;w++)m+="&args[]="+encodeURIComponent(arguments[w])}return"Minified React error #"+u+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function St(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)}var ei=Symbol.for("react.element"),Le=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),Ge=Symbol.for("react.fragment"),de=Symbol.for("react.strict_mode"),Je=Symbol.for("react.profiler"),rt=Symbol.for("react.provider"),ai=Symbol.for("react.consumer"),bi=Symbol.for("react.context"),Ai=Symbol.for("react.forward_ref"),qt=Symbol.for("react.suspense"),xi=Symbol.for("react.suspense_list"),kt=Symbol.for("react.memo"),Tt=Symbol.for("react.lazy"),ln=Symbol.for("react.offscreen"),Xi=Symbol.for("react.memo_cache_sentinel"),Dt=Symbol.iterator;function ni(u){return u===null||typeof u!="object"?null:(u=Dt&&u[Dt]||u["@@iterator"],typeof u=="function"?u:null)}var ci=Symbol.for("react.client.reference");function Nn(u){if(u==null)return null;if(typeof u=="function")return u.$$typeof===ci?null:u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case Ge:return"Fragment";case r:return"Portal";case Je:return"Profiler";case de:return"StrictMode";case qt:return"Suspense";case xi:return"SuspenseList"}if(typeof u=="object")switch(u.$$typeof){case bi:return(u.displayName||"Context")+".Provider";case ai:return(u._context.displayName||"Context")+".Consumer";case Ai:var m=u.render;return u=u.displayName,u||(u=m.displayName||m.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case kt:return m=u.displayName||null,m!==null?m:Nn(u.type)||"Memo";case Tt:m=u._payload,u=u._init;try{return Nn(u(m))}catch{}}return null}var Fi=na.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,oi=Object.assign,Ci,Zt;function Yt(u){if(Ci===void 0)try{throw Error()}catch(w){var m=w.stack.trim().match(/\n( *(at )?)/);Ci=m&&m[1]||"",Zt=-1<w.stack.indexOf(`
    at`)?" (<anonymous>)":-1<w.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ci+u+Zt}var vi=!1;function ae(u,m){if(!u||vi)return"";vi=!0;var w=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var z={DetermineComponentFrameRoot:function(){try{if(m){var Zn=function(){throw Error()};if(Object.defineProperty(Zn.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Zn,[])}catch(Sn){var Ji=Sn}Reflect.construct(u,[],Zn)}else{try{Zn.call()}catch(Sn){Ji=Sn}u.call(Zn.prototype)}}else{try{throw Error()}catch(Sn){Ji=Sn}(Zn=u())&&typeof Zn.catch=="function"&&Zn.catch(function(){})}}catch(Sn){if(Sn&&Ji&&typeof Sn.stack=="string")return[Sn.stack,Ji.stack]}return[null,null]}};z.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var H=Object.getOwnPropertyDescriptor(z.DetermineComponentFrameRoot,"name");H&&H.configurable&&Object.defineProperty(z.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var J=z.DetermineComponentFrameRoot(),Ae=J[0],Ke=J[1];if(Ae&&Ke){var Ot=Ae.split(`
`),_i=Ke.split(`
`);for(H=z=0;z<Ot.length&&!Ot[z].includes("DetermineComponentFrameRoot");)z++;for(;H<_i.length&&!_i[H].includes("DetermineComponentFrameRoot");)H++;if(z===Ot.length||H===_i.length)for(z=Ot.length-1,H=_i.length-1;1<=z&&0<=H&&Ot[z]!==_i[H];)H--;for(;1<=z&&0<=H;z--,H--)if(Ot[z]!==_i[H]){if(z!==1||H!==1)do if(z--,H--,0>H||Ot[z]!==_i[H]){var An=`
`+Ot[z].replace(" at new "," at ");return u.displayName&&An.includes("<anonymous>")&&(An=An.replace("<anonymous>",u.displayName)),An}while(1<=z&&0<=H);break}}}finally{vi=!1,Error.prepareStackTrace=w}return(w=u?u.displayName||u.name:"")?Yt(w):""}function ge(u){switch(u.tag){case 26:case 27:case 5:return Yt(u.type);case 16:return Yt("Lazy");case 13:return Yt("Suspense");case 19:return Yt("SuspenseList");case 0:case 15:return u=ae(u.type,!1),u;case 11:return u=ae(u.type.render,!1),u;case 1:return u=ae(u.type,!0),u;default:return""}}function Te(u){try{var m="";do m+=ge(u),u=u.return;while(u);return m}catch(w){return`
Error generating stack: `+w.message+`
`+w.stack}}function Re(u){var m=u,w=u;if(u.alternate)for(;m.return;)m=m.return;else{u=m;do m=u,(m.flags&4098)!==0&&(w=m.return),u=m.return;while(u)}return m.tag===3?w:null}function ze(u){if(u.tag===13){var m=u.memoizedState;if(m===null&&(u=u.alternate,u!==null&&(m=u.memoizedState)),m!==null)return m.dehydrated}return null}function Ie(u){if(Re(u)!==u)throw Error(Ze(188))}function it(u){var m=u.alternate;if(!m){if(m=Re(u),m===null)throw Error(Ze(188));return m!==u?null:u}for(var w=u,z=m;;){var H=w.return;if(H===null)break;var J=H.alternate;if(J===null){if(z=H.return,z!==null){w=z;continue}break}if(H.child===J.child){for(J=H.child;J;){if(J===w)return Ie(H),u;if(J===z)return Ie(H),m;J=J.sibling}throw Error(Ze(188))}if(w.return!==z.return)w=H,z=J;else{for(var Ae=!1,Ke=H.child;Ke;){if(Ke===w){Ae=!0,w=H,z=J;break}if(Ke===z){Ae=!0,z=H,w=J;break}Ke=Ke.sibling}if(!Ae){for(Ke=J.child;Ke;){if(Ke===w){Ae=!0,w=J,z=H;break}if(Ke===z){Ae=!0,z=J,w=H;break}Ke=Ke.sibling}if(!Ae)throw Error(Ze(189))}}if(w.alternate!==z)throw Error(Ze(190))}if(w.tag!==3)throw Error(Ze(188));return w.stateNode.current===w?u:m}function vt(u){var m=u.tag;if(m===5||m===26||m===27||m===6)return u;for(u=u.child;u!==null;){if(m=vt(u),m!==null)return m;u=u.sibling}return null}var bt=Array.isArray,pt=U.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ti={pending:!1,data:null,method:null,action:null},Wi=[],mn=-1;function fn(u){return{current:u}}function vr(u){0>mn||(u.current=Wi[mn],Wi[mn]=null,mn--)}function et(u,m){mn++,Wi[mn]=u.current,u.current=m}var jr=fn(null),Ra=fn(null),ra=fn(null),Pi=fn(null);function cn(u,m){switch(et(ra,m),et(Ra,u),et(jr,null),u=m.nodeType,u){case 9:case 11:m=(m=m.documentElement)&&(m=m.namespaceURI)?Ti(m):0;break;default:if(u=u===8?m.parentNode:m,m=u.tagName,u=u.namespaceURI)u=Ti(u),m=Ki(u,m);else switch(m){case"svg":m=1;break;case"math":m=2;break;default:m=0}}vr(jr),et(jr,m)}function Ye(){vr(jr),vr(Ra),vr(ra)}function Xe(u){u.memoizedState!==null&&et(Pi,u);var m=jr.current,w=Ki(m,u.type);m!==w&&(et(Ra,u),et(jr,w))}function ft(u){Ra.current===u&&(vr(jr),vr(Ra)),Pi.current===u&&(vr(Pi),Sd._currentValue=ti)}var ct=Object.prototype.hasOwnProperty,Rt=En.unstable_scheduleCallback,Ut=En.unstable_cancelCallback,li=En.unstable_shouldYield,$t=En.unstable_requestPaint,ii=En.unstable_now,Tn=En.unstable_getCurrentPriorityLevel,wn=En.unstable_ImmediatePriority,gr=En.unstable_UserBlockingPriority,cr=En.unstable_NormalPriority,Sr=En.unstable_LowPriority,Er=En.unstable_IdlePriority,mr=En.log,Nr=En.unstable_setDisableYieldValue,Ma=null,ga=null;function oo(u){if(ga&&typeof ga.onCommitFiberRoot=="function")try{ga.onCommitFiberRoot(Ma,u,void 0,(u.current.flags&128)===128)}catch{}}function $a(u){if(typeof mr=="function"&&Nr(u),ga&&typeof ga.setStrictMode=="function")try{ga.setStrictMode(Ma,u)}catch{}}var dn=Math.clz32?Math.clz32:lo,Xn=Math.log,Qa=Math.LN2;function lo(u){return u>>>=0,u===0?32:31-(Xn(u)/Qa|0)|0}var Us=128,Ca=4194304;function ja(u){var m=u&42;if(m!==0)return m;switch(u&-u){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return u&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return u}}function qr(u,m){var w=u.pendingLanes;if(w===0)return 0;var z=0,H=u.suspendedLanes,J=u.pingedLanes,Ae=u.warmLanes;u=u.finishedLanes!==0;var Ke=w&134217727;return Ke!==0?(w=Ke&~H,w!==0?z=ja(w):(J&=Ke,J!==0?z=ja(J):u||(Ae=Ke&~Ae,Ae!==0&&(z=ja(Ae))))):(Ke=w&~H,Ke!==0?z=ja(Ke):J!==0?z=ja(J):u||(Ae=w&~Ae,Ae!==0&&(z=ja(Ae)))),z===0?0:m!==0&&m!==z&&(m&H)===0&&(H=z&-z,Ae=m&-m,H>=Ae||H===32&&(Ae&4194176)!==0)?m:z}function gs(u,m){return(u.pendingLanes&~(u.suspendedLanes&~u.pingedLanes)&m)===0}function $s(u,m){switch(u){case 1:case 2:case 4:case 8:return m+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Lo(){var u=Us;return Us<<=1,(Us&4194176)===0&&(Us=128),u}function Ls(){var u=Ca;return Ca<<=1,(Ca&62914560)===0&&(Ca=4194304),u}function ht(u){for(var m=[],w=0;31>w;w++)m.push(u);return m}function es(u,m){u.pendingLanes|=m,m!==268435456&&(u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0)}function Ks(u,m,w,z,H,J){var Ae=u.pendingLanes;u.pendingLanes=w,u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0,u.expiredLanes&=w,u.entangledLanes&=w,u.errorRecoveryDisabledLanes&=w,u.shellSuspendCounter=0;var Ke=u.entanglements,Ot=u.expirationTimes,_i=u.hiddenUpdates;for(w=Ae&~w;0<w;){var An=31-dn(w),Zn=1<<An;Ke[An]=0,Ot[An]=-1;var Ji=_i[An];if(Ji!==null)for(_i[An]=null,An=0;An<Ji.length;An++){var Sn=Ji[An];Sn!==null&&(Sn.lane&=-536870913)}w&=~Zn}z!==0&&Js(u,z,0),J!==0&&H===0&&u.tag!==0&&(u.suspendedLanes|=J&~(Ae&~m))}function Js(u,m,w){u.pendingLanes|=m,u.suspendedLanes&=~m;var z=31-dn(m);u.entangledLanes|=m,u.entanglements[z]=u.entanglements[z]|1073741824|w&4194218}function Ro(u,m){var w=u.entangledLanes|=m;for(u=u.entanglements;w;){var z=31-dn(w),H=1<<z;H&m|u[z]&m&&(u[z]|=m),w&=~H}}function xs(u){return u&=-u,2<u?8<u?(u&134217727)!==0?32:268435456:8:2}function Io(){var u=pt.p;return u!==0?u:(u=window.event,u===void 0?32:La(u.type))}function Xt(u,m){var w=pt.p;try{return pt.p=u,m()}finally{pt.p=w}}var oe=Math.random().toString(36).slice(2),pe="__reactFiber$"+oe,Ce="__reactProps$"+oe,qe="__reactContainer$"+oe,Qe="__reactEvents$"+oe,ut="__reactListeners$"+oe,It="__reactHandles$"+oe,mt="__reactResources$"+oe,Vt="__reactMarker$"+oe;function Gt(u){delete u[pe],delete u[Ce],delete u[Qe],delete u[ut],delete u[It]}function Wt(u){var m=u[pe];if(m)return m;for(var w=u.parentNode;w;){if(m=w[qe]||w[pe]){if(w=m.alternate,m.child!==null||w!==null&&w.child!==null)for(u=Qt(u);u!==null;){if(w=u[pe])return w;u=Qt(u)}return m}u=w,w=u.parentNode}return null}function Mi(u){if(u=u[pe]||u[qe]){var m=u.tag;if(m===5||m===6||m===13||m===26||m===27||m===3)return u}return null}function Qi(u){var m=u.tag;if(m===5||m===26||m===27||m===6)return u.stateNode;throw Error(Ze(33))}function nn(u){var m=u[mt];return m||(m=u[mt]={hoistableStyles:new Map,hoistableScripts:new Map}),m}function zn(u){u[Vt]=!0}var jn=new Set,ar={};function Wn(u,m){Rr(u,m),Rr(u+"Capture",m)}function Rr(u,m){for(ar[u]=m,u=0;u<m.length;u++)jn.add(m[u])}var Ur=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Br=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),sa={},Wr={};function tr(u){return ct.call(Wr,u)?!0:ct.call(sa,u)?!1:Br.test(u)?Wr[u]=!0:(sa[u]=!0,!1)}function Rs(u,m,w){if(tr(m))if(w===null)u.removeAttribute(m);else{switch(typeof w){case"undefined":case"function":case"symbol":u.removeAttribute(m);return;case"boolean":var z=m.toLowerCase().slice(0,5);if(z!=="data-"&&z!=="aria-"){u.removeAttribute(m);return}}u.setAttribute(m,""+w)}}function Ia(u,m,w){if(w===null)u.removeAttribute(m);else{switch(typeof w){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(m);return}u.setAttribute(m,""+w)}}function Da(u,m,w,z){if(z===null)u.removeAttribute(w);else{switch(typeof z){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(w);return}u.setAttributeNS(m,w,""+z)}}function _s(u){switch(typeof u){case"bigint":case"boolean":case"number":case"string":case"undefined":return u;case"object":return u;default:return""}}function qo(u){var m=u.type;return(u=u.nodeName)&&u.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function dl(u){var m=qo(u)?"checked":"value",w=Object.getOwnPropertyDescriptor(u.constructor.prototype,m),z=""+u[m];if(!u.hasOwnProperty(m)&&typeof w<"u"&&typeof w.get=="function"&&typeof w.set=="function"){var H=w.get,J=w.set;return Object.defineProperty(u,m,{configurable:!0,get:function(){return H.call(this)},set:function(Ae){z=""+Ae,J.call(this,Ae)}}),Object.defineProperty(u,m,{enumerable:w.enumerable}),{getValue:function(){return z},setValue:function(Ae){z=""+Ae},stopTracking:function(){u._valueTracker=null,delete u[m]}}}}function Vs(u){u._valueTracker||(u._valueTracker=dl(u))}function Au(u){if(!u)return!1;var m=u._valueTracker;if(!m)return!0;var w=m.getValue(),z="";return u&&(z=qo(u)?u.checked?"true":"false":u.value),u=z,u!==w?(m.setValue(u),!0):!1}function Bc(u){if(u=u||(typeof document<"u"?document:void 0),typeof u>"u")return null;try{return u.activeElement||u.body}catch{return u.body}}var Ql=/[\n"\\]/g;function fo(u){return u.replace(Ql,function(m){return"\\"+m.charCodeAt(0).toString(16)+" "})}function ka(u,m,w,z,H,J,Ae,Ke){u.name="",Ae!=null&&typeof Ae!="function"&&typeof Ae!="symbol"&&typeof Ae!="boolean"?u.type=Ae:u.removeAttribute("type"),m!=null?Ae==="number"?(m===0&&u.value===""||u.value!=m)&&(u.value=""+_s(m)):u.value!==""+_s(m)&&(u.value=""+_s(m)):Ae!=="submit"&&Ae!=="reset"||u.removeAttribute("value"),m!=null?xo(u,Ae,_s(m)):w!=null?xo(u,Ae,_s(w)):z!=null&&u.removeAttribute("value"),H==null&&J!=null&&(u.defaultChecked=!!J),H!=null&&(u.checked=H&&typeof H!="function"&&typeof H!="symbol"),Ke!=null&&typeof Ke!="function"&&typeof Ke!="symbol"&&typeof Ke!="boolean"?u.name=""+_s(Ke):u.removeAttribute("name")}function Do(u,m,w,z,H,J,Ae,Ke){if(J!=null&&typeof J!="function"&&typeof J!="symbol"&&typeof J!="boolean"&&(u.type=J),m!=null||w!=null){if(!(J!=="submit"&&J!=="reset"||m!=null))return;w=w!=null?""+_s(w):"",m=m!=null?""+_s(m):w,Ke||m===u.value||(u.value=m),u.defaultValue=m}z=z??H,z=typeof z!="function"&&typeof z!="symbol"&&!!z,u.checked=Ke?u.checked:!!z,u.defaultChecked=!!z,Ae!=null&&typeof Ae!="function"&&typeof Ae!="symbol"&&typeof Ae!="boolean"&&(u.name=Ae)}function xo(u,m,w){m==="number"&&Bc(u.ownerDocument)===u||u.defaultValue===""+w||(u.defaultValue=""+w)}function Me(u,m,w,z){if(u=u.options,m){m={};for(var H=0;H<w.length;H++)m["$"+w[H]]=!0;for(w=0;w<u.length;w++)H=m.hasOwnProperty("$"+u[w].value),u[w].selected!==H&&(u[w].selected=H),H&&z&&(u[w].defaultSelected=!0)}else{for(w=""+_s(w),m=null,H=0;H<u.length;H++){if(u[H].value===w){u[H].selected=!0,z&&(u[H].defaultSelected=!0);return}m!==null||u[H].disabled||(m=u[H])}m!==null&&(m.selected=!0)}}function be(u,m,w){if(m!=null&&(m=""+_s(m),m!==u.value&&(u.value=m),w==null)){u.defaultValue!==m&&(u.defaultValue=m);return}u.defaultValue=w!=null?""+_s(w):""}function Fe(u,m,w,z){if(m==null){if(z!=null){if(w!=null)throw Error(Ze(92));if(bt(z)){if(1<z.length)throw Error(Ze(93));z=z[0]}w=z}w==null&&(w=""),m=w}w=_s(m),u.defaultValue=w,z=u.textContent,z===w&&z!==""&&z!==null&&(u.value=z)}function yt(u,m){if(m){var w=u.firstChild;if(w&&w===u.lastChild&&w.nodeType===3){w.nodeValue=m;return}}u.textContent=m}var ki=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Yi(u,m,w){var z=m.indexOf("--")===0;w==null||typeof w=="boolean"||w===""?z?u.setProperty(m,""):m==="float"?u.cssFloat="":u[m]="":z?u.setProperty(m,w):typeof w!="number"||w===0||ki.has(m)?m==="float"?u.cssFloat=w:u[m]=(""+w).trim():u[m]=w+"px"}function wi(u,m,w){if(m!=null&&typeof m!="object")throw Error(Ze(62));if(u=u.style,w!=null){for(var z in w)!w.hasOwnProperty(z)||m!=null&&m.hasOwnProperty(z)||(z.indexOf("--")===0?u.setProperty(z,""):z==="float"?u.cssFloat="":u[z]="");for(var H in m)z=m[H],m.hasOwnProperty(H)&&w[H]!==z&&Yi(u,H,z)}else for(var J in m)m.hasOwnProperty(J)&&Yi(u,J,m[J])}function hn(u){if(u.indexOf("-")===-1)return!1;switch(u){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),he=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function we(u){return he.test(""+u)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":u}var Ve=null;function Ee(u){return u=u.target||u.srcElement||window,u.correspondingUseElement&&(u=u.correspondingUseElement),u.nodeType===3?u.parentNode:u}var ri=null,Ei=null;function sn(u){var m=Mi(u);if(m&&(u=m.stateNode)){var w=u[Ce]||null;e:switch(u=m.stateNode,m.type){case"input":if(ka(u,w.value,w.defaultValue,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name),m=w.name,w.type==="radio"&&m!=null){for(w=u;w.parentNode;)w=w.parentNode;for(w=w.querySelectorAll('input[name="'+fo(""+m)+'"][type="radio"]'),m=0;m<w.length;m++){var z=w[m];if(z!==u&&z.form===u.form){var H=z[Ce]||null;if(!H)throw Error(Ze(90));ka(z,H.value,H.defaultValue,H.defaultValue,H.checked,H.defaultChecked,H.type,H.name)}}for(m=0;m<w.length;m++)z=w[m],z.form===u.form&&Au(z)}break e;case"textarea":be(u,w.value,w.defaultValue);break e;case"select":m=w.value,m!=null&&Me(u,!!w.multiple,m,!1)}}}var Di=!1;function Jn(u,m,w){if(Di)return u(m,w);Di=!0;try{var z=u(m);return z}finally{if(Di=!1,(ri!==null||Ei!==null)&&(wp(),ri&&(m=ri,u=Ei,Ei=ri=null,sn(m),u)))for(m=0;m<u.length;m++)sn(u[m])}}function on(u,m){var w=u.stateNode;if(w===null)return null;var z=w[Ce]||null;if(z===null)return null;w=z[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(z=!z.disabled)||(u=u.type,z=!(u==="button"||u==="input"||u==="select"||u==="textarea")),u=!z;break e;default:u=!1}if(u)return null;if(w&&typeof w!="function")throw Error(Ze(231,m,typeof w));return w}var Ft=!1;if(Ur)try{var yn={};Object.defineProperty(yn,"passive",{get:function(){Ft=!0}}),window.addEventListener("test",yn,yn),window.removeEventListener("test",yn,yn)}catch{Ft=!1}var Si=null,qn=null,rn=null;function Cn(){if(rn)return rn;var u,m=qn,w=m.length,z,H="value"in Si?Si.value:Si.textContent,J=H.length;for(u=0;u<w&&m[u]===H[u];u++);var Ae=w-u;for(z=1;z<=Ae&&m[w-z]===H[J-z];z++);return rn=H.slice(u,1<z?1-z:void 0)}function Ar(u){var m=u.keyCode;return"charCode"in u?(u=u.charCode,u===0&&m===13&&(u=13)):u=m,u===10&&(u=13),32<=u||u===13?u:0}function Ir(){return!0}function Gr(){return!1}function Lr(u){function m(w,z,H,J,Ae){this._reactName=w,this._targetInst=H,this.type=z,this.nativeEvent=J,this.target=Ae,this.currentTarget=null;for(var Ke in u)u.hasOwnProperty(Ke)&&(w=u[Ke],this[Ke]=w?w(J):J[Ke]);return this.isDefaultPrevented=(J.defaultPrevented!=null?J.defaultPrevented:J.returnValue===!1)?Ir:Gr,this.isPropagationStopped=Gr,this}return oi(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var w=this.nativeEvent;w&&(w.preventDefault?w.preventDefault():typeof w.returnValue!="unknown"&&(w.returnValue=!1),this.isDefaultPrevented=Ir)},stopPropagation:function(){var w=this.nativeEvent;w&&(w.stopPropagation?w.stopPropagation():typeof w.cancelBubble!="unknown"&&(w.cancelBubble=!0),this.isPropagationStopped=Ir)},persist:function(){},isPersistent:Ir}),m}var xr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(u){return u.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},On=Lr(xr),fa=oi({},xr,{view:0,detail:0}),$r=Lr(fa),Ms,aa,Qs,ds=oi({},fa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ml,button:0,buttons:0,relatedTarget:function(u){return u.relatedTarget===void 0?u.fromElement===u.srcElement?u.toElement:u.fromElement:u.relatedTarget},movementX:function(u){return"movementX"in u?u.movementX:(u!==Qs&&(Qs&&u.type==="mousemove"?(Ms=u.screenX-Qs.screenX,aa=u.screenY-Qs.screenY):aa=Ms=0,Qs=u),Ms)},movementY:function(u){return"movementY"in u?u.movementY:aa}}),Fs=Lr(ds),Ts=oi({},ds,{dataTransfer:0}),al=Lr(Ts),Gs=oi({},fa,{relatedTarget:0}),_a=Lr(Gs),Wo=oi({},xr,{animationName:0,elapsedTime:0,pseudoElement:0}),or=Lr(Wo),fs=oi({},xr,{clipboardData:function(u){return"clipboardData"in u?u.clipboardData:window.clipboardData}}),Cu=Lr(fs),kl=oi({},xr,{data:0}),fl=Lr(kl),Lu={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},co={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},df={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Nl(u){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(u):(u=df[u])?!!m[u]:!1}function Ml(){return Nl}var Uh=oi({},fa,{key:function(u){if(u.key){var m=Lu[u.key]||u.key;if(m!=="Unidentified")return m}return u.type==="keypress"?(u=Ar(u),u===13?"Enter":String.fromCharCode(u)):u.type==="keydown"||u.type==="keyup"?co[u.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ml,charCode:function(u){return u.type==="keypress"?Ar(u):0},keyCode:function(u){return u.type==="keydown"||u.type==="keyup"?u.keyCode:0},which:function(u){return u.type==="keypress"?Ar(u):u.type==="keydown"||u.type==="keyup"?u.keyCode:0}}),ps=Lr(Uh),oa=oi({},ds,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Rd=Lr(oa),tu=oi({},fa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ml}),Vh=Lr(tu),sh=oi({},xr,{propertyName:0,elapsedTime:0,pseudoElement:0}),oh=Lr(sh),gc=oi({},ds,{deltaX:function(u){return"deltaX"in u?u.deltaX:"wheelDeltaX"in u?-u.wheelDeltaX:0},deltaY:function(u){return"deltaY"in u?u.deltaY:"wheelDeltaY"in u?-u.wheelDeltaY:"wheelDelta"in u?-u.wheelDelta:0},deltaZ:0,deltaMode:0}),Gh=Lr(gc),dp=oi({},xr,{newState:0,oldState:0}),lh=Lr(dp),Id=[9,13,27,32],Ul=Ur&&"CompositionEvent"in window,Tl=null;Ur&&"documentMode"in document&&(Tl=document.documentMode);var jf=Ur&&"TextEvent"in window&&!Tl,Hh=Ur&&(!Ul||Tl&&8<Tl&&11>=Tl),ff=" ",pf=!1;function mf(u,m){switch(u){case"keyup":return Id.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function eo(u){return u=u.detail,typeof u=="object"&&"data"in u?u.data:null}var Sl=!1;function Fr(u,m){switch(u){case"compositionend":return eo(m);case"keypress":return m.which!==32?null:(pf=!0,ff);case"textInput":return u=m.data,u===ff&&pf?null:u;default:return null}}function sr(u,m){if(Sl)return u==="compositionend"||!Ul&&mf(u,m)?(u=Cn(),rn=qn=Si=null,Sl=!1,u):null;switch(u){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return Hh&&m.locale!=="ko"?null:m.data;default:return null}}var zo={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function br(u){var m=u&&u.nodeName&&u.nodeName.toLowerCase();return m==="input"?!!zo[u.type]:m==="textarea"}function El(u,m,w,z){ri?Ei?Ei.push(z):Ei=[z]:ri=z,m=G(m,"onChange"),0<m.length&&(w=new On("onChange","change",null,w,z),u.push({event:w,listeners:m}))}var _c=null,rr=null;function Fc(u){e(u,0)}function ec(u){var m=Qi(u);if(Au(m))return u}function Ru(u,m){if(u==="change")return m}var ch=!1;if(Ur){var Po;if(Ur){var bo="oninput"in document;if(!bo){var vn=document.createElement("div");vn.setAttribute("oninput","return;"),bo=typeof vn.oninput=="function"}Po=bo}else Po=!1;ch=Po&&(!document.documentMode||9<document.documentMode)}function tc(){_c&&(_c.detachEvent("onpropertychange",iu),rr=_c=null)}function iu(u){if(u.propertyName==="value"&&ec(rr)){var m=[];El(m,rr,u,Ee(u)),Jn(Fc,m)}}function uh(u,m,w){u==="focusin"?(tc(),_c=m,rr=w,_c.attachEvent("onpropertychange",iu)):u==="focusout"&&tc()}function yc(u){if(u==="selectionchange"||u==="keyup"||u==="keydown")return ec(rr)}function wo(u,m){if(u==="click")return ec(m)}function Iu(u,m){if(u==="input"||u==="change")return ec(m)}function Du(u,m){return u===m&&(u!==0||1/u===1/m)||u!==u&&m!==m}var Kr=typeof Object.is=="function"?Object.is:Du;function dr(u,m){if(Kr(u,m))return!0;if(typeof u!="object"||u===null||typeof m!="object"||m===null)return!1;var w=Object.keys(u),z=Object.keys(m);if(w.length!==z.length)return!1;for(z=0;z<w.length;z++){var H=w[z];if(!ct.call(m,H)||!Kr(u[H],m[H]))return!1}return!0}function Zo(u){for(;u&&u.firstChild;)u=u.firstChild;return u}function qf(u,m){var w=Zo(u);u=0;for(var z;w;){if(w.nodeType===3){if(z=u+w.textContent.length,u<=m&&z>=m)return{node:w,offset:m-u};u=z}e:{for(;w;){if(w.nextSibling){w=w.nextSibling;break e}w=w.parentNode}w=void 0}w=Zo(w)}}function Op(u,m){return u&&m?u===m?!0:u&&u.nodeType===3?!1:m&&m.nodeType===3?Op(u,m.parentNode):"contains"in u?u.contains(m):u.compareDocumentPosition?!!(u.compareDocumentPosition(m)&16):!1:!1}function Wf(u){u=u!=null&&u.ownerDocument!=null&&u.ownerDocument.defaultView!=null?u.ownerDocument.defaultView:window;for(var m=Bc(u.document);m instanceof u.HTMLIFrameElement;){try{var w=typeof m.contentWindow.location.href=="string"}catch{w=!1}if(w)u=m.contentWindow;else break;m=Bc(u.document)}return m}function fp(u){var m=u&&u.nodeName&&u.nodeName.toLowerCase();return m&&(m==="input"&&(u.type==="text"||u.type==="search"||u.type==="tel"||u.type==="url"||u.type==="password")||m==="textarea"||u.contentEditable==="true")}function Bp(u,m){var w=Wf(m);m=u.focusedElem;var z=u.selectionRange;if(w!==m&&m&&m.ownerDocument&&Op(m.ownerDocument.documentElement,m)){if(z!==null&&fp(m)){if(u=z.start,w=z.end,w===void 0&&(w=u),"selectionStart"in m)m.selectionStart=u,m.selectionEnd=Math.min(w,m.value.length);else if(w=(u=m.ownerDocument||document)&&u.defaultView||window,w.getSelection){w=w.getSelection();var H=m.textContent.length,J=Math.min(z.start,H);z=z.end===void 0?J:Math.min(z.end,H),!w.extend&&J>z&&(H=z,z=J,J=H),H=qf(m,J);var Ae=qf(m,z);H&&Ae&&(w.rangeCount!==1||w.anchorNode!==H.node||w.anchorOffset!==H.offset||w.focusNode!==Ae.node||w.focusOffset!==Ae.offset)&&(u=u.createRange(),u.setStart(H.node,H.offset),w.removeAllRanges(),J>z?(w.addRange(u),w.extend(Ae.node,Ae.offset)):(u.setEnd(Ae.node,Ae.offset),w.addRange(u)))}}for(u=[],w=m;w=w.parentNode;)w.nodeType===1&&u.push({element:w,left:w.scrollLeft,top:w.scrollTop});for(typeof m.focus=="function"&&m.focus(),m=0;m<u.length;m++)w=u[m],w.element.scrollLeft=w.left,w.element.scrollTop=w.top}}var pp=Ur&&"documentMode"in document&&11>=document.documentMode,vc=null,hh=null,Al=null,nu=!1;function mp(u,m,w){var z=w.window===w?w.document:w.nodeType===9?w:w.ownerDocument;nu||vc==null||vc!==Bc(z)||(z=vc,"selectionStart"in z&&fp(z)?z={start:z.selectionStart,end:z.selectionEnd}:(z=(z.ownerDocument&&z.ownerDocument.defaultView||window).getSelection(),z={anchorNode:z.anchorNode,anchorOffset:z.anchorOffset,focusNode:z.focusNode,focusOffset:z.focusOffset}),Al&&dr(Al,z)||(Al=z,z=G(hh,"onSelect"),0<z.length&&(m=new On("onSelect","select",null,m,w),u.push({event:m,listeners:z}),m.target=vc)))}function kc(u,m){var w={};return w[u.toLowerCase()]=m.toLowerCase(),w["Webkit"+u]="webkit"+m,w["Moz"+u]="moz"+m,w}var sl={animationend:kc("Animation","AnimationEnd"),animationiteration:kc("Animation","AnimationIteration"),animationstart:kc("Animation","AnimationStart"),transitionrun:kc("Transition","TransitionRun"),transitionstart:kc("Transition","TransitionStart"),transitioncancel:kc("Transition","TransitionCancel"),transitionend:kc("Transition","TransitionEnd")},zu={},jh={};Ur&&(jh=document.createElement("div").style,"AnimationEvent"in window||(delete sl.animationend.animation,delete sl.animationiteration.animation,delete sl.animationstart.animation),"TransitionEvent"in window||delete sl.transitionend.transition);function Oo(u){if(zu[u])return zu[u];if(!sl[u])return u;var m=sl[u],w;for(w in m)if(m.hasOwnProperty(w)&&w in jh)return zu[u]=m[w];return u}var dh=Oo("animationend"),qh=Oo("animationiteration"),Wh=Oo("animationstart"),Vl=Oo("transitionrun"),Pu=Oo("transitionstart"),Zf=Oo("transitioncancel"),Ou=Oo("transitionend"),Zh=new Map,Dd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function pl(u,m){Zh.set(u,m),Wn(m,[u])}var po=[],ic=0,Bu=0;function ru(){for(var u=ic,m=Bu=ic=0;m<u;){var w=po[m];po[m++]=null;var z=po[m];po[m++]=null;var H=po[m];po[m++]=null;var J=po[m];if(po[m++]=null,z!==null&&H!==null){var Ae=z.pending;Ae===null?H.next=H:(H.next=Ae.next,Ae.next=H),z.pending=H}J!==0&&fh(w,H,J)}}function Fu(u,m,w,z){po[ic++]=u,po[ic++]=m,po[ic++]=w,po[ic++]=z,Bu|=z,u.lanes|=z,u=u.alternate,u!==null&&(u.lanes|=z)}function Xh(u,m,w,z){return Fu(u,m,w,z),ua(u)}function nc(u,m){return Fu(u,null,null,m),ua(u)}function fh(u,m,w){u.lanes|=w;var z=u.alternate;z!==null&&(z.lanes|=w);for(var H=!1,J=u.return;J!==null;)J.childLanes|=w,z=J.alternate,z!==null&&(z.childLanes|=w),J.tag===22&&(u=J.stateNode,u===null||u._visibility&1||(H=!0)),u=J,J=J.return;H&&m!==null&&u.tag===3&&(J=u.stateNode,H=31-dn(w),J=J.hiddenUpdates,u=J[H],u===null?J[H]=[m]:u.push(m),m.lane=w|536870912)}function ua(u){if(50<Qu)throw Qu=0,Lf=null,Error(Ze(185));for(var m=u.return;m!==null;)u=m,m=u.return;return u.tag===3?u.stateNode:null}var Yh={},$h=new WeakMap;function rc(u,m){if(typeof u=="object"&&u!==null){var w=$h.get(u);return w!==void 0?w:(m={value:u,source:m,stack:Te(m)},$h.set(u,m),m)}return{value:u,source:m,stack:Te(m)}}var Kh=[],zd=0,Za=null,ph=0,Cl=[],Gl=0,ku=null,Nc=1,Uc="";function mh(u,m){Kh[zd++]=ph,Kh[zd++]=Za,Za=u,ph=m}function Jh(u,m,w){Cl[Gl++]=Nc,Cl[Gl++]=Uc,Cl[Gl++]=ku,ku=u;var z=Nc;u=Uc;var H=32-dn(z)-1;z&=~(1<<H),w+=1;var J=32-dn(m)+H;if(30<J){var Ae=H-H%5;J=(z&(1<<Ae)-1).toString(32),z>>=Ae,H-=Ae,Nc=1<<32-dn(m)+H|w<<H|z,Uc=J+u}else Nc=1<<J|w<<H|z,Uc=u}function gh(u){u.return!==null&&(mh(u,1),Jh(u,1,0))}function gf(u){for(;u===Za;)Za=Kh[--zd],Kh[zd]=null,ph=Kh[--zd],Kh[zd]=null;for(;u===ku;)ku=Cl[--Gl],Cl[Gl]=null,Uc=Cl[--Gl],Cl[Gl]=null,Nc=Cl[--Gl],Cl[Gl]=null}var ls=null,cs=null,pa=!1,Ll=null,xc=!1,_f=Error(Ze(519));function au(u){var m=Error(Ze(418,""));throw Od(rc(m,u)),_f}function Xf(u){var m=u.stateNode,w=u.type,z=u.memoizedProps;switch(m[pe]=u,m[Ce]=z,w){case"dialog":l("cancel",m),l("close",m);break;case"iframe":case"object":case"embed":l("load",m);break;case"video":case"audio":for(w=0;w<Rp.length;w++)l(Rp[w],m);break;case"source":l("error",m);break;case"img":case"image":case"link":l("error",m),l("load",m);break;case"details":l("toggle",m);break;case"input":l("invalid",m),Do(m,z.value,z.defaultValue,z.checked,z.defaultChecked,z.type,z.name,!0),Vs(m);break;case"select":l("invalid",m);break;case"textarea":l("invalid",m),Fe(m,z.value,z.defaultValue,z.children),Vs(m)}w=z.children,typeof w!="string"&&typeof w!="number"&&typeof w!="bigint"||m.textContent===""+w||z.suppressHydrationWarning===!0||ye(m.textContent,w)?(z.popover!=null&&(l("beforetoggle",m),l("toggle",m)),z.onScroll!=null&&l("scroll",m),z.onScrollEnd!=null&&l("scrollend",m),z.onClick!=null&&(m.onclick=Se),m=!0):m=!1,m||au(u)}function Yf(u){for(ls=u.return;ls;)switch(ls.tag){case 3:case 27:xc=!0;return;case 5:case 13:xc=!1;return;default:ls=ls.return}}function _h(u){if(u!==ls)return!1;if(!pa)return Yf(u),pa=!0,!1;var m=!1,w;if((w=u.tag!==3&&u.tag!==27)&&((w=u.tag===5)&&(w=u.type,w=!(w!=="form"&&w!=="button")||Bi(u.type,u.memoizedProps)),w=!w),w&&(m=!0),m&&cs&&au(u),Yf(u),u.tag===13){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(Ze(317));e:{for(u=u.nextSibling,m=0;u;){if(u.nodeType===8)if(w=u.data,w==="/$"){if(m===0){cs=At(u.nextSibling);break e}m--}else w!=="$"&&w!=="$!"&&w!=="$?"||m++;u=u.nextSibling}cs=null}}else cs=ls?At(u.stateNode.nextSibling):null;return!0}function Pd(){cs=ls=null,pa=!1}function Od(u){Ll===null?Ll=[u]:Ll.push(u)}var su=Error(Ze(460)),Fp=Error(Ze(474)),gp={then:function(){}};function kp(u){return u=u.status,u==="fulfilled"||u==="rejected"}function $f(){}function Np(u,m,w){switch(w=u[w],w===void 0?u.push(m):w!==m&&(m.then($f,$f),m=w),m.status){case"fulfilled":return m.value;case"rejected":throw u=m.reason,u===su?Error(Ze(483)):u;default:if(typeof m.status=="string")m.then($f,$f);else{if(u=_r,u!==null&&100<u.shellSuspendCounter)throw Error(Ze(482));u=m,u.status="pending",u.then(function(z){if(m.status==="pending"){var H=m;H.status="fulfilled",H.value=z}},function(z){if(m.status==="pending"){var H=m;H.status="rejected",H.reason=z}})}switch(m.status){case"fulfilled":return m.value;case"rejected":throw u=m.reason,u===su?Error(Ze(483)):u}throw yf=m,su}}var yf=null;function Kf(){if(yf===null)throw Error(Ze(459));var u=yf;return yf=null,u}var yh=null,vh=0;function Nu(u){var m=vh;return vh+=1,yh===null&&(yh=[]),Np(yh,u,m)}function Qh(u,m){m=m.props.ref,u.ref=m!==void 0?m:null}function vf(u,m){throw m.$$typeof===ei?Error(Ze(525)):(u=Object.prototype.toString.call(m),Error(Ze(31,u==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":u)))}function _p(u){var m=u._init;return m(u._payload)}function Jf(u){function m(Li,pi){if(u){var Gi=Li.deletions;Gi===null?(Li.deletions=[pi],Li.flags|=16):Gi.push(pi)}}function w(Li,pi){if(!u)return null;for(;pi!==null;)m(Li,pi),pi=pi.sibling;return null}function z(Li){for(var pi=new Map;Li!==null;)Li.key!==null?pi.set(Li.key,Li):pi.set(Li.index,Li),Li=Li.sibling;return pi}function H(Li,pi){return Li=an(Li,pi),Li.index=0,Li.sibling=null,Li}function J(Li,pi,Gi){return Li.index=Gi,u?(Gi=Li.alternate,Gi!==null?(Gi=Gi.index,Gi<pi?(Li.flags|=33554434,pi):Gi):(Li.flags|=33554434,pi)):(Li.flags|=1048576,pi)}function Ae(Li){return u&&Li.alternate===null&&(Li.flags|=33554434),Li}function Ke(Li,pi,Gi,Vn){return pi===null||pi.tag!==6?(pi=bn(Gi,Li.mode,Vn),pi.return=Li,pi):(pi=H(pi,Gi),pi.return=Li,pi)}function Ot(Li,pi,Gi,Vn){var Hr=Gi.type;return Hr===Ge?An(Li,pi,Gi.props.children,Vn,Gi.key):pi!==null&&(pi.elementType===Hr||typeof Hr=="object"&&Hr!==null&&Hr.$$typeof===Tt&&_p(Hr)===pi.type)?(pi=H(pi,Gi.props),Qh(pi,Gi),pi.return=Li,pi):(pi=yi(Gi.type,Gi.key,Gi.props,null,Li.mode,Vn),Qh(pi,Gi),pi.return=Li,pi)}function _i(Li,pi,Gi,Vn){return pi===null||pi.tag!==4||pi.stateNode.containerInfo!==Gi.containerInfo||pi.stateNode.implementation!==Gi.implementation?(pi=Un(Gi,Li.mode,Vn),pi.return=Li,pi):(pi=H(pi,Gi.children||[]),pi.return=Li,pi)}function An(Li,pi,Gi,Vn,Hr){return pi===null||pi.tag!==7?(pi=Hi(Gi,Li.mode,Vn,Hr),pi.return=Li,pi):(pi=H(pi,Gi),pi.return=Li,pi)}function Zn(Li,pi,Gi){if(typeof pi=="string"&&pi!==""||typeof pi=="number"||typeof pi=="bigint")return pi=bn(""+pi,Li.mode,Gi),pi.return=Li,pi;if(typeof pi=="object"&&pi!==null){switch(pi.$$typeof){case Le:return Gi=yi(pi.type,pi.key,pi.props,null,Li.mode,Gi),Qh(Gi,pi),Gi.return=Li,Gi;case r:return pi=Un(pi,Li.mode,Gi),pi.return=Li,pi;case Tt:var Vn=pi._init;return pi=Vn(pi._payload),Zn(Li,pi,Gi)}if(bt(pi)||ni(pi))return pi=Hi(pi,Li.mode,Gi,null),pi.return=Li,pi;if(typeof pi.then=="function")return Zn(Li,Nu(pi),Gi);if(pi.$$typeof===bi)return Zn(Li,af(Li,pi),Gi);vf(Li,pi)}return null}function Ji(Li,pi,Gi,Vn){var Hr=pi!==null?pi.key:null;if(typeof Gi=="string"&&Gi!==""||typeof Gi=="number"||typeof Gi=="bigint")return Hr!==null?null:Ke(Li,pi,""+Gi,Vn);if(typeof Gi=="object"&&Gi!==null){switch(Gi.$$typeof){case Le:return Gi.key===Hr?Ot(Li,pi,Gi,Vn):null;case r:return Gi.key===Hr?_i(Li,pi,Gi,Vn):null;case Tt:return Hr=Gi._init,Gi=Hr(Gi._payload),Ji(Li,pi,Gi,Vn)}if(bt(Gi)||ni(Gi))return Hr!==null?null:An(Li,pi,Gi,Vn,null);if(typeof Gi.then=="function")return Ji(Li,pi,Nu(Gi),Vn);if(Gi.$$typeof===bi)return Ji(Li,pi,af(Li,Gi),Vn);vf(Li,Gi)}return null}function Sn(Li,pi,Gi,Vn,Hr){if(typeof Vn=="string"&&Vn!==""||typeof Vn=="number"||typeof Vn=="bigint")return Li=Li.get(Gi)||null,Ke(pi,Li,""+Vn,Hr);if(typeof Vn=="object"&&Vn!==null){switch(Vn.$$typeof){case Le:return Li=Li.get(Vn.key===null?Gi:Vn.key)||null,Ot(pi,Li,Vn,Hr);case r:return Li=Li.get(Vn.key===null?Gi:Vn.key)||null,_i(pi,Li,Vn,Hr);case Tt:var Fa=Vn._init;return Vn=Fa(Vn._payload),Sn(Li,pi,Gi,Vn,Hr)}if(bt(Vn)||ni(Vn))return Li=Li.get(Gi)||null,An(pi,Li,Vn,Hr,null);if(typeof Vn.then=="function")return Sn(Li,pi,Gi,Nu(Vn),Hr);if(Vn.$$typeof===bi)return Sn(Li,pi,Gi,af(pi,Vn),Hr);vf(pi,Vn)}return null}function ea(Li,pi,Gi,Vn){for(var Hr=null,Fa=null,ca=pi,wa=pi=0,Fl=null;ca!==null&&wa<Gi.length;wa++){ca.index>wa?(Fl=ca,ca=null):Fl=ca.sibling;var As=Ji(Li,ca,Gi[wa],Vn);if(As===null){ca===null&&(ca=Fl);break}u&&ca&&As.alternate===null&&m(Li,ca),pi=J(As,pi,wa),Fa===null?Hr=As:Fa.sibling=As,Fa=As,ca=Fl}if(wa===Gi.length)return w(Li,ca),pa&&mh(Li,wa),Hr;if(ca===null){for(;wa<Gi.length;wa++)ca=Zn(Li,Gi[wa],Vn),ca!==null&&(pi=J(ca,pi,wa),Fa===null?Hr=ca:Fa.sibling=ca,Fa=ca);return pa&&mh(Li,wa),Hr}for(ca=z(ca);wa<Gi.length;wa++)Fl=Sn(ca,Li,wa,Gi[wa],Vn),Fl!==null&&(u&&Fl.alternate!==null&&ca.delete(Fl.key===null?wa:Fl.key),pi=J(Fl,pi,wa),Fa===null?Hr=Fl:Fa.sibling=Fl,Fa=Fl);return u&&ca.forEach(function(up){return m(Li,up)}),pa&&mh(Li,wa),Hr}function Ua(Li,pi,Gi,Vn){if(Gi==null)throw Error(Ze(151));for(var Hr=null,Fa=null,ca=pi,wa=pi=0,Fl=null,As=Gi.next();ca!==null&&!As.done;wa++,As=Gi.next()){ca.index>wa?(Fl=ca,ca=null):Fl=ca.sibling;var up=Ji(Li,ca,As.value,Vn);if(up===null){ca===null&&(ca=Fl);break}u&&ca&&up.alternate===null&&m(Li,ca),pi=J(up,pi,wa),Fa===null?Hr=up:Fa.sibling=up,Fa=up,ca=Fl}if(As.done)return w(Li,ca),pa&&mh(Li,wa),Hr;if(ca===null){for(;!As.done;wa++,As=Gi.next())As=Zn(Li,As.value,Vn),As!==null&&(pi=J(As,pi,wa),Fa===null?Hr=As:Fa.sibling=As,Fa=As);return pa&&mh(Li,wa),Hr}for(ca=z(ca);!As.done;wa++,As=Gi.next())As=Sn(ca,Li,wa,As.value,Vn),As!==null&&(u&&As.alternate!==null&&ca.delete(As.key===null?wa:As.key),pi=J(As,pi,wa),Fa===null?Hr=As:Fa.sibling=As,Fa=As);return u&&ca.forEach(function(r_){return m(Li,r_)}),pa&&mh(Li,wa),Hr}function Go(Li,pi,Gi,Vn){if(typeof Gi=="object"&&Gi!==null&&Gi.type===Ge&&Gi.key===null&&(Gi=Gi.props.children),typeof Gi=="object"&&Gi!==null){switch(Gi.$$typeof){case Le:e:{for(var Hr=Gi.key;pi!==null;){if(pi.key===Hr){if(Hr=Gi.type,Hr===Ge){if(pi.tag===7){w(Li,pi.sibling),Vn=H(pi,Gi.props.children),Vn.return=Li,Li=Vn;break e}}else if(pi.elementType===Hr||typeof Hr=="object"&&Hr!==null&&Hr.$$typeof===Tt&&_p(Hr)===pi.type){w(Li,pi.sibling),Vn=H(pi,Gi.props),Qh(Vn,Gi),Vn.return=Li,Li=Vn;break e}w(Li,pi);break}else m(Li,pi);pi=pi.sibling}Gi.type===Ge?(Vn=Hi(Gi.props.children,Li.mode,Vn,Gi.key),Vn.return=Li,Li=Vn):(Vn=yi(Gi.type,Gi.key,Gi.props,null,Li.mode,Vn),Qh(Vn,Gi),Vn.return=Li,Li=Vn)}return Ae(Li);case r:e:{for(Hr=Gi.key;pi!==null;){if(pi.key===Hr)if(pi.tag===4&&pi.stateNode.containerInfo===Gi.containerInfo&&pi.stateNode.implementation===Gi.implementation){w(Li,pi.sibling),Vn=H(pi,Gi.children||[]),Vn.return=Li,Li=Vn;break e}else{w(Li,pi);break}else m(Li,pi);pi=pi.sibling}Vn=Un(Gi,Li.mode,Vn),Vn.return=Li,Li=Vn}return Ae(Li);case Tt:return Hr=Gi._init,Gi=Hr(Gi._payload),Go(Li,pi,Gi,Vn)}if(bt(Gi))return ea(Li,pi,Gi,Vn);if(ni(Gi)){if(Hr=ni(Gi),typeof Hr!="function")throw Error(Ze(150));return Gi=Hr.call(Gi),Ua(Li,pi,Gi,Vn)}if(typeof Gi.then=="function")return Go(Li,pi,Nu(Gi),Vn);if(Gi.$$typeof===bi)return Go(Li,pi,af(Li,Gi),Vn);vf(Li,Gi)}return typeof Gi=="string"&&Gi!==""||typeof Gi=="number"||typeof Gi=="bigint"?(Gi=""+Gi,pi!==null&&pi.tag===6?(w(Li,pi.sibling),Vn=H(pi,Gi),Vn.return=Li,Li=Vn):(w(Li,pi),Vn=bn(Gi,Li.mode,Vn),Vn.return=Li,Li=Vn),Ae(Li)):w(Li,pi)}return function(Li,pi,Gi,Vn){try{vh=0;var Hr=Go(Li,pi,Gi,Vn);return yh=null,Hr}catch(ca){if(ca===su)throw ca;var Fa=hi(29,ca,null,Li.mode);return Fa.lanes=Vn,Fa.return=Li,Fa}finally{}}}var Hl=Jf(!0),Qf=Jf(!1),Xo=fn(null),ed=fn(0);function Bd(u,m){u=Ps,et(ed,u),et(Xo,m),Ps=u|m.baseLanes}function ep(){et(ed,Ps),et(Xo,Xo.current)}function Fd(){Ps=ed.current,vr(Xo),vr(ed)}var ml=fn(null),bc=null;function xh(u){var m=u.alternate;et(Bo,Bo.current&1),et(ml,u),bc===null&&(m===null||Xo.current!==null||m.memoizedState!==null)&&(bc=u)}function tp(u){if(u.tag===22){if(et(Bo,Bo.current),et(ml,u),bc===null){var m=u.alternate;m!==null&&m.memoizedState!==null&&(bc=u)}}else ac()}function ac(){et(Bo,Bo.current),et(ml,ml.current)}function Uu(u){vr(ml),bc===u&&(bc=null),vr(Bo)}var Bo=fn(0);function kd(u){for(var m=u;m!==null;){if(m.tag===13){var w=m.memoizedState;if(w!==null&&(w=w.dehydrated,w===null||w.data==="$?"||w.data==="$!"))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===u)break;for(;m.sibling===null;){if(m.return===null||m.return===u)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var yp=typeof AbortController<"u"?AbortController:function(){var u=[],m=this.signal={aborted:!1,addEventListener:function(w,z){u.push(z)}};this.abort=function(){m.aborted=!0,u.forEach(function(w){return w()})}},Nd=En.unstable_scheduleCallback,td=En.unstable_NormalPriority,Ws={$$typeof:bi,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function sc(){return{controller:new yp,data:new Map,refCount:0}}function ou(u){u.refCount--,u.refCount===0&&Nd(td,function(){u.controller.abort()})}var Ud=null,bh=0,Vc=0,oc=null;function Up(u,m){if(Ud===null){var w=Ud=[];bh=0,Vc=Bf(),oc={status:"pending",value:void 0,then:function(z){w.push(z)}}}return bh++,m.then(Vp,Vp),m}function Vp(){if(--bh===0&&Ud!==null){oc!==null&&(oc.status="fulfilled");var u=Ud;Ud=null,Vc=0,oc=null;for(var m=0;m<u.length;m++)(0,u[m])()}}function Gc(u,m){var w=[],z={status:"pending",value:null,reason:null,then:function(H){w.push(H)}};return u.then(function(){z.status="fulfilled",z.value=m;for(var H=0;H<w.length;H++)(0,w[H])(m)},function(H){for(z.status="rejected",z.reason=H,H=0;H<w.length;H++)(0,w[H])(void 0)}),z}var Vd=Fi.S;Fi.S=function(u,m){typeof m=="object"&&m!==null&&typeof m.then=="function"&&Up(u,m),Vd!==null&&Vd(u,m)};var kn=fn(null);function xf(){var u=kn.current;return u!==null?u:_r.pooledCache}function wh(u,m){m===null?et(kn,kn.current):et(kn,m.pool)}function Vu(){var u=xf();return u===null?null:{parent:Ws._currentValue,pool:u}}var jl=0,un=null,ys=null,Mo=null,bf=!1,lu=!1,Gu=!1,Gd=0,Hd=0,Mh=null,jd=0;function Hs(){throw Error(Ze(321))}function wf(u,m){if(m===null)return!1;for(var w=0;w<m.length&&w<u.length;w++)if(!Kr(u[w],m[w]))return!1;return!0}function wc(u,m,w,z,H,J){return jl=J,un=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,Fi.H=u===null||u.memoizedState===null?Ec:gl,Gu=!1,J=w(z,H),Gu=!1,lu&&(J=Hu(m,w,z,H)),Rl(u),J}function Rl(u){Fi.H=To;var m=ys!==null&&ys.next!==null;if(jl=0,Mo=ys=un=null,bf=!1,Hd=0,Mh=null,m)throw Error(Ze(300));u===null||Zs||(u=u.dependencies,u!==null&&_u(u)&&(Zs=!0))}function Hu(u,m,w,z){un=u;var H=0;do{if(lu&&(Mh=null),Hd=0,lu=!1,25<=H)throw Error(Ze(301));if(H+=1,Mo=ys=null,u.updateQueue!=null){var J=u.updateQueue;J.lastEffect=null,J.events=null,J.stores=null,J.memoCache!=null&&(J.memoCache.index=0)}Fi.H=to,J=m(w,z)}while(lu);return J}function vp(){var u=Fi.H,m=u.useState()[0];return m=typeof m.then=="function"?Sh(m):m,u=u.useState()[0],(ys!==null?ys.memoizedState:null)!==u&&(un.flags|=1024),m}function qd(){var u=Gd!==0;return Gd=0,u}function Th(u,m,w){m.updateQueue=u.updateQueue,m.flags&=-2053,u.lanes&=~w}function ju(u){if(bf){for(u=u.memoizedState;u!==null;){var m=u.queue;m!==null&&(m.pending=null),u=u.next}bf=!1}jl=0,Mo=ys=un=null,lu=!1,Hd=Gd=0,Mh=null}function mo(){var u={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Mo===null?un.memoizedState=Mo=u:Mo=Mo.next=u,Mo}function us(){if(ys===null){var u=un.alternate;u=u!==null?u.memoizedState:null}else u=ys.next;var m=Mo===null?un.memoizedState:Mo.next;if(m!==null)Mo=m,ys=u;else{if(u===null)throw un.alternate===null?Error(Ze(467)):Error(Ze(310));ys=u,u={memoizedState:ys.memoizedState,baseState:ys.baseState,baseQueue:ys.baseQueue,queue:ys.queue,next:null},Mo===null?un.memoizedState=Mo=u:Mo=Mo.next=u}return Mo}var Ka;Ka=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function Sh(u){var m=Hd;return Hd+=1,Mh===null&&(Mh=[]),u=Np(Mh,u,m),m=un,(Mo===null?m.memoizedState:Mo.next)===null&&(m=m.alternate,Fi.H=m===null||m.memoizedState===null?Ec:gl),u}function qu(u){if(u!==null&&typeof u=="object"){if(typeof u.then=="function")return Sh(u);if(u.$$typeof===bi)return yl(u)}throw Error(Ze(438,String(u)))}function Eh(u){var m=null,w=un.updateQueue;if(w!==null&&(m=w.memoCache),m==null){var z=un.alternate;z!==null&&(z=z.updateQueue,z!==null&&(z=z.memoCache,z!=null&&(m={data:z.data.map(function(H){return H.slice()}),index:0})))}if(m==null&&(m={data:[],index:0}),w===null&&(w=Ka(),un.updateQueue=w),w.memoCache=m,w=m.data[m.index],w===void 0)for(w=m.data[m.index]=Array(u),z=0;z<u;z++)w[z]=Xi;return m.index++,w}function ol(u,m){return typeof m=="function"?m(u):m}function Ah(u){var m=us();return cu(m,ys,u)}function cu(u,m,w){var z=u.queue;if(z===null)throw Error(Ze(311));z.lastRenderedReducer=w;var H=u.baseQueue,J=z.pending;if(J!==null){if(H!==null){var Ae=H.next;H.next=J.next,J.next=Ae}m.baseQueue=H=J,z.pending=null}if(J=u.baseState,H===null)u.memoizedState=J;else{m=H.next;var Ke=Ae=null,Ot=null,_i=m,An=!1;do{var Zn=_i.lane&-536870913;if(Zn!==_i.lane?(yr&Zn)===Zn:(jl&Zn)===Zn){var Ji=_i.revertLane;if(Ji===0)Ot!==null&&(Ot=Ot.next={lane:0,revertLane:0,action:_i.action,hasEagerState:_i.hasEagerState,eagerState:_i.eagerState,next:null}),Zn===Vc&&(An=!0);else if((jl&Ji)===Ji){_i=_i.next,Ji===Vc&&(An=!0);continue}else Zn={lane:0,revertLane:_i.revertLane,action:_i.action,hasEagerState:_i.hasEagerState,eagerState:_i.eagerState,next:null},Ot===null?(Ke=Ot=Zn,Ae=J):Ot=Ot.next=Zn,un.lanes|=Ji,Pa|=Ji;Zn=_i.action,Gu&&w(J,Zn),J=_i.hasEagerState?_i.eagerState:w(J,Zn)}else Ji={lane:Zn,revertLane:_i.revertLane,action:_i.action,hasEagerState:_i.hasEagerState,eagerState:_i.eagerState,next:null},Ot===null?(Ke=Ot=Ji,Ae=J):Ot=Ot.next=Ji,un.lanes|=Zn,Pa|=Zn;_i=_i.next}while(_i!==null&&_i!==m);if(Ot===null?Ae=J:Ot.next=Ke,!Kr(J,u.memoizedState)&&(Zs=!0,An&&(w=oc,w!==null)))throw w;u.memoizedState=J,u.baseState=Ae,u.baseQueue=Ot,z.lastRenderedState=J}return H===null&&(z.lanes=0),[u.memoizedState,z.dispatch]}function Ch(u){var m=us(),w=m.queue;if(w===null)throw Error(Ze(311));w.lastRenderedReducer=u;var z=w.dispatch,H=w.pending,J=m.memoizedState;if(H!==null){w.pending=null;var Ae=H=H.next;do J=u(J,Ae.action),Ae=Ae.next;while(Ae!==H);Kr(J,m.memoizedState)||(Zs=!0),m.memoizedState=J,m.baseQueue===null&&(m.baseState=J),w.lastRenderedState=J}return[J,z]}function id(u,m,w){var z=un,H=us(),J=pa;if(J){if(w===void 0)throw Error(Ze(407));w=w()}else w=m();var Ae=!Kr((ys||H).memoizedState,w);if(Ae&&(H.memoizedState=w,Zs=!0),H=H.queue,qs(Hc.bind(null,z,H,u),[u]),H.getSnapshot!==m||Ae||Mo!==null&&Mo.memoizedState.tag&1){if(z.flags|=2048,cc(9,Pn.bind(null,z,H,w,m),{destroy:void 0},null),_r===null)throw Error(Ze(349));J||(jl&60)!==0||Ri(z,m,w)}return w}function Ri(u,m,w){u.flags|=16384,u={getSnapshot:m,value:w},m=un.updateQueue,m===null?(m=Ka(),un.updateQueue=m,m.stores=[u]):(w=m.stores,w===null?m.stores=[u]:w.push(u))}function Pn(u,m,w,z){m.value=w,m.getSnapshot=z,ss(m)&&Ht(u)}function Hc(u,m,w){return w(function(){ss(m)&&Ht(u)})}function ss(u){var m=u.getSnapshot;u=u.value;try{var w=m();return!Kr(u,w)}catch{return!0}}function Ht(u){var m=nc(u,2);m!==null&&Uo(m,u,2)}function uu(u){var m=mo();if(typeof u=="function"){var w=u;if(u=w(),Gu){$a(!0);try{w()}finally{$a(!1)}}}return m.memoizedState=m.baseState=u,m.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ol,lastRenderedState:u},m}function js(u,m,w,z){return u.baseState=w,cu(u,ys,typeof z=="function"?z:ol)}function hu(u,m,w,z,H){if(dd(u))throw Error(Ze(485));if(u=m.action,u!==null){var J={payload:H,action:u,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(Ae){J.listeners.push(Ae)}};Fi.T!==null?w(!0):J.isTransition=!1,z(J),w=m.pending,w===null?(J.next=m.pending=J,Wd(m,J)):(J.next=w.next,m.pending=w.next=J)}}function Wd(u,m){var w=m.action,z=m.payload,H=u.state;if(m.isTransition){var J=Fi.T,Ae={};Fi.T=Ae;try{var Ke=w(H,z),Ot=Fi.S;Ot!==null&&Ot(Ae,Ke),Lh(u,m,Ke)}catch(_i){lc(u,m,_i)}finally{Fi.T=J}}else try{J=w(H,z),Lh(u,m,J)}catch(_i){lc(u,m,_i)}}function Lh(u,m,w){w!==null&&typeof w=="object"&&typeof w.then=="function"?w.then(function(z){nd(u,m,z)},function(z){return lc(u,m,z)}):nd(u,m,w)}function nd(u,m,w){m.status="fulfilled",m.value=w,rd(m),u.state=w,m=u.pending,m!==null&&(w=m.next,w===m?u.pending=null:(w=w.next,m.next=w,Wd(u,w)))}function lc(u,m,w){var z=u.pending;if(u.pending=null,z!==null){z=z.next;do m.status="rejected",m.reason=w,rd(m),m=m.next;while(m!==z)}u.action=null}function rd(u){u=u.listeners;for(var m=0;m<u.length;m++)(0,u[m])()}function ad(u,m){return m}function sd(u,m){if(pa){var w=_r.formState;if(w!==null){e:{var z=un;if(pa){if(cs){t:{for(var H=cs,J=xc;H.nodeType!==8;){if(!J){H=null;break t}if(H=At(H.nextSibling),H===null){H=null;break t}}J=H.data,H=J==="F!"||J==="F"?H:null}if(H){cs=At(H.nextSibling),z=H.data==="F!";break e}}au(z)}z=!1}z&&(m=w[0])}}return w=mo(),w.memoizedState=w.baseState=m,z={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ad,lastRenderedState:m},w.queue=z,w=go.bind(null,un,z),z.dispatch=w,z=uu(!1),J=$d.bind(null,un,!1,z.queue),z=mo(),H={state:m,dispatch:null,action:u,pending:null},z.queue=H,w=hu.bind(null,un,H,J,w),H.dispatch=w,z.memoizedState=u,[m,w,!1]}function Zd(u){var m=us();return Mc(m,ys,u)}function Mc(u,m,w){m=cu(u,m,ad)[0],u=Ah(ol)[0],m=typeof m=="object"&&m!==null&&typeof m.then=="function"?Sh(m):m;var z=us(),H=z.queue,J=H.dispatch;return w!==z.memoizedState&&(un.flags|=2048,cc(9,od.bind(null,H,w),{destroy:void 0},null)),[m,J,u]}function od(u,m){u.action=m}function ld(u){var m=us(),w=ys;if(w!==null)return Mc(m,w,u);us(),m=m.memoizedState,w=us();var z=w.queue.dispatch;return w.memoizedState=u,[m,z,!1]}function cc(u,m,w,z){return u={tag:u,create:m,inst:w,deps:z,next:null},m=un.updateQueue,m===null&&(m=Ka(),un.updateQueue=m),w=m.lastEffect,w===null?m.lastEffect=u.next=u:(z=w.next,w.next=u,u.next=z,m.lastEffect=u),u}function cd(){return us().memoizedState}function ql(u,m,w,z){var H=mo();un.flags|=u,H.memoizedState=cc(1|m,w,{destroy:void 0},z===void 0?null:z)}function Il(u,m,w,z){var H=us();z=z===void 0?null:z;var J=H.memoizedState.inst;ys!==null&&z!==null&&wf(z,ys.memoizedState.deps)?H.memoizedState=cc(m,w,J,z):(un.flags|=u,H.memoizedState=cc(1|m,w,J,z))}function Xd(u,m){ql(8390656,8,u,m)}function qs(u,m){Il(2048,8,u,m)}function xp(u,m){return Il(4,2,u,m)}function ud(u,m){return Il(4,4,u,m)}function ts(u,m){if(typeof m=="function"){u=u();var w=m(u);return function(){typeof w=="function"?w():m(null)}}if(m!=null)return u=u(),m.current=u,function(){m.current=null}}function Ta(u,m,w){w=w!=null?w.concat([u]):null,Il(4,4,ts.bind(null,m,u),w)}function Mf(){}function du(u,m){var w=us();m=m===void 0?null:m;var z=w.memoizedState;return m!==null&&wf(m,z[1])?z[0]:(w.memoizedState=[u,m],u)}function Rh(u,m){var w=us();m=m===void 0?null:m;var z=w.memoizedState;if(m!==null&&wf(m,z[1]))return z[0];if(z=u(),Gu){$a(!0);try{u()}finally{$a(!1)}}return w.memoizedState=[z,m],z}function Wl(u,m,w){return w===void 0||(jl&1073741824)!==0?u.memoizedState=m:(u.memoizedState=w,u=Hp(),un.lanes|=u,Pa|=u,w)}function Ih(u,m,w,z){return Kr(w,m)?w:Xo.current!==null?(u=Wl(u,w,z),Kr(u,m)||(Zs=!0),u):(jl&42)===0?(Zs=!0,u.memoizedState=w):(u=Hp(),un.lanes|=u,Pa|=u,m)}function Tc(u,m,w,z,H){var J=pt.p;pt.p=J!==0&&8>J?J:8;var Ae=Fi.T,Ke={};Fi.T=Ke,$d(u,!1,m,w);try{var Ot=H(),_i=Fi.S;if(_i!==null&&_i(Ke,Ot),Ot!==null&&typeof Ot=="object"&&typeof Ot.then=="function"){var An=Gc(Ot,z);Wu(u,m,An,il(u))}else Wu(u,m,z,il(u))}catch(Zn){Wu(u,m,{then:function(){},status:"rejected",reason:Zn},il())}finally{pt.p=J,Fi.T=Ae}}function jc(){}function Fo(u,m,w,z){if(u.tag!==5)throw Error(Ze(476));var H=Dh(u).queue;Tc(u,H,m,ti,w===null?jc:function(){return Sc(u),w(z)})}function Dh(u){var m=u.memoizedState;if(m!==null)return m;m={memoizedState:ti,baseState:ti,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ol,lastRenderedState:ti},next:null};var w={};return m.next={memoizedState:w,baseState:w,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ol,lastRenderedState:w},next:null},u.memoizedState=m,u=u.alternate,u!==null&&(u.memoizedState=m),m}function Sc(u){var m=Dh(u).next.queue;Wu(u,m,{},il())}function Yd(){return yl(Sd)}function Tf(){return us().memoizedState}function qc(){return us().memoizedState}function hd(u){for(var m=u.return;m!==null;){switch(m.tag){case 24:case 3:var w=il();u=xl(w);var z=yu(m,u,w);z!==null&&(Uo(z,m,w),Ju(z,m,w)),m={cache:sc()},u.payload=m;return}m=m.return}}function fu(u,m,w){var z=il();w={lane:z,revertLane:0,action:w,hasEagerState:!1,eagerState:null,next:null},dd(u)?uo(m,w):(w=Xh(u,m,w,z),w!==null&&(Uo(w,u,z),fd(w,m,z)))}function go(u,m,w){var z=il();Wu(u,m,w,z)}function Wu(u,m,w,z){var H={lane:z,revertLane:0,action:w,hasEagerState:!1,eagerState:null,next:null};if(dd(u))uo(m,H);else{var J=u.alternate;if(u.lanes===0&&(J===null||J.lanes===0)&&(J=m.lastRenderedReducer,J!==null))try{var Ae=m.lastRenderedState,Ke=J(Ae,w);if(H.hasEagerState=!0,H.eagerState=Ke,Kr(Ke,Ae))return Fu(u,m,H,0),_r===null&&ru(),!1}catch{}finally{}if(w=Xh(u,m,H,z),w!==null)return Uo(w,u,z),fd(w,m,z),!0}return!1}function $d(u,m,w,z){if(z={lane:2,revertLane:Bf(),action:z,hasEagerState:!1,eagerState:null,next:null},dd(u)){if(m)throw Error(Ze(479))}else m=Xh(u,w,z,2),m!==null&&Uo(m,u,2)}function dd(u){var m=u.alternate;return u===un||m!==null&&m===un}function uo(u,m){lu=bf=!0;var w=u.pending;w===null?m.next=m:(m.next=w.next,w.next=m),u.pending=m}function fd(u,m,w){if((w&4194176)!==0){var z=m.lanes;z&=u.pendingLanes,w|=z,m.lanes=w,Ro(u,w)}}var To={readContext:yl,use:qu,useCallback:Hs,useContext:Hs,useEffect:Hs,useImperativeHandle:Hs,useLayoutEffect:Hs,useInsertionEffect:Hs,useMemo:Hs,useReducer:Hs,useRef:Hs,useState:Hs,useDebugValue:Hs,useDeferredValue:Hs,useTransition:Hs,useSyncExternalStore:Hs,useId:Hs};To.useCacheRefresh=Hs,To.useMemoCache=Hs,To.useHostTransitionStatus=Hs,To.useFormState=Hs,To.useActionState=Hs,To.useOptimistic=Hs;var Ec={readContext:yl,use:qu,useCallback:function(u,m){return mo().memoizedState=[u,m===void 0?null:m],u},useContext:yl,useEffect:Xd,useImperativeHandle:function(u,m,w){w=w!=null?w.concat([u]):null,ql(4194308,4,ts.bind(null,m,u),w)},useLayoutEffect:function(u,m){return ql(4194308,4,u,m)},useInsertionEffect:function(u,m){ql(4,2,u,m)},useMemo:function(u,m){var w=mo();m=m===void 0?null:m;var z=u();if(Gu){$a(!0);try{u()}finally{$a(!1)}}return w.memoizedState=[z,m],z},useReducer:function(u,m,w){var z=mo();if(w!==void 0){var H=w(m);if(Gu){$a(!0);try{w(m)}finally{$a(!1)}}}else H=m;return z.memoizedState=z.baseState=H,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:u,lastRenderedState:H},z.queue=u,u=u.dispatch=fu.bind(null,un,u),[z.memoizedState,u]},useRef:function(u){var m=mo();return u={current:u},m.memoizedState=u},useState:function(u){u=uu(u);var m=u.queue,w=go.bind(null,un,m);return m.dispatch=w,[u.memoizedState,w]},useDebugValue:Mf,useDeferredValue:function(u,m){var w=mo();return Wl(w,u,m)},useTransition:function(){var u=uu(!1);return u=Tc.bind(null,un,u.queue,!0,!1),mo().memoizedState=u,[!1,u]},useSyncExternalStore:function(u,m,w){var z=un,H=mo();if(pa){if(w===void 0)throw Error(Ze(407));w=w()}else{if(w=m(),_r===null)throw Error(Ze(349));(yr&60)!==0||Ri(z,m,w)}H.memoizedState=w;var J={value:w,getSnapshot:m};return H.queue=J,Xd(Hc.bind(null,z,J,u),[u]),z.flags|=2048,cc(9,Pn.bind(null,z,J,w,m),{destroy:void 0},null),w},useId:function(){var u=mo(),m=_r.identifierPrefix;if(pa){var w=Uc,z=Nc;w=(z&~(1<<32-dn(z)-1)).toString(32)+w,m=":"+m+"R"+w,w=Gd++,0<w&&(m+="H"+w.toString(32)),m+=":"}else w=jd++,m=":"+m+"r"+w.toString(32)+":";return u.memoizedState=m},useCacheRefresh:function(){return mo().memoizedState=hd.bind(null,un)}};Ec.useMemoCache=Eh,Ec.useHostTransitionStatus=Yd,Ec.useFormState=sd,Ec.useActionState=sd,Ec.useOptimistic=function(u){var m=mo();m.memoizedState=m.baseState=u;var w={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return m.queue=w,m=$d.bind(null,un,!0,w),w.dispatch=m,[u,m]};var gl={readContext:yl,use:qu,useCallback:du,useContext:yl,useEffect:qs,useImperativeHandle:Ta,useInsertionEffect:xp,useLayoutEffect:ud,useMemo:Rh,useReducer:Ah,useRef:cd,useState:function(){return Ah(ol)},useDebugValue:Mf,useDeferredValue:function(u,m){var w=us();return Ih(w,ys.memoizedState,u,m)},useTransition:function(){var u=Ah(ol)[0],m=us().memoizedState;return[typeof u=="boolean"?u:Sh(u),m]},useSyncExternalStore:id,useId:Tf};gl.useCacheRefresh=qc,gl.useMemoCache=Eh,gl.useHostTransitionStatus=Yd,gl.useFormState=Zd,gl.useActionState=Zd,gl.useOptimistic=function(u,m){var w=us();return js(w,ys,u,m)};var to={readContext:yl,use:qu,useCallback:du,useContext:yl,useEffect:qs,useImperativeHandle:Ta,useInsertionEffect:xp,useLayoutEffect:ud,useMemo:Rh,useReducer:Ch,useRef:cd,useState:function(){return Ch(ol)},useDebugValue:Mf,useDeferredValue:function(u,m){var w=us();return ys===null?Wl(w,u,m):Ih(w,ys.memoizedState,u,m)},useTransition:function(){var u=Ch(ol)[0],m=us().memoizedState;return[typeof u=="boolean"?u:Sh(u),m]},useSyncExternalStore:id,useId:Tf};to.useCacheRefresh=qc,to.useMemoCache=Eh,to.useHostTransitionStatus=Yd,to.useFormState=ld,to.useActionState=ld,to.useOptimistic=function(u,m){var w=us();return ys!==null?js(w,ys,u,m):(w.baseState=u,[u,w.queue.dispatch])};function Zl(u,m,w,z){m=u.memoizedState,w=w(z,m),w=w==null?m:oi({},m,w),u.memoizedState=w,u.lanes===0&&(u.updateQueue.baseState=w)}var Ac={isMounted:function(u){return(u=u._reactInternals)?Re(u)===u:!1},enqueueSetState:function(u,m,w){u=u._reactInternals;var z=il(),H=xl(z);H.payload=m,w!=null&&(H.callback=w),m=yu(u,H,z),m!==null&&(Uo(m,u,z),Ju(m,u,z))},enqueueReplaceState:function(u,m,w){u=u._reactInternals;var z=il(),H=xl(z);H.tag=1,H.payload=m,w!=null&&(H.callback=w),m=yu(u,H,z),m!==null&&(Uo(m,u,z),Ju(m,u,z))},enqueueForceUpdate:function(u,m){u=u._reactInternals;var w=il(),z=xl(w);z.tag=2,m!=null&&(z.callback=m),m=yu(u,z,w),m!==null&&(Uo(m,u,w),Ju(m,u,w))}};function zh(u,m,w,z,H,J,Ae){return u=u.stateNode,typeof u.shouldComponentUpdate=="function"?u.shouldComponentUpdate(z,J,Ae):m.prototype&&m.prototype.isPureReactComponent?!dr(w,z)||!dr(H,J):!0}function Kd(u,m,w,z){u=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(w,z),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(w,z),m.state!==u&&Ac.enqueueReplaceState(m,m.state,null)}function Cc(u,m){var w=m;if("ref"in m){w={};for(var z in m)z!=="ref"&&(w[z]=m[z])}if(u=u.defaultProps){w===m&&(w=oi({},w));for(var H in u)w[H]===void 0&&(w[H]=u[H])}return w}var Wc=typeof reportError=="function"?reportError:function(u){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var m=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof u=="object"&&u!==null&&typeof u.message=="string"?String(u.message):String(u),error:u});if(!window.dispatchEvent(m))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",u);return}console.error(u)};function pu(u){Wc(u)}function Sf(u){console.error(u)}function Jd(u){Wc(u)}function pd(u,m){try{var w=u.onUncaughtError;w(m.value,{componentStack:m.stack})}catch(z){setTimeout(function(){throw z})}}function Ef(u,m,w){try{var z=u.onCaughtError;z(w.value,{componentStack:w.stack,errorBoundary:m.tag===1?m.stateNode:null})}catch(H){setTimeout(function(){throw H})}}function Ph(u,m,w){return w=xl(w),w.tag=3,w.payload={element:null},w.callback=function(){pd(u,m)},w}function Oh(u){return u=xl(u),u.tag=3,u}function mu(u,m,w,z){var H=w.type.getDerivedStateFromError;if(typeof H=="function"){var J=z.value;u.payload=function(){return H(J)},u.callback=function(){Ef(m,w,z)}}var Ae=w.stateNode;Ae!==null&&typeof Ae.componentDidCatch=="function"&&(u.callback=function(){Ef(m,w,z),typeof H!="function"&&(Eo===null?Eo=new Set([this]):Eo.add(this));var Ke=z.stack;this.componentDidCatch(z.value,{componentStack:Ke!==null?Ke:""})})}function md(u,m,w,z,H){if(w.flags|=32768,z!==null&&typeof z=="object"&&typeof z.then=="function"){if(m=w.alternate,m!==null&&Ic(m,w,H,!0),w=ml.current,w!==null){switch(w.tag){case 13:return bc===null?Rf():w.alternate===null&&da===0&&(da=3),w.flags&=-257,w.flags|=65536,w.lanes=H,z===gp?w.flags|=16384:(m=w.updateQueue,m===null?w.updateQueue=new Set([z]):m.add(z),th(u,z,H)),!1;case 22:return w.flags|=65536,z===gp?w.flags|=16384:(m=w.updateQueue,m===null?(m={transitions:null,markerInstances:null,retryQueue:new Set([z])},w.updateQueue=m):(w=m.retryQueue,w===null?m.retryQueue=new Set([z]):w.add(z)),th(u,z,H)),!1}throw Error(Ze(435,w.tag))}return th(u,z,H),Rf(),!1}if(pa)return m=ml.current,m!==null?((m.flags&65536)===0&&(m.flags|=256),m.flags|=65536,m.lanes=H,z!==_f&&(u=Error(Ze(422),{cause:z}),Od(rc(u,w)))):(z!==_f&&(m=Error(Ze(423),{cause:z}),Od(rc(m,w))),u=u.current.alternate,u.flags|=65536,H&=-H,u.lanes|=H,z=rc(z,w),H=Ph(u.stateNode,z,H),Yc(u,H),da!==4&&(da=2)),!1;var J=Error(Ze(520),{cause:z});if(J=rc(J,w),Oa===null?Oa=[J]:Oa.push(J),da!==4&&(da=2),m===null)return!0;z=rc(z,w),w=m;do{switch(w.tag){case 3:return w.flags|=65536,u=H&-H,w.lanes|=u,u=Ph(w.stateNode,z,u),Yc(w,u),!1;case 1:if(m=w.type,J=w.stateNode,(w.flags&128)===0&&(typeof m.getDerivedStateFromError=="function"||J!==null&&typeof J.componentDidCatch=="function"&&(Eo===null||!Eo.has(J))))return w.flags|=65536,H&=-H,w.lanes|=H,H=Oh(H),mu(H,u,w,z),Yc(w,H),!1}w=w.return}while(w!==null);return!1}var Lc=Error(Ze(461)),Zs=!1;function Xs(u,m,w,z){m.child=u===null?Qf(m,null,w,z):Hl(m,u.child,w,z)}function Zu(u,m,w,z,H){w=w.render;var J=m.ref;if("ref"in z){var Ae={};for(var Ke in z)Ke!=="ref"&&(Ae[Ke]=z[Ke])}else Ae=z;return Yl(m),z=wc(u,m,w,Ae,J,H),Ke=qd(),u!==null&&!Zs?(Th(u,m,H),uc(u,m,H)):(pa&&Ke&&gh(m),m.flags|=1,Xs(u,m,z,H),m.child)}function ll(u,m,w,z,H){if(u===null){var J=w.type;return typeof J=="function"&&!si(J)&&J.defaultProps===void 0&&w.compare===null?(m.tag=15,m.type=J,Xu(u,m,J,z,H)):(u=yi(w.type,null,z,m,m.mode,H),u.ref=m.ref,u.return=m,m.child=u)}if(J=u.child,!nf(u,H)){var Ae=J.memoizedProps;if(w=w.compare,w=w!==null?w:dr,w(Ae,z)&&u.ref===m.ref)return uc(u,m,H)}return m.flags|=1,u=an(J,z),u.ref=m.ref,u.return=m,m.child=u}function Xu(u,m,w,z,H){if(u!==null){var J=u.memoizedProps;if(dr(J,z)&&u.ref===m.ref)if(Zs=!1,m.pendingProps=z=J,nf(u,H))(u.flags&131072)!==0&&(Zs=!0);else return m.lanes=u.lanes,uc(u,m,H)}return bs(u,m,w,z,H)}function Af(u,m,w){var z=m.pendingProps,H=z.children,J=(m.stateNode._pendingVisibility&2)!==0,Ae=u!==null?u.memoizedState:null;if(Yu(u,m),z.mode==="hidden"||J){if((m.flags&128)!==0){if(z=Ae!==null?Ae.baseLanes|w:w,u!==null){for(H=m.child=u.child,J=0;H!==null;)J=J|H.lanes|H.childLanes,H=H.sibling;m.childLanes=J&~z}else m.childLanes=0,m.child=null;return Xl(u,m,z,w)}if((w&536870912)!==0)m.memoizedState={baseLanes:0,cachePool:null},u!==null&&wh(m,Ae!==null?Ae.cachePool:null),Ae!==null?Bd(m,Ae):ep(),tp(m);else return m.lanes=m.childLanes=536870912,Xl(u,m,Ae!==null?Ae.baseLanes|w:w,w)}else Ae!==null?(wh(m,Ae.cachePool),Bd(m,Ae),ac(),m.memoizedState=null):(u!==null&&wh(m,null),ep(),ac());return Xs(u,m,H,w),m.child}function Xl(u,m,w,z){var H=xf();return H=H===null?null:{parent:Ws._currentValue,pool:H},m.memoizedState={baseLanes:w,cachePool:H},u!==null&&wh(m,null),ep(),tp(m),u!==null&&Ic(u,m,z,!0),null}function Yu(u,m){var w=m.ref;if(w===null)u!==null&&u.ref!==null&&(m.flags|=2097664);else{if(typeof w!="function"&&typeof w!="object")throw Error(Ze(284));(u===null||u.ref!==w)&&(m.flags|=2097664)}}function bs(u,m,w,z,H){return Yl(m),w=wc(u,m,w,z,void 0,H),z=qd(),u!==null&&!Zs?(Th(u,m,H),uc(u,m,H)):(pa&&z&&gh(m),m.flags|=1,Xs(u,m,w,H),m.child)}function gd(u,m,w,z,H,J){return Yl(m),m.updateQueue=null,w=Hu(m,z,w,H),Rl(u),z=qd(),u!==null&&!Zs?(Th(u,m,J),uc(u,m,J)):(pa&&z&&gh(m),m.flags|=1,Xs(u,m,w,J),m.child)}function Cf(u,m,w,z,H){if(Yl(m),m.stateNode===null){var J=Yh,Ae=w.contextType;typeof Ae=="object"&&Ae!==null&&(J=yl(Ae)),J=new w(z,J),m.memoizedState=J.state!==null&&J.state!==void 0?J.state:null,J.updater=Ac,m.stateNode=J,J._reactInternals=m,J=m.stateNode,J.props=z,J.state=m.memoizedState,J.refs={},ip(m),Ae=w.contextType,J.context=typeof Ae=="object"&&Ae!==null?yl(Ae):Yh,J.state=m.memoizedState,Ae=w.getDerivedStateFromProps,typeof Ae=="function"&&(Zl(m,w,Ae,z),J.state=m.memoizedState),typeof w.getDerivedStateFromProps=="function"||typeof J.getSnapshotBeforeUpdate=="function"||typeof J.UNSAFE_componentWillMount!="function"&&typeof J.componentWillMount!="function"||(Ae=J.state,typeof J.componentWillMount=="function"&&J.componentWillMount(),typeof J.UNSAFE_componentWillMount=="function"&&J.UNSAFE_componentWillMount(),Ae!==J.state&&Ac.enqueueReplaceState(J,J.state,null),Jo(m,z,J,H),Ko(),J.state=m.memoizedState),typeof J.componentDidMount=="function"&&(m.flags|=4194308),z=!0}else if(u===null){J=m.stateNode;var Ke=m.memoizedProps,Ot=Cc(w,Ke);J.props=Ot;var _i=J.context,An=w.contextType;Ae=Yh,typeof An=="object"&&An!==null&&(Ae=yl(An));var Zn=w.getDerivedStateFromProps;An=typeof Zn=="function"||typeof J.getSnapshotBeforeUpdate=="function",Ke=m.pendingProps!==Ke,An||typeof J.UNSAFE_componentWillReceiveProps!="function"&&typeof J.componentWillReceiveProps!="function"||(Ke||_i!==Ae)&&Kd(m,J,z,Ae),vl=!1;var Ji=m.memoizedState;J.state=Ji,Jo(m,z,J,H),Ko(),_i=m.memoizedState,Ke||Ji!==_i||vl?(typeof Zn=="function"&&(Zl(m,w,Zn,z),_i=m.memoizedState),(Ot=vl||zh(m,w,Ot,z,Ji,_i,Ae))?(An||typeof J.UNSAFE_componentWillMount!="function"&&typeof J.componentWillMount!="function"||(typeof J.componentWillMount=="function"&&J.componentWillMount(),typeof J.UNSAFE_componentWillMount=="function"&&J.UNSAFE_componentWillMount()),typeof J.componentDidMount=="function"&&(m.flags|=4194308)):(typeof J.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=z,m.memoizedState=_i),J.props=z,J.state=_i,J.context=Ae,z=Ot):(typeof J.componentDidMount=="function"&&(m.flags|=4194308),z=!1)}else{J=m.stateNode,Na(u,m),Ae=m.memoizedProps,An=Cc(w,Ae),J.props=An,Zn=m.pendingProps,Ji=J.context,_i=w.contextType,Ot=Yh,typeof _i=="object"&&_i!==null&&(Ot=yl(_i)),Ke=w.getDerivedStateFromProps,(_i=typeof Ke=="function"||typeof J.getSnapshotBeforeUpdate=="function")||typeof J.UNSAFE_componentWillReceiveProps!="function"&&typeof J.componentWillReceiveProps!="function"||(Ae!==Zn||Ji!==Ot)&&Kd(m,J,z,Ot),vl=!1,Ji=m.memoizedState,J.state=Ji,Jo(m,z,J,H),Ko();var Sn=m.memoizedState;Ae!==Zn||Ji!==Sn||vl||u!==null&&u.dependencies!==null&&_u(u.dependencies)?(typeof Ke=="function"&&(Zl(m,w,Ke,z),Sn=m.memoizedState),(An=vl||zh(m,w,An,z,Ji,Sn,Ot)||u!==null&&u.dependencies!==null&&_u(u.dependencies))?(_i||typeof J.UNSAFE_componentWillUpdate!="function"&&typeof J.componentWillUpdate!="function"||(typeof J.componentWillUpdate=="function"&&J.componentWillUpdate(z,Sn,Ot),typeof J.UNSAFE_componentWillUpdate=="function"&&J.UNSAFE_componentWillUpdate(z,Sn,Ot)),typeof J.componentDidUpdate=="function"&&(m.flags|=4),typeof J.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof J.componentDidUpdate!="function"||Ae===u.memoizedProps&&Ji===u.memoizedState||(m.flags|=4),typeof J.getSnapshotBeforeUpdate!="function"||Ae===u.memoizedProps&&Ji===u.memoizedState||(m.flags|=1024),m.memoizedProps=z,m.memoizedState=Sn),J.props=z,J.state=Sn,J.context=Ot,z=An):(typeof J.componentDidUpdate!="function"||Ae===u.memoizedProps&&Ji===u.memoizedState||(m.flags|=4),typeof J.getSnapshotBeforeUpdate!="function"||Ae===u.memoizedProps&&Ji===u.memoizedState||(m.flags|=1024),z=!1)}return J=z,Yu(u,m),z=(m.flags&128)!==0,J||z?(J=m.stateNode,w=z&&typeof w.getDerivedStateFromError!="function"?null:J.render(),m.flags|=1,u!==null&&z?(m.child=Hl(m,u.child,null,H),m.child=Hl(m,null,w,H)):Xs(u,m,w,H),m.memoizedState=J.state,u=m.child):u=uc(u,m,H),u}function Qd(u,m,w,z){return Pd(),m.flags|=256,Xs(u,m,w,z),m.child}var $u={dehydrated:null,treeContext:null,retryLane:0};function ef(u){return{baseLanes:u,cachePool:Vu()}}function Ku(u,m,w){return u=u!==null?u.childLanes&~w:0,m&&(u|=Xa),u}function tf(u,m,w){var z=m.pendingProps,H=!1,J=(m.flags&128)!==0,Ae;if((Ae=J)||(Ae=u!==null&&u.memoizedState===null?!1:(Bo.current&2)!==0),Ae&&(H=!0,m.flags&=-129),Ae=(m.flags&32)!==0,m.flags&=-33,u===null){if(pa){if(H?xh(m):ac(),pa){var Ke=cs,Ot;if(Ot=Ke){e:{for(Ot=Ke,Ke=xc;Ot.nodeType!==8;){if(!Ke){Ke=null;break e}if(Ot=At(Ot.nextSibling),Ot===null){Ke=null;break e}}Ke=Ot}Ke!==null?(m.memoizedState={dehydrated:Ke,treeContext:ku!==null?{id:Nc,overflow:Uc}:null,retryLane:536870912},Ot=hi(18,null,null,0),Ot.stateNode=Ke,Ot.return=m,m.child=Ot,ls=m,cs=null,Ot=!0):Ot=!1}Ot||au(m)}if(Ke=m.memoizedState,Ke!==null&&(Ke=Ke.dehydrated,Ke!==null))return Ke.data==="$!"?m.lanes=16:m.lanes=536870912,null;Uu(m)}return Ke=z.children,z=z.fallback,H?(ac(),H=m.mode,Ke=Zc({mode:"hidden",children:Ke},H),z=Hi(z,H,w,null),Ke.return=m,z.return=m,Ke.sibling=z,m.child=Ke,H=m.child,H.memoizedState=ef(w),H.childLanes=Ku(u,Ae,w),m.memoizedState=$u,z):(xh(m),_l(m,Ke))}if(Ot=u.memoizedState,Ot!==null&&(Ke=Ot.dehydrated,Ke!==null)){if(J)m.flags&256?(xh(m),m.flags&=-257,m=ws(u,m,w)):m.memoizedState!==null?(ac(),m.child=u.child,m.flags|=128,m=null):(ac(),H=z.fallback,Ke=m.mode,z=Zc({mode:"visible",children:z.children},Ke),H=Hi(H,Ke,w,null),H.flags|=2,z.return=m,H.return=m,z.sibling=H,m.child=z,Hl(m,u.child,null,w),z=m.child,z.memoizedState=ef(w),z.childLanes=Ku(u,Ae,w),m.memoizedState=$u,m=H);else if(xh(m),Ke.data==="$!"){if(Ae=Ke.nextSibling&&Ke.nextSibling.dataset,Ae)var _i=Ae.dgst;Ae=_i,z=Error(Ze(419)),z.stack="",z.digest=Ae,Od({value:z,source:null,stack:null}),m=ws(u,m,w)}else if(Zs||Ic(u,m,w,!1),Ae=(w&u.childLanes)!==0,Zs||Ae){if(Ae=_r,Ae!==null){if(z=w&-w,(z&42)!==0)z=1;else switch(z){case 2:z=1;break;case 8:z=4;break;case 32:z=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:z=64;break;case 268435456:z=134217728;break;default:z=0}if(z=(z&(Ae.suspendedLanes|w))!==0?0:z,z!==0&&z!==Ot.retryLane)throw Ot.retryLane=z,nc(u,z),Uo(Ae,u,z),Lc}Ke.data==="$?"||Rf(),m=ws(u,m,w)}else Ke.data==="$?"?(m.flags|=128,m.child=u.child,m=Tp.bind(null,u),Ke._reactRetry=m,m=null):(u=Ot.treeContext,cs=At(Ke.nextSibling),ls=m,pa=!0,Ll=null,xc=!1,u!==null&&(Cl[Gl++]=Nc,Cl[Gl++]=Uc,Cl[Gl++]=ku,Nc=u.id,Uc=u.overflow,ku=m),m=_l(m,z.children),m.flags|=4096);return m}return H?(ac(),H=z.fallback,Ke=m.mode,Ot=u.child,_i=Ot.sibling,z=an(Ot,{mode:"hidden",children:z.children}),z.subtreeFlags=Ot.subtreeFlags&31457280,_i!==null?H=an(_i,H):(H=Hi(H,Ke,w,null),H.flags|=2),H.return=m,z.return=m,z.sibling=H,m.child=z,z=H,H=m.child,Ke=u.child.memoizedState,Ke===null?Ke=ef(w):(Ot=Ke.cachePool,Ot!==null?(_i=Ws._currentValue,Ot=Ot.parent!==_i?{parent:_i,pool:_i}:Ot):Ot=Vu(),Ke={baseLanes:Ke.baseLanes|w,cachePool:Ot}),H.memoizedState=Ke,H.childLanes=Ku(u,Ae,w),m.memoizedState=$u,z):(xh(m),w=u.child,u=w.sibling,w=an(w,{mode:"visible",children:z.children}),w.return=m,w.sibling=null,u!==null&&(Ae=m.deletions,Ae===null?(m.deletions=[u],m.flags|=16):Ae.push(u)),m.child=w,m.memoizedState=null,w)}function _l(u,m){return m=Zc({mode:"visible",children:m},u.mode),m.return=u,u.child=m}function Zc(u,m){return en(u,m,0,null)}function ws(u,m,w){return Hl(m,u.child,null,w),u=_l(m,m.pendingProps.children),u.flags|=2,m.memoizedState=null,u}function Dl(u,m,w){u.lanes|=m;var z=u.alternate;z!==null&&(z.lanes|=m),Xc(u.return,m,w)}function Rc(u,m,w,z,H){var J=u.memoizedState;J===null?u.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:z,tail:w,tailMode:H}:(J.isBackwards=m,J.rendering=null,J.renderingStartTime=0,J.last=z,J.tail=w,J.tailMode=H)}function _d(u,m,w){var z=m.pendingProps,H=z.revealOrder,J=z.tail;if(Xs(u,m,z.children,w),z=Bo.current,(z&2)!==0)z=z&1|2,m.flags|=128;else{if(u!==null&&(u.flags&128)!==0)e:for(u=m.child;u!==null;){if(u.tag===13)u.memoizedState!==null&&Dl(u,w,m);else if(u.tag===19)Dl(u,w,m);else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===m)break e;for(;u.sibling===null;){if(u.return===null||u.return===m)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}z&=1}switch(et(Bo,z),H){case"forwards":for(w=m.child,H=null;w!==null;)u=w.alternate,u!==null&&kd(u)===null&&(H=w),w=w.sibling;w=H,w===null?(H=m.child,m.child=null):(H=w.sibling,w.sibling=null),Rc(m,!1,H,w,J);break;case"backwards":for(w=null,H=m.child,m.child=null;H!==null;){if(u=H.alternate,u!==null&&kd(u)===null){m.child=H;break}u=H.sibling,H.sibling=w,w=H,H=u}Rc(m,!0,w,null,J);break;case"together":Rc(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function uc(u,m,w){if(u!==null&&(m.dependencies=u.dependencies),Pa|=m.lanes,(w&m.childLanes)===0)if(u!==null){if(Ic(u,m,w,!1),(w&m.childLanes)===0)return null}else return null;if(u!==null&&m.child!==u.child)throw Error(Ze(153));if(m.child!==null){for(u=m.child,w=an(u,u.pendingProps),m.child=w,w.return=m;u.sibling!==null;)u=u.sibling,w=w.sibling=an(u,u.pendingProps),w.return=m;w.sibling=null}return m.child}function nf(u,m){return(u.lanes&m)!==0?!0:(u=u.dependencies,!!(u!==null&&_u(u)))}function Bh(u,m,w){switch(m.tag){case 3:cn(m,m.stateNode.containerInfo),$o(m,Ws,u.memoizedState.cache),Pd();break;case 27:case 5:Xe(m);break;case 4:cn(m,m.stateNode.containerInfo);break;case 10:$o(m,m.type,m.memoizedProps.value);break;case 13:var z=m.memoizedState;if(z!==null)return z.dehydrated!==null?(xh(m),m.flags|=128,null):(w&m.child.childLanes)!==0?tf(u,m,w):(xh(m),u=uc(u,m,w),u!==null?u.sibling:null);xh(m);break;case 19:var H=(u.flags&128)!==0;if(z=(w&m.childLanes)!==0,z||(Ic(u,m,w,!1),z=(w&m.childLanes)!==0),H){if(z)return _d(u,m,w);m.flags|=128}if(H=m.memoizedState,H!==null&&(H.rendering=null,H.tail=null,H.lastEffect=null),et(Bo,Bo.current),z)break;return null;case 22:case 23:return m.lanes=0,Af(u,m,w);case 24:$o(m,Ws,u.memoizedState.cache)}return uc(u,m,w)}function rf(u,m,w){if(u!==null)if(u.memoizedProps!==m.pendingProps)Zs=!0;else{if(!nf(u,w)&&(m.flags&128)===0)return Zs=!1,Bh(u,m,w);Zs=(u.flags&131072)!==0}else Zs=!1,pa&&(m.flags&1048576)!==0&&Jh(m,ph,m.index);switch(m.lanes=0,m.tag){case 16:e:{u=m.pendingProps;var z=m.elementType,H=z._init;if(z=H(z._payload),m.type=z,typeof z=="function")si(z)?(u=Cc(z,u),m.tag=1,m=Cf(null,m,z,u,w)):(m.tag=0,m=bs(null,m,z,u,w));else{if(z!=null){if(H=z.$$typeof,H===Ai){m.tag=11,m=Zu(null,m,z,u,w);break e}else if(H===kt){m.tag=14,m=ll(null,m,z,u,w);break e}}throw m=Nn(z)||z,Error(Ze(306,m,""))}}return m;case 0:return bs(u,m,m.type,m.pendingProps,w);case 1:return z=m.type,H=Cc(z,m.pendingProps),Cf(u,m,z,H,w);case 3:e:{if(cn(m,m.stateNode.containerInfo),u===null)throw Error(Ze(387));var J=m.pendingProps;H=m.memoizedState,z=H.element,Na(u,m),Jo(m,J,null,w);var Ae=m.memoizedState;if(J=Ae.cache,$o(m,Ws,J),J!==H.cache&&hc(m,[Ws],w,!0),Ko(),J=Ae.element,H.isDehydrated)if(H={element:J,isDehydrated:!1,cache:Ae.cache},m.updateQueue.baseState=H,m.memoizedState=H,m.flags&256){m=Qd(u,m,J,w);break e}else if(J!==z){z=rc(Error(Ze(424)),m),Od(z),m=Qd(u,m,J,w);break e}else for(cs=At(m.stateNode.containerInfo.firstChild),ls=m,pa=!0,Ll=null,xc=!0,w=Qf(m,null,J,w),m.child=w;w;)w.flags=w.flags&-3|4096,w=w.sibling;else{if(Pd(),J===z){m=uc(u,m,w);break e}Xs(u,m,J,w)}m=m.child}return m;case 26:return Yu(u,m),u===null?(w=nl(m.type,null,m.pendingProps,null))?m.memoizedState=w:pa||(w=m.type,u=m.pendingProps,z=di(ra.current).createElement(w),z[pe]=m,z[Ce]=u,st(z,w,u),zn(z),m.stateNode=z):m.memoizedState=nl(m.type,u.memoizedProps,m.pendingProps,u.memoizedState),null;case 27:return Xe(m),u===null&&pa&&(z=m.stateNode=xn(m.type,m.pendingProps,ra.current),ls=m,xc=!0,cs=At(z.firstChild)),z=m.pendingProps.children,u!==null||pa?Xs(u,m,z,w):m.child=Hl(m,null,z,w),Yu(u,m),m.child;case 5:return u===null&&pa&&((H=z=cs)&&(z=la(z,m.type,m.pendingProps,xc),z!==null?(m.stateNode=z,ls=m,cs=At(z.firstChild),xc=!1,H=!0):H=!1),H||au(m)),Xe(m),H=m.type,J=m.pendingProps,Ae=u!==null?u.memoizedProps:null,z=J.children,Bi(H,J)?z=null:Ae!==null&&Bi(H,Ae)&&(m.flags|=32),m.memoizedState!==null&&(H=wc(u,m,vp,null,null,w),Sd._currentValue=H),Yu(u,m),Xs(u,m,z,w),m.child;case 6:return u===null&&pa&&((u=w=cs)&&(w=Kn(w,m.pendingProps,xc),w!==null?(m.stateNode=w,ls=m,cs=null,u=!0):u=!1),u||au(m)),null;case 13:return tf(u,m,w);case 4:return cn(m,m.stateNode.containerInfo),z=m.pendingProps,u===null?m.child=Hl(m,null,z,w):Xs(u,m,z,w),m.child;case 11:return Zu(u,m,m.type,m.pendingProps,w);case 7:return Xs(u,m,m.pendingProps,w),m.child;case 8:return Xs(u,m,m.pendingProps.children,w),m.child;case 12:return Xs(u,m,m.pendingProps.children,w),m.child;case 10:return z=m.pendingProps,$o(m,m.type,z.value),Xs(u,m,z.children,w),m.child;case 9:return H=m.type._context,z=m.pendingProps.children,Yl(m),H=yl(H),z=z(H),m.flags|=1,Xs(u,m,z,w),m.child;case 14:return ll(u,m,m.type,m.pendingProps,w);case 15:return Xu(u,m,m.type,m.pendingProps,w);case 19:return _d(u,m,w);case 22:return Af(u,m,w);case 24:return Yl(m),z=yl(Ws),u===null?(H=xf(),H===null&&(H=_r,J=sc(),H.pooledCache=J,J.refCount++,J!==null&&(H.pooledCacheLanes|=w),H=J),m.memoizedState={parent:z,cache:H},ip(m),$o(m,Ws,H)):((u.lanes&w)!==0&&(Na(u,m),Jo(m,null,null,w),Ko()),H=u.memoizedState,J=m.memoizedState,H.parent!==z?(H={parent:z,cache:z},m.memoizedState=H,m.lanes===0&&(m.memoizedState=m.updateQueue.baseState=H),$o(m,Ws,z)):(z=J.cache,$o(m,Ws,z),z!==H.cache&&hc(m,[Ws],w,!0))),Xs(u,m,m.pendingProps.children,w),m.child;case 29:throw m.pendingProps}throw Error(Ze(156,m.tag))}var bp=fn(null),gu=null,Yo=null;function $o(u,m,w){et(bp,m._currentValue),m._currentValue=w}function zl(u){u._currentValue=bp.current,vr(bp)}function Xc(u,m,w){for(;u!==null;){var z=u.alternate;if((u.childLanes&m)!==m?(u.childLanes|=m,z!==null&&(z.childLanes|=m)):z!==null&&(z.childLanes&m)!==m&&(z.childLanes|=m),u===w)break;u=u.return}}function hc(u,m,w,z){var H=u.child;for(H!==null&&(H.return=u);H!==null;){var J=H.dependencies;if(J!==null){var Ae=H.child;J=J.firstContext;e:for(;J!==null;){var Ke=J;J=H;for(var Ot=0;Ot<m.length;Ot++)if(Ke.context===m[Ot]){J.lanes|=w,Ke=J.alternate,Ke!==null&&(Ke.lanes|=w),Xc(J.return,w,u),z||(Ae=null);break e}J=Ke.next}}else if(H.tag===18){if(Ae=H.return,Ae===null)throw Error(Ze(341));Ae.lanes|=w,J=Ae.alternate,J!==null&&(J.lanes|=w),Xc(Ae,w,u),Ae=null}else Ae=H.child;if(Ae!==null)Ae.return=H;else for(Ae=H;Ae!==null;){if(Ae===u){Ae=null;break}if(H=Ae.sibling,H!==null){H.return=Ae.return,Ae=H;break}Ae=Ae.return}H=Ae}}function Ic(u,m,w,z){u=null;for(var H=m,J=!1;H!==null;){if(!J){if((H.flags&524288)!==0)J=!0;else if((H.flags&262144)!==0)break}if(H.tag===10){var Ae=H.alternate;if(Ae===null)throw Error(Ze(387));if(Ae=Ae.memoizedProps,Ae!==null){var Ke=H.type;Kr(H.pendingProps.value,Ae.value)||(u!==null?u.push(Ke):u=[Ke])}}else if(H===Pi.current){if(Ae=H.alternate,Ae===null)throw Error(Ze(387));Ae.memoizedState.memoizedState!==H.memoizedState.memoizedState&&(u!==null?u.push(Sd):u=[Sd])}H=H.return}u!==null&&hc(m,u,w,z),m.flags|=262144}function _u(u){for(u=u.firstContext;u!==null;){if(!Kr(u.context._currentValue,u.memoizedValue))return!0;u=u.next}return!1}function Yl(u){gu=u,Yo=null,u=u.dependencies,u!==null&&(u.firstContext=null)}function yl(u){return Gp(gu,u)}function af(u,m){return gu===null&&Yl(u),Gp(u,m)}function Gp(u,m){var w=m._currentValue;if(m={context:m,memoizedValue:w,next:null},Yo===null){if(u===null)throw Error(Ze(308));Yo=m,u.dependencies={lanes:0,firstContext:m},u.flags|=524288}else Yo=Yo.next=m;return w}var vl=!1;function ip(u){u.updateQueue={baseState:u.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Na(u,m){u=u.updateQueue,m.updateQueue===u&&(m.updateQueue={baseState:u.baseState,firstBaseUpdate:u.firstBaseUpdate,lastBaseUpdate:u.lastBaseUpdate,shared:u.shared,callbacks:null})}function xl(u){return{lane:u,tag:0,payload:null,callback:null,next:null}}function yu(u,m,w){var z=u.updateQueue;if(z===null)return null;if(z=z.shared,(In&2)!==0){var H=z.pending;return H===null?m.next=m:(m.next=H.next,H.next=m),z.pending=m,m=ua(u),fh(u,null,w),m}return Fu(u,z,m,w),ua(u)}function Ju(u,m,w){if(m=m.updateQueue,m!==null&&(m=m.shared,(w&4194176)!==0)){var z=m.lanes;z&=u.pendingLanes,w|=z,m.lanes=w,Ro(u,w)}}function Yc(u,m){var w=u.updateQueue,z=u.alternate;if(z!==null&&(z=z.updateQueue,w===z)){var H=null,J=null;if(w=w.firstBaseUpdate,w!==null){do{var Ae={lane:w.lane,tag:w.tag,payload:w.payload,callback:null,next:null};J===null?H=J=Ae:J=J.next=Ae,w=w.next}while(w!==null);J===null?H=J=m:J=J.next=m}else H=J=m;w={baseState:z.baseState,firstBaseUpdate:H,lastBaseUpdate:J,shared:z.shared,callbacks:z.callbacks},u.updateQueue=w;return}u=w.lastBaseUpdate,u===null?w.firstBaseUpdate=m:u.next=m,w.lastBaseUpdate=m}var vu=!1;function Ko(){if(vu){var u=oc;if(u!==null)throw u}}function Jo(u,m,w,z){vu=!1;var H=u.updateQueue;vl=!1;var J=H.firstBaseUpdate,Ae=H.lastBaseUpdate,Ke=H.shared.pending;if(Ke!==null){H.shared.pending=null;var Ot=Ke,_i=Ot.next;Ot.next=null,Ae===null?J=_i:Ae.next=_i,Ae=Ot;var An=u.alternate;An!==null&&(An=An.updateQueue,Ke=An.lastBaseUpdate,Ke!==Ae&&(Ke===null?An.firstBaseUpdate=_i:Ke.next=_i,An.lastBaseUpdate=Ot))}if(J!==null){var Zn=H.baseState;Ae=0,An=_i=Ot=null,Ke=J;do{var Ji=Ke.lane&-536870913,Sn=Ji!==Ke.lane;if(Sn?(yr&Ji)===Ji:(z&Ji)===Ji){Ji!==0&&Ji===Vc&&(vu=!0),An!==null&&(An=An.next={lane:0,tag:Ke.tag,payload:Ke.payload,callback:null,next:null});e:{var ea=u,Ua=Ke;Ji=m;var Go=w;switch(Ua.tag){case 1:if(ea=Ua.payload,typeof ea=="function"){Zn=ea.call(Go,Zn,Ji);break e}Zn=ea;break e;case 3:ea.flags=ea.flags&-65537|128;case 0:if(ea=Ua.payload,Ji=typeof ea=="function"?ea.call(Go,Zn,Ji):ea,Ji==null)break e;Zn=oi({},Zn,Ji);break e;case 2:vl=!0}}Ji=Ke.callback,Ji!==null&&(u.flags|=64,Sn&&(u.flags|=8192),Sn=H.callbacks,Sn===null?H.callbacks=[Ji]:Sn.push(Ji))}else Sn={lane:Ji,tag:Ke.tag,payload:Ke.payload,callback:Ke.callback,next:null},An===null?(_i=An=Sn,Ot=Zn):An=An.next=Sn,Ae|=Ji;if(Ke=Ke.next,Ke===null){if(Ke=H.shared.pending,Ke===null)break;Sn=Ke,Ke=Sn.next,Sn.next=null,H.lastBaseUpdate=Sn,H.shared.pending=null}}while(!0);An===null&&(Ot=Zn),H.baseState=Ot,H.firstBaseUpdate=_i,H.lastBaseUpdate=An,J===null&&(H.shared.lanes=0),Pa|=Ae,u.lanes=Ae,u.memoizedState=Zn}}function $c(u,m){if(typeof u!="function")throw Error(Ze(191,u));u.call(m)}function xu(u,m){var w=u.callbacks;if(w!==null)for(u.callbacks=null,u=0;u<w.length;u++)$c(w[u],m)}function So(u,m){try{var w=m.updateQueue,z=w!==null?w.lastEffect:null;if(z!==null){var H=z.next;w=H;do{if((w.tag&u)===u){z=void 0;var J=w.create,Ae=w.inst;z=J(),Ae.destroy=z}w=w.next}while(w!==H)}}catch(Ke){Ns(m,m.return,Ke)}}function Kc(u,m,w){try{var z=m.updateQueue,H=z!==null?z.lastEffect:null;if(H!==null){var J=H.next;z=J;do{if((z.tag&u)===u){var Ae=z.inst,Ke=Ae.destroy;if(Ke!==void 0){Ae.destroy=void 0,H=m;var Ot=w;try{Ke()}catch(_i){Ns(H,Ot,_i)}}}z=z.next}while(z!==J)}}catch(_i){Ns(m,m.return,_i)}}function xa(u){var m=u.updateQueue;if(m!==null){var w=u.stateNode;try{xu(m,w)}catch(z){Ns(u,u.return,z)}}}function ko(u,m,w){w.props=Cc(u.type,u.memoizedProps),w.state=u.memoizedState;try{w.componentWillUnmount()}catch(z){Ns(u,m,z)}}function yd(u,m){try{var w=u.ref;if(w!==null){var z=u.stateNode;switch(u.tag){case 26:case 27:case 5:var H=z;break;default:H=z}typeof w=="function"?u.refCleanup=w(H):w.current=H}}catch(J){Ns(u,m,J)}}function Qo(u,m){var w=u.ref,z=u.refCleanup;if(w!==null)if(typeof z=="function")try{z()}catch(H){Ns(u,m,H)}finally{u.refCleanup=null,u=u.alternate,u!=null&&(u.refCleanup=null)}else if(typeof w=="function")try{w(null)}catch(H){Ns(u,m,H)}else w.current=null}function bu(u){var m=u.type,w=u.memoizedProps,z=u.stateNode;try{e:switch(m){case"button":case"input":case"select":case"textarea":w.autoFocus&&z.focus();break e;case"img":w.src?z.src=w.src:w.srcSet&&(z.srcset=w.srcSet)}}catch(H){Ns(u,u.return,H)}}function cl(u,m,w){try{var z=u.stateNode;ot(z,u.type,w,m),z[Ce]=m}catch(H){Ns(u,u.return,H)}}function Pl(u){return u.tag===5||u.tag===3||u.tag===26||u.tag===27||u.tag===4}function io(u){e:for(;;){for(;u.sibling===null;){if(u.return===null||Pl(u.return))return null;u=u.return}for(u.sibling.return=u.return,u=u.sibling;u.tag!==5&&u.tag!==6&&u.tag!==27&&u.tag!==18;){if(u.flags&2||u.child===null||u.tag===4)continue e;u.child.return=u,u=u.child}if(!(u.flags&2))return u.stateNode}}function ho(u,m,w){var z=u.tag;if(z===5||z===6)u=u.stateNode,m?w.nodeType===8?w.parentNode.insertBefore(u,m):w.insertBefore(u,m):(w.nodeType===8?(m=w.parentNode,m.insertBefore(u,w)):(m=w,m.appendChild(u)),w=w._reactRootContainer,w!=null||m.onclick!==null||(m.onclick=Se));else if(z!==4&&z!==27&&(u=u.child,u!==null))for(ho(u,m,w),u=u.sibling;u!==null;)ho(u,m,w),u=u.sibling}function Is(u,m,w){var z=u.tag;if(z===5||z===6)u=u.stateNode,m?w.insertBefore(u,m):w.appendChild(u);else if(z!==4&&z!==27&&(u=u.child,u!==null))for(Is(u,m,w),u=u.sibling;u!==null;)Is(u,m,w),u=u.sibling}var Ol=!1,Va=!1,wu=!1,Dc=typeof WeakSet=="function"?WeakSet:Set,d=null,i=!1;function a(u,m){if(u=u.containerInfo,Lt=ya,u=Wf(u),fp(u)){if("selectionStart"in u)var w={start:u.selectionStart,end:u.selectionEnd};else e:{w=(w=u.ownerDocument)&&w.defaultView||window;var z=w.getSelection&&w.getSelection();if(z&&z.rangeCount!==0){w=z.anchorNode;var H=z.anchorOffset,J=z.focusNode;z=z.focusOffset;try{w.nodeType,J.nodeType}catch{w=null;break e}var Ae=0,Ke=-1,Ot=-1,_i=0,An=0,Zn=u,Ji=null;t:for(;;){for(var Sn;Zn!==w||H!==0&&Zn.nodeType!==3||(Ke=Ae+H),Zn!==J||z!==0&&Zn.nodeType!==3||(Ot=Ae+z),Zn.nodeType===3&&(Ae+=Zn.nodeValue.length),(Sn=Zn.firstChild)!==null;)Ji=Zn,Zn=Sn;for(;;){if(Zn===u)break t;if(Ji===w&&++_i===H&&(Ke=Ae),Ji===J&&++An===z&&(Ot=Ae),(Sn=Zn.nextSibling)!==null)break;Zn=Ji,Ji=Zn.parentNode}Zn=Sn}w=Ke===-1||Ot===-1?null:{start:Ke,end:Ot}}else w=null}w=w||{start:0,end:0}}else w=null;for(Bt={focusedElem:u,selectionRange:w},ya=!1,d=m;d!==null;)if(m=d,u=m.child,(m.subtreeFlags&1028)!==0&&u!==null)u.return=m,d=u;else for(;d!==null;){switch(m=d,J=m.alternate,u=m.flags,m.tag){case 0:break;case 11:case 15:break;case 1:if((u&1024)!==0&&J!==null){u=void 0,w=m,H=J.memoizedProps,J=J.memoizedState,z=w.stateNode;try{var ea=Cc(w.type,H,w.elementType===w.type);u=z.getSnapshotBeforeUpdate(ea,J),z.__reactInternalSnapshotBeforeUpdate=u}catch(Ua){Ns(w,w.return,Ua)}}break;case 3:if((u&1024)!==0){if(u=m.stateNode.containerInfo,w=u.nodeType,w===9)Zr(u);else if(w===1)switch(u.nodeName){case"HEAD":case"HTML":case"BODY":Zr(u);break;default:u.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((u&1024)!==0)throw Error(Ze(163))}if(u=m.sibling,u!==null){u.return=m.return,d=u;break}d=m.return}return ea=i,i=!1,ea}function f(u,m,w){var z=w.flags;switch(w.tag){case 0:case 11:case 15:fe(u,w),z&4&&So(5,w);break;case 1:if(fe(u,w),z&4)if(u=w.stateNode,m===null)try{u.componentDidMount()}catch(Ke){Ns(w,w.return,Ke)}else{var H=Cc(w.type,m.memoizedProps);m=m.memoizedState;try{u.componentDidUpdate(H,m,u.__reactInternalSnapshotBeforeUpdate)}catch(Ke){Ns(w,w.return,Ke)}}z&64&&xa(w),z&512&&yd(w,w.return);break;case 3:if(fe(u,w),z&64&&(z=w.updateQueue,z!==null)){if(u=null,w.child!==null)switch(w.child.tag){case 27:case 5:u=w.child.stateNode;break;case 1:u=w.child.stateNode}try{xu(z,u)}catch(Ke){Ns(w,w.return,Ke)}}break;case 26:fe(u,w),z&512&&yd(w,w.return);break;case 27:case 5:fe(u,w),m===null&&z&4&&bu(w),z&512&&yd(w,w.return);break;case 12:fe(u,w);break;case 13:fe(u,w),z&4&&V(u,w);break;case 22:if(H=w.memoizedState!==null||Ol,!H){m=m!==null&&m.memoizedState!==null||Va;var J=Ol,Ae=Va;Ol=H,(Va=m)&&!Ae?ke(u,w,(w.subtreeFlags&8772)!==0):fe(u,w),Ol=J,Va=Ae}z&512&&(w.memoizedProps.mode==="manual"?yd(w,w.return):Qo(w,w.return));break;default:fe(u,w)}}function v(u){var m=u.alternate;m!==null&&(u.alternate=null,v(m)),u.child=null,u.deletions=null,u.sibling=null,u.tag===5&&(m=u.stateNode,m!==null&&Gt(m)),u.stateNode=null,u.return=null,u.dependencies=null,u.memoizedProps=null,u.memoizedState=null,u.pendingProps=null,u.stateNode=null,u.updateQueue=null}var x=null,T=!1;function I(u,m,w){for(w=w.child;w!==null;)F(u,m,w),w=w.sibling}function F(u,m,w){if(ga&&typeof ga.onCommitFiberUnmount=="function")try{ga.onCommitFiberUnmount(Ma,w)}catch{}switch(w.tag){case 26:Va||Qo(w,m),I(u,m,w),w.memoizedState?w.memoizedState.count--:w.stateNode&&(w=w.stateNode,w.parentNode.removeChild(w));break;case 27:Va||Qo(w,m);var z=x,H=T;for(x=w.stateNode,I(u,m,w),w=w.stateNode,m=w.attributes;m.length;)w.removeAttributeNode(m[0]);Gt(w),x=z,T=H;break;case 5:Va||Qo(w,m);case 6:H=x;var J=T;if(x=null,I(u,m,w),x=H,T=J,x!==null)if(T)try{u=x,z=w.stateNode,u.nodeType===8?u.parentNode.removeChild(z):u.removeChild(z)}catch(Ae){Ns(w,m,Ae)}else try{x.removeChild(w.stateNode)}catch(Ae){Ns(w,m,Ae)}break;case 18:x!==null&&(T?(m=x,w=w.stateNode,m.nodeType===8?kr(m.parentNode,w):m.nodeType===1&&kr(m,w),dm(m)):kr(x,w.stateNode));break;case 4:z=x,H=T,x=w.stateNode.containerInfo,T=!0,I(u,m,w),x=z,T=H;break;case 0:case 11:case 14:case 15:Va||Kc(2,w,m),Va||Kc(4,w,m),I(u,m,w);break;case 1:Va||(Qo(w,m),z=w.stateNode,typeof z.componentWillUnmount=="function"&&ko(w,m,z)),I(u,m,w);break;case 21:I(u,m,w);break;case 22:Va||Qo(w,m),Va=(z=Va)||w.memoizedState!==null,I(u,m,w),Va=z;break;default:I(u,m,w)}}function V(u,m){if(m.memoizedState===null&&(u=m.alternate,u!==null&&(u=u.memoizedState,u!==null&&(u=u.dehydrated,u!==null))))try{dm(u)}catch(w){Ns(m,m.return,w)}}function j(u){switch(u.tag){case 13:case 19:var m=u.stateNode;return m===null&&(m=u.stateNode=new Dc),m;case 22:return u=u.stateNode,m=u._retryCache,m===null&&(m=u._retryCache=new Dc),m;default:throw Error(Ze(435,u.tag))}}function Z(u,m){var w=j(u);m.forEach(function(z){var H=Md.bind(null,u,z);w.has(z)||(w.add(z),z.then(H,H))})}function X(u,m){var w=m.deletions;if(w!==null)for(var z=0;z<w.length;z++){var H=w[z],J=u,Ae=m,Ke=Ae;e:for(;Ke!==null;){switch(Ke.tag){case 27:case 5:x=Ke.stateNode,T=!1;break e;case 3:x=Ke.stateNode.containerInfo,T=!0;break e;case 4:x=Ke.stateNode.containerInfo,T=!0;break e}Ke=Ke.return}if(x===null)throw Error(Ze(160));F(J,Ae,H),x=null,T=!1,J=H.alternate,J!==null&&(J.return=null),H.return=null}if(m.subtreeFlags&13878)for(m=m.child;m!==null;)le(m,u),m=m.sibling}var Q=null;function le(u,m){var w=u.alternate,z=u.flags;switch(u.tag){case 0:case 11:case 14:case 15:X(m,u),se(u),z&4&&(Kc(3,u,u.return),So(3,u),Kc(5,u,u.return));break;case 1:X(m,u),se(u),z&512&&(Va||w===null||Qo(w,w.return)),z&64&&Ol&&(u=u.updateQueue,u!==null&&(z=u.callbacks,z!==null&&(w=u.shared.hiddenCallbacks,u.shared.hiddenCallbacks=w===null?z:w.concat(z))));break;case 26:var H=Q;if(X(m,u),se(u),z&512&&(Va||w===null||Qo(w,w.return)),z&4){var J=w!==null?w.memoizedState:null;if(z=u.memoizedState,w===null)if(z===null)if(u.stateNode===null){e:{z=u.type,w=u.memoizedProps,H=H.ownerDocument||H;t:switch(z){case"title":J=H.getElementsByTagName("title")[0],(!J||J[Vt]||J[pe]||J.namespaceURI==="http://www.w3.org/2000/svg"||J.hasAttribute("itemprop"))&&(J=H.createElement(z),H.head.insertBefore(J,H.querySelector("head > title"))),st(J,z,w),J[pe]=u,zn(J),z=J;break e;case"link":var Ae=fc("link","href",H).get(z+(w.href||""));if(Ae){for(var Ke=0;Ke<Ae.length;Ke++)if(J=Ae[Ke],J.getAttribute("href")===(w.href==null?null:w.href)&&J.getAttribute("rel")===(w.rel==null?null:w.rel)&&J.getAttribute("title")===(w.title==null?null:w.title)&&J.getAttribute("crossorigin")===(w.crossOrigin==null?null:w.crossOrigin)){Ae.splice(Ke,1);break t}}J=H.createElement(z),st(J,z,w),H.head.appendChild(J);break;case"meta":if(Ae=fc("meta","content",H).get(z+(w.content||""))){for(Ke=0;Ke<Ae.length;Ke++)if(J=Ae[Ke],J.getAttribute("content")===(w.content==null?null:""+w.content)&&J.getAttribute("name")===(w.name==null?null:w.name)&&J.getAttribute("property")===(w.property==null?null:w.property)&&J.getAttribute("http-equiv")===(w.httpEquiv==null?null:w.httpEquiv)&&J.getAttribute("charset")===(w.charSet==null?null:w.charSet)){Ae.splice(Ke,1);break t}}J=H.createElement(z),st(J,z,w),H.head.appendChild(J);break;default:throw Error(Ze(468,z))}J[pe]=u,zn(J),z=J}u.stateNode=z}else um(H,u.type,u.stateNode);else u.stateNode=Qc(H,z,u.memoizedProps);else J!==z?(J===null?w.stateNode!==null&&(w=w.stateNode,w.parentNode.removeChild(w)):J.count--,z===null?um(H,u.type,u.stateNode):Qc(H,z,u.memoizedProps)):z===null&&u.stateNode!==null&&cl(u,u.memoizedProps,w.memoizedProps)}break;case 27:if(z&4&&u.alternate===null){H=u.stateNode,J=u.memoizedProps;try{for(var Ot=H.firstChild;Ot;){var _i=Ot.nextSibling,An=Ot.nodeName;Ot[Vt]||An==="HEAD"||An==="BODY"||An==="SCRIPT"||An==="STYLE"||An==="LINK"&&Ot.rel.toLowerCase()==="stylesheet"||H.removeChild(Ot),Ot=_i}for(var Zn=u.type,Ji=H.attributes;Ji.length;)H.removeAttributeNode(Ji[0]);st(H,Zn,J),H[pe]=u,H[Ce]=J}catch(ea){Ns(u,u.return,ea)}}case 5:if(X(m,u),se(u),z&512&&(Va||w===null||Qo(w,w.return)),u.flags&32){H=u.stateNode;try{yt(H,"")}catch(ea){Ns(u,u.return,ea)}}z&4&&u.stateNode!=null&&(H=u.memoizedProps,cl(u,H,w!==null?w.memoizedProps:H)),z&1024&&(wu=!0);break;case 6:if(X(m,u),se(u),z&4){if(u.stateNode===null)throw Error(Ze(162));z=u.memoizedProps,w=u.stateNode;try{w.nodeValue=z}catch(ea){Ns(u,u.return,ea)}}break;case 3:if(sp=null,H=Q,Q=ir(m.containerInfo),X(m,u),Q=H,se(u),z&4&&w!==null&&w.memoizedState.isDehydrated)try{dm(m.containerInfo)}catch(ea){Ns(u,u.return,ea)}wu&&(wu=!1,me(u));break;case 4:z=Q,Q=ir(u.stateNode.containerInfo),X(m,u),se(u),Q=z;break;case 12:X(m,u),se(u);break;case 13:X(m,u),se(u),u.child.flags&8192&&u.memoizedState!==null!=(w!==null&&w.memoizedState!==null)&&(tl=ii()),z&4&&(z=u.updateQueue,z!==null&&(u.updateQueue=null,Z(u,z)));break;case 22:if(z&512&&(Va||w===null||Qo(w,w.return)),Ot=u.memoizedState!==null,_i=w!==null&&w.memoizedState!==null,An=Ol,Zn=Va,Ol=An||Ot,Va=Zn||_i,X(m,u),Va=Zn,Ol=An,se(u),m=u.stateNode,m._current=u,m._visibility&=-3,m._visibility|=m._pendingVisibility&2,z&8192&&(m._visibility=Ot?m._visibility&-2:m._visibility|1,Ot&&(m=Ol||Va,w===null||_i||m||De(u)),u.memoizedProps===null||u.memoizedProps.mode!=="manual"))e:for(w=null,m=u;;){if(m.tag===5||m.tag===26||m.tag===27){if(w===null){_i=w=m;try{if(H=_i.stateNode,Ot)J=H.style,typeof J.setProperty=="function"?J.setProperty("display","none","important"):J.display="none";else{Ae=_i.stateNode,Ke=_i.memoizedProps.style;var Sn=Ke!=null&&Ke.hasOwnProperty("display")?Ke.display:null;Ae.style.display=Sn==null||typeof Sn=="boolean"?"":(""+Sn).trim()}}catch(ea){Ns(_i,_i.return,ea)}}}else if(m.tag===6){if(w===null){_i=m;try{_i.stateNode.nodeValue=Ot?"":_i.memoizedProps}catch(ea){Ns(_i,_i.return,ea)}}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===u)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===u)break e;for(;m.sibling===null;){if(m.return===null||m.return===u)break e;w===m&&(w=null),m=m.return}w===m&&(w=null),m.sibling.return=m.return,m=m.sibling}z&4&&(z=u.updateQueue,z!==null&&(w=z.retryQueue,w!==null&&(z.retryQueue=null,Z(u,w))));break;case 19:X(m,u),se(u),z&4&&(z=u.updateQueue,z!==null&&(u.updateQueue=null,Z(u,z)));break;case 21:break;default:X(m,u),se(u)}}function se(u){var m=u.flags;if(m&2){try{if(u.tag!==27){e:{for(var w=u.return;w!==null;){if(Pl(w)){var z=w;break e}w=w.return}throw Error(Ze(160))}switch(z.tag){case 27:var H=z.stateNode,J=io(u);Is(u,J,H);break;case 5:var Ae=z.stateNode;z.flags&32&&(yt(Ae,""),z.flags&=-33);var Ke=io(u);Is(u,Ke,Ae);break;case 3:case 4:var Ot=z.stateNode.containerInfo,_i=io(u);ho(u,_i,Ot);break;default:throw Error(Ze(161))}}}catch(An){Ns(u,u.return,An)}u.flags&=-3}m&4096&&(u.flags&=-4097)}function me(u){if(u.subtreeFlags&1024)for(u=u.child;u!==null;){var m=u;me(m),m.tag===5&&m.flags&1024&&m.stateNode.reset(),u=u.sibling}}function fe(u,m){if(m.subtreeFlags&8772)for(m=m.child;m!==null;)f(u,m.alternate,m),m=m.sibling}function De(u){for(u=u.child;u!==null;){var m=u;switch(m.tag){case 0:case 11:case 14:case 15:Kc(4,m,m.return),De(m);break;case 1:Qo(m,m.return);var w=m.stateNode;typeof w.componentWillUnmount=="function"&&ko(m,m.return,w),De(m);break;case 26:case 27:case 5:Qo(m,m.return),De(m);break;case 22:Qo(m,m.return),m.memoizedState===null&&De(m);break;default:De(m)}u=u.sibling}}function ke(u,m,w){for(w=w&&(m.subtreeFlags&8772)!==0,m=m.child;m!==null;){var z=m.alternate,H=u,J=m,Ae=J.flags;switch(J.tag){case 0:case 11:case 15:ke(H,J,w),So(4,J);break;case 1:if(ke(H,J,w),z=J,H=z.stateNode,typeof H.componentDidMount=="function")try{H.componentDidMount()}catch(_i){Ns(z,z.return,_i)}if(z=J,H=z.updateQueue,H!==null){var Ke=z.stateNode;try{var Ot=H.shared.hiddenCallbacks;if(Ot!==null)for(H.shared.hiddenCallbacks=null,H=0;H<Ot.length;H++)$c(Ot[H],Ke)}catch(_i){Ns(z,z.return,_i)}}w&&Ae&64&&xa(J),yd(J,J.return);break;case 26:case 27:case 5:ke(H,J,w),w&&z===null&&Ae&4&&bu(J),yd(J,J.return);break;case 12:ke(H,J,w);break;case 13:ke(H,J,w),w&&Ae&4&&V(H,J);break;case 22:J.memoizedState===null&&ke(H,J,w),yd(J,J.return);break;default:ke(H,J,w)}m=m.sibling}}function Ne(u,m){var w=null;u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(w=u.memoizedState.cachePool.pool),u=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(u=m.memoizedState.cachePool.pool),u!==w&&(u!=null&&u.refCount++,w!=null&&ou(w))}function tt(u,m){u=null,m.alternate!==null&&(u=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==u&&(m.refCount++,u!=null&&ou(u))}function He(u,m,w,z){if(m.subtreeFlags&10256)for(m=m.child;m!==null;)We(u,m,w,z),m=m.sibling}function We(u,m,w,z){var H=m.flags;switch(m.tag){case 0:case 11:case 15:He(u,m,w,z),H&2048&&So(9,m);break;case 3:He(u,m,w,z),H&2048&&(u=null,m.alternate!==null&&(u=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==u&&(m.refCount++,u!=null&&ou(u)));break;case 12:if(H&2048){He(u,m,w,z),u=m.stateNode;try{var J=m.memoizedProps,Ae=J.id,Ke=J.onPostCommit;typeof Ke=="function"&&Ke(Ae,m.alternate===null?"mount":"update",u.passiveEffectDuration,-0)}catch(Ot){Ns(m,m.return,Ot)}}else He(u,m,w,z);break;case 23:break;case 22:J=m.stateNode,m.memoizedState!==null?J._visibility&4?He(u,m,w,z):at(u,m):J._visibility&4?He(u,m,w,z):(J._visibility|=4,je(u,m,w,z,(m.subtreeFlags&10256)!==0)),H&2048&&Ne(m.alternate,m);break;case 24:He(u,m,w,z),H&2048&&tt(m.alternate,m);break;default:He(u,m,w,z)}}function je(u,m,w,z,H){for(H=H&&(m.subtreeFlags&10256)!==0,m=m.child;m!==null;){var J=u,Ae=m,Ke=w,Ot=z,_i=Ae.flags;switch(Ae.tag){case 0:case 11:case 15:je(J,Ae,Ke,Ot,H),So(8,Ae);break;case 23:break;case 22:var An=Ae.stateNode;Ae.memoizedState!==null?An._visibility&4?je(J,Ae,Ke,Ot,H):at(J,Ae):(An._visibility|=4,je(J,Ae,Ke,Ot,H)),H&&_i&2048&&Ne(Ae.alternate,Ae);break;case 24:je(J,Ae,Ke,Ot,H),H&&_i&2048&&tt(Ae.alternate,Ae);break;default:je(J,Ae,Ke,Ot,H)}m=m.sibling}}function at(u,m){if(m.subtreeFlags&10256)for(m=m.child;m!==null;){var w=u,z=m,H=z.flags;switch(z.tag){case 22:at(w,z),H&2048&&Ne(z.alternate,z);break;case 24:at(w,z),H&2048&&tt(z.alternate,z);break;default:at(w,z)}m=m.sibling}}var gt=8192;function Jt(u){if(u.subtreeFlags&gt)for(u=u.child;u!==null;)jt(u),u=u.sibling}function jt(u){switch(u.tag){case 26:Jt(u),u.flags&gt&&u.memoizedState!==null&&Am(Q,u.memoizedState,u.memoizedProps);break;case 5:Jt(u);break;case 3:case 4:var m=Q;Q=ir(u.stateNode.containerInfo),Jt(u),Q=m;break;case 22:u.memoizedState===null&&(m=u.alternate,m!==null&&m.memoizedState!==null?(m=gt,gt=16777216,Jt(u),gt=m):Jt(u));break;default:Jt(u)}}function fi(u){var m=u.alternate;if(m!==null&&(u=m.child,u!==null)){m.child=null;do m=u.sibling,u.sibling=null,u=m;while(u!==null)}}function ui(u){var m=u.deletions;if((u.flags&16)!==0){if(m!==null)for(var w=0;w<m.length;w++){var z=m[w];d=z,Ii(z,u)}fi(u)}if(u.subtreeFlags&10256)for(u=u.child;u!==null;)Pt(u),u=u.sibling}function Pt(u){switch(u.tag){case 0:case 11:case 15:ui(u),u.flags&2048&&Kc(9,u,u.return);break;case 3:ui(u);break;case 12:ui(u);break;case 22:var m=u.stateNode;u.memoizedState!==null&&m._visibility&4&&(u.return===null||u.return.tag!==13)?(m._visibility&=-5,Kt(u)):ui(u);break;default:ui(u)}}function Kt(u){var m=u.deletions;if((u.flags&16)!==0){if(m!==null)for(var w=0;w<m.length;w++){var z=m[w];d=z,Ii(z,u)}fi(u)}for(u=u.child;u!==null;){switch(m=u,m.tag){case 0:case 11:case 15:Kc(8,m,m.return),Kt(m);break;case 22:w=m.stateNode,w._visibility&4&&(w._visibility&=-5,Kt(m));break;default:Kt(m)}u=u.sibling}}function Ii(u,m){for(;d!==null;){var w=d;switch(w.tag){case 0:case 11:case 15:Kc(8,w,m);break;case 23:case 22:if(w.memoizedState!==null&&w.memoizedState.cachePool!==null){var z=w.memoizedState.cachePool.pool;z!=null&&z.refCount++}break;case 24:ou(w.memoizedState.cache)}if(z=w.child,z!==null)z.return=w,d=z;else e:for(w=u;d!==null;){z=d;var H=z.sibling,J=z.return;if(v(z),z===w){d=null;break e}if(H!==null){H.return=J,d=H;break e}d=J}}}function Et(u,m,w,z){this.tag=u,this.key=w,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=z,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function hi(u,m,w,z){return new Et(u,m,w,z)}function si(u){return u=u.prototype,!(!u||!u.isReactComponent)}function an(u,m){var w=u.alternate;return w===null?(w=hi(u.tag,m,u.key,u.mode),w.elementType=u.elementType,w.type=u.type,w.stateNode=u.stateNode,w.alternate=u,u.alternate=w):(w.pendingProps=m,w.type=u.type,w.flags=0,w.subtreeFlags=0,w.deletions=null),w.flags=u.flags&31457280,w.childLanes=u.childLanes,w.lanes=u.lanes,w.child=u.child,w.memoizedProps=u.memoizedProps,w.memoizedState=u.memoizedState,w.updateQueue=u.updateQueue,m=u.dependencies,w.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},w.sibling=u.sibling,w.index=u.index,w.ref=u.ref,w.refCleanup=u.refCleanup,w}function zi(u,m){u.flags&=31457282;var w=u.alternate;return w===null?(u.childLanes=0,u.lanes=m,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=w.childLanes,u.lanes=w.lanes,u.child=w.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=w.memoizedProps,u.memoizedState=w.memoizedState,u.updateQueue=w.updateQueue,u.type=w.type,m=w.dependencies,u.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext}),u}function yi(u,m,w,z,H,J){var Ae=0;if(z=u,typeof u=="function")si(u)&&(Ae=1);else if(typeof u=="string")Ae=Sm(u,w,jr.current)?26:u==="html"||u==="head"||u==="body"?27:5;else e:switch(u){case Ge:return Hi(w.children,H,J,m);case de:Ae=8,H|=24;break;case Je:return u=hi(12,w,m,H|2),u.elementType=Je,u.lanes=J,u;case qt:return u=hi(13,w,m,H),u.elementType=qt,u.lanes=J,u;case xi:return u=hi(19,w,m,H),u.elementType=xi,u.lanes=J,u;case ln:return en(w,H,J,m);default:if(typeof u=="object"&&u!==null)switch(u.$$typeof){case rt:case bi:Ae=10;break e;case ai:Ae=9;break e;case Ai:Ae=11;break e;case kt:Ae=14;break e;case Tt:Ae=16,z=null;break e}Ae=29,w=Error(Ze(130,u===null?"null":typeof u,"")),z=null}return m=hi(Ae,w,m,H),m.elementType=u,m.type=z,m.lanes=J,m}function Hi(u,m,w,z){return u=hi(7,u,z,m),u.lanes=w,u}function en(u,m,w,z){u=hi(22,u,z,m),u.elementType=ln,u.lanes=w;var H={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var J=H._current;if(J===null)throw Error(Ze(456));if((H._pendingVisibility&2)===0){var Ae=nc(J,2);Ae!==null&&(H._pendingVisibility|=2,Uo(Ae,J,2))}},attach:function(){var J=H._current;if(J===null)throw Error(Ze(456));if((H._pendingVisibility&2)!==0){var Ae=nc(J,2);Ae!==null&&(H._pendingVisibility&=-3,Uo(Ae,J,2))}}};return u.stateNode=H,u}function bn(u,m,w){return u=hi(6,u,null,m),u.lanes=w,u}function Un(u,m,w){return m=hi(4,u.children!==null?u.children:[],u.key,m),m.lanes=w,m.stateNode={containerInfo:u.containerInfo,pendingChildren:null,implementation:u.implementation},m}function fr(u){u.flags|=4}function ur(u,m){if(m.type!=="stylesheet"||(m.state.loading&4)!==0)u.flags&=-16777217;else if(u.flags|=16777216,!hm(m)){if(m=ml.current,m!==null&&((yr&4194176)===yr?bc!==null:(yr&62914560)!==yr&&(yr&536870912)===0||m!==bc))throw yf=gp,Fp;u.flags|=8192}}function lr(u,m){m!==null&&(u.flags|=4),u.flags&16384&&(m=u.tag!==22?Ls():536870912,u.lanes|=m,Os|=m)}function wr(u,m){if(!pa)switch(u.tailMode){case"hidden":m=u.tail;for(var w=null;m!==null;)m.alternate!==null&&(w=m),m=m.sibling;w===null?u.tail=null:w.sibling=null;break;case"collapsed":w=u.tail;for(var z=null;w!==null;)w.alternate!==null&&(z=w),w=w.sibling;z===null?m||u.tail===null?u.tail=null:u.tail.sibling=null:z.sibling=null}}function Tr(u){var m=u.alternate!==null&&u.alternate.child===u.child,w=0,z=0;if(m)for(var H=u.child;H!==null;)w|=H.lanes|H.childLanes,z|=H.subtreeFlags&31457280,z|=H.flags&31457280,H.return=u,H=H.sibling;else for(H=u.child;H!==null;)w|=H.lanes|H.childLanes,z|=H.subtreeFlags,z|=H.flags,H.return=u,H=H.sibling;return u.subtreeFlags|=z,u.childLanes=w,m}function za(u,m,w){var z=m.pendingProps;switch(gf(m),m.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Tr(m),null;case 1:return Tr(m),null;case 3:return w=m.stateNode,z=null,u!==null&&(z=u.memoizedState.cache),m.memoizedState.cache!==z&&(m.flags|=2048),zl(Ws),Ye(),w.pendingContext&&(w.context=w.pendingContext,w.pendingContext=null),(u===null||u.child===null)&&(_h(m)?fr(m):u===null||u.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,Ll!==null&&(qp(Ll),Ll=null))),Tr(m),null;case 26:return w=m.memoizedState,u===null?(fr(m),w!==null?(Tr(m),ur(m,w)):(Tr(m),m.flags&=-16777217)):w?w!==u.memoizedState?(fr(m),Tr(m),ur(m,w)):(Tr(m),m.flags&=-16777217):(u.memoizedProps!==z&&fr(m),Tr(m),m.flags&=-16777217),null;case 27:ft(m),w=ra.current;var H=m.type;if(u!==null&&m.stateNode!=null)u.memoizedProps!==z&&fr(m);else{if(!z){if(m.stateNode===null)throw Error(Ze(166));return Tr(m),null}u=jr.current,_h(m)?Xf(m):(u=xn(H,z,w),m.stateNode=u,fr(m))}return Tr(m),null;case 5:if(ft(m),w=m.type,u!==null&&m.stateNode!=null)u.memoizedProps!==z&&fr(m);else{if(!z){if(m.stateNode===null)throw Error(Ze(166));return Tr(m),null}if(u=jr.current,_h(m))Xf(m);else{switch(H=di(ra.current),u){case 1:u=H.createElementNS("http://www.w3.org/2000/svg",w);break;case 2:u=H.createElementNS("http://www.w3.org/1998/Math/MathML",w);break;default:switch(w){case"svg":u=H.createElementNS("http://www.w3.org/2000/svg",w);break;case"math":u=H.createElementNS("http://www.w3.org/1998/Math/MathML",w);break;case"script":u=H.createElement("div"),u.innerHTML="<script><\/script>",u=u.removeChild(u.firstChild);break;case"select":u=typeof z.is=="string"?H.createElement("select",{is:z.is}):H.createElement("select"),z.multiple?u.multiple=!0:z.size&&(u.size=z.size);break;default:u=typeof z.is=="string"?H.createElement(w,{is:z.is}):H.createElement(w)}}u[pe]=m,u[Ce]=z;e:for(H=m.child;H!==null;){if(H.tag===5||H.tag===6)u.appendChild(H.stateNode);else if(H.tag!==4&&H.tag!==27&&H.child!==null){H.child.return=H,H=H.child;continue}if(H===m)break e;for(;H.sibling===null;){if(H.return===null||H.return===m)break e;H=H.return}H.sibling.return=H.return,H=H.sibling}m.stateNode=u;e:switch(st(u,w,z),w){case"button":case"input":case"select":case"textarea":u=!!z.autoFocus;break e;case"img":u=!0;break e;default:u=!1}u&&fr(m)}}return Tr(m),m.flags&=-16777217,null;case 6:if(u&&m.stateNode!=null)u.memoizedProps!==z&&fr(m);else{if(typeof z!="string"&&m.stateNode===null)throw Error(Ze(166));if(u=ra.current,_h(m)){if(u=m.stateNode,w=m.memoizedProps,z=null,H=ls,H!==null)switch(H.tag){case 27:case 5:z=H.memoizedProps}u[pe]=m,u=!!(u.nodeValue===w||z!==null&&z.suppressHydrationWarning===!0||ye(u.nodeValue,w)),u||au(m)}else u=di(u).createTextNode(z),u[pe]=m,m.stateNode=u}return Tr(m),null;case 13:if(z=m.memoizedState,u===null||u.memoizedState!==null&&u.memoizedState.dehydrated!==null){if(H=_h(m),z!==null&&z.dehydrated!==null){if(u===null){if(!H)throw Error(Ze(318));if(H=m.memoizedState,H=H!==null?H.dehydrated:null,!H)throw Error(Ze(317));H[pe]=m}else Pd(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;Tr(m),H=!1}else Ll!==null&&(qp(Ll),Ll=null),H=!0;if(!H)return m.flags&256?(Uu(m),m):(Uu(m),null)}if(Uu(m),(m.flags&128)!==0)return m.lanes=w,m;if(w=z!==null,u=u!==null&&u.memoizedState!==null,w){z=m.child,H=null,z.alternate!==null&&z.alternate.memoizedState!==null&&z.alternate.memoizedState.cachePool!==null&&(H=z.alternate.memoizedState.cachePool.pool);var J=null;z.memoizedState!==null&&z.memoizedState.cachePool!==null&&(J=z.memoizedState.cachePool.pool),J!==H&&(z.flags|=2048)}return w!==u&&w&&(m.child.flags|=8192),lr(m,m.updateQueue),Tr(m),null;case 4:return Ye(),u===null&&S(m.stateNode.containerInfo),Tr(m),null;case 10:return zl(m.type),Tr(m),null;case 19:if(vr(Bo),H=m.memoizedState,H===null)return Tr(m),null;if(z=(m.flags&128)!==0,J=H.rendering,J===null)if(z)wr(H,!1);else{if(da!==0||u!==null&&(u.flags&128)!==0)for(u=m.child;u!==null;){if(J=kd(u),J!==null){for(m.flags|=128,wr(H,!1),u=J.updateQueue,m.updateQueue=u,lr(m,u),m.subtreeFlags=0,u=w,w=m.child;w!==null;)zi(w,u),w=w.sibling;return et(Bo,Bo.current&1|2),m.child}u=u.sibling}H.tail!==null&&ii()>No&&(m.flags|=128,z=!0,wr(H,!1),m.lanes=4194304)}else{if(!z)if(u=kd(J),u!==null){if(m.flags|=128,z=!0,u=u.updateQueue,m.updateQueue=u,lr(m,u),wr(H,!0),H.tail===null&&H.tailMode==="hidden"&&!J.alternate&&!pa)return Tr(m),null}else 2*ii()-H.renderingStartTime>No&&w!==536870912&&(m.flags|=128,z=!0,wr(H,!1),m.lanes=4194304);H.isBackwards?(J.sibling=m.child,m.child=J):(u=H.last,u!==null?u.sibling=J:m.child=J,H.last=J)}return H.tail!==null?(m=H.tail,H.rendering=m,H.tail=m.sibling,H.renderingStartTime=ii(),m.sibling=null,u=Bo.current,et(Bo,z?u&1|2:u&1),m):(Tr(m),null);case 22:case 23:return Uu(m),Fd(),z=m.memoizedState!==null,u!==null?u.memoizedState!==null!==z&&(m.flags|=8192):z&&(m.flags|=8192),z?(w&536870912)!==0&&(m.flags&128)===0&&(Tr(m),m.subtreeFlags&6&&(m.flags|=8192)):Tr(m),w=m.updateQueue,w!==null&&lr(m,w.retryQueue),w=null,u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(w=u.memoizedState.cachePool.pool),z=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(z=m.memoizedState.cachePool.pool),z!==w&&(m.flags|=2048),u!==null&&vr(kn),null;case 24:return w=null,u!==null&&(w=u.memoizedState.cache),m.memoizedState.cache!==w&&(m.flags|=2048),zl(Ws),Tr(m),null;case 25:return null}throw Error(Ze(156,m.tag))}function Ss(u,m){switch(gf(m),m.tag){case 1:return u=m.flags,u&65536?(m.flags=u&-65537|128,m):null;case 3:return zl(Ws),Ye(),u=m.flags,(u&65536)!==0&&(u&128)===0?(m.flags=u&-65537|128,m):null;case 26:case 27:case 5:return ft(m),null;case 13:if(Uu(m),u=m.memoizedState,u!==null&&u.dehydrated!==null){if(m.alternate===null)throw Error(Ze(340));Pd()}return u=m.flags,u&65536?(m.flags=u&-65537|128,m):null;case 19:return vr(Bo),null;case 4:return Ye(),null;case 10:return zl(m.type),null;case 22:case 23:return Uu(m),Fd(),u!==null&&vr(kn),u=m.flags,u&65536?(m.flags=u&-65537|128,m):null;case 24:return zl(Ws),null;case 25:return null;default:return null}}function qa(u,m){switch(gf(m),m.tag){case 3:zl(Ws),Ye();break;case 26:case 27:case 5:ft(m);break;case 4:Ye();break;case 13:Uu(m);break;case 19:vr(Bo);break;case 10:zl(m.type);break;case 22:case 23:Uu(m),Fd(),u!==null&&vr(kn);break;case 24:zl(Ws)}}var Pr={getCacheForType:function(u){var m=yl(Ws),w=m.data.get(u);return w===void 0&&(w=u(),m.data.set(u,w)),w}},ba=typeof WeakMap=="function"?WeakMap:Map,In=0,_r=null,pr=null,yr=0,Jr=0,is=null,ns=!1,Es=!1,el=!1,Ps=0,da=0,Pa=0,Sa=0,ha=0,Xa=0,Os=0,Oa=null,ks=null,ul=!1,tl=0,No=1/0,$l=null,Eo=null,hl=!1,Kl=null,Bl=0,Mu=0,Jl=null,Qu=0,Lf=null;function il(){if((In&2)!==0&&yr!==0)return yr&-yr;if(Fi.T!==null){var u=Vc;return u!==0?u:Bf()}return Io()}function Hp(){Xa===0&&(Xa=(yr&536870912)===0||pa?Lo():536870912);var u=ml.current;return u!==null&&(u.flags|=32),Xa}function Uo(u,m,w){(u===_r&&Jr===2||u.cancelPendingCommit!==null)&&(Fh(u,0),eh(u,yr,Xa,!1)),es(u,w),((In&2)===0||u!==_r)&&(u===_r&&((In&2)===0&&(Sa|=w),da===4&&eh(u,yr,Xa,!1)),zc(u))}function jp(u,m,w){if((In&6)!==0)throw Error(Ze(327));var z=!w&&(m&60)===0&&(m&u.expiredLanes)===0||gs(u,m),H=z?Mp(u,m):om(u,m,!0),J=z;do{if(H===0){Es&&!z&&eh(u,m,0,!1);break}else if(H===6)eh(u,m,0,!ns);else{if(w=u.current.alternate,J&&!am(w)){H=om(u,m,!1),J=!1;continue}if(H===2){if(J=m,u.errorRecoveryDisabledLanes&J)var Ae=0;else Ae=u.pendingLanes&-536870913,Ae=Ae!==0?Ae:Ae&536870912?536870912:0;if(Ae!==0){m=Ae;e:{var Ke=u;H=Oa;var Ot=Ke.current.memoizedState.isDehydrated;if(Ot&&(Fh(Ke,Ae).flags|=256),Ae=om(Ke,Ae,!1),Ae!==2){if(el&&!Ot){Ke.errorRecoveryDisabledLanes|=J,Sa|=J,H=4;break e}J=ks,ks=H,J!==null&&qp(J)}H=Ae}if(J=!1,H!==2)continue}}if(H===1){Fh(u,0),eh(u,m,0,!0);break}e:{switch(z=u,H){case 0:case 1:throw Error(Ze(345));case 4:if((m&4194176)===m){eh(z,m,Xa,!ns);break e}break;case 2:ks=null;break;case 3:case 5:break;default:throw Error(Ze(329))}if(z.finishedWork=w,z.finishedLanes=m,(m&62914560)===m&&(J=tl+300-ii(),10<J)){if(eh(z,m,Xa,!ns),qr(z,0)!==0)break e;z.timeoutHandle=Gn(vd.bind(null,z,w,ks,$l,ul,m,Xa,Sa,Os,ns,2,-0,0),J);break e}vd(z,w,ks,$l,ul,m,Xa,Sa,Os,ns,0,-0,0)}}break}while(!0);zc(u)}function qp(u){ks===null?ks=u:ks.push.apply(ks,u)}function vd(u,m,w,z,H,J,Ae,Ke,Ot,_i,An,Zn,Ji){var Sn=m.subtreeFlags;if((Sn&8192||(Sn&16785408)===16785408)&&(Ff={stylesheets:null,count:0,unsuspend:Em},jt(m),m=kf(),m!==null)){u.cancelPendingCommit=m(cm.bind(null,u,w,z,H,Ae,Ke,Ot,1,Zn,Ji)),eh(u,J,Ae,!_i);return}cm(u,w,z,H,Ae,Ke,Ot,An,Zn,Ji)}function am(u){for(var m=u;;){var w=m.tag;if((w===0||w===11||w===15)&&m.flags&16384&&(w=m.updateQueue,w!==null&&(w=w.stores,w!==null)))for(var z=0;z<w.length;z++){var H=w[z],J=H.getSnapshot;H=H.value;try{if(!Kr(J(),H))return!1}catch{return!1}}if(w=m.child,m.subtreeFlags&16384&&w!==null)w.return=m,m=w;else{if(m===u)break;for(;m.sibling===null;){if(m.return===null||m.return===u)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function eh(u,m,w,z){m&=~ha,m&=~Sa,u.suspendedLanes|=m,u.pingedLanes&=~m,z&&(u.warmLanes|=m),z=u.expirationTimes;for(var H=m;0<H;){var J=31-dn(H),Ae=1<<J;z[J]=-1,H&=~Ae}w!==0&&Js(u,w,m)}function wp(){return(In&6)===0?(rp(0),!1):!0}function Wp(){if(pr!==null){if(Jr===0)var u=pr.return;else u=pr,Yo=gu=null,ju(u),yh=null,vh=0,u=pr;for(;u!==null;)qa(u.alternate,u),u=u.return;pr=null}}function Fh(u,m){u.finishedWork=null,u.finishedLanes=0;var w=u.timeoutHandle;w!==-1&&(u.timeoutHandle=-1,gn(w)),w=u.cancelPendingCommit,w!==null&&(u.cancelPendingCommit=null,w()),Wp(),_r=u,pr=w=an(u.current,null),yr=m,Jr=0,is=null,ns=!1,Es=gs(u,m),el=!1,Os=Xa=ha=Sa=Pa=da=0,ks=Oa=null,ul=!1,(m&8)!==0&&(m|=m&32);var z=u.entangledLanes;if(z!==0)for(u=u.entanglements,z&=m;0<z;){var H=31-dn(z),J=1<<H;m|=u[H],z&=~J}return Ps=m,ru(),w}function xd(u,m){un=null,Fi.H=To,m===su?(m=Kf(),Jr=3):m===Fp?(m=Kf(),Jr=4):Jr=m===Lc?8:m!==null&&typeof m=="object"&&typeof m.then=="function"?6:1,is=m,pr===null&&(da=1,pd(u,rc(m,u.current)))}function Vo(){var u=Fi.H;return Fi.H=To,u===null?To:u}function sm(){var u=Fi.A;return Fi.A=Pr,u}function Rf(){da=4,ns||(yr&4194176)!==yr&&ml.current!==null||(Es=!0),(Pa&134217727)===0&&(Sa&134217727)===0||_r===null||eh(_r,yr,Xa,!1)}function om(u,m,w){var z=In;In|=2;var H=Vo(),J=sm();(_r!==u||yr!==m)&&($l=null,Fh(u,m)),m=!1;var Ae=da;e:do try{if(Jr!==0&&pr!==null){var Ke=pr,Ot=is;switch(Jr){case 8:Wp(),Ae=6;break e;case 3:case 2:case 6:ml.current===null&&(m=!0);var _i=Jr;if(Jr=0,is=null,If(u,Ke,Ot,_i),w&&Es){Ae=0;break e}break;default:_i=Jr,Jr=0,is=null,If(u,Ke,Ot,_i)}}jm(),Ae=da;break}catch(An){xd(u,An)}while(!0);return m&&u.shellSuspendCounter++,Yo=gu=null,In=z,Fi.H=H,Fi.A=J,pr===null&&(_r=null,yr=0,ru()),Ae}function jm(){for(;pr!==null;)bd(pr)}function Mp(u,m){var w=In;In|=2;var z=Vo(),H=sm();_r!==u||yr!==m?($l=null,No=ii()+500,Fh(u,m)):Es=gs(u,m);e:do try{if(Jr!==0&&pr!==null){m=pr;var J=is;t:switch(Jr){case 1:Jr=0,is=null,If(u,m,J,1);break;case 2:if(kp(J)){Jr=0,is=null,np(m);break}m=function(){Jr===2&&_r===u&&(Jr=7),zc(u)},J.then(m,m);break e;case 3:Jr=7;break e;case 4:Jr=5;break e;case 7:kp(J)?(Jr=0,is=null,np(m)):(Jr=0,is=null,If(u,m,J,7));break;case 5:var Ae=null;switch(pr.tag){case 26:Ae=pr.memoizedState;case 5:case 27:var Ke=pr;if(!Ae||hm(Ae)){Jr=0,is=null;var Ot=Ke.sibling;if(Ot!==null)pr=Ot;else{var _i=Ke.return;_i!==null?(pr=_i,Df(_i)):pr=null}break t}}Jr=0,is=null,If(u,m,J,5);break;case 6:Jr=0,is=null,If(u,m,J,6);break;case 8:Wp(),da=6;break e;default:throw Error(Ze(462))}}ms();break}catch(An){xd(u,An)}while(!0);return Yo=gu=null,Fi.H=z,Fi.A=H,In=w,pr!==null?0:(_r=null,yr=0,ru(),da)}function ms(){for(;pr!==null&&!li();)bd(pr)}function bd(u){var m=rf(u.alternate,u,Ps);u.memoizedProps=u.pendingProps,m===null?Df(u):pr=m}function np(u){var m=u,w=m.alternate;switch(m.tag){case 15:case 0:m=gd(w,m,m.pendingProps,m.type,void 0,yr);break;case 11:m=gd(w,m,m.pendingProps,m.type.render,m.ref,yr);break;case 5:ju(m);default:qa(w,m),m=pr=zi(m,Ps),m=rf(w,m,Ps)}u.memoizedProps=u.pendingProps,m===null?Df(u):pr=m}function If(u,m,w,z){Yo=gu=null,ju(m),yh=null,vh=0;var H=m.return;try{if(md(u,H,m,w,yr)){da=1,pd(u,rc(w,u.current)),pr=null;return}}catch(J){if(H!==null)throw pr=H,J;da=1,pd(u,rc(w,u.current)),pr=null;return}m.flags&32768?(pa||z===1?u=!0:Es||(yr&536870912)!==0?u=!1:(ns=u=!0,(z===2||z===3||z===6)&&(z=ml.current,z!==null&&z.tag===13&&(z.flags|=16384))),lm(m,u)):Df(m)}function Df(u){var m=u;do{if((m.flags&32768)!==0){lm(m,ns);return}u=m.return;var w=za(m.alternate,m,Ps);if(w!==null){pr=w;return}if(m=m.sibling,m!==null){pr=m;return}pr=m=u}while(m!==null);da===0&&(da=5)}function lm(u,m){do{var w=Ss(u.alternate,u);if(w!==null){w.flags&=32767,pr=w;return}if(w=u.return,w!==null&&(w.flags|=32768,w.subtreeFlags=0,w.deletions=null),!m&&(u=u.sibling,u!==null)){pr=u;return}pr=u=w}while(u!==null);da=6,pr=null}function cm(u,m,w,z,H,J,Ae,Ke,Ot,_i){var An=Fi.T,Zn=pt.p;try{pt.p=2,Fi.T=null,wm(u,m,w,z,Zn,H,J,Ae,Ke,Ot,_i)}finally{Fi.T=An,pt.p=Zn}}function wm(u,m,w,z,H,J,Ae,Ke){do zf();while(Kl!==null);if((In&6)!==0)throw Error(Ze(327));var Ot=u.finishedWork;if(z=u.finishedLanes,Ot===null)return null;if(u.finishedWork=null,u.finishedLanes=0,Ot===u.current)throw Error(Ze(177));u.callbackNode=null,u.callbackPriority=0,u.cancelPendingCommit=null;var _i=Ot.lanes|Ot.childLanes;if(_i|=Bu,Ks(u,z,_i,J,Ae,Ke),u===_r&&(pr=_r=null,yr=0),(Ot.subtreeFlags&10256)===0&&(Ot.flags&10256)===0||hl||(hl=!0,Mu=_i,Jl=w,Pf(cr,function(){return zf(),null})),w=(Ot.flags&15990)!==0,(Ot.subtreeFlags&15990)!==0||w?(w=Fi.T,Fi.T=null,J=pt.p,pt.p=2,Ae=In,In|=4,a(u,Ot),le(Ot,u),Bp(Bt,u.containerInfo),ya=!!Lt,Bt=Lt=null,u.current=Ot,f(u,Ot.alternate,Ot),$t(),In=Ae,pt.p=J,Fi.T=w):u.current=Ot,hl?(hl=!1,Kl=u,Bl=z):Zp(u,_i),_i=u.pendingLanes,_i===0&&(Eo=null),oo(Ot.stateNode),zc(u),m!==null)for(H=u.onRecoverableError,Ot=0;Ot<m.length;Ot++)_i=m[Ot],H(_i.value,{componentStack:_i.stack});return(Bl&3)!==0&&zf(),_i=u.pendingLanes,(z&4194218)!==0&&(_i&42)!==0?u===Lf?Qu++:(Qu=0,Lf=u):Qu=0,rp(0),null}function Zp(u,m){(u.pooledCacheLanes&=m)===0&&(m=u.pooledCache,m!=null&&(u.pooledCache=null,ou(m)))}function zf(){if(Kl!==null){var u=Kl,m=Mu;Mu=0;var w=xs(Bl),z=Fi.T,H=pt.p;try{if(pt.p=32>w?32:w,Fi.T=null,Kl===null)var J=!1;else{w=Jl,Jl=null;var Ae=Kl,Ke=Bl;if(Kl=null,Bl=0,(In&6)!==0)throw Error(Ze(331));var Ot=In;if(In|=4,Pt(Ae.current),We(Ae,Ae.current,Ke,w),In=Ot,rp(0,!1),ga&&typeof ga.onPostCommitFiberRoot=="function")try{ga.onPostCommitFiberRoot(Ma,Ae)}catch{}J=!0}return J}finally{pt.p=H,Fi.T=z,Zp(u,m)}}return!1}function wd(u,m,w){m=rc(w,m),m=Ph(u.stateNode,m,2),u=yu(u,m,2),u!==null&&(es(u,2),zc(u))}function Ns(u,m,w){if(u.tag===3)wd(u,u,w);else for(;m!==null;){if(m.tag===3){wd(m,u,w);break}else if(m.tag===1){var z=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof z.componentDidCatch=="function"&&(Eo===null||!Eo.has(z))){u=rc(w,u),w=Oh(2),z=yu(m,w,2),z!==null&&(mu(w,z,m,u),es(z,2),zc(z));break}}m=m.return}}function th(u,m,w){var z=u.pingCache;if(z===null){z=u.pingCache=new ba;var H=new Set;z.set(m,H)}else H=z.get(m),H===void 0&&(H=new Set,z.set(m,H));H.has(w)||(el=!0,H.add(w),u=Mm.bind(null,u,m,w),m.then(u,u))}function Mm(u,m,w){var z=u.pingCache;z!==null&&z.delete(m),u.pingedLanes|=u.suspendedLanes&w,u.warmLanes&=~w,_r===u&&(yr&w)===w&&(da===4||da===3&&(yr&62914560)===yr&&300>ii()-tl?(In&2)===0&&Fh(u,0):ha|=w,Os===yr&&(Os=0)),zc(u)}function no(u,m){m===0&&(m=Ls()),u=nc(u,m),u!==null&&(es(u,m),zc(u))}function Tp(u){var m=u.memoizedState,w=0;m!==null&&(w=m.retryLane),no(u,w)}function Md(u,m){var w=0;switch(u.tag){case 13:var z=u.stateNode,H=u.memoizedState;H!==null&&(w=H.retryLane);break;case 19:z=u.stateNode;break;case 22:z=u.stateNode._retryCache;break;default:throw Error(Ze(314))}z!==null&&z.delete(m),no(u,w)}function Pf(u,m){return Rt(u,m)}var Td=null,ih=null,Sp=!1,Ep=!1,sf=!1,kh=0;function zc(u){u!==ih&&u.next===null&&(ih===null?Td=ih=u:ih=ih.next=u),Ep=!0,Sp||(Sp=!0,Ao(Ap))}function rp(u,m){if(!sf&&Ep){sf=!0;do for(var w=!1,z=Td;z!==null;){if(u!==0){var H=z.pendingLanes;if(H===0)var J=0;else{var Ae=z.suspendedLanes,Ke=z.pingedLanes;J=(1<<31-dn(42|u)+1)-1,J&=H&~(Ae&~Ke),J=J&201326677?J&201326677|1:J?J|2:0}J!==0&&(w=!0,ro(z,J))}else J=yr,J=qr(z,z===_r?J:0),(J&3)===0||gs(z,J)||(w=!0,ro(z,J));z=z.next}while(w);sf=!1}}function Ap(){Ep=Sp=!1;var u=0;kh!==0&&(hr()&&(u=kh),kh=0);for(var m=ii(),w=null,z=Td;z!==null;){var H=z.next,J=Cp(z,m);J===0?(z.next=null,w===null?Td=H:w.next=H,H===null&&(ih=w)):(w=z,(u!==0||(J&3)!==0)&&(Ep=!0)),z=H}rp(u)}function Cp(u,m){for(var w=u.suspendedLanes,z=u.pingedLanes,H=u.expirationTimes,J=u.pendingLanes&-62914561;0<J;){var Ae=31-dn(J),Ke=1<<Ae,Ot=H[Ae];Ot===-1?((Ke&w)===0||(Ke&z)!==0)&&(H[Ae]=$s(Ke,m)):Ot<=m&&(u.expiredLanes|=Ke),J&=~Ke}if(m=_r,w=yr,w=qr(u,u===m?w:0),z=u.callbackNode,w===0||u===m&&Jr===2||u.cancelPendingCommit!==null)return z!==null&&z!==null&&Ut(z),u.callbackNode=null,u.callbackPriority=0;if((w&3)===0||gs(u,w)){if(m=w&-w,m===u.callbackPriority)return m;switch(z!==null&&Ut(z),xs(w)){case 2:case 8:w=gr;break;case 32:w=cr;break;case 268435456:w=Er;break;default:w=cr}return z=Of.bind(null,u),w=Rt(w,z),u.callbackPriority=m,u.callbackNode=w,m}return z!==null&&z!==null&&Ut(z),u.callbackPriority=2,u.callbackNode=null,2}function Of(u,m){var w=u.callbackNode;if(zf()&&u.callbackNode!==w)return null;var z=yr;return z=qr(u,u===_r?z:0),z===0?null:(jp(u,z,m),Cp(u,ii()),u.callbackNode!=null&&u.callbackNode===w?Of.bind(null,u):null)}function ro(u,m){if(zf())return null;jp(u,m,!0)}function Ao(u){Mr(function(){(In&6)!==0?Rt(wn,u):u()})}function Bf(){return kh===0&&(kh=Lo()),kh}function Xp(u){return u==null||typeof u=="symbol"||typeof u=="boolean"?null:typeof u=="function"?u:we(""+u)}function Yp(u,m){var w=m.ownerDocument.createElement("input");return w.name=m.name,w.value=m.value,u.id&&w.setAttribute("form",u.id),m.parentNode.insertBefore(w,m),u=new FormData(u),w.parentNode.removeChild(w),u}function ap(u,m,w,z,H){if(m==="submit"&&w&&w.stateNode===H){var J=Xp((H[Ce]||null).action),Ae=z.submitter;Ae&&(m=(m=Ae[Ce]||null)?Xp(m.formAction):Ae.getAttribute("formAction"),m!==null&&(J=m,Ae=null));var Ke=new On("action","action",null,z,H);u.push({event:Ke,listeners:[{instance:null,listener:function(){if(z.defaultPrevented){if(kh!==0){var Ot=Ae?Yp(H,Ae):new FormData(H);Fo(w,{pending:!0,data:Ot,method:H.method,action:J},null,Ot)}}else typeof J=="function"&&(Ke.preventDefault(),Ot=Ae?Yp(H,Ae):new FormData(H),Fo(w,{pending:!0,data:Ot,method:H.method,action:J},J,Ot))},currentTarget:H}]})}}for(var Pc=0;Pc<Dd.length;Pc++){var Lp=Dd[Pc],Tm=Lp.toLowerCase(),qm=Lp[0].toUpperCase()+Lp.slice(1);pl(Tm,"on"+qm)}pl(dh,"onAnimationEnd"),pl(qh,"onAnimationIteration"),pl(Wh,"onAnimationStart"),pl("dblclick","onDoubleClick"),pl("focusin","onFocus"),pl("focusout","onBlur"),pl(Vl,"onTransitionRun"),pl(Pu,"onTransitionStart"),pl(Zf,"onTransitionCancel"),pl(Ou,"onTransitionEnd"),Rr("onMouseEnter",["mouseout","mouseover"]),Rr("onMouseLeave",["mouseout","mouseover"]),Rr("onPointerEnter",["pointerout","pointerover"]),Rr("onPointerLeave",["pointerout","pointerover"]),Wn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Wn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Wn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Wn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Wn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Wn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),E=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Rp));function e(u,m){m=(m&4)!==0;for(var w=0;w<u.length;w++){var z=u[w],H=z.event;z=z.listeners;e:{var J=void 0;if(m)for(var Ae=z.length-1;0<=Ae;Ae--){var Ke=z[Ae],Ot=Ke.instance,_i=Ke.currentTarget;if(Ke=Ke.listener,Ot!==J&&H.isPropagationStopped())break e;J=Ke,H.currentTarget=_i;try{J(H)}catch(An){Wc(An)}H.currentTarget=null,J=Ot}else for(Ae=0;Ae<z.length;Ae++){if(Ke=z[Ae],Ot=Ke.instance,_i=Ke.currentTarget,Ke=Ke.listener,Ot!==J&&H.isPropagationStopped())break e;J=Ke,H.currentTarget=_i;try{J(H)}catch(An){Wc(An)}H.currentTarget=null,J=Ot}}}}function l(u,m){var w=m[Qe];w===void 0&&(w=m[Qe]=new Set);var z=u+"__bubble";w.has(z)||(O(m,u,2,!1),w.add(z))}function _(u,m,w){var z=0;m&&(z|=4),O(w,u,z,m)}var y="_reactListening"+Math.random().toString(36).slice(2);function S(u){if(!u[y]){u[y]=!0,jn.forEach(function(w){w!=="selectionchange"&&(E.has(w)||_(w,!1,u),_(w,!0,u))});var m=u.nodeType===9?u:u.ownerDocument;m===null||m[y]||(m[y]=!0,_("selectionchange",!1,m))}}function O(u,m,w,z){switch(La(m)){case 2:var H=Xr;break;case 8:H=Aa;break;default:H=Ga}w=H.bind(null,m,w,u),H=void 0,!Ft||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||(H=!0),z?H!==void 0?u.addEventListener(m,w,{capture:!0,passive:H}):u.addEventListener(m,w,!0):H!==void 0?u.addEventListener(m,w,{passive:H}):u.addEventListener(m,w,!1)}function k(u,m,w,z,H){var J=z;if((m&1)===0&&(m&2)===0&&z!==null)e:for(;;){if(z===null)return;var Ae=z.tag;if(Ae===3||Ae===4){var Ke=z.stateNode.containerInfo;if(Ke===H||Ke.nodeType===8&&Ke.parentNode===H)break;if(Ae===4)for(Ae=z.return;Ae!==null;){var Ot=Ae.tag;if((Ot===3||Ot===4)&&(Ot=Ae.stateNode.containerInfo,Ot===H||Ot.nodeType===8&&Ot.parentNode===H))return;Ae=Ae.return}for(;Ke!==null;){if(Ae=Wt(Ke),Ae===null)return;if(Ot=Ae.tag,Ot===5||Ot===6||Ot===26||Ot===27){z=J=Ae;continue e}Ke=Ke.parentNode}}z=z.return}Jn(function(){var _i=J,An=Ee(w),Zn=[];e:{var Ji=Zh.get(u);if(Ji!==void 0){var Sn=On,ea=u;switch(u){case"keypress":if(Ar(w)===0)break e;case"keydown":case"keyup":Sn=ps;break;case"focusin":ea="focus",Sn=_a;break;case"focusout":ea="blur",Sn=_a;break;case"beforeblur":case"afterblur":Sn=_a;break;case"click":if(w.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Sn=Fs;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Sn=al;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Sn=Vh;break;case dh:case qh:case Wh:Sn=or;break;case Ou:Sn=oh;break;case"scroll":case"scrollend":Sn=$r;break;case"wheel":Sn=Gh;break;case"copy":case"cut":case"paste":Sn=Cu;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Sn=Rd;break;case"toggle":case"beforetoggle":Sn=lh}var Ua=(m&4)!==0,Go=!Ua&&(u==="scroll"||u==="scrollend"),Li=Ua?Ji!==null?Ji+"Capture":null:Ji;Ua=[];for(var pi=_i,Gi;pi!==null;){var Vn=pi;if(Gi=Vn.stateNode,Vn=Vn.tag,Vn!==5&&Vn!==26&&Vn!==27||Gi===null||Li===null||(Vn=on(pi,Li),Vn!=null&&Ua.push(N(pi,Vn,Gi))),Go)break;pi=pi.return}0<Ua.length&&(Ji=new Sn(Ji,ea,null,w,An),Zn.push({event:Ji,listeners:Ua}))}}if((m&7)===0){e:{if(Ji=u==="mouseover"||u==="pointerover",Sn=u==="mouseout"||u==="pointerout",Ji&&w!==Ve&&(ea=w.relatedTarget||w.fromElement)&&(Wt(ea)||ea[qe]))break e;if((Sn||Ji)&&(Ji=An.window===An?An:(Ji=An.ownerDocument)?Ji.defaultView||Ji.parentWindow:window,Sn?(ea=w.relatedTarget||w.toElement,Sn=_i,ea=ea?Wt(ea):null,ea!==null&&(Go=Re(ea),Ua=ea.tag,ea!==Go||Ua!==5&&Ua!==27&&Ua!==6)&&(ea=null)):(Sn=null,ea=_i),Sn!==ea)){if(Ua=Fs,Vn="onMouseLeave",Li="onMouseEnter",pi="mouse",(u==="pointerout"||u==="pointerover")&&(Ua=Rd,Vn="onPointerLeave",Li="onPointerEnter",pi="pointer"),Go=Sn==null?Ji:Qi(Sn),Gi=ea==null?Ji:Qi(ea),Ji=new Ua(Vn,pi+"leave",Sn,w,An),Ji.target=Go,Ji.relatedTarget=Gi,Vn=null,Wt(An)===_i&&(Ua=new Ua(Li,pi+"enter",ea,w,An),Ua.target=Gi,Ua.relatedTarget=Go,Vn=Ua),Go=Vn,Sn&&ea)t:{for(Ua=Sn,Li=ea,pi=0,Gi=Ua;Gi;Gi=$(Gi))pi++;for(Gi=0,Vn=Li;Vn;Vn=$(Vn))Gi++;for(;0<pi-Gi;)Ua=$(Ua),pi--;for(;0<Gi-pi;)Li=$(Li),Gi--;for(;pi--;){if(Ua===Li||Li!==null&&Ua===Li.alternate)break t;Ua=$(Ua),Li=$(Li)}Ua=null}else Ua=null;Sn!==null&&K(Zn,Ji,Sn,Ua,!1),ea!==null&&Go!==null&&K(Zn,Go,ea,Ua,!0)}}e:{if(Ji=_i?Qi(_i):window,Sn=Ji.nodeName&&Ji.nodeName.toLowerCase(),Sn==="select"||Sn==="input"&&Ji.type==="file")var Hr=Ru;else if(br(Ji))if(ch)Hr=Iu;else{Hr=yc;var Fa=uh}else Sn=Ji.nodeName,!Sn||Sn.toLowerCase()!=="input"||Ji.type!=="checkbox"&&Ji.type!=="radio"?_i&&hn(_i.elementType)&&(Hr=Ru):Hr=wo;if(Hr&&(Hr=Hr(u,_i))){El(Zn,Hr,w,An);break e}Fa&&Fa(u,Ji,_i),u==="focusout"&&_i&&Ji.type==="number"&&_i.memoizedProps.value!=null&&xo(Ji,"number",Ji.value)}switch(Fa=_i?Qi(_i):window,u){case"focusin":(br(Fa)||Fa.contentEditable==="true")&&(vc=Fa,hh=_i,Al=null);break;case"focusout":Al=hh=vc=null;break;case"mousedown":nu=!0;break;case"contextmenu":case"mouseup":case"dragend":nu=!1,mp(Zn,w,An);break;case"selectionchange":if(pp)break;case"keydown":case"keyup":mp(Zn,w,An)}var ca;if(Ul)e:{switch(u){case"compositionstart":var wa="onCompositionStart";break e;case"compositionend":wa="onCompositionEnd";break e;case"compositionupdate":wa="onCompositionUpdate";break e}wa=void 0}else Sl?mf(u,w)&&(wa="onCompositionEnd"):u==="keydown"&&w.keyCode===229&&(wa="onCompositionStart");wa&&(Hh&&w.locale!=="ko"&&(Sl||wa!=="onCompositionStart"?wa==="onCompositionEnd"&&Sl&&(ca=Cn()):(Si=An,qn="value"in Si?Si.value:Si.textContent,Sl=!0)),Fa=G(_i,wa),0<Fa.length&&(wa=new fl(wa,u,null,w,An),Zn.push({event:wa,listeners:Fa}),ca?wa.data=ca:(ca=eo(w),ca!==null&&(wa.data=ca)))),(ca=jf?Fr(u,w):sr(u,w))&&(wa=G(_i,"onBeforeInput"),0<wa.length&&(Fa=new fl("onBeforeInput","beforeinput",null,w,An),Zn.push({event:Fa,listeners:wa}),Fa.data=ca)),ap(Zn,u,_i,w,An)}e(Zn,m)})}function N(u,m,w){return{instance:u,listener:m,currentTarget:w}}function G(u,m){for(var w=m+"Capture",z=[];u!==null;){var H=u,J=H.stateNode;H=H.tag,H!==5&&H!==26&&H!==27||J===null||(H=on(u,w),H!=null&&z.unshift(N(u,H,J)),H=on(u,m),H!=null&&z.push(N(u,H,J))),u=u.return}return z}function $(u){if(u===null)return null;do u=u.return;while(u&&u.tag!==5&&u.tag!==27);return u||null}function K(u,m,w,z,H){for(var J=m._reactName,Ae=[];w!==null&&w!==z;){var Ke=w,Ot=Ke.alternate,_i=Ke.stateNode;if(Ke=Ke.tag,Ot!==null&&Ot===z)break;Ke!==5&&Ke!==26&&Ke!==27||_i===null||(Ot=_i,H?(_i=on(w,J),_i!=null&&Ae.unshift(N(w,_i,Ot))):H||(_i=on(w,J),_i!=null&&Ae.push(N(w,_i,Ot)))),w=w.return}Ae.length!==0&&u.push({event:m,listeners:Ae})}var ie=/\r\n?/g,ne=/\u0000|\uFFFD/g;function ue(u){return(typeof u=="string"?u:""+u).replace(ie,`
`).replace(ne,"")}function ye(u,m){return m=ue(m),ue(u)===m}function Se(){}function _e(u,m,w,z,H,J){switch(w){case"children":typeof z=="string"?m==="body"||m==="textarea"&&z===""||yt(u,z):(typeof z=="number"||typeof z=="bigint")&&m!=="body"&&yt(u,""+z);break;case"className":Ia(u,"class",z);break;case"tabIndex":Ia(u,"tabindex",z);break;case"dir":case"role":case"viewBox":case"width":case"height":Ia(u,w,z);break;case"style":wi(u,z,J);break;case"data":if(m!=="object"){Ia(u,"data",z);break}case"src":case"href":if(z===""&&(m!=="a"||w!=="href")){u.removeAttribute(w);break}if(z==null||typeof z=="function"||typeof z=="symbol"||typeof z=="boolean"){u.removeAttribute(w);break}z=we(""+z),u.setAttribute(w,z);break;case"action":case"formAction":if(typeof z=="function"){u.setAttribute(w,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof J=="function"&&(w==="formAction"?(m!=="input"&&_e(u,m,"name",H.name,H,null),_e(u,m,"formEncType",H.formEncType,H,null),_e(u,m,"formMethod",H.formMethod,H,null),_e(u,m,"formTarget",H.formTarget,H,null)):(_e(u,m,"encType",H.encType,H,null),_e(u,m,"method",H.method,H,null),_e(u,m,"target",H.target,H,null)));if(z==null||typeof z=="symbol"||typeof z=="boolean"){u.removeAttribute(w);break}z=we(""+z),u.setAttribute(w,z);break;case"onClick":z!=null&&(u.onclick=Se);break;case"onScroll":z!=null&&l("scroll",u);break;case"onScrollEnd":z!=null&&l("scrollend",u);break;case"dangerouslySetInnerHTML":if(z!=null){if(typeof z!="object"||!("__html"in z))throw Error(Ze(61));if(w=z.__html,w!=null){if(H.children!=null)throw Error(Ze(60));u.innerHTML=w}}break;case"multiple":u.multiple=z&&typeof z!="function"&&typeof z!="symbol";break;case"muted":u.muted=z&&typeof z!="function"&&typeof z!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(z==null||typeof z=="function"||typeof z=="boolean"||typeof z=="symbol"){u.removeAttribute("xlink:href");break}w=we(""+z),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",w);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":z!=null&&typeof z!="function"&&typeof z!="symbol"?u.setAttribute(w,""+z):u.removeAttribute(w);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":z&&typeof z!="function"&&typeof z!="symbol"?u.setAttribute(w,""):u.removeAttribute(w);break;case"capture":case"download":z===!0?u.setAttribute(w,""):z!==!1&&z!=null&&typeof z!="function"&&typeof z!="symbol"?u.setAttribute(w,z):u.removeAttribute(w);break;case"cols":case"rows":case"size":case"span":z!=null&&typeof z!="function"&&typeof z!="symbol"&&!isNaN(z)&&1<=z?u.setAttribute(w,z):u.removeAttribute(w);break;case"rowSpan":case"start":z==null||typeof z=="function"||typeof z=="symbol"||isNaN(z)?u.removeAttribute(w):u.setAttribute(w,z);break;case"popover":l("beforetoggle",u),l("toggle",u),Rs(u,"popover",z);break;case"xlinkActuate":Da(u,"http://www.w3.org/1999/xlink","xlink:actuate",z);break;case"xlinkArcrole":Da(u,"http://www.w3.org/1999/xlink","xlink:arcrole",z);break;case"xlinkRole":Da(u,"http://www.w3.org/1999/xlink","xlink:role",z);break;case"xlinkShow":Da(u,"http://www.w3.org/1999/xlink","xlink:show",z);break;case"xlinkTitle":Da(u,"http://www.w3.org/1999/xlink","xlink:title",z);break;case"xlinkType":Da(u,"http://www.w3.org/1999/xlink","xlink:type",z);break;case"xmlBase":Da(u,"http://www.w3.org/XML/1998/namespace","xml:base",z);break;case"xmlLang":Da(u,"http://www.w3.org/XML/1998/namespace","xml:lang",z);break;case"xmlSpace":Da(u,"http://www.w3.org/XML/1998/namespace","xml:space",z);break;case"is":Rs(u,"is",z);break;case"innerText":case"textContent":break;default:(!(2<w.length)||w[0]!=="o"&&w[0]!=="O"||w[1]!=="n"&&w[1]!=="N")&&(w=xe.get(w)||w,Rs(u,w,z))}}function $e(u,m,w,z,H,J){switch(w){case"style":wi(u,z,J);break;case"dangerouslySetInnerHTML":if(z!=null){if(typeof z!="object"||!("__html"in z))throw Error(Ze(61));if(w=z.__html,w!=null){if(H.children!=null)throw Error(Ze(60));u.innerHTML=w}}break;case"children":typeof z=="string"?yt(u,z):(typeof z=="number"||typeof z=="bigint")&&yt(u,""+z);break;case"onScroll":z!=null&&l("scroll",u);break;case"onScrollEnd":z!=null&&l("scrollend",u);break;case"onClick":z!=null&&(u.onclick=Se);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ar.hasOwnProperty(w))e:{if(w[0]==="o"&&w[1]==="n"&&(H=w.endsWith("Capture"),m=w.slice(2,H?w.length-7:void 0),J=u[Ce]||null,J=J!=null?J[w]:null,typeof J=="function"&&u.removeEventListener(m,J,H),typeof z=="function")){typeof J!="function"&&J!==null&&(w in u?u[w]=null:u.hasAttribute(w)&&u.removeAttribute(w)),u.addEventListener(m,z,H);break e}w in u?u[w]=z:z===!0?u.setAttribute(w,""):Rs(u,w,z)}}}function st(u,m,w){switch(m){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":l("error",u),l("load",u);var z=!1,H=!1,J;for(J in w)if(w.hasOwnProperty(J)){var Ae=w[J];if(Ae!=null)switch(J){case"src":z=!0;break;case"srcSet":H=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(Ze(137,m));default:_e(u,m,J,Ae,w,null)}}H&&_e(u,m,"srcSet",w.srcSet,w,null),z&&_e(u,m,"src",w.src,w,null);return;case"input":l("invalid",u);var Ke=J=Ae=H=null,Ot=null,_i=null;for(z in w)if(w.hasOwnProperty(z)){var An=w[z];if(An!=null)switch(z){case"name":H=An;break;case"type":Ae=An;break;case"checked":Ot=An;break;case"defaultChecked":_i=An;break;case"value":J=An;break;case"defaultValue":Ke=An;break;case"children":case"dangerouslySetInnerHTML":if(An!=null)throw Error(Ze(137,m));break;default:_e(u,m,z,An,w,null)}}Do(u,J,Ke,Ot,_i,Ae,H,!1),Vs(u);return;case"select":l("invalid",u),z=Ae=J=null;for(H in w)if(w.hasOwnProperty(H)&&(Ke=w[H],Ke!=null))switch(H){case"value":J=Ke;break;case"defaultValue":Ae=Ke;break;case"multiple":z=Ke;default:_e(u,m,H,Ke,w,null)}m=J,w=Ae,u.multiple=!!z,m!=null?Me(u,!!z,m,!1):w!=null&&Me(u,!!z,w,!0);return;case"textarea":l("invalid",u),J=H=z=null;for(Ae in w)if(w.hasOwnProperty(Ae)&&(Ke=w[Ae],Ke!=null))switch(Ae){case"value":z=Ke;break;case"defaultValue":H=Ke;break;case"children":J=Ke;break;case"dangerouslySetInnerHTML":if(Ke!=null)throw Error(Ze(91));break;default:_e(u,m,Ae,Ke,w,null)}Fe(u,z,H,J),Vs(u);return;case"option":for(Ot in w)if(w.hasOwnProperty(Ot)&&(z=w[Ot],z!=null))switch(Ot){case"selected":u.selected=z&&typeof z!="function"&&typeof z!="symbol";break;default:_e(u,m,Ot,z,w,null)}return;case"dialog":l("cancel",u),l("close",u);break;case"iframe":case"object":l("load",u);break;case"video":case"audio":for(z=0;z<Rp.length;z++)l(Rp[z],u);break;case"image":l("error",u),l("load",u);break;case"details":l("toggle",u);break;case"embed":case"source":case"link":l("error",u),l("load",u);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(_i in w)if(w.hasOwnProperty(_i)&&(z=w[_i],z!=null))switch(_i){case"children":case"dangerouslySetInnerHTML":throw Error(Ze(137,m));default:_e(u,m,_i,z,w,null)}return;default:if(hn(m)){for(An in w)w.hasOwnProperty(An)&&(z=w[An],z!==void 0&&$e(u,m,An,z,w,void 0));return}}for(Ke in w)w.hasOwnProperty(Ke)&&(z=w[Ke],z!=null&&_e(u,m,Ke,z,w,null))}function ot(u,m,w,z){switch(m){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var H=null,J=null,Ae=null,Ke=null,Ot=null,_i=null,An=null;for(Sn in w){var Zn=w[Sn];if(w.hasOwnProperty(Sn)&&Zn!=null)switch(Sn){case"checked":break;case"value":break;case"defaultValue":Ot=Zn;default:z.hasOwnProperty(Sn)||_e(u,m,Sn,null,z,Zn)}}for(var Ji in z){var Sn=z[Ji];if(Zn=w[Ji],z.hasOwnProperty(Ji)&&(Sn!=null||Zn!=null))switch(Ji){case"type":J=Sn;break;case"name":H=Sn;break;case"checked":_i=Sn;break;case"defaultChecked":An=Sn;break;case"value":Ae=Sn;break;case"defaultValue":Ke=Sn;break;case"children":case"dangerouslySetInnerHTML":if(Sn!=null)throw Error(Ze(137,m));break;default:Sn!==Zn&&_e(u,m,Ji,Sn,z,Zn)}}ka(u,Ae,Ke,Ot,_i,An,J,H);return;case"select":Sn=Ae=Ke=Ji=null;for(J in w)if(Ot=w[J],w.hasOwnProperty(J)&&Ot!=null)switch(J){case"value":break;case"multiple":Sn=Ot;default:z.hasOwnProperty(J)||_e(u,m,J,null,z,Ot)}for(H in z)if(J=z[H],Ot=w[H],z.hasOwnProperty(H)&&(J!=null||Ot!=null))switch(H){case"value":Ji=J;break;case"defaultValue":Ke=J;break;case"multiple":Ae=J;default:J!==Ot&&_e(u,m,H,J,z,Ot)}m=Ke,w=Ae,z=Sn,Ji!=null?Me(u,!!w,Ji,!1):!!z!=!!w&&(m!=null?Me(u,!!w,m,!0):Me(u,!!w,w?[]:"",!1));return;case"textarea":Sn=Ji=null;for(Ke in w)if(H=w[Ke],w.hasOwnProperty(Ke)&&H!=null&&!z.hasOwnProperty(Ke))switch(Ke){case"value":break;case"children":break;default:_e(u,m,Ke,null,z,H)}for(Ae in z)if(H=z[Ae],J=w[Ae],z.hasOwnProperty(Ae)&&(H!=null||J!=null))switch(Ae){case"value":Ji=H;break;case"defaultValue":Sn=H;break;case"children":break;case"dangerouslySetInnerHTML":if(H!=null)throw Error(Ze(91));break;default:H!==J&&_e(u,m,Ae,H,z,J)}be(u,Ji,Sn);return;case"option":for(var ea in w)if(Ji=w[ea],w.hasOwnProperty(ea)&&Ji!=null&&!z.hasOwnProperty(ea))switch(ea){case"selected":u.selected=!1;break;default:_e(u,m,ea,null,z,Ji)}for(Ot in z)if(Ji=z[Ot],Sn=w[Ot],z.hasOwnProperty(Ot)&&Ji!==Sn&&(Ji!=null||Sn!=null))switch(Ot){case"selected":u.selected=Ji&&typeof Ji!="function"&&typeof Ji!="symbol";break;default:_e(u,m,Ot,Ji,z,Sn)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ua in w)Ji=w[Ua],w.hasOwnProperty(Ua)&&Ji!=null&&!z.hasOwnProperty(Ua)&&_e(u,m,Ua,null,z,Ji);for(_i in z)if(Ji=z[_i],Sn=w[_i],z.hasOwnProperty(_i)&&Ji!==Sn&&(Ji!=null||Sn!=null))switch(_i){case"children":case"dangerouslySetInnerHTML":if(Ji!=null)throw Error(Ze(137,m));break;default:_e(u,m,_i,Ji,z,Sn)}return;default:if(hn(m)){for(var Go in w)Ji=w[Go],w.hasOwnProperty(Go)&&Ji!==void 0&&!z.hasOwnProperty(Go)&&$e(u,m,Go,void 0,z,Ji);for(An in z)Ji=z[An],Sn=w[An],!z.hasOwnProperty(An)||Ji===Sn||Ji===void 0&&Sn===void 0||$e(u,m,An,Ji,z,Sn);return}}for(var Li in w)Ji=w[Li],w.hasOwnProperty(Li)&&Ji!=null&&!z.hasOwnProperty(Li)&&_e(u,m,Li,null,z,Ji);for(Zn in z)Ji=z[Zn],Sn=w[Zn],!z.hasOwnProperty(Zn)||Ji===Sn||Ji==null&&Sn==null||_e(u,m,Zn,Ji,z,Sn)}var Lt=null,Bt=null;function di(u){return u.nodeType===9?u:u.ownerDocument}function Ti(u){switch(u){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ki(u,m){if(u===0)switch(m){case"svg":return 1;case"math":return 2;default:return 0}return u===1&&m==="foreignObject"?0:u}function Bi(u,m){return u==="textarea"||u==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.children=="bigint"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var Zi=null;function hr(){var u=window.event;return u&&u.type==="popstate"?u===Zi?!1:(Zi=u,!0):(Zi=null,!1)}var Gn=typeof setTimeout=="function"?setTimeout:void 0,gn=typeof clearTimeout=="function"?clearTimeout:void 0,Yn=typeof Promise=="function"?Promise:void 0,Mr=typeof queueMicrotask=="function"?queueMicrotask:typeof Yn<"u"?function(u){return Yn.resolve(null).then(u).catch(Cr)}:Gn;function Cr(u){setTimeout(function(){throw u})}function kr(u,m){var w=m,z=0;do{var H=w.nextSibling;if(u.removeChild(w),H&&H.nodeType===8)if(w=H.data,w==="/$"){if(z===0){u.removeChild(H),dm(m);return}z--}else w!=="$"&&w!=="$?"&&w!=="$!"||z++;w=H}while(w);dm(m)}function Zr(u){var m=u.firstChild;for(m&&m.nodeType===10&&(m=m.nextSibling);m;){var w=m;switch(m=m.nextSibling,w.nodeName){case"HTML":case"HEAD":case"BODY":Zr(w),Gt(w);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(w.rel.toLowerCase()==="stylesheet")continue}u.removeChild(w)}}function la(u,m,w,z){for(;u.nodeType===1;){var H=w;if(u.nodeName.toLowerCase()!==m.toLowerCase()){if(!z&&(u.nodeName!=="INPUT"||u.type!=="hidden"))break}else if(z){if(!u[Vt])switch(m){case"meta":if(!u.hasAttribute("itemprop"))break;return u;case"link":if(J=u.getAttribute("rel"),J==="stylesheet"&&u.hasAttribute("data-precedence"))break;if(J!==H.rel||u.getAttribute("href")!==(H.href==null?null:H.href)||u.getAttribute("crossorigin")!==(H.crossOrigin==null?null:H.crossOrigin)||u.getAttribute("title")!==(H.title==null?null:H.title))break;return u;case"style":if(u.hasAttribute("data-precedence"))break;return u;case"script":if(J=u.getAttribute("src"),(J!==(H.src==null?null:H.src)||u.getAttribute("type")!==(H.type==null?null:H.type)||u.getAttribute("crossorigin")!==(H.crossOrigin==null?null:H.crossOrigin))&&J&&u.hasAttribute("async")&&!u.hasAttribute("itemprop"))break;return u;default:return u}}else if(m==="input"&&u.type==="hidden"){var J=H.name==null?null:""+H.name;if(H.type==="hidden"&&u.getAttribute("name")===J)return u}else return u;if(u=At(u.nextSibling),u===null)break}return null}function Kn(u,m,w){if(m==="")return null;for(;u.nodeType!==3;)if((u.nodeType!==1||u.nodeName!=="INPUT"||u.type!=="hidden")&&!w||(u=At(u.nextSibling),u===null))return null;return u}function At(u){for(;u!=null;u=u.nextSibling){var m=u.nodeType;if(m===1||m===3)break;if(m===8){if(m=u.data,m==="$"||m==="$!"||m==="$?"||m==="F!"||m==="F")break;if(m==="/$")return null}}return u}function Qt(u){u=u.previousSibling;for(var m=0;u;){if(u.nodeType===8){var w=u.data;if(w==="$"||w==="$!"||w==="$?"){if(m===0)return u;m--}else w==="/$"&&m++}u=u.previousSibling}return null}function xn(u,m,w){switch(m=di(w),u){case"html":if(u=m.documentElement,!u)throw Error(Ze(452));return u;case"head":if(u=m.head,!u)throw Error(Ze(453));return u;case"body":if(u=m.body,!u)throw Error(Ze(454));return u;default:throw Error(Ze(451))}}var Vi=new Map,ji=new Set;function ir(u){return typeof u.getRootNode=="function"?u.getRootNode():u.ownerDocument}var $n=pt.d;pt.d={f:$i,r:Mt,D:Bn,C:Rn,L:Dr,m:Qr,X:Ba,S:Or,M:Ea};function $i(){var u=$n.f(),m=wp();return u||m}function Mt(u){var m=Mi(u);m!==null&&m.tag===5&&m.type==="form"?Sc(m):$n.r(u)}var Oi=typeof document>"u"?null:document;function Ln(u,m,w){var z=Oi;if(z&&typeof m=="string"&&m){var H=fo(m);H='link[rel="'+u+'"][href="'+H+'"]',typeof w=="string"&&(H+='[crossorigin="'+w+'"]'),ji.has(H)||(ji.add(H),u={rel:u,crossOrigin:w,href:m},z.querySelector(H)===null&&(m=z.createElement("link"),st(m,"link",u),zn(m),z.head.appendChild(m)))}}function Bn(u){$n.D(u),Ln("dns-prefetch",u,null)}function Rn(u,m){$n.C(u,m),Ln("preconnect",u,m)}function Dr(u,m,w){$n.L(u,m,w);var z=Oi;if(z&&u&&m){var H='link[rel="preload"][as="'+fo(m)+'"]';m==="image"&&w&&w.imageSrcSet?(H+='[imagesrcset="'+fo(w.imageSrcSet)+'"]',typeof w.imageSizes=="string"&&(H+='[imagesizes="'+fo(w.imageSizes)+'"]')):H+='[href="'+fo(u)+'"]';var J=H;switch(m){case"style":J=os(u);break;case"script":J=Jc(u)}Vi.has(J)||(u=oi({rel:"preload",href:m==="image"&&w&&w.imageSrcSet?void 0:u,as:m},w),Vi.set(J,u),z.querySelector(H)!==null||m==="style"&&z.querySelector(_o(J))||m==="script"&&z.querySelector(Tu(J))||(m=z.createElement("link"),st(m,"link",u),zn(m),z.head.appendChild(m)))}}function Qr(u,m){$n.m(u,m);var w=Oi;if(w&&u){var z=m&&typeof m.as=="string"?m.as:"script",H='link[rel="modulepreload"][as="'+fo(z)+'"][href="'+fo(u)+'"]',J=H;switch(z){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":J=Jc(u)}if(!Vi.has(J)&&(u=oi({rel:"modulepreload",href:u},m),Vi.set(J,u),w.querySelector(H)===null)){switch(z){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(w.querySelector(Tu(J)))return}z=w.createElement("link"),st(z,"link",u),zn(z),w.head.appendChild(z)}}}function Or(u,m,w){$n.S(u,m,w);var z=Oi;if(z&&u){var H=nn(z).hoistableStyles,J=os(u);m=m||"default";var Ae=H.get(J);if(!Ae){var Ke={loading:0,preload:null};if(Ae=z.querySelector(_o(J)))Ke.loading=5;else{u=oi({rel:"stylesheet",href:u,"data-precedence":m},w),(w=Vi.get(J))&&er(u,w);var Ot=Ae=z.createElement("link");zn(Ot),st(Ot,"link",u),Ot._p=new Promise(function(_i,An){Ot.onload=_i,Ot.onerror=An}),Ot.addEventListener("load",function(){Ke.loading|=1}),Ot.addEventListener("error",function(){Ke.loading|=2}),Ke.loading|=4,bl(Ae,m,z)}Ae={type:"stylesheet",instance:Ae,count:1,state:Ke},H.set(J,Ae)}}}function Ba(u,m){$n.X(u,m);var w=Oi;if(w&&u){var z=nn(w).hoistableScripts,H=Jc(u),J=z.get(H);J||(J=w.querySelector(Tu(H)),J||(u=oi({src:u,async:!0},m),(m=Vi.get(H))&&lf(u,m),J=w.createElement("script"),zn(J),st(J,"link",u),w.head.appendChild(J)),J={type:"script",instance:J,count:1,state:null},z.set(H,J))}}function Ea(u,m){$n.M(u,m);var w=Oi;if(w&&u){var z=nn(w).hoistableScripts,H=Jc(u),J=z.get(H);J||(J=w.querySelector(Tu(H)),J||(u=oi({src:u,async:!0,type:"module"},m),(m=Vi.get(H))&&lf(u,m),J=w.createElement("script"),zn(J),st(J,"link",u),w.head.appendChild(J)),J={type:"script",instance:J,count:1,state:null},z.set(H,J))}}function nl(u,m,w,z){var H=(H=ra.current)?ir(H):null;if(!H)throw Error(Ze(446));switch(u){case"meta":case"title":return null;case"style":return typeof w.precedence=="string"&&typeof w.href=="string"?(m=os(w.href),w=nn(H).hoistableStyles,z=w.get(m),z||(z={type:"style",instance:null,count:0,state:null},w.set(m,z)),z):{type:"void",instance:null,count:0,state:null};case"link":if(w.rel==="stylesheet"&&typeof w.href=="string"&&typeof w.precedence=="string"){u=os(w.href);var J=nn(H).hoistableStyles,Ae=J.get(u);if(Ae||(H=H.ownerDocument||H,Ae={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},J.set(u,Ae),(J=H.querySelector(_o(u)))&&!J._p&&(Ae.instance=J,Ae.state.loading=5),Vi.has(u)||(w={rel:"preload",as:"style",href:w.href,crossOrigin:w.crossOrigin,integrity:w.integrity,media:w.media,hrefLang:w.hrefLang,referrerPolicy:w.referrerPolicy},Vi.set(u,w),J||of(H,u,w,Ae.state))),m&&z===null)throw Error(Ze(528,""));return Ae}if(m&&z!==null)throw Error(Ze(529,""));return null;case"script":return m=w.async,w=w.src,typeof w=="string"&&m&&typeof m!="function"&&typeof m!="symbol"?(m=Jc(w),w=nn(H).hoistableScripts,z=w.get(m),z||(z={type:"script",instance:null,count:0,state:null},w.set(m,z)),z):{type:"void",instance:null,count:0,state:null};default:throw Error(Ze(444,u))}}function os(u){return'href="'+fo(u)+'"'}function _o(u){return'link[rel="stylesheet"]['+u+"]"}function dc(u){return oi({},u,{"data-precedence":u.precedence,precedence:null})}function of(u,m,w,z){u.querySelector('link[rel="preload"][as="style"]['+m+"]")?z.loading=1:(m=u.createElement("link"),z.preload=m,m.addEventListener("load",function(){return z.loading|=1}),m.addEventListener("error",function(){return z.loading|=2}),st(m,"link",w),zn(m),u.head.appendChild(m))}function Jc(u){return'[src="'+fo(u)+'"]'}function Tu(u){return"script[async]"+u}function Qc(u,m,w){if(m.count++,m.instance===null)switch(m.type){case"style":var z=u.querySelector('style[data-href~="'+fo(w.href)+'"]');if(z)return m.instance=z,zn(z),z;var H=oi({},w,{"data-href":w.href,"data-precedence":w.precedence,href:null,precedence:null});return z=(u.ownerDocument||u).createElement("style"),zn(z),st(z,"style",H),bl(z,w.precedence,u),m.instance=z;case"stylesheet":H=os(w.href);var J=u.querySelector(_o(H));if(J)return m.state.loading|=4,m.instance=J,zn(J),J;z=dc(w),(H=Vi.get(H))&&er(z,H),J=(u.ownerDocument||u).createElement("link"),zn(J);var Ae=J;return Ae._p=new Promise(function(Ke,Ot){Ae.onload=Ke,Ae.onerror=Ot}),st(J,"link",z),m.state.loading|=4,bl(J,w.precedence,u),m.instance=J;case"script":return J=Jc(w.src),(H=u.querySelector(Tu(J)))?(m.instance=H,zn(H),H):(z=w,(H=Vi.get(J))&&(z=oi({},w),lf(z,H)),u=u.ownerDocument||u,H=u.createElement("script"),zn(H),st(H,"link",z),u.head.appendChild(H),m.instance=H);case"void":return null;default:throw Error(Ze(443,m.type))}else m.type==="stylesheet"&&(m.state.loading&4)===0&&(z=m.instance,m.state.loading|=4,bl(z,w.precedence,u));return m.instance}function bl(u,m,w){for(var z=w.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),H=z.length?z[z.length-1]:null,J=H,Ae=0;Ae<z.length;Ae++){var Ke=z[Ae];if(Ke.dataset.precedence===m)J=Ke;else if(J!==H)break}J?J.parentNode.insertBefore(u,J.nextSibling):(m=w.nodeType===9?w.head:w,m.insertBefore(u,m.firstChild))}function er(u,m){u.crossOrigin==null&&(u.crossOrigin=m.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=m.referrerPolicy),u.title==null&&(u.title=m.title)}function lf(u,m){u.crossOrigin==null&&(u.crossOrigin=m.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=m.referrerPolicy),u.integrity==null&&(u.integrity=m.integrity)}var sp=null;function fc(u,m,w){if(sp===null){var z=new Map,H=sp=new Map;H.set(w,z)}else H=sp,z=H.get(w),z||(z=new Map,H.set(w,z));if(z.has(u))return z;for(z.set(u,null),w=w.getElementsByTagName(u),H=0;H<w.length;H++){var J=w[H];if(!(J[Vt]||J[pe]||u==="link"&&J.getAttribute("rel")==="stylesheet")&&J.namespaceURI!=="http://www.w3.org/2000/svg"){var Ae=J.getAttribute(m)||"";Ae=u+Ae;var Ke=z.get(Ae);Ke?Ke.push(J):z.set(Ae,[J])}}return z}function um(u,m,w){u=u.ownerDocument||u,u.head.insertBefore(w,m==="title"?u.querySelector("head > title"):null)}function Sm(u,m,w){if(w===1||m.itemProp!=null)return!1;switch(u){case"meta":case"title":return!0;case"style":if(typeof m.precedence!="string"||typeof m.href!="string"||m.href==="")break;return!0;case"link":if(typeof m.rel!="string"||typeof m.href!="string"||m.href===""||m.onLoad||m.onError)break;switch(m.rel){case"stylesheet":return u=m.disabled,typeof m.precedence=="string"&&u==null;default:return!0}case"script":if(m.async&&typeof m.async!="function"&&typeof m.async!="symbol"&&!m.onLoad&&!m.onError&&m.src&&typeof m.src=="string")return!0}return!1}function hm(u){return!(u.type==="stylesheet"&&(u.state.loading&3)===0)}var Ff=null;function Em(){}function Am(u,m,w){if(Ff===null)throw Error(Ze(475));var z=Ff;if(m.type==="stylesheet"&&(typeof w.media!="string"||matchMedia(w.media).matches!==!1)&&(m.state.loading&4)===0){if(m.instance===null){var H=os(w.href),J=u.querySelector(_o(H));if(J){u=J._p,u!==null&&typeof u=="object"&&typeof u.then=="function"&&(z.count++,z=op.bind(z),u.then(z,z)),m.state.loading|=4,m.instance=J,zn(J);return}J=u.ownerDocument||u,w=dc(w),(H=Vi.get(H))&&er(w,H),J=J.createElement("link"),zn(J);var Ae=J;Ae._p=new Promise(function(Ke,Ot){Ae.onload=Ke,Ae.onerror=Ot}),st(J,"link",w),m.instance=J}z.stylesheets===null&&(z.stylesheets=new Map),z.stylesheets.set(m,u),(u=m.state.preload)&&(m.state.loading&3)===0&&(z.count++,m=op.bind(z),u.addEventListener("load",m),u.addEventListener("error",m))}}function kf(){if(Ff===null)throw Error(Ze(475));var u=Ff;return u.stylesheets&&u.count===0&&lp(u,u.stylesheets),0<u.count?function(m){var w=setTimeout(function(){if(u.stylesheets&&lp(u,u.stylesheets),u.unsuspend){var z=u.unsuspend;u.unsuspend=null,z()}},6e4);return u.unsuspend=m,function(){u.unsuspend=null,clearTimeout(w)}}:null}function op(){if(this.count--,this.count===0){if(this.stylesheets)lp(this,this.stylesheets);else if(this.unsuspend){var u=this.unsuspend;this.unsuspend=null,u()}}}var Ip=null;function lp(u,m){u.stylesheets=null,u.unsuspend!==null&&(u.count++,Ip=new Map,m.forEach(Wm,u),Ip=null,op.call(u))}function Wm(u,m){if(!(m.state.loading&4)){var w=Ip.get(u);if(w)var z=w.get(null);else{w=new Map,Ip.set(u,w);for(var H=u.querySelectorAll("link[data-precedence],style[data-precedence]"),J=0;J<H.length;J++){var Ae=H[J];(Ae.nodeName==="LINK"||Ae.getAttribute("media")!=="not all")&&(w.set(Ae.dataset.precedence,Ae),z=Ae)}z&&w.set(null,z)}H=m.instance,Ae=H.getAttribute("data-precedence"),J=w.get(Ae)||z,J===z&&w.set(null,H),w.set(Ae,H),this.count++,z=op.bind(this),H.addEventListener("load",z),H.addEventListener("error",z),J?J.parentNode.insertBefore(H,J.nextSibling):(u=u.nodeType===9?u.head:u,u.insertBefore(H,u.firstChild)),m.state.loading|=4}}var Sd={$$typeof:bi,Provider:null,Consumer:null,_currentValue:ti,_currentValue2:ti,_threadCount:0};function $p(u,m,w,z,H,J,Ae,Ke){this.tag=1,this.containerInfo=u,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ht(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ht(0),this.hiddenUpdates=ht(null),this.identifierPrefix=z,this.onUncaughtError=H,this.onCaughtError=J,this.onRecoverableError=Ae,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Ke,this.incompleteTransitions=new Map}function Kp(u,m,w,z,H,J,Ae,Ke,Ot,_i,An,Zn){return u=new $p(u,m,w,Ae,Ke,Ot,_i,Zn),m=1,J===!0&&(m|=24),J=hi(3,null,null,m),u.current=J,J.stateNode=u,m=sc(),m.refCount++,u.pooledCache=m,m.refCount++,J.memoizedState={element:z,isDehydrated:w,cache:m},ip(J),u}function zt(u){return u?(u=Yh,u):Yh}function _n(u,m,w,z,H,J){H=zt(H),z.context===null?z.context=H:z.pendingContext=H,z=xl(m),z.payload={element:w},J=J===void 0?null:J,J!==null&&(z.callback=J),w=yu(u,z,m),w!==null&&(Uo(w,u,m),Ju(w,u,m))}function Ni(u,m){if(u=u.memoizedState,u!==null&&u.dehydrated!==null){var w=u.retryLane;u.retryLane=w!==0&&w<m?w:m}}function pn(u,m){Ni(u,m),(u=u.alternate)&&Ni(u,m)}function Qn(u){if(u.tag===13){var m=nc(u,67108864);m!==null&&Uo(m,u,67108864),pn(u,67108864)}}var ya=!0;function Xr(u,m,w,z){var H=Fi.T;Fi.T=null;var J=pt.p;try{pt.p=2,Ga(u,m,w,z)}finally{pt.p=J,Fi.T=H}}function Aa(u,m,w,z){var H=Fi.T;Fi.T=null;var J=pt.p;try{pt.p=8,Ga(u,m,w,z)}finally{pt.p=J,Fi.T=H}}function Ga(u,m,w,z){if(ya){var H=Ds(z);if(H===null)k(u,m,z,Wa,w),hs(u,z);else if(eu(H,u,m,w,z))z.stopPropagation();else if(hs(u,z),m&4&&-1<Nh.indexOf(u)){for(;H!==null;){var J=Mi(H);if(J!==null)switch(J.tag){case 3:if(J=J.stateNode,J.current.memoizedState.isDehydrated){var Ae=ja(J.pendingLanes);if(Ae!==0){var Ke=J;for(Ke.pendingLanes|=2,Ke.entangledLanes|=2;Ae;){var Ot=1<<31-dn(Ae);Ke.entanglements[1]|=Ot,Ae&=~Ot}zc(J),(In&6)===0&&(No=ii()+500,rp(0))}}break;case 13:Ke=nc(J,2),Ke!==null&&Uo(Ke,J,2),wp(),pn(J,2)}if(J=Ds(z),J===null&&k(u,m,z,Wa,w),J===H)break;H=J}H!==null&&z.stopPropagation()}else k(u,m,z,null,w)}}function Ds(u){return u=Ee(u),Ha(u)}var Wa=null;function Ha(u){if(Wa=null,u=Wt(u),u!==null){var m=Re(u);if(m===null)u=null;else{var w=m.tag;if(w===13){if(u=ze(m),u!==null)return u;u=null}else if(w===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;u=null}else m!==u&&(u=null)}}return Wa=u,null}function La(u){switch(u){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Tn()){case wn:return 2;case gr:return 8;case cr:case Sr:return 32;case Er:return 268435456;default:return 32}default:return 32}}var Ed=!1,Bs=null,pc=null,wl=null,nh=new Map,Su=new Map,Ys=[],Nh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function hs(u,m){switch(u){case"focusin":case"focusout":Bs=null;break;case"dragenter":case"dragleave":pc=null;break;case"mouseover":case"mouseout":wl=null;break;case"pointerover":case"pointerout":nh.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":Su.delete(m.pointerId)}}function ao(u,m,w,z,H,J){return u===null||u.nativeEvent!==J?(u={blockedOn:m,domEventName:w,eventSystemFlags:z,nativeEvent:J,targetContainers:[H]},m!==null&&(m=Mi(m),m!==null&&Qn(m)),u):(u.eventSystemFlags|=z,m=u.targetContainers,H!==null&&m.indexOf(H)===-1&&m.push(H),u)}function eu(u,m,w,z,H){switch(m){case"focusin":return Bs=ao(Bs,u,m,w,z,H),!0;case"dragenter":return pc=ao(pc,u,m,w,z,H),!0;case"mouseover":return wl=ao(wl,u,m,w,z,H),!0;case"pointerover":var J=H.pointerId;return nh.set(J,ao(nh.get(J)||null,u,m,w,z,H)),!0;case"gotpointercapture":return J=H.pointerId,Su.set(J,ao(Su.get(J)||null,u,m,w,z,H)),!0}return!1}function Cm(u){var m=Wt(u.target);if(m!==null){var w=Re(m);if(w!==null){if(m=w.tag,m===13){if(m=ze(w),m!==null){u.blockedOn=m,Xt(u.priority,function(){if(w.tag===13){var z=il(),H=nc(w,z);H!==null&&Uo(H,w,z),pn(w,z)}});return}}else if(m===3&&w.stateNode.current.memoizedState.isDehydrated){u.blockedOn=w.tag===3?w.stateNode.containerInfo:null;return}}}u.blockedOn=null}function Dp(u){if(u.blockedOn!==null)return!1;for(var m=u.targetContainers;0<m.length;){var w=Ds(u.nativeEvent);if(w===null){w=u.nativeEvent;var z=new w.constructor(w.type,w);Ve=z,w.target.dispatchEvent(z),Ve=null}else return m=Mi(w),m!==null&&Qn(m),u.blockedOn=w,!1;m.shift()}return!0}function zp(u,m,w){Dp(u)&&w.delete(m)}function n_(){Ed=!1,Bs!==null&&Dp(Bs)&&(Bs=null),pc!==null&&Dp(pc)&&(pc=null),wl!==null&&Dp(wl)&&(wl=null),nh.forEach(zp),Su.forEach(zp)}function Lm(u,m){u.blockedOn===m&&(u.blockedOn=null,Ed||(Ed=!0,En.unstable_scheduleCallback(En.unstable_NormalPriority,n_)))}var cp=null;function bg(u){cp!==u&&(cp=u,En.unstable_scheduleCallback(En.unstable_NormalPriority,function(){cp===u&&(cp=null);for(var m=0;m<u.length;m+=3){var w=u[m],z=u[m+1],H=u[m+2];if(typeof z!="function"){if(Ha(z||w)===null)continue;break}var J=Mi(w);J!==null&&(u.splice(m,3),m-=3,Fo(J,{pending:!0,data:H,method:w.method,action:z},z,H))}}))}function dm(u){function m(Ot){return Lm(Ot,u)}Bs!==null&&Lm(Bs,u),pc!==null&&Lm(pc,u),wl!==null&&Lm(wl,u),nh.forEach(m),Su.forEach(m);for(var w=0;w<Ys.length;w++){var z=Ys[w];z.blockedOn===u&&(z.blockedOn=null)}for(;0<Ys.length&&(w=Ys[0],w.blockedOn===null);)Cm(w),w.blockedOn===null&&Ys.shift();if(w=(u.ownerDocument||u).$$reactFormReplay,w!=null)for(z=0;z<w.length;z+=3){var H=w[z],J=w[z+1],Ae=H[Ce]||null;if(typeof J=="function")Ae||bg(w);else if(Ae){var Ke=null;if(J&&J.hasAttribute("formAction")){if(H=J,Ae=J[Ce]||null)Ke=Ae.formAction;else if(Ha(H)!==null)continue}else Ke=Ae.action;typeof Ke=="function"?w[z+1]=Ke:(w.splice(z,3),z-=3),bg(w)}}}function Rm(u){this._internalRoot=u}Jp.prototype.render=Rm.prototype.render=function(u){var m=this._internalRoot;if(m===null)throw Error(Ze(409));var w=m.current,z=il();_n(w,z,u,m,null,null)},Jp.prototype.unmount=Rm.prototype.unmount=function(){var u=this._internalRoot;if(u!==null){this._internalRoot=null;var m=u.containerInfo;u.tag===0&&zf(),_n(u.current,2,null,u,null,null),wp(),m[qe]=null}};function Jp(u){this._internalRoot=u}Jp.prototype.unstable_scheduleHydration=function(u){if(u){var m=Io();u={blockedOn:null,target:u,priority:m};for(var w=0;w<Ys.length&&m!==0&&m<Ys[w].priority;w++);Ys.splice(w,0,u),w===0&&Cm(u)}};var Zm=na.version;if(Zm!=="19.0.0")throw Error(Ze(527,Zm,"19.0.0"));pt.findDOMNode=function(u){var m=u._reactInternals;if(m===void 0)throw typeof u.render=="function"?Error(Ze(188)):(u=Object.keys(u).join(","),Error(Ze(268,u)));return u=it(m),u=u!==null?vt(u):null,u=u===null?null:u.stateNode,u};var Xm={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:Fi,findFiberByHostInstance:Wt,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Im=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Im.isDisabled&&Im.supportsFiber)try{Ma=Im.inject(Xm),ga=Im}catch{}}return yg.createRoot=function(u,m){if(!St(u))throw Error(Ze(299));var w=!1,z="",H=pu,J=Sf,Ae=Jd,Ke=null;return m!=null&&(m.unstable_strictMode===!0&&(w=!0),m.identifierPrefix!==void 0&&(z=m.identifierPrefix),m.onUncaughtError!==void 0&&(H=m.onUncaughtError),m.onCaughtError!==void 0&&(J=m.onCaughtError),m.onRecoverableError!==void 0&&(Ae=m.onRecoverableError),m.unstable_transitionCallbacks!==void 0&&(Ke=m.unstable_transitionCallbacks)),m=Kp(u,1,!1,null,null,w,z,H,J,Ae,Ke,null),u[qe]=m.current,S(u.nodeType===8?u.parentNode:u),new Rm(m)},yg.hydrateRoot=function(u,m,w){if(!St(u))throw Error(Ze(299));var z=!1,H="",J=pu,Ae=Sf,Ke=Jd,Ot=null,_i=null;return w!=null&&(w.unstable_strictMode===!0&&(z=!0),w.identifierPrefix!==void 0&&(H=w.identifierPrefix),w.onUncaughtError!==void 0&&(J=w.onUncaughtError),w.onCaughtError!==void 0&&(Ae=w.onCaughtError),w.onRecoverableError!==void 0&&(Ke=w.onRecoverableError),w.unstable_transitionCallbacks!==void 0&&(Ot=w.unstable_transitionCallbacks),w.formState!==void 0&&(_i=w.formState)),m=Kp(u,1,!0,m,w??null,z,H,J,Ae,Ke,Ot,_i),m.context=zt(null),w=m.current,z=il(),H=xl(z),H.callback=null,yu(w,H,z),m.current.lanes=z,es(m,z),zc(m),u[qe]=m.current,S(u),new Jp(m)},yg.version="19.0.0",yg}var Fv;function db(){if(Fv)return K_.exports;Fv=1;function En(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(En)}catch(na){console.error(na)}}return En(),K_.exports=hb(),K_.exports}var fb=db(),Qg={exports:{}},pb=Qg.exports,kv;function mb(){return kv||(kv=1,function(En,na){(function(U,Ze){En.exports=Ze()})(pb,function(){var U,Ze,St;function ei(r,Ge){if(!U)U=Ge;else if(!Ze)Ze=Ge;else{var de="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+U+")(sharedChunk); ("+Ze+")(sharedChunk); self.onerror = null;",Je={};U(Je),St=Ge(Je),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(St.workerUrl=window.URL.createObjectURL(new Blob([de],{type:"text/javascript"})))}}ei(["exports"],function(r){function Ge(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var de,Je={},rt={};function ai(){if(de)return rt;de=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.setMatrixArrayType=function(p){rt.ARRAY_TYPE=t=p},rt.toRadian=function(p){return p*c},rt.equals=function(p,h){return Math.abs(p-h)<=s*Math.max(1,Math.abs(p),Math.abs(h))},rt.RANDOM=rt.ARRAY_TYPE=rt.EPSILON=void 0;var s=1e-6;rt.EPSILON=s;var t=typeof Float32Array<"u"?Float32Array:Array;rt.ARRAY_TYPE=t;var n=Math.random;rt.RANDOM=n;var c=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var p=0,h=arguments.length;h--;)p+=arguments[h]*arguments[h];return Math.sqrt(p)}),rt}var bi,Ai={};function qt(){if(bi)return Ai;function s(h){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},s(h)}bi=1,Object.defineProperty(Ai,"__esModule",{value:!0}),Ai.create=function(){var h=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h},Ai.clone=function(h){var g=new t.ARRAY_TYPE(4);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[3]=h[3],g},Ai.copy=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[3],h},Ai.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h},Ai.fromValues=function(h,g,M,C){var P=new t.ARRAY_TYPE(4);return P[0]=h,P[1]=g,P[2]=M,P[3]=C,P},Ai.set=function(h,g,M,C,P){return h[0]=g,h[1]=M,h[2]=C,h[3]=P,h},Ai.transpose=function(h,g){if(h===g){var M=g[1];h[1]=g[2],h[2]=M}else h[0]=g[0],h[1]=g[2],h[2]=g[1],h[3]=g[3];return h},Ai.invert=function(h,g){var M=g[0],C=g[1],P=g[2],b=g[3],L=M*b-P*C;return L?(h[0]=b*(L=1/L),h[1]=-C*L,h[2]=-P*L,h[3]=M*L,h):null},Ai.adjoint=function(h,g){var M=g[0];return h[0]=g[3],h[1]=-g[1],h[2]=-g[2],h[3]=M,h},Ai.determinant=function(h){return h[0]*h[3]-h[2]*h[1]},Ai.multiply=c,Ai.rotate=function(h,g,M){var C=g[0],P=g[1],b=g[2],L=g[3],D=Math.sin(M),A=Math.cos(M);return h[0]=C*A+b*D,h[1]=P*A+L*D,h[2]=C*-D+b*A,h[3]=P*-D+L*A,h},Ai.scale=function(h,g,M){var C=g[1],P=g[2],b=g[3],L=M[0],D=M[1];return h[0]=g[0]*L,h[1]=C*L,h[2]=P*D,h[3]=b*D,h},Ai.fromRotation=function(h,g){var M=Math.sin(g),C=Math.cos(g);return h[0]=C,h[1]=M,h[2]=-M,h[3]=C,h},Ai.fromScaling=function(h,g){return h[0]=g[0],h[1]=0,h[2]=0,h[3]=g[1],h},Ai.str=function(h){return"mat2("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+")"},Ai.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3])},Ai.LDU=function(h,g,M,C){return h[2]=C[2]/C[0],M[0]=C[0],M[1]=C[1],M[3]=C[3]-h[2]*M[1],[h,g,M]},Ai.add=function(h,g,M){return h[0]=g[0]+M[0],h[1]=g[1]+M[1],h[2]=g[2]+M[2],h[3]=g[3]+M[3],h},Ai.subtract=p,Ai.exactEquals=function(h,g){return h[0]===g[0]&&h[1]===g[1]&&h[2]===g[2]&&h[3]===g[3]},Ai.equals=function(h,g){var M=h[0],C=h[1],P=h[2],b=h[3],L=g[0],D=g[1],A=g[2],R=g[3];return Math.abs(M-L)<=t.EPSILON*Math.max(1,Math.abs(M),Math.abs(L))&&Math.abs(C-D)<=t.EPSILON*Math.max(1,Math.abs(C),Math.abs(D))&&Math.abs(P-A)<=t.EPSILON*Math.max(1,Math.abs(P),Math.abs(A))&&Math.abs(b-R)<=t.EPSILON*Math.max(1,Math.abs(b),Math.abs(R))},Ai.multiplyScalar=function(h,g,M){return h[0]=g[0]*M,h[1]=g[1]*M,h[2]=g[2]*M,h[3]=g[3]*M,h},Ai.multiplyScalarAndAdd=function(h,g,M,C){return h[0]=g[0]+M[0]*C,h[1]=g[1]+M[1]*C,h[2]=g[2]+M[2]*C,h[3]=g[3]+M[3]*C,h},Ai.sub=Ai.mul=void 0;var t=function(h,g){if(h&&h.__esModule)return h;if(h===null||s(h)!=="object"&&typeof h!="function")return{default:h};var M=n(void 0);if(M&&M.has(h))return M.get(h);var C={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var b in h)if(b!=="default"&&Object.prototype.hasOwnProperty.call(h,b)){var L=P?Object.getOwnPropertyDescriptor(h,b):null;L&&(L.get||L.set)?Object.defineProperty(C,b,L):C[b]=h[b]}return C.default=h,M&&M.set(h,C),C}(ai());function n(h){if(typeof WeakMap!="function")return null;var g=new WeakMap,M=new WeakMap;return(n=function(C){return C?M:g})(h)}function c(h,g,M){var C=g[0],P=g[1],b=g[2],L=g[3],D=M[0],A=M[1],R=M[2],B=M[3];return h[0]=C*D+b*A,h[1]=P*D+L*A,h[2]=C*R+b*B,h[3]=P*R+L*B,h}function p(h,g,M){return h[0]=g[0]-M[0],h[1]=g[1]-M[1],h[2]=g[2]-M[2],h[3]=g[3]-M[3],h}return Ai.mul=c,Ai.sub=p,Ai}var xi,kt={};function Tt(){if(xi)return kt;function s(h){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},s(h)}xi=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.create=function(){var h=new t.ARRAY_TYPE(6);return t.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[4]=0,h[5]=0),h[0]=1,h[3]=1,h},kt.clone=function(h){var g=new t.ARRAY_TYPE(6);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[3]=h[3],g[4]=h[4],g[5]=h[5],g},kt.copy=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[3],h[4]=g[4],h[5]=g[5],h},kt.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=0,h[5]=0,h},kt.fromValues=function(h,g,M,C,P,b){var L=new t.ARRAY_TYPE(6);return L[0]=h,L[1]=g,L[2]=M,L[3]=C,L[4]=P,L[5]=b,L},kt.set=function(h,g,M,C,P,b,L){return h[0]=g,h[1]=M,h[2]=C,h[3]=P,h[4]=b,h[5]=L,h},kt.invert=function(h,g){var M=g[0],C=g[1],P=g[2],b=g[3],L=g[4],D=g[5],A=M*b-C*P;return A?(h[0]=b*(A=1/A),h[1]=-C*A,h[2]=-P*A,h[3]=M*A,h[4]=(P*D-b*L)*A,h[5]=(C*L-M*D)*A,h):null},kt.determinant=function(h){return h[0]*h[3]-h[1]*h[2]},kt.multiply=c,kt.rotate=function(h,g,M){var C=g[0],P=g[1],b=g[2],L=g[3],D=g[4],A=g[5],R=Math.sin(M),B=Math.cos(M);return h[0]=C*B+b*R,h[1]=P*B+L*R,h[2]=C*-R+b*B,h[3]=P*-R+L*B,h[4]=D,h[5]=A,h},kt.scale=function(h,g,M){var C=g[1],P=g[2],b=g[3],L=g[4],D=g[5],A=M[0],R=M[1];return h[0]=g[0]*A,h[1]=C*A,h[2]=P*R,h[3]=b*R,h[4]=L,h[5]=D,h},kt.translate=function(h,g,M){var C=g[0],P=g[1],b=g[2],L=g[3],D=g[4],A=g[5],R=M[0],B=M[1];return h[0]=C,h[1]=P,h[2]=b,h[3]=L,h[4]=C*R+b*B+D,h[5]=P*R+L*B+A,h},kt.fromRotation=function(h,g){var M=Math.sin(g),C=Math.cos(g);return h[0]=C,h[1]=M,h[2]=-M,h[3]=C,h[4]=0,h[5]=0,h},kt.fromScaling=function(h,g){return h[0]=g[0],h[1]=0,h[2]=0,h[3]=g[1],h[4]=0,h[5]=0,h},kt.fromTranslation=function(h,g){return h[0]=1,h[1]=0,h[2]=0,h[3]=1,h[4]=g[0],h[5]=g[1],h},kt.str=function(h){return"mat2d("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+")"},kt.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],1)},kt.add=function(h,g,M){return h[0]=g[0]+M[0],h[1]=g[1]+M[1],h[2]=g[2]+M[2],h[3]=g[3]+M[3],h[4]=g[4]+M[4],h[5]=g[5]+M[5],h},kt.subtract=p,kt.multiplyScalar=function(h,g,M){return h[0]=g[0]*M,h[1]=g[1]*M,h[2]=g[2]*M,h[3]=g[3]*M,h[4]=g[4]*M,h[5]=g[5]*M,h},kt.multiplyScalarAndAdd=function(h,g,M,C){return h[0]=g[0]+M[0]*C,h[1]=g[1]+M[1]*C,h[2]=g[2]+M[2]*C,h[3]=g[3]+M[3]*C,h[4]=g[4]+M[4]*C,h[5]=g[5]+M[5]*C,h},kt.exactEquals=function(h,g){return h[0]===g[0]&&h[1]===g[1]&&h[2]===g[2]&&h[3]===g[3]&&h[4]===g[4]&&h[5]===g[5]},kt.equals=function(h,g){var M=h[0],C=h[1],P=h[2],b=h[3],L=h[4],D=h[5],A=g[0],R=g[1],B=g[2],q=g[3],W=g[4],ee=g[5];return Math.abs(M-A)<=t.EPSILON*Math.max(1,Math.abs(M),Math.abs(A))&&Math.abs(C-R)<=t.EPSILON*Math.max(1,Math.abs(C),Math.abs(R))&&Math.abs(P-B)<=t.EPSILON*Math.max(1,Math.abs(P),Math.abs(B))&&Math.abs(b-q)<=t.EPSILON*Math.max(1,Math.abs(b),Math.abs(q))&&Math.abs(L-W)<=t.EPSILON*Math.max(1,Math.abs(L),Math.abs(W))&&Math.abs(D-ee)<=t.EPSILON*Math.max(1,Math.abs(D),Math.abs(ee))},kt.sub=kt.mul=void 0;var t=function(h,g){if(h&&h.__esModule)return h;if(h===null||s(h)!=="object"&&typeof h!="function")return{default:h};var M=n(void 0);if(M&&M.has(h))return M.get(h);var C={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var b in h)if(b!=="default"&&Object.prototype.hasOwnProperty.call(h,b)){var L=P?Object.getOwnPropertyDescriptor(h,b):null;L&&(L.get||L.set)?Object.defineProperty(C,b,L):C[b]=h[b]}return C.default=h,M&&M.set(h,C),C}(ai());function n(h){if(typeof WeakMap!="function")return null;var g=new WeakMap,M=new WeakMap;return(n=function(C){return C?M:g})(h)}function c(h,g,M){var C=g[0],P=g[1],b=g[2],L=g[3],D=g[4],A=g[5],R=M[0],B=M[1],q=M[2],W=M[3],ee=M[4],te=M[5];return h[0]=C*R+b*B,h[1]=P*R+L*B,h[2]=C*q+b*W,h[3]=P*q+L*W,h[4]=C*ee+b*te+D,h[5]=P*ee+L*te+A,h}function p(h,g,M){return h[0]=g[0]-M[0],h[1]=g[1]-M[1],h[2]=g[2]-M[2],h[3]=g[3]-M[3],h[4]=g[4]-M[4],h[5]=g[5]-M[5],h}return kt.mul=c,kt.sub=p,kt}var ln,Xi={};function Dt(){if(ln)return Xi;function s(h){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(g){return typeof g}:function(g){return g&&typeof Symbol=="function"&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":typeof g},s(h)}ln=1,Object.defineProperty(Xi,"__esModule",{value:!0}),Xi.create=function(){var h=new t.ARRAY_TYPE(9);return t.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h},Xi.fromMat4=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[4],h[4]=g[5],h[5]=g[6],h[6]=g[8],h[7]=g[9],h[8]=g[10],h},Xi.clone=function(h){var g=new t.ARRAY_TYPE(9);return g[0]=h[0],g[1]=h[1],g[2]=h[2],g[3]=h[3],g[4]=h[4],g[5]=h[5],g[6]=h[6],g[7]=h[7],g[8]=h[8],g},Xi.copy=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=g[2],h[3]=g[3],h[4]=g[4],h[5]=g[5],h[6]=g[6],h[7]=g[7],h[8]=g[8],h},Xi.fromValues=function(h,g,M,C,P,b,L,D,A){var R=new t.ARRAY_TYPE(9);return R[0]=h,R[1]=g,R[2]=M,R[3]=C,R[4]=P,R[5]=b,R[6]=L,R[7]=D,R[8]=A,R},Xi.set=function(h,g,M,C,P,b,L,D,A,R){return h[0]=g,h[1]=M,h[2]=C,h[3]=P,h[4]=b,h[5]=L,h[6]=D,h[7]=A,h[8]=R,h},Xi.identity=function(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},Xi.transpose=function(h,g){if(h===g){var M=g[1],C=g[2],P=g[5];h[1]=g[3],h[2]=g[6],h[3]=M,h[5]=g[7],h[6]=C,h[7]=P}else h[0]=g[0],h[1]=g[3],h[2]=g[6],h[3]=g[1],h[4]=g[4],h[5]=g[7],h[6]=g[2],h[7]=g[5],h[8]=g[8];return h},Xi.invert=function(h,g){var M=g[0],C=g[1],P=g[2],b=g[3],L=g[4],D=g[5],A=g[6],R=g[7],B=g[8],q=B*L-D*R,W=-B*b+D*A,ee=R*b-L*A,te=M*q+C*W+P*ee;return te?(h[0]=q*(te=1/te),h[1]=(-B*C+P*R)*te,h[2]=(D*C-P*L)*te,h[3]=W*te,h[4]=(B*M-P*A)*te,h[5]=(-D*M+P*b)*te,h[6]=ee*te,h[7]=(-R*M+C*A)*te,h[8]=(L*M-C*b)*te,h):null},Xi.adjoint=function(h,g){var M=g[0],C=g[1],P=g[2],b=g[3],L=g[4],D=g[5],A=g[6],R=g[7],B=g[8];return h[0]=L*B-D*R,h[1]=P*R-C*B,h[2]=C*D-P*L,h[3]=D*A-b*B,h[4]=M*B-P*A,h[5]=P*b-M*D,h[6]=b*R-L*A,h[7]=C*A-M*R,h[8]=M*L-C*b,h},Xi.determinant=function(h){var g=h[3],M=h[4],C=h[5],P=h[6],b=h[7],L=h[8];return h[0]*(L*M-C*b)+h[1]*(-L*g+C*P)+h[2]*(b*g-M*P)},Xi.multiply=c,Xi.translate=function(h,g,M){var C=g[0],P=g[1],b=g[2],L=g[3],D=g[4],A=g[5],R=g[6],B=g[7],q=g[8],W=M[0],ee=M[1];return h[0]=C,h[1]=P,h[2]=b,h[3]=L,h[4]=D,h[5]=A,h[6]=W*C+ee*L+R,h[7]=W*P+ee*D+B,h[8]=W*b+ee*A+q,h},Xi.rotate=function(h,g,M){var C=g[0],P=g[1],b=g[2],L=g[3],D=g[4],A=g[5],R=g[6],B=g[7],q=g[8],W=Math.sin(M),ee=Math.cos(M);return h[0]=ee*C+W*L,h[1]=ee*P+W*D,h[2]=ee*b+W*A,h[3]=ee*L-W*C,h[4]=ee*D-W*P,h[5]=ee*A-W*b,h[6]=R,h[7]=B,h[8]=q,h},Xi.scale=function(h,g,M){var C=M[0],P=M[1];return h[0]=C*g[0],h[1]=C*g[1],h[2]=C*g[2],h[3]=P*g[3],h[4]=P*g[4],h[5]=P*g[5],h[6]=g[6],h[7]=g[7],h[8]=g[8],h},Xi.fromTranslation=function(h,g){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=1,h[5]=0,h[6]=g[0],h[7]=g[1],h[8]=1,h},Xi.fromRotation=function(h,g){var M=Math.sin(g),C=Math.cos(g);return h[0]=C,h[1]=M,h[2]=0,h[3]=-M,h[4]=C,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},Xi.fromScaling=function(h,g){return h[0]=g[0],h[1]=0,h[2]=0,h[3]=0,h[4]=g[1],h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},Xi.fromMat2d=function(h,g){return h[0]=g[0],h[1]=g[1],h[2]=0,h[3]=g[2],h[4]=g[3],h[5]=0,h[6]=g[4],h[7]=g[5],h[8]=1,h},Xi.fromQuat=function(h,g){var M=g[0],C=g[1],P=g[2],b=g[3],L=M+M,D=C+C,A=P+P,R=M*L,B=C*L,q=C*D,W=P*L,ee=P*D,te=P*A,Y=b*L,re=b*D,ce=b*A;return h[0]=1-q-te,h[3]=B-ce,h[6]=W+re,h[1]=B+ce,h[4]=1-R-te,h[7]=ee-Y,h[2]=W-re,h[5]=ee+Y,h[8]=1-R-q,h},Xi.normalFromMat4=function(h,g){var M=g[0],C=g[1],P=g[2],b=g[3],L=g[4],D=g[5],A=g[6],R=g[7],B=g[8],q=g[9],W=g[10],ee=g[11],te=g[12],Y=g[13],re=g[14],ce=g[15],ve=M*D-C*L,Be=M*A-P*L,Oe=M*R-b*L,Pe=C*A-P*D,nt=C*R-b*D,Ue=P*R-b*A,lt=B*Y-q*te,_t=B*re-W*te,dt=B*ce-ee*te,xt=q*re-W*Y,Ct=q*ce-ee*Y,Nt=W*ce-ee*re,wt=ve*Nt-Be*Ct+Oe*xt+Pe*dt-nt*_t+Ue*lt;return wt?(h[0]=(D*Nt-A*Ct+R*xt)*(wt=1/wt),h[1]=(A*dt-L*Nt-R*_t)*wt,h[2]=(L*Ct-D*dt+R*lt)*wt,h[3]=(P*Ct-C*Nt-b*xt)*wt,h[4]=(M*Nt-P*dt+b*_t)*wt,h[5]=(C*dt-M*Ct-b*lt)*wt,h[6]=(Y*Ue-re*nt+ce*Pe)*wt,h[7]=(re*Oe-te*Ue-ce*Be)*wt,h[8]=(te*nt-Y*Oe+ce*ve)*wt,h):null},Xi.projection=function(h,g,M){return h[0]=2/g,h[1]=0,h[2]=0,h[3]=0,h[4]=-2/M,h[5]=0,h[6]=-1,h[7]=1,h[8]=1,h},Xi.str=function(h){return"mat3("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+", "+h[4]+", "+h[5]+", "+h[6]+", "+h[7]+", "+h[8]+")"},Xi.frob=function(h){return Math.hypot(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8])},Xi.add=function(h,g,M){return h[0]=g[0]+M[0],h[1]=g[1]+M[1],h[2]=g[2]+M[2],h[3]=g[3]+M[3],h[4]=g[4]+M[4],h[5]=g[5]+M[5],h[6]=g[6]+M[6],h[7]=g[7]+M[7],h[8]=g[8]+M[8],h},Xi.subtract=p,Xi.multiplyScalar=function(h,g,M){return h[0]=g[0]*M,h[1]=g[1]*M,h[2]=g[2]*M,h[3]=g[3]*M,h[4]=g[4]*M,h[5]=g[5]*M,h[6]=g[6]*M,h[7]=g[7]*M,h[8]=g[8]*M,h},Xi.multiplyScalarAndAdd=function(h,g,M,C){return h[0]=g[0]+M[0]*C,h[1]=g[1]+M[1]*C,h[2]=g[2]+M[2]*C,h[3]=g[3]+M[3]*C,h[4]=g[4]+M[4]*C,h[5]=g[5]+M[5]*C,h[6]=g[6]+M[6]*C,h[7]=g[7]+M[7]*C,h[8]=g[8]+M[8]*C,h},Xi.exactEquals=function(h,g){return h[0]===g[0]&&h[1]===g[1]&&h[2]===g[2]&&h[3]===g[3]&&h[4]===g[4]&&h[5]===g[5]&&h[6]===g[6]&&h[7]===g[7]&&h[8]===g[8]},Xi.equals=function(h,g){var M=h[0],C=h[1],P=h[2],b=h[3],L=h[4],D=h[5],A=h[6],R=h[7],B=h[8],q=g[0],W=g[1],ee=g[2],te=g[3],Y=g[4],re=g[5],ce=g[6],ve=g[7],Be=g[8];return Math.abs(M-q)<=t.EPSILON*Math.max(1,Math.abs(M),Math.abs(q))&&Math.abs(C-W)<=t.EPSILON*Math.max(1,Math.abs(C),Math.abs(W))&&Math.abs(P-ee)<=t.EPSILON*Math.max(1,Math.abs(P),Math.abs(ee))&&Math.abs(b-te)<=t.EPSILON*Math.max(1,Math.abs(b),Math.abs(te))&&Math.abs(L-Y)<=t.EPSILON*Math.max(1,Math.abs(L),Math.abs(Y))&&Math.abs(D-re)<=t.EPSILON*Math.max(1,Math.abs(D),Math.abs(re))&&Math.abs(A-ce)<=t.EPSILON*Math.max(1,Math.abs(A),Math.abs(ce))&&Math.abs(R-ve)<=t.EPSILON*Math.max(1,Math.abs(R),Math.abs(ve))&&Math.abs(B-Be)<=t.EPSILON*Math.max(1,Math.abs(B),Math.abs(Be))},Xi.sub=Xi.mul=void 0;var t=function(h,g){if(h&&h.__esModule)return h;if(h===null||s(h)!=="object"&&typeof h!="function")return{default:h};var M=n(void 0);if(M&&M.has(h))return M.get(h);var C={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var b in h)if(b!=="default"&&Object.prototype.hasOwnProperty.call(h,b)){var L=P?Object.getOwnPropertyDescriptor(h,b):null;L&&(L.get||L.set)?Object.defineProperty(C,b,L):C[b]=h[b]}return C.default=h,M&&M.set(h,C),C}(ai());function n(h){if(typeof WeakMap!="function")return null;var g=new WeakMap,M=new WeakMap;return(n=function(C){return C?M:g})(h)}function c(h,g,M){var C=g[0],P=g[1],b=g[2],L=g[3],D=g[4],A=g[5],R=g[6],B=g[7],q=g[8],W=M[0],ee=M[1],te=M[2],Y=M[3],re=M[4],ce=M[5],ve=M[6],Be=M[7],Oe=M[8];return h[0]=W*C+ee*L+te*R,h[1]=W*P+ee*D+te*B,h[2]=W*b+ee*A+te*q,h[3]=Y*C+re*L+ce*R,h[4]=Y*P+re*D+ce*B,h[5]=Y*b+re*A+ce*q,h[6]=ve*C+Be*L+Oe*R,h[7]=ve*P+Be*D+Oe*B,h[8]=ve*b+Be*A+Oe*q,h}function p(h,g,M){return h[0]=g[0]-M[0],h[1]=g[1]-M[1],h[2]=g[2]-M[2],h[3]=g[3]-M[3],h[4]=g[4]-M[4],h[5]=g[5]-M[5],h[6]=g[6]-M[6],h[7]=g[7]-M[7],h[8]=g[8]-M[8],h}return Xi.mul=c,Xi.sub=p,Xi}var ni,ci={};function Nn(){if(ni)return ci;function s(b){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(L){return typeof L}:function(L){return L&&typeof Symbol=="function"&&L.constructor===Symbol&&L!==Symbol.prototype?"symbol":typeof L},s(b)}ni=1,Object.defineProperty(ci,"__esModule",{value:!0}),ci.create=function(){var b=new t.ARRAY_TYPE(16);return t.ARRAY_TYPE!=Float32Array&&(b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0),b[0]=1,b[5]=1,b[10]=1,b[15]=1,b},ci.clone=function(b){var L=new t.ARRAY_TYPE(16);return L[0]=b[0],L[1]=b[1],L[2]=b[2],L[3]=b[3],L[4]=b[4],L[5]=b[5],L[6]=b[6],L[7]=b[7],L[8]=b[8],L[9]=b[9],L[10]=b[10],L[11]=b[11],L[12]=b[12],L[13]=b[13],L[14]=b[14],L[15]=b[15],L},ci.copy=function(b,L){return b[0]=L[0],b[1]=L[1],b[2]=L[2],b[3]=L[3],b[4]=L[4],b[5]=L[5],b[6]=L[6],b[7]=L[7],b[8]=L[8],b[9]=L[9],b[10]=L[10],b[11]=L[11],b[12]=L[12],b[13]=L[13],b[14]=L[14],b[15]=L[15],b},ci.fromValues=function(b,L,D,A,R,B,q,W,ee,te,Y,re,ce,ve,Be,Oe){var Pe=new t.ARRAY_TYPE(16);return Pe[0]=b,Pe[1]=L,Pe[2]=D,Pe[3]=A,Pe[4]=R,Pe[5]=B,Pe[6]=q,Pe[7]=W,Pe[8]=ee,Pe[9]=te,Pe[10]=Y,Pe[11]=re,Pe[12]=ce,Pe[13]=ve,Pe[14]=Be,Pe[15]=Oe,Pe},ci.set=function(b,L,D,A,R,B,q,W,ee,te,Y,re,ce,ve,Be,Oe,Pe){return b[0]=L,b[1]=D,b[2]=A,b[3]=R,b[4]=B,b[5]=q,b[6]=W,b[7]=ee,b[8]=te,b[9]=Y,b[10]=re,b[11]=ce,b[12]=ve,b[13]=Be,b[14]=Oe,b[15]=Pe,b},ci.identity=c,ci.transpose=function(b,L){if(b===L){var D=L[1],A=L[2],R=L[3],B=L[6],q=L[7],W=L[11];b[1]=L[4],b[2]=L[8],b[3]=L[12],b[4]=D,b[6]=L[9],b[7]=L[13],b[8]=A,b[9]=B,b[11]=L[14],b[12]=R,b[13]=q,b[14]=W}else b[0]=L[0],b[1]=L[4],b[2]=L[8],b[3]=L[12],b[4]=L[1],b[5]=L[5],b[6]=L[9],b[7]=L[13],b[8]=L[2],b[9]=L[6],b[10]=L[10],b[11]=L[14],b[12]=L[3],b[13]=L[7],b[14]=L[11],b[15]=L[15];return b},ci.invert=function(b,L){var D=L[0],A=L[1],R=L[2],B=L[3],q=L[4],W=L[5],ee=L[6],te=L[7],Y=L[8],re=L[9],ce=L[10],ve=L[11],Be=L[12],Oe=L[13],Pe=L[14],nt=L[15],Ue=D*W-A*q,lt=D*ee-R*q,_t=D*te-B*q,dt=A*ee-R*W,xt=A*te-B*W,Ct=R*te-B*ee,Nt=Y*Oe-re*Be,wt=Y*Pe-ce*Be,gi=Y*nt-ve*Be,Ui=re*Pe-ce*Oe,mi=re*nt-ve*Oe,Dn=ce*nt-ve*Pe,Mn=Ue*Dn-lt*mi+_t*Ui+dt*gi-xt*wt+Ct*Nt;return Mn?(b[0]=(W*Dn-ee*mi+te*Ui)*(Mn=1/Mn),b[1]=(R*mi-A*Dn-B*Ui)*Mn,b[2]=(Oe*Ct-Pe*xt+nt*dt)*Mn,b[3]=(ce*xt-re*Ct-ve*dt)*Mn,b[4]=(ee*gi-q*Dn-te*wt)*Mn,b[5]=(D*Dn-R*gi+B*wt)*Mn,b[6]=(Pe*_t-Be*Ct-nt*lt)*Mn,b[7]=(Y*Ct-ce*_t+ve*lt)*Mn,b[8]=(q*mi-W*gi+te*Nt)*Mn,b[9]=(A*gi-D*mi-B*Nt)*Mn,b[10]=(Be*xt-Oe*_t+nt*Ue)*Mn,b[11]=(re*_t-Y*xt-ve*Ue)*Mn,b[12]=(W*wt-q*Ui-ee*Nt)*Mn,b[13]=(D*Ui-A*wt+R*Nt)*Mn,b[14]=(Oe*lt-Be*dt-Pe*Ue)*Mn,b[15]=(Y*dt-re*lt+ce*Ue)*Mn,b):null},ci.adjoint=function(b,L){var D=L[0],A=L[1],R=L[2],B=L[3],q=L[4],W=L[5],ee=L[6],te=L[7],Y=L[8],re=L[9],ce=L[10],ve=L[11],Be=L[12],Oe=L[13],Pe=L[14],nt=L[15];return b[0]=W*(ce*nt-ve*Pe)-re*(ee*nt-te*Pe)+Oe*(ee*ve-te*ce),b[1]=-(A*(ce*nt-ve*Pe)-re*(R*nt-B*Pe)+Oe*(R*ve-B*ce)),b[2]=A*(ee*nt-te*Pe)-W*(R*nt-B*Pe)+Oe*(R*te-B*ee),b[3]=-(A*(ee*ve-te*ce)-W*(R*ve-B*ce)+re*(R*te-B*ee)),b[4]=-(q*(ce*nt-ve*Pe)-Y*(ee*nt-te*Pe)+Be*(ee*ve-te*ce)),b[5]=D*(ce*nt-ve*Pe)-Y*(R*nt-B*Pe)+Be*(R*ve-B*ce),b[6]=-(D*(ee*nt-te*Pe)-q*(R*nt-B*Pe)+Be*(R*te-B*ee)),b[7]=D*(ee*ve-te*ce)-q*(R*ve-B*ce)+Y*(R*te-B*ee),b[8]=q*(re*nt-ve*Oe)-Y*(W*nt-te*Oe)+Be*(W*ve-te*re),b[9]=-(D*(re*nt-ve*Oe)-Y*(A*nt-B*Oe)+Be*(A*ve-B*re)),b[10]=D*(W*nt-te*Oe)-q*(A*nt-B*Oe)+Be*(A*te-B*W),b[11]=-(D*(W*ve-te*re)-q*(A*ve-B*re)+Y*(A*te-B*W)),b[12]=-(q*(re*Pe-ce*Oe)-Y*(W*Pe-ee*Oe)+Be*(W*ce-ee*re)),b[13]=D*(re*Pe-ce*Oe)-Y*(A*Pe-R*Oe)+Be*(A*ce-R*re),b[14]=-(D*(W*Pe-ee*Oe)-q*(A*Pe-R*Oe)+Be*(A*ee-R*W)),b[15]=D*(W*ce-ee*re)-q*(A*ce-R*re)+Y*(A*ee-R*W),b},ci.determinant=function(b){var L=b[0],D=b[1],A=b[2],R=b[3],B=b[4],q=b[5],W=b[6],ee=b[7],te=b[8],Y=b[9],re=b[10],ce=b[11],ve=b[12],Be=b[13],Oe=b[14],Pe=b[15];return(L*q-D*B)*(re*Pe-ce*Oe)-(L*W-A*B)*(Y*Pe-ce*Be)+(L*ee-R*B)*(Y*Oe-re*Be)+(D*W-A*q)*(te*Pe-ce*ve)-(D*ee-R*q)*(te*Oe-re*ve)+(A*ee-R*W)*(te*Be-Y*ve)},ci.multiply=p,ci.translate=function(b,L,D){var A,R,B,q,W,ee,te,Y,re,ce,ve,Be,Oe=D[0],Pe=D[1],nt=D[2];return L===b?(b[12]=L[0]*Oe+L[4]*Pe+L[8]*nt+L[12],b[13]=L[1]*Oe+L[5]*Pe+L[9]*nt+L[13],b[14]=L[2]*Oe+L[6]*Pe+L[10]*nt+L[14],b[15]=L[3]*Oe+L[7]*Pe+L[11]*nt+L[15]):(R=L[1],B=L[2],q=L[3],W=L[4],ee=L[5],te=L[6],Y=L[7],re=L[8],ce=L[9],ve=L[10],Be=L[11],b[0]=A=L[0],b[1]=R,b[2]=B,b[3]=q,b[4]=W,b[5]=ee,b[6]=te,b[7]=Y,b[8]=re,b[9]=ce,b[10]=ve,b[11]=Be,b[12]=A*Oe+W*Pe+re*nt+L[12],b[13]=R*Oe+ee*Pe+ce*nt+L[13],b[14]=B*Oe+te*Pe+ve*nt+L[14],b[15]=q*Oe+Y*Pe+Be*nt+L[15]),b},ci.scale=function(b,L,D){var A=D[0],R=D[1],B=D[2];return b[0]=L[0]*A,b[1]=L[1]*A,b[2]=L[2]*A,b[3]=L[3]*A,b[4]=L[4]*R,b[5]=L[5]*R,b[6]=L[6]*R,b[7]=L[7]*R,b[8]=L[8]*B,b[9]=L[9]*B,b[10]=L[10]*B,b[11]=L[11]*B,b[12]=L[12],b[13]=L[13],b[14]=L[14],b[15]=L[15],b},ci.rotate=function(b,L,D,A){var R,B,q,W,ee,te,Y,re,ce,ve,Be,Oe,Pe,nt,Ue,lt,_t,dt,xt,Ct,Nt,wt,gi,Ui,mi=A[0],Dn=A[1],Mn=A[2],tn=Math.hypot(mi,Dn,Mn);return tn<t.EPSILON?null:(mi*=tn=1/tn,Dn*=tn,Mn*=tn,R=Math.sin(D),B=Math.cos(D),ee=L[1],te=L[2],Y=L[3],ce=L[5],ve=L[6],Be=L[7],Pe=L[9],nt=L[10],Ue=L[11],lt=mi*mi*(q=1-B)+B,xt=mi*Dn*q-Mn*R,Ct=Dn*Dn*q+B,Nt=Mn*Dn*q+mi*R,wt=mi*Mn*q+Dn*R,gi=Dn*Mn*q-mi*R,Ui=Mn*Mn*q+B,b[0]=(W=L[0])*lt+(re=L[4])*(_t=Dn*mi*q+Mn*R)+(Oe=L[8])*(dt=Mn*mi*q-Dn*R),b[1]=ee*lt+ce*_t+Pe*dt,b[2]=te*lt+ve*_t+nt*dt,b[3]=Y*lt+Be*_t+Ue*dt,b[4]=W*xt+re*Ct+Oe*Nt,b[5]=ee*xt+ce*Ct+Pe*Nt,b[6]=te*xt+ve*Ct+nt*Nt,b[7]=Y*xt+Be*Ct+Ue*Nt,b[8]=W*wt+re*gi+Oe*Ui,b[9]=ee*wt+ce*gi+Pe*Ui,b[10]=te*wt+ve*gi+nt*Ui,b[11]=Y*wt+Be*gi+Ue*Ui,L!==b&&(b[12]=L[12],b[13]=L[13],b[14]=L[14],b[15]=L[15]),b)},ci.rotateX=function(b,L,D){var A=Math.sin(D),R=Math.cos(D),B=L[4],q=L[5],W=L[6],ee=L[7],te=L[8],Y=L[9],re=L[10],ce=L[11];return L!==b&&(b[0]=L[0],b[1]=L[1],b[2]=L[2],b[3]=L[3],b[12]=L[12],b[13]=L[13],b[14]=L[14],b[15]=L[15]),b[4]=B*R+te*A,b[5]=q*R+Y*A,b[6]=W*R+re*A,b[7]=ee*R+ce*A,b[8]=te*R-B*A,b[9]=Y*R-q*A,b[10]=re*R-W*A,b[11]=ce*R-ee*A,b},ci.rotateY=function(b,L,D){var A=Math.sin(D),R=Math.cos(D),B=L[0],q=L[1],W=L[2],ee=L[3],te=L[8],Y=L[9],re=L[10],ce=L[11];return L!==b&&(b[4]=L[4],b[5]=L[5],b[6]=L[6],b[7]=L[7],b[12]=L[12],b[13]=L[13],b[14]=L[14],b[15]=L[15]),b[0]=B*R-te*A,b[1]=q*R-Y*A,b[2]=W*R-re*A,b[3]=ee*R-ce*A,b[8]=B*A+te*R,b[9]=q*A+Y*R,b[10]=W*A+re*R,b[11]=ee*A+ce*R,b},ci.rotateZ=function(b,L,D){var A=Math.sin(D),R=Math.cos(D),B=L[0],q=L[1],W=L[2],ee=L[3],te=L[4],Y=L[5],re=L[6],ce=L[7];return L!==b&&(b[8]=L[8],b[9]=L[9],b[10]=L[10],b[11]=L[11],b[12]=L[12],b[13]=L[13],b[14]=L[14],b[15]=L[15]),b[0]=B*R+te*A,b[1]=q*R+Y*A,b[2]=W*R+re*A,b[3]=ee*R+ce*A,b[4]=te*R-B*A,b[5]=Y*R-q*A,b[6]=re*R-W*A,b[7]=ce*R-ee*A,b},ci.fromTranslation=function(b,L){return b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=L[0],b[13]=L[1],b[14]=L[2],b[15]=1,b},ci.fromScaling=function(b,L){return b[0]=L[0],b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=L[1],b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=L[2],b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},ci.fromRotation=function(b,L,D){var A,R,B,q=D[0],W=D[1],ee=D[2],te=Math.hypot(q,W,ee);return te<t.EPSILON?null:(q*=te=1/te,W*=te,ee*=te,A=Math.sin(L),R=Math.cos(L),b[0]=q*q*(B=1-R)+R,b[1]=W*q*B+ee*A,b[2]=ee*q*B-W*A,b[3]=0,b[4]=q*W*B-ee*A,b[5]=W*W*B+R,b[6]=ee*W*B+q*A,b[7]=0,b[8]=q*ee*B+W*A,b[9]=W*ee*B-q*A,b[10]=ee*ee*B+R,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b)},ci.fromXRotation=function(b,L){var D=Math.sin(L),A=Math.cos(L);return b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=A,b[6]=D,b[7]=0,b[8]=0,b[9]=-D,b[10]=A,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},ci.fromYRotation=function(b,L){var D=Math.sin(L),A=Math.cos(L);return b[0]=A,b[1]=0,b[2]=-D,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=D,b[9]=0,b[10]=A,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},ci.fromZRotation=function(b,L){var D=Math.sin(L),A=Math.cos(L);return b[0]=A,b[1]=D,b[2]=0,b[3]=0,b[4]=-D,b[5]=A,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},ci.fromRotationTranslation=h,ci.fromQuat2=function(b,L){var D=new t.ARRAY_TYPE(3),A=-L[0],R=-L[1],B=-L[2],q=L[3],W=L[4],ee=L[5],te=L[6],Y=L[7],re=A*A+R*R+B*B+q*q;return re>0?(D[0]=2*(W*q+Y*A+ee*B-te*R)/re,D[1]=2*(ee*q+Y*R+te*A-W*B)/re,D[2]=2*(te*q+Y*B+W*R-ee*A)/re):(D[0]=2*(W*q+Y*A+ee*B-te*R),D[1]=2*(ee*q+Y*R+te*A-W*B),D[2]=2*(te*q+Y*B+W*R-ee*A)),h(b,L,D),b},ci.getTranslation=function(b,L){return b[0]=L[12],b[1]=L[13],b[2]=L[14],b},ci.getScaling=g,ci.getRotation=function(b,L){var D=new t.ARRAY_TYPE(3);g(D,L);var A=1/D[0],R=1/D[1],B=1/D[2],q=L[0]*A,W=L[1]*R,ee=L[2]*B,te=L[4]*A,Y=L[5]*R,re=L[6]*B,ce=L[8]*A,ve=L[9]*R,Be=L[10]*B,Oe=q+Y+Be,Pe=0;return Oe>0?(Pe=2*Math.sqrt(Oe+1),b[3]=.25*Pe,b[0]=(re-ve)/Pe,b[1]=(ce-ee)/Pe,b[2]=(W-te)/Pe):q>Y&&q>Be?(Pe=2*Math.sqrt(1+q-Y-Be),b[3]=(re-ve)/Pe,b[0]=.25*Pe,b[1]=(W+te)/Pe,b[2]=(ce+ee)/Pe):Y>Be?(Pe=2*Math.sqrt(1+Y-q-Be),b[3]=(ce-ee)/Pe,b[0]=(W+te)/Pe,b[1]=.25*Pe,b[2]=(re+ve)/Pe):(Pe=2*Math.sqrt(1+Be-q-Y),b[3]=(W-te)/Pe,b[0]=(ce+ee)/Pe,b[1]=(re+ve)/Pe,b[2]=.25*Pe),b},ci.fromRotationTranslationScale=function(b,L,D,A){var R=L[0],B=L[1],q=L[2],W=L[3],ee=R+R,te=B+B,Y=q+q,re=R*ee,ce=R*te,ve=R*Y,Be=B*te,Oe=B*Y,Pe=q*Y,nt=W*ee,Ue=W*te,lt=W*Y,_t=A[0],dt=A[1],xt=A[2];return b[0]=(1-(Be+Pe))*_t,b[1]=(ce+lt)*_t,b[2]=(ve-Ue)*_t,b[3]=0,b[4]=(ce-lt)*dt,b[5]=(1-(re+Pe))*dt,b[6]=(Oe+nt)*dt,b[7]=0,b[8]=(ve+Ue)*xt,b[9]=(Oe-nt)*xt,b[10]=(1-(re+Be))*xt,b[11]=0,b[12]=D[0],b[13]=D[1],b[14]=D[2],b[15]=1,b},ci.fromRotationTranslationScaleOrigin=function(b,L,D,A,R){var B=L[0],q=L[1],W=L[2],ee=L[3],te=B+B,Y=q+q,re=W+W,ce=B*te,ve=B*Y,Be=B*re,Oe=q*Y,Pe=q*re,nt=W*re,Ue=ee*te,lt=ee*Y,_t=ee*re,dt=A[0],xt=A[1],Ct=A[2],Nt=R[0],wt=R[1],gi=R[2],Ui=(1-(Oe+nt))*dt,mi=(ve+_t)*dt,Dn=(Be-lt)*dt,Mn=(ve-_t)*xt,tn=(1-(ce+nt))*xt,qi=(Pe+Ue)*xt,nr=(Be+lt)*Ct,Fn=(Pe-Ue)*Ct,Hn=(1-(ce+Oe))*Ct;return b[0]=Ui,b[1]=mi,b[2]=Dn,b[3]=0,b[4]=Mn,b[5]=tn,b[6]=qi,b[7]=0,b[8]=nr,b[9]=Fn,b[10]=Hn,b[11]=0,b[12]=D[0]+Nt-(Ui*Nt+Mn*wt+nr*gi),b[13]=D[1]+wt-(mi*Nt+tn*wt+Fn*gi),b[14]=D[2]+gi-(Dn*Nt+qi*wt+Hn*gi),b[15]=1,b},ci.fromQuat=function(b,L){var D=L[0],A=L[1],R=L[2],B=L[3],q=D+D,W=A+A,ee=R+R,te=D*q,Y=A*q,re=A*W,ce=R*q,ve=R*W,Be=R*ee,Oe=B*q,Pe=B*W,nt=B*ee;return b[0]=1-re-Be,b[1]=Y+nt,b[2]=ce-Pe,b[3]=0,b[4]=Y-nt,b[5]=1-te-Be,b[6]=ve+Oe,b[7]=0,b[8]=ce+Pe,b[9]=ve-Oe,b[10]=1-te-re,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b},ci.frustum=function(b,L,D,A,R,B,q){var W=1/(D-L),ee=1/(R-A),te=1/(B-q);return b[0]=2*B*W,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=2*B*ee,b[6]=0,b[7]=0,b[8]=(D+L)*W,b[9]=(R+A)*ee,b[10]=(q+B)*te,b[11]=-1,b[12]=0,b[13]=0,b[14]=q*B*2*te,b[15]=0,b},ci.perspectiveNO=M,ci.perspectiveZO=function(b,L,D,A,R){var B,q=1/Math.tan(L/2);return b[0]=q/D,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=q,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=-1,b[12]=0,b[13]=0,b[15]=0,R!=null&&R!==1/0?(b[10]=R*(B=1/(A-R)),b[14]=R*A*B):(b[10]=-1,b[14]=-A),b},ci.perspectiveFromFieldOfView=function(b,L,D,A){var R=Math.tan(L.upDegrees*Math.PI/180),B=Math.tan(L.downDegrees*Math.PI/180),q=Math.tan(L.leftDegrees*Math.PI/180),W=Math.tan(L.rightDegrees*Math.PI/180),ee=2/(q+W),te=2/(R+B);return b[0]=ee,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=te,b[6]=0,b[7]=0,b[8]=-(q-W)*ee*.5,b[9]=(R-B)*te*.5,b[10]=A/(D-A),b[11]=-1,b[12]=0,b[13]=0,b[14]=A*D/(D-A),b[15]=0,b},ci.orthoNO=C,ci.orthoZO=function(b,L,D,A,R,B,q){var W=1/(L-D),ee=1/(A-R),te=1/(B-q);return b[0]=-2*W,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=-2*ee,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=te,b[11]=0,b[12]=(L+D)*W,b[13]=(R+A)*ee,b[14]=B*te,b[15]=1,b},ci.lookAt=function(b,L,D,A){var R,B,q,W,ee,te,Y,re,ce,ve,Be=L[0],Oe=L[1],Pe=L[2],nt=A[0],Ue=A[1],lt=A[2],_t=D[0],dt=D[1],xt=D[2];return Math.abs(Be-_t)<t.EPSILON&&Math.abs(Oe-dt)<t.EPSILON&&Math.abs(Pe-xt)<t.EPSILON?c(b):(Y=Be-_t,re=Oe-dt,ce=Pe-xt,R=Ue*(ce*=ve=1/Math.hypot(Y,re,ce))-lt*(re*=ve),B=lt*(Y*=ve)-nt*ce,q=nt*re-Ue*Y,(ve=Math.hypot(R,B,q))?(R*=ve=1/ve,B*=ve,q*=ve):(R=0,B=0,q=0),W=re*q-ce*B,ee=ce*R-Y*q,te=Y*B-re*R,(ve=Math.hypot(W,ee,te))?(W*=ve=1/ve,ee*=ve,te*=ve):(W=0,ee=0,te=0),b[0]=R,b[1]=W,b[2]=Y,b[3]=0,b[4]=B,b[5]=ee,b[6]=re,b[7]=0,b[8]=q,b[9]=te,b[10]=ce,b[11]=0,b[12]=-(R*Be+B*Oe+q*Pe),b[13]=-(W*Be+ee*Oe+te*Pe),b[14]=-(Y*Be+re*Oe+ce*Pe),b[15]=1,b)},ci.targetTo=function(b,L,D,A){var R=L[0],B=L[1],q=L[2],W=A[0],ee=A[1],te=A[2],Y=R-D[0],re=B-D[1],ce=q-D[2],ve=Y*Y+re*re+ce*ce;ve>0&&(Y*=ve=1/Math.sqrt(ve),re*=ve,ce*=ve);var Be=ee*ce-te*re,Oe=te*Y-W*ce,Pe=W*re-ee*Y;return(ve=Be*Be+Oe*Oe+Pe*Pe)>0&&(Be*=ve=1/Math.sqrt(ve),Oe*=ve,Pe*=ve),b[0]=Be,b[1]=Oe,b[2]=Pe,b[3]=0,b[4]=re*Pe-ce*Oe,b[5]=ce*Be-Y*Pe,b[6]=Y*Oe-re*Be,b[7]=0,b[8]=Y,b[9]=re,b[10]=ce,b[11]=0,b[12]=R,b[13]=B,b[14]=q,b[15]=1,b},ci.str=function(b){return"mat4("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+", "+b[9]+", "+b[10]+", "+b[11]+", "+b[12]+", "+b[13]+", "+b[14]+", "+b[15]+")"},ci.frob=function(b){return Math.hypot(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12],b[13],b[14],b[15])},ci.add=function(b,L,D){return b[0]=L[0]+D[0],b[1]=L[1]+D[1],b[2]=L[2]+D[2],b[3]=L[3]+D[3],b[4]=L[4]+D[4],b[5]=L[5]+D[5],b[6]=L[6]+D[6],b[7]=L[7]+D[7],b[8]=L[8]+D[8],b[9]=L[9]+D[9],b[10]=L[10]+D[10],b[11]=L[11]+D[11],b[12]=L[12]+D[12],b[13]=L[13]+D[13],b[14]=L[14]+D[14],b[15]=L[15]+D[15],b},ci.subtract=P,ci.multiplyScalar=function(b,L,D){return b[0]=L[0]*D,b[1]=L[1]*D,b[2]=L[2]*D,b[3]=L[3]*D,b[4]=L[4]*D,b[5]=L[5]*D,b[6]=L[6]*D,b[7]=L[7]*D,b[8]=L[8]*D,b[9]=L[9]*D,b[10]=L[10]*D,b[11]=L[11]*D,b[12]=L[12]*D,b[13]=L[13]*D,b[14]=L[14]*D,b[15]=L[15]*D,b},ci.multiplyScalarAndAdd=function(b,L,D,A){return b[0]=L[0]+D[0]*A,b[1]=L[1]+D[1]*A,b[2]=L[2]+D[2]*A,b[3]=L[3]+D[3]*A,b[4]=L[4]+D[4]*A,b[5]=L[5]+D[5]*A,b[6]=L[6]+D[6]*A,b[7]=L[7]+D[7]*A,b[8]=L[8]+D[8]*A,b[9]=L[9]+D[9]*A,b[10]=L[10]+D[10]*A,b[11]=L[11]+D[11]*A,b[12]=L[12]+D[12]*A,b[13]=L[13]+D[13]*A,b[14]=L[14]+D[14]*A,b[15]=L[15]+D[15]*A,b},ci.exactEquals=function(b,L){return b[0]===L[0]&&b[1]===L[1]&&b[2]===L[2]&&b[3]===L[3]&&b[4]===L[4]&&b[5]===L[5]&&b[6]===L[6]&&b[7]===L[7]&&b[8]===L[8]&&b[9]===L[9]&&b[10]===L[10]&&b[11]===L[11]&&b[12]===L[12]&&b[13]===L[13]&&b[14]===L[14]&&b[15]===L[15]},ci.equals=function(b,L){var D=b[0],A=b[1],R=b[2],B=b[3],q=b[4],W=b[5],ee=b[6],te=b[7],Y=b[8],re=b[9],ce=b[10],ve=b[11],Be=b[12],Oe=b[13],Pe=b[14],nt=b[15],Ue=L[0],lt=L[1],_t=L[2],dt=L[3],xt=L[4],Ct=L[5],Nt=L[6],wt=L[7],gi=L[8],Ui=L[9],mi=L[10],Dn=L[11],Mn=L[12],tn=L[13],qi=L[14],nr=L[15];return Math.abs(D-Ue)<=t.EPSILON*Math.max(1,Math.abs(D),Math.abs(Ue))&&Math.abs(A-lt)<=t.EPSILON*Math.max(1,Math.abs(A),Math.abs(lt))&&Math.abs(R-_t)<=t.EPSILON*Math.max(1,Math.abs(R),Math.abs(_t))&&Math.abs(B-dt)<=t.EPSILON*Math.max(1,Math.abs(B),Math.abs(dt))&&Math.abs(q-xt)<=t.EPSILON*Math.max(1,Math.abs(q),Math.abs(xt))&&Math.abs(W-Ct)<=t.EPSILON*Math.max(1,Math.abs(W),Math.abs(Ct))&&Math.abs(ee-Nt)<=t.EPSILON*Math.max(1,Math.abs(ee),Math.abs(Nt))&&Math.abs(te-wt)<=t.EPSILON*Math.max(1,Math.abs(te),Math.abs(wt))&&Math.abs(Y-gi)<=t.EPSILON*Math.max(1,Math.abs(Y),Math.abs(gi))&&Math.abs(re-Ui)<=t.EPSILON*Math.max(1,Math.abs(re),Math.abs(Ui))&&Math.abs(ce-mi)<=t.EPSILON*Math.max(1,Math.abs(ce),Math.abs(mi))&&Math.abs(ve-Dn)<=t.EPSILON*Math.max(1,Math.abs(ve),Math.abs(Dn))&&Math.abs(Be-Mn)<=t.EPSILON*Math.max(1,Math.abs(Be),Math.abs(Mn))&&Math.abs(Oe-tn)<=t.EPSILON*Math.max(1,Math.abs(Oe),Math.abs(tn))&&Math.abs(Pe-qi)<=t.EPSILON*Math.max(1,Math.abs(Pe),Math.abs(qi))&&Math.abs(nt-nr)<=t.EPSILON*Math.max(1,Math.abs(nt),Math.abs(nr))},ci.sub=ci.mul=ci.ortho=ci.perspective=void 0;var t=function(b,L){if(b&&b.__esModule)return b;if(b===null||s(b)!=="object"&&typeof b!="function")return{default:b};var D=n(void 0);if(D&&D.has(b))return D.get(b);var A={},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in b)if(B!=="default"&&Object.prototype.hasOwnProperty.call(b,B)){var q=R?Object.getOwnPropertyDescriptor(b,B):null;q&&(q.get||q.set)?Object.defineProperty(A,B,q):A[B]=b[B]}return A.default=b,D&&D.set(b,A),A}(ai());function n(b){if(typeof WeakMap!="function")return null;var L=new WeakMap,D=new WeakMap;return(n=function(A){return A?D:L})(b)}function c(b){return b[0]=1,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=1,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=1,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b}function p(b,L,D){var A=L[0],R=L[1],B=L[2],q=L[3],W=L[4],ee=L[5],te=L[6],Y=L[7],re=L[8],ce=L[9],ve=L[10],Be=L[11],Oe=L[12],Pe=L[13],nt=L[14],Ue=L[15],lt=D[0],_t=D[1],dt=D[2],xt=D[3];return b[0]=lt*A+_t*W+dt*re+xt*Oe,b[1]=lt*R+_t*ee+dt*ce+xt*Pe,b[2]=lt*B+_t*te+dt*ve+xt*nt,b[3]=lt*q+_t*Y+dt*Be+xt*Ue,b[4]=(lt=D[4])*A+(_t=D[5])*W+(dt=D[6])*re+(xt=D[7])*Oe,b[5]=lt*R+_t*ee+dt*ce+xt*Pe,b[6]=lt*B+_t*te+dt*ve+xt*nt,b[7]=lt*q+_t*Y+dt*Be+xt*Ue,b[8]=(lt=D[8])*A+(_t=D[9])*W+(dt=D[10])*re+(xt=D[11])*Oe,b[9]=lt*R+_t*ee+dt*ce+xt*Pe,b[10]=lt*B+_t*te+dt*ve+xt*nt,b[11]=lt*q+_t*Y+dt*Be+xt*Ue,b[12]=(lt=D[12])*A+(_t=D[13])*W+(dt=D[14])*re+(xt=D[15])*Oe,b[13]=lt*R+_t*ee+dt*ce+xt*Pe,b[14]=lt*B+_t*te+dt*ve+xt*nt,b[15]=lt*q+_t*Y+dt*Be+xt*Ue,b}function h(b,L,D){var A=L[0],R=L[1],B=L[2],q=L[3],W=A+A,ee=R+R,te=B+B,Y=A*W,re=A*ee,ce=A*te,ve=R*ee,Be=R*te,Oe=B*te,Pe=q*W,nt=q*ee,Ue=q*te;return b[0]=1-(ve+Oe),b[1]=re+Ue,b[2]=ce-nt,b[3]=0,b[4]=re-Ue,b[5]=1-(Y+Oe),b[6]=Be+Pe,b[7]=0,b[8]=ce+nt,b[9]=Be-Pe,b[10]=1-(Y+ve),b[11]=0,b[12]=D[0],b[13]=D[1],b[14]=D[2],b[15]=1,b}function g(b,L){var D=L[4],A=L[5],R=L[6],B=L[8],q=L[9],W=L[10];return b[0]=Math.hypot(L[0],L[1],L[2]),b[1]=Math.hypot(D,A,R),b[2]=Math.hypot(B,q,W),b}function M(b,L,D,A,R){var B,q=1/Math.tan(L/2);return b[0]=q/D,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=q,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[11]=-1,b[12]=0,b[13]=0,b[15]=0,R!=null&&R!==1/0?(b[10]=(R+A)*(B=1/(A-R)),b[14]=2*R*A*B):(b[10]=-1,b[14]=-2*A),b}function C(b,L,D,A,R,B,q){var W=1/(L-D),ee=1/(A-R),te=1/(B-q);return b[0]=-2*W,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=-2*ee,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=2*te,b[11]=0,b[12]=(L+D)*W,b[13]=(R+A)*ee,b[14]=(q+B)*te,b[15]=1,b}function P(b,L,D){return b[0]=L[0]-D[0],b[1]=L[1]-D[1],b[2]=L[2]-D[2],b[3]=L[3]-D[3],b[4]=L[4]-D[4],b[5]=L[5]-D[5],b[6]=L[6]-D[6],b[7]=L[7]-D[7],b[8]=L[8]-D[8],b[9]=L[9]-D[9],b[10]=L[10]-D[10],b[11]=L[11]-D[11],b[12]=L[12]-D[12],b[13]=L[13]-D[13],b[14]=L[14]-D[14],b[15]=L[15]-D[15],b}return ci.perspective=M,ci.ortho=C,ci.mul=p,ci.sub=P,ci}var Fi,oi={},Ci={};function Zt(){if(Fi)return Ci;function s(R){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(B){return typeof B}:function(B){return B&&typeof Symbol=="function"&&B.constructor===Symbol&&B!==Symbol.prototype?"symbol":typeof B},s(R)}Fi=1,Object.defineProperty(Ci,"__esModule",{value:!0}),Ci.create=c,Ci.clone=function(R){var B=new t.ARRAY_TYPE(3);return B[0]=R[0],B[1]=R[1],B[2]=R[2],B},Ci.length=p,Ci.fromValues=function(R,B,q){var W=new t.ARRAY_TYPE(3);return W[0]=R,W[1]=B,W[2]=q,W},Ci.copy=function(R,B){return R[0]=B[0],R[1]=B[1],R[2]=B[2],R},Ci.set=function(R,B,q,W){return R[0]=B,R[1]=q,R[2]=W,R},Ci.add=function(R,B,q){return R[0]=B[0]+q[0],R[1]=B[1]+q[1],R[2]=B[2]+q[2],R},Ci.subtract=h,Ci.multiply=g,Ci.divide=M,Ci.ceil=function(R,B){return R[0]=Math.ceil(B[0]),R[1]=Math.ceil(B[1]),R[2]=Math.ceil(B[2]),R},Ci.floor=function(R,B){return R[0]=Math.floor(B[0]),R[1]=Math.floor(B[1]),R[2]=Math.floor(B[2]),R},Ci.min=function(R,B,q){return R[0]=Math.min(B[0],q[0]),R[1]=Math.min(B[1],q[1]),R[2]=Math.min(B[2],q[2]),R},Ci.max=function(R,B,q){return R[0]=Math.max(B[0],q[0]),R[1]=Math.max(B[1],q[1]),R[2]=Math.max(B[2],q[2]),R},Ci.round=function(R,B){return R[0]=Math.round(B[0]),R[1]=Math.round(B[1]),R[2]=Math.round(B[2]),R},Ci.scale=function(R,B,q){return R[0]=B[0]*q,R[1]=B[1]*q,R[2]=B[2]*q,R},Ci.scaleAndAdd=function(R,B,q,W){return R[0]=B[0]+q[0]*W,R[1]=B[1]+q[1]*W,R[2]=B[2]+q[2]*W,R},Ci.distance=C,Ci.squaredDistance=P,Ci.squaredLength=b,Ci.negate=function(R,B){return R[0]=-B[0],R[1]=-B[1],R[2]=-B[2],R},Ci.inverse=function(R,B){return R[0]=1/B[0],R[1]=1/B[1],R[2]=1/B[2],R},Ci.normalize=function(R,B){var q=B[0],W=B[1],ee=B[2],te=q*q+W*W+ee*ee;return te>0&&(te=1/Math.sqrt(te)),R[0]=B[0]*te,R[1]=B[1]*te,R[2]=B[2]*te,R},Ci.dot=L,Ci.cross=function(R,B,q){var W=B[0],ee=B[1],te=B[2],Y=q[0],re=q[1],ce=q[2];return R[0]=ee*ce-te*re,R[1]=te*Y-W*ce,R[2]=W*re-ee*Y,R},Ci.lerp=function(R,B,q,W){var ee=B[0],te=B[1],Y=B[2];return R[0]=ee+W*(q[0]-ee),R[1]=te+W*(q[1]-te),R[2]=Y+W*(q[2]-Y),R},Ci.hermite=function(R,B,q,W,ee,te){var Y=te*te,re=Y*(2*te-3)+1,ce=Y*(te-2)+te,ve=Y*(te-1),Be=Y*(3-2*te);return R[0]=B[0]*re+q[0]*ce+W[0]*ve+ee[0]*Be,R[1]=B[1]*re+q[1]*ce+W[1]*ve+ee[1]*Be,R[2]=B[2]*re+q[2]*ce+W[2]*ve+ee[2]*Be,R},Ci.bezier=function(R,B,q,W,ee,te){var Y=1-te,re=Y*Y,ce=te*te,ve=re*Y,Be=3*te*re,Oe=3*ce*Y,Pe=ce*te;return R[0]=B[0]*ve+q[0]*Be+W[0]*Oe+ee[0]*Pe,R[1]=B[1]*ve+q[1]*Be+W[1]*Oe+ee[1]*Pe,R[2]=B[2]*ve+q[2]*Be+W[2]*Oe+ee[2]*Pe,R},Ci.random=function(R,B){B=B||1;var q=2*t.RANDOM()*Math.PI,W=2*t.RANDOM()-1,ee=Math.sqrt(1-W*W)*B;return R[0]=Math.cos(q)*ee,R[1]=Math.sin(q)*ee,R[2]=W*B,R},Ci.transformMat4=function(R,B,q){var W=B[0],ee=B[1],te=B[2],Y=q[3]*W+q[7]*ee+q[11]*te+q[15];return R[0]=(q[0]*W+q[4]*ee+q[8]*te+q[12])/(Y=Y||1),R[1]=(q[1]*W+q[5]*ee+q[9]*te+q[13])/Y,R[2]=(q[2]*W+q[6]*ee+q[10]*te+q[14])/Y,R},Ci.transformMat3=function(R,B,q){var W=B[0],ee=B[1],te=B[2];return R[0]=W*q[0]+ee*q[3]+te*q[6],R[1]=W*q[1]+ee*q[4]+te*q[7],R[2]=W*q[2]+ee*q[5]+te*q[8],R},Ci.transformQuat=function(R,B,q){var W=q[0],ee=q[1],te=q[2],Y=B[0],re=B[1],ce=B[2],ve=ee*ce-te*re,Be=te*Y-W*ce,Oe=W*re-ee*Y,Pe=ee*Oe-te*Be,nt=te*ve-W*Oe,Ue=W*Be-ee*ve,lt=2*q[3];return Be*=lt,Oe*=lt,nt*=2,Ue*=2,R[0]=Y+(ve*=lt)+(Pe*=2),R[1]=re+Be+nt,R[2]=ce+Oe+Ue,R},Ci.rotateX=function(R,B,q,W){var ee=[],te=[];return ee[0]=B[0]-q[0],ee[1]=B[1]-q[1],ee[2]=B[2]-q[2],te[0]=ee[0],te[1]=ee[1]*Math.cos(W)-ee[2]*Math.sin(W),te[2]=ee[1]*Math.sin(W)+ee[2]*Math.cos(W),R[0]=te[0]+q[0],R[1]=te[1]+q[1],R[2]=te[2]+q[2],R},Ci.rotateY=function(R,B,q,W){var ee=[],te=[];return ee[0]=B[0]-q[0],ee[1]=B[1]-q[1],ee[2]=B[2]-q[2],te[0]=ee[2]*Math.sin(W)+ee[0]*Math.cos(W),te[1]=ee[1],te[2]=ee[2]*Math.cos(W)-ee[0]*Math.sin(W),R[0]=te[0]+q[0],R[1]=te[1]+q[1],R[2]=te[2]+q[2],R},Ci.rotateZ=function(R,B,q,W){var ee=[],te=[];return ee[0]=B[0]-q[0],ee[1]=B[1]-q[1],ee[2]=B[2]-q[2],te[0]=ee[0]*Math.cos(W)-ee[1]*Math.sin(W),te[1]=ee[0]*Math.sin(W)+ee[1]*Math.cos(W),te[2]=ee[2],R[0]=te[0]+q[0],R[1]=te[1]+q[1],R[2]=te[2]+q[2],R},Ci.angle=function(R,B){var q=R[0],W=R[1],ee=R[2],te=B[0],Y=B[1],re=B[2],ce=Math.sqrt(q*q+W*W+ee*ee)*Math.sqrt(te*te+Y*Y+re*re),ve=ce&&L(R,B)/ce;return Math.acos(Math.min(Math.max(ve,-1),1))},Ci.zero=function(R){return R[0]=0,R[1]=0,R[2]=0,R},Ci.str=function(R){return"vec3("+R[0]+", "+R[1]+", "+R[2]+")"},Ci.exactEquals=function(R,B){return R[0]===B[0]&&R[1]===B[1]&&R[2]===B[2]},Ci.equals=function(R,B){var q=R[0],W=R[1],ee=R[2],te=B[0],Y=B[1],re=B[2];return Math.abs(q-te)<=t.EPSILON*Math.max(1,Math.abs(q),Math.abs(te))&&Math.abs(W-Y)<=t.EPSILON*Math.max(1,Math.abs(W),Math.abs(Y))&&Math.abs(ee-re)<=t.EPSILON*Math.max(1,Math.abs(ee),Math.abs(re))},Ci.forEach=Ci.sqrLen=Ci.len=Ci.sqrDist=Ci.dist=Ci.div=Ci.mul=Ci.sub=void 0;var t=function(R,B){if(R&&R.__esModule)return R;if(R===null||s(R)!=="object"&&typeof R!="function")return{default:R};var q=n(void 0);if(q&&q.has(R))return q.get(R);var W={},ee=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var te in R)if(te!=="default"&&Object.prototype.hasOwnProperty.call(R,te)){var Y=ee?Object.getOwnPropertyDescriptor(R,te):null;Y&&(Y.get||Y.set)?Object.defineProperty(W,te,Y):W[te]=R[te]}return W.default=R,q&&q.set(R,W),W}(ai());function n(R){if(typeof WeakMap!="function")return null;var B=new WeakMap,q=new WeakMap;return(n=function(W){return W?q:B})(R)}function c(){var R=new t.ARRAY_TYPE(3);return t.ARRAY_TYPE!=Float32Array&&(R[0]=0,R[1]=0,R[2]=0),R}function p(R){return Math.hypot(R[0],R[1],R[2])}function h(R,B,q){return R[0]=B[0]-q[0],R[1]=B[1]-q[1],R[2]=B[2]-q[2],R}function g(R,B,q){return R[0]=B[0]*q[0],R[1]=B[1]*q[1],R[2]=B[2]*q[2],R}function M(R,B,q){return R[0]=B[0]/q[0],R[1]=B[1]/q[1],R[2]=B[2]/q[2],R}function C(R,B){return Math.hypot(B[0]-R[0],B[1]-R[1],B[2]-R[2])}function P(R,B){var q=B[0]-R[0],W=B[1]-R[1],ee=B[2]-R[2];return q*q+W*W+ee*ee}function b(R){var B=R[0],q=R[1],W=R[2];return B*B+q*q+W*W}function L(R,B){return R[0]*B[0]+R[1]*B[1]+R[2]*B[2]}Ci.sub=h,Ci.mul=g,Ci.div=M,Ci.dist=C,Ci.sqrDist=P,Ci.len=p,Ci.sqrLen=b;var D,A=(D=c(),function(R,B,q,W,ee,te){var Y,re;for(B||(B=3),q||(q=0),re=W?Math.min(W*B+q,R.length):R.length,Y=q;Y<re;Y+=B)D[0]=R[Y],D[1]=R[Y+1],D[2]=R[Y+2],ee(D,D,te),R[Y]=D[0],R[Y+1]=D[1],R[Y+2]=D[2];return R});return Ci.forEach=A,Ci}var Yt,vi,ae={};function ge(){if(Yt)return ae;function s(A){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},s(A)}Yt=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.create=c,ae.clone=function(A){var R=new t.ARRAY_TYPE(4);return R[0]=A[0],R[1]=A[1],R[2]=A[2],R[3]=A[3],R},ae.fromValues=function(A,R,B,q){var W=new t.ARRAY_TYPE(4);return W[0]=A,W[1]=R,W[2]=B,W[3]=q,W},ae.copy=function(A,R){return A[0]=R[0],A[1]=R[1],A[2]=R[2],A[3]=R[3],A},ae.set=function(A,R,B,q,W){return A[0]=R,A[1]=B,A[2]=q,A[3]=W,A},ae.add=function(A,R,B){return A[0]=R[0]+B[0],A[1]=R[1]+B[1],A[2]=R[2]+B[2],A[3]=R[3]+B[3],A},ae.subtract=p,ae.multiply=h,ae.divide=g,ae.ceil=function(A,R){return A[0]=Math.ceil(R[0]),A[1]=Math.ceil(R[1]),A[2]=Math.ceil(R[2]),A[3]=Math.ceil(R[3]),A},ae.floor=function(A,R){return A[0]=Math.floor(R[0]),A[1]=Math.floor(R[1]),A[2]=Math.floor(R[2]),A[3]=Math.floor(R[3]),A},ae.min=function(A,R,B){return A[0]=Math.min(R[0],B[0]),A[1]=Math.min(R[1],B[1]),A[2]=Math.min(R[2],B[2]),A[3]=Math.min(R[3],B[3]),A},ae.max=function(A,R,B){return A[0]=Math.max(R[0],B[0]),A[1]=Math.max(R[1],B[1]),A[2]=Math.max(R[2],B[2]),A[3]=Math.max(R[3],B[3]),A},ae.round=function(A,R){return A[0]=Math.round(R[0]),A[1]=Math.round(R[1]),A[2]=Math.round(R[2]),A[3]=Math.round(R[3]),A},ae.scale=function(A,R,B){return A[0]=R[0]*B,A[1]=R[1]*B,A[2]=R[2]*B,A[3]=R[3]*B,A},ae.scaleAndAdd=function(A,R,B,q){return A[0]=R[0]+B[0]*q,A[1]=R[1]+B[1]*q,A[2]=R[2]+B[2]*q,A[3]=R[3]+B[3]*q,A},ae.distance=M,ae.squaredDistance=C,ae.length=P,ae.squaredLength=b,ae.negate=function(A,R){return A[0]=-R[0],A[1]=-R[1],A[2]=-R[2],A[3]=-R[3],A},ae.inverse=function(A,R){return A[0]=1/R[0],A[1]=1/R[1],A[2]=1/R[2],A[3]=1/R[3],A},ae.normalize=function(A,R){var B=R[0],q=R[1],W=R[2],ee=R[3],te=B*B+q*q+W*W+ee*ee;return te>0&&(te=1/Math.sqrt(te)),A[0]=B*te,A[1]=q*te,A[2]=W*te,A[3]=ee*te,A},ae.dot=function(A,R){return A[0]*R[0]+A[1]*R[1]+A[2]*R[2]+A[3]*R[3]},ae.cross=function(A,R,B,q){var W=B[0]*q[1]-B[1]*q[0],ee=B[0]*q[2]-B[2]*q[0],te=B[0]*q[3]-B[3]*q[0],Y=B[1]*q[2]-B[2]*q[1],re=B[1]*q[3]-B[3]*q[1],ce=B[2]*q[3]-B[3]*q[2],ve=R[0],Be=R[1],Oe=R[2],Pe=R[3];return A[0]=Be*ce-Oe*re+Pe*Y,A[1]=-ve*ce+Oe*te-Pe*ee,A[2]=ve*re-Be*te+Pe*W,A[3]=-ve*Y+Be*ee-Oe*W,A},ae.lerp=function(A,R,B,q){var W=R[0],ee=R[1],te=R[2],Y=R[3];return A[0]=W+q*(B[0]-W),A[1]=ee+q*(B[1]-ee),A[2]=te+q*(B[2]-te),A[3]=Y+q*(B[3]-Y),A},ae.random=function(A,R){var B,q,W,ee,te,Y;R=R||1;do te=(B=2*t.RANDOM()-1)*B+(q=2*t.RANDOM()-1)*q;while(te>=1);do Y=(W=2*t.RANDOM()-1)*W+(ee=2*t.RANDOM()-1)*ee;while(Y>=1);var re=Math.sqrt((1-te)/Y);return A[0]=R*B,A[1]=R*q,A[2]=R*W*re,A[3]=R*ee*re,A},ae.transformMat4=function(A,R,B){var q=R[0],W=R[1],ee=R[2],te=R[3];return A[0]=B[0]*q+B[4]*W+B[8]*ee+B[12]*te,A[1]=B[1]*q+B[5]*W+B[9]*ee+B[13]*te,A[2]=B[2]*q+B[6]*W+B[10]*ee+B[14]*te,A[3]=B[3]*q+B[7]*W+B[11]*ee+B[15]*te,A},ae.transformQuat=function(A,R,B){var q=R[0],W=R[1],ee=R[2],te=B[0],Y=B[1],re=B[2],ce=B[3],ve=ce*q+Y*ee-re*W,Be=ce*W+re*q-te*ee,Oe=ce*ee+te*W-Y*q,Pe=-te*q-Y*W-re*ee;return A[0]=ve*ce+Pe*-te+Be*-re-Oe*-Y,A[1]=Be*ce+Pe*-Y+Oe*-te-ve*-re,A[2]=Oe*ce+Pe*-re+ve*-Y-Be*-te,A[3]=R[3],A},ae.zero=function(A){return A[0]=0,A[1]=0,A[2]=0,A[3]=0,A},ae.str=function(A){return"vec4("+A[0]+", "+A[1]+", "+A[2]+", "+A[3]+")"},ae.exactEquals=function(A,R){return A[0]===R[0]&&A[1]===R[1]&&A[2]===R[2]&&A[3]===R[3]},ae.equals=function(A,R){var B=A[0],q=A[1],W=A[2],ee=A[3],te=R[0],Y=R[1],re=R[2],ce=R[3];return Math.abs(B-te)<=t.EPSILON*Math.max(1,Math.abs(B),Math.abs(te))&&Math.abs(q-Y)<=t.EPSILON*Math.max(1,Math.abs(q),Math.abs(Y))&&Math.abs(W-re)<=t.EPSILON*Math.max(1,Math.abs(W),Math.abs(re))&&Math.abs(ee-ce)<=t.EPSILON*Math.max(1,Math.abs(ee),Math.abs(ce))},ae.forEach=ae.sqrLen=ae.len=ae.sqrDist=ae.dist=ae.div=ae.mul=ae.sub=void 0;var t=function(A,R){if(A&&A.__esModule)return A;if(A===null||s(A)!=="object"&&typeof A!="function")return{default:A};var B=n(void 0);if(B&&B.has(A))return B.get(A);var q={},W=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ee in A)if(ee!=="default"&&Object.prototype.hasOwnProperty.call(A,ee)){var te=W?Object.getOwnPropertyDescriptor(A,ee):null;te&&(te.get||te.set)?Object.defineProperty(q,ee,te):q[ee]=A[ee]}return q.default=A,B&&B.set(A,q),q}(ai());function n(A){if(typeof WeakMap!="function")return null;var R=new WeakMap,B=new WeakMap;return(n=function(q){return q?B:R})(A)}function c(){var A=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0,A[3]=0),A}function p(A,R,B){return A[0]=R[0]-B[0],A[1]=R[1]-B[1],A[2]=R[2]-B[2],A[3]=R[3]-B[3],A}function h(A,R,B){return A[0]=R[0]*B[0],A[1]=R[1]*B[1],A[2]=R[2]*B[2],A[3]=R[3]*B[3],A}function g(A,R,B){return A[0]=R[0]/B[0],A[1]=R[1]/B[1],A[2]=R[2]/B[2],A[3]=R[3]/B[3],A}function M(A,R){return Math.hypot(R[0]-A[0],R[1]-A[1],R[2]-A[2],R[3]-A[3])}function C(A,R){var B=R[0]-A[0],q=R[1]-A[1],W=R[2]-A[2],ee=R[3]-A[3];return B*B+q*q+W*W+ee*ee}function P(A){return Math.hypot(A[0],A[1],A[2],A[3])}function b(A){var R=A[0],B=A[1],q=A[2],W=A[3];return R*R+B*B+q*q+W*W}ae.sub=p,ae.mul=h,ae.div=g,ae.dist=M,ae.sqrDist=C,ae.len=P,ae.sqrLen=b;var L,D=(L=c(),function(A,R,B,q,W,ee){var te,Y;for(R||(R=4),B||(B=0),Y=q?Math.min(q*R+B,A.length):A.length,te=B;te<Y;te+=R)L[0]=A[te],L[1]=A[te+1],L[2]=A[te+2],L[3]=A[te+3],W(L,L,ee),A[te]=L[0],A[te+1]=L[1],A[te+2]=L[2],A[te+3]=L[3];return A});return ae.forEach=D,ae}function Te(){if(vi)return oi;function s(Ue){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(lt){return typeof lt}:function(lt){return lt&&typeof Symbol=="function"&&lt.constructor===Symbol&&lt!==Symbol.prototype?"symbol":typeof lt},s(Ue)}vi=1,Object.defineProperty(oi,"__esModule",{value:!0}),oi.create=M,oi.identity=function(Ue){return Ue[0]=0,Ue[1]=0,Ue[2]=0,Ue[3]=1,Ue},oi.setAxisAngle=C,oi.getAxisAngle=function(Ue,lt){var _t=2*Math.acos(lt[3]),dt=Math.sin(_t/2);return dt>t.EPSILON?(Ue[0]=lt[0]/dt,Ue[1]=lt[1]/dt,Ue[2]=lt[2]/dt):(Ue[0]=1,Ue[1]=0,Ue[2]=0),_t},oi.getAngle=function(Ue,lt){var _t=B(Ue,lt);return Math.acos(2*_t*_t-1)},oi.multiply=P,oi.rotateX=function(Ue,lt,_t){_t*=.5;var dt=lt[0],xt=lt[1],Ct=lt[2],Nt=lt[3],wt=Math.sin(_t),gi=Math.cos(_t);return Ue[0]=dt*gi+Nt*wt,Ue[1]=xt*gi+Ct*wt,Ue[2]=Ct*gi-xt*wt,Ue[3]=Nt*gi-dt*wt,Ue},oi.rotateY=function(Ue,lt,_t){_t*=.5;var dt=lt[0],xt=lt[1],Ct=lt[2],Nt=lt[3],wt=Math.sin(_t),gi=Math.cos(_t);return Ue[0]=dt*gi-Ct*wt,Ue[1]=xt*gi+Nt*wt,Ue[2]=Ct*gi+dt*wt,Ue[3]=Nt*gi-xt*wt,Ue},oi.rotateZ=function(Ue,lt,_t){_t*=.5;var dt=lt[0],xt=lt[1],Ct=lt[2],Nt=lt[3],wt=Math.sin(_t),gi=Math.cos(_t);return Ue[0]=dt*gi+xt*wt,Ue[1]=xt*gi-dt*wt,Ue[2]=Ct*gi+Nt*wt,Ue[3]=Nt*gi-Ct*wt,Ue},oi.calculateW=function(Ue,lt){var _t=lt[0],dt=lt[1],xt=lt[2];return Ue[0]=_t,Ue[1]=dt,Ue[2]=xt,Ue[3]=Math.sqrt(Math.abs(1-_t*_t-dt*dt-xt*xt)),Ue},oi.exp=b,oi.ln=L,oi.pow=function(Ue,lt,_t){return L(Ue,lt),R(Ue,Ue,_t),b(Ue,Ue),Ue},oi.slerp=D,oi.random=function(Ue){var lt=t.RANDOM(),_t=t.RANDOM(),dt=t.RANDOM(),xt=Math.sqrt(1-lt),Ct=Math.sqrt(lt);return Ue[0]=xt*Math.sin(2*Math.PI*_t),Ue[1]=xt*Math.cos(2*Math.PI*_t),Ue[2]=Ct*Math.sin(2*Math.PI*dt),Ue[3]=Ct*Math.cos(2*Math.PI*dt),Ue},oi.invert=function(Ue,lt){var _t=lt[0],dt=lt[1],xt=lt[2],Ct=lt[3],Nt=_t*_t+dt*dt+xt*xt+Ct*Ct,wt=Nt?1/Nt:0;return Ue[0]=-_t*wt,Ue[1]=-dt*wt,Ue[2]=-xt*wt,Ue[3]=Ct*wt,Ue},oi.conjugate=function(Ue,lt){return Ue[0]=-lt[0],Ue[1]=-lt[1],Ue[2]=-lt[2],Ue[3]=lt[3],Ue},oi.fromMat3=A,oi.fromEuler=function(Ue,lt,_t,dt){var xt=.5*Math.PI/180;lt*=xt,_t*=xt,dt*=xt;var Ct=Math.sin(lt),Nt=Math.cos(lt),wt=Math.sin(_t),gi=Math.cos(_t),Ui=Math.sin(dt),mi=Math.cos(dt);return Ue[0]=Ct*gi*mi-Nt*wt*Ui,Ue[1]=Nt*wt*mi+Ct*gi*Ui,Ue[2]=Nt*gi*Ui-Ct*wt*mi,Ue[3]=Nt*gi*mi+Ct*wt*Ui,Ue},oi.str=function(Ue){return"quat("+Ue[0]+", "+Ue[1]+", "+Ue[2]+", "+Ue[3]+")"},oi.setAxes=oi.sqlerp=oi.rotationTo=oi.equals=oi.exactEquals=oi.normalize=oi.sqrLen=oi.squaredLength=oi.len=oi.length=oi.lerp=oi.dot=oi.scale=oi.mul=oi.add=oi.set=oi.copy=oi.fromValues=oi.clone=void 0;var t=g(ai()),n=g(Dt()),c=g(Zt()),p=g(ge());function h(Ue){if(typeof WeakMap!="function")return null;var lt=new WeakMap,_t=new WeakMap;return(h=function(dt){return dt?_t:lt})(Ue)}function g(Ue,lt){if(Ue&&Ue.__esModule)return Ue;if(Ue===null||s(Ue)!=="object"&&typeof Ue!="function")return{default:Ue};var _t=h(lt);if(_t&&_t.has(Ue))return _t.get(Ue);var dt={},xt=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ct in Ue)if(Ct!=="default"&&Object.prototype.hasOwnProperty.call(Ue,Ct)){var Nt=xt?Object.getOwnPropertyDescriptor(Ue,Ct):null;Nt&&(Nt.get||Nt.set)?Object.defineProperty(dt,Ct,Nt):dt[Ct]=Ue[Ct]}return dt.default=Ue,_t&&_t.set(Ue,dt),dt}function M(){var Ue=new t.ARRAY_TYPE(4);return t.ARRAY_TYPE!=Float32Array&&(Ue[0]=0,Ue[1]=0,Ue[2]=0),Ue[3]=1,Ue}function C(Ue,lt,_t){_t*=.5;var dt=Math.sin(_t);return Ue[0]=dt*lt[0],Ue[1]=dt*lt[1],Ue[2]=dt*lt[2],Ue[3]=Math.cos(_t),Ue}function P(Ue,lt,_t){var dt=lt[0],xt=lt[1],Ct=lt[2],Nt=lt[3],wt=_t[0],gi=_t[1],Ui=_t[2],mi=_t[3];return Ue[0]=dt*mi+Nt*wt+xt*Ui-Ct*gi,Ue[1]=xt*mi+Nt*gi+Ct*wt-dt*Ui,Ue[2]=Ct*mi+Nt*Ui+dt*gi-xt*wt,Ue[3]=Nt*mi-dt*wt-xt*gi-Ct*Ui,Ue}function b(Ue,lt){var _t=lt[0],dt=lt[1],xt=lt[2],Ct=lt[3],Nt=Math.sqrt(_t*_t+dt*dt+xt*xt),wt=Math.exp(Ct),gi=Nt>0?wt*Math.sin(Nt)/Nt:0;return Ue[0]=_t*gi,Ue[1]=dt*gi,Ue[2]=xt*gi,Ue[3]=wt*Math.cos(Nt),Ue}function L(Ue,lt){var _t=lt[0],dt=lt[1],xt=lt[2],Ct=lt[3],Nt=Math.sqrt(_t*_t+dt*dt+xt*xt),wt=Nt>0?Math.atan2(Nt,Ct)/Nt:0;return Ue[0]=_t*wt,Ue[1]=dt*wt,Ue[2]=xt*wt,Ue[3]=.5*Math.log(_t*_t+dt*dt+xt*xt+Ct*Ct),Ue}function D(Ue,lt,_t,dt){var xt,Ct,Nt,wt,gi,Ui=lt[0],mi=lt[1],Dn=lt[2],Mn=lt[3],tn=_t[0],qi=_t[1],nr=_t[2],Fn=_t[3];return(Ct=Ui*tn+mi*qi+Dn*nr+Mn*Fn)<0&&(Ct=-Ct,tn=-tn,qi=-qi,nr=-nr,Fn=-Fn),1-Ct>t.EPSILON?(xt=Math.acos(Ct),Nt=Math.sin(xt),wt=Math.sin((1-dt)*xt)/Nt,gi=Math.sin(dt*xt)/Nt):(wt=1-dt,gi=dt),Ue[0]=wt*Ui+gi*tn,Ue[1]=wt*mi+gi*qi,Ue[2]=wt*Dn+gi*nr,Ue[3]=wt*Mn+gi*Fn,Ue}function A(Ue,lt){var _t,dt=lt[0]+lt[4]+lt[8];if(dt>0)_t=Math.sqrt(dt+1),Ue[3]=.5*_t,Ue[0]=(lt[5]-lt[7])*(_t=.5/_t),Ue[1]=(lt[6]-lt[2])*_t,Ue[2]=(lt[1]-lt[3])*_t;else{var xt=0;lt[4]>lt[0]&&(xt=1),lt[8]>lt[3*xt+xt]&&(xt=2);var Ct=(xt+1)%3,Nt=(xt+2)%3;_t=Math.sqrt(lt[3*xt+xt]-lt[3*Ct+Ct]-lt[3*Nt+Nt]+1),Ue[xt]=.5*_t,Ue[3]=(lt[3*Ct+Nt]-lt[3*Nt+Ct])*(_t=.5/_t),Ue[Ct]=(lt[3*Ct+xt]+lt[3*xt+Ct])*_t,Ue[Nt]=(lt[3*Nt+xt]+lt[3*xt+Nt])*_t}return Ue}oi.clone=p.clone,oi.fromValues=p.fromValues,oi.copy=p.copy,oi.set=p.set,oi.add=p.add,oi.mul=P;var R=p.scale;oi.scale=R;var B=p.dot;oi.dot=B,oi.lerp=p.lerp;var q=p.length;oi.length=q,oi.len=q;var W=p.squaredLength;oi.squaredLength=W,oi.sqrLen=W;var ee=p.normalize;oi.normalize=ee,oi.exactEquals=p.exactEquals,oi.equals=p.equals;var te,Y,re,ce=(te=c.create(),Y=c.fromValues(1,0,0),re=c.fromValues(0,1,0),function(Ue,lt,_t){var dt=c.dot(lt,_t);return dt<-.999999?(c.cross(te,Y,lt),c.len(te)<1e-6&&c.cross(te,re,lt),c.normalize(te,te),C(Ue,te,Math.PI),Ue):dt>.999999?(Ue[0]=0,Ue[1]=0,Ue[2]=0,Ue[3]=1,Ue):(c.cross(te,lt,_t),Ue[0]=te[0],Ue[1]=te[1],Ue[2]=te[2],Ue[3]=1+dt,ee(Ue,Ue))});oi.rotationTo=ce;var ve,Be,Oe=(ve=M(),Be=M(),function(Ue,lt,_t,dt,xt,Ct){return D(ve,lt,xt,Ct),D(Be,_t,dt,Ct),D(Ue,ve,Be,2*Ct*(1-Ct)),Ue});oi.sqlerp=Oe;var Pe,nt=(Pe=n.create(),function(Ue,lt,_t,dt){return Pe[0]=_t[0],Pe[3]=_t[1],Pe[6]=_t[2],Pe[1]=dt[0],Pe[4]=dt[1],Pe[7]=dt[2],Pe[2]=-lt[0],Pe[5]=-lt[1],Pe[8]=-lt[2],ee(Ue,A(Ue,Pe))});return oi.setAxes=nt,oi}var Re,ze={};function Ie(){if(Re)return ze;function s(D){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},s(D)}Re=1,Object.defineProperty(ze,"__esModule",{value:!0}),ze.create=function(){var D=new t.ARRAY_TYPE(8);return t.ARRAY_TYPE!=Float32Array&&(D[0]=0,D[1]=0,D[2]=0,D[4]=0,D[5]=0,D[6]=0,D[7]=0),D[3]=1,D},ze.clone=function(D){var A=new t.ARRAY_TYPE(8);return A[0]=D[0],A[1]=D[1],A[2]=D[2],A[3]=D[3],A[4]=D[4],A[5]=D[5],A[6]=D[6],A[7]=D[7],A},ze.fromValues=function(D,A,R,B,q,W,ee,te){var Y=new t.ARRAY_TYPE(8);return Y[0]=D,Y[1]=A,Y[2]=R,Y[3]=B,Y[4]=q,Y[5]=W,Y[6]=ee,Y[7]=te,Y},ze.fromRotationTranslationValues=function(D,A,R,B,q,W,ee){var te=new t.ARRAY_TYPE(8);te[0]=D,te[1]=A,te[2]=R,te[3]=B;var Y=.5*q,re=.5*W,ce=.5*ee;return te[4]=Y*B+re*R-ce*A,te[5]=re*B+ce*D-Y*R,te[6]=ce*B+Y*A-re*D,te[7]=-Y*D-re*A-ce*R,te},ze.fromRotationTranslation=g,ze.fromTranslation=function(D,A){return D[0]=0,D[1]=0,D[2]=0,D[3]=1,D[4]=.5*A[0],D[5]=.5*A[1],D[6]=.5*A[2],D[7]=0,D},ze.fromRotation=function(D,A){return D[0]=A[0],D[1]=A[1],D[2]=A[2],D[3]=A[3],D[4]=0,D[5]=0,D[6]=0,D[7]=0,D},ze.fromMat4=function(D,A){var R=n.create();c.getRotation(R,A);var B=new t.ARRAY_TYPE(3);return c.getTranslation(B,A),g(D,R,B),D},ze.copy=M,ze.identity=function(D){return D[0]=0,D[1]=0,D[2]=0,D[3]=1,D[4]=0,D[5]=0,D[6]=0,D[7]=0,D},ze.set=function(D,A,R,B,q,W,ee,te,Y){return D[0]=A,D[1]=R,D[2]=B,D[3]=q,D[4]=W,D[5]=ee,D[6]=te,D[7]=Y,D},ze.getDual=function(D,A){return D[0]=A[4],D[1]=A[5],D[2]=A[6],D[3]=A[7],D},ze.setDual=function(D,A){return D[4]=A[0],D[5]=A[1],D[6]=A[2],D[7]=A[3],D},ze.getTranslation=function(D,A){var R=A[4],B=A[5],q=A[6],W=A[7],ee=-A[0],te=-A[1],Y=-A[2],re=A[3];return D[0]=2*(R*re+W*ee+B*Y-q*te),D[1]=2*(B*re+W*te+q*ee-R*Y),D[2]=2*(q*re+W*Y+R*te-B*ee),D},ze.translate=function(D,A,R){var B=A[0],q=A[1],W=A[2],ee=A[3],te=.5*R[0],Y=.5*R[1],re=.5*R[2],ce=A[4],ve=A[5],Be=A[6],Oe=A[7];return D[0]=B,D[1]=q,D[2]=W,D[3]=ee,D[4]=ee*te+q*re-W*Y+ce,D[5]=ee*Y+W*te-B*re+ve,D[6]=ee*re+B*Y-q*te+Be,D[7]=-B*te-q*Y-W*re+Oe,D},ze.rotateX=function(D,A,R){var B=-A[0],q=-A[1],W=-A[2],ee=A[3],te=A[4],Y=A[5],re=A[6],ce=A[7],ve=te*ee+ce*B+Y*W-re*q,Be=Y*ee+ce*q+re*B-te*W,Oe=re*ee+ce*W+te*q-Y*B,Pe=ce*ee-te*B-Y*q-re*W;return n.rotateX(D,A,R),D[4]=ve*(ee=D[3])+Pe*(B=D[0])+Be*(W=D[2])-Oe*(q=D[1]),D[5]=Be*ee+Pe*q+Oe*B-ve*W,D[6]=Oe*ee+Pe*W+ve*q-Be*B,D[7]=Pe*ee-ve*B-Be*q-Oe*W,D},ze.rotateY=function(D,A,R){var B=-A[0],q=-A[1],W=-A[2],ee=A[3],te=A[4],Y=A[5],re=A[6],ce=A[7],ve=te*ee+ce*B+Y*W-re*q,Be=Y*ee+ce*q+re*B-te*W,Oe=re*ee+ce*W+te*q-Y*B,Pe=ce*ee-te*B-Y*q-re*W;return n.rotateY(D,A,R),D[4]=ve*(ee=D[3])+Pe*(B=D[0])+Be*(W=D[2])-Oe*(q=D[1]),D[5]=Be*ee+Pe*q+Oe*B-ve*W,D[6]=Oe*ee+Pe*W+ve*q-Be*B,D[7]=Pe*ee-ve*B-Be*q-Oe*W,D},ze.rotateZ=function(D,A,R){var B=-A[0],q=-A[1],W=-A[2],ee=A[3],te=A[4],Y=A[5],re=A[6],ce=A[7],ve=te*ee+ce*B+Y*W-re*q,Be=Y*ee+ce*q+re*B-te*W,Oe=re*ee+ce*W+te*q-Y*B,Pe=ce*ee-te*B-Y*q-re*W;return n.rotateZ(D,A,R),D[4]=ve*(ee=D[3])+Pe*(B=D[0])+Be*(W=D[2])-Oe*(q=D[1]),D[5]=Be*ee+Pe*q+Oe*B-ve*W,D[6]=Oe*ee+Pe*W+ve*q-Be*B,D[7]=Pe*ee-ve*B-Be*q-Oe*W,D},ze.rotateByQuatAppend=function(D,A,R){var B=R[0],q=R[1],W=R[2],ee=R[3],te=A[0],Y=A[1],re=A[2],ce=A[3];return D[0]=te*ee+ce*B+Y*W-re*q,D[1]=Y*ee+ce*q+re*B-te*W,D[2]=re*ee+ce*W+te*q-Y*B,D[3]=ce*ee-te*B-Y*q-re*W,D[4]=(te=A[4])*ee+(ce=A[7])*B+(Y=A[5])*W-(re=A[6])*q,D[5]=Y*ee+ce*q+re*B-te*W,D[6]=re*ee+ce*W+te*q-Y*B,D[7]=ce*ee-te*B-Y*q-re*W,D},ze.rotateByQuatPrepend=function(D,A,R){var B=A[0],q=A[1],W=A[2],ee=A[3],te=R[0],Y=R[1],re=R[2],ce=R[3];return D[0]=B*ce+ee*te+q*re-W*Y,D[1]=q*ce+ee*Y+W*te-B*re,D[2]=W*ce+ee*re+B*Y-q*te,D[3]=ee*ce-B*te-q*Y-W*re,D[4]=B*(ce=R[7])+ee*(te=R[4])+q*(re=R[6])-W*(Y=R[5]),D[5]=q*ce+ee*Y+W*te-B*re,D[6]=W*ce+ee*re+B*Y-q*te,D[7]=ee*ce-B*te-q*Y-W*re,D},ze.rotateAroundAxis=function(D,A,R,B){if(Math.abs(B)<t.EPSILON)return M(D,A);var q=Math.hypot(R[0],R[1],R[2]);B*=.5;var W=Math.sin(B),ee=W*R[0]/q,te=W*R[1]/q,Y=W*R[2]/q,re=Math.cos(B),ce=A[0],ve=A[1],Be=A[2],Oe=A[3];D[0]=ce*re+Oe*ee+ve*Y-Be*te,D[1]=ve*re+Oe*te+Be*ee-ce*Y,D[2]=Be*re+Oe*Y+ce*te-ve*ee,D[3]=Oe*re-ce*ee-ve*te-Be*Y;var Pe=A[4],nt=A[5],Ue=A[6],lt=A[7];return D[4]=Pe*re+lt*ee+nt*Y-Ue*te,D[5]=nt*re+lt*te+Ue*ee-Pe*Y,D[6]=Ue*re+lt*Y+Pe*te-nt*ee,D[7]=lt*re-Pe*ee-nt*te-Ue*Y,D},ze.add=function(D,A,R){return D[0]=A[0]+R[0],D[1]=A[1]+R[1],D[2]=A[2]+R[2],D[3]=A[3]+R[3],D[4]=A[4]+R[4],D[5]=A[5]+R[5],D[6]=A[6]+R[6],D[7]=A[7]+R[7],D},ze.multiply=C,ze.scale=function(D,A,R){return D[0]=A[0]*R,D[1]=A[1]*R,D[2]=A[2]*R,D[3]=A[3]*R,D[4]=A[4]*R,D[5]=A[5]*R,D[6]=A[6]*R,D[7]=A[7]*R,D},ze.lerp=function(D,A,R,B){var q=1-B;return P(A,R)<0&&(B=-B),D[0]=A[0]*q+R[0]*B,D[1]=A[1]*q+R[1]*B,D[2]=A[2]*q+R[2]*B,D[3]=A[3]*q+R[3]*B,D[4]=A[4]*q+R[4]*B,D[5]=A[5]*q+R[5]*B,D[6]=A[6]*q+R[6]*B,D[7]=A[7]*q+R[7]*B,D},ze.invert=function(D,A){var R=L(A);return D[0]=-A[0]/R,D[1]=-A[1]/R,D[2]=-A[2]/R,D[3]=A[3]/R,D[4]=-A[4]/R,D[5]=-A[5]/R,D[6]=-A[6]/R,D[7]=A[7]/R,D},ze.conjugate=function(D,A){return D[0]=-A[0],D[1]=-A[1],D[2]=-A[2],D[3]=A[3],D[4]=-A[4],D[5]=-A[5],D[6]=-A[6],D[7]=A[7],D},ze.normalize=function(D,A){var R=L(A);if(R>0){R=Math.sqrt(R);var B=A[0]/R,q=A[1]/R,W=A[2]/R,ee=A[3]/R,te=A[4],Y=A[5],re=A[6],ce=A[7],ve=B*te+q*Y+W*re+ee*ce;D[0]=B,D[1]=q,D[2]=W,D[3]=ee,D[4]=(te-B*ve)/R,D[5]=(Y-q*ve)/R,D[6]=(re-W*ve)/R,D[7]=(ce-ee*ve)/R}return D},ze.str=function(D){return"quat2("+D[0]+", "+D[1]+", "+D[2]+", "+D[3]+", "+D[4]+", "+D[5]+", "+D[6]+", "+D[7]+")"},ze.exactEquals=function(D,A){return D[0]===A[0]&&D[1]===A[1]&&D[2]===A[2]&&D[3]===A[3]&&D[4]===A[4]&&D[5]===A[5]&&D[6]===A[6]&&D[7]===A[7]},ze.equals=function(D,A){var R=D[0],B=D[1],q=D[2],W=D[3],ee=D[4],te=D[5],Y=D[6],re=D[7],ce=A[0],ve=A[1],Be=A[2],Oe=A[3],Pe=A[4],nt=A[5],Ue=A[6],lt=A[7];return Math.abs(R-ce)<=t.EPSILON*Math.max(1,Math.abs(R),Math.abs(ce))&&Math.abs(B-ve)<=t.EPSILON*Math.max(1,Math.abs(B),Math.abs(ve))&&Math.abs(q-Be)<=t.EPSILON*Math.max(1,Math.abs(q),Math.abs(Be))&&Math.abs(W-Oe)<=t.EPSILON*Math.max(1,Math.abs(W),Math.abs(Oe))&&Math.abs(ee-Pe)<=t.EPSILON*Math.max(1,Math.abs(ee),Math.abs(Pe))&&Math.abs(te-nt)<=t.EPSILON*Math.max(1,Math.abs(te),Math.abs(nt))&&Math.abs(Y-Ue)<=t.EPSILON*Math.max(1,Math.abs(Y),Math.abs(Ue))&&Math.abs(re-lt)<=t.EPSILON*Math.max(1,Math.abs(re),Math.abs(lt))},ze.sqrLen=ze.squaredLength=ze.len=ze.length=ze.dot=ze.mul=ze.setReal=ze.getReal=void 0;var t=h(ai()),n=h(Te()),c=h(Nn());function p(D){if(typeof WeakMap!="function")return null;var A=new WeakMap,R=new WeakMap;return(p=function(B){return B?R:A})(D)}function h(D,A){if(D&&D.__esModule)return D;if(D===null||s(D)!=="object"&&typeof D!="function")return{default:D};var R=p(A);if(R&&R.has(D))return R.get(D);var B={},q=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var W in D)if(W!=="default"&&Object.prototype.hasOwnProperty.call(D,W)){var ee=q?Object.getOwnPropertyDescriptor(D,W):null;ee&&(ee.get||ee.set)?Object.defineProperty(B,W,ee):B[W]=D[W]}return B.default=D,R&&R.set(D,B),B}function g(D,A,R){var B=.5*R[0],q=.5*R[1],W=.5*R[2],ee=A[0],te=A[1],Y=A[2],re=A[3];return D[0]=ee,D[1]=te,D[2]=Y,D[3]=re,D[4]=B*re+q*Y-W*te,D[5]=q*re+W*ee-B*Y,D[6]=W*re+B*te-q*ee,D[7]=-B*ee-q*te-W*Y,D}function M(D,A){return D[0]=A[0],D[1]=A[1],D[2]=A[2],D[3]=A[3],D[4]=A[4],D[5]=A[5],D[6]=A[6],D[7]=A[7],D}function C(D,A,R){var B=A[0],q=A[1],W=A[2],ee=A[3],te=R[4],Y=R[5],re=R[6],ce=R[7],ve=A[4],Be=A[5],Oe=A[6],Pe=A[7],nt=R[0],Ue=R[1],lt=R[2],_t=R[3];return D[0]=B*_t+ee*nt+q*lt-W*Ue,D[1]=q*_t+ee*Ue+W*nt-B*lt,D[2]=W*_t+ee*lt+B*Ue-q*nt,D[3]=ee*_t-B*nt-q*Ue-W*lt,D[4]=B*ce+ee*te+q*re-W*Y+ve*_t+Pe*nt+Be*lt-Oe*Ue,D[5]=q*ce+ee*Y+W*te-B*re+Be*_t+Pe*Ue+Oe*nt-ve*lt,D[6]=W*ce+ee*re+B*Y-q*te+Oe*_t+Pe*lt+ve*Ue-Be*nt,D[7]=ee*ce-B*te-q*Y-W*re+Pe*_t-ve*nt-Be*Ue-Oe*lt,D}ze.getReal=n.copy,ze.setReal=n.copy,ze.mul=C;var P=n.dot;ze.dot=P;var b=n.length;ze.length=b,ze.len=b;var L=n.squaredLength;return ze.squaredLength=L,ze.sqrLen=L,ze}var it,vt,bt={};function pt(){if(it)return bt;function s(A){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},s(A)}it=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.create=c,bt.clone=function(A){var R=new t.ARRAY_TYPE(2);return R[0]=A[0],R[1]=A[1],R},bt.fromValues=function(A,R){var B=new t.ARRAY_TYPE(2);return B[0]=A,B[1]=R,B},bt.copy=function(A,R){return A[0]=R[0],A[1]=R[1],A},bt.set=function(A,R,B){return A[0]=R,A[1]=B,A},bt.add=function(A,R,B){return A[0]=R[0]+B[0],A[1]=R[1]+B[1],A},bt.subtract=p,bt.multiply=h,bt.divide=g,bt.ceil=function(A,R){return A[0]=Math.ceil(R[0]),A[1]=Math.ceil(R[1]),A},bt.floor=function(A,R){return A[0]=Math.floor(R[0]),A[1]=Math.floor(R[1]),A},bt.min=function(A,R,B){return A[0]=Math.min(R[0],B[0]),A[1]=Math.min(R[1],B[1]),A},bt.max=function(A,R,B){return A[0]=Math.max(R[0],B[0]),A[1]=Math.max(R[1],B[1]),A},bt.round=function(A,R){return A[0]=Math.round(R[0]),A[1]=Math.round(R[1]),A},bt.scale=function(A,R,B){return A[0]=R[0]*B,A[1]=R[1]*B,A},bt.scaleAndAdd=function(A,R,B,q){return A[0]=R[0]+B[0]*q,A[1]=R[1]+B[1]*q,A},bt.distance=M,bt.squaredDistance=C,bt.length=P,bt.squaredLength=b,bt.negate=function(A,R){return A[0]=-R[0],A[1]=-R[1],A},bt.inverse=function(A,R){return A[0]=1/R[0],A[1]=1/R[1],A},bt.normalize=function(A,R){var B=R[0],q=R[1],W=B*B+q*q;return W>0&&(W=1/Math.sqrt(W)),A[0]=R[0]*W,A[1]=R[1]*W,A},bt.dot=function(A,R){return A[0]*R[0]+A[1]*R[1]},bt.cross=function(A,R,B){var q=R[0]*B[1]-R[1]*B[0];return A[0]=A[1]=0,A[2]=q,A},bt.lerp=function(A,R,B,q){var W=R[0],ee=R[1];return A[0]=W+q*(B[0]-W),A[1]=ee+q*(B[1]-ee),A},bt.random=function(A,R){R=R||1;var B=2*t.RANDOM()*Math.PI;return A[0]=Math.cos(B)*R,A[1]=Math.sin(B)*R,A},bt.transformMat2=function(A,R,B){var q=R[0],W=R[1];return A[0]=B[0]*q+B[2]*W,A[1]=B[1]*q+B[3]*W,A},bt.transformMat2d=function(A,R,B){var q=R[0],W=R[1];return A[0]=B[0]*q+B[2]*W+B[4],A[1]=B[1]*q+B[3]*W+B[5],A},bt.transformMat3=function(A,R,B){var q=R[0],W=R[1];return A[0]=B[0]*q+B[3]*W+B[6],A[1]=B[1]*q+B[4]*W+B[7],A},bt.transformMat4=function(A,R,B){var q=R[0],W=R[1];return A[0]=B[0]*q+B[4]*W+B[12],A[1]=B[1]*q+B[5]*W+B[13],A},bt.rotate=function(A,R,B,q){var W=R[0]-B[0],ee=R[1]-B[1],te=Math.sin(q),Y=Math.cos(q);return A[0]=W*Y-ee*te+B[0],A[1]=W*te+ee*Y+B[1],A},bt.angle=function(A,R){var B=A[0],q=A[1],W=R[0],ee=R[1],te=Math.sqrt(B*B+q*q)*Math.sqrt(W*W+ee*ee);return Math.acos(Math.min(Math.max(te&&(B*W+q*ee)/te,-1),1))},bt.zero=function(A){return A[0]=0,A[1]=0,A},bt.str=function(A){return"vec2("+A[0]+", "+A[1]+")"},bt.exactEquals=function(A,R){return A[0]===R[0]&&A[1]===R[1]},bt.equals=function(A,R){var B=A[0],q=A[1],W=R[0],ee=R[1];return Math.abs(B-W)<=t.EPSILON*Math.max(1,Math.abs(B),Math.abs(W))&&Math.abs(q-ee)<=t.EPSILON*Math.max(1,Math.abs(q),Math.abs(ee))},bt.forEach=bt.sqrLen=bt.sqrDist=bt.dist=bt.div=bt.mul=bt.sub=bt.len=void 0;var t=function(A,R){if(A&&A.__esModule)return A;if(A===null||s(A)!=="object"&&typeof A!="function")return{default:A};var B=n(void 0);if(B&&B.has(A))return B.get(A);var q={},W=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ee in A)if(ee!=="default"&&Object.prototype.hasOwnProperty.call(A,ee)){var te=W?Object.getOwnPropertyDescriptor(A,ee):null;te&&(te.get||te.set)?Object.defineProperty(q,ee,te):q[ee]=A[ee]}return q.default=A,B&&B.set(A,q),q}(ai());function n(A){if(typeof WeakMap!="function")return null;var R=new WeakMap,B=new WeakMap;return(n=function(q){return q?B:R})(A)}function c(){var A=new t.ARRAY_TYPE(2);return t.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0),A}function p(A,R,B){return A[0]=R[0]-B[0],A[1]=R[1]-B[1],A}function h(A,R,B){return A[0]=R[0]*B[0],A[1]=R[1]*B[1],A}function g(A,R,B){return A[0]=R[0]/B[0],A[1]=R[1]/B[1],A}function M(A,R){return Math.hypot(R[0]-A[0],R[1]-A[1])}function C(A,R){var B=R[0]-A[0],q=R[1]-A[1];return B*B+q*q}function P(A){return Math.hypot(A[0],A[1])}function b(A){var R=A[0],B=A[1];return R*R+B*B}bt.len=P,bt.sub=p,bt.mul=h,bt.div=g,bt.dist=M,bt.sqrDist=C,bt.sqrLen=b;var L,D=(L=c(),function(A,R,B,q,W,ee){var te,Y;for(R||(R=2),B||(B=0),Y=q?Math.min(q*R+B,A.length):A.length,te=B;te<Y;te+=R)L[0]=A[te],L[1]=A[te+1],W(L,L,ee),A[te]=L[0],A[te+1]=L[1];return A});return bt.forEach=D,bt}function ti(){if(vt)return Je;function s(A){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},s(A)}vt=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.vec4=Je.vec3=Je.vec2=Je.quat2=Je.quat=Je.mat4=Je.mat3=Je.mat2d=Je.mat2=Je.glMatrix=void 0;var t=D(ai());Je.glMatrix=t;var n=D(qt());Je.mat2=n;var c=D(Tt());Je.mat2d=c;var p=D(Dt());Je.mat3=p;var h=D(Nn());Je.mat4=h;var g=D(Te());Je.quat=g;var M=D(Ie());Je.quat2=M;var C=D(pt());Je.vec2=C;var P=D(Zt());Je.vec3=P;var b=D(ge());function L(A){if(typeof WeakMap!="function")return null;var R=new WeakMap,B=new WeakMap;return(L=function(q){return q?B:R})(A)}function D(A,R){if(A&&A.__esModule)return A;if(A===null||s(A)!=="object"&&typeof A!="function")return{default:A};var B=L(R);if(B&&B.has(A))return B.get(A);var q={},W=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ee in A)if(ee!=="default"&&Object.prototype.hasOwnProperty.call(A,ee)){var te=W?Object.getOwnPropertyDescriptor(A,ee):null;te&&(te.get||te.set)?Object.defineProperty(q,ee,te):q[ee]=A[ee]}return q.default=A,B&&B.set(A,q),q}return Je.vec4=b,Je}var Wi,mn,fn,vr,et=ti(),jr=function(){if(mn)return Wi;function s(t,n,c,p){this.cx=3*t,this.bx=3*(c-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(p-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=c,this.p2y=p}return mn=1,Wi=s,s.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var c=t,p=0;p<8;p++){var h=this.sampleCurveX(c)-t;if(Math.abs(h)<n)return c;var g=this.sampleCurveDerivativeX(c);if(Math.abs(g)<1e-6)break;c-=h/g}var M=0,C=1;for(c=t,p=0;p<20&&(h=this.sampleCurveX(c),!(Math.abs(h-t)<n));p++)t>h?M=c:C=c,c=.5*(C-M)+M;return c},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},Wi}(),Ra=Ge(jr);function ra(){if(vr)return fn;function s(t,n){this.x=t,this.y=n}return vr=1,fn=s,s.prototype={clone:function(){return new s(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,n){return this.clone()._rotateAround(t,n)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var n=t.x-this.x,c=t.y-this.y;return n*n+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)},_matMult:function(t){var n=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var n=Math.cos(t),c=Math.sin(t),p=c*this.x+n*this.y;return this.x=n*this.x-c*this.y,this.y=p,this},_rotateAround:function(t,n){var c=Math.cos(t),p=Math.sin(t),h=n.y+p*(this.x-n.x)+c*(this.y-n.y);return this.x=n.x+c*(this.x-n.x)-p*(this.y-n.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},s.convert=function(t){return t instanceof s?t:Array.isArray(t)?new s(t[0],t[1]):t},fn}var Pi=Ge(ra());function cn(s,t){if(Array.isArray(s)){if(!Array.isArray(t)||s.length!==t.length)return!1;for(let n=0;n<s.length;n++)if(!cn(s[n],t[n]))return!1;return!0}if(typeof s=="object"&&s!==null&&t!==null){if(typeof t!="object"||Object.keys(s).length!==Object.keys(t).length)return!1;for(const n in s)if(!cn(s[n],t[n]))return!1;return!0}return s===t}const Ye=Math.PI/180,Xe=180/Math.PI;function ft(s){return s*Ye}function ct(s){return s*Xe}const Rt=[[0,0],[1,0],[1,1],[0,1]];function Ut(s){if(s<=0)return 0;if(s>=1)return 1;const t=s*s,n=t*s;return 4*(s<.5?n:3*(s-t)+n-.75)}function li(s,t,n,c){const p=new Ra(s,t,n,c);return function(h){return p.solve(h)}}const $t=li(.25,.1,.25,1);function ii(s,t,n){return Math.min(n,Math.max(t,s))}function Tn(s,t,n){return(n=ii((n-s)/(t-s),0,1))*n*(3-2*n)}function wn(s,t,n){const c=n-t,p=((s-t)%c+c)%c+t;return p===t?n:p}function gr(s,t,n){if(!s.length)return n(null,[]);let c=s.length;const p=new Array(s.length);let h=null;s.forEach((g,M)=>{t(g,(C,P)=>{C&&(h=C),p[M]=P,--c==0&&n(h,p)})})}function cr(s,...t){for(const n of t)for(const c in n)s[c]=n[c];return s}let Sr=1;function Er(){return Sr++}function mr(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Nr(s,t){s.forEach(n=>{t[n]&&(t[n]=t[n].bind(t))})}function Ma(s,t){return s.indexOf(t,s.length-t.length)!==-1}function ga(s,t,n){const c={};for(const p in s)c[p]=t.call(this,s[p],p,s);return c}function oo(s,t,n){const c={};for(const p in s)t.call(this,s[p],p,s)&&(c[p]=s[p]);return c}function $a(s){return Array.isArray(s)?s.map($a):typeof s=="object"&&s?ga(s,$a):s}const dn={};function Xn(s){dn[s]||(typeof console<"u"&&console.warn(s),dn[s]=!0)}function Qa(s,t,n){return(n.y-s.y)*(t.x-s.x)>(t.y-s.y)*(n.x-s.x)}function lo(s){let t=0;for(let n,c,p=0,h=s.length,g=h-1;p<h;g=p++)n=s[p],c=s[g],t+=(c.x-n.x)*(n.y+c.y);return t}function Us([s,t,n]){const c=ft(t+90),p=ft(n);return{x:s*Math.cos(c)*Math.sin(p),y:s*Math.sin(c)*Math.sin(p),z:s*Math.cos(p),azimuthal:t,polar:n}}function Ca(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ja(s){const t={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,c,p,h)=>{const g=p||h;return t[c]=!g||g.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t}let qr=null;function gs(s,t){return[s[4*t],s[4*t+1],s[4*t+2],s[4*t+3]]}function $s(s,t,n,c){for(;t<n;){const p=t+n>>1;s[p]<c?t=p+1:n=p}return t}function Lo(s,t,n,c){for(;t<n;){const p=t+n>>1;s[p]<=c?t=p+1:n=p}return t}function Ls(s){return s>0?1/(1.001-s):1+s}function ht(s){return s>0?1-1/(1.001-s):-s}const es={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!es.API_URL)return null;try{const s=new URL(es.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Ks(s){return es.API_URL_REGEX.test(s)}function Js(s){return es.API_SPRITE_REGEX.test(s)}let Ro,xs,Io,Xt,oe,pe;function Ce(){return Ro==null&&(Ro=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ro}const qe={now:()=>Xt!==void 0?Xt:performance.now(),setNow(s){Xt=s},restoreNow(){Xt=void 0},frame(s){const t=requestAnimationFrame(s);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(s,t=0){const{width:n,height:c}=s;oe||(oe=document.createElement("canvas"));const p=oe.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(n>oe.width||c>oe.height)&&(oe.width=n,oe.height=c),p.clearRect(-t,-t,n+2*t,c+2*t),p.drawImage(s,0,0,n,c),p.getImageData(-t,-t,n+2*t,c+2*t)},resolveURL:s=>(xs||(xs=document.createElement("a")),xs.href=s,xs.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Io==null&&(Io=window.matchMedia("(prefers-reduced-motion: reduce)")),Io.matches)},hasCanvasFingerprintNoise(){if(pe!==void 0)return pe;if(!Ce())return pe=!1,!1;const s=new OffscreenCanvas(85,1),t=s.getContext("2d",{willReadFrequently:!0});let n=0;for(let p=0;p<s.width;++p)t.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,t.fillRect(p,0,1,1);const c=t.getImageData(0,0,s.width,s.height);n=0;for(let p=0;p<c.data.length;++p)if(p%4!=3&&n++!==c.data[p])return pe=!0,!0;return pe=!1,!1}};function Qe(s,t){const n=s.indexOf("?");if(n<0)return`${s}?${new URLSearchParams(t).toString()}`;const c=new URLSearchParams(s.slice(n));for(const p in t)c.set(p,t[p]);return`${s.slice(0,n)}?${c.toString()}`}function ut(s,t={persistentParams:[]}){const n=s.indexOf("?");if(n<0)return s;const c=new URLSearchParams,p=new URLSearchParams(s.slice(n));for(const g of t.persistentParams){const M=p.get(g);M&&c.set(g,M)}const h=c.toString();return`${s.slice(0,n)}${h.length>0?`?${h}`:""}`}const It="mapbox-tiles";let mt=500,Vt=50;const Gt=["language","worldview","jobid"];let Wt,Mi;function Qi(){try{return caches}catch{}}function nn(){const s=Qi();s&&Wt==null&&(Wt=s.open(It))}let zn=1/0;const jn={supported:!1,testSupport:function(s){!Rr&&Wn&&(Ur?sa(s):ar=s)}};let ar,Wn,Rr=!1,Ur=!1;const Br=typeof self<"u"?self:{};function sa(s){const t=s.createTexture();s.bindTexture(s.TEXTURE_2D,t);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,Wn),s.isContextLost())return;jn.supported=!0}catch{}s.deleteTexture(t),Rr=!0}Br.document&&(Wn=Br.document.createElement("img"),Wn.onload=function(){ar&&sa(ar),ar=null,Ur=!0},Wn.onerror=function(){Rr=!0,ar=null},Wn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Wr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Wr);class tr extends Error{constructor(t,n,c){n===401&&Ks(c)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=n,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Rs=Ca()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Ia=function(s,t){if(!(/^file:/.test(n=s.url)||/^file:/.test(Rs())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(c,p){const h=new AbortController,g=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Rs(),referrerPolicy:c.referrerPolicy,signal:h.signal});let M=!1,C=!1;const P=(b=g.url).indexOf("sku=")>0&&Ks(b);var b;c.type==="json"&&g.headers.set("Accept","application/json");const L=(A,R,B)=>{if(C)return;if(A&&A.message!=="SecurityError"&&Xn(A.toString()),R&&B)return D(R);const q=Date.now();fetch(g).then(W=>{if(W.ok){const ee=P?W.clone():null;return D(W,ee,q)}return p(new tr(W.statusText,W.status,c.url))}).catch(W=>{W.name!=="AbortError"&&p(new Error(`${W.message} ${c.url}`))})},D=(A,R,B)=>{(c.type==="arrayBuffer"?A.arrayBuffer():c.type==="json"?A.json():A.text()).then(q=>{C||(R&&B&&function(W,ee,te){if(nn(),Wt==null)return;const Y=ja(ee.headers.get("Cache-Control")||"");if(Y["no-store"])return;const re={status:ee.status,statusText:ee.statusText,headers:new Headers};ee.headers.forEach((Be,Oe)=>re.headers.set(Oe,Be)),Y["max-age"]&&re.headers.set("Expires",new Date(te+1e3*Y["max-age"]).toUTCString());const ce=re.headers.get("Expires");if(!ce||new Date(ce).getTime()-te<42e4)return;let ve=ut(W.url,{persistentParams:Gt});if(ee.status===206){const Be=W.headers.get("Range");if(!Be)return;re.status=200,ve=Qe(ve,{range:Be})}(function(Be,Oe){if(Mi===void 0)try{new Response(new ReadableStream),Mi=!0}catch{Mi=!1}Mi?Oe(Be.body):Be.blob().then(Oe)})(ee,Be=>{const Oe=new Response((Pe=ee.status)!==200&&Pe!==404&&[101,103,204,205,304].includes(Pe)?null:Be,re);var Pe;nn(),Wt!=null&&Wt.then(nt=>nt.put(ve,Oe)).catch(nt=>Xn(nt.message))})}(g,R,B),M=!0,p(null,q,A.headers.get("Cache-Control"),A.headers.get("Expires")))}).catch(q=>{C||p(new Error(q.message))})};return P?function(A,R){if(nn(),Wt==null)return R(null);Wt.then(B=>{let q=ut(A.url,{persistentParams:Gt});const W=A.headers.get("Range");W&&(q=Qe(q,{range:W})),B.match(q).then(ee=>{const te=function(Y){if(!Y)return!1;const re=new Date(Y.headers.get("Expires")||0),ce=ja(Y.headers.get("Cache-Control")||"");return re>Date.now()&&!ce["no-cache"]}(ee);B.delete(q),te&&B.put(q,ee.clone()),R(null,ee,te)}).catch(R)}).catch(R)}(g,L):L(null,null),{cancel:()=>{C=!0,M||h.abort()}}}(s,t);if(Ca()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,t,void 0,!0)}var n;return function(c,p){const h=new XMLHttpRequest;h.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const g in c.headers)h.setRequestHeader(g,c.headers[g]);return c.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=c.credentials==="include",h.onerror=()=>{p(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let g=h.response;if(c.type==="json")try{g=JSON.parse(h.response)}catch(M){return p(M)}p(null,g,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else p(new tr(h.statusText,h.status,c.url))},h.send(c.body),{cancel:()=>h.abort()}}(s,t)},Da=function(s,t){return Ia(cr(s,{type:"arrayBuffer"}),t)};function _s(s){const t=document.createElement("a");return t.href=s,t.protocol===location.protocol&&t.host===location.host}const qo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let dl,Vs;dl=[],Vs=0;const Au=function(s,t){if(jn.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),Vs>=es.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:s,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return dl.push(h),h}Vs++;let n=!1;const c=()=>{if(!n)for(n=!0,Vs--;dl.length&&Vs<es.MAX_PARALLEL_IMAGE_REQUESTS;){const h=dl.shift(),{requestParameters:g,callback:M,cancelled:C}=h;C||(h.cancel=Au(g,M).cancel)}},p=Da(s,(h,g,M,C)=>{c(),h?t(h):g&&(self.createImageBitmap?function(P,b){const L=new Blob([new Uint8Array(P)],{type:"image/png"});createImageBitmap(L).then(D=>{b(null,D)}).catch(D=>{b(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(P,b)=>t(P,b,M,C)):function(P,b){const L=new Image;L.onload=()=>{b(null,L),URL.revokeObjectURL(L.src),L.onload=null,requestAnimationFrame(()=>{L.src=qo})},L.onerror=()=>b(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const D=new Blob([new Uint8Array(P)],{type:"image/png"});L.src=P.byteLength?URL.createObjectURL(D):qo}(g,(P,b)=>t(P,b,M,C)))});return{cancel:()=>{p.cancel(),c()}}};var Bc,Ql,fo,ka={exports:{}},Do={exports:{}},xo={exports:{}},Me=function(){if(fo)return ka.exports;fo=1;var s=(Bc||(Bc=1,Do.exports=function(n,c){var p,h,g,M,C,P,b,L;for(h=n.length-(p=3&n.length),g=c,C=3432918353,P=461845907,L=0;L<h;)b=255&n.charCodeAt(L)|(255&n.charCodeAt(++L))<<8|(255&n.charCodeAt(++L))<<16|(255&n.charCodeAt(++L))<<24,++L,g=27492+(65535&(M=5*(65535&(g=(g^=b=(65535&(b=(b=(65535&b)*C+(((b>>>16)*C&65535)<<16)&4294967295)<<15|b>>>17))*P+(((b>>>16)*P&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(M>>>16)&65535)<<16);switch(b=0,p){case 3:b^=(255&n.charCodeAt(L+2))<<16;case 2:b^=(255&n.charCodeAt(L+1))<<8;case 1:g^=b=(65535&(b=(b=(65535&(b^=255&n.charCodeAt(L)))*C+(((b>>>16)*C&65535)<<16)&4294967295)<<15|b>>>17))*P+(((b>>>16)*P&65535)<<16)&4294967295}return g^=n.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),Do.exports),t=(Ql||(Ql=1,xo.exports=function(n,c){for(var p,h=n.length,g=c^h,M=0;h>=4;)p=1540483477*(65535&(p=255&n.charCodeAt(M)|(255&n.charCodeAt(++M))<<8|(255&n.charCodeAt(++M))<<16|(255&n.charCodeAt(++M))<<24))+((1540483477*(p>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),h-=4,++M;switch(h){case 3:g^=(255&n.charCodeAt(M+2))<<16;case 2:g^=(255&n.charCodeAt(M+1))<<8;case 1:g=1540483477*(65535&(g^=255&n.charCodeAt(M)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),xo.exports);return ka.exports=s,ka.exports.murmur3=s,ka.exports.murmur2=t,ka.exports}(),be=Ge(Me);class Fe{constructor(t,...n){cr(this,n[0]||{}),this.type=t}}class yt extends Fe{constructor(t,n={}){super("error",cr({error:t},n))}}function ki(s,t,n){n[s]&&n[s].indexOf(t)!==-1||(n[s]=n[s]||[],n[s].push(t))}function Yi(s,t,n){if(n&&n[s]){const c=n[s].indexOf(t);c!==-1&&n[s].splice(c,1)}}class wi{on(t,n){return this._listeners=this._listeners||{},ki(t,n,this._listeners),this}off(t,n){return Yi(t,n,this._listeners),Yi(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},ki(t,n,this._oneTimeListeners),this):new Promise(c=>this.once(t,c))}fire(t,n){const c=typeof t=="string"?new Fe(t,n):t,p=c.type;if(this.listens(p)){c.target=this;const h=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const C of h)C.call(this,c);const g=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const C of g)Yi(p,C,this._oneTimeListeners),C.call(this,c);const M=this._eventedParent;M&&(cr(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),M.fire(c))}else c instanceof yt&&console.error(c.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var hn,xe={},he=function(){if(hn)return xe;hn=1;var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(h){return(h=Math.round(h))<0?0:h>255?255:h}function n(h){return t(h[h.length-1]==="%"?parseFloat(h)/100*255:parseInt(h))}function c(h){return(g=h[h.length-1]==="%"?parseFloat(h)/100:parseFloat(h))<0?0:g>1?1:g;var g}function p(h,g,M){return M<0?M+=1:M>1&&(M-=1),6*M<1?h+(g-h)*M*6:2*M<1?g:3*M<2?h+(g-h)*(2/3-M)*6:h}try{xe.parseCSSColor=function(h){var g,M=h.replace(/ /g,"").toLowerCase();if(M in s)return s[M].slice();if(M[0]==="#")return M.length===4?(g=parseInt(M.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:M.length===7&&(g=parseInt(M.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var C=M.indexOf("("),P=M.indexOf(")");if(C!==-1&&P+1===M.length){var b=M.substr(0,C),L=M.substr(C+1,P-(C+1)).split(","),D=1;switch(b){case"rgba":if(L.length!==4)return null;D=c(L.pop());case"rgb":return L.length!==3?null:[n(L[0]),n(L[1]),n(L[2]),D];case"hsla":if(L.length!==4)return null;D=c(L.pop());case"hsl":if(L.length!==3)return null;var A=(parseFloat(L[0])%360+360)%360/360,R=c(L[1]),B=c(L[2]),q=B<=.5?B*(R+1):B+R-B*R,W=2*B-q;return[t(255*p(W,q,A+1/3)),t(255*p(W,q,A)),t(255*p(W,q,A-1/3)),D];default:return null}}return null}}catch{}return xe}();class we{constructor(t,n,c,p=1){this.r=t,this.g=n,this.b=c,this.a=p}static parse(t){if(!t)return;if(t instanceof we)return t;if(typeof t!="string")return;const n=he.parseCSSColor(t);return n?new we(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toStringPremultipliedAlpha(){const[t,n,c,p]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(t)},${Math.round(n)},${Math.round(c)},${p})`}toString(){const[t,n,c,p]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*c)},${p})`}toRenderColor(t){const{r:n,g:c,b:p,a:h}=this;return new Ve(t,n,c,p,h)}clone(){return new we(this.r,this.g,this.b,this.a)}}class Ve{constructor(t,n,c,p,h){if(t){const g=t.image.height,M=g*g;n=h===0?0:n/h*(g-1),c=h===0?0:c/h*(g-1),p=h===0?0:p/h*(g-1);const C=Math.floor(n),P=Math.floor(c),b=Math.floor(p),L=Math.ceil(n),D=Math.ceil(c),A=Math.ceil(p),R=n-C,B=c-P,q=p-b,W=t.image.data,ee=4*(C+P*M+b*g),te=4*(C+P*M+A*g),Y=4*(C+D*M+b*g),re=4*(C+D*M+A*g),ce=4*(L+P*M+b*g),ve=4*(L+P*M+A*g),Be=4*(L+D*M+b*g),Oe=4*(L+D*M+A*g);if(ee<0||Oe>=W.length)throw new Error("out of range");this.r=Ee(Ee(Ee(W[ee],W[te],q),Ee(W[Y],W[re],q),B),Ee(Ee(W[ce],W[ve],q),Ee(W[Be],W[Oe],q),B),R)/255*h,this.g=Ee(Ee(Ee(W[ee+1],W[te+1],q),Ee(W[Y+1],W[re+1],q),B),Ee(Ee(W[ce+1],W[ve+1],q),Ee(W[Be+1],W[Oe+1],q),B),R)/255*h,this.b=Ee(Ee(Ee(W[ee+2],W[te+2],q),Ee(W[Y+2],W[re+2],q),B),Ee(Ee(W[ce+2],W[ve+2],q),Ee(W[Be+2],W[Oe+2],q),B),R)/255*h,this.a=h}else this.r=n,this.g=c,this.b=p,this.a=h}toArray(){const{r:t,g:n,b:c,a:p}=this;return p===0?[0,0,0,0]:[255*t/p,255*n/p,255*c/p,p]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:t,g:n,b:c,a:p}=this,h=Math.min(Math.max(t/p,0),1),g=Math.min(Math.max(n/p,0),1),M=Math.min(Math.max(c/p,0),1),C=Math.min(h,g,M),P=Math.max(h,g,M),b=(C+P)/2;if(C===P)return[0,0,100*b,p];const L=P-C,D=b>.5?L/(2-P-C):L/(P+C);let A=0;return P===h?A=(g-M)/L+(g<M?6:0):P===g?A=(M-h)/L+2:P===M&&(A=(h-g)/L+4),A*=60,[Math.min(Math.max(A,0),360),Math.min(Math.max(100*D,0),100),Math.min(Math.max(100*b,0),100),p]}toArray01(){const{r:t,g:n,b:c,a:p}=this;return p===0?[0,0,0,0]:[t/p,n/p,c/p,p]}toArray01Scaled(t){const{r:n,g:c,b:p,a:h}=this;return h===0?[0,0,0]:[n/h*t,c/h*t,p/h*t]}toArray01PremultipliedAlpha(){const{r:t,g:n,b:c,a:p}=this;return[t,n,c,p]}toArray01Linear(){const{r:t,g:n,b:c,a:p}=this;return p===0?[0,0,0,0]:[Math.pow(t/p,2.2),Math.pow(n/p,2.2),Math.pow(c/p,2.2),p]}}function Ee(s,t,n){return s*(1-n)+t*n}function ri(s,t,n){return s.map((c,p)=>Ee(c,t[p],n))}we.black=new we(0,0,0,1),we.white=new we(1,1,1,1),we.transparent=new we(0,0,0,0),we.red=new we(1,0,0,1),we.blue=new we(0,0,1,1);var Ei=Object.freeze({__proto__:null,array:ri,color:function(s,t,n){return new we(Ee(s.r,t.r,n),Ee(s.g,t.g,n),Ee(s.b,t.b,n),Ee(s.a,t.a,n))},number:Ee});function sn(s,...t){for(const n of t)for(const c in n)s[c]=n[c];return s}class Di extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class Jn{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[c,p]of n)this.bindings[c]=p}concat(t){return new Jn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const on={kind:"null"},Ft={kind:"number"},yn={kind:"string"},Si={kind:"boolean"},qn={kind:"color"},rn={kind:"object"},Cn={kind:"value"},Ar={kind:"collator"},Ir={kind:"formatted"},Gr={kind:"resolvedImage"};function Lr(s,t){return{kind:"array",itemType:s,N:t}}function xr(s){if(s.kind==="array"){const t=xr(s.itemType);return typeof s.N=="number"?`array<${t}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${t}>`}return s.kind}const On=[on,Ft,yn,Si,qn,Ir,rn,Lr(Cn),Gr];function fa(s,t){if(t.kind==="error")return null;if(s.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!fa(s.itemType,t.itemType))&&(typeof s.N!="number"||s.N===t.N))return null}else{if(s.kind===t.kind)return null;if(s.kind==="value"){for(const n of On)if(!fa(n,t))return null}}return`Expected ${xr(s)} but found ${xr(t)} instead.`}function $r(s,t){return t.some(n=>n.kind===s.kind)}function Ms(s,t){return t.some(n=>n==="null"?s===null:n==="array"?Array.isArray(s):n==="object"?s&&!Array.isArray(s)&&typeof s=="object":n===typeof s)}class aa{constructor(t,n,c){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Qs{constructor(t,n,c,p,h){this.text=t.normalize?t.normalize():t,this.image=n,this.scale=c,this.fontStack=p,this.textColor=h}}class ds{constructor(t){this.sections=t}static fromString(t){return new ds([new Qs(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.namePrimary)}static factory(t){return t instanceof ds?t:ds.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const n of this.sections){if(n.image){t.push(["image",n.image.namePrimary]);continue}t.push(n.text);const c={};n.fontStack&&(c["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(c["font-scale"]=n.scale),n.textColor&&(c["text-color"]=["rgba"].concat(n.textColor.toRenderColor(null).toArray())),t.push(c)}return t}}class Fs{constructor(t,n){if(this.id=t,this.options=n||{params:{}},this.options.transform){const{a:c,b:p,c:h,d:g,e:M,f:C}=this.options.transform;this.options.transform=new DOMMatrix([c,p,h,g,M,C])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}static deserializeId(t){return JSON.parse(t).id}static deserializeFromString(t){const n=JSON.parse(t),{a:c,b:p,c:h,d:g,e:M,f:C}=n.options.transform;return new DOMMatrix([c,p,h,g,M,C]),new Fs(n.id,n.options)}scaleSelf(t){return this.options.transform=this.options.transform.scale(t),this}serialize(){const t={id:this.id};this.options&&(t.options=this.options);const{a:n,b:c,c:p,d:h,e:g,f:M}=this.options.transform;return t.options.transform={a:n,b:c,c:p,d:h,e:g,f:M},JSON.stringify(t)}}class Ts{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),t.optionsPrimary&&(this.optionsPrimary=t.optionsPrimary),t.optionsSecondary&&(this.optionsSecondary=t.optionsSecondary),this.available=t.available}toString(){return this.namePrimary&&this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}getPrimary(){return new Fs(this.namePrimary,{params:this.optionsPrimary&&this.optionsPrimary.params||{}})}getSerializedPrimary(){return this.getPrimary().serialize()}getSecondary(){return this.nameSecondary?new Fs(this.nameSecondary,{params:this.optionsSecondary&&this.optionsSecondary.params||{}}):null}static from(t){return typeof t=="string"?Ts.build(t):t}static build(t,n,c,p){return t?new Ts({namePrimary:t,nameSecondary:n,optionsPrimary:c,optionsSecondary:p,available:!1}):null}}function al(s,t,n,c){return typeof s=="number"&&s>=0&&s<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[s,t,n,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[s,t,n,c]:[s,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Gs(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof we||s instanceof aa||s instanceof ds||s instanceof Ts)return!0;if(Array.isArray(s)){for(const t of s)if(!Gs(t))return!1;return!0}if(typeof s=="object"){for(const t in s)if(!Gs(s[t]))return!1;return!0}return!1}function _a(s){if(s===null)return on;if(typeof s=="string")return yn;if(typeof s=="boolean")return Si;if(typeof s=="number")return Ft;if(s instanceof we)return qn;if(s instanceof aa)return Ar;if(s instanceof ds)return Ir;if(s instanceof Ts)return Gr;if(Array.isArray(s)){const t=s.length;let n;for(const c of s){const p=_a(c);if(n){if(n===p)continue;n=Cn;break}n=p}return Lr(n||Cn,t)}return rn}function Wo(s){const t=typeof s;return s===null?"":t==="string"||t==="number"||t==="boolean"?String(s):s instanceof we?s.toStringPremultipliedAlpha():s instanceof ds||s instanceof Ts?s.toString():JSON.stringify(s)}class or{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Gs(t[1]))return n.error("invalid value");const c=t[1];let p=_a(c);const h=n.expectedType;return p.kind!=="array"||p.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(p=h),new or(p,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof we?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof ds?this.value.serialize():this.value}}class fs{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Cu={string:yn,number:Ft,boolean:Si,object:rn};class kl{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let c,p=1;const h=t[0];if(h==="array"){let M,C;if(t.length>2){const P=t[1];if(typeof P!="string"||!(P in Cu)||P==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);M=Cu[P],p++}else M=Cn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);C=t[2],p++}c=Lr(M,C)}else c=Cu[h];const g=[];for(;p<t.length;p++){const M=n.parse(t[p],p,Cn);if(!M)return null;g.push(M)}return new kl(c,g)}evaluate(t){for(let n=0;n<this.args.length;n++){const c=this.args[n].evaluate(t);if(!fa(this.type,_a(c)))return c;if(n===this.args.length-1)throw new fs(`The expression ${JSON.stringify(this.args[n].serialize())} evaluated to ${xr(_a(c))} but was expected to be of type ${xr(this.type)}.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,n=[t.kind];if(t.kind==="array"){const c=t.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){n.push(c.kind);const p=t.N;(typeof p=="number"||this.args.length>1)&&n.push(p)}}return n.concat(this.args.map(c=>c.serialize()))}}class fl{constructor(t){this.type=Ir,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const c=t[1];if(!Array.isArray(c)&&typeof c=="object")return n.error("First argument must be an image or text section.");const p=[];let h=!1;for(let g=1;g<=t.length-1;++g){const M=t[g];if(h&&typeof M=="object"&&!Array.isArray(M)){h=!1;let C=null;if(M["font-scale"]&&(C=n.parseObjectValue(M["font-scale"],g,"font-scale",Ft),!C))return null;let P=null;if(M["text-font"]&&(P=n.parseObjectValue(M["text-font"],g,"text-font",Lr(yn)),!P))return null;let b=null;if(M["text-color"]&&(b=n.parseObjectValue(M["text-color"],g,"text-color",qn),!b))return null;const L=p[p.length-1];L.scale=C,L.font=P,L.textColor=b}else{const C=n.parse(t[g],g,Cn);if(!C)return null;const P=C.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,p.push({content:C,scale:null,font:null,textColor:null})}}return new fl(p)}evaluate(t){return new ds(this.sections.map(n=>{const c=n.content.evaluate(t);return _a(c)===Gr?new Qs("",c,null,null,null):new Qs(Wo(c),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const n of this.sections){t.push(n.content.serialize());const c={};n.scale&&(c["font-scale"]=n.scale.serialize()),n.font&&(c["text-font"]=n.font.serialize()),n.textColor&&(c["text-color"]=n.textColor.serialize()),t.push(c)}return t}}class Lu{constructor(t,n,c,p){this._imageWarnHistory={},this.type=Gr,this.inputPrimary=t,this.inputSecondary=n,this.inputPrimaryParams=c,this.inputSecondaryParams=p}static parse(t,n){if(t.length<2)return n.error("Expected two or more arguments.");let c=1;const p=[];function h(){if(c<t.length){const M=n.parse(t[c],c++,yn);return M?(p.push({image:M,options:void 0}),!0):(n.error(p.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function g(){if(c<t.length){if((M=t[c])===null||typeof M!="object"||Array.isArray(M))return!0;const C=t[c].params,P=n.concat(c);if(!C)return c++,!0;if(typeof C!="object"||C.constructor!==Object)return P.error('Image options "params" should be an object'),!1;const b={},L=P.concat(void 0,"params");for(const D in C){if(!D)return L.error("Image parameter name should be non-empty"),!1;const A=L.concat(void 0,D).parse(C[D],void 0,qn,void 0,{typeAnnotation:"coerce"});if(!A)return!1;b[D]=A}return p[p.length-1].options=b,c++,!0}var M;return!0}for(let M=0;M<2;M++)if(!h()||!g())return;return new Lu(p[0].image,p[1]?p[1].image:void 0,p[0].options,p[1]?p[1].options:void 0)}evaluateParams(t,n){const c={};if(n){for(const p in n)if(n[p])try{const h=n[p].evaluate(t),g=`Ignoring image parameter "${p}" with semi-transparent color ${h.toString()}`;if(h.a!==1){this._imageWarnHistory[g]||(console.warn(g),this._imageWarnHistory[g]=!0);continue}c[p]=h}catch{continue}if(Object.keys(c).length!==0)return{params:c}}}evaluate(t){const n=Ts.build(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0,this.inputPrimaryParams?this.evaluateParams(t,this.inputPrimaryParams):void 0,this.inputSecondaryParams?this.evaluateParams(t,this.inputSecondaryParams):void 0);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&t.availableImages&&(n.available=t.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(t){if(t(this.inputPrimary),this.inputPrimaryParams)for(const n in this.inputPrimaryParams)this.inputPrimaryParams[n]&&t(this.inputPrimaryParams[n]);if(this.inputSecondary&&(t(this.inputSecondary),this.inputSecondaryParams))for(const n in this.inputSecondaryParams)this.inputSecondaryParams[n]&&t(this.inputSecondaryParams[n])}outputDefined(){return!1}serializeParams(t){const n={};if(t){for(const c in t)t[c]&&(n[c]=t[c].serialize());return{params:n}}}serialize(){const t=["image",this.inputPrimary.serialize()];return this.inputPrimaryParams&&t.push(this.serializeParams(this.inputPrimaryParams)),this.inputSecondary&&(t.push(this.inputSecondary.serialize()),this.inputSecondaryParams&&t.push(this.serializeParams(this.inputSecondaryParams))),t}}function co(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}const df={"to-boolean":Si,"to-color":qn,"to-number":Ft,"to-string":yn};class Nl{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const c=t[0],p=[];let h=on;if(c==="to-array"){if(!Array.isArray(t[1]))return null;const g=t[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);h=Lr(n.expectedType.itemType,g)}else{if(!(g>0&&Gs(t[1][0])))return null;h=Lr(_a(t[1][0]),g)}for(let M=0;M<g;M++){const C=t[1][M];let P;if(co(C)==="array")P=n.parse(C,void 0,h.itemType);else{const b=co(C);if(b!==h.itemType.kind)return n.error(`Expected ${h.itemType.kind} but found ${b}.`);P=n.registry.literal.parse(["literal",C===void 0?null:C],n)}if(!P)return null;p.push(P)}}else{if((c==="to-boolean"||c==="to-string")&&t.length!==2)return n.error("Expected one argument.");h=df[c];for(let g=1;g<t.length;g++){const M=n.parse(t[g],g,Cn);if(!M)return null;p.push(M)}}return new Nl(h,p)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let n,c;for(const p of this.args){if(n=p.evaluate(t),c=null,n instanceof we)return n;if(typeof n=="string"){const h=t.parseColor(n);if(h)return h}else if(Array.isArray(n)&&(c=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:al(n[0],n[1],n[2],n[3]),!c))return new we(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new fs(c||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const c of this.args){if(n=c.evaluate(t),n===null)return 0;const p=Number(n);if(!isNaN(p))return p}throw new fs(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?ds.fromString(Wo(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Ts.build(Wo(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(n=>n.evaluate(t)):Wo(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new fl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Lu(this.args[0]).serialize();const t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{t.push(n.serialize())}),t}}const Ml=["Unknown","Point","LineString","Polygon"];class Uh{constructor(t,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ml[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:c,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*n-t[0])+this.featureDistanceData.bearing[1]*(p*n-t[1])}return 0}parseColor(t){let n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=we.parse(t)),n}getConfig(t){return this.options?this.options.get(t):null}}class ps{constructor(t,n,c,p,h){this.name=t,this.type=n,this._evaluate=c,this.args=p,this._overloadIndex=h}evaluate(t){if(!this._evaluate){const n=ps.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,n){const c=t[0],p=ps.definitions[c];if(!p)return n.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(p)?p[0]:p.type,g=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,M=[];let C=null,P=-1;for(const[b,L]of g){if(Array.isArray(b)&&b.length!==t.length-1)continue;M.push(b),P++,C=new ru(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);const D=[];let A=!1;for(let R=1;R<t.length;R++){const B=t[R],q=Array.isArray(b)?b[R-1]:b.type,W=C.parse(B,1+D.length,q);if(!W){A=!0;break}D.push(W)}if(!A)if(Array.isArray(b)&&b.length!==D.length)C.error(`Expected ${b.length} arguments, but found ${D.length} instead.`);else{for(let R=0;R<D.length;R++){const B=Array.isArray(b)?b[R]:b.type,q=D[R];C.concat(R+1).checkSubtype(B,q.type)}if(C.errors.length===0)return new ps(c,h,L,D,P)}}if(M.length===1)n.errors.push(...C.errors);else{const b=(M.length?M:g.map(([D])=>D)).map(oa).join(" | "),L=[];for(let D=1;D<t.length;D++){const A=n.parse(t[D],1+L.length);if(!A)return null;L.push(xr(A.type))}n.error(`Expected arguments of type ${b}, but found (${L.join(", ")}) instead.`)}return null}static register(t,n){ps.definitions=n;for(const c in n)t[c]=ps}}function oa(s){return Array.isArray(s)?`(${s.map(xr).join(", ")})`:`(${xr(s.type)}...)`}class Rd{constructor(t,n,c){this.type=Ar,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const c=t[1];if(typeof c!="object"||Array.isArray(c))return n.error("Collator options argument must be an object.");const p=c["case-sensitive"]===void 0?n.parse(!1,1,Si):n.parseObjectValue(c["case-sensitive"],1,"case-sensitive",Si);if(!p)return null;const h=c["diacritic-sensitive"]===void 0?n.parse(!1,1,Si):n.parseObjectValue(c["diacritic-sensitive"],1,"diacritic-sensitive",Si);if(!h)return null;let g=null;return c.locale&&(g=n.parseObjectValue(c.locale,1,"locale",yn),!g)?null:new Rd(p,h,g)}evaluate(t){return new aa(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function tu(s,t,n=0,c=s.length-1,p=sh){for(;c>n;){if(c-n>600){const C=c-n+1,P=t-n+1,b=Math.log(C),L=.5*Math.exp(2*b/3),D=.5*Math.sqrt(b*L*(C-L)/C)*(P-C/2<0?-1:1);tu(s,t,Math.max(n,Math.floor(t-P*L/C+D)),Math.min(c,Math.floor(t+(C-P)*L/C+D)),p)}const h=s[t];let g=n,M=c;for(Vh(s,n,t),p(s[c],h)>0&&Vh(s,n,c);g<M;){for(Vh(s,g,M),g++,M--;p(s[g],h)<0;)g++;for(;p(s[M],h)>0;)M--}p(s[n],h)===0?Vh(s,n,M):(M++,Vh(s,M,c)),M<=t&&(n=M+1),t<=M&&(c=M-1)}}function Vh(s,t,n){const c=s[t];s[t]=s[n],s[n]=c}function sh(s,t){return s<t?-1:s>t?1:0}function oh(s){let t=0;for(let n,c,p=0,h=s.length,g=h-1;p<h;g=p++)n=s[p],c=s[g],t+=(c.x-n.x)*(n.y+c.y);return t}function gc(s,t){s[0]=Math.min(s[0],t[0]),s[1]=Math.min(s[1],t[1]),s[2]=Math.max(s[2],t[0]),s[3]=Math.max(s[3],t[1])}function Gh(s,t){return!(s[0]<=t[0]||s[2]>=t[2]||s[1]<=t[1]||s[3]>=t[3])}function dp(s,t,n){const c=s[0]-t[0],p=s[1]-t[1],h=s[0]-n[0],g=s[1]-n[1];return c*g-h*p==0&&c*h<=0&&p*g<=0}function lh(s,t,n=!1){let c=!1;for(let M=0,C=t.length;M<C;M++){const P=t[M];for(let b=0,L=P.length,D=L-1;b<L;D=b++){const A=P[D],R=P[b];if(dp(s,A,R))return n;(h=A)[1]>(p=s)[1]!=(g=R)[1]>p[1]&&p[0]<(g[0]-h[0])*(p[1]-h[1])/(g[1]-h[1])+h[0]&&(c=!c)}}var p,h,g;return c}function Id(s,t,n,c){const p=c[0]-n[0],h=c[1]-n[1],g=(s[0]-n[0])*h-p*(s[1]-n[1]),M=(t[0]-n[0])*h-p*(t[1]-n[1]);return g>0&&M<0||g<0&&M>0}function Ul(s,t,n,c){return(p=[c[0]-n[0],c[1]-n[1]])[0]*(h=[t[0]-s[0],t[1]-s[1]])[1]-p[1]*h[0]!=0&&!(!Id(s,t,n,c)||!Id(n,c,s,t));var p,h}const Tl=8192;function jf(s,t){const n=(180+s[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,p=Math.pow(2,t.z);return[Math.round(n*p*Tl),Math.round(c*p*Tl)]}function Hh(s,t){for(let n=0;n<t.length;n++)if(lh(s,t[n]))return!0;return!1}function ff(s,t,n){for(const c of n)for(let p=0,h=c.length,g=h-1;p<h;g=p++)if(Ul(s,t,c[g],c[p]))return!0;return!1}function pf(s,t){for(let n=0;n<s.length;++n)if(!lh(s[n],t))return!1;for(let n=0;n<s.length-1;++n)if(ff(s[n],s[n+1],t))return!1;return!0}function mf(s,t){for(let n=0;n<t.length;n++)if(pf(s,t[n]))return!0;return!1}function eo(s,t,n){const c=[];for(let p=0;p<s.length;p++){const h=[];for(let g=0;g<s[p].length;g++){const M=jf(s[p][g],n);gc(t,M),h.push(M)}c.push(h)}return c}function Sl(s,t,n){const c=[];for(let p=0;p<s.length;p++){const h=eo(s[p],t,n);c.push(h)}return c}function Fr(s,t,n,c){if(s[0]<n[0]||s[0]>n[2]){const p=.5*c;let h=s[0]-n[0]>p?-c:n[0]-s[0]>p?c:0;h===0&&(h=s[0]-n[2]>p?-c:n[2]-s[0]>p?c:0),s[0]+=h}gc(t,s)}function sr(s,t,n,c){const p=Math.pow(2,c.z)*Tl,h=[c.x*Tl,c.y*Tl],g=[];if(!s)return g;for(const M of s)for(const C of M){const P=[C.x+h[0],C.y+h[1]];Fr(P,t,n,p),g.push(P)}return g}function zo(s,t,n,c){const p=Math.pow(2,c.z)*Tl,h=[c.x*Tl,c.y*Tl],g=[];if(!s)return g;for(const C of s){const P=[];for(const b of C){const L=[b.x+h[0],b.y+h[1]];gc(t,L),P.push(L)}g.push(P)}if(t[2]-t[0]<=p/2){(M=t)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const C of g)for(const P of C)Fr(P,t,n,p)}var M;return g}class br{constructor(t,n){this.type=Si,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Gs(t[1])){const c=t[1];if(c.type==="FeatureCollection")for(let p=0;p<c.features.length;++p){const h=c.features[p].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new br(c,c.features[p].geometry)}else if(c.type==="Feature"){const p=c.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new br(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new br(c,c)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,c){const p=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(!g)return!1;if(c.type==="Polygon"){const M=eo(c.coordinates,h,g),C=sr(n.geometry(),p,h,g);if(!Gh(p,h))return!1;for(const P of C)if(!lh(P,M))return!1}if(c.type==="MultiPolygon"){const M=Sl(c.coordinates,h,g),C=sr(n.geometry(),p,h,g);if(!Gh(p,h))return!1;for(const P of C)if(!Hh(P,M))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,c){const p=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(!g)return!1;if(c.type==="Polygon"){const M=eo(c.coordinates,h,g),C=zo(n.geometry(),p,h,g);if(!Gh(p,h))return!1;for(const P of C)if(!pf(P,M))return!1}if(c.type==="MultiPolygon"){const M=Sl(c.coordinates,h,g),C=zo(n.geometry(),p,h,g);if(!Gh(p,h))return!1;for(const P of C)if(!mf(P,M))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const El={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},_c=1/298.257223563,rr=_c*(2-_c),Fc=Math.PI/180;class ec{static fromTile(t,n,c){const p=Math.PI*(1-2*(t+.5)/Math.pow(2,n)),h=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/Fc;return new ec(h,c)}static get units(){return El}constructor(t,n){if(t===void 0)throw new Error("No latitude given.");if(n&&!El[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(El).join(", ")}`);const c=6378.137*Fc*(n?El[n]:1),p=Math.cos(t*Fc),h=1/(1-rr*(1-p*p)),g=Math.sqrt(h);this.kx=c*g*p,this.ky=c*g*h*(1-rr)}distance(t,n){const c=Po(t[0]-n[0])*this.kx,p=(t[1]-n[1])*this.ky;return Math.sqrt(c*c+p*p)}bearing(t,n){const c=Po(n[0]-t[0])*this.kx;return Math.atan2(c,(n[1]-t[1])*this.ky)/Fc}destination(t,n,c){const p=c*Fc;return this.offset(t,Math.sin(p)*n,Math.cos(p)*n)}offset(t,n,c){return[t[0]+n/this.kx,t[1]+c/this.ky]}lineDistance(t){let n=0;for(let c=0;c<t.length-1;c++)n+=this.distance(t[c],t[c+1]);return n}area(t){let n=0;for(let c=0;c<t.length;c++){const p=t[c];for(let h=0,g=p.length,M=g-1;h<g;M=h++)n+=Po(p[h][0]-p[M][0])*(p[h][1]+p[M][1])*(c?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(t,n){let c=0;if(n<=0)return t[0];for(let p=0;p<t.length-1;p++){const h=t[p],g=t[p+1],M=this.distance(h,g);if(c+=M,c>n)return ch(h,g,(n-(c-M))/M)}return t[t.length-1]}pointToSegmentDistance(t,n,c){let[p,h]=n,g=Po(c[0]-p)*this.kx,M=(c[1]-h)*this.ky;if(g!==0||M!==0){const C=(Po(t[0]-p)*this.kx*g+(t[1]-h)*this.ky*M)/(g*g+M*M);C>1?(p=c[0],h=c[1]):C>0&&(p+=g/this.kx*C,h+=M/this.ky*C)}return g=Po(t[0]-p)*this.kx,M=(t[1]-h)*this.ky,Math.sqrt(g*g+M*M)}pointOnLine(t,n){let c=1/0,p=t[0][0],h=t[0][1],g=0,M=0;for(let C=0;C<t.length-1;C++){let P=t[C][0],b=t[C][1],L=Po(t[C+1][0]-P)*this.kx,D=(t[C+1][1]-b)*this.ky,A=0;L===0&&D===0||(A=(Po(n[0]-P)*this.kx*L+(n[1]-b)*this.ky*D)/(L*L+D*D),A>1?(P=t[C+1][0],b=t[C+1][1]):A>0&&(P+=L/this.kx*A,b+=D/this.ky*A)),L=Po(n[0]-P)*this.kx,D=(n[1]-b)*this.ky;const R=L*L+D*D;R<c&&(c=R,p=P,h=b,g=C,M=A)}return{point:[p,h],index:g,t:Math.max(0,Math.min(1,M))}}lineSlice(t,n,c){let p=this.pointOnLine(c,t),h=this.pointOnLine(c,n);if(p.index>h.index||p.index===h.index&&p.t>h.t){const P=p;p=h,h=P}const g=[p.point],M=p.index+1,C=h.index;!Ru(c[M],g[0])&&M<=C&&g.push(c[M]);for(let P=M+1;P<=C;P++)g.push(c[P]);return Ru(c[C],h.point)||g.push(h.point),g}lineSliceAlong(t,n,c){let p=0;const h=[];for(let g=0;g<c.length-1;g++){const M=c[g],C=c[g+1],P=this.distance(M,C);if(p+=P,p>t&&h.length===0&&h.push(ch(M,C,(t-(p-P))/P)),p>=n)return h.push(ch(M,C,(n-(p-P))/P)),h;p>t&&h.push(C)}return h}bufferPoint(t,n){const c=n/this.ky,p=n/this.kx;return[t[0]-p,t[1]-c,t[0]+p,t[1]+c]}bufferBBox(t,n){const c=n/this.ky,p=n/this.kx;return[t[0]-p,t[1]-c,t[2]+p,t[3]+c]}insideBBox(t,n){return Po(t[0]-n[0])>=0&&Po(t[0]-n[2])<=0&&t[1]>=n[1]&&t[1]<=n[3]}}function Ru(s,t){return s[0]===t[0]&&s[1]===t[1]}function ch(s,t,n){const c=Po(t[0]-s[0]);return[s[0]+c*n,s[1]+(t[1]-s[1])*n]}function Po(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}class bo{constructor(t=[],n=(c,p)=>c<p?-1:c>p?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:c}=this,p=n[t];for(;t>0;){const h=t-1>>1,g=n[h];if(c(p,g)>=0)break;n[t]=g,t=h}n[t]=p}_down(t){const{data:n,compare:c}=this,p=this.length>>1,h=n[t];for(;t<p;){let g=1+(t<<1);const M=g+1;if(M<this.length&&c(n[M],n[g])<0&&(g=M),c(n[g],h)>=0)break;n[t]=n[g],t=g}n[t]=h}}var vn=8192;function tc(s,t){return t.dist-s.dist}const iu=100,uh=50;function yc(s){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==s.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==s[n])return!1;return!0}function wo(s){return s[1]-s[0]+1}function Iu(s,t){const n=s[1]>=s[0]&&s[1]<t;return n||console.warn("Distance Expression: Index is out of range"),n}function Du(s,t){if(s[0]>s[1])return[null,null];const n=wo(s);if(t){if(n===2)return[s,null];const c=Math.floor(n/2);return[[s[0],s[0]+c],[s[0]+c,s[1]]]}{if(n===1)return[s,null];const c=Math.floor(n/2)-1;return[[s[0],s[0]+c],[s[0]+c+1,s[1]]]}}function Kr(s,t){const n=[1/0,1/0,-1/0,-1/0];if(!Iu(t,s.length))return n;for(let c=t[0];c<=t[1];++c)gc(n,s[c]);return n}function dr(s){const t=[1/0,1/0,-1/0,-1/0];for(let n=0;n<s.length;++n)for(let c=0;c<s[n].length;++c)gc(t,s[n][c]);return t}function Zo(s,t,n){if(yc(s)||yc(t))return NaN;let c=0,p=0;return s[2]<t[0]&&(c=t[0]-s[2]),s[0]>t[2]&&(c=s[0]-t[2]),s[1]>t[3]&&(p=s[1]-t[3]),s[3]<t[1]&&(p=t[1]-s[3]),n.distance([0,0],[c,p])}function qf(s){return 360*s-180}function Op(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Wf(s,t){const n=Math.pow(2,t.z),c=(s.y/vn+t.y)/n;return[qf((s.x/vn+t.x)/n),Op(c)]}function fp(s,t){const n=[];for(let c=0;c<s.length;++c)n.push(Wf(s[c],t));return n}function Bp(s,t,n){const c=n.pointOnLine(t,s).point;return n.distance(s,c)}function pp(s,t,n,c,p){const h=n.slice(c[0],c[1]+1);let g=1/0;for(let M=t[0];M<=t[1];++M)if((g=Math.min(g,Bp(s[M],h,p)))===0)return 0;return g}function vc(s,t,n,c,p){const h=Math.min(p.pointToSegmentDistance(s,n,c),p.pointToSegmentDistance(t,n,c)),g=Math.min(p.pointToSegmentDistance(n,s,t),p.pointToSegmentDistance(c,s,t));return Math.min(h,g)}function hh(s,t,n,c,p){if(!Iu(t,s.length)||!Iu(c,n.length))return NaN;let h=1/0;for(let g=t[0];g<t[1];++g)for(let M=c[0];M<c[1];++M){if(Ul(s[g],s[g+1],n[M],n[M+1]))return 0;h=Math.min(h,vc(s[g],s[g+1],n[M],n[M+1],p))}return h}function Al(s,t,n,c,p){if(!Iu(t,s.length)||!Iu(c,n.length))return NaN;let h=1/0;for(let g=t[0];g<=t[1];++g)for(let M=c[0];M<=c[1];++M)if((h=Math.min(h,p.distance(s[g],n[M])))===0)return h;return h}function nu(s,t,n){if(lh(s,t,!0))return 0;let c=1/0;for(const p of t){const h=p.length;if(h<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[h-1]&&(c=Math.min(c,n.pointToSegmentDistance(s,p[h-1],p[0])))===0||(c=Math.min(c,Bp(s,p,n)))===0)return c}return c}function mp(s,t,n,c){if(!Iu(t,s.length))return NaN;for(let h=t[0];h<=t[1];++h)if(lh(s[h],n,!0))return 0;let p=1/0;for(let h=t[0];h<t[1];++h)for(const g of n)for(let M=0,C=g.length,P=C-1;M<C;P=M++){if(Ul(s[h],s[h+1],g[P],g[M]))return 0;p=Math.min(p,vc(s[h],s[h+1],g[P],g[M],c))}return p}function kc(s,t){for(const n of s)for(let c=0;c<=n.length-1;++c)if(lh(n[c],t,!0))return!0;return!1}function sl(s,t,n,c=1/0){const p=dr(s),h=dr(t);if(c!==1/0&&Zo(p,h,n)>=c)return c;if(Gh(p,h)){if(kc(s,t))return 0}else if(kc(t,s))return 0;let g=c;for(const M of s)for(let C=0,P=M.length,b=P-1;C<P;b=C++)for(const L of t)for(let D=0,A=L.length,R=A-1;D<A;R=D++){if(Ul(M[b],M[C],L[R],L[D]))return 0;g=Math.min(g,vc(M[b],M[C],L[R],L[D],n))}return g}function zu(s,t,n,c,p,h,g){if(h===null||g===null)return;const M=Zo(Kr(c,h),Kr(p,g),n);M<t&&s.push({dist:M,range1:h,range2:g})}function jh(s,t,n,c,p=1/0){let h=Math.min(c.distance(s[0],n[0][0]),p);if(h===0)return h;const g=new bo([{dist:0,range1:[0,s.length-1],range2:[0,0]}],tc),M=t?uh:iu,C=dr(n);for(;g.length;){const P=g.pop();if(P.dist>=h)continue;const b=P.range1;if(wo(b)<=M){if(!Iu(b,s.length))return NaN;if(t){const L=mp(s,b,n,c);if((h=Math.min(h,L))===0)return h}else for(let L=b[0];L<=b[1];++L){const D=nu(s[L],n,c);if((h=Math.min(h,D))===0)return h}}else{const L=Du(b,t);if(L[0]!==null){const D=Zo(Kr(s,L[0]),C,c);D<h&&g.push({dist:D,range1:L[0],range2:[0,0]})}if(L[1]!==null){const D=Zo(Kr(s,L[1]),C,c);D<h&&g.push({dist:D,range1:L[1],range2:[0,0]})}}}return h}function Oo(s,t,n,c,p,h=1/0){let g=Math.min(h,p.distance(s[0],n[0]));if(g===0)return g;const M=new bo([{dist:0,range1:[0,s.length-1],range2:[0,n.length-1]}],tc),C=t?uh:iu,P=c?uh:iu;for(;M.length;){const b=M.pop();if(b.dist>=g)continue;const L=b.range1,D=b.range2;if(wo(L)<=C&&wo(D)<=P){if(!Iu(L,s.length)||!Iu(D,n.length))return NaN;if(t&&c?g=Math.min(g,hh(s,L,n,D,p)):t||c?t&&!c?g=Math.min(g,pp(n,D,s,L,p)):!t&&c&&(g=Math.min(g,pp(s,L,n,D,p))):g=Math.min(g,Al(s,L,n,D,p)),g===0)return g}else{const A=Du(L,t),R=Du(D,c);zu(M,g,p,s,n,A[0],R[0]),zu(M,g,p,s,n,A[0],R[1]),zu(M,g,p,s,n,A[1],R[0]),zu(M,g,p,s,n,A[1],R[1])}}return g}function dh(s,t,n,c,p=1/0){let h=p;const g=Kr(s,[0,s.length-1]);for(const M of n)if(!(h!==1/0&&Zo(g,Kr(M,[0,M.length-1]),c)>=h)&&(h=Math.min(h,Oo(s,t,M,!0,c,h)),h===0))return h;return h}function qh(s,t,n,c,p=1/0){let h=p;const g=Kr(s,[0,s.length-1]);for(const M of n){if(h!==1/0&&Zo(g,dr(M),c)>=h)continue;const C=jh(s,t,M,c,h);if(isNaN(C))return C;if((h=Math.min(h,C))===0)return h}return h}function Wh(s){return s==="Point"||s==="MultiPoint"||s==="LineString"||s==="MultiLineString"||s==="Polygon"||s==="MultiPolygon"}class Vl{constructor(t,n){this.type=Ft,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(Gs(t[1])){const c=t[1];if(c.type==="FeatureCollection"){for(let p=0;p<c.features.length;++p)if(Wh(c.features[p].geometry.type))return new Vl(c,c.features[p].geometry)}else if(c.type==="Feature"){if(Wh(c.geometry.type))return new Vl(c,c.geometry)}else if(Wh(c.type))return new Vl(c,c)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const n=t.geometry(),c=t.canonicalID();if(n!=null&&c!=null){if(t.geometryType()==="Point")return function(p,h,g){const M=[];for(const P of p)for(const b of P)M.push(Wf(b,h));const C=new ec(M[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?Oo(M,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",C):g.type==="MultiLineString"?dh(M,!1,g.coordinates,C):g.type==="Polygon"||g.type==="MultiPolygon"?qh(M,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,C):null}(n,c,this.geometries);if(t.geometryType()==="LineString")return function(p,h,g){const M=[];for(const P of p){const b=[];for(const L of P)b.push(Wf(L,h));M.push(b)}const C=new ec(M[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return dh(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",M,C);if(g.type==="MultiLineString"){let P=1/0;for(let b=0;b<g.coordinates.length;b++){const L=dh(g.coordinates[b],!0,M,C,P);if(isNaN(L))return L;if((P=Math.min(P,L))===0)return P}return P}if(g.type==="Polygon"||g.type==="MultiPolygon"){let P=1/0;for(let b=0;b<M.length;b++){const L=qh(M[b],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,C,P);if(isNaN(L))return L;if((P=Math.min(P,L))===0)return P}return P}return null}(n,c,this.geometries);if(t.geometryType()==="Polygon")return function(p,h,g){const M=[];for(const P of function(b,L){const D=b.length;if(D<=1)return[b];const A=[];let R,B;for(let q=0;q<D;q++){const W=oh(b[q]);W!==0&&(b[q].area=Math.abs(W),B===void 0&&(B=W<0),B===W<0?(R&&A.push(R),R=[b[q]]):R.push(b[q]))}return R&&A.push(R),A}(p)){const b=[];for(let L=0;L<P.length;++L)b.push(fp(P[L],h));M.push(b)}const C=new ec(M[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return qh(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",M,C);if(g.type==="MultiLineString"){let P=1/0;for(let b=0;b<g.coordinates.length;b++){const L=qh(g.coordinates[b],!0,M,C,P);if(isNaN(L))return L;if((P=Math.min(P,L))===0)return P}return P}return g.type==="Polygon"||g.type==="MultiPolygon"?function(P,b,L){let D=1/0;for(const A of P)for(const R of b){const B=sl(A,R,L,D);if(isNaN(B))return B;if((D=Math.min(D,B))===0)return D}return D}(g.type==="Polygon"?[g.coordinates]:g.coordinates,M,C):null}(n,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Pu(s,t){switch(s){case"string":return Wo(t);case"number":return+t;case"boolean":return!!t;case"color":return we.parse(t);case"formatted":return ds.fromString(Wo(t));case"resolvedImage":return Ts.build(Wo(t))}return t}function Zf(s,t,n,c){return c!==void 0&&(s=c*Math.round(s/c)),t!==void 0&&s<t&&(s=t),n!==void 0&&s>n&&(s=n),s}class Ou{constructor(t,n,c){this.type=t,this.key=n,this.scope=c}static parse(t,n){let c=n.expectedType;if(c==null&&(c=Cn),t.length<2||t.length>3)return n.error("Invalid number of arguments for 'config' expression.");const p=n.parse(t[1],1);if(!(p instanceof or))return n.error("Key name of 'config' expression must be a string literal.");if(t.length>=3){const h=n.parse(t[2],2);return h instanceof or?new Ou(c,Wo(p.value),Wo(h.value)):n.error("Scope of 'config' expression must be a string literal.")}return new Ou(c,Wo(p.value))}evaluate(t){const n=[this.key,this.scope,t.scope].filter(Boolean).join(""),c=t.getConfig(n);if(!c)return null;const{type:p,value:h,values:g,minValue:M,maxValue:C,stepValue:P}=c,b=c.default.evaluate(t);let L=b;if(h){const D=t.scope;t.scope=(D||"").split("").slice(1).join(""),L=h.evaluate(t),t.scope=D}return p&&(L=Pu(p,L)),L===void 0||M===void 0&&C===void 0&&P===void 0||(typeof L=="number"?L=Zf(L,M,C,P):Array.isArray(L)&&(L=L.map(D=>typeof D=="number"?Zf(D,M,C,P):D))),h!==void 0&&L!==void 0&&g&&!g.includes(L)&&(L=b,p&&(L=Pu(p,L))),(p&&p!==this.type||L!==void 0&&_a(L)!==this.type)&&(L=Pu(this.type.kind,L)),L}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.key),t}}function Zh(s){if(s instanceof ps&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof br||s instanceof Vl)return!1;let t=!0;return s.eachChild(n=>{t&&!Zh(n)&&(t=!1)}),t}function Dd(s){if(s instanceof ps&&s.name==="feature-state")return!1;let t=!0;return s.eachChild(n=>{t&&!Dd(n)&&(t=!1)}),t}function pl(s){if(s instanceof Ou)return new Set([s.key]);let t=new Set;return s.eachChild(n=>{t=new Set([...t,...pl(n)])}),t}function po(s,t){if(s instanceof ps&&t.indexOf(s.name)>=0)return!1;let n=!0;return s.eachChild(c=>{n&&!po(c,t)&&(n=!1)}),n}class ic{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const c=t[1];return n.scope.has(c)?new ic(c,n.scope.get(c)):n.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Bu{constructor(t,n=[],c,p=new Jn,h=[],g,M){this.registry=t,this.path=n,this.key=n.map(C=>typeof C=="string"?`['${C}']`:`[${C}]`).join(""),this.scope=p,this.errors=h,this.expectedType=c,this._scope=g,this.options=M}parse(t,n,c,p,h={}){return n||c?this.concat(n,null,c,p)._parse(t,h):this._parse(t,h)}parseObjectValue(t,n,c,p,h,g={}){return this.concat(n,c,p,h)._parse(t,g)}_parse(t,n){function c(p,h,g){return g==="assert"?new kl(h,[p]):g==="coerce"?new Nl(h,[p]):p}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(p){let h=p.parse(t,this);if(!h)return null;if(this.expectedType){const g=this.expectedType,M=h.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||M.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(g,M))return null}else h=c(h,g,n.typeAnnotation||"coerce");else h=c(h,g,n.typeAnnotation||"assert")}if(!(h instanceof or)&&h.type.kind!=="resolvedImage"&&Fu(h)){const g=new Uh(this._scope,this.options);try{h=new or(h.type,h.evaluate(g))}catch(M){return this.error(M.message),null}}return h}return Nl.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,c,p){let h=typeof t=="number"?this.path.concat(t):this.path;h=typeof n=="string"?h.concat(n):h;const g=p?this.scope.concat(p):this.scope;return new Bu(this.registry,h,c||null,g,this.errors,this._scope,this.options)}error(t,...n){const c=`${this.key}${n.map(p=>`[${p}]`).join("")}`;this.errors.push(new Di(c,t))}checkSubtype(t,n){const c=fa(t,n);return c&&this.error(c),c}}var ru=Bu;function Fu(s){if(s instanceof ic)return Fu(s.boundExpression);if(s instanceof ps&&s.name==="error"||s instanceof Rd||s instanceof br||s instanceof Vl||s instanceof Ou)return!1;const t=s instanceof Nl||s instanceof kl;let n=!0;return s.eachChild(c=>{n=t?n&&Fu(c):n&&c instanceof or}),!!n&&Zh(s)&&po(s,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Xh(s,t){const n=s.length-1;let c,p,h=0,g=n,M=0;for(;h<=g;)if(M=Math.floor((h+g)/2),c=s[M],p=s[M+1],c<=t){if(M===n||t<p)return M;h=M+1}else{if(!(c>t))throw new fs("Input is not a number.");g=M-1}return 0}class nc{constructor(t,n,c){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[p,h]of c)this.labels.push(p),this.outputs.push(h)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const c=n.parse(t[1],1,Ft);if(!c)return null;const p=[];let h=null;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);for(let g=1;g<t.length;g+=2){const M=g===1?-1/0:t[g],C=t[g+1],P=g,b=g+1;if(typeof M!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(p.length&&p[p.length-1][0]>=M)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const L=n.parse(C,b,h);if(!L)return null;h=h||L.type,p.push([M,L])}return new nc(h,c,p)}evaluate(t){const n=this.labels,c=this.outputs;if(n.length===1)return c[0].evaluate(t);const p=this.input.evaluate(t);if(p<=n[0])return c[0].evaluate(t);const h=n.length;return p>=n[h-1]?c[h-1].evaluate(t):c[Xh(n,p)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&t.push(this.labels[n]),t.push(this.outputs[n].serialize());return t}}const fh=.95047,ua=1.08883,Yh=4/29,$h=6/29,rc=3*$h*$h,Kh=$h*$h*$h,zd=Math.PI/180,Za=180/Math.PI;function ph(s){return s>Kh?Math.pow(s,1/3):s/rc+Yh}function Cl(s){return s>$h?s*s*s:rc*(s-Yh)}function Gl(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function ku(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Nc(s){const t=ku(s.r),n=ku(s.g),c=ku(s.b),p=ph((.4124564*t+.3575761*n+.1804375*c)/fh),h=ph((.2126729*t+.7151522*n+.072175*c)/1);return{l:116*h-16,a:500*(p-h),b:200*(h-ph((.0193339*t+.119192*n+.9503041*c)/ua)),alpha:s.a}}function Uc(s){let t=(s.l+16)/116,n=isNaN(s.a)?t:t+s.a/500,c=isNaN(s.b)?t:t-s.b/200;return t=1*Cl(t),n=fh*Cl(n),c=ua*Cl(c),new we(Gl(3.2404542*n-1.5371385*t-.4985314*c),Gl(-.969266*n+1.8760108*t+.041556*c),Gl(.0556434*n-.2040259*t+1.0572252*c),s.alpha)}function mh(s,t,n){const c=t-s;return s+n*(c>180||c<-180?c-360*Math.round(c/360):c)}const Jh={forward:Nc,reverse:Uc,interpolate:function(s,t,n){return{l:Ee(s.l,t.l,n),a:Ee(s.a,t.a,n),b:Ee(s.b,t.b,n),alpha:Ee(s.alpha,t.alpha,n)}}},gh={forward:function(s){const{l:t,a:n,b:c}=Nc(s),p=Math.atan2(c,n)*Za;return{h:p<0?p+360:p,c:Math.sqrt(n*n+c*c),l:t,alpha:s.a}},reverse:function(s){const t=s.h*zd,n=s.c;return Uc({l:s.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:s.alpha})},interpolate:function(s,t,n){return{h:mh(s.h,t.h,n),c:Ee(s.c,t.c,n),l:Ee(s.l,t.l,n),alpha:Ee(s.alpha,t.alpha,n)}}};var gf=Object.freeze({__proto__:null,hcl:gh,lab:Jh});class ls{constructor(t,n,c,p,h,g){this.type=t,this.operator=n,this.interpolation=c,this.input=p,this.dynamicStops=h,this.labels=[],this.outputs=[];for(const[M,C]of g)this.labels.push(M),this.outputs.push(C)}static interpolationFactor(t,n,c,p){let h=0;if(t.name==="exponential")h=cs(n,t.base,c,p);else if(t.name==="linear")h=cs(n,1,c,p);else if(t.name==="cubic-bezier"){const g=t.controlPoints;h=new Ra(g[0],g[1],g[2],g[3]).solve(cs(n,1,c,p))}return h}static parse(t,n){let[c,p,h,...g]=t;if(!Array.isArray(p)||p.length===0)return n.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const P=p[1];if(typeof P!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:P}}else{if(p[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const P=p.slice(1);if(P.length!==4||P.some(b=>typeof b!="number"||b<0||b>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:P}}}if(t.length-1<3)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length-1>3&&(t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(h=n.parse(h,2,Ft),!h)return null;const M=[];let C=null;if(c==="interpolate-hcl"||c==="interpolate-lab"?C=qn:n.expectedType&&n.expectedType.kind!=="value"&&(C=n.expectedType),t.length-1==3){const P=n.parse(g[0],3,Cn);return P?new ls(C,c,p,h,P,M):null}for(let P=0;P<g.length;P+=2){const b=g[P],L=g[P+1],D=P+3,A=P+4;if(typeof b!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(M.length&&M[M.length-1][0]>=b)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const R=n.parse(L,A,C);if(!R)return null;C=C||R.type,M.push([b,R])}return C.kind==="number"||C.kind==="color"||C.kind==="array"&&C.itemType.kind==="number"&&typeof C.N=="number"?new ls(C,c,p,h,null,M):n.error(`Type ${xr(C)} is not interpolatable.`)}evaluate(t){let n=this.labels,c=this.outputs;if(this.dynamicStops){const b=this.dynamicStops.evaluate(t);if(b.length%2!=0)throw new fs("Expected an even number of arguments.");n=[],c=[];for(let L=0;L<b.length;L+=2){const D=b[L],A=new or(Ft,b[L+1]);if(typeof D!="number")throw new fs('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.');if(n.length&&n[n.length-1]>=D)throw new fs('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.');n.push(D),c.push(A)}if(n.length===0)throw new fs("Expected at least one input/output pair.")}if(n.length===1)return c[0].evaluate(t);const p=this.input.evaluate(t);if(p<=n[0])return c[0].evaluate(t);const h=n.length;if(p>=n[h-1])return c[h-1].evaluate(t);const g=Xh(n,p),M=ls.interpolationFactor(this.interpolation,p,n[g],n[g+1]),C=c[g].evaluate(t),P=c[g+1].evaluate(t);return this.operator==="interpolate"?Ei[this.type.kind.toLowerCase()](C,P,M):this.operator==="interpolate-hcl"?gh.reverse(gh.interpolate(gh.forward(C),gh.forward(P),M)):Jh.reverse(Jh.interpolate(Jh.forward(C),Jh.forward(P),M))}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,t,this.input.serialize()];if(this.dynamicStops)n.push(this.dynamicStops.serialize());else for(let c=0;c<this.labels.length;c++)n.push(this.labels[c],this.outputs[c].serialize());return n}}function cs(s,t,n,c){const p=c-n,h=s-n;return p===0?0:t===1?h/p:(Math.pow(t,h)-1)/(Math.pow(t,p)-1)}class pa{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let c=null;const p=n.expectedType;p&&p.kind!=="value"&&(c=p);const h=[];for(const M of t.slice(1)){const C=n.parse(M,1+h.length,c,void 0,{typeAnnotation:"omit"});if(!C)return null;c=c||C.type,h.push(C)}const g=p&&h.some(M=>fa(p,M.type));return new pa(g?Cn:c,h)}evaluate(t){let n,c=null,p=0;for(const h of this.args){if(p++,c=h.evaluate(t),c&&c instanceof Ts&&!c.available&&(n||(n=c),c=null,p===this.args.length))return n;if(c!==null)break}return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(n=>{t.push(n.serialize())}),t}}class Ll{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const c=[];for(let h=1;h<t.length-1;h+=2){const g=t[h];if(typeof g!="string")return n.error(`Expected string, but found ${typeof g} instead.`,h);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",h);const M=n.parse(t[h+1],h+1);if(!M)return null;c.push([g,M])}const p=n.parse(t[t.length-1],t.length-1,n.expectedType,c);return p?new Ll(c,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[n,c]of this.bindings)t.push(n,c.serialize());return t.push(this.result.serialize()),t}}class xc{constructor(t,n,c){this.type=t,this.index=n,this.input=c}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=n.parse(t[1],1,Ft),p=n.parse(t[2],2,Lr(n.expectedType||Cn));return c&&p?new xc(p.type.itemType,c,p):null}evaluate(t){const n=this.index.evaluate(t),c=this.input.evaluate(t);if(n<0)throw new fs(`Array index out of bounds: ${n} < 0.`);if(n>c.length-1)throw new fs(`Array index out of bounds: ${n} > ${c.length-1}.`);if(n===Math.floor(n))return c[n];const p=Math.floor(n),h=Math.ceil(n),g=c[p],M=c[h];if(typeof g!="number"||typeof M!="number")throw new fs(`Cannot interpolate between non-number values at index ${n}.`);const C=n-p;return g*(1-C)+M*C}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class _f{constructor(t,n){this.type=Si,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=n.parse(t[1],1,Cn),p=n.parse(t[2],2,Cn);return c&&p?$r(c.type,[Si,yn,Ft,on,Cn])?new _f(c,p):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${xr(c.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(c==null)return!1;if(!Ms(n,["boolean","string","number","null"]))throw new fs(`Expected first argument to be of type boolean, string, number or null, but found ${xr(_a(n))} instead.`);if(!Ms(c,["string","array"]))throw new fs(`Expected second argument to be of type array or string, but found ${xr(_a(c))} instead.`);return c.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class au{constructor(t,n,c){this.type=Ft,this.needle=t,this.haystack=n,this.fromIndex=c}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=n.parse(t[1],1,Cn),p=n.parse(t[2],2,Cn);if(!c||!p)return null;if(!$r(c.type,[Si,yn,Ft,on,Cn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${xr(c.type)} instead`);if(t.length===4){const h=n.parse(t[3],3,Ft);return h?new au(c,p,h):null}return new au(c,p)}evaluate(t){const n=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!Ms(n,["boolean","string","number","null"]))throw new fs(`Expected first argument to be of type boolean, string, number or null, but found ${xr(_a(n))} instead.`);if(!Ms(c,["string","array"]))throw new fs(`Expected second argument to be of type array or string, but found ${xr(_a(c))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(t);return c.indexOf(n,p)}return c.indexOf(n)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Xf{constructor(t,n,c,p,h,g){this.inputType=t,this.type=n,this.input=c,this.cases=p,this.outputs=h,this.otherwise=g}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let c,p;n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);const h={},g=[];for(let P=2;P<t.length-1;P+=2){let b=t[P];const L=t[P+1];Array.isArray(b)||(b=[b]);const D=n.concat(P);if(b.length===0)return D.error("Expected at least one branch label.");for(const R of b){if(typeof R!="number"&&typeof R!="string")return D.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return D.error("Numeric branch labels must be integer values.");if(c){if(D.checkSubtype(c,_a(R)))return null}else c=_a(R);if(h[String(R)]!==void 0)return D.error("Branch labels must be unique.");h[String(R)]=g.length}const A=n.parse(L,P,p);if(!A)return null;p=p||A.type,g.push(A)}const M=n.parse(t[1],1,Cn);if(!M)return null;const C=n.parse(t[t.length-1],t.length-1,p);return C?M.type.kind!=="value"&&n.concat(1).checkSubtype(c,M.type)?null:new Xf(c,p,M,h,g,C):null}evaluate(t){const n=this.input.evaluate(t);return(_a(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),c=[],p={};for(const g of n){const M=p[this.cases[g]];M===void 0?(p[this.cases[g]]=c.length,c.push([this.cases[g],[g]])):c[M][1].push(g)}const h=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,M]of c)t.push(M.length===1?h(M[0]):M.map(h)),t.push(this.outputs[g].serialize());return t.push(this.otherwise.serialize()),t}}class Yf{constructor(t,n,c){this.type=t,this.branches=n,this.otherwise=c}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const p=[];for(let g=1;g<t.length-1;g+=2){const M=n.parse(t[g],g,Si);if(!M)return null;const C=n.parse(t[g+1],g+1,c);if(!C)return null;p.push([M,C]),c=c||C.type}const h=n.parse(t[t.length-1],t.length-1,c);return h?new Yf(c,p,h):null}evaluate(t){for(const[n,c]of this.branches)if(n.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,c]of this.branches)t(n),t(c);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(n=>{t.push(n.serialize())}),t}}class _h{constructor(t,n,c,p){this.type=t,this.input=n,this.beginIndex=c,this.endIndex=p}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=n.parse(t[1],1,Cn),p=n.parse(t[2],2,Ft);if(!c||!p)return null;if(!$r(c.type,[Lr(Cn),yn,Cn]))return n.error(`Expected first argument to be of type array or string, but found ${xr(c.type)} instead`);if(t.length===4){const h=n.parse(t[3],3,Ft);return h?new _h(c.type,c,p,h):null}return new _h(c.type,c,p)}evaluate(t){const n=this.input.evaluate(t),c=this.beginIndex.evaluate(t);if(!Ms(n,["string","array"]))throw new fs(`Expected first argument to be of type array or string, but found ${xr(_a(n))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(t);return n.slice(c,p)}return n.slice(c)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Pd(s,t){return s==="=="||s==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Od(s,t,n,c){return c.compare(t,n)===0}function su(s,t,n){const c=s!=="=="&&s!=="!=";return class gx{constructor(h,g,M){this.type=Si,this.lhs=h,this.rhs=g,this.collator=M,this.hasUntypedArgument=h.type.kind==="value"||g.type.kind==="value"}static parse(h,g){if(h.length!==3&&h.length!==4)return g.error("Expected two or three arguments.");const M=h[0];let C=g.parse(h[1],1,Cn);if(!C)return null;if(!Pd(M,C.type))return g.concat(1).error(`"${M}" comparisons are not supported for type '${xr(C.type)}'.`);let P=g.parse(h[2],2,Cn);if(!P)return null;if(!Pd(M,P.type))return g.concat(2).error(`"${M}" comparisons are not supported for type '${xr(P.type)}'.`);if(C.type.kind!==P.type.kind&&C.type.kind!=="value"&&P.type.kind!=="value")return g.error(`Cannot compare types '${xr(C.type)}' and '${xr(P.type)}'.`);c&&(C.type.kind==="value"&&P.type.kind!=="value"?C=new kl(P.type,[C]):C.type.kind!=="value"&&P.type.kind==="value"&&(P=new kl(C.type,[P])));let b=null;if(h.length===4){if(C.type.kind!=="string"&&P.type.kind!=="string"&&C.type.kind!=="value"&&P.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(b=g.parse(h[3],3,Ar),!b)return null}return new gx(C,P,b)}evaluate(h){const g=this.lhs.evaluate(h),M=this.rhs.evaluate(h);if(c&&this.hasUntypedArgument){const C=_a(g),P=_a(M);if(C.kind!==P.kind||C.kind!=="string"&&C.kind!=="number")throw new fs(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${C.kind}, ${P.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const C=_a(g),P=_a(M);if(C.kind!=="string"||P.kind!=="string")return t(h,g,M)}return this.collator?n(h,g,M,this.collator.evaluate(h)):t(h,g,M)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[s];return this.eachChild(g=>{h.push(g.serialize())}),h}}}const Fp=su("==",function(s,t,n){return t===n},Od),gp=su("!=",function(s,t,n){return t!==n},function(s,t,n,c){return!Od(0,t,n,c)}),kp=su("<",function(s,t,n){return t<n},function(s,t,n,c){return c.compare(t,n)<0}),$f=su(">",function(s,t,n){return t>n},function(s,t,n,c){return c.compare(t,n)>0}),Np=su("<=",function(s,t,n){return t<=n},function(s,t,n,c){return c.compare(t,n)<=0}),yf=su(">=",function(s,t,n){return t>=n},function(s,t,n,c){return c.compare(t,n)>=0});class Kf{constructor(t,n,c,p,h,g){this.type=yn,this.number=t,this.locale=n,this.currency=c,this.unit=p,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const c=n.parse(t[1],1,Ft);if(!c)return null;const p=t[2];if(typeof p!="object"||Array.isArray(p))return n.error("NumberFormat options argument must be an object.");let h=null;if(p.locale&&(h=n.parseObjectValue(p.locale,2,"locale",yn),!h))return null;let g=null;if(p.currency&&(g=n.parseObjectValue(p.currency,2,"currency",yn),!g))return null;let M=null;if(p.unit&&(M=n.parseObjectValue(p.unit,2,"unit",yn),!M))return null;let C=null;if(p["min-fraction-digits"]&&(C=n.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",Ft),!C))return null;let P=null;return p["max-fraction-digits"]&&(P=n.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",Ft),!P)?null:new Kf(c,h,g,M,C,P)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class yh{constructor(t){this.type=Ft,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=n.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${xr(c.type)} instead.`):new yh(c):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string"||Array.isArray(n))return n.length;throw new fs(`Expected value to be of type string or array, but found ${xr(_a(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(n=>{t.push(n.serialize())}),t}}function vh(s){return function(){s=1831565813+(s|=0)|0;let t=Math.imul(s^s>>>15,1|s);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const Nu={"==":Fp,"!=":gp,">":$f,"<":kp,">=":yf,"<=":Np,array:kl,at:xc,boolean:kl,case:Yf,coalesce:pa,collator:Rd,format:fl,image:Lu,in:_f,"index-of":au,interpolate:ls,"interpolate-hcl":ls,"interpolate-lab":ls,length:yh,let:Ll,literal:or,match:Xf,number:kl,"number-format":Kf,object:kl,slice:_h,step:nc,string:kl,"to-boolean":Nl,"to-color":Nl,"to-number":Nl,"to-string":Nl,var:ic,within:br,distance:Vl,config:Ou};function Qh(s,[t,n,c,p]){t=t.evaluate(s),n=n.evaluate(s),c=c.evaluate(s);const h=p?p.evaluate(s):1,g=al(t,n,c,h);if(g)throw new fs(g);return new we(t/255*h,n/255*h,c/255*h,h)}function vf(s,[t,n,c,p]){t=t.evaluate(s),n=n.evaluate(s),c=c.evaluate(s);const h=p?p.evaluate(s):1,g=function(P,b,L,D){return typeof P=="number"&&P>=0&&P<=360?typeof b=="number"&&b>=0&&b<=100&&typeof L=="number"&&L>=0&&L<=100?D===void 0||typeof D=="number"&&D>=0&&D<=1?null:`Invalid hsla value [${[P,b,L,D].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof D=="number"?[P,b,L,D]:[P,b,L]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof D=="number"?[P,b,L,D]:[P,b,L]).join(", ")}]: 'h' must be between 0 and 360.`}(t,n,c,h);if(g)throw new fs(g);const M=`hsla(${t}, ${n}%, ${c}%, ${h})`,C=we.parse(M);if(!C)throw new fs(`Failed to parse HSLA color: ${M}`);return C}function _p(s,t){return s in t}function Jf(s,t){const n=t[s];return n===void 0?null:n}function Hl(s){return{type:s}}function Qf(s){return{result:"success",value:s}}function Xo(s){return{result:"error",value:s}}function ed(s,t){return!!s&&!!s.parameters&&s.parameters.indexOf(t)>-1}function Bd(s){return s["property-type"]==="data-driven"}function ep(s){return ed(s.expression,"measure-light")}function Fd(s){return ed(s.expression,"zoom")}function ml(s){return!!s.expression&&s.expression.interpolated}function bc(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function xh(s){return s}function tp(s,t){const n=t.type==="color",c=s.stops&&typeof s.stops[0][0]=="object",p=c||!(c||s.property!==void 0),h=s.type||(ml(t)?"exponential":"interval");if(n&&((s=sn({},s)).stops&&(s.stops=s.stops.map(P=>[P[0],we.parse(P[1])])),s.default=we.parse(s.default?s.default:t.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!gf[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let g,M,C;if(h==="exponential")g=kd;else if(h==="interval")g=Bo;else if(h==="categorical"){g=Uu,M=Object.create(null);for(const P of s.stops)M[P[0]]=P[1];C=typeof s.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);g=yp}if(c){const P={},b=[];for(let A=0;A<s.stops.length;A++){const R=s.stops[A],B=R[0].zoom;P[B]===void 0&&(P[B]={zoom:B,type:s.type,property:s.property,default:s.default,stops:[]},b.push(B)),P[B].stops.push([R[0].value,R[1]])}const L=[];for(const A of b)L.push([P[A].zoom,tp(P[A],t)]);const D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:ls.interpolationFactor.bind(void 0,D),zoomStops:L.map(A=>A[0]),evaluate:({zoom:A},R)=>kd({stops:L,base:s.base},t,A).evaluate(A,R)}}if(p){const P=h==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:ls.interpolationFactor.bind(void 0,P),zoomStops:s.stops.map(b=>b[0]),evaluate:({zoom:b})=>g(s,t,b,M,C)}}return{kind:"source",evaluate(P,b){const L=b&&b.properties?b.properties[s.property]:void 0;return L===void 0?ac(s.default,t.default):g(s,t,L,M,C)}}}function ac(s,t,n){return s!==void 0?s:t!==void 0?t:n!==void 0?n:void 0}function Uu(s,t,n,c,p){return ac(typeof n===p?c[n]:void 0,s.default,t.default)}function Bo(s,t,n){if(co(n)!=="number")return ac(s.default,t.default);const c=s.stops.length;if(c===1||n<=s.stops[0][0])return s.stops[0][1];if(n>=s.stops[c-1][0])return s.stops[c-1][1];const p=Xh(s.stops.map(h=>h[0]),n);return s.stops[p][1]}function kd(s,t,n){const c=s.base!==void 0?s.base:1;if(co(n)!=="number")return ac(s.default,t.default);const p=s.stops.length;if(p===1||n<=s.stops[0][0])return s.stops[0][1];if(n>=s.stops[p-1][0])return s.stops[p-1][1];const h=Xh(s.stops.map(b=>b[0]),n),g=function(b,L,D,A){const R=A-D,B=b-D;return R===0?0:L===1?B/R:(Math.pow(L,B)-1)/(Math.pow(L,R)-1)}(n,c,s.stops[h][0],s.stops[h+1][0]),M=s.stops[h][1],C=s.stops[h+1][1];let P=Ei[t.type]||xh;if(s.colorSpace&&s.colorSpace!=="rgb"){const b=gf[s.colorSpace];P=(L,D)=>b.reverse(b.interpolate(b.forward(L),b.forward(D),g))}return typeof M.evaluate=="function"?{evaluate(...b){const L=M.evaluate.apply(void 0,b),D=C.evaluate.apply(void 0,b);if(L!==void 0&&D!==void 0)return P(L,D,g)}}:P(M,C,g)}function yp(s,t,n){return t.type==="color"?n=we.parse(n):t.type==="formatted"?n=ds.fromString(n.toString()):t.type==="resolvedImage"?n=Ts.build(n.toString()):co(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0),ac(n,s.default,t.default)}ps.register(Nu,{error:[{kind:"error"},[yn],(s,[t])=>{throw new fs(t.evaluate(s))}],typeof:[yn,[Cn],(s,[t])=>xr(_a(t.evaluate(s)))],"to-rgba":[Lr(Ft,4),[qn],(s,[t])=>t.evaluate(s).toRenderColor(null).toArray()],"to-hsla":[Lr(Ft,4),[qn],(s,[t])=>t.evaluate(s).toRenderColor(null).toHslaArray()],rgb:[qn,[Ft,Ft,Ft],Qh],rgba:[qn,[Ft,Ft,Ft,Ft],Qh],hsl:[qn,[Ft,Ft,Ft],vf],hsla:[qn,[Ft,Ft,Ft,Ft],vf],has:{type:Si,overloads:[[[yn],(s,[t])=>_p(t.evaluate(s),s.properties())],[[yn,rn],(s,[t,n])=>_p(t.evaluate(s),n.evaluate(s))]]},get:{type:Cn,overloads:[[[yn],(s,[t])=>Jf(t.evaluate(s),s.properties())],[[yn,rn],(s,[t,n])=>Jf(t.evaluate(s),n.evaluate(s))]]},"feature-state":[Cn,[yn],(s,[t])=>Jf(t.evaluate(s),s.featureState||{})],properties:[rn,[],s=>s.properties()],"geometry-type":[yn,[],s=>s.geometryType()],id:[Cn,[],s=>s.id()],zoom:[Ft,[],s=>s.globals.zoom],pitch:[Ft,[],s=>s.globals.pitch||0],"distance-from-center":[Ft,[],s=>s.distanceFromCenter()],"measure-light":[Ft,[yn],(s,[t])=>s.measureLight(t.evaluate(s))],"heatmap-density":[Ft,[],s=>s.globals.heatmapDensity||0],"line-progress":[Ft,[],s=>s.globals.lineProgress||0],"raster-value":[Ft,[],s=>s.globals.rasterValue||0],"raster-particle-speed":[Ft,[],s=>s.globals.rasterParticleSpeed||0],"sky-radial-progress":[Ft,[],s=>s.globals.skyRadialProgress||0],accumulated:[Cn,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[Ft,Hl(Ft),(s,t)=>{let n=0;for(const c of t)n+=c.evaluate(s);return n}],"*":[Ft,Hl(Ft),(s,t)=>{let n=1;for(const c of t)n*=c.evaluate(s);return n}],"-":{type:Ft,overloads:[[[Ft,Ft],(s,[t,n])=>t.evaluate(s)-n.evaluate(s)],[[Ft],(s,[t])=>-t.evaluate(s)]]},"/":[Ft,[Ft,Ft],(s,[t,n])=>t.evaluate(s)/n.evaluate(s)],"%":[Ft,[Ft,Ft],(s,[t,n])=>t.evaluate(s)%n.evaluate(s)],ln2:[Ft,[],()=>Math.LN2],pi:[Ft,[],()=>Math.PI],e:[Ft,[],()=>Math.E],"^":[Ft,[Ft,Ft],(s,[t,n])=>Math.pow(t.evaluate(s),n.evaluate(s))],sqrt:[Ft,[Ft],(s,[t])=>Math.sqrt(t.evaluate(s))],log10:[Ft,[Ft],(s,[t])=>Math.log(t.evaluate(s))/Math.LN10],ln:[Ft,[Ft],(s,[t])=>Math.log(t.evaluate(s))],log2:[Ft,[Ft],(s,[t])=>Math.log(t.evaluate(s))/Math.LN2],sin:[Ft,[Ft],(s,[t])=>Math.sin(t.evaluate(s))],cos:[Ft,[Ft],(s,[t])=>Math.cos(t.evaluate(s))],tan:[Ft,[Ft],(s,[t])=>Math.tan(t.evaluate(s))],asin:[Ft,[Ft],(s,[t])=>Math.asin(t.evaluate(s))],acos:[Ft,[Ft],(s,[t])=>Math.acos(t.evaluate(s))],atan:[Ft,[Ft],(s,[t])=>Math.atan(t.evaluate(s))],min:[Ft,Hl(Ft),(s,t)=>Math.min(...t.map(n=>n.evaluate(s)))],max:[Ft,Hl(Ft),(s,t)=>Math.max(...t.map(n=>n.evaluate(s)))],abs:[Ft,[Ft],(s,[t])=>Math.abs(t.evaluate(s))],round:[Ft,[Ft],(s,[t])=>{const n=t.evaluate(s);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ft,[Ft],(s,[t])=>Math.floor(t.evaluate(s))],ceil:[Ft,[Ft],(s,[t])=>Math.ceil(t.evaluate(s))],"filter-==":[Si,[yn,Cn],(s,[t,n])=>s.properties()[t.value]===n.value],"filter-id-==":[Si,[Cn],(s,[t])=>s.id()===t.value],"filter-type-==":[Si,[yn],(s,[t])=>s.geometryType()===t.value],"filter-<":[Si,[yn,Cn],(s,[t,n])=>{const c=s.properties()[t.value],p=n.value;return typeof c==typeof p&&c<p}],"filter-id-<":[Si,[Cn],(s,[t])=>{const n=s.id(),c=t.value;return typeof n==typeof c&&n<c}],"filter->":[Si,[yn,Cn],(s,[t,n])=>{const c=s.properties()[t.value],p=n.value;return typeof c==typeof p&&c>p}],"filter-id->":[Si,[Cn],(s,[t])=>{const n=s.id(),c=t.value;return typeof n==typeof c&&n>c}],"filter-<=":[Si,[yn,Cn],(s,[t,n])=>{const c=s.properties()[t.value],p=n.value;return typeof c==typeof p&&c<=p}],"filter-id-<=":[Si,[Cn],(s,[t])=>{const n=s.id(),c=t.value;return typeof n==typeof c&&n<=c}],"filter->=":[Si,[yn,Cn],(s,[t,n])=>{const c=s.properties()[t.value],p=n.value;return typeof c==typeof p&&c>=p}],"filter-id->=":[Si,[Cn],(s,[t])=>{const n=s.id(),c=t.value;return typeof n==typeof c&&n>=c}],"filter-has":[Si,[Cn],(s,[t])=>t.value in s.properties()],"filter-has-id":[Si,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Si,[Lr(yn)],(s,[t])=>t.value.indexOf(s.geometryType())>=0],"filter-id-in":[Si,[Lr(Cn)],(s,[t])=>t.value.indexOf(s.id())>=0],"filter-in-small":[Si,[yn,Lr(Cn)],(s,[t,n])=>n.value.indexOf(s.properties()[t.value])>=0],"filter-in-large":[Si,[yn,Lr(Cn)],(s,[t,n])=>function(c,p,h,g){for(;h<=g;){const M=h+g>>1;if(p[M]===c)return!0;p[M]>c?g=M-1:h=M+1}return!1}(s.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Si,overloads:[[[Si,Si],(s,[t,n])=>t.evaluate(s)&&n.evaluate(s)],[Hl(Si),(s,t)=>{for(const n of t)if(!n.evaluate(s))return!1;return!0}]]},any:{type:Si,overloads:[[[Si,Si],(s,[t,n])=>t.evaluate(s)||n.evaluate(s)],[Hl(Si),(s,t)=>{for(const n of t)if(n.evaluate(s))return!0;return!1}]]},"!":[Si,[Si],(s,[t])=>!t.evaluate(s)],"is-supported-script":[Si,[yn],(s,[t])=>{const n=s.globals&&s.globals.isSupportedScript;return!n||n(t.evaluate(s))}],upcase:[yn,[yn],(s,[t])=>t.evaluate(s).toUpperCase()],downcase:[yn,[yn],(s,[t])=>t.evaluate(s).toLowerCase()],concat:[yn,Hl(Cn),(s,t)=>t.map(n=>Wo(n.evaluate(s))).join("")],"resolved-locale":[yn,[Ar],(s,[t])=>t.evaluate(s).resolvedLocale()],random:[Ft,[Ft,Ft,Cn],(s,t)=>{const[n,c,p]=t.map(g=>g.evaluate(s));if(n>c||n===c)return n;let h;if(typeof p=="string")h=function(g){let M=0;if(g.length===0)return M;for(let C=0;C<g.length;C++)M=(M<<5)-M+g.charCodeAt(C),M|=0;return M}(p);else{if(typeof p!="number")throw new fs(`Invalid seed input: ${p}`);h=p}return n+vh(h)()*(c-n)}]});class Nd{constructor(t,n,c,p){this.expression=t,this._warningHistory={},this._evaluator=new Uh(c,p),this._defaultValue=n?function(h){return h.type==="color"&&(bc(h.default)||Array.isArray(h.default))?new we(0,0,0,0):h.type==="color"?we.parse(h.default)||null:h.default===void 0?null:h.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this.configDependencies=pl(t)}evaluateWithoutErrorHandling(t,n,c,p,h,g,M,C){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=c,this._evaluator.canonical=p||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=M||null,this._evaluator.featureDistanceData=C||null,this.expression.evaluate(this._evaluator)}evaluate(t,n,c,p,h,g,M,C){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=c||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=M||null,this._evaluator.featureDistanceData=C||null;try{const P=this.expression.evaluate(this._evaluator);if(P==null||typeof P=="number"&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new fs(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${P.message}`)),this._defaultValue}}}function td(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Nu}function Ws(s,t,n,c){const p=new ru(Nu,[],t?function(g){const M={color:qn,string:yn,number:Ft,enum:yn,boolean:Si,formatted:Ir,resolvedImage:Gr};return g.type==="array"?Lr(M[g.value]||Cn,g.length):M[g.type]}(t):void 0,void 0,void 0,n,c),h=p.parse(s,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Qf(new Nd(h,t,n,c)):Xo(p.errors)}class sc{constructor(t,n,c,p){this.kind=t,this._styleExpression=n,this.isLightConstant=c,this.isLineProgressConstant=p,this.isStateDependent=t!=="constant"&&!Dd(n.expression),this.configDependencies=pl(n.expression)}evaluateWithoutErrorHandling(t,n,c,p,h,g){return this._styleExpression.evaluateWithoutErrorHandling(t,n,c,p,h,g)}evaluate(t,n,c,p,h,g){return this._styleExpression.evaluate(t,n,c,p,h,g)}}class ou{constructor(t,n,c,p,h,g){this.kind=t,this.zoomStops=c,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!Dd(n.expression),this.isLightConstant=h,this.isLineProgressConstant=g,this.configDependencies=pl(n.expression),this.interpolationType=p}evaluateWithoutErrorHandling(t,n,c,p,h,g){return this._styleExpression.evaluateWithoutErrorHandling(t,n,c,p,h,g)}evaluate(t,n,c,p,h,g){return this._styleExpression.evaluate(t,n,c,p,h,g)}interpolationFactor(t,n,c){return this.interpolationType?ls.interpolationFactor(this.interpolationType,t,n,c):0}}function Ud(s,t,n,c){if((s=Ws(s,t,n,c)).result==="error")return s;const p=s.value.expression,h=Zh(p);if(!h&&!Bd(t))return Xo([new Di("","data expressions not supported")]);const g=po(p,["zoom","pitch","distance-from-center"]);if(!g&&!Fd(t))return Xo([new Di("","zoom expressions not supported")]);const M=po(p,["measure-light"]);if(!M&&!ep(t))return Xo([new Di("","measure-light expression not supported")]);const C=po(p,["line-progress"]);if(!C&&!function(L){return ed(L.expression,"line-progress")}(t))return Xo([new Di("","line-progress expression not supported")]);const P=t.expression&&t.expression.relaxZoomRestriction,b=Vc(p);return b||g||P?b instanceof Di?Xo([b]):b instanceof ls&&!ml(t)?Xo([new Di("",'"interpolate" expressions cannot be used with this property')]):Qf(b?new ou(h&&C?"camera":"composite",s.value,b.labels,b instanceof ls?b.interpolation:void 0,M,C):new sc(h&&C?"constant":"source",s.value,M,C)):Xo([new Di("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class bh{constructor(t,n){this._parameters=t,this._specification=n,sn(this,tp(this._parameters,this._specification))}static deserialize(t){return new bh(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Vc(s){let t=null;if(s instanceof Ll)t=Vc(s.result);else if(s instanceof pa){for(const n of s.args)if(t=Vc(n),t)break}else(s instanceof nc||s instanceof ls)&&s.input instanceof ps&&s.input.name==="zoom"&&(t=s);return t instanceof Di||s.eachChild(n=>{const c=Vc(n);c instanceof Di?t=c:t&&c&&t!==c&&(t=new Di("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var oc,Up,Vp=function(){if(Up)return oc;Up=1,oc=t;var s=3;function t(n,c,p){var h=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var g=new Int32Array(this.arrayBuffer);n=g[0],this.d=(c=g[1])+2*(p=g[2]);for(var M=0;M<this.d*this.d;M++){var C=g[s+M],P=g[s+M+1];h.push(C===P?null:g.subarray(C,P))}var b=g[s+h.length+1];this.keys=g.subarray(g[s+h.length],b),this.bboxes=g.subarray(b),this.insert=this._insertReadonly}else{this.d=c+2*p;for(var L=0;L<this.d*this.d;L++)h.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=n,this.padding=p,this.scale=c/n,this.uid=0;var D=p/c*n;this.min=-D,this.max=n+D}return t.prototype.insert=function(n,c,p,h,g){this._forEachCell(c,p,h,g,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(h),this.bboxes.push(g)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(n,c,p,h,g,M){this.cells[g].push(M)},t.prototype.query=function(n,c,p,h,g){var M=this.min,C=this.max;if(n<=M&&c<=M&&C<=p&&C<=h&&!g)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(n,c,p,h,this._queryCell,P,{},g),P},t.prototype._queryCell=function(n,c,p,h,g,M,C,P){var b=this.cells[g];if(b!==null)for(var L=this.keys,D=this.bboxes,A=0;A<b.length;A++){var R=b[A];if(C[R]===void 0){var B=4*R;(P?P(D[B+0],D[B+1],D[B+2],D[B+3]):n<=D[B+2]&&c<=D[B+3]&&p>=D[B+0]&&h>=D[B+1])?(C[R]=!0,M.push(L[R])):C[R]=!1}}},t.prototype._forEachCell=function(n,c,p,h,g,M,C,P){for(var b=this._convertToCellCoord(n),L=this._convertToCellCoord(c),D=this._convertToCellCoord(p),A=this._convertToCellCoord(h),R=b;R<=D;R++)for(var B=L;B<=A;B++){var q=this.d*B+R;if((!P||P(this._convertFromCellCoord(R),this._convertFromCellCoord(B),this._convertFromCellCoord(R+1),this._convertFromCellCoord(B+1)))&&g.call(this,n,c,p,h,q,M,C,P))return}},t.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},t.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,c=s+this.cells.length+1+1,p=0,h=0;h<this.cells.length;h++)p+=this.cells[h].length;var g=new Int32Array(c+p+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var M=c,C=0;C<n.length;C++){var P=n[C];g[s+C]=M,g.set(P,M),M+=P.length}return g[s+n.length]=M,g.set(this.keys,M),g[s+n.length+1]=M+=this.keys.length,g.set(this.bboxes,M),M+=this.bboxes.length,g.buffer},oc}(),Gc=Ge(Vp);const Vd={};function kn(s,t,n={}){Object.defineProperty(s,"_classRegistryKey",{value:t,writable:!1}),Vd[t]={klass:s,omit:n.omit||[]}}kn(Object,"Object"),Gc.serialize=function(s,t){const n=s.toArrayBuffer();return t&&t.add(n),{buffer:n}},Gc.deserialize=function(s){return new Gc(s.buffer)},Object.defineProperty(Gc,"name",{value:"Grid"}),kn(Gc,"Grid"),typeof DOMMatrix<"u"&&kn(DOMMatrix,"DOMMatrix"),kn(we,"Color"),kn(Error,"Error"),kn(ds,"Formatted"),kn(Qs,"FormattedSection"),kn(tr,"AJAXError"),kn(Ts,"ResolvedImage"),kn(bh,"StylePropertyFunction"),kn(Nd,"StyleExpression",{omit:["_evaluator"]}),kn(Fs,"ImageIdWithOptions"),kn(ou,"ZoomDependentExpression"),kn(sc,"ZoomConstantExpression"),kn(ps,"CompoundExpression",{omit:["_evaluate"]});for(const s in Nu)Vd[Nu[s]._classRegistryKey]||kn(Nu[s],`Expression${s}`);function xf(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function wh(s){return self.ImageBitmap&&s instanceof ImageBitmap}function Vu(s,t){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(xf(s)||wh(s))return t&&t.add(s),s;if(ArrayBuffer.isView(s))return t&&t.add(s.buffer),s;if(s instanceof ImageData)return t&&t.add(s.data.buffer),s;if(Array.isArray(s)){const n=[];for(const c of s)n.push(Vu(c,t));return n}if(s instanceof Map){const n={$name:"Map"};for(const[c,p]of s.entries())n[c]=Vu(p);return n}if(s instanceof Set){const n={$name:"Set"};let c=0;for(const p of s.values())n[++c]=Vu(p);return n}if(typeof s=="object"){const n=s.constructor,c=n._classRegistryKey;if(!c)throw new Error(`Can't serialize object of unregistered class "${c}".`);const p=n.serialize?n.serialize(s,t):{};if(!n.serialize){for(const h in s)s.hasOwnProperty(h)&&(Vd[c].omit.indexOf(h)>=0||(p[h]=Vu(s[h],t)));s instanceof Error&&(p.message=s.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(p.$name=c),p}throw new Error("can't serialize object of type "+typeof s)}function jl(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||xf(s)||wh(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(jl);if(typeof s=="object"){const t=s.$name||"Object";if(t==="Map"){const p=new Map;for(const h of Object.keys(s))h!=="$name"&&p.set(h,jl(s[h]));return p}if(t==="Set"){const p=new Set;for(const h of Object.keys(s))h!=="$name"&&p.add(jl(s[h]));return p}const{klass:n}=Vd[t];if(!n)throw new Error(`Can't deserialize unregistered class "${t}".`);if(n.deserialize)return n.deserialize(s);const c=Object.create(n.prototype);for(const p of Object.keys(s))p!=="$name"&&(c[p]=jl(s[p]));return c}throw new Error("can't deserialize object of type "+typeof s)}const un={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519,Osage:s=>s>=66736&&s<=66815,"CJK Unified Ideographs Extension B":s=>s>=131072&&s<=173791};function ys(s){for(const t of s)if(lu(t.charCodeAt(0)))return!0;return!1}function Mo(s){for(const t of s)if(!bf(t.charCodeAt(0)))return!1;return!0}function bf(s){return!(un.Arabic(s)||un["Arabic Supplement"](s)||un["Arabic Extended-A"](s)||un["Arabic Presentation Forms-A"](s)||un["Arabic Presentation Forms-B"](s))}function lu(s){return!(s!==746&&s!==747&&(s<4352||!(un["Bopomofo Extended"](s)||un.Bopomofo(s)||un["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||un["CJK Compatibility Ideographs"](s)||un["CJK Compatibility"](s)||un["CJK Radicals Supplement"](s)||un["CJK Strokes"](s)||!(!un["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||un["CJK Unified Ideographs Extension A"](s)||un["CJK Unified Ideographs"](s)||un["Enclosed CJK Letters and Months"](s)||un["Hangul Compatibility Jamo"](s)||un["Hangul Jamo Extended-A"](s)||un["Hangul Jamo Extended-B"](s)||un["Hangul Jamo"](s)||un["Hangul Syllables"](s)||un.Hiragana(s)||un["Ideographic Description Characters"](s)||un.Kanbun(s)||un["Kangxi Radicals"](s)||un["Katakana Phonetic Extensions"](s)||un.Katakana(s)&&s!==12540||!(!un["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!un["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||un["Unified Canadian Aboriginal Syllabics"](s)||un["Unified Canadian Aboriginal Syllabics Extended"](s)||un["Vertical Forms"](s)||un["Yijing Hexagram Symbols"](s)||un["Yi Syllables"](s)||un["Yi Radicals"](s))))}function Gu(s){return!(lu(s)||function(t){return!!(un["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||un["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||un["Letterlike Symbols"](t)||un["Number Forms"](t)||un["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||un["Control Pictures"](t)&&t!==9251||un["Optical Character Recognition"](t)||un["Enclosed Alphanumerics"](t)||un["Geometric Shapes"](t)||un["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||un["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||un["CJK Symbols and Punctuation"](t)||un.Katakana(t)||un["Private Use Area"](t)||un["CJK Compatibility Forms"](t)||un["Small Form Variants"](t)||un["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(s))}function Gd(s){return s>=1424&&s<=2303||un["Arabic Presentation Forms-A"](s)||un["Arabic Presentation Forms-B"](s)}function Hd(s,t){return!(!t&&Gd(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||un.Khmer(s))}function Mh(s){for(const t of s)if(Gd(t.charCodeAt(0)))return!0;return!1}const jd="deferred",Hs="loading",wf="loaded";let wc=null,Rl="unavailable",Hu=null;const vp=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(Rl="error"),wc&&wc(s)};function qd(){Th.fire(new Fe("pluginStateChange",{pluginStatus:Rl,pluginURL:Hu}))}const Th=new wi,ju=function(){return Rl},mo=function(){if(Rl!==jd||!Hu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Rl=Hs,qd(),Hu&&Da({url:Hu},s=>{s?vp(s):(Rl=wf,qd())})},us={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Rl===wf||us.applyArabicShaping!=null,isLoading:()=>Rl===Hs,setState(s){Rl=s.pluginStatus,Hu=s.pluginURL},isParsed:()=>us.applyArabicShaping!=null&&us.processBidirectionalText!=null&&us.processStyledBidirectionalText!=null,getPluginURL:()=>Hu};class Ka{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(n,c){for(const p of n)if(!Hd(p.charCodeAt(0),c))return!1;return!0}(t,us.isLoaded())}}class Sh{constructor(t,n,c,p){this.property=t,this.value=n,this.expression=function(h,g,M,C){if(bc(h))return new bh(h,g);if(td(h)||Array.isArray(h)&&h.length>0){const P=Ud(h,g,M,C);if(P.result==="error")throw new Error(P.value.map(b=>`${b.key}: ${b.message}`).join(", "));return P.value}{let P=h;return typeof h=="string"&&g.type==="color"&&(P=we.parse(h)),{kind:"constant",configDependencies:new Set,evaluate:()=>P}}}(n===void 0?t.specification.default:n,t.specification,c,p)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,c){return this.property.possiblyEvaluate(this,t,n,c)}}class qu{constructor(t,n,c){this.property=t,this.value=new Sh(t,void 0,n,c)}transitioned(t,n){return new ol(this.property,this.value,n,cr({},t.transition,this.transition),t.now)}untransitioned(){return new ol(this.property,this.value,null,{},0)}}class Eh{constructor(t,n,c){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=n,this._options=c,this.configDependencies=new Set}getValue(t){return $a(this._values[t].value.value)}setValue(t,n){this._values.hasOwnProperty(t)||(this._values[t]=new qu(this._values[t].property,this._scope,this._options)),this._values[t].value=new Sh(this._values[t].property,n===null?void 0:$a(n),this._scope,this._options),this._values[t].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].value.expression.configDependencies]))}setTransitionOrValue(t,n){n&&(this._options=n);const c=this._properties.properties;if(t)for(const p in t){const h=t[p];if(Ma(p,"-transition")){const g=p.slice(0,-11);c[g]&&this.setTransition(g,h)}else c.hasOwnProperty(p)&&this.setValue(p,h)}}getTransition(t){return $a(this._values[t].transition)}setTransition(t,n){this._values.hasOwnProperty(t)||(this._values[t]=new qu(this._values[t].property)),this._values[t].transition=$a(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const c=this.getValue(n);c!==void 0&&(t[n]=c);const p=this.getTransition(n);p!==void 0&&(t[`${n}-transition`]=p)}return t}transitioned(t,n){const c=new Ah(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].transitioned(t,n._values[p]);return c}untransitioned(){const t=new Ah(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class ol{constructor(t,n,c,p,h){const g=p.delay||0,M=p.duration||0;h=h||0,this.property=t,this.value=n,this.begin=h+g,this.end=this.begin+M,t.specification.transition&&(p.delay||p.duration)&&(this.prior=c)}possiblyEvaluate(t,n,c){const p=t.now||0,h=this.value.possiblyEvaluate(t,n,c),g=this.prior;if(g){if(p>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(p<this.begin)return g.possiblyEvaluate(t,n,c);{const M=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,n,c),h,Ut(M))}}return h}}class Ah{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,c){const p=new id(this._properties);for(const h of Object.keys(this._values))p._values[h]=this._values[h].possiblyEvaluate(t,n,c);return p}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class cu{constructor(t,n,c){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=n,this._options=c,this.configDependencies=new Set}getValue(t){return $a(this._values[t].value)}setValue(t,n){this._values[t]=new Sh(this._values[t].property,n===null?void 0:$a(n),this._scope,this._options),this._values[t].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].expression.configDependencies]))}serialize(){const t={};for(const n of Object.keys(this._values)){const c=this.getValue(n);c!==void 0&&(t[n]=c)}return t}possiblyEvaluate(t,n,c){const p=new id(this._properties);for(const h of Object.keys(this._values))p._values[h]=this._values[h].possiblyEvaluate(t,n,c);return p}}class Ch{constructor(t,n,c){this.property=t,this.value=n,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,c,p){return this.property.evaluate(this.value,this.parameters,t,n,c,p)}}class id{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ri{constructor(t){this.specification=t}possiblyEvaluate(t,n){return t.expression.evaluate(n)}interpolate(t,n,c){const p=Ei[this.specification.type];return p?p(t,n,c):t}}class Pn{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,c,p){return new Ch(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},c,p)}:t.expression,n)}interpolate(t,n,c){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new Ch(this,{kind:"constant",value:void 0},t.parameters);const p=Ei[this.specification.type];return p?new Ch(this,{kind:"constant",value:p(t.value.value,n.value.value,c)},t.parameters):t}evaluate(t,n,c,p,h,g){return t.kind==="constant"?t.value:t.evaluate(n,c,p,h,g)}}class Hc{constructor(t){this.specification=t}possiblyEvaluate(t,n,c,p){return!!t.expression.evaluate(n,null,{},c,p)}interpolate(){return!1}}class ss{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new Ka(0,{});for(const c in t){const p=t[c];p.specification.overridable&&this.overridableProperties.push(c);const h=this.defaultPropertyValues[c]=new Sh(p,void 0),g=this.defaultTransitionablePropertyValues[c]=new qu(p);this.defaultTransitioningPropertyValues[c]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=h.possiblyEvaluate(n)}}}kn(Pn,"DataDrivenProperty"),kn(Ri,"DataConstantProperty"),kn(Hc,"ColorRampProperty");var Ht=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function uu(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function js(s){if(Array.isArray(s))return s.map(js);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const t={};for(const n in s)t[n]=js(s[n]);return t}return uu(s)}function hu(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const t of s.slice(1))if(!hu(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function Wd(s,t="",n=null,c="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};hu(s)||(s=Zd(s));const p=s;let h=!0;try{h=function(b){if(!lc(b))return b;let L=js(b);return nd(L),L=Lh(L),L}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}let g=null,M=null;if(c!=="background"&&c!=="sky"&&c!=="slot"){M=Ht[`filter_${c}`];const b=Ws(h,M,t,n);if(b.result==="error")throw new Error(b.value.map(L=>`${L.key}: ${L.message}`).join(", "));g=(L,D,A)=>b.value.evaluate(L,D,{},A)}let C=null,P=null;if(h!==p){const b=Ws(p,M,t,n);if(b.result==="error")throw new Error(b.value.map(L=>`${L.key}: ${L.message}`).join(", "));C=(L,D,A,R,B)=>b.value.evaluate(L,D,{},A,void 0,void 0,R,B),P=!Zh(b.value.expression)}return{filter:g,dynamicFilter:C||void 0,needGeometry:sd(h),needFeature:!!P}}function Lh(s){if(!Array.isArray(s))return s;const t=function(n){if(rd.has(n[0])){for(let c=1;c<n.length;c++)if(lc(n[c]))return!0}return n}(s);return t===!0?t:t.map(n=>Lh(n))}function nd(s){let t=!1;const n=[];if(s[0]==="case"){for(let c=1;c<s.length-1;c+=2)t=t||lc(s[c]),n.push(s[c+1]);n.push(s[s.length-1])}else if(s[0]==="match"){t=t||lc(s[1]);for(let c=2;c<s.length-1;c+=2)n.push(s[c+1]);n.push(s[s.length-1])}else if(s[0]==="step"){t=t||lc(s[1]);for(let c=1;c<s.length-1;c+=2)n.push(s[c+1])}t&&(s.length=0,s.push("any",...n));for(let c=1;c<s.length;c++)nd(s[c])}function lc(s){if(!Array.isArray(s))return!1;if((t=s[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let n=1;n<s.length;n++)if(lc(s[n]))return!0;return!1}const rd=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ad(s,t){return s<t?-1:s>t?1:0}function sd(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let t=1;t<s.length;t++)if(sd(s[t]))return!0;return!1}function Zd(s){if(!s)return!0;const t=s[0];return s.length<=1?t!=="any":t==="=="?Mc(s[1],s[2],"=="):t==="!="?cc(Mc(s[1],s[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Mc(s[1],s[2],t):t==="any"?(n=s.slice(1),["any"].concat(n.map(Zd))):t==="all"?["all"].concat(s.slice(1).map(Zd)):t==="none"?["all"].concat(s.slice(1).map(Zd).map(cc)):t==="in"?od(s[1],s.slice(2)):t==="!in"?cc(od(s[1],s.slice(2))):t==="has"?ld(s[1]):t!=="!has"||cc(ld(s[1]));var n}function Mc(s,t,n){switch(s){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,s,t]}}function od(s,t){if(t.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",s,["literal",t.sort(ad)]]:["filter-in-small",s,["literal",t]]}}function ld(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function cc(s){return["!",s]}const cd="";function ql(s,t){return t?`${s}${cd}${t}`:s}const Il="-transition",Xd=new Set(["fill","line","background","hillshade","raster"]);class qs extends wi{constructor(t,n,c,p,h){if(super(),this.id=t.id,this.fqid=ql(this.id,c),this.type=t.type,this.scope=c,this.lut=p,this.options=h,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,t.type!=="custom"){if(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type&&t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"){this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter;const g=Ws(this.filter,Ht[`filter_${t.type}`]);g.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...g.value.configDependencies]))}if(t.slot&&(this.slot=t.slot),n.layout&&(this._unevaluatedLayout=new cu(n.layout,this.scope,h),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),n.paint){this._transitionablePaint=new Eh(n.paint,this.scope,h);for(const g in t.paint)this.setPaintProperty(g,t.paint[g]);for(const g in t.layout)this.setLayoutProperty(g,t.layout[g]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new id(n.paint)}}}onAdd(t){}onRemove(t){}isDraped(t){return!this.is3D()&&Xd.has(this.type)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n){if(this.type==="custom"&&t==="visibility")return void(this.visibility=n);const c=this._unevaluatedLayout;c._properties.properties[t]&&(c.setValue(t,n),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),t==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(t){return Ma(t,Il)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n){const c=this._transitionablePaint,p=c._properties.properties;if(Ma(t,Il)){const L=t.slice(0,-11);return p[L]&&c.setTransition(L,n||void 0),!1}if(!p[t])return!1;const h=c._values[t],g=h.value.isDataDriven(),M=h.value;c.setValue(t,n),this.configDependencies=new Set([...this.configDependencies,...c.configDependencies]),this._handleSpecialPaintPropertyUpdate(t);const C=c._values[t].value,P=C.isDataDriven(),b=Ma(t,"pattern")||t==="line-dasharray";return P||g||b||this._handleOverridablePaintPropertyUpdate(t,M,C)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,n,c){return null}_handleOverridablePaintPropertyUpdate(t,n,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){return oo({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,n)=>!(t===void 0||n==="layout"&&!Object.keys(t).length||n==="paint"&&!Object.keys(t).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof Ch&&Bd(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(t){this._filterCompiled||(this._featureFilter=Wd(this.filter,this.scope,t),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&(t.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(t){}queryIntersectsFeature(t,n,c,p,h,g,M,C,P){}}const xp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ud{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ts{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ta(s,t=1){let n=0,c=0;return{members:s.map(p=>{const h=xp[p.type].BYTES_PER_ELEMENT,g=n=Mf(n,Math.max(t,h)),M=p.components||1;return c=Math.max(c,h),n+=h*M,{name:p.name,type:p.type,components:M,offset:g}}),size:Mf(n,Math.max(c,t)),alignment:t}}function Mf(s,t){return Math.ceil(s/t)*t}class du extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const c=this.length;return this.resize(c+1),this.emplace(c,t,n)}emplace(t,n,c){const p=2*t;return this.int16[p+0]=n,this.int16[p+1]=c,t}}du.prototype.bytesPerElement=4,kn(du,"StructArrayLayout2i4");class Rh extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,n,c)}emplace(t,n,c,p){const h=3*t;return this.int16[h+0]=n,this.int16[h+1]=c,this.int16[h+2]=p,t}}Rh.prototype.bytesPerElement=6,kn(Rh,"StructArrayLayout3i6");class Wl extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,p){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,c,p)}emplace(t,n,c,p,h){const g=4*t;return this.int16[g+0]=n,this.int16[g+1]=c,this.int16[g+2]=p,this.int16[g+3]=h,t}}Wl.prototype.bytesPerElement=8,kn(Wl,"StructArrayLayout4i8");class Ih extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,p,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,c,p,h)}emplace(t,n,c,p,h,g){const M=5*t;return this.int16[M+0]=n,this.int16[M+1]=c,this.int16[M+2]=p,this.int16[M+3]=h,this.int16[M+4]=g,t}}Ih.prototype.bytesPerElement=10,kn(Ih,"StructArrayLayout5i10");class Tc extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,p,h,g,M){const C=this.length;return this.resize(C+1),this.emplace(C,t,n,c,p,h,g,M)}emplace(t,n,c,p,h,g,M,C){const P=6*t,b=12*t,L=3*t;return this.int16[P+0]=n,this.int16[P+1]=c,this.uint8[b+4]=p,this.uint8[b+5]=h,this.uint8[b+6]=g,this.uint8[b+7]=M,this.float32[L+2]=C,t}}Tc.prototype.bytesPerElement=12,kn(Tc,"StructArrayLayout2i4ub1f12");class jc extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,n,c)}emplace(t,n,c,p){const h=3*t;return this.float32[h+0]=n,this.float32[h+1]=c,this.float32[h+2]=p,t}}jc.prototype.bytesPerElement=12,kn(jc,"StructArrayLayout3f12");class Fo extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,p,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,c,p,h)}emplace(t,n,c,p,h,g){const M=6*t,C=3*t;return this.uint16[M+0]=n,this.uint16[M+1]=c,this.uint16[M+2]=p,this.uint16[M+3]=h,this.float32[C+2]=g,t}}Fo.prototype.bytesPerElement=12,kn(Fo,"StructArrayLayout4ui1f12");class Dh extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c,p){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,c,p)}emplace(t,n,c,p,h){const g=4*t;return this.uint16[g+0]=n,this.uint16[g+1]=c,this.uint16[g+2]=p,this.uint16[g+3]=h,t}}Dh.prototype.bytesPerElement=8,kn(Dh,"StructArrayLayout4ui8");class Sc extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,p,h,g){const M=this.length;return this.resize(M+1),this.emplace(M,t,n,c,p,h,g)}emplace(t,n,c,p,h,g,M){const C=6*t;return this.int16[C+0]=n,this.int16[C+1]=c,this.int16[C+2]=p,this.int16[C+3]=h,this.int16[C+4]=g,this.int16[C+5]=M,t}}Sc.prototype.bytesPerElement=12,kn(Sc,"StructArrayLayout6i12");class Yd extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c,p,h,g,M,C,P,b,L,D){const A=this.length;return this.resize(A+1),this.emplace(A,t,n,c,p,h,g,M,C,P,b,L,D)}emplace(t,n,c,p,h,g,M,C,P,b,L,D,A){const R=12*t;return this.int16[R+0]=n,this.int16[R+1]=c,this.int16[R+2]=p,this.int16[R+3]=h,this.uint16[R+4]=g,this.uint16[R+5]=M,this.uint16[R+6]=C,this.uint16[R+7]=P,this.int16[R+8]=b,this.int16[R+9]=L,this.int16[R+10]=D,this.int16[R+11]=A,t}}Yd.prototype.bytesPerElement=24,kn(Yd,"StructArrayLayout4i4ui4i24");class Tf extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,p,h,g){const M=this.length;return this.resize(M+1),this.emplace(M,t,n,c,p,h,g)}emplace(t,n,c,p,h,g,M){const C=10*t,P=5*t;return this.int16[C+0]=n,this.int16[C+1]=c,this.int16[C+2]=p,this.float32[P+2]=h,this.float32[P+3]=g,this.float32[P+4]=M,t}}Tf.prototype.bytesPerElement=20,kn(Tf,"StructArrayLayout3i3f20");class qc extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,p){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,c,p)}emplace(t,n,c,p,h){const g=4*t;return this.float32[g+0]=n,this.float32[g+1]=c,this.float32[g+2]=p,this.float32[g+3]=h,t}}qc.prototype.bytesPerElement=16,kn(qc,"StructArrayLayout4f16");class hd extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}hd.prototype.bytesPerElement=4,kn(hd,"StructArrayLayout1ul4");class fu extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const c=this.length;return this.resize(c+1),this.emplace(c,t,n)}emplace(t,n,c){const p=2*t;return this.uint16[p+0]=n,this.uint16[p+1]=c,t}}fu.prototype.bytesPerElement=4,kn(fu,"StructArrayLayout2ui4");class go extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c,p,h,g,M,C,P,b,L,D,A){const R=this.length;return this.resize(R+1),this.emplace(R,t,n,c,p,h,g,M,C,P,b,L,D,A)}emplace(t,n,c,p,h,g,M,C,P,b,L,D,A,R){const B=20*t,q=10*t;return this.int16[B+0]=n,this.int16[B+1]=c,this.int16[B+2]=p,this.int16[B+3]=h,this.int16[B+4]=g,this.float32[q+3]=M,this.float32[q+4]=C,this.float32[q+5]=P,this.float32[q+6]=b,this.int16[B+14]=L,this.uint32[q+8]=D,this.uint16[B+18]=A,this.uint16[B+19]=R,t}}go.prototype.bytesPerElement=40,kn(go,"StructArrayLayout5i4f1i1ul2ui40");class Wu extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,p,h,g,M){const C=this.length;return this.resize(C+1),this.emplace(C,t,n,c,p,h,g,M)}emplace(t,n,c,p,h,g,M,C){const P=8*t;return this.int16[P+0]=n,this.int16[P+1]=c,this.int16[P+2]=p,this.int16[P+4]=h,this.int16[P+5]=g,this.int16[P+6]=M,this.int16[P+7]=C,t}}Wu.prototype.bytesPerElement=16,kn(Wu,"StructArrayLayout3i2i2i16");class $d extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,p,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,c,p,h)}emplace(t,n,c,p,h,g){const M=4*t,C=8*t;return this.float32[M+0]=n,this.float32[M+1]=c,this.float32[M+2]=p,this.int16[C+6]=h,this.int16[C+7]=g,t}}$d.prototype.bytesPerElement=16,kn($d,"StructArrayLayout2f1f2i16");class dd extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,p,h,g){const M=this.length;return this.resize(M+1),this.emplace(M,t,n,c,p,h,g)}emplace(t,n,c,p,h,g,M){const C=20*t,P=5*t;return this.uint8[C+0]=n,this.uint8[C+1]=c,this.float32[P+1]=p,this.float32[P+2]=h,this.float32[P+3]=g,this.float32[P+4]=M,t}}dd.prototype.bytesPerElement=20,kn(dd,"StructArrayLayout2ub4f20");class uo extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,n,c)}emplace(t,n,c,p){const h=3*t;return this.uint16[h+0]=n,this.uint16[h+1]=c,this.uint16[h+2]=p,t}}uo.prototype.bytesPerElement=6,kn(uo,"StructArrayLayout3ui6");class fd extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,n,c,p,h,g,M,C,P,b,L,D,A,R,B,q,W,ee,te,Y,re){const ce=this.length;return this.resize(ce+1),this.emplace(ce,t,n,c,p,h,g,M,C,P,b,L,D,A,R,B,q,W,ee,te,Y,re)}emplace(t,n,c,p,h,g,M,C,P,b,L,D,A,R,B,q,W,ee,te,Y,re,ce){const ve=30*t,Be=15*t,Oe=60*t;return this.int16[ve+0]=n,this.int16[ve+1]=c,this.int16[ve+2]=p,this.float32[Be+2]=h,this.float32[Be+3]=g,this.uint16[ve+8]=M,this.uint16[ve+9]=C,this.uint32[Be+5]=P,this.uint32[Be+6]=b,this.uint32[Be+7]=L,this.uint16[ve+16]=D,this.uint16[ve+17]=A,this.uint16[ve+18]=R,this.float32[Be+10]=B,this.float32[Be+11]=q,this.uint8[Oe+48]=W,this.uint8[Oe+49]=ee,this.uint8[Oe+50]=te,this.uint32[Be+13]=Y,this.int16[ve+28]=re,this.uint8[Oe+58]=ce,t}}fd.prototype.bytesPerElement=60,kn(fd,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class To extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,n,c,p,h,g,M,C,P,b,L,D,A,R,B,q,W,ee,te,Y,re,ce,ve,Be,Oe,Pe,nt,Ue,lt,_t,dt,xt){const Ct=this.length;return this.resize(Ct+1),this.emplace(Ct,t,n,c,p,h,g,M,C,P,b,L,D,A,R,B,q,W,ee,te,Y,re,ce,ve,Be,Oe,Pe,nt,Ue,lt,_t,dt,xt)}emplace(t,n,c,p,h,g,M,C,P,b,L,D,A,R,B,q,W,ee,te,Y,re,ce,ve,Be,Oe,Pe,nt,Ue,lt,_t,dt,xt,Ct){const Nt=20*t,wt=40*t,gi=80*t;return this.float32[Nt+0]=n,this.float32[Nt+1]=c,this.int16[wt+4]=p,this.int16[wt+5]=h,this.int16[wt+6]=g,this.int16[wt+7]=M,this.int16[wt+8]=C,this.int16[wt+9]=P,this.int16[wt+10]=b,this.int16[wt+11]=L,this.int16[wt+12]=D,this.uint16[wt+13]=A,this.uint16[wt+14]=R,this.uint16[wt+15]=B,this.uint16[wt+16]=q,this.uint16[wt+17]=W,this.uint16[wt+18]=ee,this.uint16[wt+19]=te,this.uint16[wt+20]=Y,this.uint16[wt+21]=re,this.uint16[wt+22]=ce,this.uint16[wt+23]=ve,this.uint16[wt+24]=Be,this.uint16[wt+25]=Oe,this.uint16[wt+26]=Pe,this.uint16[wt+27]=nt,this.uint32[Nt+14]=Ue,this.float32[Nt+15]=lt,this.float32[Nt+16]=_t,this.float32[Nt+17]=dt,this.float32[Nt+18]=xt,this.uint8[gi+76]=Ct,t}}To.prototype.bytesPerElement=80,kn(To,"StructArrayLayout2f9i15ui1ul4f1ub80");class Ec extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}Ec.prototype.bytesPerElement=4,kn(Ec,"StructArrayLayout1f4");class gl extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,p,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,c,p,h)}emplace(t,n,c,p,h,g){const M=5*t;return this.float32[M+0]=n,this.float32[M+1]=c,this.float32[M+2]=p,this.float32[M+3]=h,this.float32[M+4]=g,t}}gl.prototype.bytesPerElement=20,kn(gl,"StructArrayLayout5f20");class to extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,p,h,g,M){const C=this.length;return this.resize(C+1),this.emplace(C,t,n,c,p,h,g,M)}emplace(t,n,c,p,h,g,M,C){const P=7*t;return this.float32[P+0]=n,this.float32[P+1]=c,this.float32[P+2]=p,this.float32[P+3]=h,this.float32[P+4]=g,this.float32[P+5]=M,this.float32[P+6]=C,t}}to.prototype.bytesPerElement=28,kn(to,"StructArrayLayout7f28");class Zl extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,p,h,g,M,C,P,b,L){const D=this.length;return this.resize(D+1),this.emplace(D,t,n,c,p,h,g,M,C,P,b,L)}emplace(t,n,c,p,h,g,M,C,P,b,L,D){const A=11*t;return this.float32[A+0]=n,this.float32[A+1]=c,this.float32[A+2]=p,this.float32[A+3]=h,this.float32[A+4]=g,this.float32[A+5]=M,this.float32[A+6]=C,this.float32[A+7]=P,this.float32[A+8]=b,this.float32[A+9]=L,this.float32[A+10]=D,t}}Zl.prototype.bytesPerElement=44,kn(Zl,"StructArrayLayout11f44");class Ac extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,p,h,g,M,C,P){const b=this.length;return this.resize(b+1),this.emplace(b,t,n,c,p,h,g,M,C,P)}emplace(t,n,c,p,h,g,M,C,P,b){const L=9*t;return this.float32[L+0]=n,this.float32[L+1]=c,this.float32[L+2]=p,this.float32[L+3]=h,this.float32[L+4]=g,this.float32[L+5]=M,this.float32[L+6]=C,this.float32[L+7]=P,this.float32[L+8]=b,t}}Ac.prototype.bytesPerElement=36,kn(Ac,"StructArrayLayout9f36");class zh extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const c=this.length;return this.resize(c+1),this.emplace(c,t,n)}emplace(t,n,c){const p=2*t;return this.float32[p+0]=n,this.float32[p+1]=c,t}}zh.prototype.bytesPerElement=8,kn(zh,"StructArrayLayout2f8");class Kd extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c,p){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,c,p)}emplace(t,n,c,p,h){const g=6*t;return this.uint32[3*t+0]=n,this.uint16[g+2]=c,this.uint16[g+3]=p,this.uint16[g+4]=h,t}}Kd.prototype.bytesPerElement=12,kn(Kd,"StructArrayLayout1ul3ui12");class Cc extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}Cc.prototype.bytesPerElement=2,kn(Cc,"StructArrayLayout1ui2");class Wc extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,p,h,g,M,C,P,b,L,D,A,R,B,q){const W=this.length;return this.resize(W+1),this.emplace(W,t,n,c,p,h,g,M,C,P,b,L,D,A,R,B,q)}emplace(t,n,c,p,h,g,M,C,P,b,L,D,A,R,B,q,W){const ee=16*t;return this.float32[ee+0]=n,this.float32[ee+1]=c,this.float32[ee+2]=p,this.float32[ee+3]=h,this.float32[ee+4]=g,this.float32[ee+5]=M,this.float32[ee+6]=C,this.float32[ee+7]=P,this.float32[ee+8]=b,this.float32[ee+9]=L,this.float32[ee+10]=D,this.float32[ee+11]=A,this.float32[ee+12]=R,this.float32[ee+13]=B,this.float32[ee+14]=q,this.float32[ee+15]=W,t}}Wc.prototype.bytesPerElement=64,kn(Wc,"StructArrayLayout16f64");class pu extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,p,h,g,M){const C=this.length;return this.resize(C+1),this.emplace(C,t,n,c,p,h,g,M)}emplace(t,n,c,p,h,g,M,C){const P=10*t,b=5*t;return this.uint16[P+0]=n,this.uint16[P+1]=c,this.uint16[P+2]=p,this.uint16[P+3]=h,this.float32[b+2]=g,this.float32[b+3]=M,this.float32[b+4]=C,t}}pu.prototype.bytesPerElement=20,kn(pu,"StructArrayLayout4ui3f20");class Sf extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.int16[1*t+0]=n,t}}Sf.prototype.bytesPerElement=2,kn(Sf,"StructArrayLayout1i2");class Jd extends ts{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint8[1*t+0]=n,t}}Jd.prototype.bytesPerElement=1,kn(Jd,"StructArrayLayout1ub1");class pd extends ud{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}pd.prototype.size=40;class Ef extends go{get(t){return new pd(this,t)}}kn(Ef,"CollisionBoxArray");class Ph extends ud{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}Ph.prototype.size=60;class Oh extends fd{get(t){return new Ph(this,t)}}kn(Oh,"PlacedSymbolArray");class mu extends ud{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}mu.prototype.size=80;class md extends To{get(t){return new mu(this,t)}}kn(md,"SymbolInstanceArray");class Lc extends Ec{getoffsetX(t){return this.float32[1*t+0]}}kn(Lc,"GlyphOffsetArray");class Zs extends du{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}kn(Zs,"SymbolLineVertexArray");class Xs extends ud{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Xs.prototype.size=12;class Zu extends Kd{get(t){return new Xs(this,t)}}kn(Zu,"FeatureIndexArray");class ll extends fu{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}kn(ll,"FillExtrusionCentroidArray");class Xu extends ud{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Xu.prototype.size=6;class Af extends Rh{get(t){return new Xu(this,t)}}kn(Af,"FillExtrusionWallArray");const Xl=Ta([{name:"a_pos",components:2,type:"Int16"}],4),Yu=Ta([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class bs{constructor(t=[]){this.segments=t}_prepareSegment(t,n,c,p){let h=this.segments[this.segments.length-1];return t>bs.MAX_VERTEX_ARRAY_LENGTH&&Xn(`Max vertices per segment is ${bs.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!h||h.vertexLength+t>bs.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==p)&&(h={vertexOffset:n,primitiveOffset:c,vertexLength:0,primitiveLength:0},p!==void 0&&(h.sortKey=p),this.segments.push(h)),h}prepareSegment(t,n,c,p){return this._prepareSegment(t,n.length,c.length,p)}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,c,p){return new bs([{vertexOffset:t,primitiveOffset:n,vertexLength:c,primitiveLength:p,vaos:{},sortKey:0}])}}function gd(s,t){return 256*(s=ii(Math.floor(s),0,255))+ii(Math.floor(t),0,255)}bs.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,kn(bs,"SegmentVector");const Cf=Ta([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Qd=Ta([{name:"a_dash",components:4,type:"Uint16"}]);class $u{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,n,c,p){this.ids.push(ef(t)),this.positions.push(n,c,p)}eachPosition(t,n){const c=ef(t);let p=0,h=this.ids.length-1;for(;p<h;){const g=p+h>>1;this.ids[g]>=c?h=g:p=g+1}for(;this.ids[p]===c;)n(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(t,n){const c=new Float64Array(t.ids),p=new Uint32Array(t.positions);return Ku(c,p,0,c.length-1),n&&(n.add(c.buffer),n.add(p.buffer)),{ids:c,positions:p}}static deserialize(t){const n=new $u;let c;n.ids=t.ids,n.positions=t.positions;for(const p of n.ids)p!==c&&n.uniqueIds.push(p),c=p;return n.indexed=!0,n}}function ef(s){const t=+s;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:be(String(s))}function Ku(s,t,n,c){for(;n<c;){const p=s[n+c>>1];let h=n-1,g=c+1;for(;;){do h++;while(s[h]<p);do g--;while(s[g]>p);if(h>=g)break;tf(s,h,g),tf(t,3*h,3*g),tf(t,3*h+1,3*g+1),tf(t,3*h+2,3*g+2)}g-n<c-g?(Ku(s,t,n,g),n=g+1):(Ku(s,t,g+1,c),c=g)}}function tf(s,t,n){const c=s[t];s[t]=s[n],s[n]=c}kn($u,"FeaturePositionMap");class _l{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,n),this.initialized=!0),!!this.location}set(t,n,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Zc extends _l{constructor(t){super(t),this.current=0}set(t,n,c){this.fetchUniformLocation(t,n)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class ws extends _l{constructor(t){super(t),this.current=0}set(t,n,c){this.fetchUniformLocation(t,n)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Dl extends _l{constructor(t){super(t),this.current=[0,0]}set(t,n,c){this.fetchUniformLocation(t,n)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class Rc extends _l{constructor(t){super(t),this.current=[0,0,0]}set(t,n,c){this.fetchUniformLocation(t,n)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class _d extends _l{constructor(t){super(t),this.current=[0,0,0,0]}set(t,n,c){this.fetchUniformLocation(t,n)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class uc extends _l{constructor(t){super(t),this.current=we.transparent.toRenderColor(null)}set(t,n,c){this.fetchUniformLocation(t,n)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const nf=new Float32Array(16);class Bh extends _l{constructor(t){super(t),this.current=nf}set(t,n,c){if(this.fetchUniformLocation(t,n)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let p=1;p<16;p++)if(c[p]!==this.current[p]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}const rf=new Float32Array(9),bp=new Float32Array(4);class gu extends _l{constructor(t){super(t),this.current=bp}set(t,n,c){if(this.fetchUniformLocation(t,n)){for(let p=0;p<4;p++)if(c[p]!==this.current[p]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}}function Yo(s){return[gd(255*s.r,255*s.g),gd(255*s.b,255*s.a)]}class $o{constructor(t,n,c,p){this.value=t,this.uniformNames=n.map(h=>`u_${h}`),this.type=c,this.context=p}setUniform(t,n,c,p,h){const g=p.constantOr(this.value);n.set(t,h,g instanceof we?g.toRenderColor(this.ignoreLut?null:this.context.lut):g)}getBinding(t,n){return this.type==="color"?new uc(t):new ws(t)}}class zl{constructor(t,n){this.uniformNames=n.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,n,c,p,h){const g=h==="u_pattern"||h==="u_dash"?this.pattern:h==="u_pixel_ratio"?this.pixelRatio:null;g&&n.set(t,h,g)}getBinding(t,n){return n==="u_pattern"||n==="u_dash"?new _d(t):new ws(t)}}class Xc{constructor(t,n,c,p){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=n.map(h=>({name:`a_${h}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(t,n,c,p,h,g,M){const C=this.paintVertexArray.length,P=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Ka(0,{brightness:g}),n,{},h,p,M):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new Ka(0,{brightness:g}),n,{},h,p,M)==="none"),this.paintVertexArray.resize(t),this._setPaintValue(C,t,P,this.context)}updatePaintArray(t,n,c,p,h,g,M){const C=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:M},c,p,void 0,h):this.expression.kind==="constant"&&this.expression.value;!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:0,brightness:M},c,p,void 0,h)==="none"),this._setPaintValue(t,n,C,this.context)}_setPaintValue(t,n,c,p){if(this.type==="color"){const h=Yo(c.toRenderColor(this.ignoreLut?null:p.lut));for(let g=t;g<n;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=t;h<n;h++)this.paintVertexArray.emplace(h,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class hc{constructor(t,n,c,p,h,g){this.expression=t,this.uniformNames=n.map(M=>`u_${M}_t`),this.type=c,this.useIntegerZoom=p,this.context=h,this.maxValue=0,this.paintVertexAttributes=n.map(M=>({name:`a_${M}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,n,c,p,h,g,M){const C=this.expression.evaluate(new Ka(this.context.zoom,{brightness:g}),n,{},h,p,M),P=this.expression.evaluate(new Ka(this.context.zoom+1,{brightness:g}),n,{},h,p,M);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate(new Ka(this.context.zoom,{brightness:g}),n,{},h,p,M)==="none");const b=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(b,t,C,P,this.context)}updatePaintArray(t,n,c,p,h,g,M){const C=this.expression.evaluate({zoom:this.context.zoom,brightness:M},c,p,void 0,h),P=this.expression.evaluate({zoom:this.context.zoom+1,brightness:M},c,p,void 0,h);!this.lutExpression||this.lutExpression.kind!=="composite"&&this.lutExpression.kind!=="source"||(this.ignoreLut=this.lutExpression.evaluate({zoom:this.context.zoom,brightness:M},c,p,void 0,h)==="none"),this._setPaintValue(t,n,C,P,this.context)}_setPaintValue(t,n,c,p,h){if(this.type==="color"){const g=Yo(c.toRenderColor(this.ignoreLut?null:h.lut)),M=Yo(c.toRenderColor(this.ignoreLut?null:h.lut));for(let C=t;C<n;C++)this.paintVertexArray.emplace(C,g[0],g[1],M[0],M[1])}else{for(let g=t;g<n;g++)this.paintVertexArray.emplace(g,c,p);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(p))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n,c,p,h){const g=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,M=ii(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);n.set(t,h,M)}getBinding(t,n){return new ws(t)}}class Ic{constructor(t,n,c,p,h){this.expression=t,this.layerId=h,this.paintVertexAttributes=(c==="array"?Qd:Cf).members;for(let g=0;g<n.length;++g);this.paintVertexArray=new p}populatePaintArray(t,n,c,p){const h=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(h,t,n.patterns&&n.patterns[this.layerId],c)}updatePaintArray(t,n,c,p,h,g,M){this._setPaintValues(t,n,c.patterns&&c.patterns[this.layerId],g)}_setPaintValues(t,n,c,p){if(!p||!c)return;const h=p[c];if(!h)return;const{tl:g,br:M,pixelRatio:C}=h;for(let P=t;P<n;P++)this.paintVertexArray.emplace(P,g[0],g[1],M[0],M[1],C)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class _u{constructor(t,n,c=()=>!0){this.binders={},this._buffers=[],this.context=n;const p=[];for(const h in t.paint._values){const g=t.paint.get(h),M=t.paint.get(`${h}-use-theme`);if(h.endsWith("-use-theme")||!c(h)||!(g instanceof Ch&&Bd(g.property.specification)))continue;const C=af(h,t.type),P=g.value,b=g.property.specification.type,L=!!g.property.useIntegerZoom,D=h==="line-dasharray"||h.endsWith("pattern"),A=h==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant"||M&&M.value.kind!=="constant";if(P.kind!=="constant"||A)if(P.kind==="source"||A||D){const R=ip(h,b,"source");this.binders[h]=D?new Ic(P,C,b,R,t.id):new Xc(P,C,b,R),p.push(`/a_${h}`)}else{const R=ip(h,b,"composite");this.binders[h]=new hc(P,C,b,L,n,R),p.push(`/z_${h}`)}else this.binders[h]=D?new zl(P.value,C):new $o(P.value,C,b,n),p.push(`/u_${h}`);M&&(this.binders[h].ignoreLut=M.constantOr("default")==="none",this.binders[h].lutExpression=M.value,this.binders[h].checkUseTheme=!0)}this.cacheKey=p.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof Xc||n instanceof hc?n.maxValue:0}populatePaintArrays(t,n,c,p,h,g,M){for(const C in this.binders){const P=this.binders[C];P.context=this.context,P instanceof Xc||P instanceof hc||P instanceof Ic?P.populatePaintArray(t,n,c,p,h,g,M):P.lutExpression&&P instanceof $o&&P.lutExpression&&(P.lutExpression.kind==="composite"||P.lutExpression.kind==="source")&&(P.ignoreLut=P.lutExpression.evaluate(new Ka(0,{brightness:g}),n,{},h,p,M)==="none")}}setConstantPatternPositions(t){for(const n in this.binders){const c=this.binders[n];c instanceof zl&&c.setConstantPatternPositions(t)}}updatePaintArrays(t,n,c,p,h,g,M,C,P){let b=!1;const L=Object.keys(t),D=L.length!==0&&!C,A=D?L:n.uniqueIds;this.context.lut=h.lut;for(const R in this.binders){const B=this.binders[R];if(B.context=this.context,(B instanceof Xc||B instanceof hc||B instanceof Ic)&&B.expression&&B.expression.kind&&B.expression.kind!=="constant"&&(B.expression.isStateDependent===!0||B.expression.isLightConstant===!1)){const q=h.paint.get(R);B.expression=q.value;for(const W of A){const ee=t[W.toString()];n.eachPosition(W,(te,Y,re)=>{const ce=p.feature(te);B.updatePaintArray(Y,re,ce,ee,g,M,P)})}if(!D)for(const W of c.uniqueIds){const ee=t[W.toString()];c.eachPosition(W,(te,Y,re)=>{const ce=p.feature(te);B.updatePaintArray(Y,re,ce,ee,g,M,P)})}b=!0}}return b}defines(){const t=[];for(const n in this.binders){const c=this.binders[n];(c instanceof $o||c instanceof zl)&&t.push(...c.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const c=this.binders[n];if(c instanceof Xc||c instanceof hc||c instanceof Ic)for(let p=0;p<c.paintVertexAttributes.length;p++)t.push(c.paintVertexAttributes[p].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const c=this.binders[n];if(c instanceof $o||c instanceof zl||c instanceof hc)for(const p of c.uniformNames)t.push(p)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const n=[];for(const c in this.binders){const p=this.binders[c];if(p instanceof $o||p instanceof zl||p instanceof hc)for(const h of p.uniformNames)n.push({name:h,property:c,binding:p.getBinding(t,h)})}return n}setUniforms(t,n,c,p,h){for(const{name:g,property:M,binding:C}of c){if(this.binders[M].checkUseTheme&&this.binders[M]instanceof $o){const P=p.get(`${M}-use-theme`);P.isConstant()&&(this.binders[M].ignoreLut=P.constantOr("default")==="none")}this.binders[M].setUniform(t,C,h,p.get(M),g)}}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const n=this.binders[t];(n instanceof Xc||n instanceof hc||n instanceof Ic)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(t){for(const n in this.binders){const c=this.binders[n];(c instanceof Xc||c instanceof hc||c instanceof Ic)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof Xc||n instanceof hc||n instanceof Ic)&&n.destroy()}}}class Yl{constructor(t,n,c=()=>!0){this.programConfigurations={};for(const p of t)this.programConfigurations[p.id]=new _u(p,n,c);this.needsUpload=!1,this._featureMap=new $u,this._featureMapWithoutIds=new $u,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,n,c,p,h,g,M,C){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(t,n,p,h,g,M,C);n.id!==void 0?this._featureMap.add(n.id,c,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,c,p,h,g,M){for(const C of c)this.needsUpload=this.programConfigurations[C.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,n,C,p,h,g,M||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const yl={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function af(s,t){return yl[s]||[s.replace(`${t}-`,"").replace(/-/g,"_")]}const Gp={"line-pattern":{source:Fo,composite:Fo},"fill-pattern":{source:Fo,composite:Fo},"fill-extrusion-pattern":{source:Fo,composite:Fo},"line-dasharray":{source:Dh,composite:Dh}},vl={color:{source:zh,composite:qc},number:{source:Ec,composite:zh}};function ip(s,t,n){const c=Gp[s];return c&&c[n]||vl[t][n]}kn($o,"ConstantBinder"),kn(zl,"PatternConstantBinder"),kn(Xc,"SourceExpressionBinder"),kn(Ic,"PatternCompositeBinder"),kn(hc,"CompositeExpressionBinder"),kn(_u,"ProgramConfiguration",{omit:["_buffers"]}),kn(Yl,"ProgramConfigurationSet");const Na=vn/Math.PI/2,xl=5,yu=6,Ju=16383,Yc=64,vu=[Yc,32,16],Ko=-Na,Jo=Na;function $c(s,t,n,c=Na){return n=ft(n),[s*Math.sin(n)*c,-t*c,s*Math.cos(n)*c]}function xu(s,t,n){return $c(Math.cos(ft(s)),Math.sin(ft(s)),t,n)}const So=63710088e-1,Kc=2*Math.PI*So;class xa{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new xa(wn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,c=this.lat*n,p=t.lat*n,h=Math.sin(c)*Math.sin(p)+Math.cos(c)*Math.cos(p)*Math.cos((t.lng-this.lng)*n);return So*Math.acos(Math.min(h,1))}toBounds(t=0){const n=360*t/40075017,c=n/Math.cos(Math.PI/180*this.lat);return new ko({lng:this.lng-c,lat:this.lat-n},{lng:this.lng+c,lat:this.lat+n})}toEcef(t){return xu(this.lat,this.lng,Na+t*Na/So)}static convert(t){if(t instanceof xa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new xa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new xa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ko{constructor(t,n){if(t)if(n)this.setSouthWest(t).setNorthEast(n);else if(t.length===4){const c=t;this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]])}else{const c=t;this.setSouthWest(c[0]).setNorthEast(c[1])}}setNorthEast(t){return this._ne=t instanceof xa?new xa(t.lng,t.lat):xa.convert(t),this}setSouthWest(t){return this._sw=t instanceof xa?new xa(t.lng,t.lat):xa.convert(t),this}extend(t){const n=this._sw,c=this._ne;let p,h;if(t instanceof xa)p=t,h=t;else{if(!(t instanceof ko))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(ko.convert(t)):this.extend(xa.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(xa.convert(t)):this;if(p=t._sw,h=t._ne,!p||!h)return this}return n||c?(n.lng=Math.min(p.lng,n.lng),n.lat=Math.min(p.lat,n.lat),c.lng=Math.max(h.lng,c.lng),c.lat=Math.max(h.lat,c.lat)):(this._sw=new xa(p.lng,p.lat),this._ne=new xa(h.lng,h.lat)),this}getCenter(){return new xa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new xa(this.getWest(),this.getNorth())}getSouthEast(){return new xa(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:c}=xa.convert(t);let p=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&p}static convert(t){if(t)return t instanceof ko?t:new ko(t)}}const yd=0,Qo=25.5;function bu(s){return Kc*Math.cos(s*Math.PI/180)}function cl(s){return(180+s)/360}function Pl(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function io(s,t){return s/bu(t)}function ho(s){return 360*s-180}function Is(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Ol(s,t){return s*bu(Is(t))}const Va=85.051129;function wu(s){return Math.cos(ft(ii(s,-85.051129,Va)))}function Dc(s,t){const n=ii(t,yd,Qo),c=Math.pow(2,n);return wu(s)*Kc/(512*c)}function d(s){return 1/Math.cos(s*Math.PI/180)}function i(s,t=0){const n=Math.exp(Math.PI*(1-(s.y+t/vn)/(1<<s.z)*2));return 80150034*n/(n*n+1)/vn/(1<<s.z)}class a{constructor(t,n,c=0){this.x=+t,this.y=+n,this.z=+c}static fromLngLat(t,n=0){const c=xa.convert(t);return new a(cl(c.lng),Pl(c.lat),io(n,c.lat))}toLngLat(){return new xa(ho(this.x),Is(this.y))}toAltitude(){return Ol(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Kc*d(Is(this.y))}}function f(s,t,n,c,p,h,g,M,C){const P=(t+c)/2,b=(n+p)/2,L=new Pi(P,b);M(L),function(D,A,R,B,q,W){const ee=R-q,te=B-W;return Math.abs((B-A)*ee-(R-D)*te)/Math.hypot(ee,te)}(L.x,L.y,h.x,h.y,g.x,g.y)>=C?(f(s,t,n,P,b,h,L,M,C),f(s,P,b,c,p,L,g,M,C)):s.push(g)}function v(s,t,n){let c=s[0],p=c.x,h=c.y;t(c);const g=[c];for(let M=1;M<s.length;M++){const C=s[M],{x:P,y:b}=C;t(C),f(g,p,h,P,b,c,C,t,n),p=P,h=b,c=C}return g}function x(s,t,n,c){if(c(t,n)){const p=t.add(n)._mult(.5);x(s,t,p,c),x(s,p,n,c)}else s.push(n)}function T(s,t){let n=s[0];const c=[n];for(let p=1;p<s.length;p++){const h=s[p];x(c,n,h,t),n=h}return c}const I=Math.pow(2,14)-1,F=-I-1;function V(s,t){const n=Math.round(s.x*t),c=Math.round(s.y*t);return s.x=ii(n,F,I),s.y=ii(c,F,I),(n<s.x||n>s.x+1||c<s.y||c>s.y+1)&&Xn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function j(s,t,n){const c=s.loadGeometry(),p=s.extent,h=vn/p;if(t&&n&&n.projection.isReprojectedInTileSpace){const g=1<<t.z,{scale:M,x:C,y:P,projection:b}=n,L=D=>{const A=ho((t.x+D.x/p)/g),R=Is((t.y+D.y/p)/g),B=b.project(A,R);D.x=(B.x*M-C)*p,D.y=(B.y*M-P)*p};for(let D=0;D<c.length;D++)if(s.type!==1)c[D]=v(c[D],L,1);else{const A=[];for(const R of c[D])R.x<0||R.x>=p||R.y<0||R.y>=p||(L(R),A.push(R));c[D]=A}}for(const g of c)for(const M of g)V(M,h);return c}function Z(s,t){return{type:s.type,id:s.id,properties:s.properties,geometry:t?j(s):[]}}function X(s,t,n,c,p){s.emplaceBack(2*t+(c+1)/2,2*n+(p+1)/2)}function Q(s,t,n){s.emplaceBack(t.x,t.y,t.z,n[0]*16384,n[1]*16384,n[2]*16384)}class le{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new du,this.indexArray=new uo,this.segments=new bs,this.programConfigurations=new Yl(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}updateFootprints(t,n){}populate(t,n,c,p){const h=this.layers[0],g=[];let M=null;h.type==="circle"&&(M=h.layout.get("circle-sort-key"));for(const{feature:P,id:b,index:L,sourceLayerIndex:D}of t){const A=this.layers[0]._featureFilter.needGeometry,R=Z(P,A);if(!this.layers[0]._featureFilter.filter(new Ka(this.zoom),R,c))continue;const B=M?M.evaluate(R,{},c):void 0,q={id:b,properties:P.properties,type:P.type,sourceLayerIndex:D,index:L,geometry:A?R.geometry:j(P,c,p),patterns:{},sortKey:B};g.push(q)}M&&g.sort((P,b)=>P.sortKey-b.sortKey);let C=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new Sc,C=p.projection);for(const P of g){const{geometry:b,index:L,sourceLayerIndex:D}=P,A=t[L].feature;this.addFeature(P,b,L,n.availableImages,c,C,n.brightness),n.featureIndex.insert(A,b,L,D,this.index)}}update(t,n,c,p,h,g,M){this.programConfigurations.updatePaintArrays(t,n,h,c,p,g,M)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Xl.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Yu.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,n,c,p,h,g,M){for(const C of n)for(const P of C){const b=P.x,L=P.y;if(b<0||b>=vn||L<0||L>=vn)continue;if(g){const R=g.projectTilePoint(b,L,h),B=g.upVector(h,b,L),q=this.globeExtVertexArray;Q(q,R,B),Q(q,R,B),Q(q,R,B),Q(q,R,B)}const D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),A=D.vertexLength;X(this.layoutVertexArray,b,L,-1,-1),X(this.layoutVertexArray,b,L,1,-1),X(this.layoutVertexArray,b,L,1,1),X(this.layoutVertexArray,b,L,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+2,A+3),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},p,h,M)}}function se(s,t){for(let n=0;n<s.length;n++)if(je(t,s[n]))return!0;for(let n=0;n<t.length;n++)if(je(s,t[n]))return!0;return!!ke(s,t)}function me(s,t,n){return!!je(s,t)||!!tt(t,s,n)}function fe(s,t){if(s.length===1)return We(t,s[0]);for(let n=0;n<t.length;n++){const c=t[n];for(let p=0;p<c.length;p++)if(je(s,c[p]))return!0}for(let n=0;n<s.length;n++)if(We(t,s[n]))return!0;for(let n=0;n<t.length;n++)if(ke(s,t[n]))return!0;return!1}function De(s,t,n){if(s.length>1){if(ke(s,t))return!0;for(let c=0;c<t.length;c++)if(tt(t[c],s,n))return!0}for(let c=0;c<s.length;c++)if(tt(s[c],t,n))return!0;return!1}function ke(s,t){if(s.length===0||t.length===0)return!1;for(let n=0;n<s.length-1;n++){const c=s[n],p=s[n+1];for(let h=0;h<t.length-1;h++)if(Ne(c,p,t[h],t[h+1]))return!0}return!1}function Ne(s,t,n,c){return Qa(s,n,c)!==Qa(t,n,c)&&Qa(s,t,n)!==Qa(s,t,c)}function tt(s,t,n){const c=n*n;if(t.length===1)return s.distSqr(t[0])<c;for(let p=1;p<t.length;p++)if(He(s,t[p-1],t[p])<c)return!0;return!1}function He(s,t,n){const c=t.distSqr(n);if(c===0)return s.distSqr(t);const p=((s.x-t.x)*(n.x-t.x)+(s.y-t.y)*(n.y-t.y))/c;return s.distSqr(p<0?t:p>1?n:n.sub(t)._mult(p)._add(t))}function We(s,t){let n,c,p,h=!1;for(let g=0;g<s.length;g++){n=s[g];for(let M=0,C=n.length-1;M<n.length;C=M++)c=n[M],p=n[C],c.y>t.y!=p.y>t.y&&t.x<(p.x-c.x)*(t.y-c.y)/(p.y-c.y)+c.x&&(h=!h)}return h}function je(s,t){let n=!1;for(let c=0,p=s.length-1;c<s.length;p=c++){const h=s[c],g=s[p];h.y>t.y!=g.y>t.y&&t.x<(g.x-h.x)*(t.y-h.y)/(g.y-h.y)+h.x&&(n=!n)}return n}function at(s,t,n,c,p){for(const g of s)if(t<=g.x&&n<=g.y&&c>=g.x&&p>=g.y)return!0;const h=[new Pi(t,n),new Pi(t,p),new Pi(c,p),new Pi(c,n)];if(s.length>2){for(const g of h)if(je(s,g))return!0}for(let g=0;g<s.length-1;g++)if(gt(s[g],s[g+1],h))return!0;return!1}function gt(s,t,n){const c=n[0],p=n[2];if(s.x<c.x&&t.x<c.x||s.x>p.x&&t.x>p.x||s.y<c.y&&t.y<c.y||s.y>p.y&&t.y>p.y)return!1;const h=Qa(s,t,n[0]);return h!==Qa(s,t,n[1])||h!==Qa(s,t,n[2])||h!==Qa(s,t,n[3])}function Jt(s,t,n,c,p,h){let g=t.y-s.y,M=s.x-t.x;if(h=h||0){const C=g*g+M*M;if(C===0)return!0;const P=Math.sqrt(C);g/=P,M/=P}return!((n.x-s.x)*g+(n.y-s.y)*M-h<0||(c.x-s.x)*g+(c.y-s.y)*M-h<0||(p.x-s.x)*g+(p.y-s.y)*M-h<0)}function jt(s,t,n,c,p,h,g){return!(Jt(s,t,c,p,h,g)||Jt(t,n,c,p,h,g)||Jt(n,s,c,p,h,g)||Jt(c,p,s,t,n,g)||Jt(p,h,s,t,n,g)||Jt(h,c,s,t,n,g))}function fi(s,t,n){const c=t.paint.get(s).value;return c.kind==="constant"?c.value:n.programConfigurations.get(t.id).getMaxValue(s)}function ui(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Pt(s,t,n,c,p){if(!t[0]&&!t[1])return s;const h=Pi.convert(t)._mult(p);n==="viewport"&&h._rotate(-c);const g=[];for(let M=0;M<s.length;M++)g.push(s[M].sub(h));return g}function Kt(s,t,n,c){const p=Pi.convert(s)._mult(c);return t==="viewport"&&p._rotate(-n),p}let Ii,Et;kn(le,"CircleBucket",{omit:["layers"]});var hi,si={exports:{}},an=(hi||(hi=1,function(s,t){(function(n){function c(h,g,M){var C=p(256*h,256*(g=Math.pow(2,M)-g-1),M),P=p(256*(h+1),256*(g+1),M);return C[0]+","+C[1]+","+P[0]+","+P[1]}function p(h,g,M){var C=2*Math.PI*6378137/256/Math.pow(2,M);return[h*C-2*Math.PI*6378137/2,g*C-2*Math.PI*6378137/2]}n.getURL=function(h,g,M,C,P,b){return b=b||{},h+"?"+["bbox="+c(M,C,P),"format="+(b.format||"image/png"),"service="+(b.service||"WMS"),"version="+(b.version||"1.1.1"),"request="+(b.request||"GetMap"),"srs="+(b.srs||"EPSG:3857"),"width="+(b.width||256),"height="+(b.height||256),"layers="+g].join("&")},n.getTileBBox=c,n.getMercCoords=p,Object.defineProperty(n,"__esModule",{value:!0})})(t)}(0,si.exports)),si.exports);class zi{constructor(t,n,c){this.z=t,this.x=n,this.y=c,this.key=en(0,t,t,n,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n){const c=an.getTileBBox(this.x,this.y,this.z),p=function(h,g,M){let C,P="";for(let b=h;b>0;b--)C=1<<b-1,P+=(g&C?1:0)+(M&C?2:0);return P}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class yi{constructor(t,n){this.wrap=t,this.canonical=n,this.key=en(t,n.z,n.z,n.x,n.y)}}class Hi{constructor(t,n,c,p,h){this.overscaledZ=t,this.wrap=n,this.canonical=new zi(c,+p,+h),this.key=n===0&&t===c?this.canonical.key:en(n,t,c,p,h)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const n=this.canonical.z-t;return t>this.canonical.z?new Hi(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Hi(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n=!0){if(this.overscaledZ===t&&n)return this.key;if(t>this.canonical.z)return en(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-t;return en(this.wrap*+n,t,t,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new Hi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,c=2*this.canonical.x,p=2*this.canonical.y;return[new Hi(n,this.wrap,n,c,p),new Hi(n,this.wrap,n,c+1,p),new Hi(n,this.wrap,n,c,p+1),new Hi(n,this.wrap,n,c+1,p+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Hi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Hi(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new yi(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function en(s,t,n,c,p){const h=1<<Math.min(n,22);let g=h*(p%h)+c%h;return s&&n<22&&(g+=h*h*((s<0?-2*s-1:2*s)%(1<<2*(22-n)))),16*(32*g+n)+(t-n)}const bn=[s=>{let t=s.canonical.x-1,n=s.wrap;return t<0&&(t=(1<<s.canonical.z)-1,n--),new Hi(s.overscaledZ,n,s.canonical.z,t,s.canonical.y)},s=>{let t=s.canonical.x+1,n=s.wrap;return t===1<<s.canonical.z&&(t=0,n++),new Hi(s.overscaledZ,n,s.canonical.z,t,s.canonical.y)},s=>new Hi(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,(s.canonical.y===0?1<<s.canonical.z:s.canonical.y)-1),s=>new Hi(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y===(1<<s.canonical.z)-1?0:s.canonical.y+1)];kn(zi,"CanonicalTileID"),kn(Hi,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Un=Ta([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:fr}=Un,ur=Ta([{name:"a_pos_3",components:3,type:"Int16"}]);var lr=Ta([{name:"a_pos",type:"Int16",components:2}]);class wr{constructor(t,n){this.pos=t,this.dir=n}intersectsPlane(t,n,c){const p=et.vec3.dot(n,this.dir);if(Math.abs(p)<1e-6)return!1;const h=((t[0]-this.pos[0])*n[0]+(t[1]-this.pos[1])*n[1]+(t[2]-this.pos[2])*n[2])/p;return c[0]=this.pos[0]+this.dir[0]*h,c[1]=this.pos[1]+this.dir[1]*h,c[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(t,n,c){if(et.vec3.equals(this.pos,t)||n===0)return c[0]=c[1]=c[2]=0,!1;const[p,h,g]=this.dir,M=this.pos[0]-t[0],C=this.pos[1]-t[1],P=this.pos[2]-t[2],b=p*p+h*h+g*g,L=2*(M*p+C*h+P*g),D=L*L-4*b*(M*M+C*C+P*P-n*n);if(D<0){const A=Math.max(-L/2,0),R=M+p*A,B=C+h*A,q=P+g*A,W=Math.hypot(R,B,q);return c[0]=R*n/W,c[1]=B*n/W,c[2]=q*n/W,!1}{const A=(-L-Math.sqrt(D))/(2*b);if(A<0){const R=Math.hypot(M,C,P);return c[0]=M*n/R,c[1]=C*n/R,c[2]=P*n/R,!1}return c[0]=M+p*A,c[1]=C+h*A,c[2]=P+g*A,!0}}}class Tr{constructor(t,n,c,p,h){this.TL=t,this.TR=n,this.BR=c,this.BL=p,this.horizon=h}static fromInvProjectionMatrix(t,n,c){const p=[-1,1,1],h=[1,1,1],g=[1,-1,1],M=[-1,-1,1],C=et.vec3.transformMat4(p,p,t),P=et.vec3.transformMat4(h,h,t),b=et.vec3.transformMat4(g,g,t),L=et.vec3.transformMat4(M,M,t);return new Tr(C,P,b,L,n/c)}}function za(s,t,n){let c=1/0,p=-1/0;const h=[];for(const g of s){et.vec3.sub(h,g,t);const M=et.vec3.dot(h,n);c=Math.min(c,M),p=Math.max(p,M)}return[c,p]}function Ss(s,t){let n=!0;for(let c=0;c<s.planes.length;c++){const p=s.planes[c];let h=0;for(let g=0;g<t.length;g++)h+=et.vec3.dot(p,t[g])+p[3]>=0;if(h===0)return 0;h!==t.length&&(n=!1)}return n?2:1}function qa(s,t){for(const n of s.projections){const c=za(t,s.points[0],n.axis);if(n.projection[1]<c[0]||n.projection[0]>c[1])return 0}return 1}function Pr(s,t){let n=0;const c=[0,0,0,0];for(let p=0;p<s.length;p++)c[0]=s[p][0],c[1]=s[p][1],c[2]=s[p][2],c[3]=1,et.vec4.dot(c,t)>=0&&n++;return n}class ba{constructor(t,n){this.points=t||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=In.fromPoints(this.points),this.projections=[],this.frustumEdges=[et.vec3.sub([],this.points[2],this.points[3]),et.vec3.sub([],this.points[0],this.points[3]),et.vec3.sub([],this.points[4],this.points[0]),et.vec3.sub([],this.points[5],this.points[1]),et.vec3.sub([],this.points[6],this.points[2]),et.vec3.sub([],this.points[7],this.points[3])];for(const c of this.frustumEdges){const p=[0,-c[2],c[1]],h=[c[2],0,-c[0]];this.projections.push({axis:p,projection:za(this.points,this.points[0],p)}),this.projections.push({axis:h,projection:za(this.points,this.points[0],h)})}}static fromInvProjectionMatrix(t,n,c,p){const h=Math.pow(2,c),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const b=et.vec4.transformMat4([],P,t),L=1/b[3]/n*h;return et.vec4.mul(b,b,[L,L,p?1/b[3]:L,L])}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const b=et.vec3.sub([],g[P[0]],g[P[1]]),L=et.vec3.sub([],g[P[2]],g[P[1]]),D=et.vec3.normalize([],et.vec3.cross([],b,L)),A=-et.vec3.dot(D,g[P[1]]);return D.concat(A)}),C=[];for(let P=0;P<g.length;P++)C.push([g[P][0],g[P][1],g[P][2]]);return new ba(C,M)}intersectsPrecise(t,n,c){for(let p=0;p<n.length;p++)if(!Pr(t,n[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!Pr(t,this.planes[p]))return 0;for(const p of c)for(const h of this.frustumEdges){const g=et.vec3.cross([],p,h),M=et.vec3.length(g);if(M===0)continue;et.vec3.scale(g,g,1/M);const C=za(this.points,this.points[0],g),P=za(t,this.points[0],g);if(C[0]>P[1]||P[0]>C[1])return 0}return 1}containsPoint(t){for(const n of this.planes){const c=n[3];if(et.vec3.dot([n[0],n[1],n[2]],t)+c<0)return!1}return!0}}class In{static fromPoints(t){const n=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const p of t)et.vec3.min(n,n,p),et.vec3.max(c,c,p);return new In(n,c)}static fromTileIdAndHeight(t,n,c){const p=1<<t.canonical.z,h=t.canonical.x,g=t.canonical.y;return new In([h/p,g/p,n],[(h+1)/p,(g+1)/p,c])}static applyTransform(t,n){const c=t.getCorners();for(let p=0;p<c.length;++p)et.vec3.transformMat4(c[p],c[p],n);return In.fromPoints(c)}static applyTransformFast(t,n){const c=[n[12],n[13],n[14]],p=[...c];for(let h=0;h<3;h++)for(let g=0;g<3;g++){const M=n[4*g+h],C=M*t.min[g],P=M*t.max[g];c[h]+=Math.min(C,P),p[h]+=Math.max(C,P)}return new In(c,p)}static projectAabbCorners(t,n){const c=t.getCorners();for(let p=0;p<c.length;++p)et.vec3.transformMat4(c[p],c[p],n);return c}constructor(t,n){this.min=t,this.max=n,this.center=et.vec3.scale([],et.vec3.add([],this.min,this.max),.5)}quadrant(t){const n=[t%2==0,t<2],c=et.vec3.clone(this.min),p=et.vec3.clone(this.max);for(let h=0;h<n.length;h++)c[h]=n[h]?this.min[h]:this.center[h],p[h]=n[h]?this.center[h]:this.max[h];return p[2]=this.max[2],new In(c,p)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,n=this.max;return[[t[0],t[1],t[2]],[n[0],t[1],t[2]],[n[0],n[1],t[2]],[t[0],n[1],t[2]],[t[0],t[1],n[2]],[n[0],t[1],n[2]],[n[0],n[1],n[2]],[t[0],n[1],n[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?Ss(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?Ss(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,n){return n||this.intersects(t)?qa(t,this.getCorners()):0}intersectsPreciseFlat(t,n){return n||this.intersectsFlat(t)?qa(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let n=0;n<3;++n)if(this.min[n]>t.max[n]||t.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],t.min[n]),this.max[n]=Math.max(this.max[n],t.max[n])}encapsulatePoint(t){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],t[n]),this.max[n]=Math.max(this.max[n],t[n])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}function _r(s){return s*Na/So}kn(In,"Aabb");const pr=[new In([Ko,Ko,Ko],[Jo,Jo,Jo]),new In([Ko,Ko,Ko],[0,0,Jo]),new In([0,Ko,Ko],[Jo,0,Jo]),new In([Ko,0,Ko],[0,Jo,Jo]),new In([0,0,Ko],[Jo,Jo,Jo])];function yr(s,t,n,c=!0){const p=et.vec3.scale([],s._camera.position,s.worldSize),h=[t,n,1,1];et.vec4.transformMat4(h,h,s.pixelMatrixInverse),et.vec4.scale(h,h,1/h[3]);const g=et.vec3.sub([],h,p),M=et.vec3.normalize([],g),C=s.globeMatrix,P=[C[12],C[13],C[14]],b=et.vec3.sub([],P,p),L=et.vec3.length(b),D=et.vec3.normalize([],b),A=s.worldSize/(2*Math.PI),R=et.vec3.dot(D,M),B=Math.asin(A/L);if(B<Math.acos(R)){if(!c)return null;const nt=[],Ue=[];et.vec3.scale(nt,M,L/R),et.vec3.normalize(Ue,et.vec3.sub(Ue,nt,b)),et.vec3.normalize(M,et.vec3.add(M,b,et.vec3.scale(M,Ue,Math.tan(B)*L)))}const q=[];new wr(p,M).closestPointOnSphere(P,A,q);const W=et.vec3.normalize([],gs(C,0)),ee=et.vec3.normalize([],gs(C,1)),te=et.vec3.normalize([],gs(C,2)),Y=et.vec3.dot(W,q),re=et.vec3.dot(ee,q),ce=et.vec3.dot(te,q),ve=ct(Math.asin(-re/A));let Be=ct(Math.atan2(Y,ce));Be=s.center.lng+function(nt,Ue){const lt=(Ue-nt+180)%360-180;return lt<-180?lt+360:lt}(s.center.lng,Be);const Oe=cl(Be),Pe=ii(Pl(ve),0,1);return new a(Oe,Pe)}class Jr{constructor(t,n,c){this.a=et.vec3.sub([],t,c),this.b=et.vec3.sub([],n,c),this.center=c;const p=et.vec3.normalize([],this.a),h=et.vec3.normalize([],this.b);this.angle=Math.acos(et.vec3.dot(p,h))}}function is(s,t){if(s.angle===0)return null;let n;return n=s.a[t]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[t]/s.a[t]/Math.sin(s.angle)-1/Math.tan(s.angle)),n<0||n>1?null:function(c,p,h,g){const M=Math.sin(h);return c*(Math.sin((1-g)*h)/M)+p*(Math.sin(g*h)/M)}(s.a[t],s.b[t],s.angle,ii(n,0,1))+s.center[t]}function ns(s){if(s.z<=1)return pr[s.z+2*s.y+s.x];const t=Pa(da(s));return In.fromPoints(t)}function Es(s,t,n){return et.vec3.scale(s,s,1-n),et.vec3.scaleAndAdd(s,s,t,n)}function el(s,t,n){for(const c of s)et.vec3.transformMat4(c,c,t),et.vec3.scale(c,c,n)}function Ps(s,t,n,c){const p=t/s.worldSize,h=s.globeMatrix;if(n.z<=1){const Oe=ns(n).getCorners();return el(Oe,h,p),In.fromPoints(Oe)}const g=da(n,c),M=Pa(g,Na+_r(s._tileCoverLift));el(M,h,p);const C=Number.MAX_VALUE,P=[-C,-C,-C],b=[C,C,C];if(g.contains(s.center)){for(const nt of M)et.vec3.min(b,b,nt),et.vec3.max(P,P,nt);P[2]=0;const Oe=s.point,Pe=[Oe.x*p,Oe.y*p,0];return et.vec3.min(b,b,Pe),et.vec3.max(P,P,Pe),new In(b,P)}if(s._tileCoverLift>0){for(const Oe of M)et.vec3.min(b,b,Oe),et.vec3.max(P,P,Oe);return new In(b,P)}const L=[h[12]*p,h[13]*p,h[14]*p],D=g.getCenter(),A=ii(s.center.lat,-85.051129,Va),R=ii(D.lat,-85.051129,Va),B=cl(s.center.lng),q=Pl(A);let W=B-cl(D.lng);const ee=q-Pl(R);W>.5?W-=1:W<-.5&&(W+=1);let te=0;if(Math.abs(W)>Math.abs(ee))te=W>=0?1:3;else{te=ee>=0?0:2;const Oe=[h[4]*p,h[5]*p,h[6]*p],Pe=-Math.sin(ft(ee>=0?g.getSouth():g.getNorth()))*Na;et.vec3.scaleAndAdd(L,L,Oe,Pe)}const Y=M[te],re=M[(te+1)%4],ce=new Jr(Y,re,L),ve=[is(ce,0)||Y[0],is(ce,1)||Y[1],is(ce,2)||Y[2]],Be=No(s.zoom);if(Be>0){const Oe=function({x:nt,y:Ue,z:lt},_t,dt,xt,Ct){const Nt=1/(1<<lt);let wt=nt*Nt,gi=wt+Nt,Ui=Ue*Nt,mi=Ui+Nt,Dn=0;const Mn=(wt+gi)/2-xt;return Mn>.5?Dn=-1:Mn<-.5&&(Dn=1),wt=((wt+Dn)*_t-(xt*=_t))*dt+xt,gi=((gi+Dn)*_t-xt)*dt+xt,Ui=(Ui*_t-(Ct*=_t))*dt+Ct,mi=(mi*_t-Ct)*dt+Ct,[[wt,mi,0],[gi,mi,0],[gi,Ui,0],[wt,Ui,0]]}(n,t,s._pixelsPerMercatorPixel,B,q);for(let nt=0;nt<M.length;nt++)Es(M[nt],Oe[nt],Be);const Pe=et.vec3.add([],Oe[te],Oe[(te+1)%4]);et.vec3.scale(Pe,Pe,.5),Es(ve,Pe,Be)}for(const Oe of M)et.vec3.min(b,b,Oe),et.vec3.max(P,P,Oe);return b[2]=Math.min(Y[2],re[2]),et.vec3.min(b,b,ve),et.vec3.max(P,P,ve),new In(b,P)}function da({x:s,y:t,z:n},c=!1){const p=1/(1<<n),h=new xa(ho(s*p),t===(1<<n)-1&&c?-90:Is((t+1)*p)),g=new xa(ho((s+1)*p),t===0&&c?90:Is(t*p));return new ko(h,g)}function Pa(s,t=Na){const n=ft(s.getNorth()),c=ft(s.getSouth()),p=Math.cos(n),h=Math.cos(c),g=Math.sin(n),M=Math.sin(c),C=s.getWest(),P=s.getEast();return[$c(h,M,C,t),$c(h,M,P,t),$c(p,g,P,t),$c(p,g,C,t)]}function Sa(s,t,n,c){const p=1<<n.z,h=(s/vn+n.x)/p;return xu(Is((t/vn+n.y)/p),ho(h),c)}function ha({min:s,max:t}){return Ju/Math.max(t[0]-s[0],t[1]-s[1],t[2]-s[2])}const Xa=new Float64Array(16);function Os(s){const t=ha(s),n=et.mat4.fromScaling(Xa,[t,t,t]);return et.mat4.translate(n,n,et.vec3.negate([],s.min))}function Oa(s){const t=et.mat4.fromTranslation(Xa,s.min),n=1/ha(s);return et.mat4.scale(t,t,[n,n,n])}function ks(s){const t=vn/(2*Math.PI);return s/(2*Math.PI)/t}function ul(s,t){return vn/(512*Math.pow(2,s))*ha(ns(t))}function tl(s,t,n,c,p){const h=ks(n),g=[s,t,-n/(2*Math.PI)],M=et.mat4.identity(new Float64Array(16));return et.mat4.translate(M,M,g),et.mat4.scale(M,M,[h,h,h]),et.mat4.rotateX(M,M,ft(-p)),et.mat4.rotateY(M,M,ft(-c)),M}function No(s){return Tn(xl,yu,s)}function $l(s,t){const n=xu(t.lat,t.lng),c=function(h){const g=xu(h._center.lat,h._center.lng),M=et.vec3.fromValues(0,1,0);let C=et.vec3.cross([],M,g);const P=et.mat4.fromRotation([],-h.angle,g);C=et.vec3.transformMat4(C,C,P),et.mat4.fromRotation(P,-h._pitch,C);const b=et.vec3.normalize([],g);return et.vec3.scale(b,b,_r(h.cameraToCenterDistance/h.pixelsPerMeter)),et.vec3.transformMat4(b,b,P),et.vec3.add([],g,b)}(s),p=et.vec3.subtract([],c,n);return et.vec3.angle(p,n)}function Eo(s,t){return $l(s,t)>Math.PI/2*1.01}const hl=ft(85),Kl=Math.cos(hl),Bl=Math.sin(hl),Mu=et.mat4.create(),Jl=s=>{const t=[];return s.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),s.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function Qu(s,t,n,c,p,h,g,M,C){if(h&&s.queryGeometry.isAboveHorizon)return!1;h&&(C*=s.pixelToTileUnitsFactor);const P=s.tileID.canonical,b=n.projection.upVectorScale(P,n.center.lat,n.worldSize).metersToTile;for(const L of t)for(const D of L){const A=D.add(M),R=p&&n.elevation?n.elevation.exaggeration()*p.getElevationAt(A.x,A.y,!0):0,B=n.projection.projectTilePoint(A.x,A.y,P);if(R>0){const te=n.projection.upVector(P,A.x,A.y);B.x+=te[0]*b*R,B.y+=te[1]*b*R,B.z+=te[2]*b*R}const q=h?A:Lf(B.x,B.y,B.z,c),W=h?s.tilespaceRays.map(te=>Uo(te,R)):s.queryGeometry.screenGeometry,ee=et.vec4.transformMat4([],[B.x,B.y,B.z,1],c);if(!g&&h?C*=ee[3]/n.cameraToCenterDistance:g&&!h&&(C*=n.cameraToCenterDistance/ee[3]),h){const te=Is((D.y/vn+P.y)/(1<<P.z));C/=n.projection.pixelsPerMeter(te,1)/io(1,te)}if(me(W,q,C))return!0}return!1}function Lf(s,t,n,c){const p=et.vec4.transformMat4([],[s,t,n,1],c);return new Pi(p[0]/p[3],p[1]/p[3])}const il=et.vec3.fromValues(0,0,0),Hp=et.vec3.fromValues(0,0,1);function Uo(s,t){const n=et.vec3.create();return il[2]=t,s.intersectsPlane(il,Hp,n),new Pi(n[0],n[1])}class jp extends le{}let qp,vd,am,eh;function wp(s,{width:t,height:n},c,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==t*n*c)throw new RangeError("mismatched image size")}else p=new Uint8Array(t*n*c);return s.width=t,s.height=n,s.data=p,s}function Wp(s,t,n){const{width:c,height:p}=t;c===s.width&&p===s.height||(Fh(s,t,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,c),height:Math.min(s.height,p)},n,null),s.width=c,s.height=p,s.data=t.data)}function Fh(s,t,n,c,p,h,g,M){if(p.width===0||p.height===0)return t;if(p.width>s.width||p.height>s.height||n.x>s.width-p.width||n.y>s.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>t.width||p.height>t.height||c.x>t.width-p.width||c.y>t.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const C=s.data,P=t.data,b=h===4&&M;for(let L=0;L<p.height;L++){const D=((n.y+L)*s.width+n.x)*h,A=((c.y+L)*t.width+c.x)*h;if(b)for(let R=0;R<p.width;R++){const B=D+R*h+3,q=A+R*h;P[q+0]=255,P[q+1]=255,P[q+2]=255,P[q+3]=C[B]}else if(g)for(let R=0;R<p.width;R++){const B=D+R*h,q=A+R*h,W=C[B+3],ee=new we(C[B+0]/255*W,C[B+1]/255*W,C[B+2]/255*W,W).toRenderColor(g).toArray();P[q+0]=ee[0],P[q+1]=ee[1],P[q+2]=ee[2],P[q+3]=ee[3]}else for(let R=0;R<p.width*h;R++)P[A+R]=C[D+R]}return t}kn(jp,"HeatmapBucket",{omit:["layers"]});class xd{constructor(t,n){wp(this,t,1,n)}resize(t){Wp(this,new xd(t),1)}clone(){return new xd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,c,p,h){Fh(t,n,c,p,h,1,null)}}class Vo{constructor(t,n){wp(this,t,4,n)}resize(t){Wp(this,new Vo(t),4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Vo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,c,p,h,g,M){Fh(t,n,c,p,h,4,g,M)}}class sm{constructor(t,n){this.width=t.width,this.height=t.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}function Rf(s){const t={},n=s.resolution||256,c=s.clips?s.clips.length:1,p=s.image||new Vo({width:n,height:c}),h=(g,M,C)=>{t[s.evaluationKey]=C;const P=s.expression.evaluate(t);P&&(p.data[g+M+0]=Math.floor(255*P.r/P.a),p.data[g+M+1]=Math.floor(255*P.g/P.a),p.data[g+M+2]=Math.floor(255*P.b/P.a),p.data[g+M+3]=Math.floor(255*P.a))};if(s.clips)for(let g=0,M=0;g<c;++g,M+=4*n)for(let C=0,P=0;C<n;C++,P+=4){const b=C/(n-1),{start:L,end:D}=s.clips[g];h(M,P,L*(1-b)+D*b)}else for(let g=0,M=0;g<n;g++,M+=4)h(0,M,g/(n-1));return p}kn(xd,"AlphaImage"),kn(Vo,"RGBAImage");const om=Ta([{name:"a_pos",components:2,type:"Int16"}],4),{members:jm}=om;function Mp(s,t,n=2){const c=t&&t.length,p=c?t[0]*n:s.length;let h=ms(s,0,p,n,!0);const g=[];if(!h||h.next===h.prev)return g;let M,C,P;if(c&&(h=function(b,L,D,A){const R=[];for(let B=0,q=L.length;B<q;B++){const W=ms(b,L[B]*A,B<q-1?L[B+1]*A:b.length,A,!1);W===W.next&&(W.steiner=!0),R.push(Ns(W))}R.sort(wm);for(let B=0;B<R.length;B++)D=Zp(R[B],D);return D}(s,t,h,n)),s.length>80*n){M=1/0,C=1/0;let b=-1/0,L=-1/0;for(let D=n;D<p;D+=n){const A=s[D],R=s[D+1];A<M&&(M=A),R<C&&(C=R),A>b&&(b=A),R>L&&(L=R)}P=Math.max(b-M,L-C),P=P!==0?32767/P:0}return np(h,g,n,M,C,P,0),g}function ms(s,t,n,c,p){let h;if(p===function(g,M,C,P){let b=0;for(let L=M,D=C-P;L<C;L+=P)b+=(g[D]-g[L])*(g[L+1]+g[D+1]),D=L;return b}(s,t,n,c)>0)for(let g=t;g<n;g+=c)h=Ep(g/c|0,s[g],s[g+1],h);else for(let g=n-c;g>=t;g-=c)h=Ep(g/c|0,s[g],s[g+1],h);return h&&Tp(h,h.next)&&(sf(h),h=h.next),h}function bd(s,t){if(!s)return s;t||(t=s);let n,c=s;do if(n=!1,c.steiner||!Tp(c,c.next)&&no(c.prev,c,c.next)!==0)c=c.next;else{if(sf(c),c=t=c.prev,c===c.next)break;n=!0}while(n||c!==t);return t}function np(s,t,n,c,p,h,g){if(!s)return;!g&&h&&function(C,P,b,L){let D=C;do D.z===0&&(D.z=wd(D.x,D.y,P,b,L)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==C);D.prevZ.nextZ=null,D.prevZ=null,function(A){let R,B=1;do{let q,W=A;A=null;let ee=null;for(R=0;W;){R++;let te=W,Y=0;for(let ce=0;ce<B&&(Y++,te=te.nextZ,te);ce++);let re=B;for(;Y>0||re>0&&te;)Y!==0&&(re===0||!te||W.z<=te.z)?(q=W,W=W.nextZ,Y--):(q=te,te=te.nextZ,re--),ee?ee.nextZ=q:A=q,q.prevZ=ee,ee=q;W=te}ee.nextZ=null,B*=2}while(R>1)}(D)}(s,c,p,h);let M=s;for(;s.prev!==s.next;){const C=s.prev,P=s.next;if(h?Df(s,c,p,h):If(s))t.push(C.i,s.i,P.i),sf(s),s=P.next,M=P.next;else if((s=P)===M){g?g===1?np(s=lm(bd(s),t),t,n,c,p,h,2):g===2&&cm(s,t,n,c,p,h):np(bd(s),t,n,c,p,h,1);break}}}function If(s){const t=s.prev,n=s,c=s.next;if(no(t,n,c)>=0)return!1;const p=t.x,h=n.x,g=c.x,M=t.y,C=n.y,P=c.y,b=p<h?p<g?p:g:h<g?h:g,L=M<C?M<P?M:P:C<P?C:P,D=p>h?p>g?p:g:h>g?h:g,A=M>C?M>P?M:P:C>P?C:P;let R=c.next;for(;R!==t;){if(R.x>=b&&R.x<=D&&R.y>=L&&R.y<=A&&th(p,M,h,C,g,P,R.x,R.y)&&no(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function Df(s,t,n,c){const p=s.prev,h=s,g=s.next;if(no(p,h,g)>=0)return!1;const M=p.x,C=h.x,P=g.x,b=p.y,L=h.y,D=g.y,A=M<C?M<P?M:P:C<P?C:P,R=b<L?b<D?b:D:L<D?L:D,B=M>C?M>P?M:P:C>P?C:P,q=b>L?b>D?b:D:L>D?L:D,W=wd(A,R,t,n,c),ee=wd(B,q,t,n,c);let te=s.prevZ,Y=s.nextZ;for(;te&&te.z>=W&&Y&&Y.z<=ee;){if(te.x>=A&&te.x<=B&&te.y>=R&&te.y<=q&&te!==p&&te!==g&&th(M,b,C,L,P,D,te.x,te.y)&&no(te.prev,te,te.next)>=0||(te=te.prevZ,Y.x>=A&&Y.x<=B&&Y.y>=R&&Y.y<=q&&Y!==p&&Y!==g&&th(M,b,C,L,P,D,Y.x,Y.y)&&no(Y.prev,Y,Y.next)>=0))return!1;Y=Y.nextZ}for(;te&&te.z>=W;){if(te.x>=A&&te.x<=B&&te.y>=R&&te.y<=q&&te!==p&&te!==g&&th(M,b,C,L,P,D,te.x,te.y)&&no(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;Y&&Y.z<=ee;){if(Y.x>=A&&Y.x<=B&&Y.y>=R&&Y.y<=q&&Y!==p&&Y!==g&&th(M,b,C,L,P,D,Y.x,Y.y)&&no(Y.prev,Y,Y.next)>=0)return!1;Y=Y.nextZ}return!0}function lm(s,t){let n=s;do{const c=n.prev,p=n.next.next;!Tp(c,p)&&Md(c,n,n.next,p)&&ih(c,p)&&ih(p,c)&&(t.push(c.i,n.i,p.i),sf(n),sf(n.next),n=s=p),n=n.next}while(n!==s);return bd(n)}function cm(s,t,n,c,p,h){let g=s;do{let M=g.next.next;for(;M!==g.prev;){if(g.i!==M.i&&Mm(g,M)){let C=Sp(g,M);return g=bd(g,g.next),C=bd(C,C.next),np(g,t,n,c,p,h,0),void np(C,t,n,c,p,h,0)}M=M.next}g=g.next}while(g!==s)}function wm(s,t){return s.x-t.x}function Zp(s,t){const n=function(p,h){let g=h;const M=p.x,C=p.y;let P,b=-1/0;do{if(C<=g.y&&C>=g.next.y&&g.next.y!==g.y){const B=g.x+(C-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(B<=M&&B>b&&(b=B,P=g.x<g.next.x?g:g.next,B===M))return P}g=g.next}while(g!==h);if(!P)return null;const L=P,D=P.x,A=P.y;let R=1/0;g=P;do{if(M>=g.x&&g.x>=D&&M!==g.x&&th(C<A?M:b,C,D,A,C<A?b:M,C,g.x,g.y)){const B=Math.abs(C-g.y)/(M-g.x);ih(g,p)&&(B<R||B===R&&(g.x>P.x||g.x===P.x&&zf(P,g)))&&(P=g,R=B)}g=g.next}while(g!==L);return P}(s,t);if(!n)return t;const c=Sp(n,s);return bd(c,c.next),bd(n,n.next)}function zf(s,t){return no(s.prev,s,t.prev)<0&&no(t.next,s,s.next)<0}function wd(s,t,n,c,p){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-n)*p|0)|s<<8))|s<<4))|s<<2))|s<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*p|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ns(s){let t=s,n=s;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==s);return n}function th(s,t,n,c,p,h,g,M){return(p-g)*(t-M)>=(s-g)*(h-M)&&(s-g)*(c-M)>=(n-g)*(t-M)&&(n-g)*(h-M)>=(p-g)*(c-M)}function Mm(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!function(n,c){let p=n;do{if(p.i!==n.i&&p.next.i!==n.i&&p.i!==c.i&&p.next.i!==c.i&&Md(p,p.next,n,c))return!0;p=p.next}while(p!==n);return!1}(s,t)&&(ih(s,t)&&ih(t,s)&&function(n,c){let p=n,h=!1;const g=(n.x+c.x)/2,M=(n.y+c.y)/2;do p.y>M!=p.next.y>M&&p.next.y!==p.y&&g<(p.next.x-p.x)*(M-p.y)/(p.next.y-p.y)+p.x&&(h=!h),p=p.next;while(p!==n);return h}(s,t)&&(no(s.prev,s,t.prev)||no(s,t.prev,t))||Tp(s,t)&&no(s.prev,s,s.next)>0&&no(t.prev,t,t.next)>0)}function no(s,t,n){return(t.y-s.y)*(n.x-t.x)-(t.x-s.x)*(n.y-t.y)}function Tp(s,t){return s.x===t.x&&s.y===t.y}function Md(s,t,n,c){const p=Td(no(s,t,n)),h=Td(no(s,t,c)),g=Td(no(n,c,s)),M=Td(no(n,c,t));return p!==h&&g!==M||!(p!==0||!Pf(s,n,t))||!(h!==0||!Pf(s,c,t))||!(g!==0||!Pf(n,s,c))||!(M!==0||!Pf(n,t,c))}function Pf(s,t,n){return t.x<=Math.max(s.x,n.x)&&t.x>=Math.min(s.x,n.x)&&t.y<=Math.max(s.y,n.y)&&t.y>=Math.min(s.y,n.y)}function Td(s){return s>0?1:s<0?-1:0}function ih(s,t){return no(s.prev,s,s.next)<0?no(s,t,s.next)>=0&&no(s,s.prev,t)>=0:no(s,t,s.prev)<0||no(s,s.next,t)<0}function Sp(s,t){const n=kh(s.i,s.x,s.y),c=kh(t.i,t.x,t.y),p=s.next,h=t.prev;return s.next=t,t.prev=s,n.next=p,p.prev=n,c.next=n,n.prev=c,h.next=c,c.prev=h,c}function Ep(s,t,n,c){const p=kh(s,t,n);return c?(p.next=c.next,p.prev=c,c.next.prev=p,c.next=p):(p.prev=p,p.next=p),p}function sf(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function kh(s,t,n){return{i:s,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function zc(s,t){const n=s.length;if(n<=1)return[s];const c=[];let p,h;for(let g=0;g<n;g++){const M=lo(s[g]);M!==0&&(s[g].area=Math.abs(M),h===void 0&&(h=M<0),h===M<0?(p&&c.push(p),p=[s[g]]):p.push(s[g]))}if(p&&c.push(p),t>1)for(let g=0;g<c.length;g++)c[g].length<=t||(tu(c[g],t,1,c[g].length-1,rp),c[g]=c[g].slice(0,t));return c}function rp(s,t){return t.area-s.area}function Ap(s,t,n=1){if(!s)return null;const c=typeof s=="string"?s:s.getPrimary().id;t[c]||(t[c]=[]);const p=Ts.from(c).getPrimary().scaleSelf(n);return t[c].push(p),p.serialize()}function Cp(s,t,n,c){const p=c.patternDependencies;let h=!1;for(const g of t){const M=g.paint.get(`${s}-pattern`);M.isConstant()||(h=!0),Ap(M.constantOr(null),p,n)&&(h=!0)}return h}function Of(s,t,n,c,p,h){const g=h.patternDependencies;for(const M of t){const C=M.paint.get(`${s}-pattern`).value;if(C.kind!=="constant"){let P=C.evaluate({zoom:c},n,{},h.availableImages);P=P&&P.name?P.name:P;const b=Ap(P,g,p);b&&(n.patterns[M.id]=b)}}return n}class ro{constructor(t){this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new du,this.indexArray=new uo,this.indexArray2=new fu,this.programConfigurations=new Yl(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new bs,this.segments2=new bs,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=t.projection}updateFootprints(t,n){}populate(t,n,c,p){this.hasPattern=Cp("fill",this.layers,this.pixelRatio,n);const h=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:M,id:C,index:P,sourceLayerIndex:b}of t){const L=this.layers[0]._featureFilter.needGeometry,D=Z(M,L);if(!this.layers[0]._featureFilter.filter(new Ka(this.zoom),D,c))continue;const A=h?h.evaluate(D,{},c,n.availableImages):void 0,R={id:C,properties:M.properties,type:M.type,sourceLayerIndex:b,index:P,geometry:L?D.geometry:j(M,c,p),patterns:{},sortKey:A};g.push(R)}h&&g.sort((M,C)=>M.sortKey-C.sortKey);for(const M of g){const{geometry:C,index:P,sourceLayerIndex:b}=M;if(this.hasPattern){const L=Of("fill",this.layers,M,this.zoom,this.pixelRatio,n);this.patternFeatures.push(L)}else this.addFeature(M,C,P,c,{},n.availableImages,n.brightness,n.elevationFeatures);n.featureIndex.insert(t[P].feature,C,P,b,this.index)}}update(t,n,c,p,h,g,M){this.programConfigurations.updatePaintArrays(t,n,h,c,p,g,M)}addFeatures(t,n,c,p,h,g){for(const M of this.patternFeatures)this.addFeature(M,M.geometry,M.index,n,c,p,g,t.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,jm),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,c,p,h,g=[],M,C){for(const P of zc(n,500)){let b=0;for(const q of P)b+=q.length;const L=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),D=L.vertexLength,A=[],R=[];for(const q of P){if(q.length===0)continue;q!==P[0]&&R.push(A.length/2);const W=this.segments2.prepareSegment(q.length,this.layoutVertexArray,this.indexArray2),ee=W.vertexLength;this.layoutVertexArray.emplaceBack(q[0].x,q[0].y),this.indexArray2.emplaceBack(ee+q.length-1,ee),A.push(q[0].x),A.push(q[0].y);for(let te=1;te<q.length;te++)this.layoutVertexArray.emplaceBack(q[te].x,q[te].y),this.indexArray2.emplaceBack(ee+te-1,ee+te),A.push(q[te].x),A.push(q[te].y);W.vertexLength+=q.length,W.primitiveLength+=q.length}const B=Mp(A,R);for(let q=0;q<B.length;q+=3)this.indexArray.emplaceBack(D+B[q],D+B[q+1],D+B[q+2]);L.vertexLength+=b,L.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,h,g,p,M)}}let Ao,Bf,Xp,Yp;kn(ro,"FillBucket",{omit:["layers","patternFeatures"]});class ap{constructor(t,n,c,p){if(this.triangleCount=n.length/3,this.min=new Pi(0,0),this.max=new Pi(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0)return;const[h,g]=[t[0].clone(),t[0].clone()];for(let L=1;L<t.length;++L){const D=t[L];h.x=Math.min(h.x,D.x),h.y=Math.min(h.y,D.y),g.x=Math.max(g.x,D.x),g.y=Math.max(g.y,D.y)}if(p){const L=Math.ceil(Math.max(g.x-h.x,g.y-h.y)/p);c=Math.max(c,L)}if(c===0)return;this.min=h,this.max=g;const M=this.max.sub(this.min);M.x=Math.max(M.x,1),M.y=Math.max(M.y,1);const C=Math.max(M.x,M.y)/c;this.cellsX=Math.max(1,Math.ceil(M.x/C)),this.cellsY=Math.max(1,Math.ceil(M.y/C)),this.xScale=1/C,this.yScale=1/C;const P=[];for(let L=0;L<this.triangleCount;L++){const D=t[n[3*L+0]].sub(this.min),A=t[n[3*L+1]].sub(this.min),R=t[n[3*L+2]].sub(this.min),B=Pc(Math.floor(Math.min(D.x,A.x,R.x)),this.xScale,this.cellsX),q=Pc(Math.floor(Math.max(D.x,A.x,R.x)),this.xScale,this.cellsX),W=Pc(Math.floor(Math.min(D.y,A.y,R.y)),this.yScale,this.cellsY),ee=Pc(Math.floor(Math.max(D.y,A.y,R.y)),this.yScale,this.cellsY),te=new Pi(0,0),Y=new Pi(0,0),re=new Pi(0,0),ce=new Pi(0,0);for(let ve=W;ve<=ee;++ve){te.y=Y.y=ve*C,re.y=ce.y=(ve+1)*C;for(let Be=B;Be<=q;++Be)te.x=re.x=Be*C,Y.x=ce.x=(Be+1)*C,(jt(D,A,R,te,Y,ce)||jt(D,A,R,te,ce,re))&&P.push({cellIdx:ve*this.cellsX+Be,triIdx:L})}}if(P.length===0)return;P.sort((L,D)=>L.cellIdx-D.cellIdx||L.triIdx-D.triIdx);let b=0;for(;b<P.length;){const L=P[b].cellIdx,D={start:this.payload.length,len:0};for(;b<P.length&&P[b].cellIdx===L;)++D.len,this.payload.push(P[b++].triIdx);this.cells[L]=D}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(t,n){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>t.x||t.y>this.max.y||this.min.y>t.y)return;const c=Pc(t.x-this.min.x,this.xScale,this.cellsX),p=Pc(t.y-this.min.y,this.yScale,this.cellsY),h=this.cells[p*this.cellsX+c];if(h){this._lazyInitLookup();for(let g=0;g<h.len;g++){const M=this.payload[h.start+g],C=Math.floor(M/8),P=1<<M%8;if(!(this.lookup[C]&P)&&(this.lookup[C]|=P,n.push(M),n.length===this.triangleCount))return}}}query(t,n,c){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>n.x||t.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();const p=Pc(t.x-this.min.x,this.xScale,this.cellsX),h=Pc(n.x-this.min.x,this.xScale,this.cellsX),g=Pc(t.y-this.min.y,this.yScale,this.cellsY),M=Pc(n.y-this.min.y,this.yScale,this.cellsY);for(let C=g;C<=M;C++)for(let P=p;P<=h;P++){const b=this.cells[C*this.cellsX+P];if(b)for(let L=0;L<b.len;L++){const D=this.payload[b.start+L],A=Math.floor(D/8),R=1<<D%8;if(!(this.lookup[A]&R)&&(this.lookup[A]|=R,c.push(D),c.length===this.triangleCount))return}}}}function Pc(s,t,n){return Math.max(0,Math.min(n-1,Math.floor(s*t)))}kn(ap,"TriangleGridIndex");class Lp{constructor(t){this.zoom=t.zoom,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=t.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[]}updateFootprints(t,n){for(const c of this.footprints)n.push({footprint:c,id:t})}populate(t,n,c,p){const h=[];for(const{feature:g,id:M,index:C,sourceLayerIndex:P}of t){const b=this.layers[0]._featureFilter.needGeometry,L=Z(g,b);if(!this.layers[0]._featureFilter.filter(new Ka(this.zoom),L,c))continue;const D={id:M,properties:g.properties,type:g.type,sourceLayerIndex:P,index:C,geometry:b?L.geometry:j(g,c,p),patterns:{}};h.push(D)}for(const g of h){const{geometry:M,index:C,sourceLayerIndex:P}=g;this.addFeature(g,M,C,c,{},n.availableImages,n.brightness),n.featureIndex.insert(t[C].feature,M,C,P,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(t){}update(t,n,c,p,h,g,M){}destroy(){}addFeature(t,n,c,p,h,g=[],M){for(const C of zc(n,2)){const P=[],b=[],L=[],D=new Pi(1/0,1/0),A=new Pi(-1/0,-1/0);for(const q of C)if(q.length!==0){q!==C[0]&&L.push(b.length/2);for(let W=0;W<q.length;W++)b.push(q[W].x),b.push(q[W].y),P.push(q[W]),D.x=Math.min(D.x,q[W].x),D.y=Math.min(D.y,q[W].y),A.x=Math.max(A.x,q[W].x),A.y=Math.max(A.y,q[W].y)}const R=Mp(b,L),B=new ap(P,R,8,256);this.footprints.push({vertices:P,indices:R,grid:B,min:D,max:A})}}}kn(Lp,"ClipBucket",{omit:["layers"]});const Tm=Ta([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),qm=Ta([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Rp=Ta([{name:"a_centroid_pos",components:2,type:"Uint16"}]),E=Ta([{name:"a_join_normal_inside",components:3,type:"Int16"}]),e=Ta([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),l=Ta([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:_}=Tm;var y,S,O,k,N,G,$,K={};function ie(){if(S)return y;S=1;var s=ra();function t(p,h,g,M,C){this.properties={},this.extent=g,this.type=0,this._pbf=p,this._geometry=-1,this._keys=M,this._values=C,p.readFields(n,this,h)}function n(p,h,g){p==1?h.id=g.readVarint():p==2?function(M,C){for(var P=M.readVarint()+M.pos;M.pos<P;){var b=C._keys[M.readVarint()],L=C._values[M.readVarint()];C.properties[b]=L}}(g,h):p==3?h.type=g.readVarint():p==4&&(h._geometry=g.pos)}function c(p){for(var h,g,M=0,C=0,P=p.length,b=P-1;C<P;b=C++)M+=((g=p[b]).x-(h=p[C]).x)*(h.y+g.y);return M}return y=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var h,g=p.readVarint()+p.pos,M=1,C=0,P=0,b=0,L=[];p.pos<g;){if(C<=0){var D=p.readVarint();M=7&D,C=D>>3}if(C--,M===1||M===2)P+=p.readSVarint(),b+=p.readSVarint(),M===1&&(h&&L.push(h),h=[]),h.push(new s(P,b));else{if(M!==7)throw new Error("unknown command "+M);h&&h.push(h[0].clone())}}return h&&L.push(h),L},t.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var h=p.readVarint()+p.pos,g=1,M=0,C=0,P=0,b=1/0,L=-1/0,D=1/0,A=-1/0;p.pos<h;){if(M<=0){var R=p.readVarint();g=7&R,M=R>>3}if(M--,g===1||g===2)(C+=p.readSVarint())<b&&(b=C),C>L&&(L=C),(P+=p.readSVarint())<D&&(D=P),P>A&&(A=P);else if(g!==7)throw new Error("unknown command "+g)}return[b,D,L,A]},t.prototype.toGeoJSON=function(p,h,g){var M,C,P=this.extent*Math.pow(2,g),b=this.extent*p,L=this.extent*h,D=this.loadGeometry(),A=t.types[this.type];function R(W){for(var ee=0;ee<W.length;ee++){var te=W[ee];W[ee]=[360*(te.x+b)/P-180,360/Math.PI*Math.atan(Math.exp((180-360*(te.y+L)/P)*Math.PI/180))-90]}}switch(this.type){case 1:var B=[];for(M=0;M<D.length;M++)B[M]=D[M][0];R(D=B);break;case 2:for(M=0;M<D.length;M++)R(D[M]);break;case 3:for(D=function(W){var ee=W.length;if(ee<=1)return[W];for(var te,Y,re=[],ce=0;ce<ee;ce++){var ve=c(W[ce]);ve!==0&&(Y===void 0&&(Y=ve<0),Y===ve<0?(te&&re.push(te),te=[W[ce]]):te.push(W[ce]))}return te&&re.push(te),re}(D),M=0;M<D.length;M++)for(C=0;C<D[M].length;C++)R(D[M][C])}D.length===1?D=D[0]:A="Multi"+A;var q={type:"Feature",geometry:{type:A,coordinates:D},properties:this.properties};return"id"in this&&(q.id=this.id),q},y}function ne(){if(k)return O;k=1;var s=ie();function t(c,p){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(n,this,p),this.length=this._features.length}function n(c,p,h){c===15?p.version=h.readVarint():c===1?p.name=h.readString():c===5?p.extent=h.readVarint():c===2?p._features.push(h.pos):c===3?p._keys.push(h.readString()):c===4&&p._values.push(function(g){for(var M=null,C=g.readVarint()+g.pos;g.pos<C;){var P=g.readVarint()>>3;M=P===1?g.readString():P===2?g.readFloat():P===3?g.readDouble():P===4?g.readVarint64():P===5?g.readVarint():P===6?g.readSVarint():P===7?g.readBoolean():null}return M}(h))}return O=t,t.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var p=this._pbf.readVarint()+this._pbf.pos;return new s(this._pbf,p,this.extent,this._keys,this._values)},O}function ue(){return $||($=1,K.VectorTile=function(){if(G)return N;G=1;var s=ne();function t(n,c,p){if(n===3){var h=new s(p,p.readVarint()+p.pos);h.length&&(c[h.name]=h)}}return N=function(n,c){this.layers=n.readFields(t,{},c)},N}(),K.VectorTileFeature=ie(),K.VectorTileLayer=ne()),K}var ye=ue();class Se extends Pi{constructor(t,n,c){super(t,n),this.z=c}}class _e extends Se{constructor(t,n,c,p){super(t,n,c),this.w=p}}function $e(s,t,n,c){const p=[],h=c===0?(g,M,C,P,b,L)=>{g.push(new Pi(L,C+(L-M)/(P-M)*(b-C)))}:(g,M,C,P,b,L)=>{g.push(new Pi(M+(L-C)/(b-C)*(P-M),L))};for(const g of s){const M=[];for(const C of g){if(C.length<=2)continue;const P=[];for(let D=0;D<C.length-1;D++){const A=C[D].x,R=C[D].y,B=C[D+1].x,q=C[D+1].y,W=c===0?A:R,ee=c===0?B:q;W<t?ee>t&&h(P,A,R,B,q,t):W>n?ee<n&&h(P,A,R,B,q,n):P.push(C[D]),ee<t&&W>=t&&h(P,A,R,B,q,t),ee>n&&W<=n&&h(P,A,R,B,q,n)}let b=C[C.length-1];const L=c===0?b.x:b.y;L>=t&&L<=n&&P.push(b),P.length&&(b=P[P.length-1],P[0].x===b.x&&P[0].y===b.y||P.push(P[0]),M.push(P))}M.length&&p.push(M)}return p}function st(s,t,n,c){const p=n==="x"?"y":"x",h=(c-s[n])/(t[n]-s[n]);s[p]=s[p]+(t[p]-s[p])*h,s[n]=c,s.hasOwnProperty("z")&&(s.z=Ee(s.z,t.z,h)),s.hasOwnProperty("w")&&(s.w=Ee(s.w,t.w,h))}function ot(s,t,n,c){const p=n,h=c;for(const g of["x","y"]){let M=s,C=t;M[g]>=C[g]&&(M=t,C=s),M[g]<p&&C[g]>p&&st(M,C,g,p),M[g]<h&&C[g]>h&&st(C,M,g,h)}}const Lt=Number.MAX_SAFE_INTEGER;function Bt(s,t,n,c){return s.order<t||s.order===Lt||!(s.clipMask&n)||function(p,h){return h.length!==0&&h.find(g=>g===p)===void 0}(c,s.clipScope)}function di(s,t){return s.x-t.x||s.y-t.y}function Ti(s,t){return di(s.min,t.min)===0&&di(s.max,t.max)===0}function Ki(s,t){return!(s.min.x>t.max.x||s.max.x<t.min.x||s.min.y>t.max.y||s.max.y<t.min.y)}function Bi(s,t){if(s.length!==t.length)return!1;for(let n=0;n<s.length;n++)if(s[n].sourceId!==t[n].sourceId||!Ti(s[n],t[n])||s[n].order!==t[n].order||s[n].clipMask!==t[n].clipMask||!cn(s[n].clipScope,t[n].clipScope))return!1;return!0}function Zi(s,t,n){const c=1/vn,p=1/(1<<n.canonical.z),h=(t.x*c+n.canonical.x)*p+n.wrap,g=(t.y*c+n.canonical.y)*p;return{min:new Pi((s.x*c+n.canonical.x)*p+n.wrap,(s.y*c+n.canonical.y)*p),max:new Pi(h,g)}}function hr(s,t,n){const c=1<<n.canonical.z,p=((t.x-n.wrap)*c-n.canonical.x)*vn,h=(t.y*c-n.canonical.y)*vn;return{min:new Pi(((s.x-n.wrap)*c-n.canonical.x)*vn,(s.y*c-n.canonical.y)*vn),max:new Pi(p,h)}}function Gn(s,t,n,c,p,h,g){const M=s.indices,C=s.vertices,P=[];for(let b=c;b<c+p;b+=3){const L=t[n[b+0]+h],D=t[n[b+1]+h],A=t[n[b+2]+h],R=Math.min(L.x,D.x,A.x),B=Math.max(L.x,D.x,A.x),q=Math.min(L.y,D.y,A.y),W=Math.max(L.y,D.y,A.y);P.length=0,s.grid.query(new Pi(R,q),new Pi(B,W),P);for(let ee=0;ee<P.length;ee++){const te=P[ee];if(jt(C[M[3*te+0]],C[M[3*te+1]],C[M[3*te+2]],L,D,A,g))return!0}}return!1}function gn(s,t,n,c){if(!s||!n)return!1;let p=s.vertices;if(!t.canonical.equals(c.canonical)||t.wrap!==c.wrap){if(n.vertices.length<s.vertices.length)return gn(n,c,s,t);const h=t.canonical,g=c.canonical,M=Math.pow(2,g.z-h.z);p=s.vertices.map(C=>new Pi((C.x+h.x*vn)*M-g.x*vn,(C.y+h.y*vn)*M-g.y*vn))}return Gn(n,p,s.indices,0,s.indices.length,0,0)}function Yn(s,t,n,c){const p=Math.pow(2,c.z-n.z);return new Pi((s+n.x*vn)*p-c.x*vn,(t+n.y*vn)*p-c.y*vn)}function Mr(s,t){const n=[];t.grid.queryPoint(s,n);const c=t.indices,p=t.vertices;for(let h=0;h<n.length;h++){const g=n[h];if(je([p[c[3*g+0]],p[c[3*g+1]],p[c[3*g+2]]],s))return!0}return!1}const Cr=[new Pi(0,0),new Pi(vn,0),new Pi(vn,vn),new Pi(0,vn)];function kr(s,t){const n=[];let c=[];if(!t||s.length<2)return[s];if(s.length===2)return gt(s[0],s[1],Cr)?[s]:[];for(let p=0;p<s.length+2;p++){const h=s[p%s.length],g=s[(p+1)%s.length],M=gt(p===0?s[s.length-1]:s[(p-1)%s.length],h,Cr),C=gt(h,g,Cr),P=M||C;P&&c.push(h),P&&C||c.length>0&&(c.length>1&&n.push(c),c=[])}return c.length>1&&n.push(c),n}const Zr=ye.VectorTileFeature.types,la=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Kn=["fill-extrusion-flood-light-ground-radius"],At=Math.pow(2,13),Qt=Math.pow(2,15)-1,xn=new Pi(0,1),Vi=2147483648;function ji(s,t,n,c,p,h,g,M){s.emplaceBack((t<<1)+g,(n<<1)+h,(Math.floor(c*At)<<1)+p,Math.round(M))}function ir(s,t,n){s.emplaceBack(t.x*vn,t.y*vn,n?1:0)}function $n(s,t,n,c,p,h){s.emplaceBack(t.x,t.y,(n.x<<1)+c,(n.y<<1)+p,h)}function $i(s,t,n){s.emplaceBack(t.x,t.y,t.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Mt{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Oi{constructor(){this.centroidXY=new Pi(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Pi(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Pi(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Pi(this.max.x-this.min.x,this.max.y-this.min.y)}}class Ln{constructor(){this.acc=new Pi(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,n){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=n.x,t.min.y=t.max.y=n.y)}appendEdge(t,n,c){this.accCount++,this.acc._add(n);let p=!!this.borders;n.x<t.min.x?(t.min.x=n.x,p=!0):n.x>t.max.x&&(t.max.x=n.x,p=!0),n.y<t.min.y?(t.min.y=n.y,p=!0):n.y>t.max.y&&(t.max.y=n.y,p=!0),((n.x===0||n.x===vn)&&n.x===c.x)!=((n.y===0||n.y===vn)&&n.y===c.y)&&this.processBorderOverlap(n,c),p&&this.checkBorderIntersection(n,c)}checkBorderIntersection(t,n){n.x<0!=t.x<0&&this.addBorderIntersection(0,Ee(n.y,t.y,(0-n.x)/(t.x-n.x))),n.x>vn!=t.x>vn&&this.addBorderIntersection(1,Ee(n.y,t.y,(vn-n.x)/(t.x-n.x))),n.y<0!=t.y<0&&this.addBorderIntersection(2,Ee(n.x,t.x,(0-n.y)/(t.y-n.y))),n.y>vn!=t.y>vn&&this.addBorderIntersection(3,Ee(n.x,t.x,(vn-n.y)/(t.y-n.y)))}addBorderIntersection(t,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[t];n<c[0]&&(c[0]=n),n>c[1]&&(c[1]=n)}processBorderOverlap(t,n){if(t.x===n.x){if(t.y===n.y)return;const c=t.x===0?0:1;this.addBorderIntersection(c,n.y),this.addBorderIntersection(c,t.y)}else{const c=t.y===0?2:3;this.addBorderIntersection(c,n.x),this.addBorderIntersection(c,t.x)}}centroid(){return this.accCount===0?new Pi(0,0):new Pi(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,n)=>t+ +(n[0]!==Number.MAX_VALUE),0):0}}function Bn(s,t){const n=s.add(t)._unit(),c=ii(s.x*n.x+s.y*n.y,-1,1);var p,h,g;return g=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(g)))/4*Qt*((p=s).x*(h=t).y-p.y*h.x<0?-1:1)}const Rn=[s=>s.x<0,s=>s.x>vn,s=>s.y<0,s=>s.y>vn];function Dr(s,t,n,c){const p=[4];if(c===0)return p;n._mult(c);const h=s.sub(n),g=t.sub(n),M=[s,t,h,g];for(let C=0;C<4;C++)for(const P of M)if(Rn[C](P)){p.push(C);break}return p}class Qr{constructor(t){this.vertexArray=new Ih,this.indexArray=new uo,this.programConfigurations=new Yl(t.layers,{zoom:t.zoom,lut:t.lut},n=>Kn.includes(n)),this._segments=new bs,this.hiddenByLandmarkVertexArray=new Jd,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new bs}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,n,c,p=!1){const h=t.length;if(h>2){let g=Math.max(0,this._segments.get().length-1);const M=this._segments._prepareSegment(4*h,this.vertexArray.length,2*this._segmentToGroundQuads[g].length);let C;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{const P=t[0],b=t[1];C=Bn(P.sub(t[h-1])._perp()._unit(),b.sub(P)._perp()._unit())}for(let P=0;P<h;P++){const b=P===h-1?0:P+1,L=t[P],D=t[b],A=t[b===h-1?0:b+1],R=D.sub(L)._perp()._unit(),B=Bn(R,A.sub(D)._perp()._unit()),q=C,W=B;if(os(L,D,n)||p&&_o(L,n)&&_o(D,n)){C=B;continue}const ee=M.vertexLength;$n(this.vertexArray,L,D,1,1,q),$n(this.vertexArray,L,D,1,0,q),$n(this.vertexArray,L,D,0,1,W),$n(this.vertexArray,L,D,0,0,W),M.vertexLength+=4;const te=Dr(L,D,R,c);for(const Y of te)this._segmentToGroundQuads[g].push({id:ee,region:Y}),this._segmentToRegionTriCounts[g][Y]+=2,M.primitiveLength+=2;C=B}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),n=t.length;for(let c=0;c<n;c++)this._segmentToGroundQuads[c].sort((p,h)=>p.region-h.region);for(let c=0;c<n;c++){const p=this._segmentToGroundQuads[c],h=t[c],g=this._segmentToRegionTriCounts[c];g.reduce((C,P)=>C+P,0);let M=0;for(let C=0;C<=4;C++){const P=g[C];if(P!==0){let b=this.regionSegments[C];b||(b=this.regionSegments[C]=new bs);const L={vertexOffset:h.vertexOffset,primitiveOffset:h.primitiveOffset+M,vertexLength:h.vertexLength,primitiveLength:P};b.get().push(L)}M+=P}for(let C=0;C<p.length;C++){const P=p[C].id;this.indexArray.emplaceBack(P,P+1,P+3),this.indexArray.emplaceBack(P,P+3,P+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,n,c,p,h,g){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,n,c,p,h,g)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,qm.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,n,c,p,h,g,M){this.hasData()&&this.programConfigurations.updatePaintArrays(t,n,c,p,h,g,M)}updateHiddenByLandmark(t){if(!this.hasData())return;const n=t.groundVertexCount+t.groundVertexArrayOffset;if(t.groundVertexCount===0)return;const c=t.flags&Vi?1:0;for(let p=t.groundVertexArrayOffset;p<n;++p)this.hiddenByLandmarkVertexArray.emplace(p,c);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,e.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const n=this.regionSegments[t];n&&n.destroy()}}}}class Or{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.pixelRatio=t.pixelRatio,this.layerIds=this.layers.map(n=>n.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new uo,this.footprintVertices=new du,this.footprintSegments=[],this.layoutVertexArray=new Wl,this.centroidVertexArray=new ll,this.wallVertexArray=new Af,this.indexArray=new uo,this.programConfigurations=new Yl(t.layers,{zoom:t.zoom,lut:t.lut},n=>la.includes(n)),this.segments=new bs,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new Qr(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(t,n){}populate(t,n,c,p){this.features=[],this.hasPattern=Cp("fill-extrusion",this.layers,this.pixelRatio,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=i(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:h,id:g,index:M,sourceLayerIndex:C}of t){const P=this.layers[0]._featureFilter.needGeometry,b=Z(h,P);if(!this.layers[0]._featureFilter.filter(new Ka(this.zoom),b,c))continue;const L={id:g,sourceLayerIndex:C,index:M,geometry:P?b.geometry:j(h,c,p),properties:h.properties,type:h.type,patterns:{}},D=this.layoutVertexArray.length,A=Zr[L.type]==="Polygon";if(this.hasPattern)this.features.push(Of("fill-extrusion",this.layers,L,this.zoom,this.pixelRatio,n));else if(this.wallMode)for(const R of L.geometry)for(const B of kr(R,A))this.addFeature(L,[B],M,c,{},n.availableImages,p,n.brightness);else this.addFeature(L,L.geometry,M,c,{},n.availableImages,p,n.brightness);n.featureIndex.insert(h,L.geometry,M,C,this.index,D)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,n,c,p,h,g){for(const M of this.features){const C=Zr[M.type]==="Polygon",{geometry:P}=M;if(this.wallMode)for(const b of P)for(const L of kr(b,C))this.addFeature(M,[L],M.index,n,c,p,h,g);else this.addFeature(M,P,M.index,n,c,p,h,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,n,c,p,h,g,M){this.programConfigurations.updatePaintArrays(t,n,h,c,p,g,M),this.groundEffect.update(t,n,h,c,p,g,M)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,_),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.wallVertexBuffer=t.createVertexBuffer(this.wallVertexArray,E.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,l.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Rp.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,c,p,h,g,M,C){const P=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,b=[new Pi(0,0),new Pi(vn,vn)],L=M.projection,D=L.name==="globe",A=this.wallMode||Zr[t.type]==="Polygon",R=new Ln;R.centroidDataIndex=this.centroidData.length;const B=new Oi,q=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},p)<=0,W=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},p);let ee;if(B.height=W,B.vertexArrayOffset=this.layoutVertexArray.length,B.groundVertexArrayOffset=this.groundEffect.vertexArray.length,D&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Sc),this.wallMode){if(D)return void Xn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(n.length!==1)return;ee=function(Pe){const nt=Pe[0].x===Pe[Pe.length-1].x&&Pe[0].y===Pe[Pe.length-1].y;(function(tn){let qi=0;const nr=tn.length;for(let Fn=0;Fn<nr;Fn++)qi+=(tn[(Fn+1)%nr].x-tn[Fn].x)*(tn[(Fn+1)%nr].y+tn[Fn].y);return qi>=0})(Pe)||(Pe=Pe.reverse());const lt={geometry:[],joinNormals:[],indices:[]},_t=[],dt=[],xt=[];let Ct=Pe.length;for(;Ct>=2&&Pe[Ct-1].equals(Pe[Ct-2]);)Ct--;if(Ct<(nt?3:2))return lt;let Nt,wt,gi,Ui,mi,Dn=0;for(;Dn<Ct-1&&Pe[Dn].equals(Pe[Dn+1]);)Dn++;nt&&(Nt=Pe[Ct-2],mi=Pe[Dn].sub(Nt)._unit()._perp());for(let tn=Dn;tn<Ct;tn++){if(gi=tn===Ct-1?nt?Pe[Dn+1]:void 0:Pe[tn+1],gi&&Pe[tn].equals(gi))continue;mi&&(Ui=mi),Nt&&(wt=Nt),Nt=Pe[tn],mi=gi?gi.sub(Nt)._unit()._perp():Ui,Ui=Ui||mi;let qi=Ui.add(mi);qi.x===0&&qi.y===0||qi._unit();const nr=qi.x*mi.x+qi.y*mi.y,Fn=nr!==0?1/nr:1/0,Hn=Ui.x*mi.y-Ui.y*mi.x>0;let zr="miter";const Yr=2;zr==="miter"&&Fn>Yr&&(zr="bevel"),zr==="bevel"&&(Fn>100&&(zr="flipbevel"),Fn<Yr&&(zr="miter"));const ta=(ia,ma,va,vs)=>{const rs=new Pi(ia.x,ia.y),Vr=new Pi(ia.x,ia.y);rs.x+=ma.x*vs,rs.y+=ma.y*vs,Vr.x-=ma.x*Math.max(va,1),Vr.y-=ma.y*Math.max(va,1),xt.push(ma),_t.push(rs),dt.push(Vr)};if(zr==="miter")qi._mult(Fn),ta(Nt,qi,0,0);else if(zr==="flipbevel")qi=mi.mult(-1),ta(Nt,qi,0,0),ta(Nt,qi.mult(-1),0,0);else{const ia=-Math.sqrt(Fn*Fn-1),ma=Hn?ia:0,va=Hn?0:ia;wt&&ta(Nt,Ui,ma,va),gi&&ta(Nt,mi,ma,va)}}lt.geometry=[..._t,...dt.reverse(),_t[0]],lt.joinNormals=[...xt,...xt.reverse(),xt[xt.length-1]];const Mn=lt.geometry.length-1;for(let tn=0;tn<Mn/2;tn++)if(tn+1<Mn/2){let qi=tn,nr=tn+1,Fn=Mn-1-tn,Hn=Mn-2-tn;qi=qi===0?Mn-1:qi-1,nr=nr===0?Mn-1:nr-1,Fn=Fn===0?Mn-1:Fn-1,Hn=Hn===0?Mn-1:Hn-1,lt.indices.push(Fn),lt.indices.push(nr),lt.indices.push(qi),lt.indices.push(Fn),lt.indices.push(Hn),lt.indices.push(nr)}return lt}(n[0]),n=[ee.geometry]}const te=(Pe,nt)=>Pe<(nt.length-1)/2||Pe===nt.length-1,Y=this.wallMode?[n]:zc(n,500);for(let Pe=Y.length-1;Pe>=0;Pe--){const nt=Y[Pe];(nt.length===0||(re=nt[0]).every(Ue=>Ue.x<=0)||re.every(Ue=>Ue.x>=vn)||re.every(Ue=>Ue.y<=0)||re.every(Ue=>Ue.y>=vn))&&Y.splice(Pe,1)}var re;let ce;if(D)ce=Tu(Y,b,p);else{ce=[];for(const Pe of Y)ce.push({polygon:Pe,bounds:b})}const ve=A?this.edgeRadius:0,Be=ve>0&&this.zoom<17,Oe=(Pe,nt)=>{if(Pe.length===0)return!1;const Ue=Pe[Pe.length-1];return nt.x===Ue.x&&nt.y===Ue.y};for(const{polygon:Pe,bounds:nt}of ce){let Ue=0,lt=0;for(const Ct of Pe)A&&!Ct[0].equals(Ct[Ct.length-1])&&Ct.push(Ct[0]),lt+=A?Ct.length-1:Ct.length;const _t=this.segments.prepareSegment((A?5:4)*lt,this.layoutVertexArray,this.indexArray);B.footprintSegIdx<0&&(B.footprintSegIdx=this.footprintSegments.length),B.polygonSegIdx<0&&(B.polygonSegIdx=this.polygonSegments.length);const dt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},xt=new Mt;if(xt.vertexOffset=this.footprintVertices.length,xt.indexOffset=3*this.footprintIndices.length,xt.ringIndices=[],A){const Ct=[],Nt=[];Ue=_t.vertexLength;for(let gi=0;gi<Pe.length;gi++){const Ui=Pe[gi];Ui.length&&gi!==0&&Nt.push(Ct.length/2);const mi=[];let Dn,Mn;Dn=Ui[1].sub(Ui[0])._perp()._unit(),xt.ringIndices.push(Ui.length-1);for(let tn=1;tn<Ui.length;tn++){const qi=Ui[tn],nr=Ui[tn===Ui.length-1?1:tn+1],Fn=qi.clone();if(ve){Mn=nr.sub(qi)._perp()._unit();const Hn=Dn.add(Mn)._unit(),zr=ve*Math.min(4,1/(Dn.x*Hn.x+Dn.y*Hn.y));Fn.x+=zr*Hn.x,Fn.y+=zr*Hn.y,Fn.x=Math.round(Fn.x),Fn.y=Math.round(Fn.y),Dn=Mn}if(!q||ve!==0&&!Be||Oe(mi,Fn)||mi.push(Fn),ji(this.layoutVertexArray,Fn.x,Fn.y,0,0,1,1,0),this.wallMode){const Hn=te(tn,Ui);ir(this.wallVertexArray,ee.joinNormals[tn],!Hn)}_t.vertexLength++,this.footprintVertices.emplaceBack(qi.x,qi.y),Ct.push(qi.x,qi.y),D&&$i(this.layoutVertexExtArray,L.projectTilePoint(Fn.x,Fn.y,p),L.upVector(p,Fn.x,Fn.y))}q&&(ve===0||Be)&&(mi.length!==0&&Oe(mi,mi[0])&&mi.pop(),this.groundEffect.addData(mi,nt,P))}const wt=this.wallMode?ee.indices:Mp(Ct,Nt);for(let gi=0;gi<wt.length;gi+=3)this.footprintIndices.emplaceBack(xt.vertexOffset+wt[gi+0],xt.vertexOffset+wt[gi+1],xt.vertexOffset+wt[gi+2]),this.indexArray.emplaceBack(Ue+wt[gi],Ue+wt[gi+2],Ue+wt[gi+1]),_t.primitiveLength++;xt.indexCount+=wt.length,xt.vertexCount+=this.footprintVertices.length-xt.vertexOffset}for(let Ct=0;Ct<Pe.length;Ct++){const Nt=Pe[Ct];R.startRing(B,Nt[0]);let wt=Nt.length>4&&dc(Nt[Nt.length-2],Nt[0],Nt[1]),gi=ve?Ea(Nt[Nt.length-2],Nt[0],Nt[1],ve):0;const Ui=[];let mi,Dn,Mn;Dn=Nt[1].sub(Nt[0])._perp()._unit();let tn=!0;for(let qi=1,nr=0;qi<Nt.length;qi++){let Fn=Nt[qi-1],Hn=Nt[qi];const zr=Nt[qi===Nt.length-1?1:qi+1];if(R.appendEdge(B,Hn,Fn),os(Hn,Fn,nt)){ve&&(Dn=zr.sub(Hn)._perp()._unit(),tn=!tn);continue}const Yr=Hn.sub(Fn)._perp(),ta=Yr.x/(Math.abs(Yr.x)+Math.abs(Yr.y)),ia=Yr.y>0?1:0,ma=Fn.dist(Hn);if(nr+ma>32768&&(nr=0),ve){Mn=zr.sub(Hn)._perp()._unit();let Vr=nl(Fn,Hn,zr,Ba(Dn,Mn),ve);isNaN(Vr)&&(Vr=0);const Ya=Hn.sub(Fn)._unit();Fn=Fn.add(Ya.mult(gi))._round(),Hn=Hn.add(Ya.mult(-Vr))._round(),gi=Vr,Dn=Mn,q&&this.zoom>=17&&(Oe(Ui,Fn)||Ui.push(Fn),Oe(Ui,Hn)||Ui.push(Hn))}const va=_t.vertexLength,vs=Nt.length>4&&dc(Fn,Hn,zr);let rs=of(nr,wt,tn);if(ji(this.layoutVertexArray,Fn.x,Fn.y,ta,ia,0,0,rs),ji(this.layoutVertexArray,Fn.x,Fn.y,ta,ia,0,1,rs),this.wallMode){const Vr=te(qi-1,Nt),Ya=ee.joinNormals[qi-1];ir(this.wallVertexArray,Ya,Vr),ir(this.wallVertexArray,Ya,Vr)}if(nr+=ma,rs=of(nr,vs,!tn),wt=vs,ji(this.layoutVertexArray,Hn.x,Hn.y,ta,ia,0,0,rs),ji(this.layoutVertexArray,Hn.x,Hn.y,ta,ia,0,1,rs),this.wallMode){const Vr=te(qi,Nt),Ya=ee.joinNormals[qi];ir(this.wallVertexArray,Ya,Vr),ir(this.wallVertexArray,Ya,Vr)}if(_t.vertexLength+=4,this.indexArray.emplaceBack(va+0,va+1,va+2),this.indexArray.emplaceBack(va+1,va+3,va+2),_t.primitiveLength+=2,ve){const Vr=Ue+(qi===1?Nt.length-2:qi-2),Ya=qi===1?Ue:Vr+1;if(this.indexArray.emplaceBack(va+1,Vr,va+3),this.indexArray.emplaceBack(Vr,Ya,va+3),_t.primitiveLength+=2,mi===void 0&&(mi=va),!os(zr,Nt[qi],nt)){const Ja=qi===Nt.length-1?mi:_t.vertexLength;this.indexArray.emplaceBack(va+2,va+3,Ja),this.indexArray.emplaceBack(va+3,Ja+1,Ja),this.indexArray.emplaceBack(va+3,Ya,Ja+1),_t.primitiveLength+=3}tn=!tn}if(D){const Vr=this.layoutVertexExtArray,Ya=L.projectTilePoint(Fn.x,Fn.y,p),Ja=L.projectTilePoint(Hn.x,Hn.y,p),zs=L.upVector(p,Fn.x,Fn.y),yo=L.upVector(p,Hn.x,Hn.y);$i(Vr,Ya,zs),$i(Vr,Ya,zs),$i(Vr,Ja,yo),$i(Vr,Ja,yo)}}A&&(Ue+=Nt.length-1),q&&ve&&this.zoom>=17&&(Ui.length!==0&&Oe(Ui,Ui[0])&&Ui.pop(),this.groundEffect.addData(Ui,nt,P,ve>0))}this.footprintSegments.push(xt),dt.triangleCount=this.indexArray.length-dt.triangleArrayOffset,this.polygonSegments.push(dt),++B.footprintSegLen,++B.polygonSegLen}if(B.vertexCount=this.layoutVertexArray.length-B.vertexArrayOffset,B.groundVertexCount=this.groundEffect.vertexArray.length-B.groundVertexArrayOffset,B.vertexCount!==0){if(B.centroidXY=R.borders?xn:this.encodeCentroid(R,B),this.centroidData.push(B),R.borders){this.featuresOnBorder.push(R);const Pe=this.featuresOnBorder.length-1;for(let nt=0;nt<R.borders.length;nt++)R.borders[nt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[nt].push(Pe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,h,g,p,C),this.groundEffect.addPaintPropertiesData(t,c,h,g,p,C),this.maxHeight=Math.max(this.maxHeight,W)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((n,c)=>this.featuresOnBorder[n].borders[t][0]-this.featuresOnBorder[c].borders[t][0])}splitToSubtiles(){const t=[];for(let M=0;M<this.centroidData.length;M++){const C=this.centroidData[M],P=+(C.min.y+C.max.y>vn),b=2*P+(+(C.min.x+C.max.x>vn)^P);for(let L=0;L<C.polygonSegLen;L++){const D=C.polygonSegIdx+L;t.push({centroidIdx:M,subtile:b,polygonSegmentIdx:D,triangleSegmentIdx:this.polygonSegments[D].triangleSegIdx})}}const n=new uo;t.sort((M,C)=>M.triangleSegmentIdx===C.triangleSegmentIdx?M.subtile-C.subtile:M.triangleSegmentIdx-C.triangleSegmentIdx);let c=0,p=0,h=0;for(const M of t){if(M.triangleSegmentIdx!==c)break;h++}const g=t.length;for(;p!==t.length;){c=t[p].triangleSegmentIdx;let M=0,C=p,P=p;for(let b=C;b<h&&t[b].subtile===M;b++)P++;for(;C!==h;){const b=t[C];M=b.subtile;const L=this.centroidData[b.centroidIdx].min.clone(),D=this.centroidData[b.centroidIdx].max.clone(),A={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=C;R<P;R++){const B=t[R],q=this.polygonSegments[B.polygonSegmentIdx],W=this.centroidData[B.centroidIdx].min,ee=this.centroidData[B.centroidIdx].max,te=this.indexArray.uint16;for(let Y=q.triangleArrayOffset;Y<q.triangleArrayOffset+q.triangleCount;Y++)n.emplaceBack(te[3*Y],te[3*Y+1],te[3*Y+2]);A.primitiveLength+=q.triangleCount,L.x=Math.min(L.x,W.x),L.y=Math.min(L.y,W.y),D.x=Math.max(D.x,ee.x),D.y=Math.max(D.y,ee.y)}A.primitiveLength>0&&this.triangleSubSegments.push({segment:A,min:L,max:D}),C=P;for(let R=C;R<h&&t[R].subtile===t[C].subtile;R++)P++}p=h;for(let b=p;b<g&&t[b].triangleSegmentIdx===t[p].triangleSegmentIdx;b++)h++}n._trim(),this.indexArray=n}getVisibleSegments(t,n,c){const p=new bs;if(this.wallMode){for(const B of this.triangleSubSegments)p.segments.push(B.segment);return p}let h=0,g=0;const M=1<<t.canonical.z;if(n){const B=n.getMinMaxForTile(t);B&&(h=B.min,g=B.max)}g+=this.maxHeight;const C=t.toUnwrapped();let P;const b=[C.canonical.x/M+C.wrap,C.canonical.y/M],L=[(C.canonical.x+1)/M+C.wrap,(C.canonical.y+1)/M],D=(B,q,W)=>[B[0]*(1-W[0])+q[0]*W[0],B[1]*(1-W[1])+q[1]*W[1]],A=[],R=[];for(const B of this.triangleSubSegments){A[0]=B.min.x/vn,A[1]=B.min.y/vn,R[0]=B.max.x/vn,R[1]=B.max.y/vn;const q=D(b,L,A),W=D(b,L,R);if(new In([q[0],q[1],h],[W[0],W[1],g]).intersectsPrecise(c)===0){P&&(p.segments.push(P),P=void 0);continue}const ee=B.segment;P&&P.vertexOffset!==ee.vertexOffset&&(p.segments.push(P),P=void 0),P?(P.vertexLength+=ee.vertexLength,P.primitiveLength+=ee.primitiveLength):P={vertexOffset:ee.vertexOffset,primitiveLength:ee.primitiveLength,vertexLength:ee.vertexLength,primitiveOffset:ee.primitiveOffset,sortKey:void 0,vaos:{}}}return P&&p.segments.push(P),p}encodeCentroid(t,n){const c=t.centroid(),p=n.span(),h=Math.min(7,Math.round(p.x*this.tileToMeter/10)),g=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new Pi(ii(c.x,1,vn-1)<<3|h,ii(c.y,1,vn-1)<<3|g)}encodeBorderCentroid(t){if(!t.borders)return new Pi(0,0);const n=t.borders,c=Number.MAX_VALUE;if(n[0][0]!==c||n[1][0]!==c){const p=n[0][0]!==c?0:1;return new Pi(6|(n[0][0]!==c?0:65528),(n[p][0]+n[p][1])/2<<3|6)}{const p=n[2][0]!==c?2:3;return new Pi((n[p][0]+n[p][1])/2<<3|6,6|(n[2][0]!==c?0:65528))}}showCentroid(t){const n=this.centroidData[t.centroidDataIndex];n.flags&=Vi,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const n=t.vertexArrayOffset,c=t.vertexCount+t.vertexArrayOffset,p=t.flags&Vi?xn:t.centroidXY,h=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==p.y||h!==p.x){for(let g=n;g<c;++g)this.centroidVertexArray.emplace(g,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,n,c){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const p=n.getReplacementRegionsForTile(t.toUnwrapped());if(Bi(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const g of this.centroidData)g.flags&=2147483647;const h=[];for(const g of this.activeReplacements){if(g.order<c)continue;const M=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-t.canonical.z));for(const C of this.centroidData)if(!(C.flags&Vi||g.min.x>C.max.x||C.min.x>g.max.x||g.min.y>C.max.y||C.min.y>g.max.y))for(let P=0;P<C.footprintSegLen;P++){const b=this.footprintSegments[C.footprintSegIdx+P];if(h.length=0,Qc(this.footprintVertices,b.vertexOffset,b.vertexCount,g.footprintTileId.canonical,t.canonical,h),Gn(g.footprint,h,this.footprintIndices.uint16,b.indexOffset,b.indexCount,-b.vertexOffset,-M)){C.flags|=Vi;break}}}for(const g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,n,c){let p=!1;for(let h=0;h<c.footprintSegLen;h++){const g=this.footprintSegments[c.footprintSegIdx+h];let M=0;for(const C of g.ringIndices){for(let P=M,b=C+M-1;P<C+M;b=P++){const L=this.footprintVertices.int16[2*(P+g.vertexOffset)+0],D=this.footprintVertices.int16[2*(P+g.vertexOffset)+1],A=this.footprintVertices.int16[2*(b+g.vertexOffset)+1];D>n!=A>n&&t<(this.footprintVertices.int16[2*(b+g.vertexOffset)+0]-L)*(n-D)/(A-D)+L&&(p=!p)}M=C}}return p}getHeightAtTileCoord(t,n){let c=Number.NEGATIVE_INFINITY,p=!0;const h=4*(t+vn)*vn+(n+vn);if(this.partLookup.hasOwnProperty(h)){const g=this.partLookup[h];return g?{height:g.height,hidden:!!(g.flags&Vi)}:void 0}for(const g of this.centroidData)t>g.max.x||g.min.x>t||n>g.max.y||g.min.y>n||this.footprintContainsPoint(t,n,g)&&g&&g.height>c&&(c=g.height,this.partLookup[h]=g,p=!!(g.flags&Vi));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:p};this.partLookup[h]=void 0}}function Ba(s,t){const n=s.add(t)._unit();return s.x*n.x+s.y*n.y}function Ea(s,t,n,c){const p=t.sub(s)._perp()._unit(),h=n.sub(t)._perp()._unit();return nl(s,t,n,Ba(p,h),c)}function nl(s,t,n,c,p){const h=Math.sqrt(1-c*c);return Math.min(s.dist(t)/3,t.dist(n)/3,p*h/c)}function os(s,t,n){return s.x<n[0].x&&t.x<n[0].x||s.x>n[1].x&&t.x>n[1].x||s.y<n[0].y&&t.y<n[0].y||s.y>n[1].y&&t.y>n[1].y}function _o(s,t){return s.x<t[0].x||s.x>t[1].x||s.y<t[0].y||s.y>t[1].y}function dc(s,t,n){if(s.x<0||s.x>=vn||t.x<0||t.x>=vn||n.x<0||n.x>=vn)return!1;const c=n.sub(t),p=c.perp(),h=s.sub(t);return(c.x*h.x+c.y*h.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(h.x*h.x+h.y*h.y))>-.866&&p.x*h.x+p.y*h.y<0}function of(s,t,n){const c=t?2|s:-3&s;return n?1|c:-2&c}function Jc(){const s=Math.PI/32,t=Math.tan(s),n=So;return n*Math.sqrt(1+2*t*t)-n}function Tu(s,t,n){const c=1<<n.z,p=ho(n.x/c),h=ho((n.x+1)/c),g=Is(n.y/c),M=Is((n.y+1)/c);return function(C,P,b,L,D=0,A){const R=[];if(!C.length||!b||!L)return R;const B=(ce,ve)=>{for(const Be of ce)R.push({polygon:Be,bounds:ve})},q=Math.ceil(Math.log2(b)),W=Math.ceil(Math.log2(L)),ee=q-W,te=[];for(let ce=0;ce<Math.abs(ee);ce++)te.push(ee>0?0:1);for(let ce=0;ce<Math.min(q,W);ce++)te.push(0),te.push(1);let Y=C;if(Y=$e(Y,P[0].y-D,P[1].y+D,1),Y=$e(Y,P[0].x-D,P[1].x+D,0),!Y.length)return R;const re=[];for(te.length?re.push({polygons:Y,bounds:P,depth:0}):B(Y,P);re.length;){const ce=re.pop(),ve=ce.depth,Be=te[ve],Oe=ce.bounds[0],Pe=ce.bounds[1],nt=Be===0?Oe.x:Oe.y,Ue=Be===0?Pe.x:Pe.y,lt=A?A(Be,nt,Ue):.5*(nt+Ue),_t=$e(ce.polygons,nt-D,lt+D,Be),dt=$e(ce.polygons,lt-D,Ue+D,Be);if(_t.length){const xt=[Oe,new Pi(Be===0?lt:Pe.x,Be===1?lt:Pe.y)];te.length>ve+1?re.push({polygons:_t,bounds:xt,depth:ve+1}):B(_t,xt)}if(dt.length){const xt=[new Pi(Be===0?lt:Oe.x,Be===1?lt:Oe.y),Pe];te.length>ve+1?re.push({polygons:dt,bounds:xt,depth:ve+1}):B(dt,xt)}}return R}(s,t,Math.ceil((h-p)/11.25),Math.ceil((g-M)/11.25),1,(C,P,b)=>{if(C===0)return .5*(P+b);{const L=Is((n.y+P/vn)/c);return(Pl(.5*(Is((n.y+b/vn)/c)+L))*c-n.y)*vn}})}function Qc(s,t,n,c,p,h){const g=Math.pow(2,c.z-p.z);for(let M=0;M<n;M++){let C=s.int16[2*(M+t)+0],P=s.int16[2*(M+t)+1];C=(C+p.x*vn)*g-c.x*vn,P=(P+p.y*vn)*g-c.y*vn,h.push(new Pi(C,P))}}let bl,er;function lf(s,t){return s.x*t.x+s.y*t.y}function sp(s,t){if(s.length===1){let n=0;const c=t[n++];let p;for(;!p||c.equals(p);)if(p=t[n++],!p)return 1/0;for(;n<t.length;n++){const h=t[n],g=s[0],M=p.sub(c),C=h.sub(c),P=g.sub(c),b=lf(M,M),L=lf(M,C),D=lf(C,C),A=lf(P,M),R=lf(P,C),B=b*D-L*L,q=(D*A-L*R)/B,W=(b*R-L*A)/B,ee=c.z*(1-q-W)+p.z*q+h.z*W;if(isFinite(ee))return ee}return 1/0}{let n=1/0;for(const c of t)n=Math.min(n,c.z);return n}}function fc(s,t,n,c,p,h,g,M){const C=g*p.getElevationAt(s,t,!0,!0),P=h[0]!==0,b=P?h[1]===0?g*(h[0]/7-450):g*function(L,D,A){const R=Math.floor(D[0]/8),B=Math.floor(D[1]/8),q=10*(D[0]-8*R),W=10*(D[1]-8*B),ee=L.getElevationAt(R,B,!0,!0),te=L.getMeterToDEM(A),Y=Math.floor(.5*(q*te-1)),re=Math.floor(.5*(W*te-1)),ce=L.tileCoordToPixel(R,B),ve=2*Y+1,Be=2*re+1,Oe=function(dt,xt,Ct,Nt,wt){return[dt.getElevationAtPixel(xt,Ct,!0),dt.getElevationAtPixel(xt+wt,Ct,!0),dt.getElevationAtPixel(xt,Ct+wt,!0),dt.getElevationAtPixel(xt+Nt,Ct+wt,!0)]}(L,ce.x-Y,ce.y-re,ve,Be),Pe=Math.abs(Oe[0]-Oe[1]),nt=Math.abs(Oe[2]-Oe[3]),Ue=Math.abs(Oe[0]-Oe[2])+Math.abs(Oe[1]-Oe[3]),lt=Math.min(.25,.5*te*(Pe+nt)/ve),_t=Math.min(.25,.5*te*Ue/Be);return ee+Math.max(lt*q,_t*W)}(p,h,M):C;return{base:C+(n===0?-1:n),top:P?Math.max(b+c,C+n+2):C+c}}kn(Or,"FillExtrusionBucket",{omit:["layers","features"]}),kn(Oi,"PartData"),kn(Mt,"FootprintSegment"),kn(Ln,"BorderCentroidData"),kn(Qr,"GroundEffect");const um=Ta([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Sm=Ta([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:hm}=um,Ff=Ta([{name:"a_packed",components:3,type:"Float32"}]),{members:Em}=Ff,Am=Ta([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:kf}=Am;class op{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.image=new xd({width:t,height:n}),this.positions={},this.uploaded=!1}getDash(t,n){const c=this.getKey(t,n);return this.positions[c]}trim(){const t=this.width,n=this.height=mr(this.nextRow);this.image.resize({width:t,height:n})}getKey(t,n){return t.join(",")+n}getDashRanges(t,n,c){const p=[];let h=t.length%2==1?-t[t.length-1]*c:0,g=t[0]*c,M=!0;p.push({left:h,right:g,isDash:M,zeroLength:t[0]===0});let C=t[0];for(let P=1;P<t.length;P++){M=!M;const b=t[P];h=C*c,C+=b,g=C*c,p.push({left:h,right:g,isDash:M,zeroLength:b===0})}return p}addRoundDash(t,n,c){const p=n/2;for(let h=-c;h<=c;h++){const g=this.width*(this.nextRow+c+h);let M=0,C=t[M];for(let P=0;P<this.width;P++){P/C.right>1&&(C=t[++M]);const b=Math.abs(P-C.left),L=Math.abs(P-C.right),D=Math.min(b,L);let A;const R=h/c*(p+1);if(C.isDash){const B=p-Math.abs(R);A=Math.sqrt(D*D+B*B)}else A=p-Math.sqrt(D*D+R*R);this.image.data[g+P]=Math.max(0,Math.min(255,A+128))}}}addRegularDash(t,n){for(let C=t.length-1;C>=0;--C){const P=t[C],b=t[C+1];P.zeroLength?t.splice(C,1):b&&b.isDash===P.isDash&&(b.left=P.left,t.splice(C,1))}const c=t[0],p=t[t.length-1];c.isDash===p.isDash&&(c.left=p.left-this.width,p.right=c.right+this.width);const h=this.width*this.nextRow;let g=0,M=t[g];for(let C=0;C<this.width;C++){C/M.right>1&&(M=t[++g]);const P=Math.abs(C-M.left),b=Math.abs(C-M.right),L=Math.min(P,b);this.image.data[h+C]=Math.max(0,Math.min(255,(M.isDash?L:-L)+n+128))}}addDash(t,n){const c=this.getKey(t,n);if(this.positions[c])return this.positions[c];const p=n==="round",h=p?7:0,g=2*h+1;if(this.nextRow+g>this.height)return Xn("LineAtlas out of space"),null;t.length===0&&t.push(1);let M=0;for(let b=0;b<t.length;b++)t[b]<0&&(Xn("Negative value is found in line dasharray, replacing values with 0"),t[b]=0),M+=t[b];if(M!==0){const b=this.width/M,L=this.getDashRanges(t,this.width,b);p?this.addRoundDash(L,b,h):this.addRegularDash(L,n==="square"?.5*b:0)}const C=this.nextRow+h;this.nextRow+=g;const P={tl:[C,h],br:[M,0]};return this.positions[c]=P,P}}kn(op,"LineAtlas");const Ip=ye.VectorTileFeature.types,lp=Math.cos(Math.PI/180*37.5),Wm=Math.cos(Math.PI/180*5);class Sd{constructor(t){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=t.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=t.overscaling,this.pixelRatio=t.pixelRatio,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Tc,this.layoutVertexArray2=new jc,this.patternVertexArray=new jc,this.indexArray=new uo,this.programConfigurations=new Yl(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new bs,this.maxLineLength=0,this.zOffsetVertexArray=new jc,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=t.tessellationStep?t.tessellationStep:vn/64}updateFootprints(t,n){}populate(t,n,c,p){this.hasPattern=Cp("line",this.layers,this.pixelRatio,n);const h=this.layers[0].layout.get("line-sort-key");this.tileToMeter=i(c);const g=this.layers[0].layout.get("line-z-offset"),M=g.isConstant()&&!g.constantOr(0),C=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=C==="sea"||C==="ground"||!M&&C==="none",this.hasZOffset&&C==="none"&&Xn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const P=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&P!==void 0;const b=[];for(const{feature:R,id:B,index:q,sourceLayerIndex:W}of t){const ee=this.layers[0]._featureFilter.needGeometry,te=Z(R,ee);if(!this.layers[0]._featureFilter.filter(new Ka(this.zoom),te,c))continue;const Y=h?h.evaluate(te,{},c):void 0,re={id:B,properties:R.properties,type:R.type,sourceLayerIndex:W,index:q,geometry:ee?te.geometry:j(R,c,p),patterns:{},sortKey:Y};b.push(re)}h&&b.sort((R,B)=>R.sortKey-B.sortKey);const{lineAtlas:L,featureIndex:D}=n,A=this.addConstantDashes(L);for(const R of b){const{geometry:B,index:q,sourceLayerIndex:W}=R;if(A&&this.addFeatureDashes(R,L),this.hasPattern){const ee=Of("line",this.layers,R,this.zoom,this.pixelRatio,n);this.patternFeatures.push(ee)}else this.addFeature(R,B,q,c,L.positions,n.availableImages,n.brightness);D.insert(t[q].feature,B,q,W,this.index)}}addConstantDashes(t){let n=!1;for(const c of this.layers){const p=c.paint.get("line-dasharray").value,h=c.layout.get("line-cap").value;if(p.kind!=="constant"||h.kind!=="constant")n=!0;else{const g=h.value,M=p.value;if(!M)continue;t.addDash(M,g)}}return n}addFeatureDashes(t,n){const c=this.zoom;for(const p of this.layers){const h=p.paint.get("line-dasharray").value,g=p.layout.get("line-cap").value;if(h.kind==="constant"&&g.kind==="constant")continue;let M,C;if(h.kind==="constant"){if(M=h.value,!M)continue}else M=h.evaluate({zoom:c},t);C=g.kind==="constant"?g.value:g.evaluate({zoom:c},t),n.addDash(M,C),t.patterns[p.id]=n.getKey(M,C)}}update(t,n,c,p,h,g,M){this.programConfigurations.updatePaintArrays(t,n,h,c,p,g,M)}addFeatures(t,n,c,p,h,g){for(const M of this.patternFeatures)this.addFeature(M,M.geometry,M.index,n,c,p,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Em)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=t.createVertexBuffer(this.patternVertexArray,kf)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,Sm.members,!0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hm),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,c,p,h,g,M){const C=this.layers[0].layout,P=C.get("line-join").evaluate(t,{}),b=C.get("line-cap").evaluate(t,{}),L=C.get("line-miter-limit"),D=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(t),this.lineFeature=t,this.zOffsetValue=C.get("line-z-offset").value;const A=this.layers[0].paint.get("line-width").value;A.kind!=="constant"&&A.isLineProgressConstant===!1&&(this.variableWidthValue=A);for(const R of n)this.addLine(R,t,p,P,b,L,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,h,g,p,M)}addLine(t,n,c,p,h,g,M){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const C=p==="none";if(this.patternJoinNone=this.hasPattern&&C,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let te=0;te<t.length-1;te++)this.totalDistance+=t[te].dist(t[te+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P=Ip[n.type]==="Polygon";let b=t.length;for(;b>=2&&t[b-1].equals(t[b-2]);)b--;let L=0;for(;L<b-1&&t[L].equals(t[L+1]);)L++;if(b<(P?3:2))return;p==="bevel"&&(g=1.05);const D=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let A,R,B,q,W,ee;this.e1=this.e2=-1,P&&(A=t[b-2],W=t[L].sub(A)._unit()._perp());for(let te=L;te<b;te++){if(B=te===b-1?P?t[L+1]:void 0:t[te+1],B&&t[te].equals(B))continue;W&&(q=W),A&&(R=A),A=t[te],ee=this.evaluateLineProgressFeatures(R?R.dist(A):0),W=B?B.sub(A)._unit()._perp():q,q=q||W;const Y=R&&B;let re=Y?p:P||C?"butt":h;const ce=q.x*W.x+q.y*W.y;if(C){const _t=function(dt){if(dt.patternJoinNone){const xt=dt.segmentPoints.length/2,Ct=dt.lineSoFar-dt.segmentStart;for(let Nt=0;Nt<xt;++Nt){const wt=dt.segmentPoints[2*Nt+1],gi=Math.round(dt.segmentPoints[2*Nt])+.5+.25*wt;dt.patternVertexArray.emplaceBack(gi,Ct,dt.segmentStart),dt.patternVertexArray.emplaceBack(gi,Ct,dt.segmentStart)}dt.segmentPoints.length=0}dt.e1=dt.e2=-1};if(Y&&ce<Wm){this.updateDistance(R,A),this.addCurrentVertex(A,q,1,1,D,ee),_t(this),this.addCurrentVertex(A,W,-1,-1,D,ee);continue}if(R){if(!B){this.updateDistance(R,A),this.addCurrentVertex(A,q,1,1,D,ee),_t(this);continue}re="miter"}}let ve=q.add(W);ve.x===0&&ve.y===0||ve._unit();const Be=ve.x*W.x+ve.y*W.y,Oe=Be!==0?1/Be:1/0,Pe=2*Math.sqrt(2-2*Be),nt=Be<lp&&R&&B,Ue=q.x*W.y-q.y*W.x>0,lt=this.overscaling<=16?15*vn/(512*this.overscaling):0;if(Y&&re==="round"){if(Oe<M)re="miter";else if(Oe<=2){const _t=$p(A,-10,vn+10);re=this.hasZOffset&&(_t||this.hasCrossSlope)?"miter":"fakeround"}}if(re==="miter"&&Oe>g&&(re="bevel"),re==="bevel"&&(Oe>2&&(re="flipbevel"),Oe<g&&(re="miter")),R&&!(re==="miter"&&nt)&&this.updateDistance(R,A),re==="miter")if(nt){const _t=A.dist(R);if(_t>2*lt){const xt=A.sub(A.sub(R)._mult(lt/_t)._round());this.updateDistance(R,xt),this.addCurrentVertex(xt,q,0,0,D,ee),R=xt}this.updateDistance(R,A),ve._mult(Oe),this.addCurrentVertex(A,ve,0,0,D,ee);const dt=A.dist(B);if(dt>2*lt){const xt=A.add(B.sub(A)._mult(lt/dt)._round());this.updateDistance(A,xt),this.addCurrentVertex(xt,W,0,0,D,ee),A=xt}}else ve._mult(Oe),this.addCurrentVertex(A,ve,0,0,D,ee);else if(re==="flipbevel"){if(Oe>100)ve=W.mult(-1);else{const _t=Oe*q.add(W).mag()/q.sub(W).mag();ve._perp()._mult(_t*(Ue?-1:1))}this.addCurrentVertex(A,ve,0,0,D,ee),this.addCurrentVertex(A,ve.mult(-1),0,0,D,ee)}else if(re==="bevel"||re==="fakeround"){ee!=null&&R&&this.addCurrentVertex(A,q,-1,-1,D,ee);const _t=A.dist(R)<=2*lt&&re!=="bevel",dt=ve.mult(Ue?1:-1);dt._mult(Oe);const xt=W.mult(Ue?-1:1),Ct=q.mult(Ue?-1:1),Nt=this.evaluateLineProgressFeatures(this.distance);if(ee==null&&(this.addHalfVertex(A,dt.x,dt.y,!1,!Ue,0,D,Nt),_t||this.addHalfVertex(A,dt.x+2*Ct.x,dt.y+2*Ct.y,!1,Ue,0,D,Nt)),re==="fakeround"){const wt=Math.round(180*Pe/Math.PI/20);this.addHalfVertex(A,Ct.x,Ct.y,!1,Ue,0,D,Nt);for(let gi=0;gi<wt;gi++){let Ui=gi/wt;if(Ui!==.5){const Dn=Ui-.5;Ui+=Ui*Dn*(Ui-1)*((1.0904+ce*(ce*(3.55645-1.43519*ce)-3.2452))*Dn*Dn+(.848013+ce*(.215638*ce-1.06021)))}const mi=xt.sub(Ct)._mult(Ui)._add(Ct)._unit();this.addHalfVertex(A,mi.x,mi.y,!1,Ue,0,D,Nt)}this.addHalfVertex(A,xt.x,xt.y,!1,Ue,0,D,Nt)}_t||ee!=null||this.addHalfVertex(A,dt.x+2*xt.x,dt.y+2*xt.y,!1,Ue,0,D,Nt),ee!=null&&B&&this.addCurrentVertex(A,W,1,1,D,ee)}else re==="butt"?this.addCurrentVertex(A,ve,0,0,D,ee):re==="square"?(R||this.addCurrentVertex(A,ve,-1,-1,D,ee),this.addCurrentVertex(A,ve,0,0,D,ee),R&&this.addCurrentVertex(A,ve,1,1,D,ee)):re==="round"&&(R&&(this.addCurrentVertex(A,q,0,0,D,ee),this.addCurrentVertex(A,q,1,1,D,ee,!0)),B&&(this.addCurrentVertex(A,W,-1,-1,D,ee,!0),this.addCurrentVertex(A,W,0,0,D,ee)))}}addVerticesTo(t,n,c,p,h,g,M,C,P,b){const L=(n.w-t.w)/this.tessellationStep|0;let D=0;const A=this.scaledDistance;if(L>1){this.lineSoFar=t.w;const B=(n.x-t.x)/L,q=(n.y-t.y)/L,W=(n.z-t.z)/L,ee=(n.w-t.w)/L;for(let te=1;te<L;++te){t.x+=B,t.y+=q,t.z+=W,this.lineSoFar+=ee,D+=ee;const Y=this.evaluateLineProgressFeatures(this.prevDistance+D);this.scaledDistance=(this.prevDistance+D)/this.totalDistance,this.addHalfVertex(t,c,p,b,!1,M,P,Y),this.addHalfVertex(t,h,g,b,!0,-C,P,Y)}}this.lineSoFar=n.w,this.scaledDistance=A;const R=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(n,c,p,b,!1,M,P,R),this.addHalfVertex(n,h,g,b,!0,-C,P,R)}evaluateLineProgressFeatures(t){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+t)/this.totalFeatureLength):Xn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let n=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(n=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:n}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:n}:{zOffset:0,variableWidth:n}}addCurrentVertex(t,n,c,p,h,g,M=!1){const C=n.x+n.y*c,P=n.y-n.x*c,b=n.y*p-n.x,L=-n.y-n.x*p;if(g!=null){const D=this.hasZOffset,A=-10,R=vn+10,B=g.zOffset,q=new _e(t.x,t.y,B,this.lineSoFar),W=!!D&&$p(t,A,R),ee=this.lineSoFar,te=this.distance;if(this.currentVertex)if(W){const Y=this.currentVertexIsOutside,re=this.currentVertex,ce=new _e(t.x,t.y,B,this.lineSoFar);if(ot(re,ce,A,R),!$p(ce,A,R)){if(Y){this.e1=this.e2=-1,this.distance-=re.dist(q),this.lineSoFar=re.w;const ve=this.evaluateLineProgressFeatures(re.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(re,C,P,M,!1,c,h,ve),this.addHalfVertex(re,b,L,M,!0,-p,h,ve),this.prevDistance=this.distance}this.distance=this.prevDistance+re.dist(ce),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(re,ce,C,P,b,L,c,p,h,M),this.distance=te,this.scaledDistance=this.distance/this.totalDistance}}else{const Y=this.currentVertex;if(this.currentVertexIsOutside){ot(Y,q,A,R),this.e1=this.e2=-1,this.distance-=Y.dist(q),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Y.w;const re=this.evaluateLineProgressFeatures(Y.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Y,C,P,M,!1,c,h,re),this.addHalfVertex(Y,b,L,M,!0,-p,h,re),this.prevDistance=this.distance,this.distance=te,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Y,q,C,P,b,L,c,p,h,M)}else W||(this.addHalfVertex(t,C,P,M,!1,c,h,g),this.addHalfVertex(t,b,L,M,!0,-p,h,g));this.currentVertex=q,this.currentVertexIsOutside=W,this.lineSoFar=ee}else this.addHalfVertex(t,C,P,M,!1,c,h,g),this.addHalfVertex(t,b,L,M,!0,-p,h,g)}addHalfVertex({x:t,y:n},c,p,h,g,M,C,P){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,M)),this.layoutVertexArray.emplaceBack((t<<1)+(h?1:0),(n<<1)+(g?1:0),Math.round(63*c)+128,Math.round(63*p)+128,1+(M===0?0:M<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const L=Ee(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,L)}const b=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,b),C.primitiveLength++),g?this.e2=b:this.e1=b,P!=null&&this.zOffsetVertexArray.emplaceBack(P.zOffset,P.variableWidth,P.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(t,n){this.prevDistance=this.distance,this.distance+=t.dist(n),this.updateScaledDistance()}}function $p(s,t,n){return s.x<t||s.x>n||s.y<t||s.y>n}let Kp,zt;function _n(s,t,n){return t*(vn/(s.tileSize*Math.pow(2,n-s.tileID.overscaledZ)))}kn(Sd,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Ni=(s,t,n)=>(1-n)*s+n*t;function pn(s,t){return 1/_n(s,1,t.tileZoom)}function Qn(s,t,n,c){return s.translatePosMatrix(c||t.tileID.projMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const ya=s=>{const t=[];Xr(s)&&t.push("RENDER_LINE_DASH"),s.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const n=s.paint.get("line-trim-offset");n[0]===0&&n[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),s.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER");const c=s.layout.get("line-join").constantOr("miter")==="none",p=!!s.paint.get("line-pattern").constantOr(1);return c&&p&&t.push("LINE_JOIN_NONE"),t};function Xr(s){const t=s.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}let Aa;const Ga=()=>Aa||(Aa={layout:Kp||(Kp=new ss({"line-cap":new Pn(Ht.layout_line["line-cap"]),"line-join":new Pn(Ht.layout_line["line-join"]),"line-miter-limit":new Ri(Ht.layout_line["line-miter-limit"]),"line-round-limit":new Ri(Ht.layout_line["line-round-limit"]),"line-sort-key":new Pn(Ht.layout_line["line-sort-key"]),"line-z-offset":new Pn(Ht.layout_line["line-z-offset"]),"line-elevation-reference":new Ri(Ht.layout_line["line-elevation-reference"]),"line-cross-slope":new Ri(Ht.layout_line["line-cross-slope"]),visibility:new Ri(Ht.layout_line.visibility),"line-width-unit":new Ri(Ht.layout_line["line-width-unit"])})),paint:zt||(zt=new ss({"line-opacity":new Pn(Ht.paint_line["line-opacity"]),"line-color":new Pn(Ht.paint_line["line-color"]),"line-translate":new Ri(Ht.paint_line["line-translate"]),"line-translate-anchor":new Ri(Ht.paint_line["line-translate-anchor"]),"line-width":new Pn(Ht.paint_line["line-width"]),"line-gap-width":new Pn(Ht.paint_line["line-gap-width"]),"line-offset":new Pn(Ht.paint_line["line-offset"]),"line-blur":new Pn(Ht.paint_line["line-blur"]),"line-dasharray":new Pn(Ht.paint_line["line-dasharray"]),"line-pattern":new Pn(Ht.paint_line["line-pattern"]),"line-gradient":new Hc(Ht.paint_line["line-gradient"]),"line-trim-offset":new Ri(Ht.paint_line["line-trim-offset"]),"line-trim-fade-range":new Ri(Ht.paint_line["line-trim-fade-range"]),"line-trim-color":new Ri(Ht.paint_line["line-trim-color"]),"line-emissive-strength":new Ri(Ht.paint_line["line-emissive-strength"]),"line-border-width":new Pn(Ht.paint_line["line-border-width"]),"line-border-color":new Pn(Ht.paint_line["line-border-color"]),"line-occlusion-opacity":new Ri(Ht.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},Aa);class Ds extends Pn{possiblyEvaluate(t,n){return n=new Ka(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,c,p){return n=cr({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,c,p)}}let Wa;function Ha(s,t){return t>0?t+2*s:s}const La=Ta([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ed=Ta([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Bs=Ta([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ta([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const pc=Ta([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),wl=Ta([{name:"a_texb",components:2,type:"Uint16"}]),nh=Ta([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Su=Ta([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Ta([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ys=Ta([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Nh=Ta([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ta([{name:"triangle",components:3,type:"Uint16"}]),Ta([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ta([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Ta([{type:"Float32",name:"offsetX"}]),Ta([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var hs=24;const ao=128;function eu(s,t,n,c,p){if(s.kind==="camera")return s.maxSize;if(s.kind==="composite"){const h=t.possiblyEvaluate(new Ka(s.maxZoom),n).evaluate(p,{},n),g=t.possiblyEvaluate(new Ka(s.minZoom),n).evaluate(p,{},n);return Math.max(h,g)}return t.possiblyEvaluate(new Ka(c)).evaluate(p,{},n)}function Cm(s,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Ka(s+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:p}=n;let h=0;for(;h<c.length&&c[h]<=s;)h++;h=Math.max(0,h-1);let g=h;for(;g<c.length&&c[g]<s+1;)g++;g=Math.min(c.length-1,g);const M=c[h],C=c[g];return n.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:C,interpolationType:p}:{kind:"camera",minZoom:M,maxZoom:C,minSize:n.evaluate(new Ka(M)),maxSize:n.evaluate(new Ka(C)),interpolationType:p}}}function Dp(s,{uSize:t,uSizeT:n},{lowerSize:c,upperSize:p}){return s.kind==="source"?c/ao:s.kind==="composite"?Ee(c/ao,p/ao,n):t}function zp(s,t,n=1){let c=0,p=0;if(s.kind==="constant")p=s.layoutSize*n;else if(s.kind!=="source"){const{interpolationType:h,minZoom:g,maxZoom:M}=s,C=h?ii(ls.interpolationFactor(h,t,g,M),0,1):0;s.kind==="camera"?p=Ee(s.minSize,s.maxSize,C)*n:c=C*n}return{uSizeT:c,uSize:p}}var n_=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ao,evaluateSizeForFeature:Dp,evaluateSizeForZoom:zp,getRasterizedIconSize:eu,getSizeData:Cm});function Lm(s,t,n){return s.sections.forEach(c=>{c.text=function(p,h,g){const M=h.layout.get("text-transform").evaluate(g,{});return M==="uppercase"?p=p.toLocaleUpperCase():M==="lowercase"&&(p=p.toLocaleLowerCase()),us.applyArabicShaping&&(p=us.applyArabicShaping(p)),p}(c.text,t,n)}),s}const cp={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function bg(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}function dm(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}var Rm,Jp,Zm,Xm={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Im(){return Rm||(Rm=1,Xm.read=function(s,t,n,c,p){var h,g,M=8*p-c-1,C=(1<<M)-1,P=C>>1,b=-7,L=n?p-1:0,D=n?-1:1,A=s[t+L];for(L+=D,h=A&(1<<-b)-1,A>>=-b,b+=M;b>0;h=256*h+s[t+L],L+=D,b-=8);for(g=h&(1<<-b)-1,h>>=-b,b+=c;b>0;g=256*g+s[t+L],L+=D,b-=8);if(h===0)h=1-P;else{if(h===C)return g?NaN:1/0*(A?-1:1);g+=Math.pow(2,c),h-=P}return(A?-1:1)*g*Math.pow(2,h-c)},Xm.write=function(s,t,n,c,p,h){var g,M,C,P=8*h-p-1,b=(1<<P)-1,L=b>>1,D=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,A=c?0:h-1,R=c?1:-1,B=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(M=isNaN(t)?1:0,g=b):(g=Math.floor(Math.log(t)/Math.LN2),t*(C=Math.pow(2,-g))<1&&(g--,C*=2),(t+=g+L>=1?D/C:D*Math.pow(2,1-L))*C>=2&&(g++,C/=2),g+L>=b?(M=0,g=b):g+L>=1?(M=(t*C-1)*Math.pow(2,p),g+=L):(M=t*Math.pow(2,L-1)*Math.pow(2,p),g=0));p>=8;s[n+A]=255&M,A+=R,M/=256,p-=8);for(g=g<<p|M,P+=p;P>0;s[n+A]=255&g,A+=R,g/=256,P-=8);s[n+A-R]|=128*B}),Xm}function u(){if(Zm)return Jp;Zm=1,Jp=t;var s=Im();function t(Y){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(Y)?Y:new Uint8Array(Y||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var n=4294967296,c=1/n,p=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function h(Y){return Y.type===t.Bytes?Y.readVarint()+Y.pos:Y.pos+1}function g(Y,re,ce){return ce?4294967296*re+(Y>>>0):4294967296*(re>>>0)+(Y>>>0)}function M(Y,re,ce){var ve=re<=16383?1:re<=2097151?2:re<=268435455?3:Math.floor(Math.log(re)/(7*Math.LN2));ce.realloc(ve);for(var Be=ce.pos-1;Be>=Y;Be--)ce.buf[Be+ve]=ce.buf[Be]}function C(Y,re){for(var ce=0;ce<Y.length;ce++)re.writeVarint(Y[ce])}function P(Y,re){for(var ce=0;ce<Y.length;ce++)re.writeSVarint(Y[ce])}function b(Y,re){for(var ce=0;ce<Y.length;ce++)re.writeFloat(Y[ce])}function L(Y,re){for(var ce=0;ce<Y.length;ce++)re.writeDouble(Y[ce])}function D(Y,re){for(var ce=0;ce<Y.length;ce++)re.writeBoolean(Y[ce])}function A(Y,re){for(var ce=0;ce<Y.length;ce++)re.writeFixed32(Y[ce])}function R(Y,re){for(var ce=0;ce<Y.length;ce++)re.writeSFixed32(Y[ce])}function B(Y,re){for(var ce=0;ce<Y.length;ce++)re.writeFixed64(Y[ce])}function q(Y,re){for(var ce=0;ce<Y.length;ce++)re.writeSFixed64(Y[ce])}function W(Y,re){return(Y[re]|Y[re+1]<<8|Y[re+2]<<16)+16777216*Y[re+3]}function ee(Y,re,ce){Y[ce]=re,Y[ce+1]=re>>>8,Y[ce+2]=re>>>16,Y[ce+3]=re>>>24}function te(Y,re){return(Y[re]|Y[re+1]<<8|Y[re+2]<<16)+(Y[re+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(Y,re,ce){for(ce=ce||this.length;this.pos<ce;){var ve=this.readVarint(),Be=ve>>3,Oe=this.pos;this.type=7&ve,Y(Be,re,this),this.pos===Oe&&this.skip(ve)}return re},readMessage:function(Y,re){return this.readFields(Y,re,this.readVarint()+this.pos)},readFixed32:function(){var Y=W(this.buf,this.pos);return this.pos+=4,Y},readSFixed32:function(){var Y=te(this.buf,this.pos);return this.pos+=4,Y},readFixed64:function(){var Y=W(this.buf,this.pos)+W(this.buf,this.pos+4)*n;return this.pos+=8,Y},readSFixed64:function(){var Y=W(this.buf,this.pos)+te(this.buf,this.pos+4)*n;return this.pos+=8,Y},readFloat:function(){var Y=s.read(this.buf,this.pos,!0,23,4);return this.pos+=4,Y},readDouble:function(){var Y=s.read(this.buf,this.pos,!0,52,8);return this.pos+=8,Y},readVarint:function(Y){var re,ce,ve=this.buf;return re=127&(ce=ve[this.pos++]),ce<128?re:(re|=(127&(ce=ve[this.pos++]))<<7,ce<128?re:(re|=(127&(ce=ve[this.pos++]))<<14,ce<128?re:(re|=(127&(ce=ve[this.pos++]))<<21,ce<128?re:function(Be,Oe,Pe){var nt,Ue,lt=Pe.buf;if(nt=(112&(Ue=lt[Pe.pos++]))>>4,Ue<128||(nt|=(127&(Ue=lt[Pe.pos++]))<<3,Ue<128)||(nt|=(127&(Ue=lt[Pe.pos++]))<<10,Ue<128)||(nt|=(127&(Ue=lt[Pe.pos++]))<<17,Ue<128)||(nt|=(127&(Ue=lt[Pe.pos++]))<<24,Ue<128)||(nt|=(1&(Ue=lt[Pe.pos++]))<<31,Ue<128))return g(Be,nt,Oe);throw new Error("Expected varint not more than 10 bytes")}(re|=(15&(ce=ve[this.pos]))<<28,Y,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var Y=this.readVarint();return Y%2==1?(Y+1)/-2:Y/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var Y=this.readVarint()+this.pos,re=this.pos;return this.pos=Y,Y-re>=12&&p?function(ce,ve,Be){return p.decode(ce.subarray(ve,Be))}(this.buf,re,Y):function(ce,ve,Be){for(var Oe="",Pe=ve;Pe<Be;){var nt,Ue,lt,_t=ce[Pe],dt=null,xt=_t>239?4:_t>223?3:_t>191?2:1;if(Pe+xt>Be)break;xt===1?_t<128&&(dt=_t):xt===2?(192&(nt=ce[Pe+1]))==128&&(dt=(31&_t)<<6|63&nt)<=127&&(dt=null):xt===3?(Ue=ce[Pe+2],(192&(nt=ce[Pe+1]))==128&&(192&Ue)==128&&((dt=(15&_t)<<12|(63&nt)<<6|63&Ue)<=2047||dt>=55296&&dt<=57343)&&(dt=null)):xt===4&&(Ue=ce[Pe+2],lt=ce[Pe+3],(192&(nt=ce[Pe+1]))==128&&(192&Ue)==128&&(192&lt)==128&&((dt=(15&_t)<<18|(63&nt)<<12|(63&Ue)<<6|63&lt)<=65535||dt>=1114112)&&(dt=null)),dt===null?(dt=65533,xt=1):dt>65535&&(dt-=65536,Oe+=String.fromCharCode(dt>>>10&1023|55296),dt=56320|1023&dt),Oe+=String.fromCharCode(dt),Pe+=xt}return Oe}(this.buf,re,Y)},readBytes:function(){var Y=this.readVarint()+this.pos,re=this.buf.subarray(this.pos,Y);return this.pos=Y,re},readPackedVarint:function(Y,re){if(this.type!==t.Bytes)return Y.push(this.readVarint(re));var ce=h(this);for(Y=Y||[];this.pos<ce;)Y.push(this.readVarint(re));return Y},readPackedSVarint:function(Y){if(this.type!==t.Bytes)return Y.push(this.readSVarint());var re=h(this);for(Y=Y||[];this.pos<re;)Y.push(this.readSVarint());return Y},readPackedBoolean:function(Y){if(this.type!==t.Bytes)return Y.push(this.readBoolean());var re=h(this);for(Y=Y||[];this.pos<re;)Y.push(this.readBoolean());return Y},readPackedFloat:function(Y){if(this.type!==t.Bytes)return Y.push(this.readFloat());var re=h(this);for(Y=Y||[];this.pos<re;)Y.push(this.readFloat());return Y},readPackedDouble:function(Y){if(this.type!==t.Bytes)return Y.push(this.readDouble());var re=h(this);for(Y=Y||[];this.pos<re;)Y.push(this.readDouble());return Y},readPackedFixed32:function(Y){if(this.type!==t.Bytes)return Y.push(this.readFixed32());var re=h(this);for(Y=Y||[];this.pos<re;)Y.push(this.readFixed32());return Y},readPackedSFixed32:function(Y){if(this.type!==t.Bytes)return Y.push(this.readSFixed32());var re=h(this);for(Y=Y||[];this.pos<re;)Y.push(this.readSFixed32());return Y},readPackedFixed64:function(Y){if(this.type!==t.Bytes)return Y.push(this.readFixed64());var re=h(this);for(Y=Y||[];this.pos<re;)Y.push(this.readFixed64());return Y},readPackedSFixed64:function(Y){if(this.type!==t.Bytes)return Y.push(this.readSFixed64());var re=h(this);for(Y=Y||[];this.pos<re;)Y.push(this.readSFixed64());return Y},skip:function(Y){var re=7&Y;if(re===t.Varint)for(;this.buf[this.pos++]>127;);else if(re===t.Bytes)this.pos=this.readVarint()+this.pos;else if(re===t.Fixed32)this.pos+=4;else{if(re!==t.Fixed64)throw new Error("Unimplemented type: "+re);this.pos+=8}},writeTag:function(Y,re){this.writeVarint(Y<<3|re)},realloc:function(Y){for(var re=this.length||16;re<this.pos+Y;)re*=2;if(re!==this.length){var ce=new Uint8Array(re);ce.set(this.buf),this.buf=ce,this.length=re}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(Y){this.realloc(4),ee(this.buf,Y,this.pos),this.pos+=4},writeSFixed32:function(Y){this.realloc(4),ee(this.buf,Y,this.pos),this.pos+=4},writeFixed64:function(Y){this.realloc(8),ee(this.buf,-1&Y,this.pos),ee(this.buf,Math.floor(Y*c),this.pos+4),this.pos+=8},writeSFixed64:function(Y){this.realloc(8),ee(this.buf,-1&Y,this.pos),ee(this.buf,Math.floor(Y*c),this.pos+4),this.pos+=8},writeVarint:function(Y){(Y=+Y||0)>268435455||Y<0?function(re,ce){var ve,Be;if(re>=0?(ve=re%4294967296|0,Be=re/4294967296|0):(Be=~(-re/4294967296),4294967295^(ve=~(-re%4294967296))?ve=ve+1|0:(ve=0,Be=Be+1|0)),re>=18446744073709552e3||re<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ce.realloc(10),function(Oe,Pe,nt){nt.buf[nt.pos++]=127&Oe|128,Oe>>>=7,nt.buf[nt.pos++]=127&Oe|128,Oe>>>=7,nt.buf[nt.pos++]=127&Oe|128,Oe>>>=7,nt.buf[nt.pos++]=127&Oe|128,nt.buf[nt.pos]=127&(Oe>>>=7)}(ve,0,ce),function(Oe,Pe){var nt=(7&Oe)<<4;Pe.buf[Pe.pos++]|=nt|((Oe>>>=3)?128:0),Oe&&(Pe.buf[Pe.pos++]=127&Oe|((Oe>>>=7)?128:0),Oe&&(Pe.buf[Pe.pos++]=127&Oe|((Oe>>>=7)?128:0),Oe&&(Pe.buf[Pe.pos++]=127&Oe|((Oe>>>=7)?128:0),Oe&&(Pe.buf[Pe.pos++]=127&Oe|((Oe>>>=7)?128:0),Oe&&(Pe.buf[Pe.pos++]=127&Oe)))))}(Be,ce)}(Y,this):(this.realloc(4),this.buf[this.pos++]=127&Y|(Y>127?128:0),Y<=127||(this.buf[this.pos++]=127&(Y>>>=7)|(Y>127?128:0),Y<=127||(this.buf[this.pos++]=127&(Y>>>=7)|(Y>127?128:0),Y<=127||(this.buf[this.pos++]=Y>>>7&127))))},writeSVarint:function(Y){this.writeVarint(Y<0?2*-Y-1:2*Y)},writeBoolean:function(Y){this.writeVarint(!!Y)},writeString:function(Y){Y=String(Y),this.realloc(4*Y.length),this.pos++;var re=this.pos;this.pos=function(ve,Be,Oe){for(var Pe,nt,Ue=0;Ue<Be.length;Ue++){if((Pe=Be.charCodeAt(Ue))>55295&&Pe<57344){if(!nt){Pe>56319||Ue+1===Be.length?(ve[Oe++]=239,ve[Oe++]=191,ve[Oe++]=189):nt=Pe;continue}if(Pe<56320){ve[Oe++]=239,ve[Oe++]=191,ve[Oe++]=189,nt=Pe;continue}Pe=nt-55296<<10|Pe-56320|65536,nt=null}else nt&&(ve[Oe++]=239,ve[Oe++]=191,ve[Oe++]=189,nt=null);Pe<128?ve[Oe++]=Pe:(Pe<2048?ve[Oe++]=Pe>>6|192:(Pe<65536?ve[Oe++]=Pe>>12|224:(ve[Oe++]=Pe>>18|240,ve[Oe++]=Pe>>12&63|128),ve[Oe++]=Pe>>6&63|128),ve[Oe++]=63&Pe|128)}return Oe}(this.buf,Y,this.pos);var ce=this.pos-re;ce>=128&&M(re,ce,this),this.pos=re-1,this.writeVarint(ce),this.pos+=ce},writeFloat:function(Y){this.realloc(4),s.write(this.buf,Y,this.pos,!0,23,4),this.pos+=4},writeDouble:function(Y){this.realloc(8),s.write(this.buf,Y,this.pos,!0,52,8),this.pos+=8},writeBytes:function(Y){var re=Y.length;this.writeVarint(re),this.realloc(re);for(var ce=0;ce<re;ce++)this.buf[this.pos++]=Y[ce]},writeRawMessage:function(Y,re){this.pos++;var ce=this.pos;Y(re,this);var ve=this.pos-ce;ve>=128&&M(ce,ve,this),this.pos=ce-1,this.writeVarint(ve),this.pos+=ve},writeMessage:function(Y,re,ce){this.writeTag(Y,t.Bytes),this.writeRawMessage(re,ce)},writePackedVarint:function(Y,re){re.length&&this.writeMessage(Y,C,re)},writePackedSVarint:function(Y,re){re.length&&this.writeMessage(Y,P,re)},writePackedBoolean:function(Y,re){re.length&&this.writeMessage(Y,D,re)},writePackedFloat:function(Y,re){re.length&&this.writeMessage(Y,b,re)},writePackedDouble:function(Y,re){re.length&&this.writeMessage(Y,L,re)},writePackedFixed32:function(Y,re){re.length&&this.writeMessage(Y,A,re)},writePackedSFixed32:function(Y,re){re.length&&this.writeMessage(Y,R,re)},writePackedFixed64:function(Y,re){re.length&&this.writeMessage(Y,B,re)},writePackedSFixed64:function(Y,re){re.length&&this.writeMessage(Y,q,re)},writeBytesField:function(Y,re){this.writeTag(Y,t.Bytes),this.writeBytes(re)},writeFixed32Field:function(Y,re){this.writeTag(Y,t.Fixed32),this.writeFixed32(re)},writeSFixed32Field:function(Y,re){this.writeTag(Y,t.Fixed32),this.writeSFixed32(re)},writeFixed64Field:function(Y,re){this.writeTag(Y,t.Fixed64),this.writeFixed64(re)},writeSFixed64Field:function(Y,re){this.writeTag(Y,t.Fixed64),this.writeSFixed64(re)},writeVarintField:function(Y,re){this.writeTag(Y,t.Varint),this.writeVarint(re)},writeSVarintField:function(Y,re){this.writeTag(Y,t.Varint),this.writeSVarint(re)},writeStringField:function(Y,re){this.writeTag(Y,t.Bytes),this.writeString(re)},writeFloatField:function(Y,re){this.writeTag(Y,t.Fixed32),this.writeFloat(re)},writeDoubleField:function(Y,re){this.writeTag(Y,t.Fixed64),this.writeDouble(re)},writeBooleanField:function(Y,re){this.writeVarintField(Y,!!re)}},Jp}var m=Ge(u());const w=3;function z(s,t,n){t.glyphs=[],s===1&&n.readMessage(H,t)}function H(s,t,n){if(s===3){const{id:c,bitmap:p,width:h,height:g,left:M,top:C,advance:P}=n.readMessage(J,{});t.glyphs.push({id:c,bitmap:new xd({width:h+2*w,height:g+2*w},p),metrics:{width:h,height:g,left:M,top:C,advance:P}})}else s===4?t.ascender=n.readSVarint():s===5&&(t.descender=n.readSVarint())}function J(s,t,n){s===1?t.id=n.readVarint():s===2?t.bitmap=n.readBytes():s===3?t.width=n.readVarint():s===4?t.height=n.readVarint():s===5?t.left=n.readSVarint():s===6?t.top=n.readSVarint():s===7&&(t.advance=n.readVarint())}const Ae=w,Ke={horizontal:1,vertical:2,horizontalOnly:3};class Ot{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(t,n){const c=new Ot;return c.scale=t||1,c.fontStack=n,c}static forImage(t){const n=new Ot;return n.image=t,n}}class _i{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const c=new _i;for(let p=0;p<t.sections.length;p++){const h=t.sections[p];h.image?c.addImageSection(h):c.addTextSection(h,n)}return c}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(n,c){let p="";for(let h=0;h<n.length;h++){const g=n.charCodeAt(h+1)||null,M=n.charCodeAt(h-1)||null;p+=!c&&(g&&Gu(g)&&!cp[n[h+1]]||M&&Gu(M)&&!cp[n[h-1]])||!cp[n[h]]?n[h]:cp[n[h]]}return p}(this.text,t)}trim(){let t=0;for(let c=0;c<this.text.length&&Zn[this.text.charCodeAt(c)];c++)t++;let n=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&Zn[this.text.charCodeAt(c)];c--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const c=new _i;return c.text=this.text.substring(t,n),c.sectionIndex=this.sectionIndex.slice(t,n),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(Ot.forText(t.scale,t.fontStack||n));const c=this.sections.length-1;for(let p=0;p<t.text.length;++p)this.sectionIndex.push(c)}addImageSection(t){const n=t.image&&t.image.namePrimary?t.image.getPrimary():null;if(!n)return void Xn("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(Ot.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Xn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function An(s,t,n,c,p,h,g,M,C,P,b,L,D,A,R){const B=_i.fromFeature(s,p);L===Ke.vertical&&B.verticalizePunctuation(D);let q=[];const W=function(ce,ve,Be,Oe,Pe,nt){if(!ce)return[];const Ue=[],lt=function(Ct,Nt,wt,gi,Ui,mi){let Dn=0;for(let Mn=0;Mn<Ct.length();Mn++){const tn=Ct.getSection(Mn);Dn+=Sn(Ct.getCodePoint(Mn),tn,gi,Ui,Nt,mi)}return Dn/Math.max(1,Math.ceil(Dn/wt))}(ce,ve,Be,Oe,Pe,nt),_t=ce.text.indexOf("")>=0;let dt=0;for(let Ct=0;Ct<ce.length();Ct++){const Nt=ce.getSection(Ct),wt=ce.getCodePoint(Ct);if(Zn[wt]||(dt+=Sn(wt,Nt,Oe,Pe,ve,nt)),Ct<ce.length()-1){const gi=!((xt=wt)<11904||!(un["Bopomofo Extended"](xt)||un.Bopomofo(xt)||un["CJK Compatibility Forms"](xt)||un["CJK Compatibility Ideographs"](xt)||un["CJK Compatibility"](xt)||un["CJK Radicals Supplement"](xt)||un["CJK Strokes"](xt)||un["CJK Symbols and Punctuation"](xt)||un["CJK Unified Ideographs Extension A"](xt)||un["CJK Unified Ideographs"](xt)||un["Enclosed CJK Letters and Months"](xt)||un["Halfwidth and Fullwidth Forms"](xt)||un.Hiragana(xt)||un["Ideographic Description Characters"](xt)||un["Kangxi Radicals"](xt)||un["Katakana Phonetic Extensions"](xt)||un.Katakana(xt)||un["Vertical Forms"](xt)||un["Yi Radicals"](xt)||un["Yi Syllables"](xt)));(Ji[wt]||gi||Nt.image)&&Ue.push(Go(Ct+1,dt,lt,Ue,Ua(wt,ce.getCodePoint(Ct+1),gi&&_t),!1))}}var xt;return Li(Go(ce.length(),dt,lt,Ue,0,!0))}(B,P,h,t,c,A),{processBidirectionalText:ee,processStyledBidirectionalText:te}=us;if(ee&&B.sections.length===1){const ce=ee(B.toString(),W);for(const ve of ce){const Be=new _i;Be.text=ve,Be.sections=B.sections;for(let Oe=0;Oe<ve.length;Oe++)Be.sectionIndex.push(0);q.push(Be)}}else if(te){const ce=te(B.text,B.sectionIndex,W);for(const ve of ce){const Be=new _i;Be.text=ve[0],Be.sectionIndex=ve[1],Be.sections=B.sections,q.push(Be)}}else q=function(ce,ve){const Be=[],Oe=ce.text;let Pe=0;for(const nt of ve)Be.push(ce.substring(Pe,nt)),Pe=nt;return Pe<Oe.length&&Be.push(ce.substring(Pe,Oe.length)),Be}(B,W);const Y=[],re={positionedLines:Y,text:B.toString(),top:b[1],bottom:b[1],left:b[0],right:b[0],writingMode:L,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ce,ve,Be,Oe,Pe,nt,Ue,lt,_t,dt,xt,Ct){let Nt=0,wt=0,gi=0;const Ui=lt==="right"?1:lt==="left"?0:.5;let mi=!1;for(const Fn of Pe){const Hn=Fn.getSections();for(const zr of Hn){if(zr.image)continue;const Yr=ve[zr.fontStack];if(Yr&&(mi=Yr.ascender!==void 0&&Yr.descender!==void 0,!mi))break}if(!mi)break}let Dn=0;for(const Fn of Pe){Fn.trim();const Hn=Fn.getMaxScale(),zr=(Hn-1)*hs,Yr={positionedGlyphs:[],lineOffset:0};ce.positionedLines[Dn]=Yr;const ta=Yr.positionedGlyphs;let ia=0;if(!Fn.length()){wt+=nt,++Dn;continue}let ma=0,va=0;for(let rs=0;rs<Fn.length();rs++){const Vr=Fn.getSection(rs),Ya=Fn.getSectionIndex(rs),Ja=Fn.getCodePoint(rs);let zs=Vr.scale,yo=null,jo=null,vo=null,so=hs,Co=0;const rl=!(_t===Ke.horizontal||!xt&&!lu(Ja)||xt&&(Zn[Ja]||(Mn=Ja,un.Arabic(Mn)||un["Arabic Supplement"](Mn)||un["Arabic Extended-A"](Mn)||un["Arabic Presentation Forms-A"](Mn)||un["Arabic Presentation Forms-B"](Mn))));if(Vr.image){const mc=Oe[Vr.image.serialize()];if(!mc)continue;vo=Vr.image.id,ce.iconsInText=ce.iconsInText||!0,jo=mc.paddedRect;const Cs=mc.displaySize;zs=zs*hs/Ct,yo={width:Cs[0],height:Cs[1],left:0,top:-3,advance:rl?Cs[1]:Cs[0],localGlyph:!1},Co=mi?-yo.height*zs:Hn*hs-17-Cs[1]*zs,so=yo.advance;const rh=(rl?Cs[0]:Cs[1])*zs-hs*Hn;rh>0&&rh>ia&&(ia=rh)}else{const mc=Be[Vr.fontStack];if(!mc)continue;mc[Ja]&&(jo=mc[Ja]);const Cs=ve[Vr.fontStack];if(!Cs)continue;const rh=Cs.glyphs[Ja];if(!rh)continue;if(yo=rh.metrics,so=Ja!==8203?hs:0,mi){const Hf=Cs.ascender!==void 0?Math.abs(Cs.ascender):0,uf=Cs.descender!==void 0?Math.abs(Cs.descender):0,hf=(Hf+uf)*zs;ma<hf&&(ma=hf,va=(Hf-uf)/2*zs),Co=-Hf*zs}else Co=(Hn-zs)*hs-17}rl?(ce.verticalizable=!0,ta.push({glyph:Ja,imageName:vo,x:Nt,y:wt+Co,vertical:rl,scale:zs,localGlyph:yo.localGlyph,fontStack:Vr.fontStack,sectionIndex:Ya,metrics:yo,rect:jo}),Nt+=so*zs+dt):(ta.push({glyph:Ja,imageName:vo,x:Nt,y:wt+Co,vertical:rl,scale:zs,localGlyph:yo.localGlyph,fontStack:Vr.fontStack,sectionIndex:Ya,metrics:yo,rect:jo}),Nt+=yo.advance*zs+dt)}ta.length!==0&&(gi=Math.max(Nt-dt,gi),mi?Gi(ta,Ui,ia,va,nt*Hn/2):Gi(ta,Ui,ia,0,nt/2)),Nt=0;const vs=nt*Hn+ia;Yr.lineOffset=Math.max(ia,zr),wt+=vs,++Dn}var Mn;const tn=wt,{horizontalAlign:qi,verticalAlign:nr}=pi(Ue);(function(Fn,Hn,zr,Yr,ta,ia){const ma=(Hn-zr)*ta,va=-ia*Yr;for(const vs of Fn)for(const rs of vs.positionedGlyphs)rs.x+=ma,rs.y+=va})(ce.positionedLines,Ui,qi,nr,gi,tn),ce.top+=-nr*tn,ce.bottom=ce.top+tn,ce.left+=-qi*gi,ce.right=ce.left+gi,ce.hasBaseline=mi}(re,t,n,c,q,g,M,C,L,P,D,R),!function(ce){for(const ve of ce)if(ve.positionedGlyphs.length!==0)return!1;return!0}(Y)&&re}const Zn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ji={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Sn(s,t,n,c,p,h){if(t.image){const g=c[t.image.serialize()];return g?g.displaySize[0]*t.scale*hs/h+p:0}{const g=n[t.fontStack],M=g&&g.glyphs[s];return M?M.metrics.advance*t.scale+p:0}}function ea(s,t,n,c){const p=Math.pow(s-t,2);return c?s<t?p/2:2*p:p+Math.abs(n)*n}function Ua(s,t,n){let c=0;return s===10&&(c-=1e4),n&&(c+=150),s!==40&&s!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function Go(s,t,n,c,p,h){let g=null,M=ea(t,n,p,h);for(const C of c){const P=ea(t-C.x,n,p,h)+C.badness;P<=M&&(g=C,M=P)}return{index:s,x:t,priorBreak:g,badness:M}}function Li(s){return s?Li(s.priorBreak).concat(s.index):[]}function pi(s){let t=.5,n=.5;switch(s){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Gi(s,t,n,c,p){if(!(t||n||c||p))return;const h=s.length-1,g=s[h],M=(g.x+g.metrics.advance*g.scale)*t;for(let C=0;C<=h;C++)s[C].x-=M,s[C].y+=n+c+p}function Vn(s,t,n,c){const{horizontalAlign:p,verticalAlign:h}=pi(c),g=n[0]-s.displaySize[0]*p,M=n[1]-s.displaySize[1]*h;return{imagePrimary:s,imageSecondary:t,top:M,bottom:M+s.displaySize[1],left:g,right:g+s.displaySize[0]}}function Hr(s,t,n,c,p,h){const g=s.imagePrimary;let M;if(g.content){const q=g.content,W=g.pixelRatio||1;M=[q[0]/W,q[1]/W,g.displaySize[0]-q[2]/W,g.displaySize[1]-q[3]/W]}const C=t.left*h,P=t.right*h;let b,L,D,A;n==="width"||n==="both"?(A=p[0]+C-c[3],L=p[0]+P+c[1]):(A=p[0]+(C+P-g.displaySize[0])/2,L=A+g.displaySize[0]);const R=t.top*h,B=t.bottom*h;return n==="height"||n==="both"?(b=p[1]+R-c[0],D=p[1]+B+c[2]):(b=p[1]+(R+B-g.displaySize[1])/2,D=b+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:b,right:L,bottom:D,left:A,collisionPadding:M}}class Fa extends Pi{constructor(t,n,c,p,h){super(t,n),this.angle=p,this.z=c,h!==void 0&&(this.segment=h)}clone(){return new Fa(this.x,this.y,this.z,this.angle,this.segment)}}function ca(s,t,n,c,p){if(t.segment===void 0)return!0;let h=t,g=t.segment+1,M=0;for(;M>-n/2;){if(g--,g<0)return!1;M-=s[g].dist(h),h=s[g]}M+=s[g].dist(s[g+1]),g++;const C=[];let P=0;for(;M<n/2;){const b=s[g],L=s[g+1];if(!L)return!1;let D=s[g-1].angleTo(b)-b.angleTo(L);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:M,angleDelta:D}),P+=D;M-C[0].distance>c;)P-=C.shift().angleDelta;if(P>p)return!1;g++,M+=b.dist(L)}return!0}function wa(s){let t=0;for(let n=0;n<s.length-1;n++)t+=s[n].dist(s[n+1]);return t}function Fl(s,t,n){return s?.6*t*n:0}function As(s,t){return Math.max(s?s.right-s.left:0,t?t.right-t.left:0)}function up(s,t,n,c,p,h){const g=Fl(n,p,h),M=As(n,c)*h;let C=0;const P=wa(s)/2;for(let b=0;b<s.length-1;b++){const L=s[b],D=s[b+1],A=L.dist(D);if(C+A>P){const R=(P-C)/A,B=Ee(L.x,D.x,R),q=Ee(L.y,D.y,R),W=new Fa(B,q,0,D.angleTo(L),b);return!g||ca(s,W,M,g,t)?W:void 0}C+=A}}function r_(s,t,n,c,p,h,g,M,C){const P=Fl(c,h,g),b=As(c,p),L=b*g,D=s[0].x===0||s[0].x===C||s[0].y===0||s[0].y===C;return t-L<t/4&&(t=L+t/4),Ry(s,D?t/2*M%t:(b/2+2*h)*g*M%t,t,P,n,L,D,!1,C)}function Ry(s,t,n,c,p,h,g,M,C){const P=h/2,b=wa(s);let L=0,D=t-n,A=[];for(let R=0;R<s.length-1;R++){const B=s[R],q=s[R+1],W=B.dist(q),ee=q.angleTo(B);for(;D+n<L+W;){D+=n;const te=(D-L)/W,Y=Ee(B.x,q.x,te),re=Ee(B.y,q.y,te);if(Y>=0&&Y<C&&re>=0&&re<C&&D-P>=0&&D+P<=b){const ce=new Fa(Y,re,0,ee,R);c&&!ca(s,ce,h,c,p)||A.push(ce)}}L+=W}return M||A.length||g||(A=Ry(s,L/2,n,c,p,h,g,!0,C)),A}function Iy(s,t,n,c,p){const h=[];for(let g=0;g<s.length;g++){const M=s[g];let C;for(let P=0;P<M.length-1;P++){let b=M[P],L=M[P+1];b.x<t&&L.x<t||(b.x<t?b=new Pi(t,b.y+(t-b.x)/(L.x-b.x)*(L.y-b.y))._round():L.x<t&&(L=new Pi(t,b.y+(t-b.x)/(L.x-b.x)*(L.y-b.y))._round()),b.y<n&&L.y<n||(b.y<n?b=new Pi(b.x+(n-b.y)/(L.y-b.y)*(L.x-b.x),n)._round():L.y<n&&(L=new Pi(b.x+(n-b.y)/(L.y-b.y)*(L.x-b.x),n)._round()),b.x>=c&&L.x>=c||(b.x>=c?b=new Pi(c,b.y+(c-b.x)/(L.x-b.x)*(L.y-b.y))._round():L.x>=c&&(L=new Pi(c,b.y+(c-b.x)/(L.x-b.x)*(L.y-b.y))._round()),b.y>=p&&L.y>=p||(b.y>=p?b=new Pi(b.x+(p-b.y)/(L.y-b.y)*(L.x-b.x),p)._round():L.y>=p&&(L=new Pi(b.x+(p-b.y)/(L.y-b.y)*(L.x-b.x),p)._round()),C&&b.equals(C[C.length-1])||(C=[b],h.push(C)),C.push(L)))))}}return h}function Dy(s){let t=0,n=0;for(const g of s)t+=g.w*g.h,n=Math.max(n,g.w);s.sort((g,M)=>M.h-g.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let p=0,h=0;for(const g of s)for(let M=c.length-1;M>=0;M--){const C=c[M];if(!(g.w>C.w||g.h>C.h)){if(g.x=C.x,g.y=C.y,h=Math.max(h,g.y+g.h),p=Math.max(p,g.x+g.w),g.w===C.w&&g.h===C.h){const P=c.pop();M<c.length&&(c[M]=P)}else g.h===C.h?(C.x+=g.w,C.w-=g.w):g.w===C.w?(C.y+=g.h,C.h-=g.h):(c.push({x:C.x+g.w,y:C.y,w:C.w-g.w,h:g.h}),C.y+=g.h,C.h-=g.h);break}}return{w:p,h,fill:t/(p*h)||0}}kn(Fa,"Anchor");const Ym=1;class $m{static getImagePositionScale(t,n,c){return n&&t&&t.options&&t.options.transform?{x:t.options.transform.a,y:t.options.transform.d}:{x:c,y:c}}constructor(t,{pixelRatio:n,version:c,stretchX:p,stretchY:h,content:g,sdf:M,usvg:C},P,b){this.paddedRect=t,this.pixelRatio=n,this.stretchX=p,this.stretchY=h,this.content=g,this.version=c,this.padding=P,this.sdf=M,this.scale=$m.getImagePositionScale(b,C,n)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}class zy{constructor(t,n,c){const p={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(t,p,Ym,g),this.addImages(n,h,2,g);const{w:M,h:C}=Dy(g),P=new Vo({width:M||1,height:C||1});for(const b in t){const L=t[b],D=p[b].paddedRect;Vo.copy(L.data,P,{x:0,y:0},{x:D.x+Ym,y:D.y+Ym},L.data,c,L.sdf)}for(const b in n){const L=n[b],D=h[b].paddedRect;let A=h[b].padding;const R=D.x+A,B=D.y+A,q=L.data.width,W=L.data.height;A=A>1?A-1:A,Vo.copy(L.data,P,{x:0,y:0},{x:R,y:B},L.data,c),Vo.copy(L.data,P,{x:0,y:W-A},{x:R,y:B-A},{width:q,height:A},c),Vo.copy(L.data,P,{x:0,y:0},{x:R,y:B+W},{width:q,height:A},c),Vo.copy(L.data,P,{x:q-A,y:0},{x:R-A,y:B},{width:A,height:W},c),Vo.copy(L.data,P,{x:0,y:0},{x:R+q,y:B},{width:A,height:W},c),Vo.copy(L.data,P,{x:q-A,y:W-A},{x:R-A,y:B-A},{width:A,height:A},c),Vo.copy(L.data,P,{x:0,y:W-A},{x:R+q,y:B-A},{width:A,height:A},c),Vo.copy(L.data,P,{x:0,y:0},{x:R+q,y:B+W},{width:A,height:A},c),Vo.copy(L.data,P,{x:q-A,y:0},{x:R-A,y:B+W},{width:A,height:A},c)}this.lut=c,this.image=P,this.iconPositions=p,this.patternPositions=h}addImages(t,n,c,p){for(const h in t){const g=t[h],M={x:0,y:0,w:g.data.width+2*c,h:g.data.height+2*c};p.push(M);const C=Fs.deserializeFromString(h);n[h]=new $m(M,g,c,C),g.hasRenderCallback&&this.haveRenderCallbacks.push(C.id)}}patchUpdatedImages(t,n,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>t.hasImage(p,c)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(const p in t.getUpdatedImages(c)){for(const h of Object.keys(this.iconPositions))Fs.deserializeId(h)===p&&this.patchUpdatedImage(this.iconPositions[h],t.getImage(p,c),n);for(const h of Object.keys(this.patternPositions))Fs.deserializeId(h)===p&&this.patchUpdatedImage(this.patternPositions[h],t.getImage(p,c),n)}}patchUpdatedImage(t,n,c){if(!t||!n||t.version===n.version)return;t.version=n.version;const[p,h]=t.tl,g=t.sdf;if(this.lut||g){const M={width:n.data.width,height:n.data.height},C=new Vo(M);Vo.copy(n.data,C,{x:0,y:0},{x:0,y:0},M,this.lut,g),c.update(C,{position:{x:p,y:h}})}else c.update(n.data,{position:{x:p,y:h}})}}kn($m,"ImagePosition"),kn(zy,"ImageAtlas");const wg=1e20;function Py(s,t,n,c,p,h,g,M,C){for(let P=t;P<t+c;P++)Oy(s,n*h+P,h,p,g,M,C);for(let P=n;P<n+p;P++)Oy(s,P*h+t,1,c,g,M,C)}function Oy(s,t,n,c,p,h,g){h[0]=0,g[0]=-1e20,g[1]=wg,p[0]=s[t];for(let M=1,C=0,P=0;M<c;M++){p[M]=s[t+M*n];const b=M*M;do{const L=h[C];P=(p[M]-p[L]+b-L*L)/(M-L)/2}while(P<=g[C]&&--C>-1);C++,h[C]=M,g[C]=P,g[C+1]=wg}for(let M=0,C=0;M<c;M++){for(;g[C+1]<M;)C++;const P=h[C],b=M-P;s[t+M*n]=p[P]+b*b}}const Nf=2,a_={none:0,ideographs:1,all:2};class Dm{constructor(t,n,c){this.requestManager=t,this.localGlyphMode=n,this.localFontFamily=c,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,n){this.urls[n]=t}getGlyphs(t,n,c){const p=[],h=this.urls[n]||es.GLYPHS_URL;for(const g in t)for(const M of t[g])p.push({stack:g,id:M});gr(p,({stack:g,id:M},C)=>{let P=this.entries[g];P||(P=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=P.glyphs[M];if(b!==void 0)return void C(null,{stack:g,id:M,glyph:b});if(b=this._tinySDF(P,g,M),b)return P.glyphs[M]=b,void C(null,{stack:g,id:M,glyph:b});const L=Math.floor(M/256);if(256*L>65535)return Xn("glyphs > 65535 not supported"),void C(null,{stack:g,id:M,glyph:b});if(P.ranges[L])return void C(null,{stack:g,id:M,glyph:b});let D=P.requests[L];D||(D=P.requests[L]=[],Dm.loadGlyphRange(g,L,h,this.requestManager,(A,R)=>{if(R){P.ascender=R.ascender,P.descender=R.descender;for(const B in R.glyphs)this._doesCharSupportLocalGlyph(+B)||(P.glyphs[+B]=R.glyphs[+B]);P.ranges[L]=!0}for(const B of D)B(A,R);delete P.requests[L]})),D.push((A,R)=>{A?C(A):R&&C(null,{stack:g,id:M,glyph:R.glyphs[M]||null})})},(g,M)=>{if(g)c(g);else if(M){const C={};for(const{stack:P,id:b,glyph:L}of M)C[P]===void 0&&(C[P]={}),C[P].glyphs===void 0&&(C[P].glyphs={}),C[P].glyphs[b]=L&&{id:L.id,bitmap:L.bitmap.clone(),metrics:L.metrics},C[P].ascender=this.entries[P].ascender,C[P].descender=this.entries[P].descender;c(null,C)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==a_.none&&(this.localGlyphMode===a_.all?!!this.localFontFamily:!!this.localFontFamily&&(un["CJK Unified Ideographs"](t)||un["Hangul Syllables"](t)||un.Hiragana(t)||un.Katakana(t)||un["CJK Symbols and Punctuation"](t)||un["CJK Unified Ideographs Extension A"](t)||un["CJK Unified Ideographs Extension B"](t)||un.Osage(t)))}_tinySDF(t,n,c){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let h=t.tinySDF;if(!h){let B="400";/bold/i.test(n)?B="900":/medium/i.test(n)?B="500":/light/i.test(n)&&(B="200"),h=t.tinySDF=new Dm.TinySDF({fontFamily:p,fontWeight:B,fontSize:24*Nf,buffer:3*Nf,radius:8*Nf}),h.fontWeight=B}if(this.localGlyphs[h.fontWeight][c])return this.localGlyphs[h.fontWeight][c];const g=String.fromCodePoint(c),{data:M,width:C,height:P,glyphWidth:b,glyphHeight:L,glyphLeft:D,glyphTop:A,glyphAdvance:R}=h.draw(g);return this.localGlyphs[h.fontWeight][c]={id:c,bitmap:new xd({width:C,height:P},M),metrics:{width:b/Nf,height:L/Nf,left:D/Nf,top:A/Nf-27,advance:R/Nf,localGlyph:!0}}}}Dm.loadGlyphRange=function(s,t,n,c,p){const h=256*t,g=h+255,M=c.transformRequest(c.normalizeGlyphsURL(n).replace("{fontstack}",s).replace("{range}",`${h}-${g}`),Wr.Glyphs);Da(M,(C,P)=>{if(C)p(C);else if(P){const b={},L=function(D){return new m(D).readFields(z,{})}(P);for(const D of L.glyphs)b[D.id]=D;p(null,{glyphs:b,ascender:L.ascender,descender:L.descender})}})},Dm.TinySDF=class{constructor({fontSize:s=24,buffer:t=3,radius:n=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:h="normal",fontStyle:g="normal"}={}){this.buffer=t,this.cutoff=c,this.radius=n;const M=this.size=s+4*t,C=this._createCanvas(M),P=this.ctx=C.getContext("2d",{willReadFrequently:!0});P.font=`${g} ${h} ${s}px ${p}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(s){const t=document.createElement("canvas");return t.width=t.height=s,t}draw(s){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:h}=this.ctx.measureText(s),g=Math.ceil(n),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-p))),C=Math.min(this.size-this.buffer,g+Math.ceil(c)),P=M+2*this.buffer,b=C+2*this.buffer,L=Math.max(P*b,0),D=new Uint8ClampedArray(L),A={data:D,width:P,height:b,glyphWidth:M,glyphHeight:C,glyphTop:g,glyphLeft:0,glyphAdvance:t};if(M===0||C===0)return A;const{ctx:R,buffer:B,gridInner:q,gridOuter:W}=this;R.clearRect(B,B,M,C),R.fillText(s,B,B+g);const ee=R.getImageData(B,B,M,C);W.fill(wg,0,L),q.fill(0,0,L);for(let te=0;te<C;te++)for(let Y=0;Y<M;Y++){const re=ee.data[4*(te*M+Y)+3]/255;if(re===0)continue;const ce=(te+B)*P+Y+B;if(re===1)W[ce]=0,q[ce]=wg;else{const ve=.5-re;W[ce]=ve>0?ve*ve:0,q[ce]=ve<0?ve*ve:0}}Py(W,0,0,P,b,P,this.f,this.v,this.z),Py(q,B,B,M,C,P,this.f,this.v,this.z);for(let te=0;te<L;te++){const Y=Math.sqrt(W[te])-Math.sqrt(q[te]);D[te]=Math.round(255-255*(Y/this.radius+this.cutoff))}return A}};const fm=Ym;function By(s,t){return s+t[1]-t[0]}function Fy(s,t,n,c,p=1){const h=[],g=s.imagePrimary,M=g.pixelRatio,C=g.paddedRect.w-2*fm,P=g.paddedRect.h-2*fm,b=(s.right-s.left)*p,L=(s.bottom-s.top)*p,D=g.stretchX||[[0,C]],A=g.stretchY||[[0,P]],R=D.reduce(By,0),B=A.reduce(By,0),q=C-R,W=P-B;let ee=0,te=R,Y=0,re=B,ce=0,ve=q,Be=0,Oe=W;if(g.content&&c){const nt=g.content;ee=Mg(D,0,nt[0]),Y=Mg(A,0,nt[1]),te=Mg(D,nt[0],nt[2]),re=Mg(A,nt[1],nt[3]),ce=nt[0]-ee,Be=nt[1]-Y,ve=nt[2]-nt[0]-te,Oe=nt[3]-nt[1]-re}const Pe=(nt,Ue,lt,_t)=>{const dt=Tg(nt.stretch-ee,te,b,s.left*p),xt=Sg(nt.fixed-ce,ve,nt.stretch,R),Ct=Tg(Ue.stretch-Y,re,L,s.top*p),Nt=Sg(Ue.fixed-Be,Oe,Ue.stretch,B),wt=Tg(lt.stretch-ee,te,b,s.left*p),gi=Sg(lt.fixed-ce,ve,lt.stretch,R),Ui=Tg(_t.stretch-Y,re,L,s.top*p),mi=Sg(_t.fixed-Be,Oe,_t.stretch,B),Dn=new Pi(dt,Ct),Mn=new Pi(wt,Ct),tn=new Pi(wt,Ui),qi=new Pi(dt,Ui),nr=new Pi(xt/M,Nt/M),Fn=new Pi(gi/M,mi/M),Hn=t*Math.PI/180;if(Hn){const va=Math.sin(Hn),vs=Math.cos(Hn),rs=[vs,-va,va,vs];Dn._matMult(rs),Mn._matMult(rs),qi._matMult(rs),tn._matMult(rs)}const zr=nt.stretch+nt.fixed,Yr=lt.stretch+lt.fixed,ta=Ue.stretch+Ue.fixed,ia=_t.stretch+_t.fixed,ma=s.imageSecondary;return{tl:Dn,tr:Mn,bl:qi,br:tn,texPrimary:{x:g.paddedRect.x+fm+zr,y:g.paddedRect.y+fm+ta,w:Yr-zr,h:ia-ta},texSecondary:ma?{x:ma.paddedRect.x+fm+zr,y:ma.paddedRect.y+fm+ta,w:Yr-zr,h:ia-ta}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:nr,pixelOffsetBR:Fn,minFontScaleX:ve/M/b,minFontScaleY:Oe/M/L,isSDF:n}};if(c&&(g.stretchX||g.stretchY)){const nt=ky(D,q,R),Ue=ky(A,W,B);for(let lt=0;lt<nt.length-1;lt++){const _t=nt[lt],dt=nt[lt+1];for(let xt=0;xt<Ue.length-1;xt++)h.push(Pe(_t,Ue[xt],dt,Ue[xt+1]))}}else h.push(Pe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:P+1}));return h}function Mg(s,t,n){let c=0;for(const p of s)c+=Math.max(t,Math.min(n,p[1]))-Math.max(t,Math.min(n,p[0]));return c}function ky(s,t,n){const c=[{fixed:-1,stretch:0}];for(const[p,h]of s){const g=c[c.length-1];c.push({fixed:p-g.stretch,stretch:g.stretch}),c.push({fixed:p-g.stretch,stretch:g.stretch+(h-p)})}return c.push({fixed:t+fm,stretch:n}),c}function Tg(s,t,n,c){return s/t*n+c}function Sg(s,t,n,c){return s-t*n/c}function vx(s,t,n,c){const p=t+s.positionedLines[c].lineOffset;return c===0?n+p/2:n+(p+(t+s.positionedLines[c-1].lineOffset))/2}function xx(s,t=1,n=!1){let c=1/0,p=1/0,h=-1/0,g=-1/0;const M=s[0];for(let A=0;A<M.length;A++){const R=M[A];(!A||R.x<c)&&(c=R.x),(!A||R.y<p)&&(p=R.y),(!A||R.x>h)&&(h=R.x),(!A||R.y>g)&&(g=R.y)}const C=Math.min(h-c,g-p);let P=C/2;const b=new bo([],bx);if(C===0)return new Pi(c,p);for(let A=c;A<h;A+=C)for(let R=p;R<g;R+=C)b.push(new zm(A+P,R+P,P,s));let L=function(A){let R=0,B=0,q=0;const W=A[0];for(let ee=0,te=W.length,Y=te-1;ee<te;Y=ee++){const re=W[ee],ce=W[Y],ve=re.x*ce.y-ce.x*re.y;B+=(re.x+ce.x)*ve,q+=(re.y+ce.y)*ve,R+=3*ve}return new zm(B/R,q/R,0,A)}(s),D=b.length;for(;b.length;){const A=b.pop();(A.d>L.d||!L.d)&&(L=A,n&&console.log("found best %d after %d probes",Math.round(1e4*A.d)/1e4,D)),A.max-L.d<=t||(P=A.h/2,b.push(new zm(A.p.x-P,A.p.y-P,P,s)),b.push(new zm(A.p.x+P,A.p.y-P,P,s)),b.push(new zm(A.p.x-P,A.p.y+P,P,s)),b.push(new zm(A.p.x+P,A.p.y+P,P,s)),D+=4)}return n&&(console.log(`num probes: ${D}`),console.log(`best distance: ${L.d}`)),L.p}function bx(s,t){return t.max-s.max}class zm{constructor(t,n,c,p){this.p=new Pi(t,n),this.h=c,this.d=function(h,g){let M=!1,C=1/0;for(let P=0;P<g.length;P++){const b=g[P];for(let L=0,D=b.length,A=D-1;L<D;A=L++){const R=b[L],B=b[A];R.y>h.y!=B.y>h.y&&h.x<(B.x-R.x)*(h.y-R.y)/(B.y-R.y)+R.x&&(M=!M),C=Math.min(C,He(h,R,B))}}return(M?1:-1)*Math.sqrt(C)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const s_=Number.POSITIVE_INFINITY,wx=Math.sqrt(2);function Ny(s,[t,n]){let c=0,p=0;if(n===s_){t<0&&(t=0);const h=t/wx;switch(s){case"top-right":case"top-left":p=h-7;break;case"bottom-right":case"bottom-left":p=7-h;break;case"bottom":p=7-t;break;case"top":p=t-7}switch(s){case"top-right":case"bottom-right":c=-h;break;case"top-left":case"bottom-left":c=h;break;case"left":c=t;break;case"right":c=-t}}else{switch(t=Math.abs(t),n=Math.abs(n),s){case"top-right":case"top-left":case"top":p=n-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-n}switch(s){case"top-right":case"bottom-right":case"right":c=-t;break;case"top-left":case"bottom-left":case"left":c=t}}return[c,p]}function o_(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Mx(s,t,n,c,p,h,g,M,C,P,b,L,D,A,R){let B=h.textMaxSize.evaluate(t,{},L);B===void 0?B=g*h.textScaleFactor:B*=h.textScaleFactor;const q=s.layers[0].layout,W=q.get("icon-offset").evaluate(t,{},L),ee=Vy(n.horizontal)||n.vertical,te=D.name==="globe",Y=hs,re=g*h.textScaleFactor/Y,ce=s.tilePixelRatio*B/Y,ve=(dt=s.overscaling,s.zoom>18&&dt>2&&(dt>>=1),Math.max(vn/(512*dt),1)*q.get("symbol-spacing")),Be=q.get("text-padding")*s.tilePixelRatio,Oe=q.get("icon-padding")*s.tilePixelRatio,Pe=ft(q.get("text-max-angle")),nt=q.get("text-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",Ue=q.get("icon-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",lt=q.get("symbol-placement"),_t=ve/2;var dt;const xt=q.get("icon-text-fit").evaluate(t,{},L),Ct=q.get("icon-text-fit-padding").evaluate(t,{},L),Nt=xt!=="none";let wt;s.hasAnyIconTextFit===!1&&Nt&&(s.hasAnyIconTextFit=!0),c&&Nt&&(s.allowVerticalPlacement&&n.vertical&&(wt=Hr(c,n.vertical,xt,Ct,W,re)),ee&&(c=Hr(c,ee,xt,Ct,W,re)));const gi=(Ui,mi,Dn)=>{if(mi.x<0||mi.x>=vn||mi.y<0||mi.y>=vn)return;let Mn=null;if(te){const{x:tn,y:qi,z:nr}=D.projectTilePoint(mi.x,mi.y,Dn);Mn={anchor:new Fa(tn,qi,nr,0,void 0),up:D.upVector(Dn,mi.x,mi.y)}}(function(tn,qi,nr,Fn,Hn,zr,Yr,ta,ia,ma,va,vs,rs,Vr,Ya,Ja,zs,yo,jo,vo,so,Co,rl,mc,Cs,rh,Hf){const uf=tn.addToLineVertexArray(qi,Fn);let hf,ym,nm,vm,mg,bv,wv,Mv=0,Tv=0,Sv=0,Ev=0,G_=-1,H_=-1;const hp={};let Av=be("");const xm=nr?nr.anchor:qi,j_=ia.layout.get("icon-text-fit").evaluate(so,{},Cs)!=="none";let q_=0,W_=0;if(ia._unevaluatedLayout.getValue("text-radial-offset")===void 0?[q_,W_]=ia.layout.get("text-offset").evaluate(so,{},Cs).map(Cd=>Cd*hs):(q_=ia.layout.get("text-radial-offset").evaluate(so,{},Cs)*hs,W_=s_),tn.allowVerticalPlacement&&Hn.vertical){const Cd=Hn.vertical;if(Ya)bv=l_(Cd),ta&&(wv=l_(ta));else{const ah=ia.layout.get("text-rotate").evaluate(so,{},Cs)+90;nm=Eg(ma,xm,qi,va,vs,rs,Cd,Vr,ah,Ja),ta&&(vm=Eg(ma,xm,qi,va,vs,rs,ta,yo,ah))}}if(zr){const Cd=tn.iconSizeData,ah=ia.layout.get("icon-rotate").evaluate(so,{},Cs),gg=Fy(zr,ah,rl,j_,Co.iconScaleFactor),X_=ta?Fy(ta,ah,rl,j_,Co.iconScaleFactor):void 0;ym=Eg(ma,xm,qi,va,vs,rs,zr,yo,ah,null),Mv=4*gg.length;let bm=null;Cd.kind==="source"?(bm=[ao*ia.layout.get("icon-size").evaluate(so,{},Cs)*Co.iconScaleFactor],bm[0]>Qp&&Xn(`${tn.layerIds[0]}: Value for "icon-size" is >= ${Km}. Reduce your "icon-size".`)):Cd.kind==="composite"&&(bm=[ao*Co.compositeIconSizes[0].evaluate(so,{},Cs)*Co.iconScaleFactor,ao*Co.compositeIconSizes[1].evaluate(so,{},Cs)*Co.iconScaleFactor],(bm[0]>Qp||bm[1]>Qp)&&Xn(`${tn.layerIds[0]}: Value for "icon-size" is >= ${Km}. Reduce your "icon-size".`)),tn.addSymbols(tn.icon,gg,bm,vo,jo,so,!1,nr,qi,uf.lineStartIndex,uf.lineLength,-1,mc,Cs,rh,Hf),G_=tn.icon.placedSymbolArray.length-1,X_&&(Tv=4*X_.length,tn.addSymbols(tn.icon,X_,bm,vo,jo,so,Ke.vertical,nr,qi,uf.lineStartIndex,uf.lineLength,-1,mc,Cs,rh,Hf),H_=tn.icon.placedSymbolArray.length-1)}for(const Cd in Hn.horizontal){const ah=Hn.horizontal[Cd];hf||(Av=be(ah.text),Ya?mg=l_(ah):hf=Eg(ma,xm,qi,va,vs,rs,ah,Vr,ia.layout.get("text-rotate").evaluate(so,{},Cs),Ja));const gg=ah.positionedLines.length===1;if(Sv+=Uy(tn,nr,qi,ah,Yr,ia,Ya,so,Ja,uf,Hn.vertical?Ke.horizontal:Ke.horizontalOnly,gg?Object.keys(Hn.horizontal):[Cd],hp,G_,Co,mc,Cs,rh),gg)break}Hn.vertical&&(Ev+=Uy(tn,nr,qi,Hn.vertical,Yr,ia,Ya,so,Ja,uf,Ke.vertical,["vertical"],hp,H_,Co,mc,Cs,rh));let rm=-1;const Z_=(Cd,ah)=>Cd?Math.max(Cd,ah):ah;rm=Z_(mg,rm),rm=Z_(bv,rm),rm=Z_(wv,rm);const nb=rm>-1?1:0;tn.glyphOffsetArray.length>=65535&&Xn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),so.sortKey!==void 0&&tn.addToSortKeyRanges(tn.symbolInstances.length,so.sortKey),tn.symbolInstances.emplaceBack(qi.x,qi.y,xm.x,xm.y,xm.z,hp.right>=0?hp.right:-1,hp.center>=0?hp.center:-1,hp.left>=0?hp.left:-1,hp.vertical>=0?hp.vertical:-1,G_,H_,Av,hf!==void 0?hf:tn.collisionBoxArray.length,hf!==void 0?hf+1:tn.collisionBoxArray.length,nm!==void 0?nm:tn.collisionBoxArray.length,nm!==void 0?nm+1:tn.collisionBoxArray.length,ym!==void 0?ym:tn.collisionBoxArray.length,ym!==void 0?ym+1:tn.collisionBoxArray.length,vm||tn.collisionBoxArray.length,vm?vm+1:tn.collisionBoxArray.length,va,Sv,Ev,Mv,Tv,nb,0,q_,W_,rm,0,j_?1:0)})(s,mi,Mn,Ui,n,c,p,wt,s.layers[0],s.collisionBoxArray,t.index,t.sourceLayerIndex,s.index,Be,nt,C,0,Oe,Ue,W,t,h,P,b,L,A,R)};if(lt==="line")for(const Ui of Iy(t.geometry,0,0,vn,vn)){const mi=r_(Ui,ve,Pe,n.vertical||ee,c,Y,ce,s.overscaling,vn);for(const Dn of mi)ee&&Tx(s,ee.text,_t,Dn)||gi(Ui,Dn,L)}else if(lt==="line-center"){for(const Ui of t.geometry)if(Ui.length>1){const mi=up(Ui,Pe,n.vertical||ee,c,Y,ce);mi&&gi(Ui,mi,L)}}else if(t.type==="Polygon")for(const Ui of zc(t.geometry,0)){const mi=xx(Ui,16);gi(Ui[0],new Fa(mi.x,mi.y,0,0,void 0),L)}else if(t.type==="LineString")for(const Ui of t.geometry)gi(Ui,new Fa(Ui[0].x,Ui[0].y,0,0,void 0),L);else if(t.type==="Point")for(const Ui of t.geometry)for(const mi of Ui)gi([mi],new Fa(mi.x,mi.y,0,0,void 0),L)}const Km=255,Qp=Km*ao;function Uy(s,t,n,c,p,h,g,M,C,P,b,L,D,A,R,B,q,W){const ee=function(re,ce,ve,Be,Oe,Pe,nt,Ue){const lt=[];if(ce.positionedLines.length===0)return lt;const _t=Be.layout.get("text-rotate").evaluate(Pe,{})*Math.PI/180,dt=function(gi){const Ui=gi[0],mi=gi[1],Dn=Ui*mi;return Dn>0?[Ui,-mi]:Dn<0?[-Ui,mi]:Ui===0?[mi,Ui]:[mi,-Ui]}(ve);let xt=Math.abs(ce.top-ce.bottom);for(const gi of ce.positionedLines)xt-=gi.lineOffset;const Ct=ce.positionedLines.length,Nt=xt/Ct;let wt=ce.top-ve[1];for(let gi=0;gi<Ct;++gi){const Ui=ce.positionedLines[gi];wt=vx(ce,Nt,wt,gi);for(const mi of Ui.positionedGlyphs){if(!mi.rect)continue;const Dn=mi.rect||{};let Mn=Ae+1,tn=!0,qi=1,nr=0;if(mi.imageName){const vo=nt[Ts.build(mi.imageName).getSerializedPrimary()];if(!vo)continue;if(vo.sdf){Xn("SDF images are not supported in formatted text and will be ignored.");continue}tn=!1,qi=vo.pixelRatio,Mn=Ym/qi}const Fn=(Oe||Ue)&&mi.vertical,Hn=mi.metrics.advance*mi.scale/2,zr=mi.metrics,Yr=mi.rect;if(Yr===null)continue;Ue&&ce.verticalizable&&(nr=mi.imageName?Hn-mi.metrics.width*mi.scale/2:0);const ta=Oe?[mi.x+Hn,mi.y]:[0,0];let ia=[0,0],ma=[0,0],va=!1;Oe||(Fn?(ma=[mi.x+Hn+dt[0],mi.y+dt[1]-nr],va=!0):ia=[mi.x+Hn+ve[0],mi.y+ve[1]-nr]);const vs=Yr.w*mi.scale/(qi*(mi.localGlyph?Nf:1)),rs=Yr.h*mi.scale/(qi*(mi.localGlyph?Nf:1));let Vr,Ya,Ja,zs;if(Fn){const vo=mi.y-wt,so=new Pi(-Hn,Hn-vo),Co=-Math.PI/2,rl=new Pi(...ma);Vr=new Pi(-Hn+ia[0],ia[1]),Vr._rotateAround(Co,so)._add(rl),Vr.x+=-vo+Hn,Vr.y-=(zr.left-Mn)*mi.scale;const mc=mi.imageName?zr.advance*mi.scale:hs*mi.scale,Cs=String.fromCodePoint(mi.glyph);bg(Cs)?Vr.x+=(1-Mn)*mi.scale:dm(Cs)?Vr.x+=mc-zr.height*mi.scale+(-Mn-1)*mi.scale:Vr.x+=mi.imageName||zr.width+2*Mn===Yr.w&&zr.height+2*Mn===Yr.h?(mc-rs)/2:(mc-(zr.height+2*Mn)*mi.scale)/2,Ya=new Pi(Vr.x,Vr.y-vs),Ja=new Pi(Vr.x+rs,Vr.y),zs=new Pi(Vr.x+rs,Vr.y-vs)}else{const vo=(zr.left-Mn)*mi.scale-Hn+ia[0],so=(-zr.top-Mn)*mi.scale+ia[1],Co=vo+vs,rl=so+rs;Vr=new Pi(vo,so),Ya=new Pi(Co,so),Ja=new Pi(vo,rl),zs=new Pi(Co,rl)}if(_t){let vo;vo=Oe?new Pi(0,0):va?new Pi(dt[0],dt[1]):new Pi(ve[0],ve[1]),Vr._rotateAround(_t,vo),Ya._rotateAround(_t,vo),Ja._rotateAround(_t,vo),zs._rotateAround(_t,vo)}const yo=new Pi(0,0),jo=new Pi(0,0);lt.push({tl:Vr,tr:Ya,bl:Ja,br:zs,texPrimary:Dn,texSecondary:void 0,writingMode:ce.writingMode,glyphOffset:ta,sectionIndex:mi.sectionIndex,isSDF:tn,pixelOffsetTL:yo,pixelOffsetBR:jo,minFontScaleX:0,minFontScaleY:0})}}return lt}(0,c,C,h,g,M,p,s.allowVerticalPlacement),te=s.textSizeData;let Y=null;te.kind==="source"?(Y=[ao*h.layout.get("text-size").evaluate(M,{},q)*R.textScaleFactor],Y[0]>Qp&&Xn(`${s.layerIds[0]}: Value for "text-size" is >= ${Km}. Reduce your "text-size".`)):te.kind==="composite"&&(Y=[ao*R.compositeTextSizes[0].evaluate(M,{},q)*R.textScaleFactor,ao*R.compositeTextSizes[1].evaluate(M,{},q)*R.textScaleFactor],(Y[0]>Qp||Y[1]>Qp)&&Xn(`${s.layerIds[0]}: Value for "text-size" is >= ${Km}. Reduce your "text-size".`)),s.addSymbols(s.text,ee,Y,C,g,M,b,t,n,P.lineStartIndex,P.lineLength,A,B,q,W,!1);for(const re of L)D[re]=s.text.placedSymbolArray.length-1;return 4*ee.length}function Vy(s){for(const t in s)return s[t];return null}function Eg(s,t,n,c,p,h,g,M,C,P){let b=g.top,L=g.bottom,D=g.left,A=g.right;const R=g.collisionPadding;if(R&&(D-=R[0],b-=R[1],A+=R[2],L+=R[3]),C){const B=new Pi(D,b),q=new Pi(A,b),W=new Pi(D,L),ee=new Pi(A,L),te=ft(C);let Y=new Pi(0,0);P&&(Y=new Pi(P[0],P[1])),B._rotateAround(te,Y),q._rotateAround(te,Y),W._rotateAround(te,Y),ee._rotateAround(te,Y),D=Math.min(B.x,q.x,W.x,ee.x),A=Math.max(B.x,q.x,W.x,ee.x),b=Math.min(B.y,q.y,W.y,ee.y),L=Math.max(B.y,q.y,W.y,ee.y)}return s.emplaceBack(t.x,t.y,t.z,n.x,n.y,D,b,A,L,M,c,p,h),s.length-1}function l_(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const t=s.bottom-s.top;return t>0?Math.max(10,t):null}function Tx(s,t,n,c){const p=s.compareText;if(t in p){const h=p[t];for(let g=h.length-1;g>=0;g--)if(c.dist(h[g])<n)return!0}else p[t]=[];return p[t].push(c),!1}function Gy(s,t){const n=s.fovAboveCenter,c=s.elevation?s.elevation.getMinElevationBelowMSL()*t:0,p=(s._camera.position[2]*s.worldSize-c)/Math.cos(s._pitch),h=Math.sin(n)*p/Math.sin(Math.max(Math.PI/2-s._pitch-n,.01));let g=Math.sin(s._pitch)*h+p;const M=p*(1/s._horizonShift);if(!s.elevation||s.elevation.exaggeration()===0){let C=Math.max(s.zoom-17,0);s.isOrthographic&&(C/=10),g*=1+C}return Math.min(1.01*g,M)}function Jm(s,t){if(!t.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:t};const n=Math.pow(2,-s.z),c=s.x*n,p=(s.x+1)*n,h=s.y*n,g=(s.y+1)*n,M=ho(c),C=ho(p),P=Is(h),b=Is(g),L=t.project(M,P),D=t.project(C,P),A=t.project(C,b),R=t.project(M,b);let B=Math.min(L.x,D.x,A.x,R.x),q=Math.min(L.y,D.y,A.y,R.y),W=Math.max(L.x,D.x,A.x,R.x),ee=Math.max(L.y,D.y,A.y,R.y);const te=n/16;function Y(ce,ve,Be,Oe,Pe,nt){const Ue=(Be+Pe)/2,lt=(Oe+nt)/2,_t=t.project(ho(Ue),Is(lt)),dt=Math.max(0,B-_t.x,q-_t.y,_t.x-W,_t.y-ee);B=Math.min(B,_t.x),W=Math.max(W,_t.x),q=Math.min(q,_t.y),ee=Math.max(ee,_t.y),dt>te&&(Y(ce,_t,Be,Oe,Ue,lt),Y(_t,ve,Ue,lt,Pe,nt))}Y(L,D,c,h,p,h),Y(D,A,p,h,p,g),Y(A,R,p,g,c,g),Y(R,L,c,g,c,h),B-=te,q-=te,W+=te,ee+=te;const re=1/Math.max(W-B,ee-q);return{scale:re,x:B*re,y:q*re,x2:W*re,y2:ee*re,projection:t}}function Hy(s,{x:t,y:n},c=0){return new Pi(((t-c)*s.scale-s.x)*vn,(n*s.scale-s.y)*vn)}const Sx=et.mat4.identity(new Float32Array(16));class em{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,n){return{x:0,y:0,z:0}}unproject(t,n){return new xa(0,0)}projectTilePoint(t,n,c){return{x:t,y:n,z:0}}locationPoint(t,n,c=!0){return t._coordinatePoint(t.locationCoordinate(n),c)}pixelsPerMeter(t,n){return io(1,t)*n}pixelSpaceConversion(t,n,c){return 1}farthestPixelDistance(t){return Gy(t,t.pixelsPerMeter)}pointCoordinate(t,n,c,p){const h=t.horizonLineFromTop(!1),g=new Pi(n,Math.max(h,c));return t.rayIntersectionCoordinate(t.pointRayIntersection(g,p))}pointCoordinate3D(t,n,c){const p=new Pi(n,c);if(t.elevation)return t.elevation.pointCoordinate(p);{const h=this.pointCoordinate(t,p.x,p.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(t,n){if(t.elevation&&t.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(t,n.x,n.y);const c=t.horizonLineFromTop();return n.y<c}createInversionMatrix(t,n){return Sx}createTileMatrix(t,n,c){let p,h,g;const M=c.canonical,C=et.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const P=Jm(M,this);p=1,h=P.x+c.wrap*P.scale,g=P.y,et.mat4.scale(C,C,[p/P.scale,p/P.scale,t.pixelsPerMeter/n])}else p=n/t.zoomScale(M.z),h=(M.x+Math.pow(2,M.z)*c.wrap)*p,g=M.y*p;return et.mat4.translate(C,C,[h,g,0]),et.mat4.scale(C,C,[p/vn,p/vn,1]),C}upVector(t,n,c){return[0,0,1]}upVectorScale(t,n,c){return{metersToTile:1}}}class Ex extends em{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[n,c]=this.parallels=t.parallels||[29.5,45.5],p=Math.sin(ft(n));this.n=(p+Math.sin(ft(c)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(t,n){const{n:c,c:p,r0:h}=this,g=ft(t-this.center[0]),M=ft(n),C=Math.sqrt(p-2*c*Math.sin(M))/c;return{x:C*Math.sin(g*c),y:C*Math.cos(g*c)-h,z:0}}unproject(t,n){const{n:c,c:p,r0:h}=this,g=h+n;let M=Math.atan2(t,Math.abs(g))*Math.sign(g);g*c<0&&(M-=Math.PI*Math.sign(t)*Math.sign(g));const C=ft(this.center[0])*c;M=wn(M,-Math.PI-C,Math.PI-C);const P=ii(ct(M/c)+this.center[0],-180,180),b=Math.asin(ii((p-(t*t+g*g)*c*c)/(2*c),-1,1)),L=ii(ct(b),-85.051129,Va);return new xa(P,L)}}const Qm=1.340264,eg=-.081106,tg=893e-6,ig=.003796,Ag=Math.sqrt(3)/2;class Ax extends em{project(t,n){n=n/180*Math.PI,t=t/180*Math.PI;const c=Math.asin(Ag*Math.sin(n)),p=c*c,h=p*p*p;return{x:.5*(t*Math.cos(c)/(Ag*(Qm+3*eg*p+h*(7*tg+9*ig*p)))/Math.PI+.5),y:1-.5*(c*(Qm+eg*p+h*(tg+ig*p))/Math.PI+1),z:0}}unproject(t,n){t=(2*t-.5)*Math.PI;let c=n=(2*(1-n)-1)*Math.PI,p=c*c,h=p*p*p;for(let b,L,D,A=0;A<12&&(L=c*(Qm+eg*p+h*(tg+ig*p))-n,D=Qm+3*eg*p+h*(7*tg+9*ig*p),b=L/D,c=ii(c-b,-Math.PI/3,Math.PI/3),p=c*c,h=p*p*p,!(Math.abs(b)<1e-12));++A);const g=Ag*t*(Qm+3*eg*p+h*(7*tg+9*ig*p))/Math.cos(c),M=Math.asin(Math.sin(c)/Ag),C=ii(180*g/Math.PI,-180,180),P=ii(180*M/Math.PI,-85.051129,Va);return new xa(C,P)}}class Cx extends em{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,n){return{x:.5+t/360,y:.5-n/360,z:0}}unproject(t,n){const c=360*(t-.5),p=ii(360*(.5-n),-85.051129,Va);return new xa(c,p)}}const Pm=Math.PI/2;function Cg(s){return Math.tan((Pm+s)/2)}class Lx extends em{constructor(t){super(t),this.center=t.center||[0,30];const[n,c]=this.parallels=t.parallels||[30,30];let p=ft(n),h=ft(c);this.southernCenter=p+h<0,this.southernCenter&&(p=-p,h=-h);const g=Math.cos(p),M=Cg(p);this.n=p===h?Math.sin(p):Math.log(g/Math.cos(h))/Math.log(Cg(h)/M),this.f=g*Math.pow(Cg(p),this.n)/this.n}project(t,n){n=ft(n),this.southernCenter&&(n=-n),t=ft(t-this.center[0]);const c=1e-6,{n:p,f:h}=this;h>0?n<-Pm+c&&(n=-Pm+c):n>Pm-c&&(n=Pm-c);const g=h/Math.pow(Cg(n),p);let M=g*Math.sin(p*t),C=h-g*Math.cos(p*t);return M=.5*(M/Math.PI+.5),C=.5*(C/Math.PI+.5),{x:M,y:this.southernCenter?C:1-C,z:0}}unproject(t,n){t=(2*t-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:c,f:p}=this,h=p-n,g=Math.sign(h),M=Math.sign(c)*Math.sqrt(t*t+h*h);let C=Math.atan2(t,Math.abs(h))*g;h*c<0&&(C-=Math.PI*Math.sign(t)*g);const P=ii(ct(C/c)+this.center[0],-180,180),b=ii(ct(2*Math.atan(Math.pow(p/M,1/c))-Pm),-85.051129,Va);return new xa(P,this.southernCenter?-b:b)}}class jy extends em{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,n){return{x:cl(t),y:Pl(n),z:0}}unproject(t,n){const c=ho(t),p=Is(n);return new xa(c,p)}}const qy=ft(Va);class Rx extends em{project(t,n){const c=(n=ft(n))*n,p=c*c;return{x:.5*((t=ft(t))*(.8707-.131979*c+p*(p*(.003971*c-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+c*(.015085+p*(.028874*c-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(t,n){t=(2*t-.5)*Math.PI;let c=n=(2*(1-n)-1)*Math.PI,p=25,h=0,g=c*c;do{g=c*c;const P=g*g;h=(c*(1.007226+g*(.015085+P*(.028874*g-.044475-.005916*P)))-n)/(1.007226+g*(.045255+P*(.259866*g-.311325-.005916*11*P))),c=ii(c-h,-qy,qy)}while(Math.abs(h)>1e-6&&--p>0);g=c*c;const M=ii(ct(t/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),C=ct(c);return new xa(M,C)}}const Wy=ft(Va);class Ix extends em{project(t,n){n=ft(n),t=ft(t);const c=Math.cos(n),p=2/Math.PI,h=Math.acos(c*Math.cos(t/2)),g=Math.sin(h)/h,M=.5*(t*p+2*c*Math.sin(t/2)/g)||0,C=.5*(n+Math.sin(n)/g)||0;return{x:.5*(M/Math.PI+.5),y:1-.5*(C/Math.PI+1),z:0}}unproject(t,n){let c=t=(2*t-.5)*Math.PI,p=n=(2*(1-n)-1)*Math.PI,h=25;const g=1e-6;let M=0,C=0;do{const P=Math.cos(p),b=Math.sin(p),L=2*b*P,D=b*b,A=P*P,R=Math.cos(c/2),B=Math.sin(c/2),q=2*R*B,W=B*B,ee=1-A*R*R,te=ee?1/ee:0,Y=ee?Math.acos(P*R)*Math.sqrt(1/ee):0,re=.5*(2*Y*P*B+2*c/Math.PI)-t,ce=.5*(Y*b+p)-n,ve=.5*te*(A*W+Y*P*R*D)+1/Math.PI,Be=te*(q*L/4-Y*b*B),Oe=.125*te*(L*B-Y*b*A*q),Pe=.5*te*(D*R+Y*W*P)+.5,nt=Be*Oe-Pe*ve;M=(ce*Be-re*Pe)/nt,C=(re*Oe-ce*ve)/nt,c=ii(c-M,-Math.PI,Math.PI),p=ii(p-C,-Wy,Wy)}while((Math.abs(M)>g||Math.abs(C)>g)&&--h>0);return new xa(ct(c),ct(p))}}class Zy extends em{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ft(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,n){const{scale:c,cosPhi:p}=this;return{x:ft(t)*p*c+.5,y:-Math.sin(ft(n))/p*c+.5,z:0}}unproject(t,n){const{scale:c,cosPhi:p}=this,h=-(n-.5)/c,g=ii(ct((t-.5)/c)/p,-180,180),M=Math.asin(ii(h*p,-1,1)),C=ii(ct(M),-85.051129,Va);return new xa(g,C)}}class Dx extends jy{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,n,c){const p=Sa(t,n,c),h=Os(ns(c));return et.vec3.transformMat4(p,p,h),{x:p[0],y:p[1],z:p[2]}}locationPoint(t,n){const c=xu(n.lat,n.lng),p=et.vec3.normalize([],c),h=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(n),t._centerAltitude):t._centerAltitude,g=io(1,0)*vn*h;et.vec3.scaleAndAdd(c,c,p,g);const M=et.mat4.identity(new Float64Array(16));return et.mat4.multiply(M,t.pixelMatrix,t.globeMatrix),et.vec3.transformMat4(c,c,M),new Pi(c[0],c[1])}pixelsPerMeter(t,n){return io(1,0)*n}pixelSpaceConversion(t,n,c){const p=io(1,t)*n,h=Ee(io(1,45)*n,p,c);return this.pixelsPerMeter(t,n)/h}createTileMatrix(t,n,c){const p=Oa(ns(c.canonical));return et.mat4.multiply(new Float64Array(16),t.globeMatrix,p)}createInversionMatrix(t,n){const{center:c}=t,p=Os(ns(n));return et.mat4.rotateY(p,p,ft(c.lng)),et.mat4.rotateX(p,p,ft(c.lat)),et.mat4.scale(p,p,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(t,n,c,p){return yr(t,n,c,!0)||new a(0,0)}pointCoordinate3D(t,n,c){const p=this.pointCoordinate(t,n,c,0);return[p.x,p.y,p.z]}isPointAboveHorizon(t,n){return!yr(t,n.x,n.y,!1)}farthestPixelDistance(t){const n=function(p,h){const g=p.cameraToCenterDistance,M=p._centerAltitude*h,C=p._camera,P=p._camera.forward(),b=et.vec3.add([],et.vec3.scale([],P,-g),[0,0,M]),L=p.worldSize/(2*Math.PI),D=[0,0,-L],A=p.width/p.height,R=Math.tan(p.fovAboveCenter),B=et.vec3.scale([],C.up(),R),q=et.vec3.scale([],C.right(),R*A),W=et.vec3.normalize([],et.vec3.add([],et.vec3.add([],P,B),q)),ee=[];let te;if(new wr(b,W).closestPointOnSphere(D,L,ee)){const Y=et.vec3.add([],ee,D),re=et.vec3.sub([],Y,b);te=Math.cos(p.fovAboveCenter)*et.vec3.length(re)}else{const Y=et.vec3.sub([],b,D),re=et.vec3.sub([],D,b);et.vec3.normalize(re,re);const ce=et.vec3.length(Y)-L;te=Math.sqrt(ce*(ce+2*L));const ve=Math.acos(te/(L+ce))-Math.acos(et.vec3.dot(P,re));te*=Math.cos(ve)}return 1.01*te}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),c=No(t.zoom);if(c>0){const p=Gy(t,io(1,t.center.lat)*t.worldSize),h=t.worldSize/(2*Math.PI),g=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Ee(n,p+h*(1-Math.cos(g)),Math.pow(c,10))}return n}upVector(t,n,c){return Sa(n,c,t,1)}upVectorScale(t){return{metersToTile:_r(ha(ns(t)))}}}function Xy(s){const t=s.parallels,n=!!t&&Math.abs(t[0]+t[1])<.01;switch(s.name){case"mercator":return new jy(s);case"equirectangular":return new Cx(s);case"naturalEarth":return new Rx(s);case"equalEarth":return new Ax(s);case"winkelTripel":return new Ix(s);case"albers":return n?new Zy(s):new Ex(s);case"lambertConformalConic":return n?new Zy(s):new Lx(s);case"globe":return new Dx(s)}throw new Error(`Invalid projection name: ${s.name}`)}const zx=ye.VectorTileFeature.types,Px=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Lg(s,t,n,c,p,h,g,M,C,P,b,L,D){const A=M?Math.min(Qp,Math.round(M[0])):0,R=M?Math.min(Qp,Math.round(M[1])):0;s.emplaceBack(t,n,Math.round(32*c),Math.round(32*p),h,g,(A<<1)+(C?1:0),R,16*P,16*b,256*L,256*D)}function Rg(s,t,n){s.emplaceBack(t,n)}function Ig(s,t,n,c,p,h,g){s.emplaceBack(t,n,c,p,h,g)}function Dg(s,t,n,c,p){s.emplaceBack(t,n,c,p),s.emplaceBack(t,n,c,p),s.emplaceBack(t,n,c,p),s.emplaceBack(t,n,c,p)}function Ox(s){for(const t of s.sections)if(Mh(t.text))return!0;return!1}class c_{constructor(t){this.layoutVertexArray=new Yd,this.indexArray=new uo,this.programConfigurations=t,this.segments=new bs,this.dynamicLayoutVertexArray=new qc,this.opacityVertexArray=new hd,this.placedSymbolArray=new Oh,this.iconTransitioningVertexArray=new fu,this.globeExtVertexArray=new Tf,this.zOffsetVertexArray=new Ec}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(t,n,c,p,h){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,La.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Bs.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Px,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,wl.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Ed.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||h)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,pc.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||p)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}kn(c_,"SymbolBuffers");class u_{constructor(t,n,c){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new c,this.segments=new bs,this.collisionVertexArray=new dd,this.collisionVertexArrayExt=new qc}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,nh.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,Su.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}kn(u_,"CollisionBuffers");class zg{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.lut=t.lut,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=et.mat4.identity([]),this.placementViewportMatrix=et.mat4.identity([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Cm(this.zoom,n["text-size"]),this.iconSizeData=Cm(this.zoom,n["icon-size"]);const c=this.layers[0].layout,p=c.get("symbol-sort-key"),h=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(g=>Ke[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=c.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new c_(new Yl(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("text")||t.startsWith("symbol"))),this.icon=new c_(new Yl(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("icon")||t.startsWith("symbol"))),this.glyphOffsetArray=new Lc,this.lineVertexArray=new Zs,this.symbolInstances=new md}calculateGlyphDependencies(t,n,c,p,h){for(const g of t){const M=g.codePointAt(0);if(M===void 0)break;if(n[M]=!0,p&&h&&M<=65535){const C=cp[g];C&&(n[C.charCodeAt(0)]=!0)}}}updateFootprints(t,n){}updateReplacement(t,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const c=n.getReplacementRegionsForTile(t.toUnwrapped(),!0);return!Bi(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}populate(t,n,c,p){const h=this.layers[0],g=h.layout,M=this.projection.name==="globe",C=g.get("text-font"),P=g.get("text-field"),b=g.get("icon-image"),[L,D]=g.get("icon-size-scale-range"),A=ii(n.scaleFactor||1,L,D),R=(P.value.kind!=="constant"||P.value.value instanceof ds&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),B=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,q=g.get("symbol-sort-key");if(this.features=[],!R&&!B)return;const W=n.iconDependencies,ee=n.glyphDependencies,te=n.availableImages,Y=new Ka(this.zoom);for(const{feature:re,id:ce,index:ve,sourceLayerIndex:Be}of t){const Oe=h._featureFilter.needGeometry,Pe=Z(re,Oe);if(!h._featureFilter.filter(Y,Pe,c))continue;if(Oe||(Pe.geometry=j(re,c,p)),M&&re.type!==1&&c.z<=5){const dt=Pe.geometry,xt=.98078528056,Ct=(Nt,wt)=>{const gi=Sa(Nt.x,Nt.y,c,1),Ui=Sa(wt.x,wt.y,c,1);return et.vec3.dot(gi,Ui)<xt};for(let Nt=0;Nt<dt.length;Nt++)dt[Nt]=T(dt[Nt],Ct)}let nt,Ue;if(R){const dt=h.getValueAndResolveTokens("text-field",Pe,c,te),xt=ds.factory(dt);Ox(xt)&&(this.hasRTLText=!0),(!this.hasRTLText||ju()==="unavailable"||this.hasRTLText&&us.isParsed())&&(nt=Lm(xt,h,Pe))}if(B){const dt=h.getValueAndResolveTokens("icon-image",Pe,c,te);Ue=dt instanceof Ts?dt:Ts.build(dt)}if(!nt&&!Ue)continue;const lt=this.sortFeaturesByKey?q.evaluate(Pe,{},c):void 0,_t={id:ce,text:nt,icon:Ue,index:ve,sourceLayerIndex:Be,geometry:Pe.geometry,properties:re.properties,type:zx[re.type],sortKey:lt};if(this.features.push(_t),Ue){const dt=eu(this.iconSizeData,this.layers[0]._unevaluatedLayout._values["icon-size"],c,this.zoom,_t)*A*this.pixelRatio,xt=Ue.getPrimary().scaleSelf(dt);if(W[xt.id]=W[xt.id]||[],W[xt.id].push(xt),Ue.nameSecondary){const Ct=Ue.getSecondary().scaleSelf(dt);W[Ct.id]=W[Ct.id]||[],W[Ct.id].push(Ct)}}if(nt){const dt=C.evaluate(Pe,{},c).join(","),xt=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ke.vertical)>=0;for(const Ct of nt.sections)if(Ct.image){const Nt=Ct.image.getPrimary().scaleSelf(this.pixelRatio);W[Nt.id]=W[Nt.id]||[],W[Nt.id].push(Nt)}else{const Nt=ys(nt.toString()),wt=Ct.fontStack||dt,gi=ee[wt]=ee[wt]||{};this.calculateGlyphDependencies(Ct.text,gi,xt,this.allowVerticalPlacement,Nt)}}}g.get("symbol-placement")==="line"&&(this.features=function(re){const ce={},ve={},Be=[];let Oe=0;function Pe(_t){Be.push(re[_t]),Oe++}function nt(_t,dt,xt){const Ct=ve[_t];return delete ve[_t],ve[dt]=Ct,Be[Ct].geometry[0].pop(),Be[Ct].geometry[0]=Be[Ct].geometry[0].concat(xt[0]),Ct}function Ue(_t,dt,xt){const Ct=ce[dt];return delete ce[dt],ce[_t]=Ct,Be[Ct].geometry[0].shift(),Be[Ct].geometry[0]=xt[0].concat(Be[Ct].geometry[0]),Ct}function lt(_t,dt,xt){const Ct=xt?dt[0][dt[0].length-1]:dt[0][0];return`${_t}:${Ct.x}:${Ct.y}`}for(let _t=0;_t<re.length;_t++){const dt=re[_t],xt=dt.geometry,Ct=dt.text?dt.text.toString():null;if(!Ct){Pe(_t);continue}const Nt=lt(Ct,xt),wt=lt(Ct,xt,!0);if(Nt in ve&&wt in ce&&ve[Nt]!==ce[wt]){const gi=Ue(Nt,wt,xt),Ui=nt(Nt,wt,Be[gi].geometry);delete ce[Nt],delete ve[wt],ve[lt(Ct,Be[Ui].geometry,!0)]=Ui,Be[gi].geometry=null}else Nt in ve?nt(Nt,wt,xt):wt in ce?Ue(Nt,wt,xt):(Pe(_t),ce[Nt]=Oe-1,ve[wt]=Oe-1)}return Be.filter(_t=>_t.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((re,ce)=>re.sortKey-ce.sortKey)}update(t,n,c,p,h,g,M){this.text.programConfigurations.updatePaintArrays(t,n,h,c,p,g,M),this.icon.programConfigurations.updatePaintArrays(t,n,h,c,p,g,M)}updateZOffset(){const t=(h,g,M)=>{c+=g,c>h.length&&h.resize(c);for(let C=-g;C<0;C++)h.emplace(C+c,M)},n=(h,g,M)=>{p+=g,p>h.length&&h.resize(p);for(let C=-g;C<0;C++)h.emplace(C+p,M)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,p=0;for(let h=0;h<this.symbolInstances.length;h++){const g=this.symbolInstances.get(h),{numHorizontalGlyphVertices:M,numVerticalGlyphVertices:C,numIconVertices:P}=g,b=g.zOffset,L=P>0;if((M>0||C>0)&&(t(this.text.zOffsetVertexArray,M,b),t(this.text.zOffsetVertexArray,C,b)),L){const{placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:A}=g;D>=0&&n(this.icon.zOffsetVertexArray,P,b),A>=0&&n(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,b)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Xy(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const c=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:p,y:h}of n)this.lineVertexArray.emplaceBack(p,h);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,n,c,p,h,g,M,C,P,b,L,D,A,R,B,q){const W=t.indexArray,ee=t.layoutVertexArray,te=t.globeExtVertexArray,Y=t.segments.prepareSegment(4*n.length,ee,W,this.canOverlap?g.sortKey:void 0),re=this.glyphOffsetArray.length,ce=Y.vertexLength,ve=this.allowVerticalPlacement&&M===Ke.vertical?Math.PI/2:0,Be=g.text&&g.text.sections;for(let Pe=0;Pe<n.length;Pe++){const{tl:nt,tr:Ue,bl:lt,br:_t,texPrimary:dt,texSecondary:xt,pixelOffsetTL:Ct,pixelOffsetBR:Nt,minFontScaleX:wt,minFontScaleY:gi,glyphOffset:Ui,isSDF:mi,sectionIndex:Dn}=n[Pe],Mn=Y.vertexLength,tn=Ui[1];if(Lg(ee,P.x,P.y,nt.x,tn+nt.y,dt.x,dt.y,c,mi,Ct.x,Ct.y,wt,gi),Lg(ee,P.x,P.y,Ue.x,tn+Ue.y,dt.x+dt.w,dt.y,c,mi,Nt.x,Ct.y,wt,gi),Lg(ee,P.x,P.y,lt.x,tn+lt.y,dt.x,dt.y+dt.h,c,mi,Ct.x,Nt.y,wt,gi),Lg(ee,P.x,P.y,_t.x,tn+_t.y,dt.x+dt.w,dt.y+dt.h,c,mi,Nt.x,Nt.y,wt,gi),C){const{x:qi,y:nr,z:Fn}=C.anchor,[Hn,zr,Yr]=C.up;Ig(te,qi,nr,Fn,Hn,zr,Yr),Ig(te,qi,nr,Fn,Hn,zr,Yr),Ig(te,qi,nr,Fn,Hn,zr,Yr),Ig(te,qi,nr,Fn,Hn,zr,Yr),Dg(t.dynamicLayoutVertexArray,qi,nr,Fn,ve)}else Dg(t.dynamicLayoutVertexArray,P.x,P.y,P.z,ve);if(q){const qi=xt||dt;Rg(t.iconTransitioningVertexArray,qi.x,qi.y),Rg(t.iconTransitioningVertexArray,qi.x+qi.w,qi.y),Rg(t.iconTransitioningVertexArray,qi.x,qi.y+qi.h),Rg(t.iconTransitioningVertexArray,qi.x+qi.w,qi.y+qi.h)}W.emplaceBack(Mn,Mn+1,Mn+2),W.emplaceBack(Mn+1,Mn+2,Mn+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ui[0]),Pe!==n.length-1&&Dn===n[Pe+1].sectionIndex||t.programConfigurations.populatePaintArrays(ee.length,g,g.index,{},A,R,B,Be&&Be[Dn])}const Oe=C?C.anchor:P;t.placedSymbolArray.emplaceBack(Oe.x,Oe.y,Oe.z,P.x,P.y,re,this.glyphOffsetArray.length-re,ce,b,L,P.segment,c?c[0]:0,c?c[1]:0,p[0],p[1],M,0,!1,0,D,0)}_commitLayoutVertex(t,n,c,p,h,g,M){t.emplaceBack(n,c,p,h,g,Math.round(M.x),Math.round(M.y))}_addCollisionDebugVertices(t,n,c,p,h,g,M){const C=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),P=C.vertexLength,b=M.tileAnchorX,L=M.tileAnchorY;for(let A=0;A<4;A++)c.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,n,t.padding,M.zOffset),this._commitLayoutVertex(c.layoutVertexArray,p,h,g,b,L,new Pi(t.x1,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,h,g,b,L,new Pi(t.x2,t.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,h,g,b,L,new Pi(t.x2,t.y2)),this._commitLayoutVertex(c.layoutVertexArray,p,h,g,b,L,new Pi(t.x1,t.y2)),C.vertexLength+=4;const D=c.indexArray;D.emplaceBack(P,P+1),D.emplaceBack(P+1,P+2),D.emplaceBack(P+2,P+3),D.emplaceBack(P+3,P),C.primitiveLength+=4}_addTextDebugCollisionBoxes(t,n,c,p,h,g){for(let M=p;M<h;M++){const C=c.get(M),P=this.getSymbolInstanceTextSize(t,g,n,M);this._addCollisionDebugVertices(C,P,this.textCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(t,n,c,p,h,g){for(let M=p;M<h;M++){const C=c.get(M),P=this.getSymbolInstanceIconSize(t,n,g.placedIconSymbolIndex);this._addCollisionDebugVertices(C,P,this.iconCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,g)}}generateCollisionDebugBuffers(t,n,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new u_(Wu,Ys.members,fu),this.iconCollisionBox=new u_(Wu,Ys.members,fu);const p=zp(this.iconSizeData,t),h=zp(this.textSizeData,t,c);for(let g=0;g<this.symbolInstances.length;g++){const M=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(h,t,n,M.textBoxStartIndex,M.textBoxEndIndex,M),this._addTextDebugCollisionBoxes(h,t,n,M.verticalTextBoxStartIndex,M.verticalTextBoxEndIndex,M),this._addIconDebugCollisionBoxes(p,t,n,M.iconBoxStartIndex,M.iconBoxEndIndex,M),this._addIconDebugCollisionBoxes(p,t,n,M.verticalIconBoxStartIndex,M.verticalIconBoxEndIndex,M)}}getSymbolInstanceTextSize(t,n,c,p){const h=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:p),g=Dp(this.textSizeData,t,h)/hs;return this.tilePixelRatio*g}getSymbolInstanceIconSize(t,n,c){const p=this.icon.placedSymbolArray.get(c),h=Dp(this.iconSizeData,t,p);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(t,n,c,p){t.emplaceBack(n,-c,-c,p),t.emplaceBack(n,c,-c,p),t.emplaceBack(n,c,c,p),t.emplaceBack(n,-c,c,p)}_updateTextDebugCollisionBoxes(t,n,c,p,h,g,M){for(let C=p;C<h;C++){const P=c.get(C),b=this.getSymbolInstanceTextSize(t,g,n,C);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,P.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(t,n,c,p,h,g,M){for(let C=p;C<h;C++){const P=c.get(C),b=this.getSymbolInstanceIconSize(t,n,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,P.padding,g.zOffset)}}updateCollisionDebugBuffers(t,n,c,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=zp(this.iconSizeData,t,p),g=zp(this.textSizeData,t,c);for(let M=0;M<this.symbolInstances.length;M++){const C=this.symbolInstances.get(M);this._updateTextDebugCollisionBoxes(g,t,n,C.textBoxStartIndex,C.textBoxEndIndex,C,c),this._updateTextDebugCollisionBoxes(g,t,n,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C,c),this._updateIconDebugCollisionBoxes(h,t,n,C.iconBoxStartIndex,C.iconBoxEndIndex,C,p),this._updateIconDebugCollisionBoxes(h,t,n,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex,C,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,n,c,p,h,g,M,C,P){const b={};if(n<c){const{x1:L,y1:D,x2:A,y2:R,padding:B,projectedAnchorX:q,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:Y,featureIndex:re}=t.get(n);b.textBox={x1:L,y1:D,x2:A,y2:R,padding:B,projectedAnchorX:q,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:Y},b.textFeatureIndex=re}if(p<h){const{x1:L,y1:D,x2:A,y2:R,padding:B,projectedAnchorX:q,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:Y,featureIndex:re}=t.get(p);b.verticalTextBox={x1:L,y1:D,x2:A,y2:R,padding:B,projectedAnchorX:q,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:Y},b.verticalTextFeatureIndex=re}if(g<M){const{x1:L,y1:D,x2:A,y2:R,padding:B,projectedAnchorX:q,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:Y,featureIndex:re}=t.get(g);b.iconBox={x1:L,y1:D,x2:A,y2:R,padding:B,projectedAnchorX:q,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:Y},b.iconFeatureIndex=re}if(C<P){const{x1:L,y1:D,x2:A,y2:R,padding:B,projectedAnchorX:q,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:Y,featureIndex:re}=t.get(C);b.verticalIconBox={x1:L,y1:D,x2:A,y2:R,padding:B,projectedAnchorX:q,projectedAnchorY:W,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:Y},b.verticalIconFeatureIndex=re}return b}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const c=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,n){const c=t.placedSymbolArray.get(n),p=c.vertexStartIndex+4*c.numGlyphs;for(let h=c.vertexStartIndex;h<p;h+=4)t.indexArray.emplaceBack(h,h+1,h+2),t.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),c=Math.cos(t),p=[],h=[],g=[];for(let M=0;M<this.symbolInstances.length;++M){g.push(M);const C=this.symbolInstances.get(M);p.push(0|Math.round(n*C.tileAnchorX+c*C.tileAnchorY)),h.push(C.featureIndex)}return g.sort((M,C)=>p[M]-p[C]||h[C]-h[M]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,n){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===n?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const c=this.symbolInstances.get(n);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:M,placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:P}=c;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),h>=0&&h!==p&&this.addIndicesForPlacedSymbol(this.text,h),g>=0&&g!==h&&g!==p&&this.addIndicesForPlacedSymbol(this.text,g),M>=0&&this.addIndicesForPlacedSymbol(this.text,M),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Yy,$y,h_;kn(zg,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),zg.addDynamicAttributes=Dg;class Ky{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:on,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}kn(Ky,"FormatSectionOverride",{omit:["defaultValue"]});const d_=()=>h_||(h_={layout:Yy||(Yy=new ss({"symbol-placement":new Ri(Ht.layout_symbol["symbol-placement"]),"symbol-spacing":new Ri(Ht.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ri(Ht.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Pn(Ht.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ri(Ht.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ri(Ht.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Ri(Ht.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Ri(Ht.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ri(Ht.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ri(Ht.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ri(Ht.layout_symbol["icon-rotation-alignment"]),"icon-size":new Pn(Ht.layout_symbol["icon-size"]),"icon-size-scale-range":new Ri(Ht.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Pn(Ht.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Pn(Ht.layout_symbol["icon-text-fit-padding"]),"icon-image":new Pn(Ht.layout_symbol["icon-image"]),"icon-rotate":new Pn(Ht.layout_symbol["icon-rotate"]),"icon-padding":new Ri(Ht.layout_symbol["icon-padding"]),"icon-keep-upright":new Ri(Ht.layout_symbol["icon-keep-upright"]),"icon-offset":new Pn(Ht.layout_symbol["icon-offset"]),"icon-anchor":new Pn(Ht.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ri(Ht.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ri(Ht.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ri(Ht.layout_symbol["text-rotation-alignment"]),"text-field":new Pn(Ht.layout_symbol["text-field"]),"text-font":new Pn(Ht.layout_symbol["text-font"]),"text-size":new Pn(Ht.layout_symbol["text-size"]),"text-size-scale-range":new Ri(Ht.layout_symbol["text-size-scale-range"]),"text-max-width":new Pn(Ht.layout_symbol["text-max-width"]),"text-line-height":new Pn(Ht.layout_symbol["text-line-height"]),"text-letter-spacing":new Pn(Ht.layout_symbol["text-letter-spacing"]),"text-justify":new Pn(Ht.layout_symbol["text-justify"]),"text-radial-offset":new Pn(Ht.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ri(Ht.layout_symbol["text-variable-anchor"]),"text-anchor":new Pn(Ht.layout_symbol["text-anchor"]),"text-max-angle":new Ri(Ht.layout_symbol["text-max-angle"]),"text-writing-mode":new Ri(Ht.layout_symbol["text-writing-mode"]),"text-rotate":new Pn(Ht.layout_symbol["text-rotate"]),"text-padding":new Ri(Ht.layout_symbol["text-padding"]),"text-keep-upright":new Ri(Ht.layout_symbol["text-keep-upright"]),"text-transform":new Pn(Ht.layout_symbol["text-transform"]),"text-offset":new Pn(Ht.layout_symbol["text-offset"]),"text-allow-overlap":new Ri(Ht.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ri(Ht.layout_symbol["text-ignore-placement"]),"text-optional":new Ri(Ht.layout_symbol["text-optional"]),visibility:new Ri(Ht.layout_symbol.visibility)})),paint:$y||($y=new ss({"icon-opacity":new Pn(Ht.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Pn(Ht.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Pn(Ht.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Pn(Ht.paint_symbol["text-emissive-strength"]),"icon-color":new Pn(Ht.paint_symbol["icon-color"]),"icon-halo-color":new Pn(Ht.paint_symbol["icon-halo-color"]),"icon-halo-width":new Pn(Ht.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Pn(Ht.paint_symbol["icon-halo-blur"]),"icon-translate":new Ri(Ht.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ri(Ht.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Pn(Ht.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Pn(Ht.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Pn(Ht.paint_symbol["text-occlusion-opacity"]),"text-color":new Pn(Ht.paint_symbol["text-color"],{runtimeType:qn,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Pn(Ht.paint_symbol["text-halo-color"]),"text-halo-width":new Pn(Ht.paint_symbol["text-halo-width"]),"text-halo-blur":new Pn(Ht.paint_symbol["text-halo-blur"]),"text-translate":new Ri(Ht.paint_symbol["text-translate"]),"text-translate-anchor":new Ri(Ht.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ri(Ht.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ri(Ht.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ri(Ht.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ri(Ht.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Pn(Ht.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},h_);class Pg extends qs{constructor(t,n,c,p){super(t,d_(),n,c,p),this._colorAdjustmentMatrix=et.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=t.paint!==void 0&&("icon-occlusion-opacity"in t.paint||"text-occlusion-opacity"in t.paint)}recalculate(t,n){super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const p=[];for(const h of c)p.indexOf(h)<0&&p.push(h);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(t,n,c,p){return this._saturation===t&&this._contrast===n&&this._brightnessMin===c&&this._brightnessMax===p||(this._colorAdjustmentMatrix=function(h,g,M,C){h=ht(h),g=Ls(g);const P=et.mat4.create(),b=h/3,L=1-2*b,D=[L,b,b,0,b,L,b,0,b,b,L,0,0,0,0,1],A=.5-.5*g,R=C-M;return et.mat4.multiply(P,[R,0,0,0,0,R,0,0,0,0,R,0,M,M,M,1],[g,0,0,0,0,g,0,0,0,0,g,0,A,A,A,1]),et.mat4.multiply(P,P,D),P}(t,n,c,p),this._saturation=t,this._contrast=n,this._brightnessMin=c,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(t,n,c,p){const h=this.layout.get(t).evaluate(n,{},c,p),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||td(g.value)||!h?h:function(M,C){return C.replace(/{([^{}]+)}/g,(P,b)=>b in M?String(M[b]):"")}(n.properties,h)}createBucket(t){return new zg(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of d_().paint.overridableProperties){if(!Pg.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),c=new Ky(n),p=new Nd(c,n.property.specification,this.scope,this.options);let h=null;h=n.value.kind==="constant"||n.value.kind==="source"?new sc("source",p):new ou("composite",p,n.value.zoomStops,n.value._interpolationType),this.paint._values[t]=new Ch(n.property,h,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,c){return!(!this.layout||n.isDataDriven()||c.isDataDriven())&&Pg.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const c=t.get("text-field"),p=d_().paint.properties[n];let h=!1;const g=M=>{for(const C of M)if(p.overrides&&p.overrides.hasOverride(C))return void(h=!0)};if(c.value.kind==="constant"&&c.value.value instanceof ds)g(c.value.value.sections);else if(c.value.kind==="source"){const M=P=>{h||(P instanceof or&&_a(P.value)===Ir?g(P.value.sections):P instanceof fl?g(P.sections):P.eachChild(M))},C=c.value;C._styleExpression&&M(C._styleExpression.expression)}return h}getProgramIds(){return["symbol"]}getDefaultProgramParams(t,n,c){return{config:new _u(this,{zoom:n,lut:c}),overrideFog:!1}}}let Jy,Qy,e0,t0;var f_=Ta([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function p_(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function m_(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class g_{constructor(t,n,c,p){this.context=t,this.format=c,this.useMipmap=p&&p.useMipmap,this.texture=t.gl.createTexture(),this.update(n,{premultiply:p&&p.premultiply})}update(t,n){const c=t&&t instanceof HTMLVideoElement&&t.width===0?t.videoWidth:t.width,p=t&&t instanceof HTMLVideoElement&&t.height===0?t.videoHeight:t.height,{context:h}=this,{gl:g}=h,{x:M,y:C}=n&&n.position?n.position:{x:0,y:0},P=M+c,b=C+p;!this.size||this.size[0]===P&&this.size[1]===b||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!n||n.premultiply!==!1));const L=t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap;if(!this.size&&P>0&&b>0){const D=this.useMipmap?Math.floor(Math.log2(Math.max(P,b)))+1:1;g.texStorage2D(g.TEXTURE_2D,D,this.format,P,b),this.size=[P,b]}if(this.size)if(L)g.texSubImage2D(g.TEXTURE_2D,0,M,C,p_(this.format),m_(this.format),t);else{const D=t.data;D&&g.texSubImage2D(g.TEXTURE_2D,0,M,C,c,p,p_(this.format),m_(this.format),D)}this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(t,n,c=!1){const{context:p}=this,{gl:h}=p;h.bindTexture(h.TEXTURE_2D,this.texture),t!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap&&!c?t===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),n!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(t,n,c,p){const{context:h}=this,{gl:g}=h;g.bindTexture(g.TEXTURE_2D,this.texture),n!==this.magFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,n),this.magFilter=n),t!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap?t===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),c!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,c),this.wrapS=c),p!==this.wrapT&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,p),this.wrapT=p)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Og{constructor(t,n){this.context=t,this.texture=n}bind(t,n){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),t!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,t),this.minFilter=t),n!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,n),this.wrapS=n)}}function Bg(s,t,n,c,p,h,g,M){const C=[s,t,1,n,c,1,p,h,1],P=[g,M,1],b=et.mat3.adjoint([],C),[L,D,A]=et.vec3.transformMat3(P,P,b);return et.mat3.multiply(C,C,[L,0,0,0,D,0,0,0,A])}function i0(s,t,n,c,p,h,g,M){const C=function(P,b,L,D,A,R,B,q){const W=Bg(0,0,1,0,1,1,0,1),ee=Bg(P,b,L,D,A,R,B,q),te=et.mat3.adjoint([],W);return et.mat3.multiply(ee,ee,te)}(s,t,n,c,p,h,g,M);return[C[2]/C[8]/vn,C[5]/C[8]/vn]}function Fg(s){return[s[0],Math.min(Math.max(s[1],-85.051129),Va)]}class n0 extends wi{constructor(t,n,c,p){super(),this.id=t,this.dispatcher=c,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=n,this._dirty=!1}load(t,n){if(this._loaded=n||!1,this.fire(new Fe("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=Au(this.map._requestManager.transformRequest(this.url,Wr.Image),(c,p)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new yt(c)):p&&(this.image=p instanceof HTMLImageElement?qe.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Og(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Fe("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(t){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Og||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=t[0][1],c=t[0][1];for(const h of t)h[1]>c&&(c=h[1]),h[1]<n&&(n=h[1]);const p=(c+n)/2;if(p>Va?this.onNorthPole=!0:p<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const h=t.map(a.fromLngLat);this.tileID=function(g){let M=1/0,C=1/0,P=-1/0,b=-1/0;for(const B of g)M=Math.min(M,B.x),C=Math.min(C,B.y),P=Math.max(P,B.x),b=Math.max(b,B.y);const L=Math.max(P-M,b-C),D=Math.max(0,Math.floor(-Math.log(L)/Math.LN2)),A=Math.pow(2,D);let R=Math.floor((M+P)/2*A);return R>1&&(R-=1),new zi(D,R,Math.floor((C+b)/2*A))}(h),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Fe("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const W in this.tiles){const ee=this.tiles[W];ee.state!=="loaded"&&(ee.state="loaded",ee.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const n=Jm(new zi(0,0,0),this.map.transform.projection),c=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(W){const ee=W[1].x-W[0].x,te=W[1].y-W[0].y,Y=W[2].x-W[1].x,re=W[2].y-W[1].y,ce=W[3].x-W[2].x,ve=W[3].y-W[2].y,Be=W[0].x-W[3].x,Oe=W[0].y-W[3].y,Pe=ee*re-Y*te,nt=Y*ve-ce*re,Ue=ce*Oe-Be*ve,lt=Be*te-ee*Oe;return Pe>0&&nt>0&&Ue>0&&lt>0||Pe<0&&nt<0&&Ue<0&&lt<0}(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const p=Jm(this.tileID,this.map.transform.projection),[h,g,M,C]=this.coordinates.map(W=>{const ee=p.projection.project(W[0],W[1]);return Hy(p,ee)._round()});this.perspectiveTransform=i0(h.x,h.y,g.x,g.y,M.x,M.y,C.x,C.y);const P=this._boundsArray=new Wl;P.emplaceBack(h.x,h.y,0,0),P.emplaceBack(g.x,g.y,vn,0),P.emplaceBack(C.x,C.y,0,vn),P.emplaceBack(M.x,M.y,vn,vn),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(P,f_.members),this.boundsSegments=bs.simpleSegment(0,0,4,2);const b=[],L=[Fg((D=this.coordinates)[0]),Fg(D[1]),Fg(D[2]),Fg(D[3])];var D;const[A,R,B,q]=function(W){let ee=W[0][0],te=ee,Y=W[0][1],re=Y;for(let ce=1;ce<W.length;ce++)W[ce][0]<ee?ee=W[ce][0]:W[ce][0]>te&&(te=W[ce][0]),W[ce][1]<Y?Y=W[ce][1]:W[ce][1]>re&&(re=W[ce][1]);return[ee,Y,te-ee,re-Y]}(L);{const W=new Wl,[ee,te,Y,re]=function(Ct){let Nt=Ct[0].x,wt=Nt,gi=Ct[0].y,Ui=gi;for(let mi=1;mi<Ct.length;mi++)Ct[mi].x<Nt?Nt=Ct[mi].x:Ct[mi].x>wt&&(wt=Ct[mi].x),Ct[mi].y<gi?gi=Ct[mi].y:Ct[mi].y>Ui&&(Ui=Ct[mi].y);return[Nt,gi,wt-Nt,Ui-gi]}(c),ce=Ct=>[(Ct.x-ee)/Y,(Ct.y-te)/re],[ve,Be,Oe,Pe]=c.map(ce),nt=function(Ct,Nt,wt,gi,Ui,mi,Dn,Mn){const tn=Bg(0,0,1,0,1,1,0,1),qi=Bg(Ct,Nt,wt,gi,Ui,mi,Dn,Mn),nr=et.mat3.adjoint([],qi);return et.mat3.multiply(tn,tn,nr)}(ve[0],ve[1],Be[0],Be[1],Oe[0],Oe[1],Pe[0],Pe[1]);this.elevatedGlobePerspectiveTransform=i0(ve[0],ve[1],Be[0],Be[1],Oe[0],Oe[1],Pe[0],Pe[1]);const Ue=(Ct,Nt)=>{b.push(Ct.lng);const wt=Math.round((Ct.lng-A)/B*vn),gi=Math.round((Ct.lat-R)/q*vn),Ui=ce(Nt),mi=et.vec3.transformMat3([],[Ui[0],Ui[1],1],nt),Dn=Math.round(mi[0]/mi[2]*vn),Mn=Math.round(mi[1]/mi[2]*vn);W.emplaceBack(wt,gi,Dn,Mn)},lt=c[3].x-c[0].x,_t=c[3].y-c[0].y,dt=c[2].x-c[1].x,xt=c[2].y-c[1].y;for(let Ct=0;Ct<65;Ct++){const Nt=Ct/64,wt=[c[0].x+Nt*lt,c[0].y+Nt*_t],gi=[c[1].x+Nt*dt,c[1].y+Nt*xt],Ui=gi[0]-wt[0],mi=gi[1]-wt[1];for(let Dn=0;Dn<65;Dn++){const Mn=Dn/64,tn={x:wt[0]+Ui*Mn,y:wt[1]+mi*Mn};Ue(n.projection.unproject(tn.x,tn.y),tn)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(W,f_.members)}{this.maxLongitudeTriangleSize=0;let W=[],ee=new uo;const te=(Y,re,ce)=>{ee.emplaceBack(Y,re,ce);const ve=b[Y],Be=b[re],Oe=b[ce],Pe=Math.min(Math.min(ve,Be),Oe),nt=Math.max(Math.max(ve,Be),Oe)-Pe;nt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=nt),W.push(Pe+nt/2)};for(let Y=0;Y<64;Y++)for(let re=0;re<64;re++){const ce=65*Y+re,ve=ce+1,Be=ce+65,Oe=Be+1;te(ce,Be,ve),te(ve,Be,Oe)}[W,ee]=function(Y,re){const ce=Array.from({length:Y.length},(Oe,Pe)=>Pe);ce.sort((Oe,Pe)=>Y[Oe]-Y[Pe]);const ve=[],Be=new uo;for(let Oe=0;Oe<ce.length;Oe++){const Pe=ce[Oe];ve.push(Y[Pe]);const nt=3*Pe,Ue=nt+1;Be.emplaceBack(re.uint16[nt],re.uint16[Ue],re.uint16[Ue+1])}return[ve,Be]}(W,ee),this.elevatedGlobeTrianglesCenterLongitudes=W,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(ee)}this.elevatedGlobeSegments=bs.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,B/vn,0,q/vn,0,0,R,A,0])}prepare(){const t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;const n=this.map.painter.context,c=n.gl;!this._dirty||this.texture instanceof Og||(this.texture?this.texture.update(this.image):(this.texture=new g_(n,this.image,c.RGBA8),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(n)}loadTile(t,n){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},n(null)):(t.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;const c=this.elevatedGlobeTrianglesCenterLongitudes;let p=(h=t+180)+360*Math.round((c[0]-h)/360);var h;const g=new bs,M=(L,D)=>{g.segments.push({vertexOffset:0,primitiveOffset:L,vertexLength:n.segments[0].vertexLength,primitiveLength:D,sortKey:void 0,vaos:{}})},C=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-p)<=C){const L=Lo(c,0,c.length,p+C);return L===c.length||M(L,$s(c,L+1,c.length,p+360-C)-L),g}p<c[0]&&(p+=360);const P=$s(c,0,c.length,p-C);if(P===c.length)return M(0,c.length),g;M(0,P-0);const b=Lo(c,P+1,c.length,p+C);return b!==c.length&&M(b,c.length-b),g}}const Bx=(Math.pow(256,2)-1)/16907520;class r0 extends qs{constructor(t,n,c,p){super(t,{layout:e0||(e0=new ss({visibility:new Ri(Ht.layout_raster.visibility)})),paint:t0||(t0=new ss({"raster-opacity":new Ri(Ht.paint_raster["raster-opacity"]),"raster-color":new Hc(Ht.paint_raster["raster-color"]),"raster-color-mix":new Ri(Ht.paint_raster["raster-color-mix"]),"raster-color-range":new Ri(Ht.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ri(Ht.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ri(Ht.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ri(Ht.paint_raster["raster-brightness-max"]),"raster-saturation":new Ri(Ht.paint_raster["raster-saturation"]),"raster-contrast":new Ri(Ht.paint_raster["raster-contrast"]),"raster-resampling":new Ri(Ht.paint_raster["raster-resampling"]),"raster-fade-duration":new Ri(Ht.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ri(Ht.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ri(Ht.paint_raster["raster-array-band"]),"raster-elevation":new Ri(Ht.paint_raster["raster-elevation"]),"raster-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},n,c,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(t){return!(t&&t._source instanceof n0&&(t._source.onNorthPole||t._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(t){if(!this.hasColorMap()||!this._curRampRange)return;const n=this._transitionablePaint._values["raster-color"].value.expression,[c,p]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(p)||c===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=Rf({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:p}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[c,p])}}let a0,s0,o0,l0,c0;class u0 extends qs{constructor(t,n,c,p){super(t,{layout:a0||(a0=new ss({visibility:new Ri(Ht["layout_raster-particle"].visibility)})),paint:s0||(s0=new ss({"raster-particle-array-band":new Ri(Ht["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ri(Ht["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Hc(Ht["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ri(Ht["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ri(Ht["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ri(Ht["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ri(Ht["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Ri(Ht["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},n,c,p),this._updateColorRamp(),this.lastInvalidatedAt=qe.now()}onRemove(t){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){t!=="raster-particle-color"&&t!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),t==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Rf({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=qe.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Fx extends qs{constructor(t,n){super(t,{},n,null),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}function __(s,t,n){const c=[0,0,1],p=et.quat.identity([]);return et.quat.rotateY(p,p,n?-ft(s)+Math.PI:ft(s)),et.quat.rotateX(p,p,-ft(t)),et.vec3.transformQuat(c,c,p),et.vec3.normalize(c,c)}function h0(s,t){const n=kg(s.projection,s.zoom,s.width,s.height),c=function(h,g,M,C,P){const b=new xa(M.lng-180*tm,M.lat),L=new xa(M.lng+180*tm,M.lat),D=h.project(b.lng,b.lat),A=h.project(L.lng,L.lat),R=-Math.atan2(A.y-D.y,A.x-D.x),B=a.fromLngLat(M);B.y=ii(B.y,-1+tm,1-tm);const q=B.toLngLat(),W=h.project(q.lng,q.lat),ee=a.fromLngLat(q);ee.x+=tm;const te=ee.toLngLat(),Y=h.project(te.lng,te.lat),re=f0(Y.x-W.x,Y.y-W.y,R),ce=a.fromLngLat(q);ce.y+=tm;const ve=ce.toLngLat(),Be=h.project(ve.lng,ve.lat),Oe=f0(Be.x-W.x,Be.y-W.y,R),Pe=Math.abs(re.x)/Math.abs(Oe.y),nt=et.mat4.identity([]);et.mat4.rotateZ(nt,nt,-R*(1-(P?0:C)));const Ue=et.mat4.identity([]);return et.mat4.scale(Ue,Ue,[1,1-(1-Pe)*C,1]),Ue[4]=-Oe.x/Oe.y*C,et.mat4.rotateZ(Ue,Ue,R),et.mat4.multiply(Ue,nt,Ue),Ue}(s.projection,0,s.center,n,t),p=d0(s);return et.mat4.scale(c,c,[p,p,1]),c}function d0(s){const t=s.projection,n=kg(s.projection,s.zoom,s.width,s.height),c=y_(t,s.center),p=y_(t,xa.convert(t.center));return Math.pow(2,c*n+(1-n)*p)}function kg(s,t,n,c,p=1/0){const h=s.range;if(!h)return 0;const g=Math.min(p,Math.max(n,c)),M=Math.log(g/1024)/Math.LN2;return Tn(h[0]+M,h[1]+M,t)}const tm=1/4e4;function y_(s,t){const n=ii(t.lat,-85.051129,Va),c=new xa(t.lng-180*tm,n),p=new xa(t.lng+180*tm,n),h=s.project(c.lng,n),g=s.project(p.lng,n),M=a.fromLngLat(c),C=a.fromLngLat(p),P=g.x-h.x,b=g.y-h.y,L=C.x-M.x,D=C.y-M.y,A=Math.sqrt((L*L+D*D)/(P*P+b*b));return Math.log(A)/Math.LN2}function f0(s,t,n){const c=Math.cos(n),p=Math.sin(n);return{x:s*c-t*p,y:s*p+t*c}}function p0(s,t,n){et.mat4.identity(s),et.mat4.rotateZ(s,s,ft(t[2])),et.mat4.rotateX(s,s,ft(t[0])),et.mat4.rotateY(s,s,ft(t[1])),et.mat4.scale(s,s,n),et.mat4.multiply(s,s,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Ng(s,t,n,c,p,h,g,M){const C=[n[0]-t[0],n[1]-t[1],0],P=[c[0]-t[0],c[1]-t[1],0];if(et.vec3.length(C)<1e-12||et.vec3.length(P)<1e-12)return et.quat.identity(s);const b=et.vec3.cross([],C,P);et.vec3.normalize(b,b),et.vec3.subtract(P,c,t),C[2]=(h-p)*M,P[2]=(g-p)*M;const L=C;return et.vec3.cross(L,C,P),et.vec3.normalize(L,L),et.quat.rotationTo(s,b,L)}function v_(s,t,n=!1){const c=No(t.zoom),p=function(h,g,M){const C=g.worldSize,P=[h[12],h[13],h[14]],b=Is(P[1]/C),L=ho(P[0]/C),D=et.mat4.identity([]),A=io(1,b)*C,R=io(1,0)*C*Dc(b,g.zoom),B=1/ks(C);let q=R*B;if(M){const Y=kg(g.projection,g.zoom,g.width,g.height,1024);q=B*g.projection.pixelSpaceConversion(g.center.lat,C,Y)}const W=xu(b,L);et.vec3.add(W,W,et.vec3.scale([],et.vec3.normalize([],W),A*q*P[2]));const ee=function(Y){const re=[Y[0],Y[1],Y[2]];let ce=[0,1,0];const ve=et.vec3.cross([],ce,re);return et.vec3.cross(ce,re,ve),et.vec3.squaredLength(ce)===0&&(ce=[0,1,0],et.vec3.cross(ve,re,ce)),et.vec3.normalize(ve,ve),et.vec3.normalize(ce,ce),et.vec3.normalize(re,re),[ve[0],ve[1],ve[2],0,ce[0],ce[1],ce[2],0,re[0],re[1],re[2],0,Y[0],Y[1],Y[2],1]}(W);et.mat4.scale(D,D,[q,q,q*A]),et.mat4.translate(D,D,[-P[0],-P[1],-P[2]]);const te=et.mat4.multiply([],g.globeMatrix,ee);return et.mat4.multiply(te,te,D),et.mat4.multiply(te,te,h),te}(s,t,n);if(c>0){const h=function(g,M){const C=M.worldSize,P=io(1,0)*C*Dc(M.center.lat,M.zoom)/ks(C),b=io(1,M.center.lat)*C,L=et.mat4.identity([]);return et.mat4.rotateY(L,L,ft(M.center.lng)),et.mat4.rotateX(L,L,ft(M.center.lat)),et.mat4.translate(L,L,[0,0,Na]),et.mat4.scale(L,L,[P,P,P*b]),et.mat4.translate(L,L,[M.point.x-.5*C,M.point.y-.5*C,0]),et.mat4.multiply(L,L,g),et.mat4.multiply(L,M.globeMatrix,L)}(s,t);return function(g,M,C){const P=(R,B,q)=>{const W=et.vec3.length(R),ee=et.vec3.length(B),te=Es(R,B,q);return et.vec3.scale(te,te,1/et.vec3.length(te)*Ee(W,ee,q))},b=P([g[0],g[1],g[2]],[M[0],M[1],M[2]],C),L=P([g[4],g[5],g[6]],[M[4],M[5],M[6]],C),D=P([g[8],g[9],g[10]],[M[8],M[9],M[10]],C),A=Es([g[12],g[13],g[14]],[M[12],M[13],M[14]],C);return[b[0],b[1],b[2],0,L[0],L[1],L[2],0,D[0],D[1],D[2],0,A[0],A[1],A[2],1]}(p,h,c)}return p}function m0(s,t,n,c){const p=In.projectAabbCorners(c,n);let h=Number.MAX_VALUE,g=-1;for(let P=0;P<p.length;++P){const b=p[P];b[0]=(.5*b[0]+.5)*t.width,b[1]=(.5-.5*b[1])*t.height,b[2]<h&&(g=P,h=b[2])}const M=P=>new Pi(p[P][0],p[P][1]);let C;switch(g){case 0:case 6:C=[M(1),M(5),M(4),M(7),M(3),M(2),M(1)];break;case 1:case 7:C=[M(0),M(4),M(5),M(6),M(2),M(3),M(0)];break;case 3:case 5:C=[M(1),M(0),M(4),M(7),M(6),M(2),M(1)];break;default:C=[M(1),M(5),M(6),M(7),M(3),M(0),M(1)]}if(se(s,C))return h}const kx=Ta([{name:"a_pos_3f",components:3,type:"Float32"}]),Nx=Ta([{name:"a_color_3f",components:3,type:"Float32"}]),Ux=Ta([{name:"a_color_4f",components:4,type:"Float32"}]),Vx=Ta([{name:"a_uv_2f",components:2,type:"Float32"}]),Gx=Ta([{name:"a_normal_3f",components:3,type:"Float32"}]),Hx=Ta([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),jx=Ta([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),g0={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class Ug{constructor(t,n,c,p){this.message=(t?`${t}: `:"")+c,p&&(this.identifier=p),n!=null&&n.__line__&&(this.line=n.__line__)}}function _0(s,t){const n=s.indexOf("://")===-1;try{return new URL(s,n&&t?"http://example.com":void 0),!0}catch{return!1}}class y0{constructor(t,n){this.feature=t,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class v0{constructor(){this.instancedDataArray=new Wc,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class x_{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(t,n){}populate(t,n,c,p){this.tileToMeter=i(c);const h=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:g,id:M,index:C,sourceLayerIndex:P}of t){const b=M??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),L=Z(g,h);if(!this.layers[0]._featureFilter.filter(new Ka(this.zoom),L,c))continue;const D={id:b,sourceLayerIndex:P,index:C,geometry:h?L.geometry:j(g,c,p),properties:g.properties,type:g.type,patterns:{}},A=this.addFeature(D,D.geometry,L);A&&n.featureIndex.insert(g,D.geometry,C,P,this.index,this.instancesPerModel[A].instancedDataArray.length,vn/32)}this.lookup=null}update(t,n,c,p){for(const h in this.instancesPerModel){const g=this.instancesPerModel[h];for(const M in t)g.idToFeaturesIndex.hasOwnProperty(M)&&(this.evaluate(g.features[g.idToFeaturesIndex[M]],t[M],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const n in this.instancesPerModel){const c=this.instancesPerModel[n];for(const p of c.features){const h=this.layers[0],g=p.feature,M=this.canonical,C=h.paint.get("model-rotation").evaluate(g,{},M),P=h.paint.get("model-scale").evaluate(g,{},M),b=h.paint.get("model-translation").evaluate(g,{},M);et.vec3.exactEquals(p.rotation,C)&&et.vec3.exactEquals(p.scale,P)&&et.vec3.exactEquals(p.translation,b)||(this.evaluate(p,p.featureStates,c,!0),t=!0)}}return t}updateReplacement(t,n,c,p){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const h=n.getReplacementRegionsForTile(t.toUnwrapped(),!0);if(Bi(this.activeReplacements,h))return!1;this.activeReplacements=h;let g=!1;for(const M in this.instancesPerModel){const C=this.instancesPerModel[M],P=C.instancedDataArray;for(const b of C.features){const L=b.instancedDataOffset,D=b.instancedDataCount;for(let A=0;A<D;A++){const R=16*(A+L);let B=P.float32[R+0];const q=B>vn;B=q?B-vn:B;const W=Math.floor(B),ee=P.float32[R+1];let te=!1;for(const Y of this.activeReplacements)if(!Bt(Y,c,g0.Model,p)&&!(Y.min.x>W||W>Y.max.x||Y.min.y>ee||ee>Y.max.y)&&(te=Mr(Yn(W,ee,t.canonical,Y.footprintTileId.canonical),Y.footprint),te))break;P.float32[R]=te?B+vn:B,g=g||te!==q}}}return g}isEmpty(){for(const t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const n in this.instancesPerModel){const c=this.instancesPerModel[n];c.instancedDataArray.length<0||c.instancedDataArray.length===0||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=t.createVertexBuffer(c.instancedDataArray,Hx.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const n in this.instancesPerModel){const c=this.instancesPerModel[n];c.instancedDataArray.length!==0&&c.instancedDataBuffer&&c.instancedDataBuffer.destroy()}const t=this.layers[0].modelManager;if(t&&this.modelUris)for(const n of this.modelUris)t.removeModel(n,"")}addFeature(t,n,c){const p=this.layers[0],h=p.layout.get("model-id").evaluate(c,{},this.canonical);if(!h)return Xn(`modelId is not evaluated for layer ${p.id} and it is not going to get rendered.`),h;_0(h,!1)&&(this.modelUris.includes(h)||this.modelUris.push(h)),this.instancesPerModel[h]||(this.instancesPerModel[h]=new v0);const g=this.instancesPerModel[h],M=g.instancedDataArray,C=new y0(c,M.length);for(const P of n)for(const b of P){if(b.x<0||b.x>=vn||b.y<0||b.y>=vn)continue;const L=(this.lookupDim-1)/vn,D=this.lookupDim*(b.y*L|0)+b.x*L|0;if(this.lookup){if(this.lookup[D]!==0)continue;this.lookup[D]=1}this.instanceCount++;const A=M.length;M.resize(A+1),g.instancesEvaluatedElevation.push(0),M.float32[16*A]=b.x,M.float32[16*A+1]=b.y}return C.instancedDataCount=g.instancedDataArray.length-C.instancedDataOffset,C.instancedDataCount>0&&(t.id&&(g.idToFeaturesIndex[t.id]=g.features.length),g.features.push(C),this.evaluate(C,{},g,!1)),h}getModelUris(){return this.modelUris}evaluate(t,n,c,p){const h=this.layers[0],g=t.feature,M=this.canonical,C=t.rotation=h.paint.get("model-rotation").evaluate(g,n,M),P=t.scale=h.paint.get("model-scale").evaluate(g,n,M),b=t.translation=h.paint.get("model-translation").evaluate(g,n,M),L=h.paint.get("model-color").evaluate(g,n,M);L.a=h.paint.get("model-color-mix-intensity").evaluate(g,n,M);const D=[];this.maxVerticalOffset<b[2]&&(this.maxVerticalOffset=b[2]),this.maxScale=Math.max(Math.max(this.maxScale,P[0]),Math.max(P[1],P[2])),p0(D,C,P);const A=Math.round(100*L.a)+L.b/1.05;for(let R=0;R<t.instancedDataCount;++R){const B=t.instancedDataOffset+R,q=16*B,W=c.instancedDataArray.float32;let ee=0;p&&(ee=W[q+6]-c.instancesEvaluatedElevation[B]);const te=0|W[q+1];W[q]=(0|W[q])+L.r/1.05,W[q+1]=te+L.g/1.05,W[q+2]=A,W[q+3]=1/(M.z>10?this.tileToMeter:i(M,te)),W[q+4]=b[0],W[q+5]=b[1],W[q+6]=b[2]+ee,W[q+7]=D[0],W[q+8]=D[1],W[q+9]=D[2],W[q+10]=D[4],W[q+11]=D[5],W[q+12]=D[6],W[q+13]=D[8],W[q+14]=D[9],W[q+15]=D[10],c.instancesEvaluatedElevation[B]=b[2]}}}let x0,b0;kn(x_,"ModelBucket",{omit:["layers"]}),kn(v0,"PerModelAttributes"),kn(y0,"ModelFeature");const pm=64,Om={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function w0(s,t,n,c,p,h,g,M,C,P=!1){const b=n.zoom,L=n.project(c),D=Dc(c.lat,b),A=1/D;et.mat4.identity(s),et.mat4.translate(s,s,[L.x+g[0]*A,L.y+g[1]*A,g[2]]);let R=1,B=1;const q=n.worldSize;if(P){if(n.projection.name==="mercator"){let Y=0;n.elevation&&(Y=n.elevation.getAtPointOrZero(new a(L.x/q,L.y/q),0));const re=et.vec4.transformMat4([],[L.x,L.y,Y,1],n.projMatrix)[3]/n.cameraToCenterDistance;R=re,B=re*Dc(n.center.lat,b)}else if(n.projection.name==="globe"){const Y=v_(s,n),re=et.mat4.multiply([],n.projMatrix,Y),ce=[0,0,0,1];et.vec4.transformMat4(ce,ce,re);const ve=ce[3]/n.cameraToCenterDistance,Be=No(b),Oe=n.projection.pixelsPerMeter(c.lat,q)*Dc(c.lat,b),Pe=n.projection.pixelsPerMeter(n.center.lat,q)*Dc(n.center.lat,b);R=ve/Ee(Oe,wu(n.center.lat),Be),B=ve*D/Oe,R*=Pe,B*=Pe}}else R=A;et.mat4.scale(s,s,[R,R,B]);const W=[...s],ee=t.orientation,te=[];if(p0(te,[ee[0]+p[0],ee[1]+p[1],ee[2]+p[2]],h),et.mat4.multiply(s,W,te),M&&n.elevation){let Y=0;const re=[];if(C&&n.elevation){Y=function(Be,Oe,Pe,nt,Ue){const lt=Oe.elevation;if(!lt)return 0;const _t=In.projectAabbCorners(Pe,nt),dt=io(1,Ue.lat)*Oe.worldSize,xt=function(nr,Fn){const Hn=[0,0,1],zr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Yr of zr){const ta=nr[Yr.corners[0]],ia=nr[Yr.corners[1]],ma=nr[Yr.corners[2]],va=[ia[0]-ta[0],ia[1]-ta[1],Fn*(ia[2]-ta[2])],vs=et.vec3.cross(va,va,[ma[0]-ta[0],ma[1]-ta[1],Fn*(ma[2]-ta[2])]);et.vec3.normalize(vs,vs),Yr.dotProductWithUp=et.vec3.dot(vs,Hn)}return zr.sort((Yr,ta)=>Yr.dotProductWithUp-ta.dotProductWithUp),zr[0].corners}(_t,dt),Ct=_t[xt[0]],Nt=_t[xt[1]],wt=_t[xt[2]],gi=_t[xt[3]],Ui=lt.getAtPointOrZero(new a(Ct[0]/Oe.worldSize,Ct[1]/Oe.worldSize),0),mi=lt.getAtPointOrZero(new a(Nt[0]/Oe.worldSize,Nt[1]/Oe.worldSize),0),Dn=lt.getAtPointOrZero(new a(wt[0]/Oe.worldSize,wt[1]/Oe.worldSize),0),Mn=lt.getAtPointOrZero(new a(gi[0]/Oe.worldSize,gi[1]/Oe.worldSize),0),tn=(Ui+Mn)/2,qi=(mi+Dn)/2;return tn>qi?mi<Dn?Ng(Be,Nt,gi,Ct,mi,Mn,Ui,dt):Ng(Be,wt,Ct,gi,Dn,Ui,Mn,dt):Ui<Mn?Ng(Be,Ct,Nt,wt,Ui,mi,Dn,dt):Ng(Be,gi,wt,Nt,Mn,Dn,mi,dt),Math.max(tn,qi)}(re,n,t.aabb,s,c);const ce=et.mat4.fromQuat([],re),ve=et.mat4.multiply([],ce,te);et.mat4.multiply(s,W,ve)}else Y=n.elevation.getAtPointOrZero(new a(L.x/q,L.y/q),0);Y!==0&&(s[14]+=Y)}}function ng(s,t,n=!1){s.uploaded||(s.gfxTexture=new g_(t,s.image,n?t.gl.R8:t.gl.RGBA8,{useMipmap:s.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),s.uploaded=!0,s.image=null)}function qx(s,t,n){s.indexBuffer=t.createIndexBuffer(s.indexArray,!1,!0),s.vertexBuffer=t.createVertexBuffer(s.vertexArray,kx.members,!1,!0),s.normalArray&&(s.normalBuffer=t.createVertexBuffer(s.normalArray,Gx.members,!1,!0)),s.texcoordArray&&(s.texcoordBuffer=t.createVertexBuffer(s.texcoordArray,Vx.members,!1,!0)),s.colorArray&&(s.colorBuffer=t.createVertexBuffer(s.colorArray,(s.colorArray.bytesPerElement===12?Nx:Ux).members,!1,!0)),s.featureArray&&(s.pbrBuffer=t.createVertexBuffer(s.featureArray,jx.members,!0)),s.segments=bs.simpleSegment(0,0,s.vertexArray.length,s.indexArray.length);const c=s.material;c.pbrMetallicRoughness.baseColorTexture&&ng(c.pbrMetallicRoughness.baseColorTexture,t),c.pbrMetallicRoughness.metallicRoughnessTexture&&ng(c.pbrMetallicRoughness.metallicRoughnessTexture,t),c.normalTexture&&ng(c.normalTexture,t),c.occlusionTexture&&ng(c.occlusionTexture,t,n),c.emissionTexture&&ng(c.emissionTexture,t)}function b_(s,t,n){if(s.meshes)for(const c of s.meshes)qx(c,t,n);if(s.children)for(const c of s.children)b_(c,t,n)}function Vg(s){if(s.meshes)for(const t of s.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(s.children)for(const t of s.children)Vg(t)}function w_(s){if(s.meshes)for(const n of s.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((t=n.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(s.children)for(const n of s.children)w_(n)}class Bm{constructor(t,n,c){this._demTile=t,this._dem=this._demTile.dem,this._scale=n,this._offset=c}static create(t,n,c){const p=c||t.findDEMTileFor(n);if(!p||!p.dem)return;const h=p.dem,g=p.tileID,M=1<<n.canonical.z-g.canonical.z;return new Bm(p,h.dim/vn/M,[(n.canonical.x/M-g.canonical.x)*h.dim,(n.canonical.y/M-g.canonical.y)*h.dim])}tileCoordToPixel(t,n){const c=n*this._scale+this._offset[1],p=Math.floor(t*this._scale+this._offset[0]),h=Math.floor(c);return new Pi(p,h)}getElevationAt(t,n,c,p){const h=t*this._scale+this._offset[0],g=n*this._scale+this._offset[1],M=Math.floor(h),C=Math.floor(g),P=this._dem;return p=!!p,c?Ee(Ee(P.get(M,C,p),P.get(M,C+1,p),g-C),Ee(P.get(M+1,C,p),P.get(M+1,C+1,p),g-C),h-M):P.get(M,C,p)}getElevationAtPixel(t,n,c){return this._dem.get(t,n,!!c)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*io(1,t)*this._dem.stride}}const M_=new Float32Array(262144),mm=new Uint8Array(262144);function M0(s){let t=0;if(s.meshes)for(const n of s.meshes)t=Math.max(t,n.aabb.max[2]);if(s.children)for(const n of s.children)t=Math.max(t,M0(n));return t}function T0(s,t,n){if(s.meshes)for(const c of s.meshes){if(c.aabb.min[0]===1/0)continue;const p=In.applyTransform(c.aabb,s.matrix);n.insert(t,p.min[0],p.min[1],p.max[0],p.max[1])}if(s.children)for(const c of s.children)T0(c,t,n)}const S0=["","wall","door","roof","window","lamp","logo"];class E0{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:t.id,geometry:[],properties:{height:M0(t)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new In([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const n=new In([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.node.meshes)this.node.lightMeshIndex!==t&&(c.transformedAabb=In.applyTransformFast(c.aabb,this.node.matrix),n.encapsulate(c.transformedAabb)),t++;this.aabb=n}return this.aabb}}class Gg{constructor(t,n,c,p,h,g,M){this.id=c,this.layers=t,this.layerIds=this.layers.map(C=>C.fqid),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.modelTraits|=Om.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,p&&(this.modelTraits|=Om.HasMapboxMeshFeatures),h&&(this.modelTraits|=Om.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=g,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const C of n)this.nodesInfo.push(new E0(C)),T0(C,M.featureIndexArray.length,M.grid),M.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,M.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(t,n){for(const c of this.getNodesInfo()){const p=c.node;p.footprint&&n.push({footprint:p.footprint,id:t})}}update(t){const n=Object.keys(t).length!==0;if(n&&!this.stateDependentLayers.length)return;const c=n?this.stateDependentLayers:this.layers;if(!cn(t,this.states))for(const p of c)this.evaluate(p,t);this.states=structuredClone(t)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const c of n){const p=c.node;this.uploaded?this.updatePbrBuffer(p):b_(p,t,!0)}for(const c of n)Vg(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let n=!1;if(!t.meshes)return n;for(const c of t.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),n=!0);return n}needsReEvaluation(t,n,c){const p=t.transform.projectionOptions,h=t.style.getBrightness(),g=this.brightness!==h;if(!this.uploaded||this.dirty||p.name!==this.projection.name||rg(c.paint.get("model-color").value,g)||rg(c.paint.get("model-color-mix-intensity").value,g)||rg(c.paint.get("model-roughness").value,g)||rg(c.paint.get("model-emissive-strength").value,g)||rg(c.paint.get("model-height-based-emissive-strength-multiplier").value,g)){this.projection=p,this.brightness=h;const M=this.getNodesInfo();for(const C of M)C.state=null;return!0}return!1}evaluateScale(t,n){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const c=this.getNodesInfo(),p=this.id.canonical;for(const h of c){const g=h.feature;h.evaluatedScale=n.paint.get("model-scale").evaluate(g,{},p)}}evaluate(t,n){const c=this.getNodesInfo();for(const p of c){if(!p.node.meshes)continue;const h=p.feature,g=n&&n[h.id];if(cn(g,p.state))continue;p.state=structuredClone(g);const M=p.node.meshes&&p.node.meshes[0].featureData,C=p.evaluatedColor[2],P=p.evaluatedRMEA[2],b=this.id.canonical;if(p.hasTranslucentParts=!1,M){for(let L=0;L<S0.length;L++){const D=S0[L];D.length&&(h.properties.part=D);const A=t.paint.get("model-color").evaluate(h,g,b).toRenderColor(null),R=t.paint.get("model-color-mix-intensity").evaluate(h,g,b);p.evaluatedColor[L]=[A.r,A.g,A.b,R],p.evaluatedRMEA[L][0]=t.paint.get("model-roughness").evaluate(h,g,b),p.evaluatedRMEA[L][2]=t.paint.get("model-emissive-strength").evaluate(h,g,b),p.evaluatedRMEA[L][3]=A.a,p.emissionHeightBasedParams[L]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,g,b),!p.hasTranslucentParts&&A.a<1&&(p.hasTranslucentParts=!0)}delete h.properties.part,Zx(p,C!==p.evaluatedColor[2]||P!==p.evaluatedRMEA[2],this.modelTraits)}else p.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(h,g,b);p.evaluatedScale=t.paint.get("model-scale").evaluate(h,g,b),this.updatePbrBuffer(p.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,n,c,p){const h=t.findDEMTileFor(c);if(h&&(h.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(h.dem&&h.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=h.tileID.overscaledZ;const g=Bm.create(t,c,h);if(!g)return;this.modelTraits&Om.HasMapboxMeshFeatures&&this.updateDEM(t,g,c,p);for(const M of this.getNodesInfo()){const C=M.node;if(!C.footprint||!C.footprint.vertices||!C.footprint.vertices.length)continue;const P=C.footprint.vertices;let b=g.getElevationAt(P[0].x,P[0].y,!0,!0);for(let L=1;L<P.length;L++)b=Math.min(b,g.getElevationAt(P[L].x,P[L].y,!0,!0));C.elevation=b}}this.terrainTile=h.tileID.canonical,this.terrainExaggeration=n}}updateDEM(t,n,c,p){let h=n._dem._modifiedForSources[p];if(h===void 0&&(n._dem._modifiedForSources[p]=[],h=n._dem._modifiedForSources[p]),h.includes(c.canonical))return;const g=n._dem.dim;h.push(c.canonical);let M=!1;for(const C of this.getNodesInfo()){const P=C.node;if(!P.footprint||!P.footprint.grid)continue;const b=P.footprint.grid,L=n.tileCoordToPixel(b.min.x,b.min.y),D=n.tileCoordToPixel(b.max.x,b.max.y),A=Math.min(Math.min(g-D.y,L.x),Math.min(L.y,g-D.x));if(A<0)continue;const R=ii(A,2,5);let B=Math.max(0,L.x-R),q=Math.max(0,L.y-R),W=Math.min(D.x+R,g-1),ee=Math.min(D.y+R,g-1);for(let ce=q;ce<=ee;++ce)for(let ve=B;ve<=W;++ve)mm[ce*g+ve]=255;let te=0,Y=0;for(let ce=0;ce<b.cellsY;++ce)for(let ve=0;ve<b.cellsX;++ve){if(!b.cells[ce*b.cellsX+ve])continue;const Be=n.tileCoordToPixel(b.min.x+ve/b.xScale,b.min.y+ce/b.yScale),Oe=n.tileCoordToPixel(b.min.x+(ve+1)/b.xScale,b.min.y+(ce+1)/b.yScale);for(let Pe=Be.y;Pe<=Math.min(Oe.y+1,g-1);++Pe)for(let nt=Be.x;nt<=Math.min(Oe.x+1,g-1);++nt)mm[Pe*g+nt]===255&&(mm[Pe*g+nt]=0,te+=n.getElevationAtPixel(nt,Pe),Y++)}const re=te/Y;B=Math.max(1,L.x-R),q=Math.max(1,L.y-R),W=Math.min(D.x+R,g-2),ee=Math.min(D.y+R,g-2),M=!0;for(let ce=q;ce<=ee;++ce)for(let ve=B;ve<=W;++ve)mm[ce*g+ve]===0&&(M_[ce*g+ve]=n._dem.set(ve,ce,re));for(let ce=1;ce<R;++ce){B=Math.max(1,L.x-ce),q=Math.max(1,L.y-ce),W=Math.min(D.x+ce,g-2),ee=Math.min(D.y+ce,g-2);for(let ve=q;ve<=ee;++ve)for(let Be=B;Be<=W;++Be){const Oe=ve*g+Be;if(mm[Oe]===255){let Pe=0,nt=0,Ue=-1,lt=-1;for(let _t=-1;_t<=1;++_t)for(let dt=-1;dt<=1;++dt){const xt=(ve+_t)*g+Be+dt;if(mm[xt]>=ce)continue;const Ct=M_[xt],Nt=Math.abs(Ct);Nt>nt&&(Pe=Ct,nt=Nt,Ue=dt,lt=_t)}if(nt>.1){const _t=1-(ce+.5*Math.abs(Ue*lt))/R;let dt=n._dem.get(Be,ve)+Pe*_t;const xt=n._dem.get(Be+Ue,ve+lt),Ct=n._dem.get(Be-Ue,ve-lt,!0);(dt-xt)*(dt-Ct)>0&&(dt=(xt+Ct)/2),M_[Oe]=n._dem.set(Be,ve,dt),mm[Oe]=ce}}}}}M&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=qe.now())}getNodesInfo(){return this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const n of t)Vg(n.node),w_(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const c=n.getReplacementRegionsForTile(t.toUnwrapped()),p=this.getNodesInfo();for(let h=0;h<this.nodesInfo.length;h++){const g=p[h].node;p[h].hiddenByReplacement=!!g.footprint&&!c.find(M=>M.footprint===g.footprint)}}getHeightAtTileCoord(t,n){const c=this.getNodesInfo(),p=[],h=[0,0,0],g=et.mat4.identity([]);for(let M=0;M<this.nodesInfo.length;M++){const C=c[M],P=C.node.meshes[0],b=P.transformedAabb;if(t<b.min[0]||n<b.min[1]||t>b.max[0]||n>b.max[1])continue;if(C.node.hidden===!0)return{height:1/0,maxHeight:C.feature.properties.height,hidden:!1,verticalScale:C.evaluatedScale[2]};et.mat4.invert(g,C.node.matrix),h[0]=t,h[1]=n,et.vec3.transformMat4(h,h,g);const L=(h[0]-P.aabb.min[0])/(P.aabb.max[0]-P.aabb.min[0])*pm|0,D=Math.min(63,(h[1]-P.aabb.min[1])/(P.aabb.max[1]-P.aabb.min[1])*pm|0)*pm+Math.min(63,L),A=P.heightmap[D];if(!(A<0&&C.node.footprint))return C.hiddenByReplacement?void 0:{height:A,maxHeight:C.feature.properties.height,hidden:!1,verticalScale:C.evaluatedScale[2]};if(C.node.footprint.grid.query(new Pi(t,n),new Pi(t,n),p),p.length>0)return{height:void 0,maxHeight:C.feature.properties.height,hidden:C.hiddenByReplacement,verticalScale:C.evaluatedScale[2]}}}}function rg(s,t){return!s.isLightConstant&&t}function Wx(s,t,n,c,p,h,g,M){let C=(61440&t|(61440&t)>>4)>>8,P=(3840&t|(3840&t)>>4)>>4,b=240&t|(240&t)>>4;n[3]>0&&(C=Ee(C,255*n[0],n[3]),P=Ee(P,255*n[1],n[3]),b=Ee(b,255*n[2],n[3]));const L=C<<8|P,D=b<<8|Math.floor(255*c[3]),A=function(ce){const ve=ii(ce,0,2);return Math.min(Math.round(.5*ve*255),255)}(c[2])<<8|15*c[0]<<4|15*c[1],R=ii(p[0],0,1),B=ii(p[1],0,1),q=ii(p[2],0,1),W=ii(p[3],0,1);let ee,te,Y,re;if(R!==B&&g!==h&&B!==R){const ce=g-h;te=1/(ce*(B-R)),Y=-(h+ce*R)/(ce*(B-R));const ve=ii(p[4],-1,1);re=Math.pow(10,ve),ee=255*q<<8|255*W}else ee=65535,te=0,Y=1,re=1;if(s.emplaceBack(L,D,A,ee,te,Y,re),M){const ce=M.length;M.clear();for(let ve=0;ve<ce;ve++)M.emplaceBack(L,D,A,ee,te,Y,re)}}function Zx(s,t,n){const c=s.node;let p=0;const h=n&Om.HasMeshoptCompression;for(const g of c.meshes){if(c.lights&&c.lightMeshIndex===p||!g.featureData)continue;g.featureArray=new pu,g.featureArray.reserve(g.featureData.length);let M=t;for(const C of g.featureData){const P=h?65535&C:C>>16&65535,b=h?C>>16&65535:65535&C,L=(15&b)<8?15&b:0,D=s.evaluatedRMEA[L],A=s.evaluatedColor[L],R=s.emissionHeightBasedParams[L];let B;if(M&&L===2&&c.lights&&(B=new pu,B.resize(10*c.lights.length)),Wx(g.featureArray,P,A,D,R,g.aabb.min[2],g.aabb.max[2],B),B&&M){M=!1;const q=c.meshes[c.lightMeshIndex];q.featureArray=B,q.featureArray._trim()}}g.featureArray._trim(),p++}}function A0(s,t,n,c){const p=1<<s.z;t.lat=Is((c/vn+s.y)/p),t.lng=ho((n/vn+s.x)/p)}kn(Gg,"Tiled3dModelBucket",{omit:["layers"]}),kn(E0,"Tiled3dModelFeature");const Xx={circle:class extends qs{constructor(s,t,n,c){super(s,{layout:Ii||(Ii=new ss({"circle-sort-key":new Pn(Ht.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Ri(Ht.layout_circle["circle-elevation-reference"]),visibility:new Ri(Ht.layout_circle.visibility)})),paint:Et||(Et=new ss({"circle-radius":new Pn(Ht.paint_circle["circle-radius"]),"circle-color":new Pn(Ht.paint_circle["circle-color"]),"circle-blur":new Pn(Ht.paint_circle["circle-blur"]),"circle-opacity":new Pn(Ht.paint_circle["circle-opacity"]),"circle-translate":new Ri(Ht.paint_circle["circle-translate"]),"circle-translate-anchor":new Ri(Ht.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ri(Ht.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ri(Ht.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Pn(Ht.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Pn(Ht.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Pn(Ht.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ri(Ht.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},t,n,c)}createBucket(s){return new le(s)}queryRadius(s){const t=s;return fi("circle-radius",this,t)+fi("circle-stroke-width",this,t)+ui(this.paint.get("circle-translate"))}queryIntersectsFeature(s,t,n,c,p,h,g,M){const C=Kt(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,s.pixelToTileUnitsFactor),P=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n);return Qu(s,c,h,g,M,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",C,P)}getProgramIds(){return["circle"]}getDefaultProgramParams(s,t,n){const c=Jl(this);return{config:new _u(this,{zoom:t,lut:n}),defines:c,overrideFog:!1}}},heatmap:class extends qs{createBucket(s){return new jp(s)}constructor(s,t,n,c){super(s,{layout:qp||(qp=new ss({visibility:new Ri(Ht.layout_heatmap.visibility)})),paint:vd||(vd=new ss({"heatmap-radius":new Pn(Ht.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Pn(Ht.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ri(Ht.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Hc(Ht.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ri(Ht.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},t,n,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Rf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return fi("heatmap-radius",this,s)}queryIntersectsFeature(s,t,n,c,p,h,g,M){const C=this.paint.get("heatmap-radius").evaluate(t,n);return Qu(s,c,h,g,M,!0,!0,new Pi(0,0),C)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(s,t,n){return s==="heatmap"?{config:new _u(this,{zoom:t,lut:n}),overrideFog:!1}:{}}},hillshade:class extends qs{constructor(s,t,n,c){super(s,{layout:am||(am=new ss({visibility:new Ri(Ht.layout_hillshade.visibility)})),paint:eh||(eh=new ss({"hillshade-illumination-direction":new Ri(Ht.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ri(Ht.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ri(Ht.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ri(Ht.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ri(Ht.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ri(Ht.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ri(Ht.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},t,n,c)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(s,t,n){return{overrideFog:!1}}},fill:class extends qs{constructor(s,t,n,c){super(s,{layout:Ao||(Ao=new ss({"fill-sort-key":new Pn(Ht.layout_fill["fill-sort-key"]),visibility:new Ri(Ht.layout_fill.visibility),"fill-elevation-reference":new Ri(Ht.layout_fill["fill-elevation-reference"])})),paint:Bf||(Bf=new ss({"fill-antialias":new Ri(Ht.paint_fill["fill-antialias"]),"fill-opacity":new Pn(Ht.paint_fill["fill-opacity"]),"fill-color":new Pn(Ht.paint_fill["fill-color"]),"fill-outline-color":new Pn(Ht.paint_fill["fill-outline-color"]),"fill-translate":new Ri(Ht.paint_fill["fill-translate"]),"fill-translate-anchor":new Ri(Ht.paint_fill["fill-translate-anchor"]),"fill-pattern":new Pn(Ht.paint_fill["fill-pattern"]),"fill-emissive-strength":new Ri(Ht.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Pn(Ht.paint_fill["fill-z-offset"]),"fill-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},t,n,c)}getProgramIds(){const s=this.paint.get("fill-pattern"),t=s&&s.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(s,t,n){return{config:new _u(this,{zoom:t,lut:n}),overrideFog:!1}}recalculate(s,t){super.recalculate(s,t);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new ro(s)}queryRadius(){return ui(this.paint.get("fill-translate"))}queryIntersectsFeature(s,t,n,c,p,h){return!s.queryGeometry.isAboveHorizon&&fe(Pt(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,s.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends qs{constructor(s,t,n,c){super(s,{layout:bl||(bl=new ss({visibility:new Ri(Ht["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ri(Ht["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:er||(er=new ss({"fill-extrusion-opacity":new Ri(Ht["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Pn(Ht["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ri(Ht["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ri(Ht["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Pn(Ht["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Pn(Ht["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Pn(Ht["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Ri(Ht["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Ri(Ht["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Ri(Ht["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ri(Ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ri(Ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ri(Ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ri(Ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ri(Ht["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ri(Ht["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ri(Ht["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Pn(Ht["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Pn(Ht["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ri(Ht["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ri(Ht["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ri(Ht["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ri(Ht["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Pn(Ht["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Pn(Ht["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Ri(Ht["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},t,n,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new Or(s)}queryRadius(){return ui(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(s,t,n,c,p,h,g,M,C){const P=Kt(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,s.pixelToTileUnitsFactor),b=this.paint.get("fill-extrusion-height").evaluate(t,n),L=this.paint.get("fill-extrusion-base").evaluate(t,n),D=[0,0],A=M&&h.elevation,R=h.elevation?h.elevation.exaggeration():1,B=s.tile.getBucket(this);if(A&&B instanceof Or){const Y=B.centroidVertexArray,re=C+1;re<Y.length&&(D[0]=Y.geta_centroid_pos0(re),D[1]=Y.geta_centroid_pos1(re))}if(D[0]===0&&D[1]===1)return!1;h.projection.name==="globe"&&(c=Tu([c],[new Pi(0,0),new Pi(vn,vn)],s.tileID.canonical).map(Y=>Y.polygon).flat());const q=A?M:null,[W,ee]=function(Y,re,ce,ve,Be,Oe,Pe,nt,Ue,lt,_t){return Y.projection.name==="globe"?function(dt,xt,Ct,Nt,wt,gi,Ui,mi,Dn,Mn,tn){const qi=[],nr=[],Fn=dt.projection.upVectorScale(tn,dt.center.lat,dt.worldSize).metersToTile,Hn=[0,0,0,1],zr=[0,0,0,1],Yr=(ia,ma,va,vs)=>{ia[0]=ma,ia[1]=va,ia[2]=vs,ia[3]=1},ta=Jc();Ct>0&&(Ct+=ta),Nt+=ta;for(const ia of xt){const ma=[],va=[];for(const vs of ia){const rs=vs.x+wt.x,Vr=vs.y+wt.y,Ya=dt.projection.projectTilePoint(rs,Vr,tn),Ja=dt.projection.upVector(tn,vs.x,vs.y);let zs=Ct,yo=Nt;if(Ui){const jo=fc(rs,Vr,Ct,Nt,Ui,mi,Dn,Mn);zs+=jo.base,yo+=jo.top}Ct!==0?Yr(Hn,Ya.x+Ja[0]*Fn*zs,Ya.y+Ja[1]*Fn*zs,Ya.z+Ja[2]*Fn*zs):Yr(Hn,Ya.x,Ya.y,Ya.z),Yr(zr,Ya.x+Ja[0]*Fn*yo,Ya.y+Ja[1]*Fn*yo,Ya.z+Ja[2]*Fn*yo),et.vec3.transformMat4(Hn,Hn,gi),et.vec3.transformMat4(zr,zr,gi),ma.push(new Se(Hn[0],Hn[1],Hn[2])),va.push(new Se(zr[0],zr[1],zr[2]))}qi.push(ma),nr.push(va)}return[qi,nr]}(Y,re,ce,ve,Be,Oe,Pe,nt,Ue,lt,_t):Pe?function(dt,xt,Ct,Nt,wt,gi,Ui,mi,Dn){const Mn=[],tn=[],qi=[0,0,0,1];for(const nr of dt){const Fn=[],Hn=[];for(const zr of nr){const Yr=zr.x+Nt.x,ta=zr.y+Nt.y,ia=fc(Yr,ta,xt,Ct,gi,Ui,mi,Dn);qi[0]=Yr,qi[1]=ta,qi[2]=ia.base,qi[3]=1,et.vec4.transformMat4(qi,qi,wt),qi[3]=Math.max(qi[3],1e-5);const ma=new Se(qi[0]/qi[3],qi[1]/qi[3],qi[2]/qi[3]);qi[0]=Yr,qi[1]=ta,qi[2]=ia.top,qi[3]=1,et.vec4.transformMat4(qi,qi,wt),qi[3]=Math.max(qi[3],1e-5);const va=new Se(qi[0]/qi[3],qi[1]/qi[3],qi[2]/qi[3]);Fn.push(ma),Hn.push(va)}Mn.push(Fn),tn.push(Hn)}return[Mn,tn]}(re,ce,ve,Be,Oe,Pe,nt,Ue,lt):function(dt,xt,Ct,Nt,wt){const gi=[],Ui=[],mi=wt[8]*xt,Dn=wt[9]*xt,Mn=wt[10]*xt,tn=wt[11]*xt,qi=wt[8]*Ct,nr=wt[9]*Ct,Fn=wt[10]*Ct,Hn=wt[11]*Ct;for(const zr of dt){const Yr=[],ta=[];for(const ia of zr){const ma=ia.x+Nt.x,va=ia.y+Nt.y,vs=wt[0]*ma+wt[4]*va+wt[12],rs=wt[1]*ma+wt[5]*va+wt[13],Vr=wt[2]*ma+wt[6]*va+wt[14],Ya=wt[3]*ma+wt[7]*va+wt[15],Ja=vs+mi,zs=rs+Dn,yo=Vr+Mn,jo=Math.max(Ya+tn,1e-5),vo=vs+qi,so=rs+nr,Co=Vr+Fn,rl=Math.max(Ya+Hn,1e-5);Yr.push(new Se(Ja/jo,zs/jo,yo/jo)),ta.push(new Se(vo/rl,so/rl,Co/rl))}gi.push(Yr),Ui.push(ta)}return[gi,Ui]}(re,ce,ve,Be,Oe)}(h,c,L,b,P,g,q,D,R,h.center.lat,s.tileID.canonical),te=s.queryGeometry;return function(Y,re,ce){let ve=1/0;fe(ce,re)&&(ve=sp(ce,re[0]));for(let Be=0;Be<re.length;Be++){const Oe=re[Be],Pe=Y[Be];for(let nt=0;nt<Oe.length-1;nt++){const Ue=Oe[nt],lt=[Ue,Oe[nt+1],Pe[nt+1],Pe[nt],Ue];se(ce,lt)&&(ve=Math.min(ve,sp(ce,lt)))}}return ve!==1/0&&ve}(W,ee,te.isPointQuery()?te.screenBounds:te.screenGeometry)}},line:class extends qs{constructor(s,t,n,c){const p=Ga();super(s,p,t,n,c),p.layout&&(this.layout=new id(p.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof nc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,t){super.recalculate(s,t),this.paint._values["line-floorwidth"]=(()=>{if(Wa)return Wa;const n=Ga();return Wa=new Ds(n.paint.properties["line-width"].specification),Wa.useIntegerZoom=!0,Wa})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new Sd(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(s,t,n){const c=ya(this);return{config:new _u(this,{zoom:t,lut:n}),defines:c,overrideFog:!1}}queryRadius(s){const t=s,n=Ha(fi("line-width",this,t),fi("line-gap-width",this,t)),c=fi("line-offset",this,t);return n/2+Math.abs(c)+ui(this.paint.get("line-translate"))}queryIntersectsFeature(s,t,n,c,p,h){if(s.queryGeometry.isAboveHorizon)return!1;const g=Pt(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,s.pixelToTileUnitsFactor),M=s.pixelToTileUnitsFactor/2*Ha(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),C=this.paint.get("line-offset").evaluate(t,n);return C&&(c=function(P,b){const L=[],D=new Pi(0,0);for(let A=0;A<P.length;A++){const R=P[A],B=[];for(let q=0;q<R.length;q++){const W=R[q],ee=R[q+1],te=q===0?D:W.sub(R[q-1])._unit()._perp(),Y=q===R.length-1?D:ee.sub(W)._unit()._perp(),re=te._add(Y)._unit();re._mult(1/(re.x*Y.x+re.y*Y.y)),B.push(re._mult(b)._add(W))}L.push(B)}return L}(c,C*s.pixelToTileUnitsFactor)),function(P,b,L){for(let D=0;D<b.length;D++){const A=b[D];if(P.length>=3){for(let R=0;R<A.length;R++)if(je(P,A[R]))return!0}if(De(P,A,L))return!0}return!1}(g,c,M)}isTileClipped(){return!0}isDraped(s){return!this.hasElevatedBuckets}},symbol:Pg,background:class extends qs{constructor(s,t,n,c){super(s,{layout:Jy||(Jy=new ss({visibility:new Ri(Ht.layout_background.visibility)})),paint:Qy||(Qy=new ss({"background-pitch-alignment":new Ri(Ht.paint_background["background-pitch-alignment"]),"background-color":new Ri(Ht.paint_background["background-color"]),"background-pattern":new Ri(Ht.paint_background["background-pattern"]),"background-opacity":new Ri(Ht.paint_background["background-opacity"]),"background-emissive-strength":new Ri(Ht.paint_background["background-emissive-strength"]),"background-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},t,n,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(s,t,n){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:r0,"raster-particle":u0,sky:class extends qs{constructor(s,t,n,c){super(s,{layout:o0||(o0=new ss({visibility:new Ri(Ht.layout_sky.visibility)})),paint:l0||(l0=new ss({"sky-type":new Ri(Ht.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ri(Ht.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ri(Ht.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ri(Ht.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ri(Ht.paint_sky["sky-gradient-radius"]),"sky-gradient":new Hc(Ht.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ri(Ht.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ri(Ht.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ri(Ht.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},t,n,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Rf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(s,t){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),p=!c,h=s.style.light,g=h.properties.get("position");return p&&h.properties.get("anchor")==="viewport"&&Xn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?__(g.azimuthal,90-g.polar,t):__(c[0],90-c[1],t)}const n=this.paint.get("sky-gradient-center");return __(n[0],90-n[1],t)}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}},slot:class extends qs{constructor(s,t,n,c){super(s,{paint:c0||(c0=new ss({}))},t,null)}},model:class extends qs{constructor(s,t,n,c){super(s,{layout:x0||(x0=new ss({visibility:new Ri(Ht.layout_model.visibility),"model-id":new Pn(Ht.layout_model["model-id"])})),paint:b0||(b0=new ss({"model-opacity":new Pn(Ht.paint_model["model-opacity"]),"model-rotation":new Pn(Ht.paint_model["model-rotation"]),"model-scale":new Pn(Ht.paint_model["model-scale"]),"model-translation":new Pn(Ht.paint_model["model-translation"]),"model-color":new Pn(Ht.paint_model["model-color"]),"model-color-mix-intensity":new Pn(Ht.paint_model["model-color-mix-intensity"]),"model-type":new Ri(Ht.paint_model["model-type"]),"model-cast-shadows":new Ri(Ht.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ri(Ht.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ri(Ht.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Pn(Ht.paint_model["model-emissive-strength"]),"model-roughness":new Pn(Ht.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Pn(Ht.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ri(Ht.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ri(Ht.paint_model["model-front-cutoff"]),"model-color-use-theme":new Pn({type:"string",default:"default","property-type":"data-driven"})}))},t,n,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new x_(s)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(s){return s instanceof Gg?vn-1:0}queryIntersectsFeature(s,t,n,c,p,h){if(!this.modelManager)return!1;const g=this.modelManager,M=s.tile.getBucket(this);if(!(M&&M instanceof x_))return!1;for(const C in M.instancesPerModel){const P=M.instancesPerModel[C],b=t.id!==void 0?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(P.idToFeaturesIndex.hasOwnProperty(b)){const L=P.features[P.idToFeaturesIndex[b]],D=g.getModel(C,this.scope);if(!D)return!1;let A=et.mat4.create();const R=new xa(0,0),B=M.canonical;let q=Number.MAX_VALUE;for(let W=0;W<L.instancedDataCount;++W){const ee=16*(L.instancedDataOffset+W),te=P.instancedDataArray.float32,Y=[te[ee+4],te[ee+5],te[ee+6]];A0(B,R,te[ee],0|te[ee+1]),w0(A,D,h,R,L.rotation,L.scale,Y,!1,!1,!1),h.projection.name==="globe"&&(A=v_(A,h));const re=et.mat4.multiply([],h.projMatrix,A),ce=s.queryGeometry,ve=m0(ce.isPointQuery()?ce.screenBounds:ce.screenGeometry,h,re,D.aabb);ve!=null&&(q=Math.min(ve,q))}return q!==Number.MAX_VALUE&&q}}return!1}_handleOverridablePaintPropertyUpdate(s,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven()||s!=="model-color"&&s!=="model-color-mix-intensity"&&s!=="model-rotation"&&s!=="model-scale"&&s!=="model-translation"&&s!=="model-emissive-strength")}_isPropertyZoomDependent(s){const t=this._transitionablePaint._values[s];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof ou}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends qs{constructor(s,t,n,c){super(s,{layout:Xp||(Xp=new ss({"clip-layer-types":new Ri(Ht.layout_clip["clip-layer-types"]),"clip-layer-scope":new Ri(Ht.layout_clip["clip-layer-scope"])})),paint:Yp||(Yp=new ss({}))},t,n,c)}recalculate(s,t){super.recalculate(s,t)}createBucket(s){return new Lp(s)}isTileClipped(){return!0}is3D(){return!0}}};class Yx{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class $x{constructor(){this.tasks={},this.taskQueue=[],Nr(["process"],this),this.invoker=new Yx(this.process),this.nextId=0}add(t,n){const c=this.nextId++,p=function({type:h,isSymbolTile:g,zoom:M}){return M=M||0,h==="message"?0:h!=="maybePrepare"||g?h!=="parseTile"||g?h==="parseTile"&&g?300-M:h==="maybePrepare"&&g?400-M:500:200-M:100-M}(n);if(p===0){try{t()}finally{}return null}return this.tasks[c]={fn:t,metadata:n,priority:p,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const n=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let t=null,n=1/0;for(let p=0;p<this.taskQueue.length;p++){const h=this.tasks[this.taskQueue[p]];h.priority<n&&(n=h.priority,t=p)}if(t===null)return null;const c=this.taskQueue[t];return this.taskQueue.splice(t,1),c}remove(){this.invoker.remove()}}class C0{constructor(t,n,c){this.target=t,this.parent=n,this.mapId=c,this.callbacks={},this.cancelCallbacks={},Nr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new $x}send(t,n,c,p,h=!1,g){const M=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=g,this.callbacks[M]=c);const C=new Set;return this.target.postMessage({id:M,type:t,hasCallback:!!c,targetMapId:p,mustQueue:h,sourceMapId:this.mapId,data:Vu(n,C)},C),{cancel:()=>{c&&delete this.callbacks[M],this.target.postMessage({id:M,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(t){const n=t.data,c=n.id;if(c&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const p=this.cancelCallbacks[c];delete this.cancelCallbacks[c],p&&p.cancel()}else if(n.mustQueue||Ca()){const p=this.callbacks[c],h=this.scheduler.add(()=>this.processTask(c,n),p&&p.metadata||{type:"message"});h&&(this.cancelCallbacks[c]=h)}else this.processTask(c,n)}processTask(t,n){if(delete this.cancelCallbacks[t],n.type==="<response>"){const c=this.callbacks[t];delete this.callbacks[t],c&&(n.error?c(jl(n.error)):c(null,jl(n.data)))}else{const c=new Set,p=n.hasCallback?(g,M)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:g?Vu(g):null,data:Vu(M,c)},c)}:()=>{},h=jl(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,h,p);else if(this.parent.getWorkerSource){const g=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,g[0],h.source,h.scope)[g[1]](h,p)}else p(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var ag={workerUrl:"",workerClass:null,workerParams:void 0};const T_="mapboxgl_preloaded_worker_pool";class gm{constructor(){this.active={}}acquire(t,n=gm.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<n;)this.workers.push(ag.workerClass!=null?new ag.workerClass:new self.Worker(ag.workerUrl,ag.workerParams));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[T_]}numActive(){return Object.keys(this.active).length}}gm.workerCount=2;class Fm{constructor(t,n,c="Worker",p=gm.workerCount){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=Er();const h=this.workerPool.acquire(this.id,p);for(let g=0;g<h.length;g++){const M=new Fm.Actor(h[g],n,this.id);M.name=`${c} ${g}`,this.actors.push(M)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,n,c){gr(this.actors,(p,h)=>{p.send(t,n,h)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}let sg,S_;function Hg(){return sg||(sg=new gm),sg}Fm.Actor=C0;const E_=new we(0,0,0);var A_=(s=>(s[s.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",s[s.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",s[s.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",s))(A_||{}),jg=(s=>(s[s.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",s[s.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",s[s.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",s[s.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",s))(jg||{}),og=(s=>(s[s.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",s[s.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",s[s.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",s[s.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",s[s.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",s))(og||{}),L0=(s=>(s[s.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",s[s.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",s[s.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",s))(L0||{}),km=(s=>(s[s.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",s[s.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",s[s.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",s[s.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",s[s.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",s[s.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",s))(km||{}),R0=(s=>(s[s.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",s[s.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",s[s.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",s))(R0||{});function Kx(s,t,n){s===1&&t.icons.push(function(c,p){return function(h){if(h.usvg_tree.height||(h.usvg_tree.height=h.usvg_tree.width),!h.metadata)return h;const{metadata:g}=h;if(g.content_area){const{content_area:M}=g;M.top==null&&(M.top=M.left),M.width==null&&(M.width=h.usvg_tree.width),M.height==null&&(M.height=M.width)}return g.stretch_x&&g.stretch_x.length&&I0(g,"x"),g.stretch_y&&g.stretch_y.length&&I0(g,"y"),h}(c.readFields(Jx,{name:void 0},p))}(n,n.readVarint()+n.pos))}function I0(s,t){const n=[],c=s[`stretch_${t}`];let p=null;for(let h=0;h<c.length;h++)p===null?p=n.length===0?c[0]:n[n.length-1][1]+c[h]:(n.push([p,p+c[h]]),p=null);s[`stretch_${t}_areas`]=n}function Jx(s,t,n){s===1?t.name=n.readString():s===2?t.metadata=function(c,p){return c.readFields(Qx,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},p)}(n,n.readVarint()+n.pos):s===3&&(t.usvg_tree=function(c,p){return c.readFields(i1,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},p)}(n,n.readVarint()+n.pos),t.data="usvg_tree")}function Qx(s,t,n){s===1?t.stretch_x=n.readPackedVarint():s===2?t.stretch_y=n.readPackedVarint():s===3?t.content_area=function(c,p){return c.readFields(e1,{left:0},p)}(n,n.readVarint()+n.pos):s===4&&t.variables.push(function(c,p){return c.readFields(t1,{name:void 0},p)}(n,n.readVarint()+n.pos))}function e1(s,t,n){s===1?t.left=n.readVarint():s===2?t.width=n.readVarint():s===3?t.top=n.readVarint():s===4&&(t.height=n.readVarint())}function t1(s,t,n){s===1?t.name=n.readString():s===2&&(t.rgb_color=Zg(n.readVarint()),t.value="rgb_color")}function i1(s,t,n){s===1?t.width=t.height=n.readVarint():s===2?t.height=n.readVarint():s===3?t.children.push(qg(n,n.readVarint()+n.pos)):s===4?t.linear_gradients.push(function(c,p){return c.readFields(c1,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},p)}(n,n.readVarint()+n.pos)):s===5?t.radial_gradients.push(function(c,p){return c.readFields(h1,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},p)}(n,n.readVarint()+n.pos)):s===7?t.clip_paths.push(function(c,p){return c.readFields(d1,{children:[]},p)}(n,n.readVarint()+n.pos)):s===8&&t.masks.push(function(c,p){const h=c.readFields(f1,{left:0,width:20,mask_type:1,children:[]},p);return h.height==null&&(h.height=h.width),h.top==null&&(h.top=h.left),h}(n,n.readVarint()+n.pos))}function qg(s,t){return s.readFields(n1,{},t)}function n1(s,t,n){s===1?(t.group=function(c,p){return c.readFields(r1,{opacity:255,children:[]},p)}(n,n.readVarint()+n.pos),t.node="group"):s===2&&(t.path=function(c,p){return c.readFields(s1,{paint_order:1,commands:[],step:1,diffs:[],rule:1},p)}(n,n.readVarint()+n.pos),t.node="path")}function r1(s,t,n){s===1?t.transform=Wg(n,n.readVarint()+n.pos):s===2?t.opacity=n.readVarint():s===5?t.clip_path_idx=n.readVarint():s===6?t.mask_idx=n.readVarint():s===7&&t.children.push(qg(n,n.readVarint()+n.pos))}function Wg(s,t){return s.readFields(a1,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},t)}function a1(s,t,n){s===1?t.sx=n.readFloat():s===2?t.ky=n.readFloat():s===3?t.kx=n.readFloat():s===4?t.sy=n.readFloat():s===5?t.tx=n.readFloat():s===6&&(t.ty=n.readFloat())}function s1(s,t,n){s===1?t.fill=function(c,p){return c.readFields(o1,{rgb_color:E_,paint:"rgb_color",opacity:255},p)}(n,n.readVarint()+n.pos):s===2?t.stroke=function(c,p){return c.readFields(l1,{rgb_color:E_,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},p)}(n,n.readVarint()+n.pos):s===3?t.paint_order=n.readVarint():s===5?n.readPackedVarint(t.commands):s===6?t.step=n.readFloat():s===7?n.readPackedSVarint(t.diffs):s===8&&(t.rule=n.readVarint())}function o1(s,t,n){s===1?(t.rgb_color=Zg(n.readVarint()),t.paint="rgb_color"):s===2?(t.linear_gradient_idx=n.readVarint(),t.paint="linear_gradient_idx"):s===3?(t.radial_gradient_idx=n.readVarint(),t.paint="radial_gradient_idx"):s===5&&(t.opacity=n.readVarint())}function Zg(s){return new we((s>>16&255)/255,(s>>8&255)/255,(255&s)/255,1)}function l1(s,t,n){s===1?(t.rgb_color=Zg(n.readVarint()),t.paint="rgb_color"):s===2?(t.linear_gradient_idx=n.readVarint(),t.paint="linear_gradient_idx"):s===3?(t.radial_gradient_idx=n.readVarint(),t.paint="radial_gradient_idx"):s===5?n.readPackedFloat(t.dasharray):s===6?t.dashoffset=n.readFloat():s===7?t.miterlimit=n.readFloat():s===8?t.opacity=n.readVarint():s===9?t.width=n.readFloat():s===10?t.linecap=n.readVarint():s===11&&(t.linejoin=n.readVarint())}function c1(s,t,n){s===1?t.transform=Wg(n,n.readVarint()+n.pos):s===2?t.spread_method=n.readVarint():s===3?t.stops.push(D0(n,n.readVarint()+n.pos)):s===4?t.x1=n.readFloat():s===5?t.y1=n.readFloat():s===6?t.x2=n.readFloat():s===7&&(t.y2=n.readFloat())}function D0(s,t){return s.readFields(u1,{offset:0,opacity:255,rgb_color:E_},t)}function u1(s,t,n){s===1?t.offset=n.readFloat():s===2?t.opacity=n.readVarint():s===3&&(t.rgb_color=Zg(n.readVarint()))}function h1(s,t,n){s===1?t.transform=Wg(n,n.readVarint()+n.pos):s===2?t.spread_method=n.readVarint():s===3?t.stops.push(D0(n,n.readVarint()+n.pos)):s===4?t.cx=n.readFloat():s===5?t.cy=n.readFloat():s===6?t.r=n.readFloat():s===7?t.fx=n.readFloat():s===8?t.fy=n.readFloat():s===9&&(t.fr=n.readFloat())}function d1(s,t,n){s===1?t.transform=Wg(n,n.readVarint()+n.pos):s===2?t.clip_path_idx=n.readVarint():s===3&&t.children.push(qg(n,n.readVarint()+n.pos))}function f1(s,t,n){s===1?t.left=t.top=n.readFloat():s===2?t.width=t.height=n.readFloat():s===3?t.top=n.readFloat():s===4?t.height=n.readFloat():s===5?t.mask_type=n.readVarint():s===6?t.mask_idx=n.readVarint():s===7&&t.children.push(qg(n,n.readVarint()+n.pos))}class p1{static calculate(t,n){const c=new Map,p=new Map;if(Object.keys(t).length===0)return c;n.forEach(h=>{p.set(h.name,h.rgb_color||new we(0,0,0))});for(const[h,g]of Object.entries(t))p.has(h)?c.set(p.get(h).toStringPremultipliedAlpha(),g):console.warn(`Ignoring unknown image variable "${h}"`);return c}}function Nm(s,t=255,n){const c=t/255,p=s.toStringPremultipliedAlpha(),h=n.has(p)?n.get(p).clone():s.clone();return h.a=c,h.toString()}function lg(s,t){if(!Ce()){const n=document.createElement("canvas");return n.width=s,n.height=t,n}return new OffscreenCanvas(s,t)}function m1(s,t){const n=p1.calculate(t.params,s.metadata?s.metadata.variables:[]),c=s.usvg_tree,p=c.width,h=c.height,g=t.transform?t.transform:new DOMMatrix,M=Math.max(1,Math.round(p*g.a)),C=Math.max(1,Math.round(h*g.d)),P=new DOMMatrix([M/p,0,0,C/h,0,0]),b=lg(M,C).getContext("2d");return C_(b,P,c,c,n),b.getImageData(0,0,M,C)}function C_(s,t,n,c,p){for(const h of c.children)z0(s,t,n,h,p)}function z0(s,t,n,c,p){c.group?(s.save(),function(h,g,M,C,P){const b=C.mask_idx!=null?M.masks[C.mask_idx]:null,L=C.clip_path_idx!=null?M.clip_paths[C.clip_path_idx]:null;if(C.transform&&(g=Xg(C.transform).preMultiplySelf(g)),!function(R,B,q){return R.opacity!==255||B||q}(C,L!=null,b!=null))return void C_(h,g,M,C,P);const D=lg(h.canvas.width,h.canvas.height),A=D.getContext("2d");C_(A,g,M,C,P),L&&U0(A,g,M,L),b&&V0(A,g,M,b,P),h.globalAlpha=C.opacity/255,h.drawImage(D,0,0)}(s,t,n,c.group,p),s.restore()):c.path&&(s.save(),function(h,g,M,C,P){const b=G0(C);h.setTransform(g),C.paint_order===L0.PAINT_ORDER_FILL_AND_STROKE?(P0(h,M,C,b,P),B0(h,M,C,b,P)):(B0(h,M,C,b,P),P0(h,M,C,b,P))}(s,t,n,c.path,p),s.restore())}function P0(s,t,n,c,p){const h=n.fill;if(!h)return;const g=h.opacity/255;switch(h.paint){case"rgb_color":s.fillStyle=Nm(h.rgb_color,h.opacity,p);break;case"linear_gradient_idx":s.fillStyle=F0(s,t.linear_gradients[h.linear_gradient_idx],g,p);break;case"radial_gradient_idx":s.fillStyle=k0(s,t.radial_gradients[h.radial_gradient_idx],g,p)}s.fill(c,O0(n))}function O0(s){return s.rule===A_.PATH_RULE_NON_ZERO?"nonzero":s.rule===A_.PATH_RULE_EVEN_ODD?"evenodd":void 0}function B0(s,t,n,c,p){const h=n.stroke;if(!h)return;s.lineWidth=h.width,s.miterLimit=h.miterlimit,s.setLineDash(h.dasharray),s.lineDashOffset=h.dashoffset;const g=h.opacity/255;switch(h.paint){case"rgb_color":s.strokeStyle=Nm(h.rgb_color,h.opacity,p);break;case"linear_gradient_idx":s.strokeStyle=F0(s,t.linear_gradients[h.linear_gradient_idx],g,p);break;case"radial_gradient_idx":s.strokeStyle=k0(s,t.radial_gradients[h.radial_gradient_idx],g,p)}switch(h.linejoin){case og.LINE_JOIN_MITER_CLIP:case og.LINE_JOIN_MITER:s.lineJoin="miter";break;case og.LINE_JOIN_ROUND:s.lineJoin="round";break;case og.LINE_JOIN_BEVEL:s.lineJoin="bevel"}switch(h.linecap){case jg.LINE_CAP_BUTT:s.lineCap="butt";break;case jg.LINE_CAP_ROUND:s.lineCap="round";break;case jg.LINE_CAP_SQUARE:s.lineCap="square"}s.stroke(c)}function F0(s,t,n,c){if(t.stops.length===1){const D=t.stops[0];return Nm(D.rgb_color,D.opacity*n,c)}const p=Xg(t.transform),{x1:h,y1:g,x2:M,y2:C}=t,P=p.transformPoint(new DOMPoint(h,g)),b=p.transformPoint(new DOMPoint(M,C)),L=s.createLinearGradient(P.x,P.y,b.x,b.y);for(const D of t.stops)L.addColorStop(D.offset,Nm(D.rgb_color,D.opacity*n,c));return L}function k0(s,t,n,c){if(t.stops.length===1){const D=t.stops[0];return Nm(D.rgb_color,D.opacity*n,c)}const p=Xg(t.transform),{fx:h,fy:g,cx:M,cy:C}=t,P=p.transformPoint(new DOMPoint(h,g)),b=p.transformPoint(new DOMPoint(M,C)),L=s.createRadialGradient(P.x,P.y,0,b.x,b.y,t.r*((p.a+p.d)/2));for(const D of t.stops)L.addColorStop(D.offset,Nm(D.rgb_color,D.opacity*n,c));return L}function N0(s,t,n,c){const p=c.transform?Xg(c.transform).preMultiplySelf(t):t,h=lg(s.canvas.width,s.canvas.height),g=h.getContext("2d");for(const C of c.children)if(C.group)N0(g,p,n,C.group);else if(C.path){const P=C.path,b=new Path2D;b.addPath(G0(P),p),g.fill(b,O0(P))}const M=c.clip_path_idx!=null?n.clip_paths[c.clip_path_idx]:null;M&&U0(g,p,n,M),s.globalCompositeOperation="source-over",s.drawImage(h,0,0)}function U0(s,t,n,c){const p=lg(s.canvas.width,s.canvas.height);N0(p.getContext("2d"),t,n,c),s.globalCompositeOperation="destination-in",s.drawImage(p,0,0)}function V0(s,t,n,c,p){if(c.children.length===0)return;const h=c.mask_idx!=null?n.masks[c.mask_idx]:null;h&&V0(s,t,n,h,p);const g=s.canvas.width,M=s.canvas.height,C=lg(g,M),P=C.getContext("2d"),b=c.width,L=c.height,D=c.left,A=c.top,R=new Path2D,B=new Path2D;B.rect(D,A,b,L),R.addPath(B,t),P.clip(R);for(const ee of c.children)z0(P,t,n,ee,p);const q=P.getImageData(0,0,g,M),W=q.data;if(c.mask_type===R0.MASK_TYPE_LUMINANCE)for(let ee=0;ee<W.length;ee+=4)W[ee+3]=W[ee+3]/255*(.2126*W[ee]+.7152*W[ee+1]+.0722*W[ee+2]);P.putImageData(q,0,0),s.globalCompositeOperation="destination-in",s.drawImage(C,0,0)}function Xg(s){return s?new DOMMatrix([s.sx,s.ky,s.kx,s.sy,s.tx,s.ty]):new DOMMatrix}function G0(s){const t=new Path2D,n=s.step;let c=s.diffs[0]*n,p=s.diffs[1]*n;t.moveTo(c,p);for(let h=0,g=2;h<s.commands.length;h++)switch(s.commands[h]){case km.PATH_COMMAND_MOVE:c+=s.diffs[g++]*n,p+=s.diffs[g++]*n,t.moveTo(c,p);break;case km.PATH_COMMAND_LINE:c+=s.diffs[g++]*n,p+=s.diffs[g++]*n,t.lineTo(c,p);break;case km.PATH_COMMAND_QUAD:{const M=c+s.diffs[g++]*n,C=p+s.diffs[g++]*n;c=M+s.diffs[g++]*n,p=C+s.diffs[g++]*n,t.quadraticCurveTo(M,C,c,p);break}case km.PATH_COMMAND_CUBIC:{const M=c+s.diffs[g++]*n,C=p+s.diffs[g++]*n,P=M+s.diffs[g++]*n,b=C+s.diffs[g++]*n;c=P+s.diffs[g++]*n,p=b+s.diffs[g++]*n,t.bezierCurveTo(M,C,P,b,c,p);break}case km.PATH_COMMAND_CLOSE:t.closePath()}return t}class L_{constructor(t){this.capacity=t,this.cache=new Map}get(t){if(!this.cache.has(t))return;const n=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,n),n}put(t,n){this.cache.has(t)?this.cache.delete(t):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(t,n)}delete(t){this.cache.delete(t)}}class R_{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(t){return new Vo(t,t.data)}getFromCache(t,n,c){return this.cacheMap.has(c)||this.cacheMap.set(c,new L_(150)),this.cacheMap.get(c).get(ql(t.serialize(),n))}setInCache(t,n,c,p){this.cacheDependenciesMap.has(p)||this.cacheDependenciesMap.set(p,new Map),this.cacheMap.has(p)||this.cacheMap.set(p,new L_(150));const h=this.cacheDependenciesMap.get(p);h.get(ql(t.id,c))||h.set(ql(t.id,c),new Set);const g=this.cacheMap.get(p),M=t.serialize();h.get(ql(t.id,c)).add(M),g.put(ql(t.serialize(),c),n)}removeImagesFromCacheByIds(t,n,c=""){if(!this.cacheMap.has(c)||!this.cacheDependenciesMap.has(c))return;const p=this.cacheMap.get(c),h=this.cacheDependenciesMap.get(c);for(const g of t)if(h.has(ql(g,n))){for(const M of h.get(ql(g,n)))p.delete(M);h.delete(ql(g,n))}}rasterize(t,n,c,p,h=m1){const g=this.getFromCache(t,c,p);if(g)return g.clone();const M=h(n.icon,t.options),C=R_._getImage(M);return this.setInCache(t,C,c,p),C.clone()}}class H0{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,n){const c=this.toIdx(t,n);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(t,n){return this.leaves[this.toIdx(t,n)]}toIdx(t,n){return n*this.size+t}}function j0(s,t,n,c){let p=0,h=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(c[g])<1e-15){if(n[g]<s[g]||n[g]>t[g])return null}else{const M=1/c[g];let C=(s[g]-n[g])*M,P=(t[g]-n[g])*M;if(C>P){const b=C;C=P,P=b}if(C>p&&(p=C),P<h&&(h=P),p>h)return null}return p}function q0(s,t,n,c,p,h,g,M,C,P,b){const L=c-s,D=p-t,A=h-n,R=g-s,B=M-t,q=C-n,W=b[1]*q-b[2]*B,ee=b[2]*R-b[0]*q,te=b[0]*B-b[1]*R,Y=L*W+D*ee+A*te;if(Math.abs(Y)<1e-15)return null;const re=1/Y,ce=P[0]-s,ve=P[1]-t,Be=P[2]-n,Oe=(ce*W+ve*ee+Be*te)*re;if(Oe<0||Oe>1)return null;const Pe=ve*A-Be*D,nt=Be*L-ce*A,Ue=ce*D-ve*L,lt=(b[0]*Pe+b[1]*nt+b[2]*Ue)*re;return lt<0||Oe+lt>1?null:(R*Pe+B*nt+q*Ue)*re}function W0(s,t,n){return(s-t)/(n-t)}function Z0(s,t,n,c,p,h,g,M,C){const P=1<<n,b=h-c,L=g-p,D=(s+1)/P*b+c,A=(t+0)/P*L+p,R=(t+1)/P*L+p;M[0]=(s+0)/P*b+c,M[1]=A,C[0]=D,C[1]=R}class X0{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(h){const g=Math.ceil(Math.log2(h.dim/8)),M=[];let C=Math.ceil(Math.pow(2,g));const P=1/C,b=(A,R,B,q,W)=>{const ee=q?1:0,te=(A+1)*B-ee,Y=R*B,re=(R+1)*B-ee;W[0]=A*B,W[1]=Y,W[2]=te,W[3]=re};let L=new H0(C);const D=[];for(let A=0;A<C*C;A++){b(A%C,Math.floor(A/C),P,!1,D);const R=im(D[0],D[1],h),B=im(D[2],D[1],h),q=im(D[2],D[3],h),W=im(D[0],D[3],h);L.minimums.push(Math.min(R,B,q,W)),L.maximums.push(Math.max(R,B,q,W)),L.leaves.push(1)}for(M.push(L),C/=2;C>=1;C/=2){const A=M[M.length-1];L=new H0(C);for(let R=0;R<C*C;R++){b(R%C,Math.floor(R/C),2,!0,D);const B=A.getElevation(D[0],D[1]),q=A.getElevation(D[2],D[1]),W=A.getElevation(D[2],D[3]),ee=A.getElevation(D[0],D[3]),te=A.isLeaf(D[0],D[1]),Y=A.isLeaf(D[2],D[1]),re=A.isLeaf(D[2],D[3]),ce=A.isLeaf(D[0],D[3]),ve=Math.min(B.min,q.min,W.min,ee.min),Be=Math.max(B.max,q.max,W.max,ee.max),Oe=te&&Y&&re&&ce;L.maximums.push(Be),L.minimums.push(ve),L.leaves.push(Be-ve<=5&&Oe?1:0)}M.push(L)}return M}(this.dem),c=n.length-1,p=n[c];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(n,0,0,c,0)}raycastRoot(t,n,c,p,h,g,M=1){return j0([t,n,-100],[c,p,this.maximums[0]*M],h,g)}raycast(t,n,c,p,h,g,M=1){if(!this.nodeCount)return null;const C=this.raycastRoot(t,n,c,p,h,g,M);if(C==null)return null;const P=[],b=[],L=[],D=[],A=[{idx:0,t:C,nodex:0,nodey:0,depth:0}];for(;A.length>0;){const{idx:R,t:B,nodex:q,nodey:W,depth:ee}=A.pop();if(this.leaves[R]){Z0(q,W,ee,t,n,c,p,L,D);const Y=1<<ee,re=(q+0)/Y,ce=(q+1)/Y,ve=(W+0)/Y,Be=(W+1)/Y,Oe=im(re,ve,this.dem)*M,Pe=im(ce,ve,this.dem)*M,nt=im(ce,Be,this.dem)*M,Ue=im(re,Be,this.dem)*M,lt=q0(L[0],L[1],Oe,D[0],L[1],Pe,D[0],D[1],nt,h,g),_t=q0(D[0],D[1],nt,L[0],D[1],Ue,L[0],L[1],Oe,h,g),dt=Math.min(lt!==null?lt:Number.MAX_VALUE,_t!==null?_t:Number.MAX_VALUE);if(dt!==Number.MAX_VALUE)return dt;{const xt=et.vec3.scaleAndAdd([],h,g,B);if(Y0(Oe,Pe,Ue,nt,W0(xt[0],L[0],D[0]),W0(xt[1],L[1],D[1]))>=xt[2])return B}continue}let te=0;for(let Y=0;Y<this._siblingOffset.length;Y++){Z0((q<<1)+this._siblingOffset[Y][0],(W<<1)+this._siblingOffset[Y][1],ee+1,t,n,c,p,L,D),L[2]=-100,D[2]=this.maximums[this.childOffsets[R]+Y]*M;const re=j0(L,D,h,g);if(re!=null){const ce=re;P[Y]=ce;let ve=!1;for(let Be=0;Be<te&&!ve;Be++)ce>=P[b[Be]]&&(b.splice(Be,0,Y),ve=!0);ve||(b[te]=Y),te++}}for(let Y=0;Y<te;Y++){const re=b[Y];A.push({idx:this.childOffsets[R]+re,t:P[re],nodex:(q<<1)+this._siblingOffset[re][0],nodey:(W<<1)+this._siblingOffset[re][1],depth:ee+1})}}return null}_addNode(t,n,c){return this.minimums.push(t),this.maximums.push(n),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(t,n,c,p,h){if(t[p].isLeaf(n,c)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const g=p-1,M=t[g];let C=0,P=0;for(let b=0;b<this._siblingOffset.length;b++){const L=2*n+this._siblingOffset[b][0],D=2*c+this._siblingOffset[b][1],A=M.getElevation(L,D),R=M.isLeaf(L,D),B=this._addNode(A.min,A.max,R);R&&(C|=1<<b),P||(P=B)}for(let b=0;b<this._siblingOffset.length;b++)C&1<<b||this._construct(t,2*n+this._siblingOffset[b][0],2*c+this._siblingOffset[b][1],g,P+b)}}function Y0(s,t,n,c,p,h){return Ee(Ee(s,n,h),Ee(t,c,h),p)}function im(s,t,n){const c=n.dim,p=ii(s*c-.5,0,c-1),h=ii(t*c-.5,0,c-1),g=Math.floor(p),M=Math.floor(h),C=Math.min(g+1,c-1),P=Math.min(M+1,c-1);return Y0(n.get(g,M),n.get(C,M),n.get(g,P),n.get(C,P),p-g,h-M)}const g1={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function _1(s,t,n){return(256*s*256+256*t+n)/10-1e4}function y1(s,t,n){return 256*s+t+n/256-32768}class Yg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,n,c,p=!1){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return void Xn(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const h=this.dim=n.height-2,g=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let C=0;C<h;C++)g[this._idx(-1,C)]=g[this._idx(0,C)],g[this._idx(h,C)]=g[this._idx(h-1,C)],g[this._idx(C,-1)]=g[this._idx(C,0)],g[this._idx(C,h)]=g[this._idx(C,h-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(h,-1)]=g[this._idx(h-1,0)],g[this._idx(-1,h)]=g[this._idx(0,h-1)],g[this._idx(h,h)]=g[this._idx(h-1,h-1)]}const M=c==="terrarium"?y1:_1;for(let C=0;C<g.length;++C){const P=4*C;this.floatView[C]=M(this.pixels[P],this.pixels[P+1],this.pixels[P+2])}this._timestamp=qe.now()}_buildQuadTree(){this._tree=new X0(this)}get(t,n,c=!1){c&&(t=ii(t,-1,this.dim),n=ii(n,-1,this.dim));const p=this._idx(t,n);return this.floatView[p]}set(t,n,c){const p=this._idx(t,n),h=this.floatView[p];return this.floatView[p]=c,c-h}static getUnpackVector(t){return g1[t]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}static pack(t,n){const c=[0,0,0,0],p=Yg.getUnpackVector(n);let h=Math.floor((t+p[3])/p[2]);return c[2]=h%256,h=Math.floor(h/256),c[1]=h%256,h=Math.floor(h/256),c[0]=h,c}getPixels(){return new sm({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,n,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let p=n*this.dim,h=n*this.dim+this.dim,g=c*this.dim,M=c*this.dim+this.dim;switch(n){case-1:p=h-1;break;case 1:h=p+1}switch(c){case-1:g=M-1;break;case 1:M=g+1}const C=-n*this.dim,P=-c*this.dim;for(let b=g;b<M;b++)for(let L=p;L<h;L++){const D=4*this._idx(L,b),A=4*this._idx(L+C,b+P);this.pixels[D+0]=t.pixels[A+0],this.pixels[D+1]=t.pixels[A+1],this.pixels[D+2]=t.pixels[A+2],this.pixels[D+3]=t.pixels[A+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function v1(s,t,n){s===1?t.headerLength=n.readFixed32():s===2?t.x=n.readVarint():s===3?t.y=n.readVarint():s===4?t.z=n.readVarint():s===5&&t.layers.push(function(c,p){return c.readFields(T1,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},p)}(n,n.readVarint()+n.pos))}function x1(s,t,n){s===1?(t.delta_filter=function(c,p){return c.readFields(b1,{blockSize:0},p)}(n,n.readVarint()+n.pos),t.filter="delta_filter"):s===2?(n.readVarint(),t.filter="zigzag_filter"):s===3?(n.readVarint(),t.filter="bitshuffle_filter"):s===4&&(n.readVarint(),t.filter="byteshuffle_filter")}function b1(s,t,n){s===1&&(t.blockSize=n.readVarint())}function w1(s,t,n){s===1?(n.readVarint(),t.codec="gzip_data"):s===2?(n.readVarint(),t.codec="jpeg_image"):s===3?(n.readVarint(),t.codec="webp_image"):s===4&&(n.readVarint(),t.codec="png_image")}function M1(s,t,n){let c=0,p=0;s===1?t.firstByte=n.readFixed64():s===2?t.lastByte=n.readFixed64():s===3?t.filters.push(function(h,g){return h.readFields(x1,{},g)}(n,n.readVarint()+n.pos)):s===4?t.codec=function(h,g){return h.readFields(w1,{},g)}(n,n.readVarint()+n.pos):s===5?p=n.readFloat():s===6?c=n.readFloat():s===7?t.bands.push(n.readString()):s===8?t.offset=n.readDouble():s===9&&(t.scale=n.readDouble()),t.offset===0&&(t.offset=p),t.scale===0&&(t.scale=c)}function T1(s,t,n){s===1?t.version=n.readVarint():s===2?t.name=n.readString():s===3?t.units=n.readString():s===4?t.tileSize=n.readVarint():s===5?t.buffer=n.readVarint():s===6?t.pixelFormat=n.readVarint():s===7&&t.dataIndex.push(function(c,p){return c.readFields(M1,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},p)}(n,n.readVarint()+n.pos))}function S1(s,t,n){if(s===2)(function(c,p,h){c.readFields(E1,h,p)})(n,n.readVarint()+n.pos,t);else if(s===3)throw new Error("Not implemented")}function E1(s,t,n){if(s===1){let c=0;const p=n.readVarint()+n.pos;for(;n.pos<p;)t[c++]=n.readVarint()}}function A1(s,t){if(t.length!==4)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let n=t[3];for(let c=2;c>=1;c--){const p=c===1?1:0,h=c===2?1:0;for(let g=0;g<t[0];g++){const M=t[1]*g;for(let C=p;C<t[1];C++){const P=t[2]*(C+M);for(let b=h;b<t[2];b++){const L=t[3]*(b+P);for(let D=0;D<t[3];D++){const A=L+D;s[A]+=s[A-n]}}}}n*=t[c]}return s}function C1(s){for(let t=0,n=s.length;t<n;t++)s[t]=s[t]>>>1^-(1&s[t]);return s}function L1(s,t){switch(t){case"uint32":return s;case"uint16":for(let n=0;n<s.length;n+=2){const c=s[n],p=s[n+1];s[n]=(240&c)>>4|(61440&c)>>8|(240&p)<<4|61440&p,s[n+1]=15&c|(3840&c)>>4|(15&p)<<8|(3840&p)<<4}return s;case"uint8":for(let n=0;n<s.length;n+=4){const c=s[n],p=s[n+1],h=s[n+2],g=s[n+3];s[n+0]=(192&c)>>6|(192&p)>>4|(192&h)>>2|192&g,s[n+1]=(48&c)>>4|(48&p)>>2|48&h|(48&g)<<2,s[n+2]=(12&c)>>2|12&p|(12&h)<<2|(12&g)<<4,s[n+3]=3&c|(3&p)<<2|(3&h)<<4|(3&g)<<6}return s;default:throw new Error(`Invalid pixel format, "${t}"`)}}kn(Yg,"DEMData"),kn(X0,"DemMinMaxQuadTree",{omit:["dem"]});var Ad=Uint8Array,cg=Uint16Array,R1=Int32Array,$0=new Ad([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),K0=new Ad([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),I1=new Ad([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),J0=function(s,t){for(var n=new cg(31),c=0;c<31;++c)n[c]=t+=1<<s[c-1];var p=new R1(n[30]);for(c=1;c<30;++c)for(var h=n[c];h<n[c+1];++h)p[h]=h-n[c]<<5|c;return{b:n,r:p}},Q0=J0($0,2),ev=Q0.b,D1=Q0.r;ev[28]=258,D1[258]=28;for(var z1=J0(K0,0).b,tv=new cg(32768),Ho=0;Ho<32768;++Ho){var Um=(43690&Ho)>>1|(21845&Ho)<<1;tv[Ho]=((65280&(Um=(61680&(Um=(52428&Um)>>2|(13107&Um)<<2))>>4|(3855&Um)<<4))>>8|(255&Um)<<8)>>1}var ug=function(s,t,n){for(var c=s.length,p=0,h=new cg(t);p<c;++p)s[p]&&++h[s[p]-1];var g,M=new cg(t);for(p=1;p<t;++p)M[p]=M[p-1]+h[p-1]<<1;g=new cg(1<<t);var C=15-t;for(p=0;p<c;++p)if(s[p])for(var P=p<<4|s[p],b=t-s[p],L=M[s[p]-1]++<<b,D=L|(1<<b)-1;L<=D;++L)g[tv[L]>>C]=P;return g},hg=new Ad(288);for(Ho=0;Ho<144;++Ho)hg[Ho]=8;for(Ho=144;Ho<256;++Ho)hg[Ho]=9;for(Ho=256;Ho<280;++Ho)hg[Ho]=7;for(Ho=280;Ho<288;++Ho)hg[Ho]=8;var iv=new Ad(32);for(Ho=0;Ho<32;++Ho)iv[Ho]=5;var P1=ug(hg,9),O1=ug(iv,5),I_=function(s){for(var t=s[0],n=1;n<s.length;++n)s[n]>t&&(t=s[n]);return t},Uf=function(s,t,n){var c=t/8|0;return(s[c]|s[c+1]<<8)>>(7&t)&n},D_=function(s,t){var n=t/8|0;return(s[n]|s[n+1]<<8|s[n+2]<<16)>>(7&t)},B1=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Vf=function(s,t,n){var c=new Error(t||B1[s]);if(c.code=s,Error.captureStackTrace&&Error.captureStackTrace(c,Vf),!n)throw c;return c},F1=new Ad(0),k1=typeof TextDecoder<"u"&&new TextDecoder;try{k1.decode(F1,{stream:!0})}catch{}const N1={gzip_data:"gzip"};class cf extends Error{constructor(t){super(t),this.name="MRTError"}}const U1={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},nv={uint32:1,uint16:2,uint8:4},V1={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let z_;class P_{constructor(t=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){const n=this.layers[t];if(!n)throw new cf(`Layer '${t}' not found`);return n}getHeaderLength(t){const n=new Uint8Array(t),c=new DataView(t);if(n[0]!==13)throw new cf("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(t){const n=new Uint8Array(t),c=this.getHeaderLength(t);if(n.length<c)throw new cf(`Expected header with length >= ${c} but got buffer of length ${n.length}`);const p=function(h,g){return h.readFields(v1,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new z_(n.subarray(0,c)));if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new cf(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(const h of p.layers)this.layers[h.name]=new G1(h,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const n=[],c=this.getLayer(t.layerName);for(let p of t.blockIndices){const h=c.dataIndex[p],g=h.firstByte-t.firstByte,M=h.lastByte-t.firstByte;if(c._blocksInProgress.has(p))continue;const C={layerName:c.name,firstByte:g,lastByte:M,pixelFormat:c.pixelFormat,blockIndex:p,blockShape:[h.bands.length].concat(c.bandShape),buffer:c.buffer,codec:h.codec.codec,filters:h.filters.map(P=>P.filter)};c._blocksInProgress.add(p),n.push(C)}return new rv(n,()=>{n.forEach(p=>c._blocksInProgress.delete(p.blockIndex))},(p,h)=>{if(n.forEach(g=>c._blocksInProgress.delete(g.blockIndex)),p)throw p;h.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class G1{constructor({version:t,name:n,units:c,tileSize:p,pixelFormat:h,buffer:g,dataIndex:M},C){if(this.version=t,this.version!==1)throw new cf(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=n,this.units=c,this.tileSize=p,this.buffer=g,this.pixelFormat=U1[h],this.dataIndex=M,this.bandShape=[p+2*g,p+2*g,nv[this.pixelFormat]],this._decodedBlocks=new L_(C?C.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return nv[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:t})=>t).flat()}processDecodedData(t){const n=t.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.put(n,t.data)}getBlockForBand(t){let n=0;switch(typeof t){case"string":for(const[c,p]of this.dataIndex.entries()){for(const[h,g]of p.bands.entries())if(g===t)return{bandIndex:n+h,blockIndex:c,blockBandIndex:h};n+=p.bands.length}break;case"number":for(const[c,p]of this.dataIndex.entries()){if(t>=n&&t<n+p.bands.length)return{bandIndex:t,blockIndex:c,blockBandIndex:t-n};n+=p.bands.length}break;default:throw new cf(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}throw new cf(`Band not found: ${JSON.stringify(t)}`)}getDataRange(t){let n=1/0,c=-1/0;const p=[],h=new Set;for(const g of t){const{blockIndex:M}=this.getBlockForBand(g);if(M<0)throw new cf(`Invalid band: ${JSON.stringify(g)}`);const C=this.dataIndex[M];p.includes(M)||p.push(M),h.add(M),n=Math.min(n,C.firstByte),c=Math.max(c,C.lastByte)}if(h.size>this.cacheSize)throw new cf(`Number of blocks to decode (${h.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:n,lastByte:c,blockIndices:p}}hasBand(t){const{blockIndex:n}=this.getBlockForBand(t);return n>=0}hasDataForBand(t){const{blockIndex:n}=this.getBlockForBand(t);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(t){const{blockIndex:n,blockBandIndex:c}=this.getBlockForBand(t),p=this._decodedBlocks.get(n.toString());if(!p)throw new cf(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const h=this.dataIndex[n],g=this.bandShape.reduce((P,b)=>P*b,1),M=c*g,C=p.subarray(M,M+g);return{data:C,bytes:new Uint8Array(C.buffer).subarray(C.byteOffset,C.byteOffset+C.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:h.offset,scale:h.scale}}}P_.setPbf=function(s){z_=s};class rv{constructor(t,n,c){this.tasks=t,this._onCancel=n,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,n){this._finalized||(this._onComplete(t,n),this._finalized=!0)}}P_.performDecoding=function(s,t){const n=new Uint8Array(s);return Promise.all(t.tasks.map(c=>{const{layerName:p,firstByte:h,lastByte:g,pixelFormat:M,blockShape:C,blockIndex:P,filters:b,codec:L}=c,D=n.subarray(h,g+1),A=new Uint32Array(C[0]*C[1]*C[2]);let R;if(L!=="gzip_data")throw new cf(`Unhandled codec: ${L}`);return R=function(B,q){if(!globalThis.DecompressionStream&&q==="gzip_data")return Promise.resolve(((Y=function(ve){ve[0]==31&&ve[1]==139&&ve[2]==8||Vf(6,"invalid gzip data");var Be=ve[3],Oe=10;4&Be&&(Oe+=2+(ve[10]|ve[11]<<8));for(var Pe=(Be>>3&1)+(Be>>4&1);Pe>0;Pe-=!ve[Oe++]);return Oe+(2&Be)}(te=B))+8>te.length&&Vf(6,"invalid gzip data"),function(ve,Be,Oe,Pe){var nt=ve.length;if(!nt||Be.f&&!Be.l)return Oe||new Ad(0);var Ue=!Oe,lt=Ue||Be.i!=2,_t=Be.i;Ue&&(Oe=new Ad(3*nt));var dt,xt,Ct=function(nm){var vm=Oe.length;if(nm>vm){var mg=new Ad(Math.max(2*vm,nm));mg.set(Oe),Oe=mg}},Nt=Be.f||0,wt=Be.p||0,gi=Be.b||0,Ui=Be.l,mi=Be.d,Dn=Be.m,Mn=Be.n,tn=8*nt;do{if(!Ui){Nt=Uf(ve,wt,1);var qi=Uf(ve,wt+1,3);if(wt+=3,!qi){var nr=ve[(Vr=4+((wt+7)/8|0))-4]|ve[Vr-3]<<8,Fn=Vr+nr;if(Fn>nt){_t&&Vf(0);break}lt&&Ct(gi+nr),Oe.set(ve.subarray(Vr,Fn),gi),Be.b=gi+=nr,Be.p=wt=8*Fn,Be.f=Nt;continue}if(qi==1)Ui=P1,mi=O1,Dn=9,Mn=5;else if(qi==2){var Hn=Uf(ve,wt,31)+257,zr=Uf(ve,wt+10,15)+4,Yr=Hn+Uf(ve,wt+5,31)+1;wt+=14;for(var ta=new Ad(Yr),ia=new Ad(19),ma=0;ma<zr;++ma)ia[I1[ma]]=Uf(ve,wt+3*ma,7);wt+=3*zr;var va=I_(ia),vs=(1<<va)-1,rs=ug(ia,va);for(ma=0;ma<Yr;){var Vr,Ya=rs[Uf(ve,wt,vs)];if(wt+=15&Ya,(Vr=Ya>>4)<16)ta[ma++]=Vr;else{var Ja=0,zs=0;for(Vr==16?(zs=3+Uf(ve,wt,3),wt+=2,Ja=ta[ma-1]):Vr==17?(zs=3+Uf(ve,wt,7),wt+=3):Vr==18&&(zs=11+Uf(ve,wt,127),wt+=7);zs--;)ta[ma++]=Ja}}var yo=ta.subarray(0,Hn),jo=ta.subarray(Hn);Dn=I_(yo),Mn=I_(jo),Ui=ug(yo,Dn),mi=ug(jo,Mn)}else Vf(1);if(wt>tn){_t&&Vf(0);break}}lt&&Ct(gi+131072);for(var vo=(1<<Dn)-1,so=(1<<Mn)-1,Co=wt;;Co=wt){var rl=(Ja=Ui[D_(ve,wt)&vo])>>4;if((wt+=15&Ja)>tn){_t&&Vf(0);break}if(Ja||Vf(2),rl<256)Oe[gi++]=rl;else{if(rl==256){Co=wt,Ui=null;break}var mc=rl-254;rl>264&&(mc=Uf(ve,wt,(1<<(Hf=$0[ma=rl-257]))-1)+ev[ma],wt+=Hf);var Cs=mi[D_(ve,wt)&so],rh=Cs>>4;if(Cs||Vf(3),wt+=15&Cs,jo=z1[rh],rh>3){var Hf=K0[rh];jo+=D_(ve,wt)&(1<<Hf)-1,wt+=Hf}if(wt>tn){_t&&Vf(0);break}lt&&Ct(gi+131072);var uf=gi+mc;if(gi<jo){var hf=0-jo,ym=Math.min(jo,uf);for(hf+gi<0&&Vf(3);gi<ym;++gi)Oe[gi]=(void 0)[hf+gi]}for(;gi<uf;++gi)Oe[gi]=Oe[gi-jo]}}Be.l=Ui,Be.p=Co,Be.b=gi,Be.f=Nt,Ui&&(Nt=1,Be.m=Dn,Be.d=mi,Be.n=Mn)}while(!Nt);return gi!=Oe.length&&Ue?(dt=Oe,((xt=gi)==null||xt>dt.length)&&(xt=dt.length),new Ad(dt.subarray(0,xt))):Oe.subarray(0,gi)}(te.subarray(Y,-8),{i:2},new Ad(((W=te)[(ee=W.length)-4]|W[ee-3]<<8|W[ee-2]<<16|W[ee-1]<<24)>>>0))));var W,ee,te,Y;const re=N1[q];if(!re)throw new Error(`Unhandled codec: ${q}`);const ce=new globalThis.DecompressionStream(re);return new Response(new Blob([B]).stream().pipeThrough(ce)).arrayBuffer().then(ve=>new Uint8Array(ve))}(D,L).then(B=>(function(q,W){q.readFields(S1,W)}(new z_(B),A),new V1[M](A.buffer))),R.then(B=>{for(let q=b.length-1;q>=0;q--)switch(b[q]){case"delta_filter":A1(B,C);break;case"zigzag_filter":C1(B);break;case"bitshuffle_filter":L1(B,M);break;default:throw new cf(`Unhandled filter "${b[q]}"`)}return{layerName:p,blockIndex:P,data:B}}).catch(B=>{throw B})}))},kn(rv,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let dg,O_,Gf,Vm,B_,Gm=null;function av(){return Ca()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:O_||es.DRACO_URL}function sv(){if(Ca()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Vm)return Vm;const s=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Vm=WebAssembly.validate(s)?es.MESHOPT_SIMD_URL:es.MESHOPT_URL,Vm}const $g={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},H1={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},fg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function ov(s,t,n){const c=n.json.bufferViews.length,p=n.buffers.length;t.bufferView=c,n.json.bufferViews[c]={buffer:p,byteLength:s.byteLength},n.buffers[p]=s}const F_="KHR_draco_mesh_compression";function j1(s,t){const n=s.extensions&&s.extensions[F_];if(!n)return;const c=new Gf.Decoder,p=hv(t,n.bufferView),h=new Gf.Mesh;if(!c.DecodeArrayToMesh(p,p.byteLength,h))throw new Error("Failed to decode Draco mesh");const g=t.json.accessors[s.indices],M=$g[g.componentType],C=g.count*M.BYTES_PER_ELEMENT,P=Gf._malloc(C);M===Uint16Array?c.GetTrianglesUInt16Array(h,C,P):c.GetTrianglesUInt32Array(h,C,P),ov(Gf.memory.buffer.slice(P,P+C),g,t),Gf._free(P);for(const b of Object.keys(n.attributes)){const L=c.GetAttributeByUniqueId(h,n.attributes[b]),D=t.json.accessors[s.attributes[b]],A=H1[D.componentType],R=D.count*fg[D.type]*$g[D.componentType].BYTES_PER_ELEMENT,B=Gf._malloc(R);c.GetAttributeDataArrayForAllPoints(h,L,Gf[A],R,B),ov(Gf.memory.buffer.slice(B,B+R),D,t),Gf._free(B)}c.destroy(),h.destroy(),delete s.extensions[F_]}const Kg="EXT_meshopt_compression";function q1(s,t){if(!s.extensions||!s.extensions[Kg])return;const n=s.extensions[Kg],c=new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),p=new Uint8Array(n.count*n.byteStride);B_.decodeGltfBuffer(p,n.count,n.byteStride,c,n.mode,n.filter),s.buffer=t.buffers.length,s.byteOffset=0,t.buffers[s.buffer]=p.buffer,delete s.extensions[Kg]}const lv=1179937895,cv=new TextDecoder("utf8");function uv(s,t){return new URL(s,t).href}function W1(s,t,n,c){return fetch(uv(s.uri,c)).then(p=>p.arrayBuffer()).then(p=>{t.buffers[n]=p})}function hv(s,t){const n=s.json.bufferViews[t];return new Uint8Array(s.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function Z1(s,t,n,c){if(s.uri){const p=uv(s.uri,c);return fetch(p).then(h=>h.blob()).then(h=>createImageBitmap(h)).then(h=>{t.images[n]=h})}if(s.bufferView!==void 0){const p=hv(t,s.bufferView),h=new Blob([p],{type:s.mimeType});return createImageBitmap(h).then(g=>{t.images[n]=g})}}function dv(s,t=0,n){const c={json:null,images:[],buffers:[]};if(new Uint32Array(s,t,1)[0]===lv){const b=new Uint32Array(s,t);let L=2;const D=(b[L++]>>2)-3,A=b[L++]>>2;if(L++,c.json=JSON.parse(cv.decode(b.subarray(L,L+A))),L+=A,L<D){const R=b[L++];L++;const B=t+(L<<2);c.buffers[0]=s.slice(B,B+R)}}else c.json=JSON.parse(cv.decode(new Uint8Array(s,t)));const{buffers:p,images:h,meshes:g,extensionsUsed:M,bufferViews:C}=c.json;let P=Promise.resolve();if(p){const b=[];for(let L=0;L<p.length;L++){const D=p[L];D.uri?b.push(W1(D,c,L,n)):c.buffers[L]||(c.buffers[L]=null)}P=Promise.all(b)}return P.then(()=>{const b=[],L=M&&M.includes(F_),D=M&&M.includes(Kg);if(L&&b.push(function(){if(!Gf)return dg??(dg=function(A){let R,B=null;function q(){R=new Uint8Array(B.buffer)}function W(){throw new Error("Unexpected Draco error.")}const ee={a:{a:W,d:function(te,Y,re){return R.copyWithin(te,Y,Y+re)},c:function(te){const Y=R.length,re=Math.max(te>>>0,Math.ceil(1.2*Y)),ce=Math.ceil((re-Y)/65536);try{return B.grow(ce),q(),!0}catch{return!1}},b:W}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(A,ee):A.then(te=>te.arrayBuffer()).then(te=>WebAssembly.instantiate(te,ee))).then(te=>{const{Rb:Y,Qb:re,P:ce,T:ve,X:Be,Ja:Oe,La:Pe,Qa:nt,Va:Ue,Wa:lt,eb:_t,jb:dt,f:xt,e:Ct,yb:Nt,zb:wt,Ab:gi,Bb:Ui,Db:mi,Gb:Dn}=te.instance.exports;B=Ct;const Mn=(()=>{let tn=0,qi=0,nr=0,Fn=0;return Hn=>{nr&&(Y(Fn),Y(tn),qi+=nr,nr=tn=0),tn||(qi+=128,tn=re(qi));const zr=Hn.length+7&-8;let Yr=tn;zr>=qi&&(nr=zr,Yr=Fn=re(zr));for(let ta=0;ta<Hn.length;ta++)R[Yr+ta]=Hn[ta];return Yr}})();return q(),xt(),{memory:Ct,_free:Y,_malloc:re,Mesh:class{constructor(){this.ptr=ce()}destroy(){ve(this.ptr)}},Decoder:class{constructor(){this.ptr=Oe()}destroy(){dt(this.ptr)}DecodeArrayToMesh(tn,qi,nr){const Fn=Mn(tn),Hn=Pe(this.ptr,Fn,qi,nr.ptr);return!!Be(Hn)}GetAttributeByUniqueId(tn,qi){return{ptr:nt(this.ptr,tn.ptr,qi)}}GetTrianglesUInt16Array(tn,qi,nr){Ue(this.ptr,tn.ptr,qi,nr)}GetTrianglesUInt32Array(tn,qi,nr){lt(this.ptr,tn.ptr,qi,nr)}GetAttributeDataArrayForAllPoints(tn,qi,nr,Fn,Hn){_t(this.ptr,tn.ptr,qi.ptr,nr,Fn,Hn)}},DT_INT8:Nt(),DT_UINT8:wt(),DT_INT16:gi(),DT_UINT16:Ui(),DT_UINT32:mi(),DT_FLOAT32:Dn()}})}(fetch(av())),dg.then(A=>{Gf=A,dg=void 0}))}()),D&&b.push(function(){if(B_)return;const A=function(R){let B;const q=WebAssembly.instantiateStreaming(R,{}).then(te=>{B=te.instance,B.exports.__wasm_call_ctors()}),W={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ee={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:q,supported:!0,decodeGltfBuffer(te,Y,re,ce,ve,Be){(function(Oe,Pe,nt,Ue,lt,_t,dt){const xt=Oe.exports.sbrk,Ct=Ue+3&-4,Nt=xt(Ct*lt),wt=xt(_t.length),gi=new Uint8Array(Oe.exports.memory.buffer);gi.set(_t,wt);const Ui=Pe(Nt,Ue,lt,wt,_t.length);if(Ui===0&&dt&&dt(Nt,Ct,lt),nt.set(gi.subarray(Nt,Nt+Ue*lt)),xt(Nt-xt(0)),Ui!==0)throw new Error(`Malformed buffer data: ${Ui}`)})(B,B.exports[ee[ve]],te,Y,re,ce,B.exports[W[Be]])}}}(fetch(sv()));return A.ready.then(()=>{B_=A})}()),h)for(let A=0;A<h.length;A++)b.push(Z1(h[A],c,A,n));return(b.length?Promise.all(b):Promise.resolve()).then(()=>{if(L&&g)for(const{primitives:A}of g)for(const R of A)j1(R,c);if(D&&g&&C)for(const A of C)q1(A,c);return c})})}function _m(s,t){const n=s.json.bufferViews[t.bufferView],c=$g[t.componentType];return new c(s.buffers[n.buffer],(t.byteOffset||0)+(n.byteOffset||0),t.count*(n.byteStride&&n.byteStride!==fg[t.type]*c.BYTES_PER_ELEMENT?n.byteStride/c.BYTES_PER_ELEMENT:fg[t.type]))}function k_(s,t,n,c){const p=$g[t.componentType],h=function(b){switch(b){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),g=s.json.bufferViews[t.bufferView],M=g.byteStride?g.byteStride/p.BYTES_PER_ELEMENT:fg[t.type],C=n.float32,P=C.length/n.capacity;for(let b=0,L=0;b<t.count*M;b+=M,L+=P)for(let D=0;D<P;D++)C[L+D]=c[b+D]*h;n._trim()}function X1(s,t,n){const c=s.indices,p=s.attributes,h={};h.indexArray=new uo;const g=t.json.accessors[c],M=g.count/3;h.indexArray.reserve(M);const C=_m(t,g);for(let D=0;D<M;D++)h.indexArray.emplaceBack(C[3*D],C[3*D+1],C[3*D+2]);h.indexArray._trim(),h.vertexArray=new jc;const P=t.json.accessors[p.POSITION];h.vertexArray.reserve(P.count);const b=_m(t,P);for(let D=0;D<P.count;D++)h.vertexArray.emplaceBack(b[3*D],b[3*D+1],b[3*D+2]);if(h.vertexArray._trim(),h.aabb=new In(P.min,P.max),h.centroid=function(D,A){const R=[0,0,0],B=D.length;if(B>0){for(let q=0;q<B;q++){const W=3*D[q];R[0]+=A[W],R[1]+=A[W+1],R[2]+=A[W+2]}R[0]/=B,R[1]/=B,R[2]/=B}return R}(C,b),p.COLOR_0!==void 0){const D=t.json.accessors[p.COLOR_0],A=fg[D.type],R=_m(t,D);h.colorArray=A===3?new jc:new qc,h.colorArray.resize(D.count),k_(t,D,h.colorArray,R)}if(p.NORMAL!==void 0){h.normalArray=new jc;const D=t.json.accessors[p.NORMAL];h.normalArray.resize(D.count);const A=_m(t,D);k_(t,D,h.normalArray,A)}if(p.TEXCOORD_0!==void 0&&n.length>0){h.texcoordArray=new zh;const D=t.json.accessors[p.TEXCOORD_0];h.texcoordArray.resize(D.count);const A=_m(t,D);k_(t,D,h.texcoordArray,A)}if(p._FEATURE_ID_RGBA4444!==void 0){const D=t.json.accessors[p._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(h.featureData=_m(t,D))}p._FEATURE_RGBA4444!==void 0&&(h.featureData=new Uint32Array(_m(t,t.json.accessors[p._FEATURE_RGBA4444]).buffer));const L=s.material;return h.material=function(D,A){const{emissiveFactor:R=[0,0,0],alphaMode:B="OPAQUE",alphaCutoff:q=.5,normalTexture:W,occlusionTexture:ee,emissiveTexture:te,doubleSided:Y}=D,{baseColorFactor:re=[1,1,1,1],metallicFactor:ce=1,roughnessFactor:ve=1,baseColorTexture:Be,metallicRoughnessTexture:Oe}=D.pbrMetallicRoughness||{},Pe=ee?A[ee.index]:void 0;if(ee&&ee.extensions&&ee.extensions.KHR_texture_transform&&Pe){const nt=ee.extensions.KHR_texture_transform;Pe.offsetScale=[nt.offset[0],nt.offset[1],nt.scale[0],nt.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new we(...re),metallicFactor:ce,roughnessFactor:ve,baseColorTexture:Be?A[Be.index]:void 0,metallicRoughnessTexture:Oe?A[Oe.index]:void 0},doubleSided:Y,emissiveFactor:R,alphaMode:B,alphaCutoff:q,normalTexture:W?A[W.index]:void 0,occlusionTexture:Pe,emissionTexture:te?A[te.index]:void 0,defined:D.defined===void 0}}(L!==void 0?t.json.materials[L]:{defined:!1},n),h}function fv(s,t,n){const{matrix:c,rotation:p,translation:h,scale:g,mesh:M,extras:C,children:P}=s,b={};if(b.matrix=c||et.mat4.fromRotationTranslationScale([],p||[0,0,0,1],h||[0,0,0],g||[1,1,1]),M!==void 0){b.meshes=n[M];const L=b.anchor=[0,0];for(const D of b.meshes){const{min:A,max:R}=D.aabb;L[0]+=A[0]+R[0],L[1]+=A[1]+R[1]}L[0]=Math.floor(L[0]/b.meshes.length/2),L[1]=Math.floor(L[1]/b.meshes.length/2)}if(C&&(C.id&&(b.id=C.id),C.lights&&(b.lights=function(L){if(!L.length)return[];const D=function(W){const ee=atob(W),te=new Uint8Array(ee.length);for(let Y=0;Y<ee.length;Y++)te[Y]=ee.codePointAt(Y);return te}(L),A=[],R=D.length/24,B=new Uint16Array(D.buffer),q=new Float32Array(D.buffer);for(let W=0;W<R;W++){const ee=B[2*W*6]/30,te=B[2*W*6+1]/30,Y=B[2*W*6+10]/100,re=q[6*W+1],ce=q[6*W+2],ve=q[6*W+3],Be=q[6*W+4],Oe=ve-re,Pe=Be-ce,nt=Math.hypot(Oe,Pe);A.push({pos:[re+.5*Oe,ce+.5*Pe,te],normal:[Pe/nt,-Oe/nt,0],width:nt,height:ee,depth:Y,points:[re,ce,ve,Be]})}return A}(C.lights))),P){const L=[];for(const D of P)L.push(fv(t.json.nodes[D],t,n));b.children=L}return b}function Y1(s){if(s.vertices.length===0||s.indices.length===0)return null;const t=new ap(s.vertices,s.indices,8,256),[n,c]=[t.min.clone(),t.max.clone()];return{vertices:s.vertices,indices:s.indices,grid:t,min:n,max:c}}function $1(s){if(!s.extras||!s.extras.ground)return null;const t=s.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;const n=t[0];if(!n||!Array.isArray(n)||n.length===0)return null;const c=[];for(const g of n){if(!Array.isArray(g)||g.length!==2)continue;const M=g[0],C=g[1];typeof M=="number"&&typeof C=="number"&&c.push(new Pi(M,C))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let p=0;for(let g=0;g<c.length;g++){const M=c[g],C=c[(g+1)%c.length],P=c[(g+2)%c.length];p+=(M.x-C.x)*(P.y-C.y)-(P.x-C.x)*(M.y-C.y)}p>0&&c.reverse();const h=Mp(c.flatMap(g=>[g.x,g.y]),[]);return h.length===0?null:{vertices:c,indices:h}}function K1(s,t){const n=[],c=[];let p=0;const h=[];for(const g of s){p=n.length;const M=g.vertexArray.float32,C=g.indexArray.uint16;for(let P=0;P<g.vertexArray.length;P++)h[0]=M[3*P+0],h[1]=M[3*P+1],h[2]=M[3*P+2],et.vec3.transformMat4(h,h,t),n.push(new Pi(h[0],h[1]));for(let P=0;P<3*g.indexArray.length;P++)c.push(C[P]+p)}if(c.length%3!=0)return null;for(let g=0;g<c.length;g+=3){const M=n[c[g+0]],C=n[c[g+1]],P=n[c[g+2]];(M.x-C.x)*(P.y-C.y)-(P.x-C.x)*(M.y-C.y)>0&&([c[g+1],c[g+2]]=[c[g+2],c[g+1]])}return{vertices:n,indices:c}}function pv(s){const t=function(C,P){const b=[],L=WebGL2RenderingContext;if(C.json.textures)for(const D of C.json.textures){const A={magFilter:L.LINEAR,minFilter:L.NEAREST,wrapS:L.REPEAT,wrapT:L.REPEAT};D.sampler!==void 0&&Object.assign(A,C.json.samplers[D.sampler]),b.push({image:P[D.source],sampler:A,uploaded:!1})}return b}(s,s.images),n=function(C,P){const b=[];for(const L of C.json.meshes){const D=[];for(const A of L.primitives)D.push(X1(A,C,P));b.push(D)}return b}(s,t),{scenes:c,scene:p,nodes:h}=s.json,g=c?c[p||0].nodes:h,M=[];for(const C of g)M.push(fv(h[C],s,n));return function(C,P,b){const L={},D=new Set;for(let A=0;A<C.length;A++){const R=b[P[A]];if(!R.extras)continue;const B=R.extras["mapbox:footprint:version"],q=R.extras["mapbox:footprint:id"];(B||q)&&D.add(A),B==="1.0.0"&&q&&(L[q]=A)}for(let A=0;A<C.length;A++){if(D.has(A))continue;const R=C[A],B=b[P[A]];if(!B.extras)continue;let q=null;R.id in L&&(q=K1(C[L[R.id]].meshes,R.matrix)),q||(q=$1(B)),q&&(R.footprint=Y1(q))}if(D.size>0){const A=Array.from(D.values()).sort((R,B)=>R-B);for(let R=A.length-1;R>=0;R--)C.splice(A[R],1)}}(M,g,s.json.nodes),M}function J1(s){s.heightmap=new Float32Array(4096),s.heightmap.fill(-1);const t=s.vertexArray.float32,n=s.aabb.min[0]-1,c=s.aabb.min[1]-1,p=pm/(s.aabb.max[0]-n+2),h=pm/(s.aabb.max[1]-c+2);for(let g=0;g<t.length;g+=3){const M=t[g+2],C=(t[g+0]-n)*p|0,P=(t[g+1]-c)*h|0;M>s.heightmap[P*pm+C]&&(s.heightmap[P*pm+C]=M)}}function Q1(s,t){const n={};n.indexArray=new uo,n.indexArray.reserve(4*s.length),n.vertexArray=new jc,n.vertexArray.reserve(10*s.length),n.colorArray=new qc,n.vertexArray.reserve(10*s.length);let c=0;for(const g of s){const M=Math.min(10,Math.max(4,1.3*g.height))*t,C=[-g.normal[1],g.normal[0],0],P=Math.min(.29,.1*g.width/g.depth),b=g.width-2*g.depth*t*(P+.01),L=et.vec3.scaleAndAdd([],g.pos,C,b/2),D=et.vec3.scaleAndAdd([],g.pos,C,-b/2),A=[L[0],L[1],L[2]+g.height],R=[D[0],D[1],D[2]+g.height],B=et.vec3.scaleAndAdd([],g.normal,C,P);et.vec3.scale(B,B,M);const q=et.vec3.scaleAndAdd([],g.normal,C,-P);et.vec3.scale(q,q,M),et.vec3.add(B,L,B),et.vec3.add(q,D,q),L[2]+=.1,D[2]+=.1,n.vertexArray.emplaceBack(B[0],B[1],B[2]),n.vertexArray.emplaceBack(q[0],q[1],q[2]),n.vertexArray.emplaceBack(L[0],L[1],L[2]),n.vertexArray.emplaceBack(D[0],D[1],D[2]),n.vertexArray.emplaceBack(A[0],A[1],A[2]),n.vertexArray.emplaceBack(R[0],R[1],R[2]),n.vertexArray.emplaceBack(L[0],L[1],L[2]),n.vertexArray.emplaceBack(D[0],D[1],D[2]),n.vertexArray.emplaceBack(B[0],B[1],B[2]),n.vertexArray.emplaceBack(q[0],q[1],q[2]);const W=b/M/2;n.colorArray.emplaceBack(-W-P,-1,W,.8),n.colorArray.emplaceBack(W+P,-1,W,.8),n.colorArray.emplaceBack(-W,0,W,1.3),n.colorArray.emplaceBack(W,0,W,1.3),n.colorArray.emplaceBack(W+P,-.8,W,.7),n.colorArray.emplaceBack(W+P,-.8,W,.7),n.colorArray.emplaceBack(0,0,W,1.3),n.colorArray.emplaceBack(0,0,W,1.3),n.colorArray.emplaceBack(W+P,-1.2,W,.8),n.colorArray.emplaceBack(W+P,-1.2,W,.8),n.indexArray.emplaceBack(6+c,4+c,8+c),n.indexArray.emplaceBack(7+c,9+c,5+c),n.indexArray.emplaceBack(0+c,1+c,2+c),n.indexArray.emplaceBack(1+c,3+c,2+c),c+=10}const p={defined:!0,emissiveFactor:[0,0,0]},h={};return h.baseColorFactor=we.white,p.pbrMetallicRoughness=h,n.material=p,n.aabb=new In([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}class mv{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const c=t[n];this._stringToNumber[c]=n,this._numberToString[n]=c}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const eb=["id","tile","layer","source","sourceLayer","state"];class Hm{constructor(t,n,c,p,h){this.type="Feature",this._vectorTileFeature=t,this._z=n,this._x=c,this._y=p,this.properties=t.properties,this.id=h}clone(){const t=new Hm(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(t.state=Object.assign({},this.state)),this.layer&&(t.layer=Object.assign({},this.layer)),this.source&&(t.source=this.source),this.sourceLayer&&(t.sourceLayer=this.sourceLayer),t}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const n of eb)this[n]!==void 0&&(t[n]=this[n]);return t}}class gv{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Gc(vn,16,0),this.featureIndexArray=new Zu,this.promoteId=n,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(t,n,c,p,h,g=0,M=0){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,p,h,g);const P=this.grid;for(let b=0;b<n.length;b++){const L=n[b],D=[1/0,1/0,-1/0,-1/0];for(let A=0;A<L.length;A++){const R=L[A];D[0]=Math.min(D[0],R.x),D[1]=Math.min(D[1],R.y),D[2]=Math.max(D[2],R.x),D[3]=Math.max(D[3],R.y)}M!==0&&(D[0]-=M,D[1]-=M,D[2]+=M,D[3]+=M),D[0]<vn&&D[1]<vn&&D[2]>=0&&D[3]>=0&&P.insert(C,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ye.VectorTile(new m(this.rawTileData)).layers,this.sourceLayerCoder=new mv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,n){const{tilespaceGeometry:c,transform:p,tileTransform:h,pixelPosMatrix:g,availableImages:M}=n;this.loadVTLayers(),this.serializedLayersCache.clear();const C=c.bufferedTilespaceBounds,P=this.grid.query(C.min.x,C.min.y,C.max.x,C.max.y,(A,R,B,q)=>at(c.bufferedTilespaceGeometry,A,R,B,q));P.sort(ib);let b=null;p.elevation&&P.length>0&&(b=Bm.create(p.elevation,this.tileID));const L={};let D;for(let A=0;A<P.length;A++){const R=P[A];if(R===D)continue;D=R;const B=this.featureIndexArray.get(R);let q=null;this.is3DTile?this.loadMatchingModelFeature(L,B,t,c,p):this.loadMatchingFeature(L,B,t,M,(W,ee,te,Y=0)=>(q||(q=j(W,this.tileID.canonical,h)),ee.queryIntersectsFeature(c,W,te,q,this.z,p,g,b,Y)))}return L}loadMatchingFeature(t,n,c,p,h){const{featureIndex:g,bucketIndex:M,sourceLayerIndex:C,layoutVertexArrayOffset:P}=n,b=this.bucketLayerIDs[M],L=c.layers,D=Object.keys(L);if(D.length&&!function(W,ee){for(let te=0;te<W.length;te++)if(ee.indexOf(W[te])>=0)return!0;return!1}(D,b))return;const A=c.sourceCache,R=this.sourceLayerCoder.decode(C),B=this.vtLayers[R].feature(g),q=this.getId(B,R);for(let W=0;W<b.length;W++){const ee=b[W];if(!L[ee])continue;const{styleLayer:te,targets:Y}=L[ee];let re={};q!==void 0&&(re=A.getFeatureState(te.sourceLayer,q));const ce=!h||h(B,te,re,P);if(!ce)continue;const ve=new Hm(B,this.z,this.x,this.y,q);ve.tile=this.tileID.canonical,ve.state=re;let Be=this.serializedLayersCache.get(ee);Be||(Be=te.serialize(),Be.id=ee,this.serializedLayersCache.set(ee,Be)),ve.source=Be.source,ve.sourceLayer=Be["source-layer"],ve.layer=cr({},Be),ve.layer.paint=_v(Be.paint,te.paint,B,re,p),ve.layer.layout=_v(Be.layout,te.layout,B,re,p);let Oe=!1;for(const Pe of Y){this.updateFeatureProperties(ve,Pe);const{filter:nt}=Pe;if(nt){if(B.properties=ve.properties,nt.needGeometry){const Ue=Z(B,!0);if(!nt.filter(new Ka(this.tileID.overscaledZ),Ue,this.tileID.canonical))continue}else if(!nt.filter(new Ka(this.tileID.overscaledZ),B))continue}Oe=!0,Pe.targetId&&this.addFeatureVariant(ve,Pe)}Oe&&this.appendToResult(t,ee,g,ve,ce)}}loadMatchingModelFeature(t,n,c,p,h){const g=this.bucketLayerIDs[0][0],M=c.layers;if(!M[g])return;const{styleLayer:C,targets:P}=M[g];if(C.type!=="model")return;const b=p.tile,L=n.featureIndex,D=b.getBucket(C);if(!(D&&D instanceof Gg))return;const A=function(Be,Oe,Pe,nt){const Ue=Be.getNodesInfo()[Oe];if(Ue.hiddenByReplacement||!Ue.node.meshes)return;let lt=Number.MAX_VALUE;const _t=Ue.node,dt=Pe.tile,xt=nt.calculatePosMatrix(dt.tileID.toUnwrapped(),nt.worldSize),Ct=Ue.evaluatedScale;let Nt=0;nt.elevation&&_t.elevation&&(Nt=_t.elevation*nt.elevation.exaggeration()),et.mat4.translate(xt,xt,[(_t.anchor?_t.anchor[0]:0)*(Ct[0]-1),(_t.anchor?_t.anchor[1]:0)*(Ct[1]-1),Nt]),et.mat4.scale(xt,xt,Ct);const wt=Pe.queryGeometry,gi=wt.isPointQuery()?wt.screenBounds:wt.screenGeometry,Ui=function(Dn){const Mn=et.mat4.multiply([],xt,Dn.matrix);et.mat4.multiply(Mn,nt.expandedFarZProjMatrix,Mn);for(let tn=0;tn<Dn.meshes.length;++tn){const qi=Dn.meshes[tn];if(tn===Dn.lightMeshIndex)continue;const nr=m0(gi,nt,Mn,qi.aabb);nr!=null&&(lt=Math.min(nr,lt))}if(Dn.children)for(const tn of Dn.children)Ui(tn)};if(Ui(_t),lt===Number.MAX_VALUE)return;const mi=new xa(0,0);return A0(dt.tileID.canonical,mi,Ue.node.anchor[0],Ue.node.anchor[1]),{intersectionZ:lt,position:mi,feature:Ue.feature}}(D,L,p,h);if(!A)return;const{z:R,x:B,y:q}=b.tileID.canonical,{feature:W,intersectionZ:ee,position:te}=A;let Y={};W.id!==void 0&&(Y=c.sourceCache.getFeatureState(C.sourceLayer,W.id));const re=new Hm({},R,B,q,W.id);re.tile=this.tileID.canonical,re.state=Y,re.properties=W.properties,re.geometry={type:"Point",coordinates:[te.lng,te.lat]};let ce=this.serializedLayersCache.get(g);ce||(ce=C.serialize(),ce.id=g,this.serializedLayersCache.set(g,ce)),re.source=ce.source,re.sourceLayer=ce["source-layer"],re.layer=cr({},ce);let ve=!1;for(const Be of P){this.updateFeatureProperties(re,Be);const{filter:Oe}=Be;if(Oe){if(W.properties=re.properties,Oe.needGeometry){if(!Oe.filter(new Ka(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!Oe.filter(new Ka(this.tileID.overscaledZ),W))continue}ve=!0,Be.targetId&&this.addFeatureVariant(re,Be)}ve&&this.appendToResult(t,g,L,re,ee)}updateFeatureProperties(t,n,c){if(n.properties){const p={};for(const h in n.properties){const g=n.properties[h].evaluate({zoom:this.z},t._vectorTileFeature,t.state,t.tile,c);g!=null&&(p[h]=g)}t.properties=p}}addFeatureVariant(t,n,c){const p={target:n.target,namespace:n.namespace,uniqueFeatureID:n.uniqueFeatureID};n.properties&&(p.properties=t.properties),t.variants=t.variants||{},t.variants[n.targetId]=t.variants[n.targetId]||[],t.variants[n.targetId].push(p)}appendToResult(t,n,c,p,h){let g=t[n];g===void 0&&(g=t[n]=[]),g.push({featureIndex:c,feature:p,intersectionZ:h})}lookupSymbolFeatures(t,n,c,p,h){const g={};this.loadVTLayers();for(const M of t)this.loadMatchingFeature(g,{bucketIndex:n,sourceLayerIndex:c,featureIndex:M,layoutVertexArrayOffset:0},p,h);return g}loadFeature(t){const{featureIndex:n,sourceLayerIndex:c}=t;this.loadVTLayers();const p=this.sourceLayerCoder.decode(c),h=this.vtFeatures[p];if(h[n])return h[n];const g=this.vtLayers[p].feature(n);return h[n]=g,g}hasLayer(t){for(const n of this.bucketLayerIDs)for(const c of n)if(t===c)return!0;return!1}getId(t,n){let c=t.id;if(this.promoteId){const p=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[n];if(p!=null)if(Array.isArray(p)){if(!this.promoteIdExpression){const h=Ws(p);if(h.result!=="success"){const g=h.value.map(M=>`${M.key}: ${M.message}`).join(", ");return void Xn(`Failed to create expression for promoteId: ${g}`)}this.promoteIdExpression=h.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Uh),c=this.promoteIdExpression.evaluate({zoom:0},t)}else c=t.properties[p];typeof c=="boolean"&&(c=Number(c))}return c}}function _v(s,t,n,c,p){return ga(s,(h,g)=>{const M=t instanceof id?t.get(g):null;return M&&M.evaluate?M.evaluate(n,c,p):M})}function ib(s,t){return t-s}kn(gv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const yv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class N_{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,c]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=c>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const h=yv[15&c];if(!h)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(t,2,1),[M]=new Uint32Array(t,4,1);return new N_(M,g,h,t)}constructor(t,n=64,c=Float64Array,p){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=c,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const h=yv.indexOf(this.ArrayType),g=2*t*this.ArrayType.BYTES_PER_ELEMENT,M=t*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-M%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${c}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+M+C,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+g+M+C),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+M+C,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=t,this.coords[this._pos++]=n,c}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return U_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:M}=this,C=[0,h.length-1,0],P=[];for(;C.length;){const b=C.pop()||0,L=C.pop()||0,D=C.pop()||0;if(L-D<=M){for(let q=D;q<=L;q++){const W=g[2*q],ee=g[2*q+1];W>=t&&W<=c&&ee>=n&&ee<=p&&P.push(h[q])}continue}const A=D+L>>1,R=g[2*A],B=g[2*A+1];R>=t&&R<=c&&B>=n&&B<=p&&P.push(h[A]),(b===0?t<=R:n<=B)&&(C.push(D),C.push(A-1),C.push(1-b)),(b===0?c>=R:p>=B)&&(C.push(A+1),C.push(L),C.push(1-b))}return P}within(t,n,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:h,nodeSize:g}=this,M=[0,p.length-1,0],C=[],P=c*c;for(;M.length;){const b=M.pop()||0,L=M.pop()||0,D=M.pop()||0;if(L-D<=g){for(let q=D;q<=L;q++)xv(h[2*q],h[2*q+1],t,n)<=P&&C.push(p[q]);continue}const A=D+L>>1,R=h[2*A],B=h[2*A+1];xv(R,B,t,n)<=P&&C.push(p[A]),(b===0?t-c<=R:n-c<=B)&&(M.push(D),M.push(A-1),M.push(1-b)),(b===0?t+c>=R:n+c>=B)&&(M.push(A+1),M.push(L),M.push(1-b))}return C}}function U_(s,t,n,c,p,h){if(p-c<=n)return;const g=c+p>>1;vv(s,t,g,c,p,h),U_(s,t,n,c,g-1,1-h),U_(s,t,n,g+1,p,1-h)}function vv(s,t,n,c,p,h){for(;p>c;){if(p-c>600){const P=p-c+1,b=n-c+1,L=Math.log(P),D=.5*Math.exp(2*L/3),A=.5*Math.sqrt(L*D*(P-D)/P)*(b-P/2<0?-1:1);vv(s,t,n,Math.max(c,Math.floor(n-b*D/P+A)),Math.min(p,Math.floor(n+(P-b)*D/P+A)),h)}const g=t[2*n+h];let M=c,C=p;for(pg(s,t,c,n),t[2*p+h]>g&&pg(s,t,c,p);M<C;){for(pg(s,t,M,C),M++,C--;t[2*M+h]<g;)M++;for(;t[2*C+h]>g;)C--}t[2*c+h]===g?pg(s,t,c,C):(C++,pg(s,t,C,p)),C<=n&&(c=C+1),n<=C&&(p=C-1)}}function pg(s,t,n,c){V_(s,n,c),V_(t,2*n,2*c),V_(t,2*n+1,2*c+1)}function V_(s,t,n){const c=s[t];s[t]=s[n],s[n]=c}function xv(s,t,n,c){const p=s-n,h=t-c;return p*p+h*h}r.$=hu,r.A=Ts,r.B=2,r.C=$m,r.D=Fm,r.E=wi,r.F=Dy,r.G=class extends Ug{},r.H=co,r.I=R_,r.J=sn,r.K=uu,r.L=ml,r.M=Bd,r.N=Fd,r.O=td,r.P=Pi,r.Q=js,r.R=Wr,r.S=Ud,r.T=g_,r.U=Ws,r.V=Ug,r.W=Dd,r.X=po,r.Y=Zh,r.Z=ps,r._=he,r.a=function(s){return es.API_CDN_URL_REGEX.test(s)},r.a$=Hm,r.a0=bc,r.a1=ep,r.a2=function(s){const t=s.value;let n=[];if(!t)return n;const c=co(t);return c!=="string"?(n=n.concat([new Ug(s.key,t,`string expected, "${c}" found`)]),n):(_0(t,!0)||(n=n.concat([new Ug(s.key,t,`invalid url "${t}"`)])),n)},r.a3=Ht,r.a4=Eh,r.a5=ss,r.a6=Ri,r.a7=class{constructor(s){this.specification=s}possiblyEvaluate(s,t){return Us(s.expression.evaluate(t))}interpolate(s,t,n){return{x:Ee(s.x,t.x,n),y:Ee(s.y,t.y,n),z:Ee(s.z,t.z,n),azimuthal:Ee(s.azimuthal,t.azimuthal,n),polar:Ee(s.polar,t.polar,n)}}},r.a8=Ka,r.a9=ou,r.aA=Pl,r.aB=class{constructor(s){this.entries={},this.scheduler=s}request(s,t,n,c){const p=this.entries[s]=this.entries[s]||{callbacks:[]};if(p.result){const[h,g]=p.result;return this.scheduler?this.scheduler.add(()=>{c(h,g)},t):c(h,g),()=>{}}return p.callbacks.push(c),p.cancel||(p.cancel=n((h,g)=>{p.result=[h,g];for(const M of p.callbacks)this.scheduler?this.scheduler.add(()=>{M(h,g)},t):M(h,g);setTimeout(()=>delete this.entries[s],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(h=>h!==c),p.callbacks.length||(p.cancel(),delete this.entries[s]))}}},r.aC=ql,r.aD=function(s,t,n){const c=JSON.stringify(s.request);return s.data&&(this.deduped.entries[c]={result:[null,s.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},p=>{const h=Da(s.request,(g,M,C,P)=>{g?p(g):M&&p(null,{vectorTile:n?void 0:new ye.VectorTile(new m(M)),rawData:M,cacheControl:C,expires:P})});return()=>{h.cancel(),p()}},t)},r.aE=function(s){zn++,zn>Vt&&(s.getActor().send("enforceCacheSizeLimit",mt),zn=0)},r.aF=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},r.aG=Hi,r.aH=r0,r.aI=u0,r.aJ=n0,r.aK=function(s,t){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){t(null,n)};for(let c=0;c<s.length;c++){const p=document.createElement("source");_s(s[c])||(n.crossOrigin="Anonymous"),p.src=s[c],n.appendChild(p)}return{cancel:()=>{}}},r.aL=Og,r.aM=function(s){return fetch(s).then(t=>t.arrayBuffer()).then(t=>dv(t,0,s))},r.aN=pv,r.aO=class{constructor(s,t,n,c){this.id=s,this.position=t!=null?new xa(t[0],t[1]):new xa(0,0),this.orientation=n??[0,0,0],this.nodes=c,this.uploaded=!1,this.aabb=new In([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(s,t){if(et.mat4.multiply(s.matrix,t,s.matrix),s.meshes)for(const n of s.meshes){const c=In.applyTransformFast(n.aabb,s.matrix);this.aabb.encapsulate(c)}if(s.children)for(const n of s.children)this._applyTransformations(n,s.matrix)}computeBoundsAndApplyParent(){const s=et.mat4.identity([]);for(const t of this.nodes)this._applyTransformations(t,s)}computeModelMatrix(s,t,n,c,p,h,g=!1){w0(this.matrix,this,s.transform,this.position,t,n,c,p,h,g)}upload(s){if(!this.uploaded){for(const t of this.nodes)b_(t,s);for(const t of this.nodes)Vg(t);this.uploaded=!0}}destroy(){for(const s of this.nodes)w_(s)}},r.aP=Nr,r.aQ=Jm,r.aR=ho,r.aS=Is,r.aT=Wl,r.aU=uo,r.aV=Er,r.aW=Ef,r.aX=zg,r.aY=function(){us.isLoading()||us.isLoaded()||ju()!=="deferred"||mo()},r.aZ=Wd,r.a_=Z,r.aa=a,r.ab=et,r.ac=Tn,r.ad=id,r.ae=No,r.af=Ee,r.ag=vn,r.ah=ri,r.ai=ft,r.aj=we,r.ak=class{constructor(s){this.specification=s}possiblyEvaluate(s,t){return function([n,c]){const p=Us([1,n,c]);return{x:p.x,y:p.y,z:p.z}}(s.expression.evaluate(t))}interpolate(s,t,n){return{x:Ee(s.x,t.x,n),y:Ee(s.y,t.y,n),z:Ee(s.z,t.z,n)}}},r.al=function(s,t,n=0,c=!0){const p=new Pi(n,n),h=s.sub(p),g=t.add(p),M=[h,new Pi(g.x,h.y),g,new Pi(h.x,g.y)];return c&&M.push(h.clone()),M},r.am=function(s,t){const n=[];for(let c=0;c<s.length;c++){const p=wn(c-1,-1,s.length-1),h=wn(c+1,-1,s.length-1),g=s[c],M=s[h],C=s[p].sub(g).unit(),P=M.sub(g).unit(),b=P.angleWithSep(C.x,C.y),L=C.add(P).unit().mult(-1*t/Math.sin(b/2));n.push(g.add(L))}return n},r.an=Hy,r.ao=at,r.ap=function(s,t,n=0){return et.vec3.fromValues(((t.x-n)*s.scale-s.x)*vn,(t.y*s.scale-s.y)*vn,Ol(t.z,t.y))},r.aq=wr,r.ar=_n,r.as=function(s){let t=1/0,n=1/0,c=-1/0,p=-1/0;for(const h of s)t=Math.min(t,h.x),n=Math.min(n,h.y),c=Math.max(c,h.x),p=Math.max(p,h.y);return{min:new Pi(t,n),max:new Pi(c,p)}},r.at=cl,r.au=je,r.av=v,r.aw=ii,r.ax=Na,r.ay=function(s,t){const n={};for(let c=0;c<t.length;c++){const p=t[c];p in s&&(n[p]=s[p])}return n},r.az=ko,r.b=function(s){return es.API_FONTS_REGEX.test(s)},r.b$=kg,r.b0=ja,r.b1=Sd,r.b2=ro,r.b3=j,r.b4=du,r.b5=Cc,r.b6=lr,r.b7=bs,r.b8=Mp,r.b9=f_,r.bA=Mr,r.bB=o_,r.bC=Ny,r.bD=pi,r.bE=N_,r.bF=wn,r.bG=gs,r.bH=io,r.bI=function(s,t,n){s[4*t+0]=n[0],s[4*t+1]=n[1],s[4*t+2]=n[2],s[4*t+3]=n[3]},r.bJ=Bh,r.bK=Dl,r.bL=Rc,r.bM=ws,r.bN=Zc,r.bO=xa,r.bP=Xy,r.bQ=yi,r.bR=ba,r.bS=d0,r.bT=zi,r.bU=Ps,r.bV=function(s,t,n,c,p,h,g,M,C){if(C.name==="globe")return Ps(s,t,new zi(n,c,p),!1);const P=Jm({z:n,x:c,y:p},C);return new In([(h+P.x/P.scale)*t,t*(P.y/P.scale),g],[(h+P.x2/P.scale)*t,t*(P.y2/P.scale),M])},r.bW=function(s,t,n){let c=0;for(let p=0;p<2;++p)s[p]>0&&(c+=(s[p]-0)*(s[p]-0)),t[p]<0&&(c+=(0-t[p])*(0-t[p]));return c},r.bX=Va,r.bY=yu,r.bZ=function(s){const t=et.mat4.identity(new Float64Array(16));et.mat4.multiply(t,s.pixelMatrix,s.globeMatrix);const n=[0,Ko,0],c=[0,Jo,0];return et.vec3.transformMat4(n,n,t),et.vec3.transformMat4(c,c,t),[n[0]>0&&n[0]<=s.width&&n[1]>0&&n[1]<=s.height&&!Eo(s,new xa(s.center.lat,90)),c[0]>0&&c[0]<=s.width&&c[1]>0&&c[1]<=s.height&&!Eo(s,new xa(s.center.lat,-90))]},r.b_=function(s,t){const{scale:n}=s.tileTransform,c=n*vn/(s.tileSize*Math.pow(2,t.zoom-s.tileID.overscaledZ+s.tileID.canonical.z));return et.mat2.scale(new Float32Array(4),t.inverseAdjustmentMatrix,[c,c])},r.ba=function(s,t){const n=No(t.zoom);if(n===0)return ns(s);const c=da(s),p=Pa(c),h=cl(c.getWest())*t.worldSize,g=cl(c.getEast())*t.worldSize,M=Pl(c.getNorth())*t.worldSize,C=Pl(c.getSouth())*t.worldSize,P=[h,M,0],b=[g,M,0],L=[h,C,0],D=[g,C,0],A=et.mat4.invert([],t.globeMatrix);return et.vec3.transformMat4(P,P,A),et.vec3.transformMat4(b,b,A),et.vec3.transformMat4(L,L,A),et.vec3.transformMat4(D,D,A),p[0]=Es(p[0],L,n),p[1]=Es(p[1],D,n),p[2]=Es(p[2],b,n),p[3]=Es(p[3],P,n),In.fromPoints(p)},r.bb=Os,r.bc=Sa,r.bd=Es,r.be=Rh,r.bf=ur,r.bg=P_,r.bh=m,r.bi=Da,r.bj=function(s){const t=[];for(const n in s)t.push(s[n]);return t},r.bk=function(s,t){const n=[];for(const c in s)c in t||n.push(c);return n},r.bl=gr,r.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.bn=cn,r.bo=function(s,t){const{x:n,y:c}=s.point,p=tl(n,c,s.worldSize/s._pixelsPerMercatorPixel,0,0);return et.mat4.multiply(p,p,Oa(ns(t)))},r.bp=zp,r.bq=Ke,r.br=Dp,r.bs=function(s,t,n,c,p){const h=5*t+2;s.float32[h+0]=n,s.float32[h+1]=c,s.float32[h+2]=p},r.bt=Dg,r.bu=Iy,r.bv=se,r.bw=hs,r.bx=Bt,r.by=g0,r.bz=Yn,r.c=Js,r.c$=(s,t,n,c,p,h,g,M)=>{const C=s.transform,P=C.pitch<15?Ni(.07,.7,ii((14-C.zoom)/5,0,1)):.07,b=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Qn(s,t,n,c),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:C.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:p,u_width_scale:h,u_floor_width_scale:g,u_image:0,u_tile_units_to_pixels:pn(t,C),u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:M,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(b?null:n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:i(t.tileID.canonical,0)}},r.c0=h0,r.c1=function(s){const t=h0(s,!0);return et.mat2.invert([],[t[0],t[1],t[4],t[5]])},r.c2=Tr,r.c3=function(s){const{x:t,y:n}=s.point,{lng:c,lat:p}=s._center;return tl(t,n,s.worldSize,c,p)},r.c4=ct,r.c5=en,r.c6=xl,r.c7=function(s){const t=Math.round((s+45+360)%360/90)%4;return Rt[t]},r.c8=45,r.c9=bu,r.cA=class extends _l{constructor(s){super(s),this.current=rf}set(s,t,n){if(this.fetchUniformLocation(s,t)){for(let c=0;c<9;c++)if(n[c]!==this.current[c]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},r.cB=Ut,r.cC=function(s,t,n){const c=No(n.zoom),p=s.style.map._antialias,h=s.terrain&&s.terrain.exaggeration()>0;return c===0&&!p&&!h},r.cD=function(s){const t=s.pixelsPerMeter,n=t/io(1,s.center.lat),c=et.mat4.identity(new Float64Array(16));return et.mat4.translate(c,c,[s.point.x,s.point.y,0]),et.mat4.scale(c,c,[n,n,t]),Float32Array.from(c)},r.cE=da,r.cF=function(s){const t=Va-5;s=ii(s,-80.051129,t)/t*90;const n=Math.pow(Math.abs(Math.sin(ft(s))),3);return Math.round(n*(vu.length-1))},r.cG=function(s,t,n,c){const p=t.getNorth(),h=t.getSouth(),g=t.getWest(),M=t.getEast(),C=1<<s.z,P=M-g,b=p-h,L=P/Yc,D=-b/vu[n],A=[0,L,0,D,0,0,p,g,0];if(s.z>0){const R=180/c;et.mat3.multiply(A,A,[R/P+1,0,0,0,R/b+1,0,-.5*R/L,.5*R/D,1])}return A[2]=C,A[5]=s.x,A[8]=s.y,A},r.cH=ns,r.cI=function(s,t,n){const c=et.mat4.identity(new Float64Array(16)),p=(t/(1<<s)-.5)*Math.PI*2;return et.mat4.rotateY(c,n.globeMatrix,p),Float32Array.from(c)},r.cJ=class{isDataAvailableAtPoint(s){const t=this._source();if(this.isUsingMockSource()||!t||s.y<0||s.y>1)return!1;const n=t.getSource().maxzoom,c=1<<n,p=Math.floor(s.x),h=Math.floor((s.x-p)*c),g=Math.floor(s.y*c),M=this.findDEMTileFor(new Hi(n,p,n,h,g));return!(!M||!M.dem)}getAtPointOrZero(s,t=0){return this.getAtPoint(s,t)||0}getAtPoint(s,t,n=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const c=this._source();if(!c||s.y<0||s.y>1)return t;const p=c.getSource().maxzoom,h=1<<p,g=Math.floor(s.x),M=s.x-g,C=new Hi(p,g,p,Math.floor(M*h),Math.floor(s.y*h)),P=this.findDEMTileFor(C);if(!P||!P.dem)return t;const b=P.dem,L=1<<P.tileID.canonical.z,D=(M*L-P.tileID.canonical.x)*b.dim,A=(s.y*L-P.tileID.canonical.y)*b.dim,R=Math.floor(D),B=Math.floor(A);return(n?this.exaggeration():1)*Ee(Ee(b.get(R,B),b.get(R,B+1),A-B),Ee(b.get(R+1,B),b.get(R+1,B+1),A-B),D-R)}getAtTileOffset(s,t,n){const c=1<<s.canonical.z;return this.getAtPointOrZero(new a(s.wrap+(s.canonical.x+t/vn)/c,(s.canonical.y+n/vn)/c))}getAtTileOffsetFunc(s,t,n,c){return p=>{const h=this.getAtTileOffset(s,p.x,p.y),g=c.upVector(s.canonical,p.x,p.y),M=c.upVectorScale(s.canonical,t,n).metersToTile;return et.vec3.scale(g,g,h*M),g}}getForTilePoints(s,t,n,c){if(this.isUsingMockSource())return!1;const p=Bm.create(this,s,c);return!!p&&(t.forEach(h=>{h[2]=this.exaggeration()*p.getElevationAt(h[0],h[1],n)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(s);if(!t||!t.dem)return null;const n=t.dem.tree,c=t.tileID,p=1<<s.canonical.z-c.canonical.z;let h=s.canonical.x/p-c.canonical.x,g=s.canonical.y/p-c.canonical.y,M=0;for(let C=0;C<s.canonical.z-c.canonical.z&&!n.leaves[M];C++){h*=2,g*=2;const P=2*Math.floor(g)+Math.floor(h);M=n.childOffsets[M]+P,h%=1,g%=1}return{min:this.exaggeration()*n.minimums[M],max:this.exaggeration()*n.maximums[M]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,t,n){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const s=this.visibleDemTiles;if(s.length===0)return null;let t=!1,n=Number.MAX_VALUE,c=Number.MIN_VALUE;for(const p of s){const h=this.getMinMaxForTile(p.tileID);h&&(n=Math.min(n,h.min),c=Math.max(c,h.max),t=!0)}return t?{min:n,max:c}:null}},r.cK=sm,r.cL=_r,r.cM=function(s,t){return[Math.pow(s[0],2.2)*t,Math.pow(s[1],2.2)*t,Math.pow(s[2],2.2)*t]},r.cN=ul,r.cO=ht,r.cP=Ls,r.cQ=256,r.cR=function(s,t){const n=[0,0,0],c=Os(ns(t.canonical));return et.vec3.transformMat4(n,n,c),et.vec3.transformMat4(n,n,s),n},r.cS=s=>({u_camera_to_center_distance:new ws(s),u_extrude_scale:new gu(s),u_device_pixel_ratio:new ws(s),u_matrix:new Bh(s),u_inv_rot_matrix:new Bh(s),u_merc_center:new Dl(s),u_tile_id:new Rc(s),u_zoom_transition:new ws(s),u_up_dir:new Rc(s),u_emissive_strength:new ws(s)}),r.cT=s=>({u_matrix:new Bh(s),u_pixels_to_tile_units:new gu(s),u_device_pixel_ratio:new ws(s),u_width_scale:new ws(s),u_floor_width_scale:new ws(s),u_units_to_pixels:new Dl(s),u_dash_image:new Zc(s),u_gradient_image:new Zc(s),u_image_height:new ws(s),u_texsize:new Dl(s),u_tile_units_to_pixels:new ws(s),u_alpha_discard_threshold:new ws(s),u_trim_offset:new Dl(s),u_trim_fade_range:new Dl(s),u_trim_color:new _d(s),u_emissive_strength:new ws(s),u_zbias_factor:new ws(s),u_tile_to_meter:new ws(s)}),r.cU=s=>({u_matrix:new Bh(s),u_texsize:new Dl(s),u_pixels_to_tile_units:new gu(s),u_device_pixel_ratio:new ws(s),u_width_scale:new ws(s),u_floor_width_scale:new ws(s),u_image:new Zc(s),u_units_to_pixels:new Dl(s),u_tile_units_to_pixels:new ws(s),u_alpha_discard_threshold:new ws(s),u_trim_offset:new Dl(s),u_trim_fade_range:new Dl(s),u_trim_color:new _d(s),u_emissive_strength:new ws(s),u_zbias_factor:new ws(s),u_tile_to_meter:new ws(s)}),r.cV=$d,r.cW=Nh,r.cX=n_,r.cY=Jl,r.cZ=(s,t,n,c,p,h)=>{const g=s.transform,M=g.projection.name==="globe";let C;if(h.paint.get("circle-pitch-alignment")==="map")if(M){const b=ul(g.zoom,t.canonical)*g._pixelsPerMercatorPixel;C=Float32Array.from([b,0,0,b])}else C=g.calculatePixelsToTileUnitsMatrix(n);else C=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const P={u_camera_to_center_distance:s.transform.getCameraToCenterDistance(g.projection),u_matrix:s.translatePosMatrix(t.projMatrix,n,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_device_pixel_ratio:qe.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:Mu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:h.paint.get("circle-emissive-strength")};if(M){P.u_inv_rot_matrix=c,P.u_merc_center=p,P.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],P.u_zoom_transition=No(g.zoom);const b=p[0]*vn,L=p[1]*vn;P.u_up_dir=g.projection.upVector(new zi(0,0,0),b,L)}return P},r.c_=ya,r.ca=_d,r.cb=function(s,t,n){const c=Math.sqrt(s*s+t*t+n*n),p=c>0?Math.acos(n/c)*Xe:0;let h=s!==0||t!==0?Math.atan2(-t,-s)*Xe+90:0;return h<0&&(h+=360),[c,h,p]},r.cc=i,r.cd=In,r.ce=Us,r.cf=function(s){return[Math.pow(s[0],1/2.2),Math.pow(s[1],1/2.2),Math.pow(s[2],1/2.2)]},r.cg=function(s,t){return s.readFields(Kx,{icons:[]},t)},r.ch=function(s){return s({pluginStatus:Rl,pluginURL:Hu}),Th.on("pluginStateChange",s),s},r.ci=Hg,r.cj=Dm,r.ck=a_,r.cl=Rs,r.cm=vp,r.cn=ut,r.co=be,r.cp=$a,r.cq=function(s){const t=s.indexOf(cd);return t>=0?s.slice(0,t):s},r.cr=function(s){return s.indexOf(cd)>=0},r.cs=function(s){const t=s.indexOf(cd);return t>=0?s.slice(t+1):""},r.ct=function(s){const t=[],n=s.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),s.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},r.cu=function(s,t,n,c){return s.type==="custom"?new Fx(s,t):new Xx[s.type](s,t,n,c)},r.cv=oo,r.cw=class extends Hm{constructor(s,t){super(s._vectorTileFeature,s._z,s._x,s._y,s.id),s.state&&(this.state=Object.assign({},s.state)),this.target=t.target,this.namespace=t.namespace,t.properties&&(this.properties=t.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=s.source,this.sourceLayer=s.sourceLayer,this.layer=s.layer)}toJSON(){const s=super.toJSON();return s.target=this.target,s.namespace=this.namespace,s}},r.cx=Th,r.cy=Ia,r.cz=uc,r.d=function(s){return es.API_TILEJSON_REGEX.test(s)},r.d$=gv,r.d0=(s,t,n,c,p,h,g,M,C)=>{const P=s.transform,b=P.calculatePixelsToTileUnitsMatrix(t),L=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none",D=P.pitch<15?Ni(.07,.7,ii((14-P.zoom)/5,0,1)):.07;return{u_matrix:Qn(s,t,n,c),u_pixels_to_tile_units:b,u_device_pixel_ratio:h,u_width_scale:g,u_floor_width_scale:M,u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:Xr(n)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:pn(t,s.transform),u_alpha_discard_threshold:0,u_trim_offset:C,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(L?null:n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength"),u_zbias_factor:D,u_tile_to_meter:i(t.tileID.canonical,0)}},r.d1=mr,r.d2=Rf,r.d3=Jc,r.d4=bn,r.d5=Or,r.d6=Vi,r.d7=450,r.d8=7,r.d9=Bx,r.dA=$t,r.dB=d,r.dC=xu,r.dD=function([s,t,n]){const c=Math.hypot(s,t,n),p=Math.atan2(s,n),h=.5*Math.PI-Math.acos(-t/c);return new xa(ct(p),ct(h))},r.dE=y_,r.dF=function(s){const t=s.navigator?s.navigator.userAgent:null;return!!function(n){if(qr==null){const c=n.navigator?n.navigator.userAgent:null;qr=!!n.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return qr}(s)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.dG=function(s,t){mt=s,Vt=t},r.dH=Eo,r.dI=$l,r.dJ=function(s){const t=[0,0,0],n=et.mat4.identity(new Float64Array(16));return et.mat4.multiply(n,s.pixelMatrix,s.globeMatrix),et.vec3.transformMat4(t,t,n),new Pi(t[0],t[1])},r.dK=function(s,t,n=!1){if(Rl===jd||Rl===Hs||Rl===wf)throw new Error("setRTLTextPlugin cannot be called multiple times.");Hu=qe.resolveURL(s),Rl=jd,wc=t,qd(),n||mo()},r.dL=ju,r.dM=function(){Hg().acquire(T_)},r.dN=function(){const s=sg;s&&(s.isPreloaded()&&s.numActive()===1?(s.release(T_),sg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.dO=gm,r.dP=function(s){const t=Qi();if(!t)return;const n=t.delete(It);s&&n.catch(s).then(()=>s())},r.dQ=ag,r.dR=av,r.dS=function(s){O_=qe.resolveURL(s),Gm||(Gm=new Fm(Hg(),new wi)),Gm.broadcast("setDracoUrl",O_)},r.dT=sv,r.dU=function(s){Vm=qe.resolveURL(s),Gm||(Gm=new Fm(Hg(),new wi)),Gm.broadcast("setMeshoptUrl",Vm)},r.dV=kn,r.dW=xd,r.dX=Nf,r.dY=ye,r.dZ=class{constructor(s,t){this.pos=s,this.dir=t}intersectsPlane(s,t,n){const c=et.vec2.dot(t,this.dir);if(Math.abs(c)<1e-6)return!1;const p=((s[0]-this.pos[0])*t[0]+(s[1]-this.pos[1])*t[1])/c;return n[0]=this.pos[0]+this.dir[0]*p,n[1]=this.pos[1]+this.dir[1]*p,!0}},r.d_=mv,r.da=Ta,r.db=Sf,r.dc=256,r.dd=Oa,r.de=jc,r.df=gl,r.dg=to,r.dh=function(s,t,n,c,p){return ii((s-t)/(n-t)*(p-c)+c,c,p)},r.di=vh,r.dj=Dc,r.dk=class{constructor(s,t,n,c){this.context=s,this.format=c,this.size=n,this.texture=s.gl.createTexture();const[p,h,g]=this.size,{gl:M}=s;M.bindTexture(M.TEXTURE_3D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),M.texImage3D(M.TEXTURE_3D,0,this.format,p,h,g,0,p_(this.format),m_(this.format),t.data)}bind(s,t){const{context:n}=this,{gl:c}=n;c.bindTexture(c.TEXTURE_3D,this.texture),s!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,s),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,s),this.minFilter=s),t!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,t),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}},r.dl=v_,r.dm=[1,1,1],r.dn=Bm,r.dp=Om,r.dq=fu,r.dr=zh,r.ds=So,r.dt=Ac,r.du=Zl,r.dv=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Pi(1/0,1/0),max:new Pi(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(s,t=!1){const n=Zi(new Pi(0,0),new Pi(vn,vn),s),c=[];if(t&&!Ki(n,this._globalClipBounds))return c;for(const p of this._activeRegions){if(p.hiddenByOverlap||!Ki(n,p))continue;const h=hr(p.min,p.max,s);c.push({min:h.min,max:h.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return c}setSources(s){this._setSources(s.map(t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const n=[];for(const c of t.cache.getVisibleCoordinates()){const p=t.cache.getTile(c).buckets[t.layer];p&&p.updateFootprints(c.toUnwrapped(),n)}return n},getOrder:()=>t.order,getClipMask:()=>t.clipMask,getClipScope:()=>t.clipScope})))}_addSource(s){const t=s.getFootprints();if(t.length===0)return;const n=s.getOrder(),c=s.getClipMask(),p=s.getClipScope();for(const h of t){if(!h.footprint)continue;const g=Zi(h.footprint.min,h.footprint.max,h.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:h.id,footprint:h.footprint,order:n,clipMask:c,clipScope:p})}this._sourceIds.push(s.getSourceId())}_computeReplacement(){this._activeRegions.sort((t,n)=>t.priority-n.priority||di(t.min,n.min)||di(t.max,n.max)||t.order-n.order||t.clipMask-n.clipMask||function(c,p){const h=(g,M)=>g+M;return c.length-p.length||c.reduce(h,"").localeCompare(p.reduce(h,""))}(t.clipScope,n.clipScope));let s=this._activeRegions.length!==this._prevRegions.length;if(!s){let t=0;for(;!s&&t!==this._activeRegions.length;){const n=this._activeRegions[t],c=this._prevRegions[t];s=n.priority!==c.priority||!Ti(n,c)||n.order!==c.order||n.clipMask!==c.clipMask||!cn(n.clipScope,c.clipScope),++t}}if(s){++this._updateTime;for(const n of this._activeRegions)n.order!==Lt&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));const t=n=>{const c=this._activeRegions;if(n>=c.length)return n;const p=c[n].priority;for(;n<c.length&&c[n].priority===p;)++n;return n};if(this._sourceIds.length>1){let n=0,c=t(n);for(;n!==c;){let p=n;const h=n;for(;p!==c;){const g=this._activeRegions[p];g.hiddenByOverlap=!1;for(let M=0;M<h;M++){const C=this._activeRegions[M];if(!C.hiddenByOverlap&&g.order===Lt&&Ki(g,C)&&(g.hiddenByOverlap=gn(g.footprint,g.tileId,C.footprint,C.tileId),g.hiddenByOverlap))break}++p}n=c,c=t(n)}}}}_setSources(s){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=s.length-1;t>=0;t--)this._addSource(s[t]);this._computeReplacement()}},r.dw=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy()}_fillGridMeshWithLods(s,t){const n=new du,c=new uo,p=[],h=s+1+2,g=t[0]+1,M=t[0]+1+(1+t.length),C=(P,b,L)=>{let D=P===h-1?P-2:P===0?P:P-1;return D+=L?24575:0,[D,b]};for(let P=0;P<h;++P)n.emplaceBack(...C(P,0,!0));for(let P=0;P<g;++P)for(let b=0;b<h;++b)n.emplaceBack(...C(b,P,(b===0||b===h-1)&&!0));for(let P=0;P<t.length;++P){const b=t[P];for(let L=0;L<h;++L)n.emplaceBack(...C(L,b,!0))}for(let P=0;P<t.length;++P){const b=c.length,L=t[P]+1+2,D=new uo;for(let B=0;B<L-1;B++){const q=B===L-2,W=q?h*(M-t.length+P-B):h;for(let ee=0;ee<h-1;ee++){const te=B*h+ee;B===0||q||ee===0||ee===h-2?(D.emplaceBack(te+1,te,te+W),D.emplaceBack(te+W,te+W+1,te+1)):(c.emplaceBack(te+1,te,te+W),c.emplaceBack(te+W,te+W+1,te+1))}}const A=bs.simpleSegment(0,b,n.length,c.length-b);for(let B=0;B<D.uint16.length;B+=3)c.emplaceBack(D.uint16[B],D.uint16[B+1],D.uint16[B+2]);const R=bs.simpleSegment(0,b,n.length,c.length-b);p.push({withoutSkirts:A,withSkirts:R})}return{vertices:n,indices:c,segments:p}}_createGrid(s){const t=this._fillGridMeshWithLods(Yc,vu);this._gridSegments=t.segments,this._gridBuffer=s.createVertexBuffer(t.vertices,lr.members),this._gridIndexBuffer=s.createIndexBuffer(t.indices,!0)}_createPoles(s){const t=new uo;for(let g=0;g<=Yc;g++)t.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=s.createIndexBuffer(t,!0);const n=new gl,c=new gl,p=new gl,h=new gl;this._poleSegments=[];for(let g=0,M=0;g<xl;g++){const C=360/(1<<g);n.emplaceBack(0,-Na,0,.5,0),c.emplaceBack(0,-Na,0,.5,1),p.emplaceBack(0,-Na,0,.5,.5),h.emplaceBack(0,-Na,0,.5,.5);for(let P=0;P<=Yc;P++){let b=P/Yc,L=0;const D=Ee(0,C,b),[A,R,B]=$c(Kl,Bl,D,Na);n.emplaceBack(A,R,B,b,L),c.emplaceBack(A,R,B,b,1-L);const q=ft(D);b=.5+.5*Math.sin(q),L=.5+.5*Math.cos(q),p.emplaceBack(A,R,B,b,L),h.emplaceBack(A,R,B,b,1-L)}this._poleSegments.push(bs.simpleSegment(M,0,66,64)),M+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(n,fr,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(c,fr,!1),this._texturedPoleNorthVertexBuffer=s.createVertexBuffer(p,fr,!1),this._texturedPoleSouthVertexBuffer=s.createVertexBuffer(h,fr,!1)}getGridBuffers(s,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}},r.dx=Lt,r.dy=li,r.dz=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.e=es,r.e0=op,r.e1=ga,r.e2=Fs,r.e3=zy,r.e4=function(s,t,n,c,p,h,g,M,C,P,b=1,L,D){s.createArrays(),s.tilePixelRatio=vn/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const A=s.layers[0].layout,R=s.layers[0]._unevaluatedLayout._values,B={};B.scaleFactor=b,B.textSizeScaleRange=A.get("text-size-scale-range"),B.iconSizeScaleRange=A.get("icon-size-scale-range");const[q,W]=B.textSizeScaleRange,[ee,te]=B.iconSizeScaleRange;if(B.textScaleFactor=ii(B.scaleFactor,q,W),B.iconScaleFactor=ii(B.scaleFactor,ee,te),s.textSizeData.kind==="composite"){const{minZoom:ve,maxZoom:Be}=s.textSizeData;B.compositeTextSizes=[R["text-size"].possiblyEvaluate(new Ka(ve),M),R["text-size"].possiblyEvaluate(new Ka(Be),M)]}if(s.iconSizeData.kind==="composite"){const{minZoom:ve,maxZoom:Be}=s.iconSizeData;B.compositeIconSizes=[R["icon-size"].possiblyEvaluate(new Ka(ve),M),R["icon-size"].possiblyEvaluate(new Ka(Be),M)]}B.layoutTextSize=R["text-size"].possiblyEvaluate(new Ka(C+1),M),B.layoutIconSize=R["icon-size"].possiblyEvaluate(new Ka(C+1),M),B.textMaxSize=R["text-size"].possiblyEvaluate(new Ka(18),M);const Y=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",re=A.get("text-size");let ce=!1;for(const ve of s.features)if(ve.icon&&ve.icon.nameSecondary){ce=!0;break}for(const ve of s.features){const Be=A.get("text-font").evaluate(ve,{},M).join(","),Oe=re.evaluate(ve,{},M)*B.textScaleFactor,Pe=B.layoutTextSize.evaluate(ve,{},M)*B.textScaleFactor,nt=(B.layoutIconSize.evaluate(ve,{},M),{horizontal:{},vertical:void 0}),Ue=ve.text;let lt,_t=[0,0];if(Ue){const Ct=Ue.toString(),Nt=A.get("text-letter-spacing").evaluate(ve,{},M)*hs,wt=A.get("text-line-height").evaluate(ve,{},M)*hs,gi=Mo(Ct)?Nt:0,Ui=A.get("text-anchor").evaluate(ve,{},M),mi=A.get("text-variable-anchor");if(!mi){const nr=A.get("text-radial-offset").evaluate(ve,{},M);_t=nr?Ny(Ui,[nr*hs,s_]):A.get("text-offset").evaluate(ve,{},M).map(Fn=>Fn*hs)}let Dn=Y?"center":A.get("text-justify").evaluate(ve,{},M);const Mn=A.get("symbol-placement")==="point",tn=Mn?A.get("text-max-width").evaluate(ve,{},M)*hs:1/0,qi=nr=>{s.allowVerticalPlacement&&ys(Ct)&&(nt.vertical=An(Ue,t,n,p,Be,tn,wt,Ui,nr,gi,_t,Ke.vertical,!0,Pe,Oe))};if(!Y&&mi){const nr=Dn==="auto"?mi.map(Hn=>o_(Hn)):[Dn];let Fn=!1;for(let Hn=0;Hn<nr.length;Hn++){const zr=nr[Hn];if(!nt.horizontal[zr])if(Fn)nt.horizontal[zr]=nt.horizontal[0];else{const Yr=An(Ue,t,n,p,Be,tn,wt,"center",zr,gi,_t,Ke.horizontal,!1,Pe,Oe);Yr&&(nt.horizontal[zr]=Yr,Fn=Yr.positionedLines.length===1)}}qi("left")}else{if(Dn==="auto"&&(Dn=o_(Ui)),Mn||A.get("text-writing-mode").indexOf("horizontal")>=0||!ys(Ct)){const nr=An(Ue,t,n,p,Be,tn,wt,Ui,Dn,gi,_t,Ke.horizontal,!1,Pe,Oe);nr&&(nt.horizontal[Dn]=nr)}qi(Mn?"left":Dn)}}let dt=!1;if(ve.icon&&ve.icon.namePrimary){const Ct=eu(s.iconSizeData,R["icon-size"],M,s.zoom,ve)*B.iconScaleFactor*L,Nt=ve.icon.getPrimary().scaleSelf(Ct).serialize(),wt=c[Nt];wt&&(lt=Vn(p[Nt],ve.icon.nameSecondary?p[ve.icon.getSecondary().scaleSelf(Ct).serialize()]:void 0,A.get("icon-offset").evaluate(ve,{},M),A.get("icon-anchor").evaluate(ve,{},M)),dt=wt.sdf,s.sdfIcons===void 0?s.sdfIcons=wt.sdf:s.sdfIcons!==wt.sdf&&Xn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(wt.pixelRatio!==s.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}const xt=Vy(nt.horizontal)||nt.vertical;s.iconsInText||(s.iconsInText=!!xt&&xt.iconsInText),(xt||lt)&&Mx(s,ve,nt,lt,c,B,Pe,0,_t,dt,g,M,P,D,ce)}h&&s.generateCollisionDebugBuffers(C,s.collisionBoxArray,B.textScaleFactor)},r.e5=Yg,r.e6=ra,r.e7=ue,r.e8=u,r.e9=Ge,r.ea=function(s){let t=0;if(new Uint32Array(s,0,1)[0]!==lv){const n=new Uint32Array(s,0,7),[,,c,p,h,g]=n;t=n.byteLength+p+h+g+h,(c!==s.byteLength||t>=s.byteLength)&&Xn("Invalid b3dm header information.")}return dv(s,t)},r.eb=function(s,t){const n=pv(s);for(const c of n){for(const p of c.meshes)J1(p);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push(Q1(c.lights,t)))}return n},r.ec=Gg,r.ed=C0,r.ee=us,r.ef=function(s){nn(),Wt!=null&&Wt.then(t=>{t.keys().then(n=>{for(let c=0;c<n.length-s;c++)t.delete(n[c])})})},r.f=function(s){return s.indexOf("mapbox:")===0},r.g=function(s,t){return Ia(cr(s,{method:"GET"}),t)},r.h=Ks,r.i=function(s){return es.API_STYLE_REGEX.test(s)&&!Js(s)},r.j=function(s){return decodeURIComponent(atob(s).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))},r.k=function(s){return btoa(encodeURIComponent(s).replace(/%([0-9A-F]{2})/g,(t,n)=>String.fromCharCode(+("0x"+n))))},r.l=cr,r.m=jn,r.n=function(s,t){return Ia(cr(s,{type:"json"}),t)},r.o=Au,r.p=function(s,t){return Ia(cr(s,{method:"POST"}),t)},r.q=qe,r.r=Vo,r.s=function(s){try{const t=self[s];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=Ce,r.u=function(){return function s(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()},r.v=function(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)},r.w=Xn,r.x=function(){return S_||(S_=new gm),S_},r.y=yt,r.z=Fe}),ei(["./shared"],function(r){function Ge(Xt){const oe=Xt?Xt.url.toString():void 0;return oe?performance.getEntriesByName(oe):[]}function de(Xt){if(typeof Xt=="number"||typeof Xt=="boolean"||typeof Xt=="string"||Xt==null)return JSON.stringify(Xt);if(Array.isArray(Xt)){let pe="[";for(const Ce of Xt)pe+=`${de(Ce)},`;return`${pe}]`}let oe="{";for(const pe of Object.keys(Xt).sort())oe+=`${pe}:${de(Xt[pe])},`;return`${oe}}`}function Je(Xt){let oe="";for(const pe of r.bm)(Xt.type!=="model"||pe!=="minzoom"&&pe!=="maxzoom")&&(oe+=`/${de(Xt[pe])}`);return oe}class rt{constructor(oe){this.keyCache={},this._layers={},this._layerConfigs={},oe&&this.replace(oe)}replace(oe,pe){this._layerConfigs={},this._layers={},this.update(oe,[],pe)}update(oe,pe,Ce){this._options=Ce;for(const Qe of oe)this._layerConfigs[Qe.id]=Qe,(this._layers[Qe.id]=r.cu(Qe,this.scope,null,this._options)).compileFilter(Ce),this.keyCache[Qe.id]&&delete this.keyCache[Qe.id];for(const Qe of pe)delete this.keyCache[Qe],delete this._layerConfigs[Qe],delete this._layers[Qe];this.familiesBySource={};const qe=function(Qe,ut){const It={};for(let Vt=0;Vt<Qe.length;Vt++){const Gt=Qe[Vt];let Wt=ut&&ut[Gt.id];!Wt&&(Wt=Je(Gt),Gt.type==="line"&&Gt.paint)&&function Qi(nn){return typeof nn=="string"&&nn==="line-progress"||(Array.isArray(nn)?nn.some(Qi):!(!nn||typeof nn!="object")&&Object.values(nn).some(Qi))}(Gt.paint["line-width"])&&(Wt+=`/${de(Gt.paint["line-width"])}`),ut&&(ut[Gt.id]=Wt);let Mi=It[Wt];Mi||(Mi=It[Wt]=[]),Mi.push(Gt)}const mt=[];for(const Vt in It)mt.push(It[Vt]);return mt}(r.bj(this._layerConfigs),this.keyCache);for(const Qe of qe){const ut=Qe.map(Mi=>this._layers[Mi.id]),It=ut[0];if(It.visibility==="none")continue;const mt=It.source||"";let Vt=this.familiesBySource[mt];Vt||(Vt=this.familiesBySource[mt]={});const Gt=It.sourceLayer||"_geojsonTileLayer";let Wt=Vt[Gt];Wt||(Wt=Vt[Gt]=[]),Wt.push(ut)}}}const ai=1*r.dX;class bi{constructor(oe){const pe={},Ce=[];for(const It in oe){const mt=oe[It],Vt=pe[It]={};for(const Gt in mt.glyphs){const Wt=mt.glyphs[+Gt];if(!Wt||Wt.bitmap.width===0||Wt.bitmap.height===0)continue;const Mi=Wt.metrics.localGlyph?ai:1,Qi={x:0,y:0,w:Wt.bitmap.width+2*Mi,h:Wt.bitmap.height+2*Mi};Ce.push(Qi),Vt[Gt]=Qi}}const{w:qe,h:Qe}=r.F(Ce),ut=new r.dW({width:qe||1,height:Qe||1});for(const It in oe){const mt=oe[It];for(const Vt in mt.glyphs){const Gt=mt.glyphs[+Vt];if(!Gt||Gt.bitmap.width===0||Gt.bitmap.height===0)continue;const Wt=pe[It][Vt],Mi=Gt.metrics.localGlyph?ai:1;r.dW.copy(Gt.bitmap,ut,{x:0,y:0},{x:Wt.x+Mi,y:Wt.y+Mi},Gt.bitmap)}}this.image=ut,this.positions=pe}}r.dV(bi,"GlyphAtlas");const Ai="3d_elevation_id",qt="hd_road_elevation";class xi{constructor(){this._valid=!1}reset(oe){return this.feature=oe,this._valid=!0,this._geometry=oe.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(oe,pe){return this._valid&&oe(pe(this._geometry)),this}require(oe,pe,Ce){return this.get(oe,!0,pe,Ce)}optional(oe,pe,Ce){return this.get(oe,!1,pe,Ce)}success(){return this._valid}get(oe,pe,Ce,qe){const Qe=this.feature.properties.hasOwnProperty(oe)?+this.feature.properties[oe]:void 0;return this._valid&&Qe!==void 0?Ce(qe?qe(Qe):Qe):pe&&(this._valid=!1),this}}class kt{constructor(oe,pe){this.featureFunc=oe,this.vertexFunc=pe}parseFeature(oe,pe,Ce){return this.featureFunc(oe,pe,Ce)}parseVertex(oe,pe,Ce){return this.vertexFunc(oe,pe,Ce)}}const Tt=new kt((Xt,oe,pe)=>Xt.reset(oe).require(Ai,Ce=>{pe.id=Ce}).optional("fixed_height_relative",Ce=>{pe.constantHeight=Ce},Xi.decodeRelativeHeight).geometry(Ce=>{pe.bounds=Ce},Xi.computeBounds).success(),(Xt,oe,pe)=>Xt.reset(oe).require(Ai,Ce=>{pe.id=Ce}).require("elevation_idx",Ce=>{pe.idx=Ce}).require("extent",Ce=>{pe.extent=Ce}).require("height_relative",Ce=>{pe.height=Ce},Xi.decodeRelativeHeight).geometry(Ce=>{pe.position=Ce},Xi.getPoint).success()),ln=new kt((Xt,oe,pe)=>Xt.reset(oe).require(Ai,Ce=>{pe.id=Ce}).optional("fixed_height",Ce=>{pe.constantHeight=Ce},Xi.decodeMetricHeight).geometry(Ce=>{pe.bounds=Ce},Xi.computeBounds).success(),(Xt,oe,pe)=>Xt.reset(oe).require(Ai,Ce=>{pe.id=Ce}).require("elevation_idx",Ce=>{pe.idx=Ce}).require("extent",Ce=>{pe.extent=Ce}).require("height",Ce=>{pe.height=Ce},Xi.decodeMetricHeight).geometry(Ce=>{pe.position=Ce},Xi.getPoint).success());class Xi{static computeBounds(oe){const pe=new r.P(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Ce=new r.P(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const qe of oe[0])pe.x>qe.x&&(pe.x=qe.x),pe.y>qe.y&&(pe.y=qe.y),Ce.x<qe.x&&(Ce.x=qe.x),Ce.y<qe.y&&(Ce.y=qe.y);return{min:pe,max:Ce}}static getPoint(oe){return r.ab.vec2.fromValues(oe[0][0].x,oe[0][0].y)}static decodeRelativeHeight(oe){return 1e-4*oe*5}static decodeMetricHeight(oe){return 1e-4*oe}static parse(oe){const pe=[],Ce=[],qe=oe.length,Qe=new xi;for(let It=0;It<qe;It++){const mt=oe.feature(It),Vt=mt.properties.hasOwnProperty("version")?String(mt.properties.version):void 0,Gt=(ut=Vt)?ut==="1.0.1"?ln:void 0:Tt;if(Gt===void 0){r.w(`Unknown elevation feature version number ${Vt||"(unknown)"}`);continue}const Wt=mt.properties.hasOwnProperty("type")?mt.properties.type:void 0;if(Wt){if(r.dY.VectorTileFeature.types[mt.type]==="Point"&&Wt==="curve_point"){const Mi={};Gt.parseVertex(Qe,mt,Mi)&&pe.push(Mi)}else if(r.dY.VectorTileFeature.types[mt.type]==="Polygon"&&Wt==="curve_meta"){const Mi={};Gt.parseFeature(Qe,mt,Mi)&&Ce.push(Mi)}}}var ut;return{vertices:pe,features:Ce}}}class Dt{constructor(oe,pe,Ce,qe,Qe,ut){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=oe,this.heightRange={min:Ce,max:Ce},this.safeArea=pe,this.constantHeight=Ce,this.constantHeight==null&&(this.constantHeight!=null||qe.length!==0)){this.vertices=qe,this.edges=Qe,this.edges=this.edges.filter(It=>It.a<this.vertices.length&&It.b<this.vertices.length&&!r.ab.vec2.exactEquals(this.vertices[It.a].position,this.vertices[It.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const It of this.vertices)this.vertexProps.push({dir:r.ab.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,It.height),this.heightRange.max=Math.max(this.heightRange.max,It.height);for(const It of this.edges){const mt=this.vertices[It.a].position,Vt=this.vertices[It.b].position,Gt=r.ab.vec2.subtract(r.ab.vec2.create(),Vt,mt),Wt=r.ab.vec2.length(Gt),Mi=r.ab.vec2.scale(r.ab.vec2.create(),Gt,1/Wt);this.edgeProps.push({vec:Gt,dir:Mi,len:Wt});const Qi=this.vertexProps[It.a].dir,nn=this.vertexProps[It.b].dir;r.ab.vec2.add(Qi,Qi,Mi),r.ab.vec2.add(nn,nn,Mi)}for(const It of this.vertexProps)It.dir[0]===0&&It.dir[1]===0||r.ab.vec2.normalize(It.dir,It.dir);this.tessellate(ut)}}pointElevation(oe){if(this.constantHeight!=null)return this.constantHeight;const pe=this.getClosestEdge(oe);if(pe==null)return 0;const[Ce,qe]=pe;return(1-(Qe=qe))*this.vertices[this.edges[Ce].a].height+Qe*this.vertices[this.edges[Ce].b].height;var Qe}getClosestEdge(oe){if(this.edges.length===0)return;let pe=0,Ce=Number.POSITIVE_INFINITY,qe=0;const Qe=r.ab.vec2.fromValues(oe.x,oe.y);for(let ut=0;ut<this.edges.length;ut++){const It=this.edges[ut],mt=this.edgeProps[ut].dir,Vt=new r.dZ(Qe,this.edgeProps[ut].dir),Gt=this.vertices[It.a].position,Wt=this.vertices[It.b].position,Mi=r.ab.vec2.create(),Qi=r.ab.vec2.create(),nn=Vt.intersectsPlane(Gt,this.vertexProps[It.a].dir,Mi),zn=Vt.intersectsPlane(Wt,this.vertexProps[It.b].dir,Qi);if(!nn||!zn)continue;const jn=r.ab.vec2.subtract(r.ab.vec2.create(),Qi,Mi),ar=r.ab.vec2.subtract(r.ab.vec2.create(),Qe,Mi),Wn=r.ab.vec2.dot(jn,jn),Rr=Wn>0?r.ab.vec2.dot(ar,jn)/Wn:0,Ur=r.aw(Rr,0,1),Br=Math.abs((Rr-Ur)*this.edgeProps[ut].len),sa=r.ab.vec2.subtract(r.ab.vec2.create(),Qe,Gt),Wr=Br+Math.abs(r.ab.vec2.dot(sa,r.ab.vec2.fromValues(mt[1],-mt[0])));Wr<Ce&&(pe=ut,Ce=Wr,qe=Ur)}return[pe,qe]}tessellate(oe){for(let pe=this.edges.length-1;pe>=0;--pe){const Ce=this.edges[pe].a,qe=this.edges[pe].b,{position:Qe,height:ut,extent:It}=this.vertices[Ce],{position:mt,height:Vt,extent:Gt}=this.vertices[qe],Wt=this.vertexProps[Ce].dir,Mi=this.vertexProps[qe].dir,Qi=r.ab.vec3.fromValues(Qe[0]/oe,Qe[1]/oe,ut),nn=r.ab.vec3.fromValues(mt[0]/oe,mt[1]/oe,Vt),zn=r.ab.vec3.fromValues(Wt[1],-Wt[0],0);r.ab.vec3.scale(zn,zn,It);const jn=r.ab.vec3.fromValues(Mi[1],-Mi[0],0);if(r.ab.vec3.scale(jn,jn,Gt),this.distSqLines(r.ab.vec3.fromValues(Qi[0]+.5*zn[0],Qi[1]+.5*zn[1],Qi[2]+.5*zn[2]),r.ab.vec3.fromValues(nn[0]-.5*jn[0],nn[1]-.5*jn[1],nn[2]-.5*jn[2]),r.ab.vec3.fromValues(Qi[0]-.5*zn[0],Qi[1]-.5*zn[1],Qi[2]-.5*zn[2]),r.ab.vec3.fromValues(nn[0]+.5*jn[0],nn[1]+.5*jn[1],nn[2]+.5*jn[2]))<=.05*.05)continue;const ar=this.vertices.length,Wn=r.ab.vec2.add(r.ab.vec2.create(),Qe,mt);this.vertices.push({position:r.ab.vec2.scale(Wn,Wn,.5),height:.5*(ut+Vt),extent:.5*(It+Gt)});const Rr=r.ab.vec2.add(r.ab.vec2.create(),Wt,Mi);this.vertexProps.push({dir:r.ab.vec2.normalize(Rr,Rr)}),this.edges.splice(pe,1),this.edgeProps.splice(pe,1),this.edges.push({a:Ce,b:ar}),this.edges.push({a:ar,b:qe});const Ur=r.ab.vec2.subtract(r.ab.vec2.create(),this.vertices[ar].position,Qe),Br=r.ab.vec2.length(Ur),sa={vec:Ur,dir:r.ab.vec2.scale(r.ab.vec2.create(),Ur,1/Br),len:Br};this.edgeProps.push(sa),this.edgeProps.push(sa)}}distSqLines(oe,pe,Ce,qe){const Qe=r.ab.vec3.subtract(r.ab.vec3.create(),pe,oe),ut=r.ab.vec3.subtract(r.ab.vec3.create(),qe,Ce),It=r.ab.vec3.subtract(r.ab.vec3.create(),oe,Ce),mt=r.ab.vec3.dot(Qe,Qe),Vt=r.ab.vec3.dot(Qe,ut),Gt=r.ab.vec3.dot(Qe,It),Wt=r.ab.vec3.dot(ut,ut),Mi=r.ab.vec3.dot(ut,It),Qi=mt*Wt-Vt*Vt;if(Qi===0){const Wn=r.ab.vec3.dot(It,ut)/r.ab.vec3.dot(ut,ut),Rr=r.ab.vec3.lerp(r.ab.vec3.create(),Ce,qe,Wn);return r.ab.vec3.squaredDistance(Rr,oe)}const nn=(Vt*Mi-Gt*Wt)/Qi,zn=(mt*Mi-Vt*Gt)/Qi,jn=r.ab.vec3.lerp(r.ab.vec3.create(),oe,pe,nn),ar=r.ab.vec3.lerp(r.ab.vec3.create(),Ce,qe,zn);return r.ab.vec3.squaredDistance(jn,ar)}}class ni{static parseFrom(oe,pe){const Ce=Xi.parse(oe);if(!Ce)return[];let{vertices:qe,features:Qe}=Ce;const ut=1/r.cc(pe);Qe.sort((Gt,Wt)=>Gt.id-Wt.id),qe.sort((Gt,Wt)=>Gt.id-Wt.id||Gt.idx-Wt.idx),qe=qe.filter((Gt,Wt,Mi)=>Wt===Mi.findIndex(Qi=>Qi.id===Gt.id&&Qi.idx===Gt.idx));const It=new Array;let mt=0;const Vt=qe.length;for(const Gt of Qe){if(Gt.constantHeight){It.push(new Dt(Gt.id,Gt.bounds,Gt.constantHeight));continue}for(;mt!==Vt&&qe[mt].id<Gt.id;)mt++;if(mt===Vt||qe[mt].id!==Gt.id)continue;const Wt=new Array,Mi=new Array,Qi=mt;for(;mt!==Vt&&qe[mt].id===Gt.id;){const nn=qe[mt];if(Wt.push({position:nn.position,height:nn.height,extent:nn.extent}),mt!==Qi&&qe[mt-1].idx===nn.idx-1){const zn=mt-Qi;Mi.push({a:zn-1,b:zn})}mt++}It.push(new Dt(Gt.id,Gt.bounds,void 0,Wt,Mi,ut))}return It}}r.dV(Dt,"ElevationFeature");class ci{constructor(oe){this.tileID=new r.aG(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.tileZoom=oe.tileZoom,this.uid=oe.uid,this.zoom=oe.zoom,this.lut=oe.lut,this.canonical=oe.tileID.canonical,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.scope=oe.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=oe.showCollisionBoxes,this.collectResourceTiming=!!oe.request&&oe.request.collectResourceTiming,this.promoteId=oe.promoteId,this.isSymbolTile=oe.isSymbolTile,this.tileTransform=r.aQ(oe.tileID.canonical,oe.projection),this.projection=oe.projection,this.worldview=oe.worldview,this.localizableLayerIds=oe.localizableLayerIds,this.brightness=oe.brightness,this.extraShadowCaster=!!oe.extraShadowCaster,this.tessellationStep=oe.tessellationStep,this.scaleFactor=oe.scaleFactor}parse(oe,pe,Ce,qe,Qe){this.status="parsing",this.data=oe,this.collisionBoxArray=new r.aW;const ut=new r.d_(Object.keys(oe.layers).sort()),It=new r.d$(this.tileID,this.promoteId);It.bucketLayerIDs=[];const mt={},Vt=new r.e0(256,256),Gt={featureIndex:It,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Vt,availableImages:Ce,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Wt=pe.familiesBySource[this.source];for(const Wn in Wt){const Rr=oe.layers[Wn];if(!Rr)continue;let Ur=!1,Br=!1,sa=!1;for(const Ia of Wt[Wn])Ia[0].type==="symbol"?Ur=!0:Br=!0,Ia[0].is3D()&&Ia[0].type!=="model"&&(sa=!0);if(this.extraShadowCaster&&!sa||this.isSymbolTile===!0&&!Ur||this.isSymbolTile===!1&&!Br)continue;Rr.version===1&&r.w(`Vector tile source "${this.source}" layer "${Wn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Wr=ut.encode(Wn),tr=[];let Rs=!1;for(let Ia=0,Da=0;Ia<Rr.length;Ia++){const _s=Rr.feature(Ia),qo=It.getId(_s,Wn);if(this.localizableLayerIds&&this.localizableLayerIds.has(Wn)){const dl=_s.properties?_s.properties.worldview:null;if(this.worldview&&typeof dl=="string")if(dl==="all")_s.properties.$localized=!0;else{if(!dl.split(",").includes(this.worldview))continue;_s.properties.$localized=!0,_s.properties.worldview=this.worldview}}!Rs&&_s.properties&&_s.properties.hasOwnProperty(Ai)&&(Rs=!0),tr.push({feature:_s,id:qo,index:Da,sourceLayerIndex:Wr}),Da++}Rs&&oe.layers.hasOwnProperty(qt)&&(Gt.elevationFeatures=ni.parseFrom(oe.layers[qt],this.canonical));for(const Ia of Wt[Wn]){const Da=Ia[0];(!this.extraShadowCaster||Da.is3D()&&Da.type!=="model")&&(this.isSymbolTile!==void 0&&Da.type==="symbol"!==this.isSymbolTile||Da.minzoom&&this.zoom<Math.floor(Da.minzoom)||Da.maxzoom&&this.zoom>=Da.maxzoom||Da.visibility!=="none"&&(Nn(Ia,this.zoom,Gt.brightness,Ce),(mt[Da.id]=Da.createBucket({index:It.bucketLayerIDs.length,layers:Ia,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Wr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(tr,Gt,this.tileID.canonical,this.tileTransform),It.bucketLayerIDs.push(Ia.map(_s=>r.aC(_s.id,_s.scope)))))}}let Mi,Qi,nn,zn;Vt.trim();const jn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ar=()=>{if(Mi)return this.status="done",Qe(Mi);if(this.extraShadowCaster)this.status="done",Qe(null,{buckets:r.bj(mt).filter(Wn=>!Wn.isEmpty()),featureIndex:It,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Gt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Qi&&nn&&zn){const Wn=new bi(Qi),Rr=new r.e3(nn,zn,this.lut);for(const Ur in mt){const Br=mt[Ur];Br instanceof r.aX?(Nn(Br.layers,this.zoom,Gt.brightness,Ce),r.e4(Br,Qi,Wn.positions,nn,Rr.iconPositions,this.showCollisionBoxes,Ce,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.pixelRatio,this.brightness)):Br.hasPattern&&(Br instanceof r.b1||Br instanceof r.b2||Br instanceof r.d5)&&(Nn(Br.layers,this.zoom,Gt.brightness,Ce),Br.addFeatures(Gt,this.tileID.canonical,Rr.patternPositions,Ce,this.tileTransform,this.brightness))}this.status="done",Qe(null,{buckets:r.bj(mt).filter(Ur=>!Ur.isEmpty()),featureIndex:It,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Wn.image,lineAtlas:Vt,imageAtlas:Rr,brightness:Gt.brightness})}};if(!this.extraShadowCaster){const Wn=r.e1(Gt.glyphDependencies,Br=>Object.keys(Br).map(Number));Object.keys(Wn).length?qe.send("getGlyphs",{uid:this.uid,stacks:Wn,scope:this.scope},(Br,sa)=>{Mi||(Mi=Br,Qi=sa,ar())},void 0,!1,jn):Qi={};const Rr=Object.keys(Gt.iconDependencies);Rr.length?qe.send("getImages",{icons:Rr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Br,sa)=>{if(Mi)return;Mi=Br;const Wr={};Object.values(sa).some(tr=>tr.usvg)?this.rasterize(qe,Wr,sa,Gt.iconDependencies,()=>{nn=Wr,ar()}):(this.fillImageMap(Wr,Gt.iconDependencies,sa),nn=Wr,ar())},void 0,!1,jn):nn={};const Ur=Object.keys(Gt.patternDependencies);Ur.length?qe.send("getImages",{icons:Ur,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Br,sa)=>{if(!Mi){Mi=Br;const Wr={};Object.values(sa).some(tr=>tr.usvg)?this.rasterize(qe,Wr,sa,Gt.patternDependencies,()=>{zn=Wr,ar()}):(this.fillImageMap(Wr,Gt.patternDependencies,sa),zn=Wr,ar())}},void 0,!1,jn):zn={}}ar()}fillImageMap(oe,pe,Ce){for(const qe in Ce){const Qe=pe[qe]||[];for(const ut of Qe)Ce[ut.id].usvg||(oe[ut.serialize()]=Ce[ut.id])}}getImageTaskQueue(oe,pe,Ce){const qe={};for(const Qe in pe){const ut=Ce[Qe]||[];for(const It of ut){const mt=It.serialize();pe[It.id].usvg?qe[mt]||(qe[mt]=It):oe[mt]=pe[It.id]}}return qe}rasterize(oe,pe,Ce,qe,Qe){const ut=this.getImageTaskQueue(pe,Ce,qe);this.rasterizeTask=oe.send("rasterizeImages",{scope:this.scope,imageTasks:ut},(It,mt)=>{if(!It)for(const Vt in mt){const{id:Gt}=r.e2.deserializeFromString(Vt);pe[Vt]=Object.assign({},Ce[Gt],{data:mt[Vt]})}Qe()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Nn(Xt,oe,pe,Ce){const qe=new r.a8(oe,{brightness:pe});for(const Qe of Xt)Qe.recalculate(qe,Ce)}class Fi extends r.E{constructor(oe,pe,Ce,qe,Qe,ut){super(),this.actor=oe,this.layerIndex=pe,this.availableImages=Ce,this.loadVectorData=Qe||r.aD,this.loading={},this.loaded={},this.deduped=new r.aB(oe.scheduler),this.isSpriteLoaded=qe,this.scheduler=oe.scheduler,this.brightness=ut}loadTile(oe,pe){const Ce=oe.uid,qe=oe&&oe.request,Qe=qe&&qe.collectResourceTiming,ut=this.loading[Ce]=new ci(oe);ut.abort=this.loadVectorData(oe,(It,mt)=>{const Vt=!this.loading[Ce];if(delete this.loading[Ce],ut.cancelRasterize(),Vt||It||!mt)return ut.status="done",Vt||(this.loaded[Ce]=ut),pe(It);const Gt=mt.rawData,Wt={};mt.expires&&(Wt.expires=mt.expires),mt.cacheControl&&(Wt.cacheControl=mt.cacheControl),ut.vectorTile=mt.vectorTile||new r.dY.VectorTile(new r.bh(Gt));const Mi=()=>{ut.parse(ut.vectorTile,this.layerIndex,this.availableImages,this.actor,(Qi,nn)=>{if(Qi||!nn)return pe(Qi);const zn={};if(Qe){const jn=Ge(qe);jn.length>0&&(zn.resourceTiming=JSON.parse(JSON.stringify(jn)))}pe(null,r.l({rawTileData:Gt.slice(0)},nn,Wt,zn))})};this.isSpriteLoaded?Mi():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Mi,{type:"parseTile",isSymbolTile:oe.isSymbolTile,zoom:oe.tileZoom}):Mi()}),this.loaded=this.loaded||{},this.loaded[Ce]=ut})}reloadTile(oe,pe){const Ce=this.loaded,qe=oe.uid;if(Ce&&Ce[qe]){const Qe=Ce[qe];Qe.scaleFactor=oe.scaleFactor,Qe.showCollisionBoxes=oe.showCollisionBoxes,Qe.projection=oe.projection,Qe.brightness=oe.brightness,Qe.tileTransform=r.aQ(oe.tileID.canonical,oe.projection),Qe.extraShadowCaster=oe.extraShadowCaster,Qe.lut=oe.lut;const ut=(It,mt)=>{const Vt=Qe.reloadCallback;Vt&&(delete Qe.reloadCallback,Qe.parse(Qe.vectorTile,this.layerIndex,this.availableImages,this.actor,Vt)),pe(It,mt)};Qe.status==="parsing"?Qe.reloadCallback=ut:Qe.status==="done"&&(Qe.vectorTile?Qe.parse(Qe.vectorTile,this.layerIndex,this.availableImages,this.actor,ut):ut())}else pe(null,void 0)}abortTile(oe,pe){const Ce=oe.uid,qe=this.loading[Ce];qe&&(qe.abort&&qe.abort(),delete this.loading[Ce]),pe()}removeTile(oe,pe){const Ce=this.loaded,qe=oe.uid;Ce&&Ce[qe]&&delete Ce[qe],pe()}}class oi{loadTile(oe,pe){const{uid:Ce,encoding:qe,rawImageData:Qe,padding:ut}=oe,It=ImageBitmap&&Qe instanceof ImageBitmap?this.getImageData(Qe,ut):Qe;pe(null,new r.e5(Ce,It,qe,ut<1))}getImageData(oe,pe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(oe.width,oe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=oe.width,this.offscreenCanvas.height=oe.height,this.offscreenCanvasContext.drawImage(oe,0,0,oe.width,oe.height);const Ce=this.offscreenCanvasContext.getImageData(-pe,-pe,oe.width+2*pe,oe.height+2*pe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Ce}}r.bg.setPbf(r.bh);class Ci{decodeRasterArray({task:oe,buffer:pe},Ce){r.bg.performDecoding(pe,oe).then(qe=>{Ce(null,qe)},qe=>{Ce(qe)})}}const Zt=r.dY.VectorTileFeature.prototype.toGeoJSON;class Yt{constructor(oe){this._feature=oe,this.extent=r.ag,this.type=oe.type,this.properties=oe.tags,"id"in oe&&!isNaN(oe.id)&&(this.id=parseInt(oe.id,10))}loadGeometry(){if(this._feature.type===1){const oe=[];for(const pe of this._feature.geometry)oe.push([new r.P(pe[0],pe[1])]);return oe}{const oe=[];for(const pe of this._feature.geometry){const Ce=[];for(const qe of pe)Ce.push(new r.P(qe[0],qe[1]));oe.push(Ce)}return oe}}toGeoJSON(oe,pe,Ce){return Zt.call(this,oe,pe,Ce)}}class vi{constructor(oe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.ag,this.length=oe.length,this._features=oe}feature(oe){return new Yt(this._features[oe])}}const ae=64/4096,ge=128;class Te{constructor(){this.features=new Map}clear(){this.features.clear()}load(oe=[],pe){for(const Ce of oe){const qe=Ce.id;if(qe==null)continue;let Qe=this.features.get(qe);Qe&&this.updateCache(Qe,pe),Ce.geometry?(Qe=ze(Ce),this.updateCache(Qe,pe),this.features.set(qe,Qe)):this.features.delete(qe),this.updateCache(Qe,pe)}}updateCache(oe,pe){for(const{canonical:Ce,uid:qe}of Object.values(pe)){const{z:Qe,x:ut,y:It}=Ce;Re(oe,Math.pow(2,Qe),ut,It)&&delete pe[qe]}}getTile(oe,pe,Ce){const qe=Math.pow(2,oe),Qe=[];for(const ut of this.features.values())Re(ut,qe,pe,Ce)&&Qe.push(bt(ut,qe,pe,Ce));return{features:Qe}}getFeatures(){return[...this.features.values()]}}function Re({minX:Xt,minY:oe,maxX:pe,maxY:Ce},qe,Qe,ut){return Xt<(Qe+1+ae)/qe&&oe<(ut+1+ae)/qe&&pe>(Qe-ae)/qe&&Ce>(ut-ae)/qe}function ze(Xt){const{id:oe,geometry:pe,properties:Ce}=Xt;if(!pe)return;if(pe.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:qe,coordinates:Qe}=pe,ut={id:oe,type:1,geometry:[],tags:Ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},It=ut.geometry;if(qe==="Point")Ie(Qe,It,ut);else if(qe==="MultiPoint")for(const mt of Qe)Ie(mt,It,ut);else if(qe==="LineString")ut.type=2,it(Qe,It,ut);else if(qe==="MultiLineString")ut.type=2,vt(Qe,It,ut);else if(qe==="Polygon")ut.type=3,vt(Qe,It,ut,!0);else{if(qe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");ut.type=3;for(const mt of Qe)vt(mt,It,ut,!0)}return ut}function Ie([Xt,oe],pe,Ce){const qe=r.at(Xt);let Qe=r.aA(oe);Qe=Qe<0?0:Qe>1?1:Qe,pe.push(qe,Qe),Ce.minX=Math.min(Ce.minX,qe),Ce.minY=Math.min(Ce.minY,Qe),Ce.maxX=Math.max(Ce.maxX,qe),Ce.maxY=Math.max(Ce.maxY,Qe)}function it(Xt,oe,pe,Ce=!1,qe=!1){const Qe=[];for(const ut of Xt)Ie(ut,Qe,pe);oe.push(Qe),Ce&&function(ut,It){let mt=0;for(let Vt=0,Gt=ut.length,Wt=Gt-2;Vt<Gt;Wt=Vt,Vt+=2)mt+=(ut[Vt]-ut[Wt])*(ut[Vt+1]+ut[Wt+1]);if(mt>0===It)for(let Vt=0,Gt=ut.length;Vt<Gt/2;Vt+=2){const Wt=ut[Vt],Mi=ut[Vt+1];ut[Vt]=ut[Gt-2-Vt],ut[Vt+1]=ut[Gt-1-Vt],ut[Gt-2-Vt]=Wt,ut[Gt-1-Vt]=Mi}}(Qe,qe)}function vt(Xt,oe,pe,Ce=!1){for(let qe=0;qe<Xt.length;qe++)it(Xt[qe],oe,pe,Ce,qe===0)}function bt(Xt,oe,pe,Ce){const{id:qe,type:Qe,geometry:ut,tags:It}=Xt,mt=[];if(Qe===1)(function(Vt,Gt,Wt,Mi,Qi){for(let nn=0;nn<Vt.length;nn+=2){const zn=Math.round(r.ag*(Vt[nn+0]*Gt-Wt)),jn=Math.round(r.ag*(Vt[nn+1]*Gt-Mi));Qi.push([zn,jn])}})(ut,oe,pe,Ce,mt);else for(const Vt of ut)pt(Vt,oe,pe,Ce,mt);return{id:qe,type:Qe,geometry:mt,tags:It}}function pt(Xt,oe,pe,Ce,qe){const ut=r.ag+ge;let It;for(let mt=0;mt<Xt.length-2;mt+=2){let Vt=Math.round(r.ag*(Xt[mt+0]*oe-pe)),Gt=Math.round(r.ag*(Xt[mt+1]*oe-Ce)),Wt=Math.round(r.ag*(Xt[mt+2]*oe-pe)),Mi=Math.round(r.ag*(Xt[mt+3]*oe-Ce));const Qi=Wt-Vt,nn=Mi-Gt;Vt<-128&&Wt<-128||(Vt<-128?(Gt+=Math.round(nn*((-128-Vt)/Qi)),Vt=-128):Wt<-128&&(Mi=Gt+Math.round(nn*((-128-Vt)/Qi)),Wt=-128),Gt<-128&&Mi<-128||(Gt<-128?(Vt+=Math.round(Qi*((-128-Gt)/nn)),Gt=-128):Mi<-128&&(Wt=Vt+Math.round(Qi*((-128-Gt)/nn)),Mi=-128),Vt>=ut&&Wt>=ut||(Vt>=ut?(Gt+=Math.round(nn*((ut-Vt)/Qi)),Vt=ut):Wt>=ut&&(Mi=Gt+Math.round(nn*((ut-Vt)/Qi)),Wt=ut),Gt>=ut&&Mi>=ut||(Gt>=ut?(Vt+=Math.round(Qi*((ut-Gt)/nn)),Gt=ut):Mi>=ut&&(Wt=Vt+Math.round(Qi*((ut-Gt)/nn)),Mi=ut),It&&Vt===It[It.length-1][0]&&Gt===It[It.length-1][1]||(It=[[Vt,Gt]],qe.push(It)),It.push([Wt,Mi])))))}}var ti,Wi,mn,fn={exports:{}},vr=function(){if(mn)return fn.exports;mn=1;var Xt=r.e8(),oe=function(){if(Wi)return ti;Wi=1;var Gt=r.e6(),Wt=r.e7().VectorTileFeature;function Mi(nn,zn){this.options=zn||{},this.features=nn,this.length=nn.length}function Qi(nn,zn){this.id=typeof nn.id=="number"?nn.id:void 0,this.type=nn.type,this.rawGeometry=nn.type===1?[nn.geometry]:nn.geometry,this.properties=nn.tags,this.extent=zn||4096}return ti=Mi,Mi.prototype.feature=function(nn){return new Qi(this.features[nn],this.options.extent)},Qi.prototype.loadGeometry=function(){var nn=this.rawGeometry;this.geometry=[];for(var zn=0;zn<nn.length;zn++){for(var jn=nn[zn],ar=[],Wn=0;Wn<jn.length;Wn++)ar.push(new Gt(jn[Wn][0],jn[Wn][1]));this.geometry.push(ar)}return this.geometry},Qi.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var nn=this.geometry,zn=1/0,jn=-1/0,ar=1/0,Wn=-1/0,Rr=0;Rr<nn.length;Rr++)for(var Ur=nn[Rr],Br=0;Br<Ur.length;Br++){var sa=Ur[Br];zn=Math.min(zn,sa.x),jn=Math.max(jn,sa.x),ar=Math.min(ar,sa.y),Wn=Math.max(Wn,sa.y)}return[zn,ar,jn,Wn]},Qi.prototype.toGeoJSON=Wt.prototype.toGeoJSON,ti}();function pe(Gt){var Wt=new Xt;return function(Mi,Qi){for(var nn in Mi.layers)Qi.writeMessage(3,Ce,Mi.layers[nn])}(Gt,Wt),Wt.finish()}function Ce(Gt,Wt){var Mi;Wt.writeVarintField(15,Gt.version||1),Wt.writeStringField(1,Gt.name||""),Wt.writeVarintField(5,Gt.extent||4096);var Qi={keys:[],values:[],keycache:{},valuecache:{}};for(Mi=0;Mi<Gt.length;Mi++)Qi.feature=Gt.feature(Mi),Wt.writeMessage(2,qe,Qi);var nn=Qi.keys;for(Mi=0;Mi<nn.length;Mi++)Wt.writeStringField(3,nn[Mi]);var zn=Qi.values;for(Mi=0;Mi<zn.length;Mi++)Wt.writeMessage(4,Vt,zn[Mi])}function qe(Gt,Wt){var Mi=Gt.feature;Mi.id!==void 0&&Wt.writeVarintField(1,Mi.id),Wt.writeMessage(2,Qe,Gt),Wt.writeVarintField(3,Mi.type),Wt.writeMessage(4,mt,Mi)}function Qe(Gt,Wt){var Mi=Gt.feature,Qi=Gt.keys,nn=Gt.values,zn=Gt.keycache,jn=Gt.valuecache;for(var ar in Mi.properties){var Wn=Mi.properties[ar],Rr=zn[ar];if(Wn!==null){Rr===void 0&&(Qi.push(ar),zn[ar]=Rr=Qi.length-1),Wt.writeVarint(Rr);var Ur=typeof Wn;Ur!=="string"&&Ur!=="boolean"&&Ur!=="number"&&(Wn=JSON.stringify(Wn));var Br=Ur+":"+Wn,sa=jn[Br];sa===void 0&&(nn.push(Wn),jn[Br]=sa=nn.length-1),Wt.writeVarint(sa)}}}function ut(Gt,Wt){return(Wt<<3)+(7&Gt)}function It(Gt){return Gt<<1^Gt>>31}function mt(Gt,Wt){for(var Mi=Gt.loadGeometry(),Qi=Gt.type,nn=0,zn=0,jn=Mi.length,ar=0;ar<jn;ar++){var Wn=Mi[ar],Rr=1;Qi===1&&(Rr=Wn.length),Wt.writeVarint(ut(1,Rr));for(var Ur=Qi===3?Wn.length-1:Wn.length,Br=0;Br<Ur;Br++){Br===1&&Qi!==1&&Wt.writeVarint(ut(2,Ur-1));var sa=Wn[Br].x-nn,Wr=Wn[Br].y-zn;Wt.writeVarint(It(sa)),Wt.writeVarint(It(Wr)),nn+=sa,zn+=Wr}Qi===3&&Wt.writeVarint(ut(7,1))}}function Vt(Gt,Wt){var Mi=typeof Gt;Mi==="string"?Wt.writeStringField(1,Gt):Mi==="boolean"?Wt.writeBooleanField(7,Gt):Mi==="number"&&(Gt%1!=0?Wt.writeDoubleField(3,Gt):Gt<0?Wt.writeSVarintField(6,Gt):Wt.writeVarintField(5,Gt))}return fn.exports=pe,fn.exports.fromVectorTileJs=pe,fn.exports.fromGeojsonVt=function(Gt,Wt){Wt=Wt||{};var Mi={};for(var Qi in Gt)Mi[Qi]=new oe(Gt[Qi].features,Wt),Mi[Qi].name=Qi,Mi[Qi].version=Wt.version,Mi[Qi].extent=Wt.extent;return pe({layers:Mi})},fn.exports.GeoJSONWrapper=oe,fn.exports}(),et=r.e9(vr);const jr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Xt=>Xt},Ra=Math.fround||(ra=new Float32Array(1),Xt=>(ra[0]=+Xt,ra[0]));var ra;const Pi=3,cn=5,Ye=6;class Xe{constructor(oe){this.options=Object.assign(Object.create(jr),oe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(oe){const{log:pe,minZoom:Ce,maxZoom:qe}=this.options;pe&&console.time("total time");const Qe=`prepare ${oe.length} points`;pe&&console.time(Qe),this.points=oe;const ut=[];for(let mt=0;mt<oe.length;mt++){const Vt=oe[mt];if(!Vt.geometry)continue;const[Gt,Wt]=Vt.geometry.coordinates,Mi=Ra(Rt(Gt)),Qi=Ra(Ut(Wt));ut.push(Mi,Qi,1/0,mt,-1,1),this.options.reduce&&ut.push(0)}let It=this.trees[qe+1]=this._createTree(ut);pe&&console.timeEnd(Qe);for(let mt=qe;mt>=Ce;mt--){const Vt=+Date.now();It=this.trees[mt]=this._createTree(this._cluster(It,mt)),pe&&console.log("z%d: %d clusters in %dms",mt,It.numItems,+Date.now()-Vt)}return pe&&console.timeEnd("total time"),this}getClusters(oe,pe){let Ce=((oe[0]+180)%360+360)%360-180;const qe=Math.max(-90,Math.min(90,oe[1]));let Qe=oe[2]===180?180:((oe[2]+180)%360+360)%360-180;const ut=Math.max(-90,Math.min(90,oe[3]));if(oe[2]-oe[0]>=360)Ce=-180,Qe=180;else if(Ce>Qe){const Wt=this.getClusters([Ce,qe,180,ut],pe),Mi=this.getClusters([-180,qe,Qe,ut],pe);return Wt.concat(Mi)}const It=this.trees[this._limitZoom(pe)],mt=It.range(Rt(Ce),Ut(ut),Rt(Qe),Ut(qe)),Vt=It.data,Gt=[];for(const Wt of mt){const Mi=this.stride*Wt;Gt.push(Vt[Mi+cn]>1?ft(Vt,Mi,this.clusterProps):this.points[Vt[Mi+Pi]])}return Gt}getChildren(oe){const pe=this._getOriginId(oe),Ce=this._getOriginZoom(oe),qe="No cluster with the specified id.",Qe=this.trees[Ce];if(!Qe)throw new Error(qe);const ut=Qe.data;if(pe*this.stride>=ut.length)throw new Error(qe);const It=this.options.radius/(this.options.extent*Math.pow(2,Ce-1)),mt=Qe.within(ut[pe*this.stride],ut[pe*this.stride+1],It),Vt=[];for(const Gt of mt){const Wt=Gt*this.stride;ut[Wt+4]===oe&&Vt.push(ut[Wt+cn]>1?ft(ut,Wt,this.clusterProps):this.points[ut[Wt+Pi]])}if(Vt.length===0)throw new Error(qe);return Vt}getLeaves(oe,pe,Ce){const qe=[];return this._appendLeaves(qe,oe,pe=pe||10,Ce=Ce||0,0),qe}getTile(oe,pe,Ce){const qe=this.trees[this._limitZoom(oe)],Qe=Math.pow(2,oe),{extent:ut,radius:It}=this.options,mt=It/ut,Vt=(Ce-mt)/Qe,Gt=(Ce+1+mt)/Qe,Wt={features:[]};return this._addTileFeatures(qe.range((pe-mt)/Qe,Vt,(pe+1+mt)/Qe,Gt),qe.data,pe,Ce,Qe,Wt),pe===0&&this._addTileFeatures(qe.range(1-mt/Qe,Vt,1,Gt),qe.data,Qe,Ce,Qe,Wt),pe===Qe-1&&this._addTileFeatures(qe.range(0,Vt,mt/Qe,Gt),qe.data,-1,Ce,Qe,Wt),Wt.features.length?Wt:null}getClusterExpansionZoom(oe){let pe=this._getOriginZoom(oe)-1;for(;pe<=this.options.maxZoom;){const Ce=this.getChildren(oe);if(pe++,Ce.length!==1)break;oe=Ce[0].properties.cluster_id}return pe}_appendLeaves(oe,pe,Ce,qe,Qe){const ut=this.getChildren(pe);for(const It of ut){const mt=It.properties;if(mt&&mt.cluster?Qe+mt.point_count<=qe?Qe+=mt.point_count:Qe=this._appendLeaves(oe,mt.cluster_id,Ce,qe,Qe):Qe<qe?Qe++:oe.push(It),oe.length===Ce)break}return Qe}_createTree(oe){const pe=new r.bE(oe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ce=0;Ce<oe.length;Ce+=this.stride)pe.add(oe[Ce],oe[Ce+1]);return pe.finish(),pe.data=oe,pe}_addTileFeatures(oe,pe,Ce,qe,Qe,ut){for(const It of oe){const mt=It*this.stride,Vt=pe[mt+cn]>1;let Gt,Wt,Mi;if(Vt)Gt=ct(pe,mt,this.clusterProps),Wt=pe[mt],Mi=pe[mt+1];else{const zn=this.points[pe[mt+Pi]];Gt=zn.properties;const[jn,ar]=zn.geometry.coordinates;Wt=Rt(jn),Mi=Ut(ar)}const Qi={type:1,geometry:[[Math.round(this.options.extent*(Wt*Qe-Ce)),Math.round(this.options.extent*(Mi*Qe-qe))]],tags:Gt};let nn;nn=Vt||this.options.generateId?pe[mt+Pi]:this.points[pe[mt+Pi]].id,nn!==void 0&&(Qi.id=nn),ut.features.push(Qi)}}_limitZoom(oe){return Math.max(this.options.minZoom,Math.min(Math.floor(+oe),this.options.maxZoom+1))}_cluster(oe,pe){const{radius:Ce,extent:qe,reduce:Qe,minPoints:ut}=this.options,It=Ce/(qe*Math.pow(2,pe)),mt=oe.data,Vt=[],Gt=this.stride;for(let Wt=0;Wt<mt.length;Wt+=Gt){if(mt[Wt+2]<=pe)continue;mt[Wt+2]=pe;const Mi=mt[Wt],Qi=mt[Wt+1],nn=oe.within(mt[Wt],mt[Wt+1],It),zn=mt[Wt+cn];let jn=zn;for(const ar of nn){const Wn=ar*Gt;mt[Wn+2]>pe&&(jn+=mt[Wn+cn])}if(jn>zn&&jn>=ut){let ar,Wn=Mi*zn,Rr=Qi*zn,Ur=-1;const Br=(Wt/Gt<<5)+(pe+1)+this.points.length;for(const sa of nn){const Wr=sa*Gt;if(mt[Wr+2]<=pe)continue;mt[Wr+2]=pe;const tr=mt[Wr+cn];Wn+=mt[Wr]*tr,Rr+=mt[Wr+1]*tr,mt[Wr+4]=Br,Qe&&(ar||(ar=this._map(mt,Wt,!0),Ur=this.clusterProps.length,this.clusterProps.push(ar)),Qe(ar,this._map(mt,Wr)))}mt[Wt+4]=Br,Vt.push(Wn/jn,Rr/jn,1/0,Br,-1,jn),Qe&&Vt.push(Ur)}else{for(let ar=0;ar<Gt;ar++)Vt.push(mt[Wt+ar]);if(jn>1)for(const ar of nn){const Wn=ar*Gt;if(!(mt[Wn+2]<=pe)){mt[Wn+2]=pe;for(let Rr=0;Rr<Gt;Rr++)Vt.push(mt[Wn+Rr])}}}}return Vt}_getOriginId(oe){return oe-this.points.length>>5}_getOriginZoom(oe){return(oe-this.points.length)%32}_map(oe,pe,Ce){if(oe[pe+cn]>1){const ut=this.clusterProps[oe[pe+Ye]];return Ce?Object.assign({},ut):ut}const qe=this.points[oe[pe+Pi]].properties,Qe=this.options.map(qe);return Ce&&Qe===qe?Object.assign({},Qe):Qe}}function ft(Xt,oe,pe){return{type:"Feature",id:Xt[oe+Pi],properties:ct(Xt,oe,pe),geometry:{type:"Point",coordinates:[(Ce=Xt[oe],360*(Ce-.5)),li(Xt[oe+1])]}};var Ce}function ct(Xt,oe,pe){const Ce=Xt[oe+cn],qe=Ce>=1e4?`${Math.round(Ce/1e3)}k`:Ce>=1e3?Math.round(Ce/100)/10+"k":Ce,Qe=Xt[oe+Ye],ut=Qe===-1?{}:Object.assign({},pe[Qe]);return Object.assign(ut,{cluster:!0,cluster_id:Xt[oe+Pi],point_count:Ce,point_count_abbreviated:qe})}function Rt(Xt){return Xt/360+.5}function Ut(Xt){const oe=Math.sin(Xt*Math.PI/180),pe=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return pe<0?0:pe>1?1:pe}function li(Xt){const oe=(180-360*Xt)*Math.PI/180;return 360*Math.atan(Math.exp(oe))/Math.PI-90}function $t(Xt,oe,pe,Ce){let qe=Ce;const Qe=oe+(pe-oe>>1);let ut,It=pe-oe;const mt=Xt[oe],Vt=Xt[oe+1],Gt=Xt[pe],Wt=Xt[pe+1];for(let Mi=oe+3;Mi<pe;Mi+=3){const Qi=ii(Xt[Mi],Xt[Mi+1],mt,Vt,Gt,Wt);if(Qi>qe)ut=Mi,qe=Qi;else if(Qi===qe){const nn=Math.abs(Mi-Qe);nn<It&&(ut=Mi,It=nn)}}qe>Ce&&(ut-oe>3&&$t(Xt,oe,ut,Ce),Xt[ut+2]=qe,pe-ut>3&&$t(Xt,ut,pe,Ce))}function ii(Xt,oe,pe,Ce,qe,Qe){let ut=qe-pe,It=Qe-Ce;if(ut!==0||It!==0){const mt=((Xt-pe)*ut+(oe-Ce)*It)/(ut*ut+It*It);mt>1?(pe=qe,Ce=Qe):mt>0&&(pe+=ut*mt,Ce+=It*mt)}return ut=Xt-pe,It=oe-Ce,ut*ut+It*It}function Tn(Xt,oe,pe,Ce){const qe={id:Xt??null,type:oe,geometry:pe,tags:Ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")wn(qe,pe);else if(oe==="Polygon")wn(qe,pe[0]);else if(oe==="MultiLineString")for(const Qe of pe)wn(qe,Qe);else if(oe==="MultiPolygon")for(const Qe of pe)wn(qe,Qe[0]);return qe}function wn(Xt,oe){for(let pe=0;pe<oe.length;pe+=3)Xt.minX=Math.min(Xt.minX,oe[pe]),Xt.minY=Math.min(Xt.minY,oe[pe+1]),Xt.maxX=Math.max(Xt.maxX,oe[pe]),Xt.maxY=Math.max(Xt.maxY,oe[pe+1])}function gr(Xt,oe,pe,Ce){if(!oe.geometry)return;const qe=oe.geometry.coordinates;if(qe&&qe.length===0)return;const Qe=oe.geometry.type,ut=Math.pow(pe.tolerance/((1<<pe.maxZoom)*pe.extent),2);let It=[],mt=oe.id;if(pe.promoteId?mt=oe.properties[pe.promoteId]:pe.generateId&&(mt=Ce||0),Qe==="Point")cr(qe,It);else if(Qe==="MultiPoint")for(const Vt of qe)cr(Vt,It);else if(Qe==="LineString")Sr(qe,It,ut,!1);else if(Qe==="MultiLineString"){if(pe.lineMetrics){for(const Vt of qe)It=[],Sr(Vt,It,ut,!1),Xt.push(Tn(mt,"LineString",It,oe.properties));return}Er(qe,It,ut,!1)}else if(Qe==="Polygon")Er(qe,It,ut,!0);else{if(Qe!=="MultiPolygon"){if(Qe==="GeometryCollection"){for(const Vt of oe.geometry.geometries)gr(Xt,{id:mt,geometry:Vt,properties:oe.properties},pe,Ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Vt of qe){const Gt=[];Er(Vt,Gt,ut,!0),It.push(Gt)}}Xt.push(Tn(mt,Qe,It,oe.properties))}function cr(Xt,oe){oe.push(mr(Xt[0]),Nr(Xt[1]),0)}function Sr(Xt,oe,pe,Ce){let qe,Qe,ut=0;for(let mt=0;mt<Xt.length;mt++){const Vt=mr(Xt[mt][0]),Gt=Nr(Xt[mt][1]);oe.push(Vt,Gt,0),mt>0&&(ut+=Ce?(qe*Gt-Vt*Qe)/2:Math.sqrt(Math.pow(Vt-qe,2)+Math.pow(Gt-Qe,2))),qe=Vt,Qe=Gt}const It=oe.length-3;oe[2]=1,$t(oe,0,It,pe),oe[It+2]=1,oe.size=Math.abs(ut),oe.start=0,oe.end=oe.size}function Er(Xt,oe,pe,Ce){for(let qe=0;qe<Xt.length;qe++){const Qe=[];Sr(Xt[qe],Qe,pe,Ce),oe.push(Qe)}}function mr(Xt){return Xt/360+.5}function Nr(Xt){const oe=Math.sin(Xt*Math.PI/180),pe=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return pe<0?0:pe>1?1:pe}function Ma(Xt,oe,pe,Ce,qe,Qe,ut,It){if(Ce/=oe,Qe>=(pe/=oe)&&ut<Ce)return Xt;if(ut<pe||Qe>=Ce)return null;const mt=[];for(const Vt of Xt){const Gt=Vt.geometry;let Wt=Vt.type;const Mi=qe===0?Vt.minX:Vt.minY,Qi=qe===0?Vt.maxX:Vt.maxY;if(Mi>=pe&&Qi<Ce){mt.push(Vt);continue}if(Qi<pe||Mi>=Ce)continue;let nn=[];if(Wt==="Point"||Wt==="MultiPoint")ga(Gt,nn,pe,Ce,qe);else if(Wt==="LineString")oo(Gt,nn,pe,Ce,qe,!1,It.lineMetrics);else if(Wt==="MultiLineString")dn(Gt,nn,pe,Ce,qe,!1);else if(Wt==="Polygon")dn(Gt,nn,pe,Ce,qe,!0);else if(Wt==="MultiPolygon")for(const zn of Gt){const jn=[];dn(zn,jn,pe,Ce,qe,!0),jn.length&&nn.push(jn)}if(nn.length){if(It.lineMetrics&&Wt==="LineString"){for(const zn of nn)mt.push(Tn(Vt.id,Wt,zn,Vt.tags));continue}Wt!=="LineString"&&Wt!=="MultiLineString"||(nn.length===1?(Wt="LineString",nn=nn[0]):Wt="MultiLineString"),Wt!=="Point"&&Wt!=="MultiPoint"||(Wt=nn.length===3?"Point":"MultiPoint"),mt.push(Tn(Vt.id,Wt,nn,Vt.tags))}}return mt.length?mt:null}function ga(Xt,oe,pe,Ce,qe){for(let Qe=0;Qe<Xt.length;Qe+=3){const ut=Xt[Qe+qe];ut>=pe&&ut<=Ce&&Xn(oe,Xt[Qe],Xt[Qe+1],Xt[Qe+2])}}function oo(Xt,oe,pe,Ce,qe,Qe,ut){let It=$a(Xt);const mt=qe===0?Qa:lo;let Vt,Gt,Wt=Xt.start;for(let jn=0;jn<Xt.length-3;jn+=3){const ar=Xt[jn],Wn=Xt[jn+1],Rr=Xt[jn+2],Ur=Xt[jn+3],Br=Xt[jn+4],sa=qe===0?ar:Wn,Wr=qe===0?Ur:Br;let tr=!1;ut&&(Vt=Math.sqrt(Math.pow(ar-Ur,2)+Math.pow(Wn-Br,2))),sa<pe?Wr>pe&&(Gt=mt(It,ar,Wn,Ur,Br,pe),ut&&(It.start=Wt+Vt*Gt)):sa>Ce?Wr<Ce&&(Gt=mt(It,ar,Wn,Ur,Br,Ce),ut&&(It.start=Wt+Vt*Gt)):Xn(It,ar,Wn,Rr),Wr<pe&&sa>=pe&&(Gt=mt(It,ar,Wn,Ur,Br,pe),tr=!0),Wr>Ce&&sa<=Ce&&(Gt=mt(It,ar,Wn,Ur,Br,Ce),tr=!0),!Qe&&tr&&(ut&&(It.end=Wt+Vt*Gt),oe.push(It),It=$a(Xt)),ut&&(Wt+=Vt)}let Mi=Xt.length-3;const Qi=Xt[Mi],nn=Xt[Mi+1],zn=qe===0?Qi:nn;zn>=pe&&zn<=Ce&&Xn(It,Qi,nn,Xt[Mi+2]),Mi=It.length-3,Qe&&Mi>=3&&(It[Mi]!==It[0]||It[Mi+1]!==It[1])&&Xn(It,It[0],It[1],It[2]),It.length&&oe.push(It)}function $a(Xt){const oe=[];return oe.size=Xt.size,oe.start=Xt.start,oe.end=Xt.end,oe}function dn(Xt,oe,pe,Ce,qe,Qe){for(const ut of Xt)oo(ut,oe,pe,Ce,qe,Qe,!1)}function Xn(Xt,oe,pe,Ce){Xt.push(oe,pe,Ce)}function Qa(Xt,oe,pe,Ce,qe,Qe){const ut=(Qe-oe)/(Ce-oe);return Xn(Xt,Qe,pe+(qe-pe)*ut,1),ut}function lo(Xt,oe,pe,Ce,qe,Qe){const ut=(Qe-pe)/(qe-pe);return Xn(Xt,oe+(Ce-oe)*ut,Qe,1),ut}function Us(Xt,oe){const pe=[];for(let Ce=0;Ce<Xt.length;Ce++){const qe=Xt[Ce],Qe=qe.type;let ut;if(Qe==="Point"||Qe==="MultiPoint"||Qe==="LineString")ut=Ca(qe.geometry,oe);else if(Qe==="MultiLineString"||Qe==="Polygon"){ut=[];for(const It of qe.geometry)ut.push(Ca(It,oe))}else if(Qe==="MultiPolygon"){ut=[];for(const It of qe.geometry){const mt=[];for(const Vt of It)mt.push(Ca(Vt,oe));ut.push(mt)}}pe.push(Tn(qe.id,Qe,ut,qe.tags))}return pe}function Ca(Xt,oe){const pe=[];pe.size=Xt.size,Xt.start!==void 0&&(pe.start=Xt.start,pe.end=Xt.end);for(let Ce=0;Ce<Xt.length;Ce+=3)pe.push(Xt[Ce]+oe,Xt[Ce+1],Xt[Ce+2]);return pe}function ja(Xt,oe){if(Xt.transformed)return Xt;const pe=1<<Xt.z,Ce=Xt.x,qe=Xt.y;for(const Qe of Xt.features){const ut=Qe.geometry,It=Qe.type;if(Qe.geometry=[],It===1)for(let mt=0;mt<ut.length;mt+=2)Qe.geometry.push(qr(ut[mt],ut[mt+1],oe,pe,Ce,qe));else for(let mt=0;mt<ut.length;mt++){const Vt=[];for(let Gt=0;Gt<ut[mt].length;Gt+=2)Vt.push(qr(ut[mt][Gt],ut[mt][Gt+1],oe,pe,Ce,qe));Qe.geometry.push(Vt)}}return Xt.transformed=!0,Xt}function qr(Xt,oe,pe,Ce,qe,Qe){return[Math.round(pe*(Xt*Ce-qe)),Math.round(pe*(oe*Ce-Qe))]}function gs(Xt,oe,pe,Ce,qe){const Qe=oe===qe.maxZoom?0:qe.tolerance/((1<<oe)*qe.extent),ut={features:[],numPoints:0,numSimplified:0,numFeatures:Xt.length,source:null,x:pe,y:Ce,z:oe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const It of Xt)$s(ut,It,Qe,qe);return ut}function $s(Xt,oe,pe,Ce){const qe=oe.geometry,Qe=oe.type,ut=[];if(Xt.minX=Math.min(Xt.minX,oe.minX),Xt.minY=Math.min(Xt.minY,oe.minY),Xt.maxX=Math.max(Xt.maxX,oe.maxX),Xt.maxY=Math.max(Xt.maxY,oe.maxY),Qe==="Point"||Qe==="MultiPoint")for(let It=0;It<qe.length;It+=3)ut.push(qe[It],qe[It+1]),Xt.numPoints++,Xt.numSimplified++;else if(Qe==="LineString")Lo(ut,qe,Xt,pe,!1,!1);else if(Qe==="MultiLineString"||Qe==="Polygon")for(let It=0;It<qe.length;It++)Lo(ut,qe[It],Xt,pe,Qe==="Polygon",It===0);else if(Qe==="MultiPolygon")for(let It=0;It<qe.length;It++){const mt=qe[It];for(let Vt=0;Vt<mt.length;Vt++)Lo(ut,mt[Vt],Xt,pe,!0,Vt===0)}if(ut.length){let It=oe.tags||null;if(Qe==="LineString"&&Ce.lineMetrics){It={};for(const Vt in oe.tags)It[Vt]=oe.tags[Vt];It.mapbox_clip_start=qe.start/qe.size,It.mapbox_clip_end=qe.end/qe.size}const mt={geometry:ut,type:Qe==="Polygon"||Qe==="MultiPolygon"?3:Qe==="LineString"||Qe==="MultiLineString"?2:1,tags:It};oe.id!==null&&(mt.id=oe.id),Xt.features.push(mt)}}function Lo(Xt,oe,pe,Ce,qe,Qe){const ut=Ce*Ce;if(Ce>0&&oe.size<(qe?ut:Ce))return void(pe.numPoints+=oe.length/3);const It=[];for(let mt=0;mt<oe.length;mt+=3)(Ce===0||oe[mt+2]>ut)&&(pe.numSimplified++,It.push(oe[mt],oe[mt+1])),pe.numPoints++;qe&&function(mt,Vt){let Gt=0;for(let Wt=0,Mi=mt.length,Qi=Mi-2;Wt<Mi;Qi=Wt,Wt+=2)Gt+=(mt[Wt]-mt[Qi])*(mt[Wt+1]+mt[Qi+1]);if(Gt>0===Vt)for(let Wt=0,Mi=mt.length;Wt<Mi/2;Wt+=2){const Qi=mt[Wt],nn=mt[Wt+1];mt[Wt]=mt[Mi-2-Wt],mt[Wt+1]=mt[Mi-1-Wt],mt[Mi-2-Wt]=Qi,mt[Mi-1-Wt]=nn}}(It,Qe),Xt.push(It)}const Ls={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ht{constructor(oe,pe){const Ce=(pe=this.options=function(Qe,ut){for(const It in ut)Qe[It]=ut[It];return Qe}(Object.create(Ls),pe)).debug;if(Ce&&console.time("preprocess data"),pe.maxZoom<0||pe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(pe.promoteId&&pe.generateId)throw new Error("promoteId and generateId cannot be used together.");let qe=function(Qe,ut){const It=[];if(Qe.type==="FeatureCollection")for(let mt=0;mt<Qe.features.length;mt++)gr(It,Qe.features[mt],ut,mt);else gr(It,Qe.type==="Feature"?Qe:{geometry:Qe},ut);return It}(oe,pe);this.tiles={},this.tileCoords=[],Ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",pe.indexMaxZoom,pe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),qe=function(Qe,ut){const It=ut.buffer/ut.extent;let mt=Qe;const Vt=Ma(Qe,1,-1-It,It,0,-1,2,ut),Gt=Ma(Qe,1,1-It,2+It,0,-1,2,ut);return(Vt||Gt)&&(mt=Ma(Qe,1,-It,1+It,0,-1,2,ut)||[],Vt&&(mt=Us(Vt,1).concat(mt)),Gt&&(mt=mt.concat(Us(Gt,-1)))),mt}(qe,pe),qe.length&&this.splitTile(qe,0,0,0),Ce&&(qe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(oe,pe,Ce,qe,Qe,ut,It){const mt=[oe,pe,Ce,qe],Vt=this.options,Gt=Vt.debug;for(;mt.length;){qe=mt.pop(),Ce=mt.pop(),pe=mt.pop(),oe=mt.pop();const Wt=1<<pe,Mi=es(pe,Ce,qe);let Qi=this.tiles[Mi];if(!Qi&&(Gt>1&&console.time("creation"),Qi=this.tiles[Mi]=gs(oe,pe,Ce,qe,Vt),this.tileCoords.push({z:pe,x:Ce,y:qe}),Gt)){Gt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",pe,Ce,qe,Qi.numFeatures,Qi.numPoints,Qi.numSimplified),console.timeEnd("creation"));const tr=`z${pe}`;this.stats[tr]=(this.stats[tr]||0)+1,this.total++}if(Qi.source=oe,Qe==null){if(pe===Vt.indexMaxZoom||Qi.numPoints<=Vt.indexMaxPoints)continue}else{if(pe===Vt.maxZoom||pe===Qe)continue;if(Qe!=null){const tr=Qe-pe;if(Ce!==ut>>tr||qe!==It>>tr)continue}}if(Qi.source=null,oe.length===0)continue;Gt>1&&console.time("clipping");const nn=.5*Vt.buffer/Vt.extent,zn=.5-nn,jn=.5+nn,ar=1+nn;let Wn=null,Rr=null,Ur=null,Br=null,sa=Ma(oe,Wt,Ce-nn,Ce+jn,0,Qi.minX,Qi.maxX,Vt),Wr=Ma(oe,Wt,Ce+zn,Ce+ar,0,Qi.minX,Qi.maxX,Vt);oe=null,sa&&(Wn=Ma(sa,Wt,qe-nn,qe+jn,1,Qi.minY,Qi.maxY,Vt),Rr=Ma(sa,Wt,qe+zn,qe+ar,1,Qi.minY,Qi.maxY,Vt),sa=null),Wr&&(Ur=Ma(Wr,Wt,qe-nn,qe+jn,1,Qi.minY,Qi.maxY,Vt),Br=Ma(Wr,Wt,qe+zn,qe+ar,1,Qi.minY,Qi.maxY,Vt),Wr=null),Gt>1&&console.timeEnd("clipping"),mt.push(Wn||[],pe+1,2*Ce,2*qe),mt.push(Rr||[],pe+1,2*Ce,2*qe+1),mt.push(Ur||[],pe+1,2*Ce+1,2*qe),mt.push(Br||[],pe+1,2*Ce+1,2*qe+1)}}getTile(oe,pe,Ce){oe=+oe,pe=+pe,Ce=+Ce;const qe=this.options,{extent:Qe,debug:ut}=qe;if(oe<0||oe>24)return null;const It=1<<oe,mt=es(oe,pe=pe+It&It-1,Ce);if(this.tiles[mt])return ja(this.tiles[mt],Qe);ut>1&&console.log("drilling down to z%d-%d-%d",oe,pe,Ce);let Vt,Gt=oe,Wt=pe,Mi=Ce;for(;!Vt&&Gt>0;)Gt--,Wt>>=1,Mi>>=1,Vt=this.tiles[es(Gt,Wt,Mi)];return Vt&&Vt.source?(ut>1&&(console.log("found parent tile z%d-%d-%d",Gt,Wt,Mi),console.time("drilling down")),this.splitTile(Vt.source,Gt,Wt,Mi,oe,pe,Ce),ut>1&&console.timeEnd("drilling down"),this.tiles[mt]?ja(this.tiles[mt],Qe):null):null}}function es(Xt,oe,pe){return 32*((1<<Xt)*pe+oe)+Xt}function Ks(Xt,oe){const pe=Xt.tileID.canonical;if(!this._geoJSONIndex)return void oe(null,null);const Ce=this._geoJSONIndex.getTile(pe.z,pe.x,pe.y);if(!Ce)return void oe(null,null);const qe=new vi(Ce.features);let Qe=et(qe);Qe.byteOffset===0&&Qe.byteLength===Qe.buffer.byteLength||(Qe=new Uint8Array(Qe)),oe(null,{vectorTile:qe,rawData:Qe.buffer})}class Js extends Fi{constructor(oe,pe,Ce,qe,Qe,ut){super(oe,pe,Ce,qe,Ks,ut),Qe&&(this.loadGeoJSON=Qe),this._dynamicIndex=new Te}loadData(oe,pe){const Ce=oe&&oe.request,qe=Ce&&Ce.collectResourceTiming;this.loadGeoJSON(oe,(Qe,ut)=>{if(Qe||!ut)return pe(Qe);if(typeof ut!="object")return pe(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`));{try{if(oe.filter){const mt=r.U(oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(mt.result==="error")throw new Error(mt.value.map(Vt=>`${Vt.key}: ${Vt.message}`).join(", "));ut.features=ut.features.filter(Vt=>mt.value.evaluate({zoom:0},Vt))}oe.dynamic?(ut.type==="Feature"&&(ut={type:"FeatureCollection",features:[ut]}),oe.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(ut.features,this.loaded),oe.cluster&&(ut.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=oe.cluster?new Xe(function({superclusterOptions:mt,clusterProperties:Vt}){if(!Vt||!mt)return mt;const Gt={},Wt={},Mi={accumulated:null,zoom:0},Qi={properties:null},nn=Object.keys(Vt);for(const zn of nn){const[jn,ar]=Vt[zn],Wn=r.U(ar),Rr=r.U(typeof jn=="string"?[jn,["accumulated"],["get",zn]]:jn);Gt[zn]=Wn.value,Wt[zn]=Rr.value}return mt.map=zn=>{Qi.properties=zn;const jn={};for(const ar of nn)jn[ar]=Gt[ar].evaluate(Mi,Qi);return jn},mt.reduce=(zn,jn)=>{Qi.properties=jn;for(const ar of nn)Mi.accumulated=zn[ar],zn[ar]=Wt[ar].evaluate(Mi,Qi)},mt}(oe)).load(ut.features):oe.dynamic?this._dynamicIndex:function(mt,Vt){return new ht(mt,Vt)}(ut,oe.geojsonVtOptions)}catch(mt){return pe(mt)}const It={};if(qe){const mt=Ge(Ce);mt&&(It.resourceTiming={},It.resourceTiming[oe.source]=JSON.parse(JSON.stringify(mt)))}pe(null,It)}})}reloadTile(oe,pe){const Ce=this.loaded;return Ce&&Ce[oe.uid]?oe.partial?pe(null,void 0):super.reloadTile(oe,pe):this.loadTile(oe,pe)}loadGeoJSON(oe,pe){if(oe.request)r.n(oe.request,pe);else{if(typeof oe.data!="string")return pe(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`));try{return pe(null,JSON.parse(oe.data))}catch{return pe(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(oe,pe){try{pe(null,this._geoJSONIndex.getClusterExpansionZoom(oe.clusterId))}catch(Ce){pe(Ce)}}getClusterChildren(oe,pe){try{pe(null,this._geoJSONIndex.getChildren(oe.clusterId))}catch(Ce){pe(Ce)}}getClusterLeaves(oe,pe){try{pe(null,this._geoJSONIndex.getLeaves(oe.clusterId,oe.limit,oe.offset))}catch(Ce){pe(Ce)}}}class Ro{constructor(oe,pe){this.tileID=new r.aG(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.tileZoom=oe.tileZoom,this.uid=oe.uid,this.zoom=oe.zoom,this.canonical=oe.tileID.canonical,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=oe.projection,this.brightness=pe}parse(oe,pe,Ce,qe){this.status="parsing";const Qe=new r.aG(Ce.tileID.overscaledZ,Ce.tileID.wrap,Ce.tileID.canonical.z,Ce.tileID.canonical.x,Ce.tileID.canonical.y),ut=[],It=pe.familiesBySource[Ce.source],mt=new r.d$(Qe,Ce.promoteId);return mt.bucketLayerIDs=[],mt.is3DTile=!0,r.ea(oe).then(Vt=>{if(!Vt)return qe(new Error("Could not parse tile"));const Gt=r.eb(Vt,1/r.cc(Ce.tileID.canonical)),Wt=Vt.json.extensionsUsed&&Vt.json.extensionsUsed.includes("MAPBOX_mesh_features")||Vt.json.asset.extras&&Vt.json.asset.extras.MAPBOX_mesh_features,Mi=Vt.json.extensionsUsed&&Vt.json.extensionsUsed.includes("EXT_meshopt_compression"),Qi=new r.a8(this.zoom,{brightness:this.brightness});for(const nn in It)for(const zn of It[nn]){const jn=zn[0];mt.bucketLayerIDs.push(zn.map(Wn=>r.aC(Wn.id,Wn.scope))),jn.recalculate(Qi,[]);const ar=new r.ec(zn,Gt,Qe,Wt,Mi,this.brightness,mt);Wt||(ar.needsUpload=!0),ut.push(ar),ar.evaluate(jn)}this.status="done",qe(null,{buckets:ut,featureIndex:mt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Vt=>qe(new Error(Vt.message)))}}class xs{constructor(oe,pe,Ce,qe,Qe,ut){this.actor=oe,this.layerIndex=pe,this.availableImages=Ce,this.brightness=ut,this.loading={},this.loaded={}}loadTile(oe,pe){const Ce=oe.uid,qe=this.loading[Ce]=new Ro(oe,this.brightness);r.bi(oe.request,(Qe,ut)=>{const It=!this.loading[Ce];return delete this.loading[Ce],It||Qe?(qe.status="done",It||(this.loaded[Ce]=qe),pe(Qe)):ut&&ut.byteLength!==0?void qe.parse(ut,this.layerIndex,oe,(mt,Vt)=>{qe.status="done",this.loaded=this.loaded||{},this.loaded[Ce]=qe,mt||!Vt?pe(mt):pe(null,Vt)}):(qe.status="done",this.loaded[Ce]=qe,pe())})}reloadTile(oe,pe){const Ce=this.loaded,qe=oe.uid;if(Ce&&Ce[qe]){const Qe=Ce[qe];Qe.projection=oe.projection,Qe.brightness=oe.brightness;const ut=(It,mt)=>{Qe.reloadCallback&&(delete Qe.reloadCallback,this.loadTile(oe,pe)),pe(It,mt)};Qe.status==="parsing"?Qe.reloadCallback=ut:Qe.status==="done"&&this.loadTile(oe,pe)}}abortTile(oe,pe){const Ce=oe.uid;this.loading[Ce]&&delete this.loading[Ce],pe()}removeTile(oe,pe){const Ce=this.loaded,qe=oe.uid;Ce&&Ce[qe]&&delete Ce[qe],pe()}}class Io{constructor(oe){this.self=oe,this.actor=new r.ed(oe,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new r.I,this.projections={},this.defaultProjection=r.bP({name:"mercator"}),this.workerSourceTypes={vector:Fi,geojson:Js,"batched-model":xs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(pe,Ce)=>{if(this.workerSourceTypes[pe])throw new Error(`Worker source with name "${pe}" already registered.`);this.workerSourceTypes[pe]=Ce},this.self.registerRTLTextPlugin=pe=>{if(r.ee.isParsed())throw new Error("RTL text plugin already registered.");r.ee.applyArabicShaping=pe.applyArabicShaping,r.ee.processBidirectionalText=pe.processBidirectionalText,r.ee.processStyledBidirectionalText=pe.processStyledBidirectionalText}}clearCaches(oe,pe,Ce){delete this.layerIndexes[oe],delete this.availableImages[oe],delete this.workerSources[oe],delete this.demWorkerSources[oe],delete this.rasterArrayWorkerSource,Ce()}checkIfReady(oe,pe,Ce){Ce()}setReferrer(oe,pe){this.referrer=pe}spriteLoaded(oe,{scope:pe,isLoaded:Ce}){if(this.isSpriteLoaded[oe]||(this.isSpriteLoaded[oe]={}),this.isSpriteLoaded[oe][pe]=Ce,this.workerSources[oe]&&this.workerSources[oe][pe])for(const qe in this.workerSources[oe][pe]){const Qe=this.workerSources[oe][pe][qe];for(const ut in Qe){const It=Qe[ut];It instanceof Fi&&(It.isSpriteLoaded=Ce,It.fire(new r.z("isSpriteLoaded")))}}}setImages(oe,{scope:pe,images:Ce},qe){if(this.availableImages[oe]||(this.availableImages[oe]={}),this.availableImages[oe][pe]=Ce,this.workerSources[oe]&&this.workerSources[oe][pe]){for(const Qe in this.workerSources[oe][pe]){const ut=this.workerSources[oe][pe][Qe];for(const It in ut)ut[It].availableImages=Ce}qe()}else qe()}setProjection(oe,pe){this.projections[oe]=r.bP(pe)}setBrightness(oe,pe,Ce){this.brightness=pe,Ce()}setLayers(oe,pe,Ce){this.getLayerIndex(oe,pe.scope).replace(pe.layers,pe.options),Ce()}updateLayers(oe,pe,Ce){this.getLayerIndex(oe,pe.scope).update(pe.layers,pe.removedIds,pe.options),Ce()}loadTile(oe,pe,Ce){pe.projection=this.projections[oe]||this.defaultProjection,this.getWorkerSource(oe,pe.type,pe.source,pe.scope).loadTile(pe,Ce)}loadDEMTile(oe,pe,Ce){this.getDEMWorkerSource(oe,pe.source,pe.scope).loadTile(pe,Ce)}decodeRasterArray(oe,pe,Ce){this.getRasterArrayWorkerSource().decodeRasterArray(pe,Ce)}reloadTile(oe,pe,Ce){pe.projection=this.projections[oe]||this.defaultProjection,this.getWorkerSource(oe,pe.type,pe.source,pe.scope).reloadTile(pe,Ce)}abortTile(oe,pe,Ce){this.getWorkerSource(oe,pe.type,pe.source,pe.scope).abortTile(pe,Ce)}removeTile(oe,pe,Ce){this.getWorkerSource(oe,pe.type,pe.source,pe.scope).removeTile(pe,Ce)}removeSource(oe,pe,Ce){if(!(this.workerSources[oe]&&this.workerSources[oe][pe.scope]&&this.workerSources[oe][pe.scope][pe.type]&&this.workerSources[oe][pe.scope][pe.type][pe.source]))return;const qe=this.workerSources[oe][pe.scope][pe.type][pe.source];delete this.workerSources[oe][pe.scope][pe.type][pe.source],qe.removeSource!==void 0?qe.removeSource(pe,Ce):Ce()}loadWorkerSource(oe,pe,Ce){try{this.self.importScripts(pe.url),Ce()}catch(qe){Ce(qe.toString())}}syncRTLPluginState(oe,pe,Ce){try{r.ee.setState(pe);const qe=r.ee.getPluginURL();if(r.ee.isLoaded()&&!r.ee.isParsed()&&qe!=null){this.self.importScripts(qe);const Qe=r.ee.isParsed();Ce(Qe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${qe}`),Qe)}}catch(qe){Ce(qe.toString())}}setDracoUrl(oe,pe){this.dracoUrl=pe}getAvailableImages(oe,pe){this.availableImages[oe]||(this.availableImages[oe]={});let Ce=this.availableImages[oe][pe];return Ce||(Ce=[]),Ce}getLayerIndex(oe,pe){this.layerIndexes[oe]||(this.layerIndexes[oe]={});let Ce=this.layerIndexes[oe][pe];return Ce||(Ce=this.layerIndexes[oe][pe]=new rt,Ce.scope=pe),Ce}getWorkerSource(oe,pe,Ce,qe){return this.workerSources[oe]||(this.workerSources[oe]={}),this.workerSources[oe][qe]||(this.workerSources[oe][qe]={}),this.workerSources[oe][qe][pe]||(this.workerSources[oe][qe][pe]={}),this.isSpriteLoaded[oe]||(this.isSpriteLoaded[oe]={}),this.workerSources[oe][qe][pe][Ce]||(this.workerSources[oe][qe][pe][Ce]=new this.workerSourceTypes[pe]({send:(Qe,ut,It,mt,Vt,Gt)=>{this.actor.send(Qe,ut,It,oe,Vt,Gt)},scheduler:this.actor.scheduler},this.getLayerIndex(oe,qe),this.getAvailableImages(oe,qe),this.isSpriteLoaded[oe][qe],void 0,this.brightness)),this.workerSources[oe][qe][pe][Ce]}rasterizeImages(oe,pe,Ce){const{imageTasks:qe,scope:Qe}=pe,ut={};for(const It in qe){const{image:mt,imageIdWithOptions:Vt}=qe[It];ut[It]=this.imageRasterizer.rasterize(Vt,mt,Qe,oe)}Ce(void 0,ut)}removeRasterizedImages(oe,pe,Ce){const{imageIds:qe,scope:Qe}=pe;this.imageRasterizer.removeImagesFromCacheByIds(qe,Qe,oe),Ce()}getDEMWorkerSource(oe,pe,Ce){return this.demWorkerSources[oe]||(this.demWorkerSources[oe]={}),this.demWorkerSources[oe][Ce]||(this.demWorkerSources[oe][Ce]={}),this.demWorkerSources[oe][Ce][pe]||(this.demWorkerSources[oe][Ce][pe]=new oi),this.demWorkerSources[oe][Ce][pe]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Ci),this.rasterArrayWorkerSource}enforceCacheSizeLimit(oe,pe){r.ef(pe)}getWorkerPerformanceMetrics(oe,pe,Ce){Ce(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Io(self)),Io}),ei(["./shared"],function(r){var Ge="3.10.0";const de={create:"create",load:"load",fullLoad:"fullLoad"},Je={mark(d){performance.mark(d)},measure(d,i,a){performance.measure(d,i,a)}};function rt(d){const i=d.name.split("?")[0];return r.a(i)&&i.includes("mapbox-gl.js")?"javascript":r.a(i)&&i.includes("mapbox-gl.css")?"css":r.b(i)?"fontRange":r.c(i)?"sprite":r.i(i)?"style":r.d(i)?"tilejson":"other"}var ai,bi={},Ai=function(){if(ai)return bi;function d(f){return!i(f)}function i(f){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,T,I=new Blob([""],{type:"text/javascript"}),F=URL.createObjectURL(I);try{T=new Worker(F),x=!0}catch{x=!1}return T&&T.terminate(),URL.revokeObjectURL(F),x}()?function(){var x=document.createElement("canvas");x.width=x.height=1;var T=x.getContext("2d");if(!T)return!1;var I=T.getImageData(0,0,1,1);return I&&I.width===x.width}()?(a[v=f&&f.failIfMajorPerformanceCaveat]===void 0&&(a[v]=function(x){var T,I=function(F){var V=document.createElement("canvas"),j=Object.create(d.webGLContextAttributes);return j.failIfMajorPerformanceCaveat=F,V.getContext("webgl2",j)}(x);if(!I)return!1;try{T=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!T||I.isContextLost())&&(I.shaderSource(T,"void main() {}"),I.compileShader(T),I.getShaderParameter(T,I.COMPILE_STATUS)===!0)}(v)),a[v]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var v}ai=1,bi.supported=d,bi.notSupportedReason=i;var a={};return d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},bi}();function qt(d,i,a){const f=document.createElement(d);return i!=null&&(f.className=i),a&&a.appendChild(f),f}function xi(d,i,a){const f=document.createElementNS("http://www.w3.org/2000/svg",d);for(const v of Object.keys(i))f.setAttributeNS(null,v,String(i[v]));return a&&a.appendChild(f),f}const kt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Tt=kt&&kt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ln;function Xi(){kt&&Tt&&(ln=kt[Tt],kt[Tt]="none")}function Dt(){kt&&Tt&&(kt[Tt]=ln)}function ni(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",ni,!0)}function ci(){window.addEventListener("click",ni,!0),window.setTimeout(()=>{window.removeEventListener("click",ni,!0)},0)}function Nn(d,i){const a=d.getBoundingClientRect();return Ci(d,a,i)}function Fi(d,i){const a=d.getBoundingClientRect(),f=[];for(let v=0;v<i.length;v++)f.push(Ci(d,a,i[v]));return f}function oi(d){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&d.button===2&&d.ctrlKey?0:d.button}function Ci(d,i,a){const f=d.offsetWidth===i.width?1:d.offsetWidth/i.width;return new r.P((a.clientX-i.left)*f,(a.clientY-i.top)*f)}const Zt="01",Yt="NO_ACCESS_TOKEN";class vi{constructor(i,a,f){this._transformRequestFn=i,this._customAccessToken=a,this._silenceAuthErrors=!!f,this._createSkuToken()}_createSkuToken(){const i=function(){let a="";for(let f=0;f<10;f++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Zt,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,a){return this._transformRequestFn&&this._transformRequestFn(i,a)||{url:i}}normalizeStyleURL(i,a){if(!r.f(i))return i;const f=ge(i);return f.params.push(`sdk=js-${Ge}`),f.path=`/styles/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||a)}normalizeGlyphsURL(i,a){if(!r.f(i))return i;const f=ge(i);return f.path=`/fonts/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||a)}normalizeModelURL(i,a){if(!r.f(i))return i;const f=ge(i);return f.path=`/models/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||a)}normalizeSourceURL(i,a,f,v){if(!r.f(i))return i;const x=ge(i);return x.path=`/v4/${x.authority}.json`,x.params.push("secure"),f&&x.params.push(`language=${f}`),v&&x.params.push(`worldview=${v}`),this._makeAPIURL(x,this._customAccessToken||a)}normalizeIconsetURL(i,a){const f=ge(i);return r.f(i)?(f.path=`/styles/v1${f.path}/iconset.pbf`,this._makeAPIURL(f,this._customAccessToken||a)):Te(f)}normalizeSpriteURL(i,a,f,v){const x=ge(i);return r.f(i)?(x.path=`/styles/v1${x.path}/sprite${a}${f}`,this._makeAPIURL(x,this._customAccessToken||v)):(x.path+=`${a}${f}`,Te(x))}normalizeTileURL(i,a,f){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!r.f(i))return i;const v=ge(i);v.path=v.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||f&&v.authority!=="raster"&&f===512?"@2x":""}${r.m.supported?".webp":"$1"}`),v.authority==="raster"?v.path=`/${r.e.RASTER_URL_PREFIX}${v.path}`:v.authority==="rasterarrays"?v.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${v.path}`:v.authority==="3dtiles"?v.path=`/${r.e.TILES3D_URL_PREFIX}${v.path}`:(v.path=v.path.replace(/^.+\/v4\//,"/"),v.path=`/${r.e.TILE_URL_VERSION}${v.path}`);const x=this._customAccessToken||function(T){for(const I of T){const F=I.match(/^access_token=(.*)$/);if(F)return F[1]}return null}(v.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&v.params.push(`sku=${this._skuToken}`),this._makeAPIURL(v,x)}canonicalizeTileURL(i,a){const f=ge(i);if(!f.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!f.path.match(/\.[\w]+$/))return i;let v="mapbox://";f.path.match(/^\/raster\/v1\//)?v+=`raster/${f.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:f.path.match(/^\/rasterarrays\/v1\//)?v+=`rasterarrays/${f.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:v+=`tiles/${f.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let x=f.params;return a&&(x=x.filter(T=>!T.match(/^access_token=/))),x.length&&(v+=`?${x.join("&")}`),v}canonicalizeTileset(i,a){const f=!!a&&r.f(a),v=[];for(const x of i.tiles||[])r.h(x)?v.push(this.canonicalizeTileURL(x,f)):v.push(x);return v}_makeAPIURL(i,a){const f="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",v=ge(r.e.API_URL);if(i.protocol=v.protocol,i.authority=v.authority,i.protocol==="http"){const x=i.params.indexOf("secure");x>=0&&i.params.splice(x,1)}if(v.path!=="/"&&(i.path=`${v.path}${i.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return Te(i);if(a=a||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${f}`);if(a[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${f}`)}return i.params=i.params.filter(x=>x.indexOf("access_token")===-1),i.params.push(`access_token=${a||""}`),Te(i)}}const ae=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ge(d){const i=d.match(ae);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function Te(d){const i=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${i}`}const Re="mapbox.eventData";function ze(d){if(!d)return null;const i=d.split(".");if(!i||i.length!==3)return null;try{return JSON.parse(r.j(i[1]))}catch{return null}}class Ie{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const a=ze(r.e.ACCESS_TOKEN);let f="";return f=a&&a.u?r.k(a.u):r.e.ACCESS_TOKEN||"",i?`${Re}.${i}:${f}`:`${Re}:${f}`}fetchEventData(){const i=r.s("localStorage"),a=this.getStorageKey(),f=this.getStorageKey("uuid");if(i)try{const v=localStorage.getItem(a);v&&(this.eventData=JSON.parse(v));const x=localStorage.getItem(f);x&&(this.anonId=x)}catch{r.w("Unable to read from LocalStorage")}}saveEventData(){const i=r.s("localStorage"),a=this.getStorageKey(),f=this.getStorageKey("uuid"),v=this.anonId;if(i&&v)try{localStorage.setItem(f,v),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData))}catch{r.w("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,a,f,v){if(!r.e.EVENTS_URL)return;const x=ge(r.e.EVENTS_URL);x.params.push(`access_token=${v||r.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(i).toISOString()},I=a?r.l(T,a):T,F={url:Te(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=r.p(F,V=>{this.pendingRequest=null,f(V),this.saveEventData(),this.processRequests(v)})}queueRequest(i,a){this.queue.push(i),this.processRequests(a)}}const it=new class extends Ie{constructor(d){super("appUserTurnstile"),this._customAccessToken=d}postTurnstileEvent(d,i){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(d)&&d.some(a=>r.f(a)||r.h(a))&&this.queueRequest(Date.now(),i)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=ze(r.e.ACCESS_TOKEN),a=i?i.u:r.e.ACCESS_TOKEN;let f=a!==this.eventData.tokenU;r.v(this.anonId)||(this.anonId=r.u(),f=!0);const v=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),T=new Date(v),I=(v-this.eventData.lastSuccess)/864e5;f=f||I>=1||I<-1||x.getDate()!==T.getDate()}else f=!0;f?this.postEvent(v,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ge,skuId:Zt,"enabled.telemetry":!1,userId:this.anonId},x=>{x||(this.eventData.lastSuccess=v,this.eventData.tokenU=a)},d):this.processRequests()}},vt=it.postTurnstileEvent.bind(it),bt=new class extends Ie{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(d,i,a,f){this.skuToken=i,this.errorCb=f,r.e.EVENTS_URL&&(a||r.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},a):this.errorCb(new Error(Yt)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:a}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),r.v(this.anonId)||(this.anonId=r.u()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Ge,skuId:Zt,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):i&&(this.success[i]=!0)},d))}remove(){this.errorCb=null}},pt=bt.postMapLoadEvent.bind(bt),ti=new class extends Ie{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(d){let i=this.mapInstanceIdMap.get(d);return i||(i=r.u(),this.mapInstanceIdMap.set(d,i)),i}getEventId(d){const i=this.eventIdPerMapInstanceMap.get(d)||0;return this.eventIdPerMapInstanceMap.set(d,i+1),i}postStyleLoadEvent(d,i){const{map:a,style:f,importedStyles:v}=i;if(!r.e.EVENTS_URL||!d&&!r.e.ACCESS_TOKEN)return;const x=this.getMapInstanceId(a),T={mapInstanceId:x,eventId:this.getEventId(x),style:f};v.length&&(T.importedStyles=v),this.queueRequest({timestamp:Date.now(),payload:T},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,payload:a}=this.queue.shift();this.postEvent(i,a,()=>{},d)}},Wi=ti.postStyleLoadEvent.bind(ti),mn=new class extends Ie{constructor(){super("gljs.performance")}postPerformanceEvent(d,i){r.e.EVENTS_URL&&(d||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,performanceData:a}=this.queue.shift(),f=function(v){const x=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),I=function(Q){const le={};if(Q){for(const se in Q)if(se!=="other")for(const me of Q[se]){const fe=`${se}ResolveRangeMin`,De=`${se}ResolveRangeMax`,ke=`${se}RequestCount`,Ne=`${se}RequestCachedCount`;le[fe]=Math.min(le[fe]||1/0,me.startTime),le[De]=Math.max(le[De]||-1/0,me.responseEnd);const tt=He=>{le[He]===void 0&&(le[He]=0),++le[He]};me.transferSize!==void 0&&me.transferSize===0&&tt(Ne),tt(ke)}}return le}(function(Q,le){const se={};if(Q)for(const me of Q){const fe=le(me);se[fe]===void 0&&(se[fe]=[]),se[fe].push(me)}return se}(x,rt)),F=window.devicePixelRatio,V=navigator.connection||navigator.mozConnection||navigator.webkitConnection,j=V?V.effectiveType:void 0,Z={counters:[],metadata:[],attributes:[]},X=(Q,le,se)=>{se!=null&&Q.push({name:le,value:se.toString()})};for(const Q in I)X(Z.counters,Q,I[Q]);if(v.interactionRange[0]!==1/0&&v.interactionRange[1]!==-1/0&&(X(Z.counters,"interactionRangeMin",v.interactionRange[0]),X(Z.counters,"interactionRangeMax",v.interactionRange[1])),T)for(const Q of Object.keys(de)){const le=de[Q],se=T.find(me=>me.name===le);se&&X(Z.counters,le,se.startTime)}return X(Z.counters,"visibilityHidden",v.visibilityHidden),X(Z.attributes,"style",function(Q){if(Q)for(const le of Q){const se=le.name.split("?")[0];if(r.i(se)){const me=se.split("/").slice(-2);if(me.length===2)return`mapbox://styles/${me[0]}/${me[1]}`}}}(x)),X(Z.attributes,"terrainEnabled",v.terrainEnabled?"true":"false"),X(Z.attributes,"fogEnabled",v.fogEnabled?"true":"false"),X(Z.attributes,"projection",v.projection),X(Z.attributes,"zoom",v.zoom),X(Z.metadata,"devicePixelRatio",F),X(Z.metadata,"connectionEffectiveType",j),X(Z.metadata,"navigatorUserAgent",navigator.userAgent),X(Z.metadata,"screenWidth",window.screen.width),X(Z.metadata,"screenHeight",window.screen.height),X(Z.metadata,"windowWidth",window.innerWidth),X(Z.metadata,"windowHeight",window.innerHeight),X(Z.metadata,"mapWidth",v.width/F),X(Z.metadata,"mapHeight",v.height/F),X(Z.metadata,"webglRenderer",v.renderer),X(Z.metadata,"webglVendor",v.vendor),X(Z.metadata,"sdkVersion",Ge),X(Z.metadata,"sdkIdentifier","mapbox-gl-js"),Z}(a);for(const v of f.metadata);for(const v of f.counters);for(const v of f.attributes);this.postEvent(i,f,()=>{},d)}},fn=mn.postPerformanceEvent.bind(mn),vr=new class extends Ie{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(d,i,a,f){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const v=ge(r.e.API_URL+r.e.SESSION_PATH);v.params.push(`sku=${i||""}`),v.params.push(`access_token=${f||r.e.ACCESS_TOKEN||""}`);const x={url:Te(v),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(x,T=>{this.pendingRequest=null,a(T),this.saveEventData(),this.processRequests(f)})}getSessionAPI(d,i,a,f){this.skuToken=i,this.errorCb=f,r.e.SESSION_PATH&&r.e.API_URL&&(a||r.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},a):this.errorCb(new Error(Yt)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:a}=this.queue.shift();i&&this.success[i]||this.getSession(a,this.skuToken,f=>{f?this.errorCb(f):i&&(this.success[i]=!0)},d)}remove(){this.errorCb=null}},et=vr.getSessionAPI.bind(vr),jr=new Set;function Ra(d,i){i?jr.add(d):jr.delete(d)}class ra{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,a){this._updatedSourceCaches[i]=a,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){const a=i.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(i.id),this.setDirty()}removeLayer(i){const a=i.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][i.id]=i,this._updatedLayers[a].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){const i={};for(const a in this._updatedLayers)i[a]=i[a]||{},i[a].updatedIds=Array.from(this._updatedLayers[a].values());for(const a in this._removedLayers)i[a]=i[a]||{},i[a].removedIds=Object.keys(this._removedLayers[a]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(i){this._updatedImages.add(i),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Pi(d){const{userImage:i}=d;return!!(i&&i.render&&i.render())&&(d.data.replace(new Uint8Array(i.data.buffer)),!0)}class cn extends r.E{constructor(i){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=i,i!=="raster"&&r.t()&&(this.imageRasterizerDispatcher=new r.D(r.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.I),this._imageRasterizer}createScope(i){this.images[i]={},this.loaded[i]=!1,this.updatedImages[i]={},this.patterns[i]={},this.callbackDispatchedThisFrame[i]={},this.atlasImage[i]=new r.r({width:1,height:1})}isLoaded(){for(const i in this.loaded)if(!this.loaded[i])return!1;return!0}setLoaded(i,a){if(this.loaded[a]!==i&&(this.loaded[a]=i,i)){for(const{ids:f,callback:v}of this.requestors)this._notify(f,a,v);this.requestors=[]}}hasImage(i,a){return!!this.getImage(i,a)}getImage(i,a){return this.images[a][i]}addImage(i,a,f){this._validate(i,f)&&(this.images[a][i]=f)}_validate(i,a){let f=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new r.y(new Error(`Image "${i}" has invalid "stretchX" value`))),f=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new r.y(new Error(`Image "${i}" has invalid "stretchY" value`))),f=!1),this._validateContent(a.content,a)||(this.fire(new r.y(new Error(`Image "${i}" has invalid "content" value`))),f=!1),f}_validateStretch(i,a){if(!i)return!0;let f=0;for(const v of i){if(v[0]<f||v[1]<v[0]||a<v[1])return!1;f=v[1]}return!0}_validateContent(i,a){return i?i.length!==4||!a.usvg&&(i[0]<0||a.data.width<i[0]||i[1]<0||a.data.height<i[1]||i[2]<0||a.data.width<i[2]||i[3]<0||a.data.height<i[3])?!1:!(i[2]<i[0]||i[3]<i[1]):!0}updateImage(i,a,f){f.version=this.images[a][i].version+1,this.images[a][i]=f,this.updatedImages[a][i]=!0,this.removeFromImageRasterizerCache(i,a)}removeFromImageRasterizerCache(i,a){this.spriteFormat!=="raster"&&(r.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[i],scope:a}):this.imageRasterizer.removeImagesFromCacheByIds([i],a))}removeImage(i,a){const f=this.images[a][i];delete this.images[a][i],delete this.patterns[a][i],this.removeFromImageRasterizerCache(i,a),f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(i){return Object.keys(this.images[i])}getImages(i,a,f){let v=!0;const x=!!this.loaded[a];if(!x)for(const T of i)this.images[a][T]||(v=!1);x||v?this._notify(i,a,f):this.requestors.push({ids:i,scope:a,callback:f})}rasterizeImages({scope:i,imageTasks:a},f){const v={};for(const x in a){const T=a[x],I=this.getImage(T.id,i);I&&(v[x]={image:I,imageIdWithOptions:T})}r.t()?this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{imageTasks:v,scope:i},f):this.rasterizeImagesInMainThread({imageTasks:v,scope:i},f)}rasterizeImagesInMainThread(i,a){const{imageTasks:f,scope:v}=i,x={};for(const T in f){const{image:I,imageIdWithOptions:F}=f[T];x[T]=this.imageRasterizer.rasterize(F,I,v,"")}a(void 0,x)}getUpdatedImages(i){return this.updatedImages[i]}_notify(i,a,f){const v={};for(const x of i){this.images[a][x]||this.fire(new r.z("styleimagemissing",{id:x}));const T=this.images[a][x];T?v[x]={data:T.usvg?null:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,usvg:T.usvg,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!!(T.userImage&&T.userImage.render)}:r.w(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,v)}getPixelSize(i){const{width:a,height:f}=this.atlasImage[i];return{width:a,height:f}}getPattern(i,a,f){const v=this.patterns[a][i],x=this.getImage(i,a);if(!x)return null;if(v&&v.position.version===x.version)return v.position;if(v)v.position.version=x.version;else{x.usvg&&!x.data&&(x.data=this.imageRasterizer.rasterize(r.A.from(i).getPrimary(),x,a,""));const T={w:x.data.width+2*r.B,h:x.data.height+2*r.B,x:0,y:0},I=new r.C(T,x,r.B);this.patterns[a][i]={bin:T,position:I}}return this._updatePatternAtlas(a,f),this.patterns[a][i].position}bind(i,a){const f=i.gl;let v=this.atlasTexture[a];v?this.dirty&&(v.update(this.atlasImage[a]),this.dirty=!1):(v=new r.T(i,this.atlasImage[a],f.RGBA8),this.atlasTexture[a]=v),v.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(i,a){const f=[];for(const I in this.patterns[i])f.push(this.patterns[i][I].bin);const{w:v,h:x}=r.F(f),T=this.atlasImage[i];T.resize({width:v||1,height:x||1});for(const I in this.patterns[i]){const{bin:F,position:V}=this.patterns[i][I];let j=V.padding;const Z=F.x+j,X=F.y+j,Q=this.images[i][I].data,le=Q.width,se=Q.height;j=j>1?j-1:j,r.r.copy(Q,T,{x:0,y:0},{x:Z,y:X},{width:le,height:se},a),r.r.copy(Q,T,{x:0,y:se-j},{x:Z,y:X-j},{width:le,height:j},a),r.r.copy(Q,T,{x:0,y:0},{x:Z,y:X+se},{width:le,height:j},a),r.r.copy(Q,T,{x:le-j,y:0},{x:Z-j,y:X},{width:j,height:se},a),r.r.copy(Q,T,{x:0,y:0},{x:Z+le,y:X},{width:j,height:se},a),r.r.copy(Q,T,{x:le-j,y:se-j},{x:Z-j,y:X-j},{width:j,height:j},a),r.r.copy(Q,T,{x:0,y:se-j},{x:Z+le,y:X-j},{width:j,height:j},a),r.r.copy(Q,T,{x:0,y:0},{x:Z+le,y:X+se},{width:j,height:j},a),r.r.copy(Q,T,{x:le-j,y:0},{x:Z-j,y:X+se},{width:j,height:j},a)}this.dirty=!0}beginFrame(){for(const i in this.images)this.callbackDispatchedThisFrame[i]={}}dispatchRenderCallbacks(i,a){for(const f of i){if(this.callbackDispatchedThisFrame[a][f])continue;this.callbackDispatchedThisFrame[a][f]=!0;const v=this.images[a][f];Pi(v)&&this.updateImage(f,a,v)}}}function Ye(d){const i=d.key,a=d.value,f=d.valueSpec||{},v=d.objectElementValidators||{},x=d.style,T=d.styleSpec;let I=[];const F=r.H(a);if(F!=="object")return[new r.V(i,a,`object expected, ${F} found`)];for(const V in a){const j=V.split(".")[0];let Z;v[j]?Z=v[j]:f[j]?Z=Xn:v["*"]?Z=v["*"]:f["*"]&&(Z=Xn),Z?I=I.concat(Z({key:(i&&`${i}.`)+V,value:a[V],valueSpec:f[j]||f["*"],style:x,styleSpec:T,object:a,objectKey:V},a)):I.push(new r.G(i,a[V],`unknown property "${V}"`))}for(const V in f)v[V]||f[V].required&&f[V].default===void 0&&a[V]===void 0&&I.push(new r.V(i,a,`missing required property "${V}"`));return I}function Xe(d){const i=d.value,a=d.valueSpec,f=d.style,v=d.styleSpec,x=d.key,T=d.arrayElementValidator||Xn;if(r.H(i)!=="array")return[new r.V(x,i,`array expected, ${r.H(i)} found`)];if(a.length&&i.length!==a.length)return[new r.V(x,i,`array length ${a.length} expected, length ${i.length} found`)];if(a["min-length"]&&i.length<a["min-length"])return[new r.V(x,i,`array length at least ${a["min-length"]} expected, length ${i.length} found`)];let I={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};v.$version<7&&(I.function=a.function),r.H(a.value)==="object"&&(I=a.value);let F=[];for(let V=0;V<i.length;V++)F=F.concat(T({array:i,arrayIndex:V,value:i[V],valueSpec:I,style:f,styleSpec:v,key:`${x}[${V}]`},!0));return F}function ft(d){const i=d.key,a=d.value,f=d.valueSpec;let v=r.H(a);if(v==="number"&&a!=a&&(v="NaN"),v!=="number")return[new r.V(i,a,`number expected, ${v} found`)];if("minimum"in f){let x=f.minimum;if(r.H(f.minimum)==="array"&&(x=f.minimum[d.arrayIndex]),a<x)return[new r.V(i,a,`${a} is less than the minimum value ${x}`)]}if("maximum"in f){let x=f.maximum;if(r.H(f.maximum)==="array"&&(x=f.maximum[d.arrayIndex]),a>x)return[new r.V(i,a,`${a} is greater than the maximum value ${x}`)]}return[]}function ct(d){const i=d.valueSpec,a=r.K(d.value.type);let f,v,x,T={};const I=a!=="categorical"&&d.value.property===void 0,F=!I,V=r.H(d.value.stops)==="array"&&r.H(d.value.stops[0])==="array"&&r.H(d.value.stops[0][0])==="object",j=Ye({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(Q){if(a==="identity")return[new r.V(Q.key,Q.value,'identity function may not have a "stops" property')];let le=[];const se=Q.value;return le=le.concat(Xe({key:Q.key,value:se,valueSpec:Q.valueSpec,style:Q.style,styleSpec:Q.styleSpec,arrayElementValidator:Z})),r.H(se)==="array"&&se.length===0&&le.push(new r.V(Q.key,se,"array must have at least one stop")),le},default:function(Q){return Xn({key:Q.key,value:Q.value,valueSpec:i,style:Q.style,styleSpec:Q.styleSpec})}}});return a==="identity"&&I&&j.push(new r.V(d.key,d.value,'missing required property "property"')),a==="identity"||d.value.stops||j.push(new r.V(d.key,d.value,'missing required property "stops"')),a==="exponential"&&d.valueSpec.expression&&!r.L(d.valueSpec)&&j.push(new r.V(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(F&&!r.M(d.valueSpec)?j.push(new r.V(d.key,d.value,"property functions not supported")):I&&!r.N(d.valueSpec)&&j.push(new r.V(d.key,d.value,"zoom functions not supported"))),a!=="categorical"&&!V||d.value.property!==void 0||j.push(new r.V(d.key,d.value,'"property" property is required')),j;function Z(Q){let le=[];const se=Q.value,me=Q.key;if(r.H(se)!=="array")return[new r.V(me,se,`array expected, ${r.H(se)} found`)];if(se.length!==2)return[new r.V(me,se,`array length 2 expected, length ${se.length} found`)];if(V){if(r.H(se[0])!=="object")return[new r.V(me,se,`object expected, ${r.H(se[0])} found`)];if(se[0].zoom===void 0)return[new r.V(me,se,"object stop key must have zoom")];if(se[0].value===void 0)return[new r.V(me,se,"object stop key must have value")];const fe=r.K(se[0].zoom);if(typeof fe!="number")return[new r.V(me,se[0].zoom,"stop zoom values must be numbers")];if(x&&x>fe)return[new r.V(me,se[0].zoom,"stop zoom values must appear in ascending order")];fe!==x&&(x=fe,v=void 0,T={}),le=le.concat(Ye({key:`${me}[0]`,value:se[0],valueSpec:{zoom:{}},style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{zoom:ft,value:X}}))}else le=le.concat(X({key:`${me}[0]`,value:se[0],style:Q.style,styleSpec:Q.styleSpec},se));return r.O(r.Q(se[1]))?le.concat([new r.V(`${me}[1]`,se[1],"expressions are not allowed in function stops.")]):le.concat(Xn({key:`${me}[1]`,value:se[1],valueSpec:i,style:Q.style,styleSpec:Q.styleSpec}))}function X(Q,le){const se=r.H(Q.value),me=r.K(Q.value),fe=Q.value!==null?Q.value:le;if(f){if(se!==f)return[new r.V(Q.key,fe,`${se} stop domain type must match previous stop domain type ${f}`)]}else f=se;if(se!=="number"&&se!=="string"&&se!=="boolean"&&typeof me!="number"&&typeof me!="string"&&typeof me!="boolean")return[new r.V(Q.key,fe,"stop domain value must be a number, string, or boolean")];if(se!=="number"&&a!=="categorical"){let De=`number expected, ${se} found`;return r.M(i)&&a===void 0&&(De+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(Q.key,fe,De)]}return a!=="categorical"||se!=="number"||typeof me=="number"&&isFinite(me)&&Math.floor(me)===me?a!=="categorical"&&se==="number"&&typeof me=="number"&&typeof v=="number"&&v!==void 0&&me<v?[new r.V(Q.key,fe,"stop domain values must appear in ascending order")]:(v=me,a==="categorical"&&me in T?[new r.V(Q.key,fe,"stop domain values must be unique")]:(T[me]=!0,[])):[new r.V(Q.key,fe,`integer expected, found ${String(me)}`)]}}function Rt(d){const i=(d.expressionContext==="property"?r.S:r.U)(r.Q(d.value),d.valueSpec);if(i.result==="error")return i.value.map(f=>new r.V(`${d.key}${f.key}`,d.value,f.message));const a=i.value.expression||i.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!a.outputDefined())return[new r.V(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!r.W(a))return[new r.V(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return Ut(a,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!r.X(a,["zoom","feature-state"]))return[new r.V(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!r.Y(a))return[new r.V(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ut(d,i){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const v of i.valueSpec.expression.parameters)a.delete(v);if(a.size===0)return[];const f=[];return d instanceof r.Z&&a.has(d.name)?[new r.V(i.key,i.value,`["${d.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(d.eachChild(v=>{f.push(...Ut(v,i))}),f)}function li(d){const i=d.key,a=d.value,f=d.valueSpec,v=[];return Array.isArray(f.values)?f.values.indexOf(r.K(a))===-1&&v.push(new r.V(i,a,`expected one of [${f.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(f.values).indexOf(r.K(a))===-1&&v.push(new r.V(i,a,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(a)} found`)),v}function $t(d){return r.$(r.Q(d.value))?Rt(r.J({},d,{expressionContext:"filter",valueSpec:d.styleSpec[`filter_${d.layerType||"fill"}`]})):ii(d)}function ii(d){const i=d.value,a=d.key;if(r.H(i)!=="array")return[new r.V(a,i,`array expected, ${r.H(i)} found`)];const f=d.styleSpec;let v,x=[];if(i.length<1)return[new r.V(a,i,"filter array must have at least 1 element")];switch(x=x.concat(li({key:`${a}[0]`,value:i[0],valueSpec:f.filter_operator,style:d.style,styleSpec:d.styleSpec})),r.K(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&r.K(i[1])==="$type"&&x.push(new r.V(a,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&x.push(new r.V(a,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(v=r.H(i[1]),v!=="string"&&x.push(new r.V(`${a}[1]`,i[1],`string expected, ${v} found`)));for(let T=2;T<i.length;T++)v=r.H(i[T]),r.K(i[1])==="$type"?x=x.concat(li({key:`${a}[${T}]`,value:i[T],valueSpec:f.geometry_type,style:d.style,styleSpec:d.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&x.push(new r.V(`${a}[${T}]`,i[T],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let T=1;T<i.length;T++)x=x.concat(ii({key:`${a}[${T}]`,value:i[T],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":v=r.H(i[1]),i.length!==2?x.push(new r.V(a,i,`filter array for "${i[0]}" operator must have 2 elements`)):v!=="string"&&x.push(new r.V(`${a}[1]`,i[1],`string expected, ${v} found`))}return x}function Tn(d,i){const a=d.key,f=d.style,v=d.layer,x=d.styleSpec,T=d.value,I=d.objectKey,F=x[`${i}_${d.layerType}`];if(!F)return[];const V=I.match(/^(.*)-use-theme$/);if(i==="paint"&&V&&F[V[1]])return r.O(T)?[].concat(Xn({key:d.key,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:f,styleSpec:x,expressionContext:"property",propertyType:i,propertyKey:I})):Xn({key:a,value:T,valueSpec:{type:"string"},style:f,styleSpec:x});const j=I.match(/^(.*)-transition$/);if(i==="paint"&&j&&F[j[1]]&&F[j[1]].transition)return Xn({key:a,value:T,valueSpec:x.transition,style:f,styleSpec:x});const Z=d.valueSpec||F[I];if(!Z)return[new r.G(a,T,`unknown property "${I}"`)];let X;if(r.H(T)==="string"&&r.M(Z)&&!Z.tokens&&(X=/^{([^}]+)}$/.exec(T))){const le=`\`{ "type": "identity", "property": ${X?JSON.stringify(X[1]):'"_"'} }\``;return[new r.V(a,T,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${le}.`)]}const Q=[];if(d.layerType==="symbol")I!=="text-field"||!f||f.glyphs||f.imports||Q.push(new r.V(a,T,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&r.a0(r.Q(T))&&r.K(T.type)==="identity"&&Q.push(new r.V(a,T,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&i==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&r.M(Z)&&(r.a1(Z)||r.N(Z))){const le=r.S(r.Q(T),Z),se=le.value.expression||le.value._styleExpression.expression;se&&!r.X(se,["measure-light"])&&(I==="model-emissive-strength"&&r.Y(se)&&r.W(se)||Q.push(new r.V(a,T,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Q.concat(Xn({key:d.key,value:T,valueSpec:Z,style:f,styleSpec:x,expressionContext:"property",propertyType:i,propertyKey:I}))}function wn(d){return Tn(d,"paint")}function gr(d){return Tn(d,"layout")}function cr(d){let i=[];const a=d.value,f=d.key,v=d.style,x=d.styleSpec;a.type||a.ref||i.push(new r.V(f,a,'either "type" or "ref" is required'));let T=r.K(a.type);const I=r.K(a.ref);if(a.id){const F=r.K(a.id);for(let V=0;V<d.arrayIndex;V++){const j=v.layers[V];r.K(j.id)===F&&i.push(new r.V(f,a.id,`duplicate layer id "${a.id}", previously used at line ${j.id.__line__}`))}}if("ref"in a){let F;["type","source","source-layer","filter","layout"].forEach(V=>{V in a&&i.push(new r.V(f,a[V],`"${V}" is prohibited for ref layers`))}),v.layers.forEach(V=>{r.K(V.id)===I&&(F=V)}),F?F.ref?i.push(new r.V(f,a.ref,"ref cannot reference another ref layer")):T=r.K(F.type):typeof I=="string"&&i.push(new r.V(f,a.ref,`ref layer "${I}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(a.source){const F=v.sources&&v.sources[a.source],V=F&&r.K(F.type);F?V==="vector"&&T==="raster"?i.push(new r.V(f,a.source,`layer "${a.id}" requires a raster source`)):V==="raster"&&T!=="raster"?i.push(new r.V(f,a.source,`layer "${a.id}" requires a vector source`)):V!=="vector"||a["source-layer"]?V==="raster-dem"&&T!=="hillshade"?i.push(new r.V(f,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):V!=="raster-array"||["raster","raster-particle"].includes(T)?T!=="line"||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||V==="geojson"&&F.lineMetrics?T==="raster-particle"&&V!=="raster-array"&&i.push(new r.V(f,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):i.push(new r.V(f,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new r.V(f,a.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new r.V(f,a,`layer "${a.id}" must specify a "source-layer"`)):i.push(new r.V(f,a.source,`source "${a.source}" not found`))}else i.push(new r.V(f,a,'missing required property "source"'));return i=i.concat(Ye({key:f,value:a,valueSpec:x.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Xn({key:`${f}.type`,value:a.type,valueSpec:x.layer.type,style:d.style,styleSpec:d.styleSpec,object:a,objectKey:"type"}),filter:F=>$t(r.J({layerType:T},F)),layout:F=>Ye({layer:a,key:F.key,value:F.value,valueSpec:{},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{"*":V=>gr(r.J({layerType:T},V))}}),paint:F=>Ye({layer:a,key:F.key,value:F.value,valueSpec:{},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{"*":V=>wn(r.J({layerType:T,layer:a},V))}})}})),i}function Sr(d){const i=d.value,a=d.key,f=r.H(i);return f!=="string"?[new r.V(a,i,`string expected, ${f} found`)]:[]}const Er={promoteId:function d({key:i,value:a}){if(r.H(a)==="string")return Sr({key:i,value:a});if(Array.isArray(a)){const f=[],v=r.Q(a),x=r.U(v);return x.result==="error"&&x.value.forEach(T=>{f.push(new r.V(`${i}${T.key}`,null,`${T.message}`))}),r.X(x.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||f.push(new r.V(`${i}`,null,"promoteId expression should be only feature dependent")),f}{const f=[];for(const v in a)f.push(...d({key:`${i}.${v}`,value:a[v]}));return f}}};function mr(d){const i=d.value,a=d.key,f=d.styleSpec,v=d.style;if(!i.type)return[new r.V(a,i,'"type" is required')];const x=r.K(i.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(i.url||i.tiles||T.push(new r.G(a,i,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(Ye({key:a,value:i,valueSpec:f[`source_${x.replace("-","_")}`],style:d.style,styleSpec:f,objectElementValidators:Er})),T;case"geojson":if(T=Ye({key:a,value:i,valueSpec:f.source_geojson,style:v,styleSpec:f,objectElementValidators:Er}),i.cluster)for(const I in i.clusterProperties){const[F,V]=i.clusterProperties[I],j=typeof F=="string"?[F,["accumulated"],["get",I]]:F;T.push(...Rt({key:`${a}.${I}.map`,value:V,expressionContext:"cluster-map"})),T.push(...Rt({key:`${a}.${I}.reduce`,value:j,expressionContext:"cluster-reduce"}))}return T;case"video":return Ye({key:a,value:i,valueSpec:f.source_video,style:v,styleSpec:f});case"image":return Ye({key:a,value:i,valueSpec:f.source_image,style:v,styleSpec:f});case"canvas":return[new r.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return li({key:`${a}.type`,value:i.type,valueSpec:{values:Nr(f)}})}}function Nr(d){return d.source.reduce((i,a)=>{const f=d[a];return f.type.type==="enum"&&(i=i.concat(Object.keys(f.type.values))),i},[])}function Ma(d){const i=d.value,a=d.styleSpec,f=a.light,v=d.style;let x=[];const T=r.H(i);if(i===void 0)return x;if(T!=="object")return x=x.concat([new r.V("light",i,`object expected, ${T} found`)]),x;for(const I in i){const F=I.match(/^(.*)-transition$/),V=I.match(/^(.*)-use-theme$/);x=x.concat(V&&f[V[1]]?Xn({key:I,value:i[I],valueSpec:{type:"string"},style:v,styleSpec:a}):F&&f[F[1]]&&f[F[1]].transition?Xn({key:I,value:i[I],valueSpec:a.transition,style:v,styleSpec:a}):f[I]?Xn({key:I,value:i[I],valueSpec:f[I],style:v,styleSpec:a}):[new r.V(I,i[I],`unknown property "${I}"`)])}return x}function ga(d){const i=d.value;let a=[];if(!i)return a;const f=r.H(i);if(f!=="object")return a=a.concat([new r.V("light-3d",i,`object expected, ${f} found`)]),a;const v=d.styleSpec,x=v["light-3d"],T=d.key,I=d.style,F=d.style.lights;for(const Z of["type","id"])if(!(Z in i))return a=a.concat([new r.V("light-3d",i,`missing property ${Z} on light`)]),a;if(i.type&&F)for(let Z=0;Z<d.arrayIndex;Z++){const X=r.K(i.type),Q=F[Z];r.K(Q.type)===X&&a.push(new r.V(T,i.id,`duplicate light type "${i.type}", previously defined at line ${Q.id.__line__}`))}const V=`properties_light_${i.type}`;if(!(V in v))return a=a.concat([new r.V("light-3d",i,`Invalid light type ${i.type}`)]),a;const j=v[V];for(const Z in i)if(Z==="properties"){const X=i[Z],Q=r.H(X);if(Q!=="object")return a=a.concat([new r.V("properties",X,`object expected, ${Q} found`)]),a;for(const le in X)a=a.concat(j[le]?Xn({key:le,value:X[le],valueSpec:j[le],style:I,styleSpec:v}):[new r.G(d.key,X[le],`unknown property "${le}"`)])}else{const X=Z.match(/^(.*)-transition$/),Q=Z.match(/^(.*)-use-theme$/);a=a.concat(Q&&x[Q[1]]?Xn({key:Z,value:i[Z],valueSpec:{type:"string"},style:I,styleSpec:v}):X&&x[X[1]]&&x[X[1]].transition?Xn({key:Z,value:i[Z],valueSpec:v.transition,style:I,styleSpec:v}):x[Z]?Xn({key:Z,value:i[Z],valueSpec:x[Z],style:I,styleSpec:v}):[new r.G(Z,i[Z],`unknown property "${Z}"`)])}return a}function oo(d){const i=d.value,a=d.key,f=d.style,v=d.styleSpec,x=v.terrain;let T=[];const I=r.H(i);if(i===void 0||I==="null")return T;if(I!=="object")return T=T.concat([new r.V("terrain",i,`object expected, ${I} found`)]),T;for(const F in i){const V=F.match(/^(.*)-transition$/),j=F.match(/^(.*)-use-theme$/);T=T.concat(j&&x[j[1]]?Xn({key:F,value:i[F],valueSpec:{type:"string"},style:f,styleSpec:v}):V&&x[V[1]]&&x[V[1]].transition?Xn({key:F,value:i[F],valueSpec:v.transition,style:f,styleSpec:v}):x[F]?Xn({key:F,value:i[F],valueSpec:x[F],style:f,styleSpec:v}):[new r.G(F,i[F],`unknown property "${F}"`)])}if(i.source){const F=f.sources&&f.sources[i.source],V=F&&r.K(F.type);F?V!=="raster-dem"&&T.push(new r.V(a,i.source,`terrain cannot be used with a source of type ${String(V)}, it only be used with a "raster-dem" source type`)):T.push(new r.V(a,i.source,`source "${i.source}" not found`))}else T.push(new r.V(a,i,'terrain is missing required property "source"'));return T}function $a(d){const i=d.value,a=d.style,f=d.styleSpec,v=f.fog;let x=[];const T=r.H(i);if(i===void 0)return x;if(T!=="object")return x=x.concat([new r.V("fog",i,`object expected, ${T} found`)]),x;for(const I in i){const F=I.match(/^(.*)-transition$/),V=I.match(/^(.*)-use-theme$/);x=x.concat(V&&v[V[1]]?Xn({key:I,value:i[I],valueSpec:{type:"string"},style:a,styleSpec:f}):F&&v[F[1]]&&v[F[1]].transition?Xn({key:I,value:i[I],valueSpec:f.transition,style:a,styleSpec:f}):v[I]?Xn({key:I,value:i[I],valueSpec:v[I],style:a,styleSpec:f}):[new r.G(I,i[I],`unknown property "${I}"`)])}return x}const dn={"*":()=>[],array:Xe,boolean:function(d){const i=d.value,a=d.key,f=r.H(i);return f!=="boolean"?[new r.V(a,i,`boolean expected, ${f} found`)]:[]},number:ft,color:function(d){const i=d.key,a=d.value,f=r.H(a);return f!=="string"?[new r.V(i,a,`color expected, ${f} found`)]:r._.parseCSSColor(a)===null?[new r.V(i,a,`color expected, "${a}" found`)]:[]},enum:li,filter:$t,function:ct,layer:cr,object:Ye,source:mr,model:r.a2,light:Ma,"light-3d":ga,terrain:oo,fog:$a,string:Sr,formatted:function(d){return Sr(d).length===0?[]:Rt(d)},resolvedImage:function(d){return Sr(d).length===0?[]:Rt(d)},projection:function(d){const i=d.value,a=d.styleSpec,f=a.projection,v=d.style;let x=[];const T=r.H(i);if(T==="object")for(const I in i)x=x.concat(Xn({key:I,value:i[I],valueSpec:f[I],style:v,styleSpec:a}));else T!=="string"&&(x=x.concat([new r.V("projection",i,`object or string expected, ${T} found`)]));return x},import:function(d){const{value:i,styleSpec:a}=d,{data:f,...v}=i;Object.defineProperty(v,"__line__",{value:i.__line__,enumerable:!1});let x=Ye(r.J({},d,{value:v,valueSpec:a.import}));return r.K(v.id)===""&&x.push(new r.V(`${d.key}.id`,v,"import id can't be an empty string")),f&&(x=x.concat(lo(f,a,{key:`${d.key}.data`}))),x}};function Xn(d,i=!1){const a=d.value,f=d.valueSpec,v=d.styleSpec;if(f.expression&&r.a0(r.K(a)))return ct(d);if(f.expression&&r.O(r.Q(a)))return Rt(d);if(f.type&&dn[f.type]){const x=dn[f.type](d);return i===!0&&x.length>0&&r.H(d.value)==="array"?Rt(d):x}return Ye(r.J({},d,{valueSpec:f.type?v[f.type]:f}))}function Qa(d){const i=d.value,a=d.key,f=Sr(d);return f.length||(i.indexOf("{fontstack}")===-1&&f.push(new r.V(a,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&f.push(new r.V(a,i,'"glyphs" url must include a "{range}" token'))),f}function lo(d,i=r.a3,a={}){return Xn({key:a.key||"",value:d,valueSpec:i.$root,styleSpec:i,style:d,objectElementValidators:{glyphs:Qa,"*":()=>[]}})}function Us(d,i=r.a3){return xs(lo(d,i))}const Ca=d=>xs(mr(d)),ja=d=>xs(Ma(d)),qr=d=>xs(ga(d)),gs=d=>xs(oo(d)),$s=d=>xs($a(d)),Lo=d=>xs(function(i){const a=i.value,f=i.style,v=i.styleSpec,x=v.snow;let T=[];const I=r.H(a);if(a===void 0)return T;if(I!=="object")return T=T.concat([new r.V("snow",a,`object expected, ${I} found`)]),T;for(const F in a){const V=F.match(/^(.*)-transition$/);T=T.concat(V&&x[V[1]]&&x[V[1]].transition?Xn({key:F,value:a[F],valueSpec:v.transition,style:f,styleSpec:v}):x[F]?Xn({key:F,value:a[F],valueSpec:x[F],style:f,styleSpec:v}):[new r.G(F,a[F],`unknown property "${F}"`)])}return T}(d)),Ls=d=>xs(function(i){const a=i.value,f=i.style,v=i.styleSpec,x=v.rain;let T=[];const I=r.H(a);if(a===void 0)return T;if(I!=="object")return T=T.concat([new r.V("rain",a,`object expected, ${I} found`)]),T;for(const F in a){const V=F.match(/^(.*)-transition$/);T=T.concat(V&&x[V[1]]&&x[V[1]].transition?Xn({key:F,value:a[F],valueSpec:v.transition,style:f,styleSpec:v}):x[F]?Xn({key:F,value:a[F],valueSpec:x[F],style:f,styleSpec:v}):[new r.G(F,a[F],`unknown property "${F}"`)])}return T}(d)),ht=d=>xs(cr(d)),es=d=>xs($t(d)),Ks=d=>xs(wn(d)),Js=d=>xs(gr(d)),Ro=d=>xs(r.a2(d));function xs(d){return d.slice().sort((i,a)=>i.line&&a.line?i.line-a.line:0)}function Io(d,i){let a=!1;if(i&&i.length)for(const f of i)f instanceof r.G?r.w(f.message):(d.fire(new r.y(new Error(f.message))),a=!0);return a}let Xt;class oe extends r.E{constructor(i,a="flat"){super(),this._transitionable=new r.a4(Xt||(Xt=new r.a5({anchor:new r.a6(r.a3.light.anchor),position:new r.a7(r.a3.light.position),color:new r.a6(r.a3.light.color),intensity:new r.a6(r.a3.light.intensity)}))),this.setLight(i,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,a,f={}){this._validate(ja,i,f)||(this._transitionable.setTransitionOrValue(i),this.id=a)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,a,f){return(!f||f.validate!==!1)&&Io(this,i.call(Us,r.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}}let pe=class extends r.E{constructor(d,i,a,f){super(),this.scope=a,this._transitionable=new r.a4(new r.a5({source:new r.a6(r.a3.terrain.source),exaggeration:new r.a6(r.a3.terrain.exaggeration)}),a,f),this._transitionable.setTransitionOrValue(d,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(d,i){this._transitionable.setTransitionOrValue(d,i)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new r.a8(d)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const d=this._transitionable._values.exaggeration;if(!d)return null;const i=d.value.expression;if(!i)return null;let a=-1,f=-1,v=1;for(const x of i.zoomStops)v=i.evaluate(new r.a8(x)),v>.01?(a=x,f=-1):f=x;return v<.01&&a>0&&f>a?[a,f]:null}isZoomDependent(){const d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof r.a9}};const Ce=45,qe=65,Qe=.05;function ut(d,i,a,f){const v=r.ac(Ce,qe,a),[x,T]=It(d,f);let I=1-Math.min(1,Math.exp((i-x)/(T-x)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*v*d.alpha}function It(d,i){const a=.5/Math.tan(.5*i);return[d.range[0]+a,d.range[1]+a]}function mt(d,i,a,f,v){const x=r.ab.vec3.transformMat4([],[i,a,f],v.mercatorFogMatrix);return ut(d,r.ab.vec3.length(x),v.pitch,v._fov)}function Vt(d,i,a,f,v,x,T){const I=[[a,f,0],[v,f,0],[v,x,0],[a,x,0]];let F=Number.MAX_VALUE,V=-Number.MAX_VALUE;for(const j of I){const Z=r.ab.vec3.transformMat4([],j,i),X=r.ab.vec3.length(Z);F=Math.min(F,X),V=Math.max(V,X)}return[ut(d,F,T.pitch,T._fov),ut(d,V,T.pitch,T._fov)]}class Gt extends r.E{constructor(i,a,f,v){super();const x=new r.a5({range:new r.a6(r.a3.fog.range),color:new r.a6(r.a3.fog.color),"color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.a6(r.a3.fog["high-color"]),"high-color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.a6(r.a3.fog["space-color"]),"space-color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.a6(r.a3.fog["horizon-blend"]),"star-intensity":new r.a6(r.a3.fog["star-intensity"]),"vertical-range":new r.a6(r.a3.fog["vertical-range"])});this._transitionable=new r.a4(x,f,new Map(v)),this.set(i,v),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new r.ad(x),this.scope=f}get state(){const i=this._transform,a=i.projection.name==="globe",f=r.ae(i.zoom),v=this.properties.get("range"),x=[.5,3];return{range:a?[r.af(x[0],v[0],f),r.af(x[1],v[1],f)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,a,f={}){if(this._validate($s,i,f))return;const v=r.l({},i);for(const x of Object.keys(r.a3.fog))v[x]===void 0&&(v[x]=r.a3.fog[x].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.ac(Ce,qe,i))*a.a}getOpacityAtLatLng(i,a){return this._transform.projection.supportsFog?function(f,v,x){const T=r.aa.fromLngLat(v),I=x.elevation?x.elevation.getAtPointOrZero(T):0;return mt(f,T.x,T.y,I,x)}(this.state,i,a):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];const a=this._transform.calculateFogTileMatrix(i.toUnwrapped());return Vt(this.state,a,0,0,r.ag,r.ag,this._transform)}getOpacityForBounds(i,a,f,v,x){return this._transform.projection.supportsFog?Vt(this.state,i,a,f,v,x,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?It(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;const a=[4,5,6,7];for(const f of a){const v=i.points[f];let x;if(v[2]>=0)x=v;else{const T=i.points[f-4];x=r.ah(T,v,T[2]/(T[2]-v[2]))}if(mt(this.state,x[0],x[1],0,this._transform)>=Qe)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,a,f){return(!f||f.validate!==!1)&&Io(this,i.call(Us,r.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}}let Wt,Mi,Qi,nn,zn=class extends r.E{constructor(d,i,a,f){super();const v=Wt||(Wt=new r.a5({density:new r.a6(r.a3.snow.density),intensity:new r.a6(r.a3.snow.intensity),color:new r.a6(r.a3.snow.color),opacity:new r.a6(r.a3.snow.opacity),vignette:new r.a6(r.a3.snow.vignette),"vignette-color":new r.a6(r.a3.snow["vignette-color"]),"center-thinning":new r.a6(r.a3.snow["center-thinning"]),direction:new r.a6(r.a3.snow.direction),"flake-size":new r.a6(r.a3.snow["flake-size"])}));this._transitionable=new r.a4(v,a,new Map(f)),this.set(d,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ad(v),this.scope=a}get state(){const d=this.properties.get("opacity"),i=this.properties.get("color"),a=this.properties.get("direction"),f=r.ai(a[0]),v=-Math.max(r.ai(a[1]),.01),x=[Math.cos(f)*Math.cos(v),Math.sin(f)*Math.cos(v),Math.sin(v)],T=this.properties.get("vignette"),I=this.properties.get("vignette-color");return I.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.aj(i.r,i.g,i.b,i.a*d),direction:x,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(d,i,a={}){if(this._validate(Lo,d,a))return;const f=r.l({},d);for(const v of Object.keys(r.a3.snow))f[v]===void 0&&(f[v]=r.a3.snow[v].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,i,a){return(!a||a.validate!==!1)&&Io(this,d.call(Us,r.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}},jn=class extends r.E{constructor(d,i,a,f){super();const v=Mi||(Mi=new r.a5({density:new r.a6(r.a3.rain.density),intensity:new r.a6(r.a3.rain.intensity),color:new r.a6(r.a3.rain.color),opacity:new r.a6(r.a3.rain.opacity),vignette:new r.a6(r.a3.rain.vignette),"vignette-color":new r.a6(r.a3.rain["vignette-color"]),"center-thinning":new r.a6(r.a3.rain["center-thinning"]),direction:new r.a6(r.a3.rain.direction),"droplet-size":new r.a6(r.a3.rain["droplet-size"]),"distortion-strength":new r.a6(r.a3.rain["distortion-strength"])}));this._transitionable=new r.a4(v,a,new Map(f)),this.set(d,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ad(v),this.scope=a}get state(){const d=this.properties.get("opacity"),i=this.properties.get("color"),a=this.properties.get("direction"),f=r.ai(a[0]),v=-Math.max(r.ai(a[1]),.01),x=[Math.cos(f)*Math.cos(v),Math.sin(f)*Math.cos(v),Math.sin(v)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.aj(i.r,i.g,i.b,i.a*d),direction:x,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(d,i,a={}){if(this._validate(Ls,d,a))return;const f=r.l({},d);for(const v of Object.keys(r.a3.rain))f[v]===void 0&&(f[v]=r.a3.rain[v].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,i,a){return(!a||a.validate!==!1)&&Io(this,d.call(Us,r.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}};class ar extends r.E{constructor(i,a,f,v){super(),this.scope=f,this._options=i,this.properties=new r.ad(a),this._transitionable=new r.a4(a,f,new Map(v)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,a){this._options=i,this._transitionable.setTransitionOrValue(i.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Wn{constructor(i,a,f,v){this.screenBounds=i,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(i,a){let f,v;if(i instanceof r.P||typeof i[0]=="number"){const x=r.P.convert(i);f=[x],v=a.isPointAboveHorizon(x)}else{const x=r.P.convert(i[0]),T=r.P.convert(i[1]);f=[x,T],v=r.al(x,T).every(I=>a.isPointAboveHorizon(I))}return new Wn(f,a.getCameraPoint(),v,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return r.al(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const a=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],v=r.al(a,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<f.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?v[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(v[3]=this.cameraPoint)),r.am(v,i)}bufferedCameraGeometryGlobe(i){const a=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],v=r.al(a,f,i),x=this.cameraPoint.clone();switch(3*((x.y>a.y)+(x.y>f.y))+((x.x>a.x)+(x.x>f.x))){case 0:v[0]=x,v[4]=x.clone();break;case 1:v.splice(1,0,x);break;case 2:v[1]=x;break;case 3:v.splice(4,0,x);break;case 5:v.splice(2,0,x);break;case 6:v[3]=x;break;case 7:v.splice(3,0,x);break;case 8:v[2]=x}return v}containsTile(i,a,f,v=0){const x=i.queryPadding/a._pixelsPerMercatorPixel+1,T=f?this._bufferedCameraMercator(x,a):this._bufferedScreenMercator(x,a);let I=i.tileID.wrap+(T.unwrapped?v:0);const F=T.polygon.map(me=>r.an(i.tileTransform,me,I));if(!r.ao(F,0,0,r.ag,r.ag))return;I=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const V=this.screenGeometryMercator.polygon.map(me=>r.ap(i.tileTransform,me,I)),j=V.map(me=>new r.P(me[0],me[1])),Z=a.getFreeCameraOptions().position||new r.aa(0,0,0),X=r.ap(i.tileTransform,Z,I),Q=V.map(me=>{const fe=r.ab.vec3.sub(me,me,X);return r.ab.vec3.normalize(fe,fe),new r.aq(X,fe)}),le=r.ar(i,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:j,tilespaceRays:Q,bufferedTilespaceGeometry:F,bufferedTilespaceBounds:(se=r.as(F),se.min.x=r.aw(se.min.x,0,r.ag),se.min.y=r.aw(se.min.y,0,r.ag),se.max.x=r.aw(se.max.x,0,r.ag),se.max.y=r.aw(se.max.y,0,r.ag),se),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:le};var se}_bufferedScreenMercator(i,a){const f=Br(i);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let v;return v=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),a):{polygon:this.bufferedScreenGeometry(i).map(x=>a.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[f]=v,v}}_bufferedCameraMercator(i,a){const f=Br(i);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let v;return v=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),a):{polygon:this.bufferedCameraGeometry(i).map(x=>a.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[f]=v,v}}_projectAndResample(i,a){const f=function(x,T){const I=r.ab.mat4.multiply([],T.pixelMatrix,T.globeMatrix),F=[0,-r.ax,0,1],V=[0,r.ax,0,1],j=[0,0,0,1];r.ab.vec4.transformMat4(F,F,I),r.ab.vec4.transformMat4(V,V,I),r.ab.vec4.transformMat4(j,j,I);const Z=new r.P(F[0]/F[3],F[1]/F[3]),X=new r.P(V[0]/V[3],V[1]/V[3]),Q=r.au(x,Z)&&F[3]<j[3],le=r.au(x,X)&&V[3]<j[3];if(!Q&&!le)return null;const se=function(We,je,at){for(let gt=1;gt<We.length;gt++){const Jt=Ur(je.pointCoordinate3D(We[gt-1]).x),jt=Ur(je.pointCoordinate3D(We[gt]).x);if(at<0){if(Jt<jt)return{idx:gt,t:-Jt/(jt-1-Jt)}}else if(jt<Jt)return{idx:gt,t:(1-Jt)/(jt+1-Jt)}}return null}(x,T,Q?-1:1);if(!se)return null;const{idx:me,t:fe}=se;let De=me>1?Rr(x.slice(0,me),T):[],ke=me<x.length?Rr(x.slice(me),T):[];De=De.map(We=>new r.P(Ur(We.x),We.y)),ke=ke.map(We=>new r.P(Ur(We.x),We.y));const Ne=[...De];Ne.length===0&&Ne.push(ke[ke.length-1]);const tt=r.af(Ne[Ne.length-1].y,(ke.length===0?De[0]:ke[0]).y,fe);let He;return He=Q?[new r.P(0,tt),new r.P(0,0),new r.P(1,0),new r.P(1,tt)]:[new r.P(1,tt),new r.P(1,1),new r.P(0,1),new r.P(0,tt)],Ne.push(...He),ke.length===0?Ne.push(De[0]):Ne.push(...ke),{polygon:Ne.map(We=>new r.aa(We.x,We.y)),unwrapped:!1}}(i,a);if(f)return f;const v=function(x,T){let I=!1,F=-1/0,V=0;for(let Z=0;Z<x.length-1;Z++)x[Z].x>F&&(F=x[Z].x,V=Z);for(let Z=0;Z<x.length-1;Z++){const X=(V+Z)%(x.length-1),Q=x[X],le=x[X+1];Math.abs(Q.x-le.x)>.5&&(Q.x<le.x?(Q.x+=1,X===0&&(x[x.length-1].x+=1)):(le.x+=1,X+1===x.length-1&&(x[0].x+=1)),I=!0)}const j=r.at(T.center.lng);return I&&j<Math.abs(j-1)&&x.forEach(Z=>{Z.x-=1}),{polygon:x,unwrapped:I}}(Rr(i,a).map(x=>new r.P(Ur(x.x),x.y)),a);return{polygon:v.polygon.map(x=>new r.aa(x.x,x.y)),unwrapped:v.unwrapped}}}function Rr(d,i){return r.av(d,a=>{const f=i.pointCoordinate3D(a);a.x=f.x,a.y=f.y},1/256)}function Ur(d){return d<0?1+d%1:d%1}function Br(d){return 100*d|0}function sa(d,i,a,f,v){const x=function(I,F){if(I)return v(I);if(F){if(d.url&&F.tiles&&d.tiles&&delete d.tiles,F.variants){if(!Array.isArray(F.variants))return v(new Error("variants must be an array"));for(const j of F.variants){if(j==null||typeof j!="object"||j.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(j.capabilities))return v(new Error("capabilities must be an array"));if(j.capabilities.length===1&&j.capabilities[0]==="meshopt"){F=r.l(F,j);break}}}const V=r.ay(r.l({},F,d),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);V.tiles=i.canonicalizeTileset(V,d.url),v(null,V)}},T=function(I,F,V){if(!I)return null;if(!F&&!V)return I;V=V||I.worldview_default;const j=Object.values(I.language||{});if(j.length===0)return null;const Z=Object.values(I.worldview||{});if(Z.length===0)return null;const X=j.every(le=>le===F),Q=Z.every(le=>le===V);return X&&Q?I:F in(I.language_options||{})||V in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null}(d.data,a,f);return T?r.q.frame(()=>x(null,T)):d.url?r.n(i.transformRequest(i.normalizeSourceURL(d.url,null,a,f),r.R.Source),x):r.q.frame(()=>{const{data:I,...F}=d;x(null,F)})}class Wr{constructor(i,a,f){this.bounds=r.az.convert(this.validateBounds(i)),this.minzoom=a||0,this.maxzoom=f||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const a=Math.pow(2,i.z),f=Math.floor(r.at(this.bounds.getWest())*a),v=Math.floor(r.aA(this.bounds.getNorth())*a),x=Math.ceil(r.at(this.bounds.getEast())*a),T=Math.ceil(r.aA(this.bounds.getSouth())*a);return i.x>=f&&i.x<x&&i.y>=v&&i.y<T}}class tr extends r.E{constructor(i,a,f,v){if(super(),this.id=i,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.l(this,r.ay(a,["url","scheme","tileSize","promoteId"])),this._options=r.l({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new r.aB}load(i){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map.getWorldview();this._tileJSONRequest=sa(this._options,this.map._requestManager,a,f,(v,x)=>{if(this._tileJSONRequest=null,this._loaded=!0,v)a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),f&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new r.y(v));else if(x){if(r.l(this,x),this.hasWorldviews=!!x.worldview_options,x.worldview_default&&(this.worldviewDefault=x.worldview_default),x.vector_layers){this.vectorLayers=x.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of x.vector_layers)this.vectorLayerIds.push(T.id),x.worldview&&x.worldview[T.source]&&this.localizableLayerIds.add(T.id)}x.bounds&&(this.tileBounds=new Wr(x.bounds,this.minzoom,this.maxzoom)),vt(x.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}i&&i(v)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}loadTile(i,a){const f=i.tileID.canonical.url(this.tiles,this.scheme),v=this.map._requestManager.normalizeTileURL(f),x=this.map._requestManager.transformRequest(v,r.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,I=T?{image:T.image.clone()}:null,F={request:x,data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&r.f(f)&&(F.worldview=this.map.getWorldview()||this.worldviewDefault,F.localizableLayerIds=this.localizableLayerIds),F.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=a:i.request=i.actor.send("reloadTile",F,V.bind(this));else if(i.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",F,V.bind(this),void 0,!0);else{const j=r.aD.call({deduped:this._deduped},F,(Z,X)=>{Z||!X?V.call(this,Z):(F.data={cacheControl:X.cacheControl,expires:X.expires,rawData:X.rawData.slice(0)},i.actor&&i.actor.send("loadTile",F,V.bind(this),void 0,!0))},!0);i.request={cancel:j}}function V(j,Z){return delete i.request,i.aborted?a(null):j&&j.status!==404?a(j):(Z&&Z.resourceTiming&&(i.resourceTiming=Z.resourceTiming),this.map._refreshExpiredTiles&&Z&&i.setExpiryData(Z),i.loadVectorData(Z,this.map.painter),r.aE(this.dispatcher),a(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,a){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Rs extends r.E{constructor(i,a,f,v){super(),this.id=i,this.dispatcher=f,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.l({type:"raster"},a),r.l(this,r.ay(a,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._tileJSONRequest=sa(this._options,this.map._requestManager,null,null,(a,f)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new r.y(a)):f&&(r.l(this,f),f.raster_layers&&(this.rasterLayers=f.raster_layers,this.rasterLayerIds=this.rasterLayers.map(v=>v.id)),f.bounds&&(this.tileBounds=new Wr(f.bounds,this.minzoom,this.maxzoom)),vt(f.tiles),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),i&&i(a)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,a){const f=r.q.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);i.request=r.o(this.map._requestManager.transformRequest(v,r.R.Tile),(x,T,I,F)=>(delete i.request,i.aborted?(i.state="unloaded",a(null)):x?(i.state="errored",a(x)):T?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:I,expires:F}),i.setTexture(T,this.map.painter),i.state="loaded",r.aE(this.dispatcher),void a(null)):a(null)))}abortTile(i,a){i.request&&(i.request.cancel(),delete i.request),a&&a()}unloadTile(i,a){i.texture&&i.texture instanceof r.T?(i.destroy(!0),i.texture&&i.texture instanceof r.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ia extends Rs{constructor(i,a,f,v){super(i,a,f,v),this.type="raster-array",this.maxzoom=22,this._options=r.l({type:"raster-array"},a)}triggerRepaint(i){const a=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);a&&a.enabled&&f&&a._clearRenderCacheForTile(f.id,i.tileID),this.map.triggerRepaint()}loadTile(i,a){const f=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(f,r.R.Tile);i.requestParams=v,i.actor||(i.actor=this.dispatcher.getActor()),i.request=i.fetchHeader(void 0,(x,T,I,F)=>{if(delete i.request,i.aborted)return i.state="unloaded",a(null);if(x)return x.code===20?void 0:(i.state="errored",a(x));this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:I,expires:F}),i.state="empty",a(null)})}unloadTile(i,a){const f=i.texture;f&&f instanceof r.T?(i.destroy(!0),this.map.painter.saveTileTexture(f)):(i.destroy(),i.flushQueues(),i._isHeaderLoaded=!1,delete i._mrt,delete i.textureDescriptor),i.fbo&&(i.fbo.destroy(),delete i.fbo),delete i.request,delete i.requestParams,delete i.neighboringTiles,i.state="unloaded"}prepareTile(i,a,f){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBand(a,f,(v,x)=>{if(v)return i.state="errored",this.fire(new r.y(v)),void this.triggerRepaint(i);x&&(i.setTexture(x,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;const a=this.rasterLayers.find(({id:x})=>x===i),f=a&&a.fields,v=f&&f.bands&&f.bands;return v?v[0]:0}getTextureDescriptor(i,a,f){if(!i)return;const v=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let x=null;a instanceof r.aH?x=a.paint.get("raster-array-band"):a instanceof r.aI&&(x=a.paint.get("raster-particle-array-band"));const T=x||this.getInitialBand(v);if(T!=null)if(i.textureDescriptor){if(!i.updateNeeded(v,T)||f)return Object.assign({},i.textureDescriptor,{texture:i.texture})}else this.prepareTile(i,v,T)}}const Da={vector:tr,raster:Rs,"raster-dem":class extends Rs{constructor(d,i,a,f){super(d,i,a,f),this.type="raster-dem",this.maxzoom=22,this._options=r.l({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(d,i){const a=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(v,x){v&&(d.state="errored",i(v)),x&&(d.dem=x,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",i(null))}d.request=r.o(this.map._requestManager.transformRequest(a,r.R.Tile),(function(v,x,T,I){if(delete d.request,d.aborted)d.state="unloaded",i(null);else if(v)d.state="errored",i(v);else if(x){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:T,expires:I});const F=ImageBitmap&&x instanceof ImageBitmap&&r.t(),V=1-(x.width-r.aF(x.width))/2;V<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const j=F?x:r.q.getImageData(x,V),Z={uid:d.uid,coord:d.tileID,source:this.id,scope:this.scope,rawImageData:j,encoding:this.encoding,padding:V};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",Z,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const i=d.canonical,a=Math.pow(2,i.z),f=(i.x-1+a)%a,v=i.x===0?d.wrap-1:d.wrap,x=(i.x+1+a)%a,T=i.x+1===a?d.wrap+1:d.wrap,I={};return I[new r.aG(d.overscaledZ,v,i.z,f,i.y).key]={backfilled:!1},I[new r.aG(d.overscaledZ,T,i.z,x,i.y).key]={backfilled:!1},i.y>0&&(I[new r.aG(d.overscaledZ,v,i.z,f,i.y-1).key]={backfilled:!1},I[new r.aG(d.overscaledZ,d.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},I[new r.aG(d.overscaledZ,T,i.z,x,i.y-1).key]={backfilled:!1}),i.y+1<a&&(I[new r.aG(d.overscaledZ,v,i.z,f,i.y+1).key]={backfilled:!1},I[new r.aG(d.overscaledZ,d.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},I[new r.aG(d.overscaledZ,T,i.z,x,i.y+1).key]={backfilled:!1}),I}},"raster-array":Ia,geojson:class extends r.E{constructor(d,i,a,f){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(f),this._data=i.data,this._options=r.l({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.minzoom!==void 0&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const v=r.ag/this.tileSize;this.workerOptions=r.l({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*v,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*v,extent:r.ag,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:r.ag,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*v,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}updateData(d){if(!this._options.dynamic)return this.fire(new r.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof d!="string"&&(d.type==="Feature"&&(d={type:"FeatureCollection",features:[d]}),d.type!=="FeatureCollection"))return this.fire(new r.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof d!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const i=new Map;for(const a of this._data.features)i.set(a.id,a);for(const a of d.features)i.set(a.id,a);this._data.features=[...i.values()]}else this._data=d;return this._updateWorkerData(!0),this}getClusterExpansionZoom(d,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},i),this}getClusterChildren(d,i){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},i),this}getClusterLeaves(d,i,a,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:i,offset:a},f),this}_updateWorkerData(d=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.z("dataloading",{dataType:"source"})),this._loaded=!1;const i=r.l({append:d},this.workerOptions);i.scope=this.scope;const a=this._data;typeof a=="string"?(i.request=this.map._requestManager.transformRequest(r.q.resolveURL(a),r.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,(f,v)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new r.y(f));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(x.resourceTiming=v.resourceTiming[this.id]),d&&(this._partialReload=!0),this.fire(new r.z("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(d),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const d=r.aC(this.id,this.scope);this.map.style.clearSource(d),this._updateWorkerData()}loadTile(d,i){const a=d.actor?"reloadTile":"loadTile";d.actor=this.actor;const f=this.map.style?this.map.style.getLut(this.scope):null,v=f?{image:f.image.clone()}:null,x=this._partialReload,T={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:v,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:x};d.request=this.actor.send(a,T,(I,F)=>x&&!F?(d.state="loaded",i(null)):(delete d.request,d.destroy(),d.aborted?i(null):I?i(I):(d.loadVectorData(F,this.map.painter,a==="reloadTile"),i(null))),void 0,a==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d,i){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(d){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aJ{constructor(d,i,a,f){super(d,i,a,f),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const i of d.urls)this.urls.push(this.map._requestManager.transformRequest(i,r.R.Source).url);r.aK(this.urls,(i,a)=>{this._loaded=!0,i?this.fire(new r.y(i)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const i=this.video.seekable;d<i.start(0)||d>i.end(0)?this.fire(new r.y(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,i=d.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(d,this.video,i.RGBA8),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aJ,model:class extends r.E{constructor(d,i,a,f){super(),this.id=d,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){const d=[];for(const i in this._options.models){const a=this._options.models[i],f=r.aM(this.map._requestManager.transformRequest(a.uri,r.R.Model).url).then(v=>{if(!v)return;const x=r.aN(v),T=new r.aO(i,a.position,a.orientation,x);T.computeBoundsAndApplyParent(),this.models.push(T)}).catch(v=>{this.fire(new r.y(new Error(`Could not load model ${i} from ${a.uri}: ${v.message}`)))});d.push(f)}return Promise.allSettled(d).then(()=>{this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this.fire(new r.y(new Error(`Could not load models: ${i.message}`)))})}onAdd(d){this.map=d,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(d,i){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(d,i,a,f){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(d){this.map=d,this.load()}reload(){this.cancelTileJSONRequest();const d=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(d))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(d){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map.getWorldview();this._tileJSONRequest=sa(this._options,this.map._requestManager,i,a,(f,v)=>{this._tileJSONRequest=null,this._loaded=!0,f?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new r.y(f))):v&&(r.l(this,v),v.bounds&&(this.tileBounds=new Wr(v.bounds,this.minzoom,this.maxzoom)),vt(v.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),d&&d(f)})}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,i){const a=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(a,r.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=i;else{if(d.buckets){const x=Object.values(d.buckets);for(const T of x)T.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",f,v.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",f,v.bind(this),void 0,!0);function v(x,T){return d.aborted?i(null):x&&x.status!==404?i(x):(this.map._refreshExpiredTiles&&T&&d.setExpiryData(T),d.loadModelData(T,this.map.painter),d.state="loaded",void i(null))}}serialize(){return r.l({},this._options)}},canvas:class extends r.aJ{constructor(d,i,a,f){super(d,i,a,f),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(x=>typeof x!="number"))||this.fire(new r.y(new r.V(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.y(new r.V(`sources.${d}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new r.y(new r.V(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new r.y(new r.V(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.y(new r.V(`sources.${d}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(d){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof r.aL||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(i,this.canvas,i.gl.RGBA8,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends r.E{constructor(d,i,a,f){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=i,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Wr(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),r.l(this,r.ay(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.ay(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this.map=d,this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:i,y:a,z:f}=d.canonical;return this._implementation.hasTile({x:i,y:a,z:f})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,i){const{x:a,y:f,z:v}=d.tileID.canonical,x=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:a,y:f,z:v},{signal:x.signal})).then((function(T){return delete d.request,d.aborted?(d.state="unloaded",i(null)):T===void 0?(d.state="errored",i(null)):T===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",i(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(T)?(this.loadTileData(d,T),d.state="loaded",void i(null)):(d.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.code!==20&&(d.state="errored",i(T))}),d.request.cancel=()=>x.abort()}loadTileData(d,i){d.setTexture(i,this.map.painter)}unloadTile(d,i){if(d.texture&&d.texture instanceof r.T?(d.destroy(!0),d.texture&&d.texture instanceof r.T&&this.map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){const{x:a,y:f,z:v}=d.tileID.canonical;this._implementation.unloadTile({x:a,y:f,z:v})}i&&i()}abortTile(d,i){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),i&&i()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){const d=r.aC(this.id,this.scope);this.map.style.clearSource(d)}_update(){this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}}},_s=function(d,i,a,f){const v=new Da[i.type](d,i,a,f);if(v.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${v.id}`);return r.aP(["load","abort","unload","serialize","prepare"],v),v};function qo(d,i,a=""){return`${a}:${i.id||""}:${i.layer.id}:${function(f){if("layerId"in f)return`layer:${f.layerId}`;{const{featuresetId:v,importId:x}=f;return`featureset:${v}${x?`:import:${x}`:""}`}}(d.target)}`}function dl(d,i,a,f=""){if(d.uniqueFeatureID){const v=qo(d,i,f);if(a.has(v))return!0;a.add(v)}return!1}function Vs(d,i,a,f,v=!1){const x=i.sourceCache.transform,T=i.sourceCache.tilesIn(d,i.has3DLayers,v);T.sort(Ql);const I=[];for(const F of T){const V=F.tile.queryRenderedFeatures(i,F,a,f,x,v);Object.keys(V).length&&I.push({wrappedTileID:F.tile.tileID.wrapped().key,queryResults:V})}return I.length===0?{}:function(F){const V={},j={};for(const Z of F){const X=Z.queryResults,Q=Z.wrappedTileID,le=j[Q]=j[Q]||{};for(const se in X){const me=X[se],fe=le[se]=le[se]||{},De=V[se]=V[se]||[];for(const ke of me)fe[ke.featureIndex]||(fe[ke.featureIndex]=!0,De.push(ke))}}return V}(I)}function Au(d,i,a,f,v){const x={},T=f.queryRenderedSymbols(d),I=[];for(const F of Object.keys(T).map(Number))I.push(v[F]);I.sort(Ql);for(const F of I){const V=F.featureIndex.lookupSymbolFeatures(T[F.bucketInstanceId],F.bucketIndex,F.sourceLayerIndex,i,a);for(const j in V){const Z=x[j]=x[j]||[],X=V[j];X.sort((Q,le)=>{const se=F.featureSortOrder;if(se){const me=se.indexOf(Q.featureIndex);return se.indexOf(le.featureIndex)-me}return le.featureIndex-Q.featureIndex});for(const Q of X)Z.push(Q)}}return x}function Bc(d,i){const a=d.getRenderableIds().map(x=>d.getTileByID(x)),f=[],v={};for(let x=0;x<a.length;x++){const T=a[x],I=T.tileID.canonical.key;v[I]||(v[I]=!0,T.querySourceFeatures(f,i))}return f}function Ql(d,i){const a=d.tileID,f=i.tileID;return a.overscaledZ-f.overscaledZ||a.canonical.y-f.canonical.y||a.wrap-f.wrap||a.canonical.x-f.canonical.x}function fo(d,i){const a={};if(!i)return a;for(const f of d){const v=f.layerIds.map(x=>i.getLayer(x)).filter(Boolean);if(v.length!==0){f.layers=v,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map(x=>v.filter(T=>T.id===x)[0]));for(const x of v)a[x.fqid]=f}}return a}const ka=32,Do=33,xo=new Uint16Array(8184);for(let d=0;d<2046;d++){let i=d+2,a=0,f=0,v=0,x=0,T=0,I=0;for(1&i?v=x=T=ka:a=f=I=ka;(i>>=1)>1;){const V=a+v>>1,j=f+x>>1;1&i?(v=a,x=f,a=T,f=I):(a=v,f=x,v=T,x=I),T=V,I=j}const F=4*d;xo[F+0]=a,xo[F+1]=f,xo[F+2]=v,xo[F+3]=x}const Me=new Uint16Array(2178),be=new Uint8Array(1089),Fe=new Uint16Array(1089);function yt(d){return d===0?-.03125:d===32?.03125:0}const ki={type:2,extent:r.ag,loadGeometry:()=>[[new r.P(0,0),new r.P(r.ag+1,0),new r.P(r.ag+1,r.ag+1),new r.P(0,r.ag+1),new r.P(0,0)]]};class Yi{constructor(i,a,f,v,x){this.tileID=i,this.uid=r.aV(),this.uses=0,this.tileSize=a,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,v&&v.style&&(this._lastUpdatedBrightness=v.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",v&&v.transform&&(this.projection=v.transform.projection)}registerFadeDuration(i){const a=i+this.timeAdded;a<r.q.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aQ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,a,f){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=fo(i.buckets,a.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const x=this.buckets[v];if(x instanceof r.aX){if(this.hasSymbolBuckets=!0,!f)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const x=this.buckets[v];if(x instanceof r.aX&&x.hasRTLText){this.hasRTLText=!0,r.aY();break}}this.queryPadding=0;for(const v in this.buckets){const x=this.buckets[v],T=a.style.getOwnLayer(v);if(!T)continue;const I=T.queryRadius(x);this.queryPadding=Math.max(this.queryPadding,I)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new r.aW}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(i,a,f){i&&(i.resourceTiming&&(this.resourceTiming=i.resourceTiming),this.buckets=Object.assign({},this.buckets,fo(i.buckets,a.style)),i.featureIndex&&(this.latestFeatureIndex=i.featureIndex))}getBucket(i){return this.buckets[i.fqid]}upload(i){for(const v in this.buckets){const x=this.buckets[v];x.uploadPending()&&x.upload(i)}const a=i.gl,f=this.imageAtlas;if(f&&!f.uploaded){const v=!!Object.keys(f.patternPositions).length;this.imageAtlasTexture=new r.T(i,f.image,a.RGBA8,{useMipmap:v}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(i,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(i,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(i,a,f){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture,f),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const v=a.style.getBrightness();(this._lastUpdatedBrightness||v)&&(this._lastUpdatedBrightness&&v&&Math.abs(this._lastUpdatedBrightness-v)<.001||(this.updateBuckets(a,this._lastUpdatedBrightness!==v),this._lastUpdatedBrightness=v))}queryRenderedFeatures(i,a,f,v,x,T){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const I=function(F,V){const j=r.ab.mat4.fromScaling([],[.5*F.width,.5*-F.height,1]);return r.ab.mat4.translate(j,j,[1,-1,0]),r.ab.mat4.multiply(j,j,F.calculateProjMatrix(V.toUnwrapped())),Float32Array.from(j)}(x,this.tileID);return this.latestFeatureIndex.query(i,{tilespaceGeometry:a,pixelPosMatrix:I,transform:v,availableImages:f,tileTransform:this.tileTransform})}querySourceFeatures(i,a){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const v=f.loadVTLayers(),x=a?a.sourceLayer:"",T=v._geojsonTileLayer||v[x];if(!T)return;const I=r.aZ(a&&a.filter),{z:F,x:V,y:j}=this.tileID.canonical,Z={z:F,x:V,y:j};for(let X=0;X<T.length;X++){const Q=T.feature(X);if(I.needGeometry){const me=r.a_(Q,!0);if(!I.filter(new r.a8(this.tileID.overscaledZ),me,this.tileID.canonical))continue}else if(!I.filter(new r.a8(this.tileID.overscaledZ),Q))continue;const le=f.getId(Q,x),se=new r.a$(Q,F,V,j,le);se.tile=Z,i.push(se)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const a=this.expirationTime;if(i.cacheControl){const f=r.b0(i.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const f=Date.now();let v=!1;if(this.expirationTime>f)v=!1;else if(a)if(this.expirationTime<a)v=!0;else{const x=this.expirationTime-a;x?this.expirationTime=f+Math.max(x,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(i){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&i&&this.updateBuckets(i)}updateBuckets(i,a){if(!this.latestFeatureIndex||!i.style)return;const f=this.latestFeatureIndex.loadVTLayers(),v=i.style.listImages(),x=i.style.getBrightness();for(const T in this.buckets){if(!i.style.hasLayer(T))continue;const I=this.buckets[T],F=I.layers[0],V=F.sourceLayer||"_geojsonTileLayer",j=f[V],Z=i.style.getLayerSourceCache(F);let X={};Z&&(X=Z._state.getState(V,void 0));const Q=this.imageAtlas&&this.imageAtlas.patternPositions||{},le=Object.keys(X).length>0&&!a;le&&!I.stateDependentLayers.length&&!a||I.update(X,j,v,Q,le?I.stateDependentLayers:I.layers,a,x),(I instanceof r.b1||I instanceof r.b2)&&i._terrain&&i._terrain.enabled&&Z&&I.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(Z.id,this.tileID);const se=i&&i.style&&i.style.getOwnLayer(T);se&&(this.queryPadding=Math.max(this.queryPadding,se.queryRadius(I)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=r.q.now()+i}setTexture(i,a){const f=a.context,v=f.gl;this.texture=this.texture||a.getTileTexture(i.width),this.texture&&this.texture instanceof r.T?this.texture.update(i):(this.texture=new r.T(f,i,v.RGBA8,{useMipmap:!0}),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE))}setDependencies(i,a){const f={};for(const v of a)f[v]=!0;this.dependencies[i]=f}hasDependency(i,a){for(const f of i){const v=this.dependencies[f];if(v){for(const x of a)if(v[x])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const f=r.b3(ki,this.tileID.canonical,this.tileTransform)[0],v=new r.b4,x=new r.b5;for(let T=0;T<f.length;T++){const{x:I,y:F}=f[T];v.emplaceBack(I,F),x.emplaceBack(T)}x.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(x),this._tileDebugBuffer=i.createVertexBuffer(v,r.b6.members),this._tileDebugSegments=r.b7.simpleSegment(0,0,v.length,x.length)}_makeTileBoundsBuffers(i,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const f=r.b3(ki,this.tileID.canonical,this.tileTransform)[0];let v,x;if(this.isRaster){const T=function(I,F){const V=r.aQ(I,F),j=Math.pow(2,I.z);for(let me=0;me<Do;me++)for(let fe=0;fe<Do;fe++){const De=r.aR((I.x+(fe+yt(fe))/ka)/j),ke=r.aS((I.y+(me+yt(me))/ka)/j),Ne=F.project(De,ke),tt=me*Do+fe;Me[2*tt+0]=Math.round((Ne.x*V.scale-V.x)*r.ag),Me[2*tt+1]=Math.round((Ne.y*V.scale-V.y)*r.ag)}be.fill(0),Fe.fill(0);for(let me=2045;me>=0;me--){const fe=4*me,De=xo[fe+0],ke=xo[fe+1],Ne=xo[fe+2],tt=xo[fe+3],He=De+Ne>>1,We=ke+tt>>1,je=He+We-ke,at=We+De-He,gt=ke*Do+De,Jt=tt*Do+Ne,jt=We*Do+He,fi=Math.hypot((Me[2*gt+0]+Me[2*Jt+0])/2-Me[2*jt+0],(Me[2*gt+1]+Me[2*Jt+1])/2-Me[2*jt+1])>=16;be[jt]=be[jt]||(fi?1:0),me<1022&&(be[jt]=be[jt]||be[(ke+at>>1)*Do+(De+je>>1)]||be[(tt+at>>1)*Do+(Ne+je>>1)])}const Z=new r.aT,X=new r.aU;let Q=0;function le(me,fe){const De=fe*Do+me;return Fe[De]===0&&(Z.emplaceBack(Me[2*De+0],Me[2*De+1],me*r.ag/ka,fe*r.ag/ka),Fe[De]=++Q),Fe[De]-1}function se(me,fe,De,ke,Ne,tt){const He=me+De>>1,We=fe+ke>>1;if(Math.abs(me-Ne)+Math.abs(fe-tt)>1&&be[We*Do+He])se(Ne,tt,me,fe,He,We),se(De,ke,Ne,tt,He,We);else{const je=le(me,fe),at=le(De,ke),gt=le(Ne,tt);X.emplaceBack(je,at,gt)}}return se(0,0,ka,ka,ka,0),se(ka,ka,0,0,0,ka),{vertices:Z,indices:X}}(this.tileID.canonical,a);v=T.vertices,x=T.indices}else{v=new r.aT,x=new r.aU;for(const{x:I,y:F}of f)v.emplaceBack(I,F,0,0);const T=r.b8(v.int16,void 0,4);for(let I=0;I<T.length;I+=3)x.emplaceBack(T[I],T[I+1],T[I+2])}this._tileBoundsBuffer=i.createVertexBuffer(v,r.b9.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(x),this._tileBoundsSegments=r.b7.simpleSegment(0,0,v.length,x.length)}_makeGlobeTileDebugBuffers(i,a){const f=a.projection;if(!f||f.name!=="globe"||a.freezeTileCoverage)return;const v=this.tileID.canonical,x=r.ba(v,a),T=r.bb(x),I=r.ae(a.zoom);let F;I>0&&(F=r.ab.mat4.invert(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,v,a,T,F,I),this._makeGlobeTileDebugTextBuffer(i,v,a,T,F,I)}_globePoint(i,a,f,v,x,T,I){let F=r.bc(i,a,f);if(T){const V=1<<f.z,j=r.at(v.center.lng),Z=r.aA(v.center.lat),X=(f.x+.5)/V-j;let Q=0;X>.5?Q=-1:X<-.5&&(Q=1);let le=(i/r.ag+f.x)/V+Q,se=(a/r.ag+f.y)/V;le=(le-j)*v._pixelsPerMercatorPixel+j,se=(se-Z)*v._pixelsPerMercatorPixel+Z;const me=[le*v.worldSize,se*v.worldSize,0];r.ab.vec3.transformMat4(me,me,T),F=r.bd(F,me,I)}return r.ab.vec3.transformMat4(F,F,x)}_makeGlobeTileDebugBorderBuffer(i,a,f,v,x,T){const I=new r.b4,F=new r.b5,V=new r.be,j=(X,Q,le,se,me)=>{const fe=(le-X)/(me-1),De=(se-Q)/(me-1),ke=I.length;for(let Ne=0;Ne<me;Ne++){const tt=X+Ne*fe,He=Q+Ne*De;I.emplaceBack(tt,He);const We=this._globePoint(tt,He,a,f,v,x,T);V.emplaceBack(We[0],We[1],We[2]),F.emplaceBack(ke+Ne)}},Z=r.ag;j(0,0,Z,0,16),j(Z,0,Z,Z,16),j(Z,Z,0,Z,16),j(0,Z,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(F),this._tileDebugBuffer=i.createVertexBuffer(I,r.b6.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(V,r.bf.members),this._tileDebugSegments=r.b7.simpleSegment(0,0,I.length,F.length)}_makeGlobeTileDebugTextBuffer(i,a,f,v,x,T){const I=r.ag/4,F=new r.b4,V=new r.aU,j=new r.be,Z=25;V.reserve(32),F.reserve(Z),j.reserve(Z);const X=(Q,le)=>Z*Q+le;for(let Q=0;Q<Z;Q++){const le=Q*I;for(let se=0;se<Z;se++){const me=se*I;F.emplaceBack(me,le);const fe=this._globePoint(me,le,a,f,v,x,T);j.emplaceBack(fe[0],fe[1],fe[2])}}for(let Q=0;Q<4;Q++)for(let le=0;le<4;le++){const se=X(Q,le),me=X(Q,le+1),fe=X(Q+1,le),De=X(Q+1,le+1);V.emplaceBack(se,me,fe),V.emplaceBack(fe,me,De)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(V),this._tileDebugTextBuffer=i.createVertexBuffer(F,r.b6.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(j,r.bf.members),this._tileDebugTextSegments=r.b7.simpleSegment(0,0,Z,32)}destroy(i=!1){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!i&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bg.setPbf(r.bh);class wi extends Yi{constructor(i,a,f,v,x){super(i,a,f,v,x),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(i,a){const f=a.context,v=f.gl;this.texture=this.texture||a.getTileTexture(i.width),this.texture&&this.texture instanceof r.T?this.texture.update(i,{premultiply:!1}):this.texture=new r.T(f,i,v.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(i=16384,a){const f=this._mrt=new r.bg(30),v=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=r.bi(v,(x,T,I,F)=>{if(x)a(x);else try{const V=f.getHeaderLength(T);if(V>i)return void(this.request=this.fetchHeader(V,a));f.parseHeader(T),this._isHeaderLoaded=!0;let j=0;for(const Z of Object.values(f.layers))j=Math.max(j,Z.dataIndex[Z.dataIndex.length-1].last_byte);T.byteLength>=j&&(this.entireBuffer=T),a(null,this.entireBuffer||T,I,F)}catch(V){a(V)}}),this.request}fetchBand(i,a,f){const v=this._mrt;if(!this._isHeaderLoaded||!v)return void f(new Error("Tile header is not ready"));const x=this.actor;if(!x)return void f(new Error("Can't fetch tile band without an actor"));let T;const I=(Z,X)=>{T.complete(Z,X),Z?f(Z):(this.updateTextureDescriptor(i,a),f(null,this.textureDescriptor&&this.textureDescriptor.img))},F=(Z,X)=>{if(Z)return f(Z);const Q=x.send("decodeRasterArray",{buffer:X,task:T},I,void 0,!0);this._workQueue.push(()=>{Q&&Q.cancel(),T.cancel()})},V=v.getLayer(i);if(!V)return void f(new Error(`Unknown sourceLayer "${i}"`));if(V.hasDataForBand(a))return this.updateTextureDescriptor(i,a),void f(null,this.textureDescriptor?this.textureDescriptor.img:null);const j=V.getDataRange([a]);if(T=v.createDecodingTask(j),!T||T.tasks.length)if(this.flushQueues(),this.entireBuffer)F(null,this.entireBuffer.slice(j.firstByte,j.lastByte+1));else{const Z=Object.assign({},this.requestParams,{headers:{Range:`bytes=${j.firstByte}-${j.lastByte}`}}),X=r.bi(Z,F);this._fetchQueue.push(()=>{X.cancel(),T.cancel()})}else f(null)}updateNeeded(i,a){return(!this.textureDescriptor||this.textureDescriptor.band!==a||this.textureDescriptor.layer!==i)&&this.state!=="errored"}updateTextureDescriptor(i,a){if(!this._mrt)return;const f=this._mrt.getLayer(i);if(!f||!f.hasBand(a)||!f.hasDataForBand(a))return;const{bytes:v,tileSize:x,buffer:T,offset:I,scale:F}=f.getBandView(a),V=x+2*T,j={data:v,width:V,height:V},Z=this.texture;Z&&Z instanceof r.T&&Z.update(j,{premultiply:!1}),this.textureDescriptor={layer:i,band:a,img:j,buffer:T,offset:I,tileSize:x,format:f.pixelFormat,mix:[F,256*F,65536*F,16777216*F]}}}class hn{constructor(i,a){this.max=i,this.onRemove=a,this.reset()}reset(){for(const i in this.data)for(const a of this.data[i])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(i,a,f){const v=i.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const x={value:a,timeout:void 0};if(f!==void 0&&(x.timeout=setTimeout(()=>{this.remove(i,x)},f)),this.data[v].push(x),this.order.push(v),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const a=this.data[i].shift();return a.timeout&&clearTimeout(a.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),a.value}getByKey(i){const a=this.data[i];return a?a[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,a){if(!this.has(i))return this;const f=i.wrapped().key,v=a===void 0?0:this.data[f].indexOf(a),x=this.data[f][v];return this.data[f].splice(v,1),x.timeout&&clearTimeout(x.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(x.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(i){const a=[];for(const f in this.data)for(const v of this.data[f])i(v.value)||a.push(v);for(const f of a)this.remove(f.value.tileID,f)}}class xe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,a,f){const v=String(a);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][v]=this.stateChanges[i][v]||{},r.l(this.stateChanges[i][v],f),this.deletedStates[i]===null){this.deletedStates[i]={};for(const x in this.state[i])x!==v&&(this.deletedStates[i][x]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][v]===null){this.deletedStates[i][v]={};for(const x in this.state[i][v])f[x]||(this.deletedStates[i][v][x]=null)}else for(const x in f)this.deletedStates[i]&&this.deletedStates[i][v]&&this.deletedStates[i][v][x]===null&&delete this.deletedStates[i][v][x]}removeFeatureState(i,a,f){if(this.deletedStates[i]===null)return;const v=String(a);if(this.deletedStates[i]=this.deletedStates[i]||{},f&&a!==void 0)this.deletedStates[i][v]!==null&&(this.deletedStates[i][v]=this.deletedStates[i][v]||{},this.deletedStates[i][v][f]=null);else if(a!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][v])for(f in this.deletedStates[i][v]={},this.stateChanges[i][v])this.deletedStates[i][v][f]=null;else this.deletedStates[i][v]=null;else this.deletedStates[i]=null}getState(i,a){const f=this.state[i]||{},v=this.stateChanges[i]||{},x=this.deletedStates[i];if(x===null)return{};if(a!==void 0){const I=String(a),F=r.l({},f[I],v[I]);if(x){const V=x[a];if(V===null)return{};for(const j in V)delete F[j]}return F}const T=r.l({},f,v);if(x)for(const I in x)delete T[I];return T}initializeTileState(i,a){i.refreshFeatureState(a)}coalesceChanges(i,a){const f={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const x={};for(const T in this.stateChanges[v])this.state[v][T]||(this.state[v][T]={}),r.l(this.state[v][T],this.stateChanges[v][T]),x[T]=this.state[v][T];f[v]=x}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const x={};if(this.deletedStates[v]===null)for(const T in this.state[v])x[T]={},this.state[v][T]={};else for(const T in this.deletedStates[v]){if(this.deletedStates[v][T]===null)this.state[v][T]={};else if(this.state[v][T])for(const I of Object.keys(this.deletedStates[v][T]))delete this.state[v][T][I];x[T]=this.state[v][T]}f[v]=f[v]||{},r.l(f[v],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const v in i)i[v].refreshFeatureState(a)}}class he extends r.E{constructor(i,a,f){super(),this.id=i,this._onlySymbols=f,a.on("data",v=>{v.dataType==="source"&&v.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&v.dataType==="source"&&v.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new hn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new xe,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(i){this.map=i,this._minTileCacheSize=this._minTileCacheSize===void 0&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const a=this._tiles[i];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,a){return i.isSymbolTile=this._onlySymbols,i.isExtraShadowCaster=this._shadowCasterTiles[i.tileID.key],this._source.loadTile(i,a)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i)}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i)}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const f=this._tiles[a];f.upload(i),f.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return r.bj(this._tiles).map(i=>i.tileID).sort(we).map(i=>i.key)}getRenderableIds(i,a){const f=[];for(const v in this._tiles)this._isIdRenderable(+v,i,a)&&f.push(this._tiles[v]);return i?f.sort((v,x)=>{const T=v.tileID,I=x.tileID,F=new r.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),V=new r.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-I.overscaledZ||V.y-F.y||V.x-F.x}).map(v=>v.tileID.key):f.map(v=>v.tileID).sort(we).map(v=>v.key)}hasRenderableParent(i){const a=this.findLoadedParent(i,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(i,a,f){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(a||!this._tiles[i].holdingForFade())&&(f||!this._shadowCasterTiles[i])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,a){const f=this._tiles[i];f&&(f.state!=="loading"&&(f.state=a),this._loadTile(f,this._tileLoaded.bind(this,f,i,a)))}_tileLoaded(i,a,f,v){if(v)if(i.state="errored",v.status!==404)this._source.fire(new r.y(v,{tile:i}));else{if(this._source.fire(new r.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:i})),!(i.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform)}else i.timeAdded=r.q.now(),f==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(a,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new r.z("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const a=this.getRenderableIds();for(let v=0;v<a.length;v++){const x=a[v];if(i.neighboringTiles&&i.neighboringTiles[x]){const T=this.getTileByID(x);f(i,T),f(T,i)}}function f(v,x){if(!v.dem||v.dem.borderReady)return;v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0;let T=x.tileID.canonical.x-v.tileID.canonical.x;const I=x.tileID.canonical.y-v.tileID.canonical.y,F=Math.pow(2,v.tileID.canonical.z),V=x.tileID.key;T===0&&I===0||Math.abs(I)>1||(Math.abs(T)>1&&(Math.abs(T+F)===1?T+=F:Math.abs(T-F)===1&&(T-=F)),x.dem&&v.dem&&(v.dem.backfillBorder(x.dem,T,I),v.neighboringTiles&&v.neighboringTiles[V]&&(v.neighboringTiles[V].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,a,f,v){for(const x in this._tiles){let T=this._tiles[x];if(v[x]||!T.hasData()||T.tileID.overscaledZ<=a||T.tileID.overscaledZ>f)continue;let I=T.tileID;for(;T&&T.tileID.overscaledZ>a+1;){const V=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[V.key],T&&T.hasData()&&(I=V)}let F=I;for(;F.overscaledZ>a;)if(F=F.scaledTo(F.overscaledZ-1),i[F.key]){v[I.key]=I;break}}}findLoadedParent(i,a){if(i.key in this._loadedParentTiles){const f=this._loadedParentTiles[i.key];return f&&f.tileID.overscaledZ>=a?f:null}for(let f=i.overscaledZ-1;f>=a;f--){const v=i.scaledTo(f),x=this._getLoadedTile(v);if(x)return x}}_getLoadedTile(i){const a=this._tiles[i.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,a){a=a||this._source.tileSize;const f=Math.ceil(i.width/a)+1,v=Math.ceil(i.height/a)+1,x=Math.floor(f*v*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,x):x,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(I)}handleWrapJump(i){const a=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,a){const f={};for(const v in this._tiles){const x=this._tiles[v];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+a),f[x.tileID.key]=x}this._tiles=f;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(+v,this._tiles[v])}}update(i,a,f,v){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;this.updateCacheSize(i,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const x=this._source.type==="batched-model";let T,I=this._source.maxzoom;const F=this.map&&this.map.painter?this.map.painter._terrain:null;if(F&&F.sourceCache===this&&F.attenuationRange()){const Z=F.attenuationRange()[0],X=Math.floor(Z)-Math.log2(F.getDemUpscale());I>X&&(I=X)}if(this.used||this.usedForTerrain){if(this._source.tileID)T=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(Z=>new r.aG(Z.canonical.z,Z.wrap,Z.canonical.z,Z.canonical.x,Z.canonical.y));else if(this.tileCoverLift!==0){const Z=i.clone();Z.tileCoverLift=this.tileCoverLift,T=Z.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.minzoom<=1&&i.projection.name==="globe"&&(T.push(new r.aG(1,0,1,0,0)),T.push(new r.aG(1,0,1,1,0)),T.push(new r.aG(1,0,1,0,1)),T.push(new r.aG(1,0,1,1,1)))}else if(T=i.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.hasTile){const Z=this._source.hasTile.bind(this._source);T=T.filter(X=>Z(X))}}else T=[];if(T.length>0&&this.castsShadows&&v&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Ve(this._source.type)){const Z=i.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!f}),X=Math.min(Z,this._source.maxzoom);if(x){const Q=i.extendTileCover(T,X);for(const le of Q)T.push(le)}else{const Q=i.extendTileCover(T,X,v);for(const le of Q)this._shadowCasterTiles[le.key]=!0,T.push(le)}}const V=this._updateRetainedTiles(T);if(Ve(this._source.type)&&T.length!==0){const Z={},X={},Q=Object.keys(V);for(const se of Q){const me=V[se],fe=this._tiles[se];if(!fe||fe.fadeEndTime&&fe.fadeEndTime<=r.q.now())continue;const De=this.findLoadedParent(me,Math.max(me.overscaledZ-he.maxOverzooming,this._source.minzoom));De&&(this._addTile(De.tileID),Z[De.tileID.key]=De.tileID),X[se]=me}const le=T[T.length-1].overscaledZ;for(const se in this._tiles){const me=this._tiles[se];if(V[se]||!me.hasData())continue;let fe=me.tileID;for(;fe.overscaledZ>le;){fe=fe.scaledTo(fe.overscaledZ-1);const De=this._tiles[fe.key];if(De&&De.hasData()&&X[fe.key]){V[se]=me.tileID;break}}}for(const se in Z)V[se]||(this._coveredTiles[se]=!0,V[se]=Z[se])}for(const Z in V)this._tiles[Z].clearFadeHold();const j=r.bk(this._tiles,V);for(const Z of j){const X=this._tiles[Z];X.hasSymbolBuckets&&!X.holdingForFade()?X.setHoldDuration(this.map._fadeDuration):X.hasSymbolBuckets&&!X.symbolFadeFinished()||this._removeTile(+Z)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const a={};if(i.length===0)return a;const f={},v=i.reduce((V,j)=>Math.min(V,j.overscaledZ),1/0),x=i[0].overscaledZ,T=Math.max(x-he.maxOverzooming,this._source.minzoom),I=Math.max(x+he.maxUnderzooming,this._source.minzoom),F={};for(const V of i){const j=this._addTile(V);a[V.key]=V,j.hasData()||v<this._source.maxzoom&&(F[V.key]=V)}this._retainLoadedChildren(F,v,I,a);for(const V of i){let j=this._tiles[V.key];if(j.hasData())continue;if(V.canonical.z>=this._source.maxzoom){const X=V.children(this._source.maxzoom)[0],Q=this.getTile(X);if(Q&&Q.hasData()){a[X.key]=X;continue}}else{const X=V.children(this._source.maxzoom);if(a[X[0].key]&&a[X[1].key]&&a[X[2].key]&&a[X[3].key])continue}let Z=j.wasRequested();for(let X=V.overscaledZ-1;X>=T;--X){const Q=V.scaledTo(X);if(f[Q.key]||(f[Q.key]=!0,j=this.getTile(Q),!j&&Z&&(j=this._addTile(Q)),j&&(a[Q.key]=Q,Z=j.wasRequested(),j.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const a=[];let f,v=this._tiles[i].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){f=this._loadedParentTiles[v.key];break}a.push(v.key);const x=v.scaledTo(v.overscaledZ-1);if(f=this._getLoadedTile(x),f)break;v=x}for(const x of a)this._loadedParentTiles[x]=f}}_addTile(i){let a=this._tiles[i.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),a;a=this._cache.getAndRemove(i),a&&(this._setTileReloadTimer(i.key,a),a.tileID=i,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,a)));const f=!!a;if(!f){const v=this.map?this.map.painter:null,x=this._source.tileSize*i.overscaleFactor();a=this._source.type==="raster-array"?new wi(i,x,this.transform.tileZoom,v,this._isRaster):new Yi(i,x,this.transform.tileZoom,v,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,i.key,a.state))}return a?(a.uses++,this._tiles[i.key]=a,f||this._source.fire(new r.z("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(i,a){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const f=a.getExpiryTimeout();f&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},f))}_removeTile(i){const a=this._tiles[i];a&&(a.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,a,f){const v=[],x=this.transform;if(!x)return v;const T=x.projection.name==="globe",I=r.at(x.center.lng);for(const F in this._tiles){const V=this._tiles[F];if(f&&V.clearQueryDebugViz(),V.holdingForFade())continue;let j;if(T){const Z=V.tileID.canonical;if(Z.z===0){const X=[Math.abs(r.aw(I,...Ee(Z,-1))-I),Math.abs(r.aw(I,...Ee(Z,1))-I)];j=[0,2*X.indexOf(Math.min(...X))-1]}else{const X=[Math.abs(r.aw(I,...Ee(Z,-1))-I),Math.abs(r.aw(I,...Ee(Z,0))-I),Math.abs(r.aw(I,...Ee(Z,1))-I)];j=[X.indexOf(Math.min(...X))-1]}}else j=[0];for(const Z of j){const X=i.containsTile(V,x,a,Z);X&&v.push(X)}}return v}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(i){return this._getRenderableCoordinates(i)}_getRenderableCoordinates(i,a){const f=this.getRenderableIds(i,a).map(x=>this._tiles[x].tileID),v=this.transform.projection.name==="globe";for(const x of f)x.projMatrix=this.transform.calculateProjMatrix(x.toUnwrapped()),x.expandedProjMatrix=v?this.transform.calculateProjMatrix(x.toUnwrapped(),!1,!0):x.projMatrix;return f}sortCoordinatesByDistance(i){const a=i.slice(),f=this.transform._camera.position,v=this.transform._camera.forward(),x={};for(const T of a){const I=1/(1<<T.canonical.z);x[T.key]=((T.canonical.x+.5)*I+T.wrap-f[0])*v[0]+((T.canonical.y+.5)*I-f[1])*v[1]-f[2]*v[2]}return a.sort((T,I)=>x[T.key]-x[I.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if(Ve(this._source.type))for(const i in this._tiles){const a=this._tiles[i];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=r.q.now())return!0}return!1}setFeatureState(i,a,f){this._state.updateState(i=i||"_geojsonTileLayer",a,f)}removeFeatureState(i,a,f){this._state.removeFeatureState(i=i||"_geojsonTileLayer",a,f)}getFeatureState(i,a){return this._state.getState(i=i||"_geojsonTileLayer",a)}setDependencies(i,a,f){const v=this._tiles[i];v&&v.setDependencies(a,f)}reloadTilesForDependencies(i,a){for(const f in this._tiles)this._tiles[f].hasDependency(i,a)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(i,a))}_preloadTiles(i,a){if(!this._sourceLoaded){const F=()=>{this._sourceLoaded&&(this._source.off("data",F),this._preloadTiles(i,a))};return void this._source.on("data",F)}const f=new Map,v=Array.isArray(i)?i:[i],x=this.map.painter.terrain,T=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const F of v){const V=F.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const j of V)f.set(j.key,j);this.usedForTerrain&&F.updateElevation(!1)}const I=Array.from(f.values());r.bl(I,(F,V)=>{const j=new Yi(F,this._source.tileSize*F.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(j,Z=>{this._source.type==="raster-dem"&&j.dem&&this._backfillDEM(j),V(Z,j)})},a)}}function we(d,i){const a=Math.abs(2*d.wrap)-+(d.wrap<0),f=Math.abs(2*i.wrap)-+(i.wrap<0);return d.overscaledZ-i.overscaledZ||f-a||i.canonical.y-d.canonical.y||i.canonical.x-d.canonical.x}function Ve(d){return d==="raster"||d==="image"||d==="video"||d==="custom"}function Ee(d,i){const a=1<<d.z;return[d.x/a+i,(d.x+1)/a+i]}he.maxOverzooming=10,he.maxUnderzooming=3;class ri{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const i=!1,a=!1;for(const f in this.style._mergedLayers){const v=this.style._mergedLayers[f];if(v.type==="fill-extrusion")this.layers.push({layer:v,visible:i,visibilityChanged:a});else if(v.type==="model"){const x=this.style.getLayerSource(v);x&&x.type==="batched-model"&&this.layers.push({layer:v,visible:i,visibilityChanged:a})}}}onNewFrame(i){this.layersGotHidden=!1;for(const a of this.layers){const f=a.layer;let v=!1;f.type==="fill-extrusion"?v=!f.isHidden(i)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="model"&&(v=!f.isHidden(i)&&f.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!v&&a.visible,a.visible=v}}updateZOffset(i,a){this.currentBuildingBuckets=[];for(const v of this.layers){const x=v.layer,T=this.style.getLayerSourceCache(x);let I=1;x.type==="fill-extrusion"&&(I=v.visible?x.paint.get("fill-extrusion-vertical-scale"):0);let F=T?T.getTile(a):null;if(!F&&T&&a.canonical.z>T.getSource().minzoom){let V=a.scaledTo(Math.min(T.getSource().maxzoom,a.overscaledZ-1));for(;V.overscaledZ>=T.getSource().minzoom&&(F=T.getTile(V),!F&&V.overscaledZ!==0);)V=V.scaledTo(V.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:F?F.getBucket(x):null,tileID:F?F.tileID:a,verticalScale:I})}i.hasAnyZOffset=!1;let f=!1;for(let v=0;v<i.symbolInstances.length;v++){const x=i.symbolInstances.get(v),T=x.zOffset,I=this._getHeightAtTileOffset(a,x.tileAnchorX,x.tileAnchorY);x.zOffset=I!==Number.NEGATIVE_INFINITY?I:T,f||T===x.zOffset||(f=!0),i.hasAnyZOffset||x.zOffset===0||(i.hasAnyZOffset=!0)}f&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,a,f,v){let x=a,T=f;if(i.canonical.z!==v.canonical.z){const I=v.canonical,F=1/(1<<i.canonical.z-I.z);x=(a+i.canonical.x*r.ag)*F-I.x*r.ag|0,T=(f+i.canonical.y*r.ag)*F-I.y*r.ag|0}return{tileX:x,tileY:T}}_getHeightAtTileOffset(i,a,f){let v,x;for(let T=0;T<this.layers.length;++T){if(this.layers[T].layer.type!=="fill-extrusion")continue;const{bucket:I,tileID:F,verticalScale:V}=this.currentBuildingBuckets[T];if(!I)continue;const{tileX:j,tileY:Z}=this._mapCoordToOverlappingTile(i,a,f,F),X=I.getHeightAtTileCoord(j,Z);X&&X.height!==void 0&&(X.hidden?v=X.height:x=Math.max(X.height*V,x||0))}if(x!==void 0)return x;for(let T=0;T<this.layers.length;++T){const I=this.layers[T];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:F,tileID:V}=this.currentBuildingBuckets[T];if(!F)continue;const{tileX:j,tileY:Z}=this._mapCoordToOverlappingTile(i,a,f,V),X=F.getHeightAtTileCoord(j,Z);if(X&&!X.hidden)return X.height===void 0&&v!==void 0?Math.min(X.maxHeight,v)*X.verticalScale:X.height?X.height*X.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Ei(d,i){const a={};for(const f in d)f!=="ref"&&(a[f]=d[f]);return r.bm.forEach(f=>{f in i&&(a[f]=i[f])}),a}function sn(d){d=d.slice();const i=Object.create(null);for(let a=0;a<d.length;a++)i[d[a].id]=d[a];for(let a=0;a<d.length;a++)"ref"in d[a]&&(d[a]=Ei(d[a],i[d[a].ref]));return d}const Di={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Jn(d,i,a){a.push({command:Di.addSource,args:[d,i[d]]})}function on(d,i,a){i.push({command:Di.removeSource,args:[d]}),a[d]=!0}function Ft(d,i,a,f){on(d,a,f),Jn(d,i,a)}function yn(d,i,a){let f;for(f in d[a])if(d[a].hasOwnProperty(f)&&f!=="data"&&!r.bn(d[a][f],i[a][f]))return!1;for(f in i[a])if(i[a].hasOwnProperty(f)&&f!=="data"&&!r.bn(d[a][f],i[a][f]))return!1;return!0}function Si(d,i,a,f,v,x){let T;for(T in i=i||{},d=d||{})d.hasOwnProperty(T)&&(r.bn(d[T],i[T])||a.push({command:x,args:[f,T,i[T],v]}));for(T in i)i.hasOwnProperty(T)&&!d.hasOwnProperty(T)&&(r.bn(d[T],i[T])||a.push({command:x,args:[f,T,i[T],v]}))}function qn(d){return d.id}function rn(d,i){return d[i.id]=i,d}class Cn{constructor(i,a){this.reset(i,a)}reset(i,a){this.points=i||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=r.aw(i,0,1);let a=1,f=this._distances[a];const v=i*this.paddedLength+this.padding;for(;f<v&&a<this._distances.length;)f=this._distances[++a];const x=a-1,T=this._distances[x],I=f-T,F=I>0?(v-T)/I:0;return this.points[x].mult(1-F).add(this.points[a].mult(F))}}class Ar{constructor(i,a,f){const v=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(i/f),this.yCellCount=Math.ceil(a/f);for(let T=0;T<this.xCellCount*this.yCellCount;T++)v.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=a,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,a,f,v,x){this._forEachCell(a,f,v,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(a),this.bboxes.push(f),this.bboxes.push(v),this.bboxes.push(x)}insertCircle(i,a,f,v){this._forEachCell(a-v,f-v,a+v,f+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(a),this.circles.push(f),this.circles.push(v)}_insertBoxCell(i,a,f,v,x,T){this.boxCells[x].push(T)}_insertCircleCell(i,a,f,v,x,T){this.circleCells[x].push(T)}_query(i,a,f,v,x,T){if(f<0||i>this.width||v<0||a>this.height)return!x&&[];const I=[];if(i<=0&&a<=0&&this.width<=f&&this.height<=v){if(x)return!0;for(let F=0;F<this.boxKeys.length;F++)I.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const V=this.circles[3*F],j=this.circles[3*F+1],Z=this.circles[3*F+2];I.push({key:this.circleKeys[F],x1:V-Z,y1:j-Z,x2:V+Z,y2:j+Z})}return T?I.filter(T):I}return this._forEachCell(i,a,f,v,this._queryCell,I,{hitTest:x,seenUids:{box:{},circle:{}}},T),x?I.length>0:I}_queryCircle(i,a,f,v,x){const T=i-f,I=i+f,F=a-f,V=a+f;if(I<0||T>this.width||V<0||F>this.height)return!v&&[];const j=[];return this._forEachCell(T,F,I,V,this._queryCellCircle,j,{hitTest:v,circle:{x:i,y:a,radius:f},seenUids:{box:{},circle:{}}},x),v?j.length>0:j}query(i,a,f,v,x){return this._query(i,a,f,v,!1,x)}hitTest(i,a,f,v,x){return this._query(i,a,f,v,!0,x)}hitTestCircle(i,a,f,v){return this._queryCircle(i,a,f,!0,v)}_queryCell(i,a,f,v,x,T,I,F){const V=I.seenUids,j=this.boxCells[x];if(j!==null){const X=this.bboxes;for(const Q of j)if(!V.box[Q]){V.box[Q]=!0;const le=4*Q;if(i<=X[le+2]&&a<=X[le+3]&&f>=X[le+0]&&v>=X[le+1]&&(!F||F(this.boxKeys[Q]))){if(I.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Q],x1:X[le],y1:X[le+1],x2:X[le+2],y2:X[le+3]})}}}const Z=this.circleCells[x];if(Z!==null){const X=this.circles;for(const Q of Z)if(!V.circle[Q]){V.circle[Q]=!0;const le=3*Q;if(this._circleAndRectCollide(X[le],X[le+1],X[le+2],i,a,f,v)&&(!F||F(this.circleKeys[Q]))){if(I.hitTest)return T.push(!0),!0;{const se=X[le],me=X[le+1],fe=X[le+2];T.push({key:this.circleKeys[Q],x1:se-fe,y1:me-fe,x2:se+fe,y2:me+fe})}}}}}_queryCellCircle(i,a,f,v,x,T,I,F){const V=I.circle,j=I.seenUids,Z=this.boxCells[x];if(Z!==null){const Q=this.bboxes;for(const le of Z)if(!j.box[le]){j.box[le]=!0;const se=4*le;if(this._circleAndRectCollide(V.x,V.y,V.radius,Q[se+0],Q[se+1],Q[se+2],Q[se+3])&&(!F||F(this.boxKeys[le])))return T.push(!0),!0}}const X=this.circleCells[x];if(X!==null){const Q=this.circles;for(const le of X)if(!j.circle[le]){j.circle[le]=!0;const se=3*le;if(this._circlesCollide(Q[se],Q[se+1],Q[se+2],V.x,V.y,V.radius)&&(!F||F(this.circleKeys[le])))return T.push(!0),!0}}}_forEachCell(i,a,f,v,x,T,I,F){const V=this._convertToXCellCoord(i),j=this._convertToYCellCoord(a),Z=this._convertToXCellCoord(f),X=this._convertToYCellCoord(v);for(let Q=V;Q<=Z;Q++)for(let le=j;le<=X;le++)if(x.call(this,i,a,f,v,this.xCellCount*le+Q,T,I,F))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,a,f,v,x,T){const I=v-i,F=x-a,V=f+T;return V*V>I*I+F*F}_circleAndRectCollide(i,a,f,v,x,T,I){const F=(T-v)/2,V=Math.abs(i-(v+F));if(V>F+f)return!1;const j=(I-x)/2,Z=Math.abs(a-(x+j));if(Z>j+f)return!1;if(V<=F||Z<=j)return!0;const X=V-F,Q=Z-j;return X*X+Q*Q<=f*f}}const Ir={unknown:0,flipRequired:1,flipNotRequired:2},Gr=Math.tan(85*Math.PI/180);function Lr(d,i,a,f,v,x,T){const I=r.ab.mat4.create();if(a)if(x.name==="globe"){const F=r.bo(v,i);r.ab.mat4.multiply(I,I,F)}else{const F=r.ab.mat2.invert([],T);I[0]=F[0],I[1]=F[1],I[4]=F[2],I[5]=F[3],f||r.ab.mat4.rotateZ(I,I,v.angle)}else r.ab.mat4.multiply(I,v.labelPlaneMatrix,d);return I}function xr(d,i,a,f,v,x,T){const I=Lr(d,i,a,f,v,x,T);return x.name==="globe"&&a||(I[2]=I[6]=I[10]=I[14]=0),I}function On(d,i,a,f,v,x,T){if(a){if(x.name==="globe"){const I=Lr(d,i,a,f,v,x,T);return r.ab.mat4.invert(I,I),r.ab.mat4.multiply(I,d,I),I}{const I=r.ab.mat4.clone(d),F=r.ab.mat4.identity([]);return F[0]=T[0],F[1]=T[1],F[4]=T[2],F[5]=T[3],r.ab.mat4.multiply(I,I,F),f||r.ab.mat4.rotateZ(I,I,-v.angle),I}}return v.glCoordMatrix}function fa(d,i,a,f){const v=[d,i,a,1];a?r.ab.vec4.transformMat4(v,v,f):Wo(v,v,f);const x=v[3];return v[0]/=x,v[1]/=x,v[2]/=x,v}function $r(d,i){return Math.min(.5+d/i*.5,1.5)}function Ms(d,i){const a=d[0]/d[3],f=d[1]/d[3];return a>=-i[0]&&a<=i[0]&&f>=-i[1]&&f<=i[1]}function aa(d,i,a,f,v,x,T,I,F,V){const j=a.transform,Z=f?d.textSizeData:d.iconSizeData,X=r.bp(Z,a.transform.zoom),Q=j.projection.name==="globe",le=[256/a.width*2+1,256/a.height*2+1],se=f?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;se.clear();let me=null;Q&&(me=f?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const fe=d.lineVertexArray,De=f?d.text.placedSymbolArray:d.icon.placedSymbolArray,ke=a.transform.width/a.transform.height;let Ne,tt=!1;for(let He=0;He<De.length;He++){const We=De.get(He),{numGlyphs:je,writingMode:at}=We;if(at!==r.bq.vertical||tt||Ne===r.bq.horizontal||(tt=!0),Ne=at,(We.hidden||at===r.bq.vertical)&&!tt){_a(je,se);continue}tt=!1;const gt=new r.P(We.tileAnchorX,We.tileAnchorY);let{x:Jt,y:jt,z:fi}=j.projection.projectTilePoint(gt.x,gt.y,V.canonical);if(F){const[yi,Hi,en]=F(gt);Jt+=yi,jt+=Hi,fi+=en}const ui=[Jt,jt,fi,1];if(r.ab.vec4.transformMat4(ui,ui,i),!Ms(ui,le)){_a(je,se);continue}const Pt=ui[3],Kt=$r(a.transform.getCameraToCenterDistance(j.projection),Pt),Ii=r.br(Z,X,We),Et=T?Ii/Kt:Ii*Kt,hi=fa(Jt,jt,fi,v);if(hi[3]<=0){_a(je,se);continue}let si={};const an=T?null:F,zi=Fs(We,Et,!1,I,i,v,x,d.glyphOffsetArray,fe,se,me,hi,gt,si,ke,an,j.projection,V,T);tt=zi.useVertical,an&&zi.needsFlipping&&(si={}),(zi.notEnoughRoom||tt||zi.needsFlipping&&Fs(We,Et,!0,I,i,v,x,d.glyphOffsetArray,fe,se,me,hi,gt,si,ke,an,j.projection,V,T).notEnoughRoom)&&_a(je,se)}f?(d.text.dynamicLayoutVertexBuffer.updateData(se),me&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(me)):(d.icon.dynamicLayoutVertexBuffer.updateData(se),me&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(me))}function Qs(d,i,a,f,v,x,T,I,F,V,j,Z,X,Q,le,se){const{lineStartIndex:me,glyphStartIndex:fe,segment:De}=I,ke=fe+I.numGlyphs,Ne=me+I.lineLength,tt=i.getoffsetX(fe),He=i.getoffsetX(ke-1),We=Gs(d*tt,a,f,v,x,T,De,me,Ne,F,V,j,Z,X,!0,Q,le,se);if(!We)return null;const je=Gs(d*He,a,f,v,x,T,De,me,Ne,F,V,j,Z,X,!0,Q,le,se);return je?{first:We,last:je}:null}function ds(d,i,a,f){return d===r.bq.horizontal&&Math.abs(f)>Math.abs(a)?{useVertical:!0}:d===r.bq.vertical?f>0?{needsFlipping:!0}:null:i!==Ir.unknown&&function(v,x){return v===0||Math.abs(x/v)>Gr}(a,f)?i===Ir.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function Fs(d,i,a,f,v,x,T,I,F,V,j,Z,X,Q,le,se,me,fe,De){const ke=i/24,Ne=d.lineOffsetX*ke,tt=d.lineOffsetY*ke,{lineStartIndex:He,glyphStartIndex:We,numGlyphs:je,segment:at,writingMode:gt,flipState:Jt}=d,jt=He+d.lineLength,fi=ui=>{if(j){const[Et,hi,si]=ui.up,an=V.length;r.bs(j,an+0,Et,hi,si),r.bs(j,an+1,Et,hi,si),r.bs(j,an+2,Et,hi,si),r.bs(j,an+3,Et,hi,si)}const[Pt,Kt,Ii]=ui.point;r.bt(V,Pt,Kt,Ii,ui.angle)};if(je>1){const ui=Qs(ke,I,Ne,tt,a,Z,X,d,F,x,Q,se,!1,me,fe,De);if(!ui)return{notEnoughRoom:!0};if(f&&!a){let[Pt,Kt,Ii]=ui.first.point,[Et,hi,si]=ui.last.point;[Pt,Kt]=fa(Pt,Kt,Ii,T),[Et,hi]=fa(Et,hi,si,T);const an=ds(gt,Jt,(Et-Pt)*le,hi-Kt);if(d.flipState=an&&an.needsFlipping?Ir.flipRequired:Ir.flipNotRequired,an)return an}fi(ui.first);for(let Pt=We+1;Pt<We+je-1;Pt++){const Kt=Gs(ke*I.getoffsetX(Pt),Ne,tt,a,Z,X,at,He,jt,F,x,Q,se,!1,!1,me,fe,De);if(!Kt)return V.length-=4*(Pt-We),{notEnoughRoom:!0};fi(Kt)}fi(ui.last)}else{if(f&&!a){const Pt=fa(X.x,X.y,0,v),Kt=He+at+1,Ii=new r.P(F.getx(Kt),F.gety(Kt)),Et=fa(Ii.x,Ii.y,0,v),hi=Et[3]>0?Et:al(X,Ii,Pt,1,v,void 0,me,fe.canonical),si=ds(gt,Jt,(hi[0]-Pt[0])*le,hi[1]-Pt[1]);if(d.flipState=si&&si.needsFlipping?Ir.flipRequired:Ir.flipNotRequired,si)return si}const ui=Gs(ke*I.getoffsetX(We),Ne,tt,a,Z,X,at,He,jt,F,x,Q,se,!1,!1,me,fe,De);if(!ui)return{notEnoughRoom:!0};fi(ui)}return{}}function Ts(d,i,a,f,v){const{x,y:T,z:I}=f.projectTilePoint(d.x,d.y,i);if(!v)return fa(x,T,I,a);const[F,V,j]=v(d);return fa(x+F,T+V,I+j,a)}function al(d,i,a,f,v,x,T,I){const F=Ts(d.sub(i)._unit()._add(d),I,v,T,x);return r.ab.vec3.sub(F,a,F),r.ab.vec3.normalize(F,F),r.ab.vec3.scaleAndAdd(F,a,F,f)}function Gs(d,i,a,f,v,x,T,I,F,V,j,Z,X,Q,le,se,me,fe){const De=f?d-i:d+i;let ke=De>0?1:-1,Ne=0;f&&(ke*=-1,Ne=Math.PI),ke<0&&(Ne+=Math.PI);let tt=I+T+(ke>0?0:1)|0,He=v,We=v,je=0,at=0;const gt=Math.abs(De),Jt=[],jt=[];let fi=x,ui=fi;const Pt=()=>al(ui,fi,We,gt-je+1,j,X,se,me.canonical);for(;je+at<=gt;){if(tt+=ke,tt<I||tt>=F)return null;if(We=He,ui=fi,Jt.push(We),Q&&jt.push(ui),fi=new r.P(V.getx(tt),V.gety(tt)),He=Z[tt],!He){const Hi=Ts(fi,me.canonical,j,se,X);He=Hi[3]>0?Z[tt]=Hi:Pt()}je+=at,at=r.ab.vec3.distance(We,He)}le&&X&&(Z[tt]&&(He=Pt(),at=r.ab.vec3.distance(We,He)),Z[tt]=He);const Kt=(gt-je)/at,Ii=fi.sub(ui)._mult(Kt)._add(ui),Et=r.ab.vec3.sub([],He,We),hi=r.ab.vec3.scaleAndAdd([],We,Et,Kt);let si=[0,0,1],an=Et[0],zi=Et[1];if(fe&&(si=se.upVector(me.canonical,Ii.x,Ii.y),si[0]!==0||si[1]!==0||si[2]!==1)){const Hi=[si[2],0,-si[0]],en=r.ab.vec3.cross([],si,Hi);r.ab.vec3.normalize(Hi,Hi),r.ab.vec3.normalize(en,en),an=r.ab.vec3.dot(Et,Hi),zi=r.ab.vec3.dot(Et,en)}if(a){const Hi=r.ab.vec3.cross([],si,Et);r.ab.vec3.normalize(Hi,Hi),r.ab.vec3.scaleAndAdd(hi,hi,Hi,a*ke)}const yi=Ne+Math.atan2(zi,an);return Jt.push(hi),Q&&jt.push(Ii),{point:hi,angle:yi,path:Jt,tilePath:jt,up:si}}function _a(d,i){const a=i.length,f=a+4*d;i.resize(f),i.float32.fill(-1/0,4*a,4*f)}function Wo(d,i,a){const f=i[0],v=i[1];return d[0]=a[0]*f+a[4]*v+a[12],d[1]=a[1]*f+a[5]*v+a[13],d[3]=a[3]*f+a[7]*v+a[15],d}const or=100;class fs{constructor(i,a,f=new Ar(i.width+200,i.height+200,25),v=new Ar(i.width+200,i.height+200,25)){this.transform=i,this.grid=f,this.ignoredGrid=v,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+or,this.screenBottomBoundary=i.height+or,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=a}placeCollisionBox(i,a,f,v,x,T,I,F){let V=f.projectedAnchorX,j=f.projectedAnchorY,Z=f.projectedAnchorZ;const X=f.elevation,Q=f.tileID,le=i.getProjection();if(X&&Q){const[He,We,je]=le.upVector(Q.canonical,f.tileAnchorX,f.tileAnchorY),at=le.upVectorScale(Q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;V+=He*X*at,j+=We*X*at,Z+=je*X*at}const se=this.projectAndGetPerspectiveRatio(I,V,j,Z,f.tileID,le.name==="globe"||!!X||this.transform.pitch>0,le),me=T*se.perspectiveRatio,fe=(f.x1*a+v.x-f.padding)*me+se.point.x,De=(f.y1*a+v.y-f.padding)*me+se.point.y,ke=(f.x2*a+v.x+f.padding)*me+se.point.x,Ne=(f.y2*a+v.y+f.padding)*me+se.point.y,tt=se.perspectiveRatio<=.55||se.occluded;return!this.isInsideGrid(fe,De,ke,Ne)||!x&&this.grid.hitTest(fe,De,ke,Ne,F)||tt?{box:[],offscreen:!1,occluded:se.occluded}:{box:[fe,De,ke,Ne],offscreen:this.isOffscreen(fe,De,ke,Ne),occluded:!1}}placeCollisionCircles(i,a,f,v,x,T,I,F,V,j,Z,X,Q,le,se){const me=[],fe=this.transform.elevation,De=i.getProjection(),ke=fe?fe.getAtTileOffsetFunc(se,this.transform.center.lat,this.transform.worldSize,De):null,Ne=new r.P(f.tileAnchorX,f.tileAnchorY);let{x:tt,y:He,z:We}=De.projectTilePoint(Ne.x,Ne.y,se.canonical);if(ke){const[Ii,Et,hi]=ke(Ne);tt+=Ii,He+=Et,We+=hi}const je=De.name==="globe",at=this.projectAndGetPerspectiveRatio(I,tt,He,We,se,je||!!fe||this.transform.pitch>0,De),{perspectiveRatio:gt}=at,Jt=(Z?T/gt:T*gt)/r.bw,jt=fa(tt,He,We,F),fi=at.signedDistanceFromCamera>0?Qs(Jt,x,f.lineOffsetX*Jt,f.lineOffsetY*Jt,!1,jt,Ne,f,v,F,{},fe&&!Z?ke:null,Z&&!!fe,De,se,Z):null;let ui=!1,Pt=!1,Kt=!0;if(fi&&!at.occluded){const Ii=.5*Q*gt+le,Et=new r.P(-100,-100),hi=new r.P(this.screenRightBoundary,this.screenBottomBoundary),si=new Cn,{first:an,last:zi}=fi,yi=an.path.length;let Hi=[];for(let Un=yi-1;Un>=1;Un--)Hi.push(an.path[Un]);for(let Un=1;Un<zi.path.length;Un++)Hi.push(zi.path[Un]);const en=2.5*Ii;V&&(Hi=Hi.map(([Un,fr,ur],lr)=>(ke&&!je&&(ur=ke(lr<yi-1?an.tilePath[yi-1-lr]:zi.tilePath[lr-yi+2])[2]),fa(Un,fr,ur,V))),Hi.some(Un=>Un[3]<=0)&&(Hi=[]));let bn=[];if(Hi.length>0){let Un=1/0,fr=-1/0,ur=1/0,lr=-1/0;for(const wr of Hi)Un=Math.min(Un,wr[0]),ur=Math.min(ur,wr[1]),fr=Math.max(fr,wr[0]),lr=Math.max(lr,wr[1]);fr>=Et.x&&Un<=hi.x&&lr>=Et.y&&ur<=hi.y&&(bn=[Hi.map(wr=>new r.P(wr[0],wr[1]))],(Un<Et.x||fr>hi.x||ur<Et.y||lr>hi.y)&&(bn=r.bu(bn,Et.x,Et.y,hi.x,hi.y)))}for(const Un of bn){si.reset(Un,.25*Ii);let fr=0;fr=si.length<=.5*Ii?1:Math.ceil(si.paddedLength/en)+1;for(let ur=0;ur<fr;ur++){const lr=ur/Math.max(fr-1,1),wr=si.lerp(lr),Tr=wr.x+or,za=wr.y+or;me.push(Tr,za,Ii,0);const Ss=Tr-Ii,qa=za-Ii,Pr=Tr+Ii,ba=za+Ii;if(Kt=Kt&&this.isOffscreen(Ss,qa,Pr,ba),Pt=Pt||this.isInsideGrid(Ss,qa,Pr,ba),!a&&this.grid.hitTestCircle(Tr,za,Ii,X)&&(ui=!0,!j))return{circles:[],offscreen:!1,collisionDetected:ui,occluded:!1}}}}return{circles:!j&&ui||!Pt?[]:me,offscreen:Kt,collisionDetected:ui,occluded:at.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let f=1/0,v=1/0,x=-1/0,T=-1/0;for(const j of i){const Z=new r.P(j.x+or,j.y+or);f=Math.min(f,Z.x),v=Math.min(v,Z.y),x=Math.max(x,Z.x),T=Math.max(T,Z.y),a.push(Z)}const I=this.grid.query(f,v,x,T).concat(this.ignoredGrid.query(f,v,x,T)),F={},V={};for(const j of I){const Z=j.key;if(F[Z.bucketInstanceId]===void 0&&(F[Z.bucketInstanceId]={}),F[Z.bucketInstanceId][Z.featureIndex])continue;const X=[new r.P(j.x1,j.y1),new r.P(j.x2,j.y1),new r.P(j.x2,j.y2),new r.P(j.x1,j.y2)];r.bv(a,X)&&(F[Z.bucketInstanceId][Z.featureIndex]=!0,V[Z.bucketInstanceId]===void 0&&(V[Z.bucketInstanceId]=[]),V[Z.bucketInstanceId].push(Z.featureIndex))}return V}insertCollisionBox(i,a,f,v,x){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:v,collisionGroupID:x},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,a,f,v,x){const T=a?this.ignoredGrid:this.grid,I={bucketInstanceId:f,featureIndex:v,collisionGroupID:x};for(let F=0;F<i.length;F+=4)T.insertCircle(I,i[F],i[F+1],i[F+2])}projectAndGetPerspectiveRatio(i,a,f,v,x,T,I){const F=[a,f,v,1];let V=!1;v||this.transform.pitch>0?(r.ab.vec4.transformMat4(F,F,i),this.fogState&&x&&I.name!=="globe"&&(V=function(X,Q,le,se,me,fe){const De=fe.calculateFogTileMatrix(me),ke=[Q,le,se];return r.ab.vec3.transformMat4(ke,ke,De),ut(X,r.ab.vec3.length(ke),fe.pitch,fe._fov)}(this.fogState,a,f,v,x.toUnwrapped(),this.transform)>.9)):Wo(F,F,i);const j=F[3];return{point:new r.P((F[0]/j+1)/2*this.transform.width+or,(-F[1]/j+1)/2*this.transform.height+or),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/j*.5,1.5),signedDistanceFromCamera:j,occluded:T&&F[2]>j||V}}isOffscreen(i,a,f,v){return f<or||i>=this.screenRightBoundary||v<or||a>this.screenBottomBoundary}isInsideGrid(i,a,f,v){return f>=0&&i<this.gridRightBoundary&&v>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const i=r.ab.mat4.identity([]);return r.ab.mat4.translate(i,i,[-100,-100,0]),i}}function Cu(d,i,a){const f=i.createTileMatrix(d,d.worldSize,a.toUnwrapped());return r.ab.mat4.multiply(new Float32Array(16),d.projMatrix,f)}function kl(d,i,a){if(i.projection.name===a.projection.name)return d.projMatrix;const f=a.clone();return f.setProjection(i.projection),Cu(f,i.getProjection(),d)}function fl(d,i,a){return i.name===a.projection.name?d.projMatrix:Cu(a,i,d)}class Lu{constructor(i,a,f,v){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?a:-a))):v&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class co{constructor(i,a,f,v,x,T=!1){this.text=new Lu(i?i.text:null,a,f,x),this.icon=new Lu(i?i.icon:null,a,v,x),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class df{constructor(i,a,f,v=!1){this.text=i,this.icon=a,this.skipFade=f,this.clipped=v}}class Nl{constructor(){this.invProjMatrix=r.ab.mat4.create(),this.viewportMatrix=r.ab.mat4.create(),this.circles=[]}}class Ml{constructor(i,a,f,v,x){this.bucketInstanceId=i,this.featureIndex=a,this.sourceLayerIndex=f,this.bucketIndex=v,this.tileID=x}}class Uh{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const a=++this.maxGroupID;this.collisionGroups[i]={ID:a,predicate:f=>f.collisionGroupID===a}}return this.collisionGroups[i]}}function ps(d,i,a,f,v){const{horizontalAlign:x,verticalAlign:T}=r.bD(d),I=-(x-.5)*i,F=-(T-.5)*a,V=r.bC(d,f);return new r.P(I+V[0]*v,F+V[1]*v)}function oa(d,i,a,f,v){const x=new r.P(d,i);return a&&x._rotate(f?v:-v),x}class Rd{constructor(i,a,f,v,x,T){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new fs(this.transform,x),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Uh(f),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,a,f,v,x=1){const T=f.getBucket(a),I=f.latestFeatureIndex;if(!T||!I||a.fqid!==T.layerIds[0])return;const F=T.layers[0].layout,V=T.layers[0].paint,j=f.collisionBoxArray,Z=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),X=f.tileSize/r.ag,Q=f.tileID.toUnwrapped();this.transform.setProjection(T.projection);const le=(se=f.tileID,me=T.getProjection(),fe=this.transform,me.name===this.projection?fe.calculateProjMatrix(se.toUnwrapped()):Cu(fe,me,se));var se,me,fe;const De=F.get("text-pitch-alignment")==="map",ke=F.get("text-rotation-alignment")==="map";a.compileFilter(a.options);const Ne=a.dynamicFilter(),tt=a.dynamicFilterNeedsFeature(),He=this.transform.calculatePixelsToTileUnitsMatrix(f),We=xr(le,f.tileID.canonical,De,ke,this.transform,T.getProjection(),He);let je=null;if(De){const Ii=On(le,f.tileID.canonical,De,ke,this.transform,T.getProjection(),He);je=r.ab.mat4.multiply([],this.transform.labelPlaneMatrix,Ii)}let at=null;Ne&&f.latestFeatureIndex&&(at={unwrappedTileID:Q,dynamicFilter:Ne,dynamicFilterNeedsFeature:tt}),this.retainedQueryData[T.bucketInstanceId]=new Ml(T.bucketInstanceId,I,T.sourceLayerIndex,T.index,f.tileID);const[gt,Jt]=T.layers[0].layout.get("text-size-scale-range"),jt=r.aw(x,gt,Jt),[fi,ui]=F.get("icon-size-scale-range"),Pt=r.aw(x,fi,ui),Kt={bucket:T,layout:F,paint:V,posMatrix:le,textLabelPlaneMatrix:We,labelToScreenMatrix:je,clippingData:at,scale:Z,textPixelRatio:X,holdingForFade:f.holdingForFade(),collisionBoxArray:j,partiallyEvaluatedTextSize:r.bp(T.textSizeData,this.transform.zoom,jt),partiallyEvaluatedIconSize:r.bp(T.iconSizeData,this.transform.zoom,Pt),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:f.latestFeatureIndex};if(v)for(const Ii of T.sortKeyRanges){const{sortKey:Et,symbolInstanceStart:hi,symbolInstanceEnd:si}=Ii;i.push({sortKey:Et,symbolInstanceStart:hi,symbolInstanceEnd:si,parameters:Kt})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:Kt})}attemptAnchorPlacement(i,a,f,v,x,T,I,F,V,j,Z,X,Q,le,se,me,fe,De){const{textOffset0:ke,textOffset1:Ne,crossTileID:tt}=X,He=[ke,Ne],We=ps(i,f,v,He,x),je=this.collisionIndex.placeCollisionBox(le,x,a,oa(We.x,We.y,T,I,this.transform.angle),Z,F,V,j.predicate);if(me){const at=le.getSymbolInstanceIconSize(De,this.transform.zoom,X.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(le,at,me,oa(We.x,We.y,T,I,this.transform.angle),Z,F,V,j.predicate).box.length===0)return}if(je.box.length>0){let at;return this.prevPlacement&&this.prevPlacement.variableOffsets[tt]&&this.prevPlacement.placements[tt]&&this.prevPlacement.placements[tt].text&&(at=this.prevPlacement.variableOffsets[tt].anchor),this.variableOffsets[tt]={textOffset:He,width:f,height:v,anchor:i,textScale:x,prevAnchor:at},this.markUsedJustification(le,i,X,se),le.allowVerticalPlacement&&(this.markUsedOrientation(le,se,X),this.placedOrientations[tt]=se),{shift:We,placedGlyphBoxes:je}}}placeLayerBucketPart(i,a,f,v,x=1){const{bucket:T,layout:I,paint:F,posMatrix:V,textLabelPlaneMatrix:j,labelToScreenMatrix:Z,clippingData:X,textPixelRatio:Q,holdingForFade:le,collisionBoxArray:se,partiallyEvaluatedTextSize:me,partiallyEvaluatedIconSize:fe,collisionGroup:De,latestFeatureIndex:ke}=i.parameters,Ne=I.get("text-optional"),tt=I.get("icon-optional"),He=I.get("text-allow-overlap"),We=I.get("icon-allow-overlap"),je=I.get("text-rotation-alignment")==="map",at=I.get("text-pitch-alignment")==="map",gt=I.get("symbol-z-elevate"),Jt=F.get("symbol-z-offset"),jt=I.get("symbol-elevation-reference")==="sea",[fi,ui]=I.get("text-size-scale-range"),[Pt,Kt]=I.get("icon-size-scale-range"),Ii=r.aw(x,fi,ui),Et=r.aw(x,Pt,Kt);this.transform.setProjection(T.projection);let hi=He&&(We||!T.hasIconData()||tt),si=We&&(He||!T.hasTextData()||Ne);const an=!Jt.isConstant();!T.collisionArrays&&se&&T.deserializeCollisionBoxes(se),f&&v&&T.updateCollisionDebugBuffers(this.transform.zoom,se,Ii,Et);const zi=(yi,Hi,en)=>{const{crossTileID:bn,numVerticalGlyphVertices:Un}=yi;let fr=null;if(X&&X.dynamicFilterNeedsFeature||an){const Pa=this.retainedQueryData[T.bucketInstanceId];fr=ke.loadFeature({featureIndex:yi.featureIndex,bucketIndex:Pa.bucketIndex,sourceLayerIndex:Pa.sourceLayerIndex,layoutVertexArrayOffset:0})}if(X&&!(0,X.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},fr,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new r.P(yi.tileAnchorX,yi.tileAnchorY),this.transform.calculateDistanceTileData(X.unwrappedTileID)))return this.placements[bn]=new df(!1,!1,!1,!0),void a.add(bn);const ur=Jt.evaluate(fr,{});if(a.has(bn))return;if(le)return void(this.placements[bn]=new df(!1,!1,!1));let lr=!1,wr=!1,Tr=!0,za=!1,Ss=!1,qa=null,Pr={box:null,offscreen:null,occluded:null},ba={box:null},In=null,_r=null,pr=null,yr=0,Jr=0,is=0;en.textFeatureIndex?yr=en.textFeatureIndex:yi.useRuntimeCollisionCircles&&(yr=yi.featureIndex),en.verticalTextFeatureIndex&&(Jr=en.verticalTextFeatureIndex);const ns=Pa=>{Pa.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const Sa=this.transform.elevation;Pa.elevation=jt?ur:ur+(Sa?Sa.getAtTileOffset(Pa.tileID,Pa.tileAnchorX,Pa.tileAnchorY):0),Pa.elevation+=yi.zOffset},Es=en.textBox;if(Es){ns(Es);const Pa=ha=>{let Xa=r.bq.horizontal;if(T.allowVerticalPlacement&&!ha&&this.prevPlacement){const Os=this.prevPlacement.placedOrientations[bn];Os&&(this.placedOrientations[bn]=Os,Xa=Os,this.markUsedOrientation(T,Xa,yi))}return Xa},Sa=(ha,Xa)=>{if(T.allowVerticalPlacement&&Un>0&&en.verticalTextBox){for(const Os of T.writingModes)if(Os===r.bq.vertical?(Pr=Xa(),ba=Pr):Pr=ha(),Pr&&Pr.box&&Pr.box.length)break}else Pr=ha()};if(I.get("text-variable-anchor")){let ha=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[bn]){const Oa=this.prevPlacement.variableOffsets[bn];ha.indexOf(Oa.anchor)>0&&(ha=ha.filter(ks=>ks!==Oa.anchor),ha.unshift(Oa.anchor))}const Xa=(Oa,ks,ul)=>{const tl=T.getSymbolInstanceTextSize(me,yi,this.transform.zoom,Hi),No=(Oa.x2-Oa.x1)*tl+2*Oa.padding,$l=(Oa.y2-Oa.y1)*tl+2*Oa.padding,Eo=yi.hasIconTextFit&&!We?ks:null;Eo&&ns(Eo);let hl={box:[],offscreen:!1,occluded:!1};const Kl=He?2*ha.length:ha.length;for(let Bl=0;Bl<Kl;++Bl){const Mu=this.attemptAnchorPlacement(ha[Bl%ha.length],Oa,No,$l,tl,je,at,Q,V,De,Bl>=ha.length,yi,Hi,T,ul,Eo,me,fe);if(Mu&&(hl=Mu.placedGlyphBoxes,hl&&hl.box&&hl.box.length)){lr=!0,qa=Mu.shift;break}}return hl};Sa(()=>Xa(Es,en.iconBox,r.bq.horizontal),()=>{const Oa=en.verticalTextBox;return Oa&&ns(Oa),T.allowVerticalPlacement&&!(Pr&&Pr.box&&Pr.box.length)&&Un>0&&Oa?Xa(Oa,en.verticalIconBox,r.bq.vertical):{box:null,offscreen:null,occluded:null}}),Pr&&(lr=Pr.box,Tr=Pr.offscreen,za=Pr.occluded);const Os=Pa(!(!Pr||!Pr.box));if(!lr&&this.prevPlacement){const Oa=this.prevPlacement.variableOffsets[bn];Oa&&(this.variableOffsets[bn]=Oa,this.markUsedJustification(T,Oa.anchor,yi,Os))}}else{const ha=(Xa,Os)=>{const Oa=T.getSymbolInstanceTextSize(me,yi,this.transform.zoom,Hi,x),ks=this.collisionIndex.placeCollisionBox(T,Oa,Xa,new r.P(0,0),He,Q,V,De.predicate);return ks&&ks.box&&ks.box.length&&(this.markUsedOrientation(T,Os,yi),this.placedOrientations[bn]=Os),ks};Sa(()=>ha(Es,r.bq.horizontal),()=>{const Xa=en.verticalTextBox;return T.allowVerticalPlacement&&Un>0&&Xa?(ns(Xa),ha(Xa,r.bq.vertical)):{box:null,offscreen:null,occluded:null}}),Pa(!!(Pr&&Pr.box&&Pr.box.length))}}if(In=Pr,lr=In&&In.box&&In.box.length>0,Tr=In&&In.offscreen,za=In&&In.occluded,yi.useRuntimeCollisionCircles){const Pa=T.text.placedSymbolArray.get(yi.centerJustifiedTextSymbolIndex>=0?yi.centerJustifiedTextSymbolIndex:yi.verticalPlacedTextSymbolIndex),Sa=r.br(T.textSizeData,me,Pa),ha=I.get("text-padding");_r=this.collisionIndex.placeCollisionCircles(T,He,Pa,T.lineVertexArray,T.glyphOffsetArray,Sa,V,j,Z,f,at,De.predicate,yi.collisionCircleDiameter*Sa/r.bw,ha,this.retainedQueryData[T.bucketInstanceId].tileID),lr=He||_r.circles.length>0&&!_r.collisionDetected,Tr=Tr&&_r.offscreen,za=_r.occluded}if(en.iconFeatureIndex&&(is=en.iconFeatureIndex),en.iconBox){const Pa=Sa=>{ns(Sa);const ha=yi.hasIconTextFit&&qa?oa(qa.x,qa.y,je,at,this.transform.angle):new r.P(0,0),Xa=T.getSymbolInstanceIconSize(fe,this.transform.zoom,yi.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,Xa,Sa,ha,We,Q,V,De.predicate)};ba&&ba.box&&ba.box.length&&en.verticalIconBox?(pr=Pa(en.verticalIconBox),wr=pr.box.length>0):(pr=Pa(en.iconBox),wr=pr.box.length>0),Tr=Tr&&pr.offscreen,Ss=pr.occluded}const el=Ne||yi.numHorizontalGlyphVertices===0&&Un===0,Ps=tt||yi.numIconVertices===0;if(el||Ps?Ps?el||(wr=wr&&lr):lr=wr&&lr:wr=lr=wr&&lr,lr&&In&&In.box&&this.collisionIndex.insertCollisionBox(In.box,I.get("text-ignore-placement"),T.bucketInstanceId,ba&&ba.box&&Jr?Jr:yr,De.ID),wr&&pr&&this.collisionIndex.insertCollisionBox(pr.box,I.get("icon-ignore-placement"),T.bucketInstanceId,is,De.ID),_r&&(lr&&this.collisionIndex.insertCollisionCircles(_r.circles,I.get("text-ignore-placement"),T.bucketInstanceId,yr,De.ID),f)){const Pa=T.bucketInstanceId;let Sa=this.collisionCircleArrays[Pa];Sa===void 0&&(Sa=this.collisionCircleArrays[Pa]=new Nl);for(let ha=0;ha<_r.circles.length;ha+=4)Sa.circles.push(_r.circles[ha+0]),Sa.circles.push(_r.circles[ha+1]),Sa.circles.push(_r.circles[ha+2]),Sa.circles.push(_r.collisionDetected?1:0)}const da=T.projection.name!=="globe";hi=hi&&(da||!za),si=si&&(da||!Ss),this.placements[bn]=new df(lr||hi,wr||si,Tr||T.justReloaded),a.add(bn)};if(gt&&this.buildingIndex&&(this.buildingIndex.updateZOffset(T,this.retainedQueryData[T.bucketInstanceId].tileID),T.updateZOffset()),T.sortFeaturesByY){const yi=T.getSortedSymbolIndexes(this.transform.angle);for(let Hi=yi.length-1;Hi>=0;--Hi){const en=yi[Hi];zi(T.symbolInstances.get(en),en,T.collisionArrays[en])}T.hasAnyZOffset&&r.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const yi=T.getSortedIndexesByZOffset();for(let Hi=0;Hi<yi.length;++Hi){const en=yi[Hi];zi(T.symbolInstances.get(en),en,T.collisionArrays[en])}}else for(let yi=i.symbolInstanceStart;yi<i.symbolInstanceEnd;yi++)zi(T.symbolInstances.get(yi),yi,T.collisionArrays[yi]);if(f&&T.bucketInstanceId in this.collisionCircleArrays){const yi=this.collisionCircleArrays[T.bucketInstanceId];r.ab.mat4.invert(yi.invProjMatrix,V),yi.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(i,a,f,v){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:F,crossTileID:V}=f,j=r.bB(a),Z=v===r.bq.vertical?F:j==="left"?x:j==="center"?T:j==="right"?I:-1;x>=0&&(i.text.placedSymbolArray.get(x).crossTileID=Z>=0&&x!==Z?0:V),T>=0&&(i.text.placedSymbolArray.get(T).crossTileID=Z>=0&&T!==Z?0:V),I>=0&&(i.text.placedSymbolArray.get(I).crossTileID=Z>=0&&I!==Z?0:V),F>=0&&(i.text.placedSymbolArray.get(F).crossTileID=Z>=0&&F!==Z?0:V)}markUsedOrientation(i,a,f){const v=a===r.bq.horizontal||a===r.bq.horizontalOnly?a:0,x=a===r.bq.vertical?a:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:F,verticalPlacedTextSymbolIndex:V}=f,j=i.text.placedSymbolArray;T>=0&&(j.get(T).placedOrientation=v),I>=0&&(j.get(I).placedOrientation=v),F>=0&&(j.get(F).placedOrientation=v),V>=0&&(j.get(V).placedOrientation=x)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let f=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const v=a?a.symbolFadeChange(i):1,x=a?a.opacities:{},T=a?a.variableOffsets:{},I=a?a.placedOrientations:{};for(const F in this.placements){const V=this.placements[F],j=x[F];j?(this.opacities[F]=new co(j,v,V.text,V.icon,null,V.clipped),f=f||V.text!==j.text.placed||V.icon!==j.icon.placed):(this.opacities[F]=new co(null,v,V.text,V.icon,V.skipFade,V.clipped),f=f||V.text||V.icon)}for(const F in x){const V=x[F];if(!this.opacities[F]){const j=new co(V,v,!1,!1);j.isHidden()||(this.opacities[F]=j,f=f||V.text.placed||V.icon.placed)}}for(const F in T)this.variableOffsets[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.variableOffsets[F]=T[F]);for(const F in I)this.placedOrientations[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.placedOrientations[F]=I[F]);f?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:i)}updateLayerOpacities(i,a,f,v){const x=new Set;for(const T of a){const I=T.getBucket(i);I&&T.latestFeatureIndex&&i.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,x,T,T.collisionBoxArray,f,v,T.tileID,i.scope),I.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(I,T.tileID),I.updateZOffset()))}}updateBucketOpacities(i,a,f,v,x,T,I,F){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const V=i.layers[0].layout,j=i.layers[0].paint,Z=!!i.layers[0].dynamicFilter(),X=new co(null,0,!1,!1,!0),Q=V.get("text-allow-overlap"),le=V.get("icon-allow-overlap"),se=V.get("text-variable-anchor"),me=V.get("text-rotation-alignment")==="map",fe=V.get("text-pitch-alignment")==="map",De=j.get("symbol-z-offset"),ke=V.get("symbol-elevation-reference")==="sea",Ne=!De.isConstant(),tt=new co(null,0,Q&&(le||!i.hasIconData()||V.get("icon-optional")),le&&(Q||!i.hasTextData()||V.get("text-optional")),!0);!i.collisionArrays&&v&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(v);const He=(je,at,gt)=>{for(let Jt=0;Jt<at/4;Jt++)je.opacityVertexArray.emplaceBack(gt)};let We=0;T&&i.updateReplacement(I,T);for(let je=0;je<i.symbolInstances.length;je++){const at=i.symbolInstances.get(je),{numHorizontalGlyphVertices:gt,numVerticalGlyphVertices:Jt,crossTileID:jt,numIconVertices:fi,tileAnchorX:ui,tileAnchorY:Pt}=at;let Kt=null;const Ii=this.retainedQueryData[i.bucketInstanceId];Ne&&at&&Ii&&(Kt=f.latestFeatureIndex.loadFeature({featureIndex:at.featureIndex,bucketIndex:Ii.bucketIndex,sourceLayerIndex:Ii.sourceLayerIndex,layoutVertexArrayOffset:0}));const Et=De.evaluate(Kt,{}),hi=a.has(jt);let si=this.opacities[jt];hi?si=X:si||(si=tt,this.opacities[jt]=si),a.add(jt);const an=gt>0||Jt>0,zi=fi>0,yi=this.placedOrientations[jt],Hi=yi===r.bq.vertical,en=yi===r.bq.horizontal||yi===r.bq.horizontalOnly;!an&&!zi||si.isHidden()||We++;let bn=!1;if((an||zi)&&T)for(const Un of i.activeReplacements){if(r.bx(Un,x,r.by.Symbol,F)||Un.min.x>ui||ui>Un.max.x||Un.min.y>Pt||Pt>Un.max.y)continue;const fr=r.bz(ui,Pt,I.canonical,Un.footprintTileId.canonical);if(bn=r.bA(fr,Un.footprint),bn)break}if(an){const Un=bn?Ul:Id(si.text);He(i.text,gt,Hi?Ul:Un),He(i.text,Jt,en?Ul:Un);const fr=si.text.isHidden(),{leftJustifiedTextSymbolIndex:ur,centerJustifiedTextSymbolIndex:lr,rightJustifiedTextSymbolIndex:wr,verticalPlacedTextSymbolIndex:Tr}=at,za=i.text.placedSymbolArray,Ss=fr||Hi?1:0;ur>=0&&(za.get(ur).hidden=Ss),lr>=0&&(za.get(lr).hidden=Ss),wr>=0&&(za.get(wr).hidden=Ss),Tr>=0&&(za.get(Tr).hidden=fr||en?1:0);const qa=this.variableOffsets[jt];qa&&this.markUsedJustification(i,qa.anchor,at,yi);const Pr=this.placedOrientations[jt];Pr&&(this.markUsedJustification(i,"left",at,Pr),this.markUsedOrientation(i,Pr,at))}if(zi){const Un=bn?Ul:Id(si.icon),{placedIconSymbolIndex:fr,verticalPlacedIconSymbolIndex:ur}=at,lr=i.icon.placedSymbolArray,wr=si.icon.isHidden()?1:0;fr>=0&&(He(i.icon,fi,Hi?Ul:Un),lr.get(fr).hidden=wr),ur>=0&&(He(i.icon,at.numVerticalIconVertices,en?Ul:Un),lr.get(ur).hidden=wr)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Un=i.collisionArrays[je];if(Un){let fr=new r.P(0,0),ur=!0;if(Un.textBox||Un.verticalTextBox){if(se){const wr=this.variableOffsets[jt];wr?(fr=ps(wr.anchor,wr.width,wr.height,wr.textOffset,wr.textScale),me&&fr._rotate(fe?this.transform.angle:-this.transform.angle)):ur=!1}Z&&(ur=!si.clipped),Un.textBox&&tu(i.textCollisionBox.collisionVertexArray,si.text.placed,!ur||Hi,Et,ke,fr.x,fr.y),Un.verticalTextBox&&tu(i.textCollisionBox.collisionVertexArray,si.text.placed,!ur||en,Et,ke,fr.x,fr.y)}const lr=ur&&!!(!en&&Un.verticalIconBox);Un.iconBox&&tu(i.iconCollisionBox.collisionVertexArray,si.icon.placed,lr,Et,ke,at.hasIconTextFit?fr.x:0,at.hasIconTextFit?fr.y:0),Un.verticalIconBox&&tu(i.iconCollisionBox.collisionVertexArray,si.icon.placed,!lr,Et,ke,at.hasIconTextFit?fr.x:0,at.hasIconTextFit?fr.y:0)}}}if(i.fullyClipped=We===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const je=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=je.invProjMatrix,i.placementViewportMatrix=je.viewportMatrix,i.collisionCircleArray=je.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,a){const f=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*f>i}setStale(){this.stale=!0}}function tu(d,i,a,f,v,x,T){d.emplaceBack(i?1:0,a?1:0,x||0,T||0,f,v?1:0),d.emplaceBack(i?1:0,a?1:0,x||0,T||0,f,v?1:0),d.emplaceBack(i?1:0,a?1:0,x||0,T||0,f,v?1:0),d.emplaceBack(i?1:0,a?1:0,x||0,T||0,f,v?1:0)}const Vh=Math.pow(2,25),sh=Math.pow(2,24),oh=Math.pow(2,17),gc=Math.pow(2,16),Gh=Math.pow(2,9),dp=Math.pow(2,8),lh=Math.pow(2,1);function Id(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const i=d.placed?1:0,a=Math.floor(127*d.opacity);return a*Vh+i*sh+a*oh+i*gc+a*Gh+i*dp+a*lh+i}const Ul=0;class Tl{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,a,f,v,x,T){const I=this._bucketParts;for(;this._currentTileIndex<i.length;)if(a.getBucketParts(I,v,i[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((F,V)=>F.sortKey-V.sortKey));this._currentPartIndex<I.length;){const F=I[this._currentPartIndex];if(a.placeLayerBucketPart(F,this._seenCrossTileIDs,f,F.symbolInstanceStart===0,T),this._currentPartIndex++,x())return!0}return!1}}class jf{constructor(i,a,f,v,x,T,I,F,V){this.placement=new Rd(i,x,T,I,F,V),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(i,a,f,v,x){const T=r.q.now(),I=()=>{const F=r.q.now()-T;return!this._forceFullPlacement&&F>2};for(;this._currentPlacementIndex>=0;){const F=a[i[this._currentPlacementIndex]],V=this.placement.collisionIndex.transform.zoom;if(F.type==="symbol"&&(!F.minzoom||F.minzoom<=V)&&(!F.maxzoom||F.maxzoom>V)){const j=F,Z=j.layout.get("symbol-z-elevate"),X=j.layout.get("symbol-sort-key").constantOr(1)!==void 0,Q=j.layout.get("symbol-z-order"),le=Q==="viewport-y"||Q==="auto"&&!(Q!=="viewport-y"&&X),se=j.layout.get("text-allow-overlap")||j.layout.get("icon-allow-overlap")||j.layout.get("text-ignore-placement")||j.layout.get("icon-ignore-placement"),me=le&&se,fe=this._inProgressLayer=this._inProgressLayer||new Tl(j),De=r.aC(F.source,F.scope);if(fe.continuePlacement(Z||me?v[De]:f[De],this.placement,this._showCollisionBoxes,F,I,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Hh=512/r.ag/2;class ff{constructor(i,a,f){this.tileID=i,this.bucketInstanceId=f,this.index=new r.bE(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=i.canonical.x*r.ag,x=i.canonical.y*r.ag;for(let T=0;T<a.length;T++){const{key:I,crossTileID:F,tileAnchorX:V,tileAnchorY:j}=a.get(T),Z=Math.floor((v+V)*Hh),X=Math.floor((x+j)*Hh);this.index.add(Z,X),this.keys.push(I),this.crossTileIDs.push(F)}this.index.finish()}findMatches(i,a,f){const v=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),x=Hh/Math.pow(2,a.canonical.z-this.tileID.canonical.z),T=a.canonical.x*r.ag,I=a.canonical.y*r.ag;for(let F=0;F<i.length;F++){const V=i.get(F);if(V.crossTileID)continue;const{key:j,tileAnchorX:Z,tileAnchorY:X}=V,Q=Math.floor((T+Z)*x),le=Math.floor((I+X)*x),se=this.index.range(Q-v,le-v,Q+v,le+v);for(const me of se){const fe=this.crossTileIDs[me];if(this.keys[me]===j&&!f.has(fe)){f.add(fe),V.crossTileID=fe;break}}}}}class pf{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class mf{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const a=Math.round((i-this.lng)/360);if(a!==0)for(const f in this.indexes){const v=this.indexes[f],x={};for(const T in v){const I=v[T];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+a),x[I.tileID.key]=I}this.indexes[f]=x}this.lng=i}addBucket(i,a,f){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let x=0;x<a.symbolInstances.length;x++)a.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const v=this.usedCrossTileIDs[i.overscaledZ];for(const x in this.indexes){const T=this.indexes[x];if(Number(x)>i.overscaledZ)for(const I in T){const F=T[I];F.tileID.isChildOf(i)&&F.findMatches(a.symbolInstances,i,v)}else{const I=T[i.scaledTo(Number(x)).key];I&&I.findMatches(a.symbolInstances,i,v)}}for(let x=0;x<a.symbolInstances.length;x++){const T=a.symbolInstances.get(x);T.crossTileID||(T.crossTileID=f.generate(),v.add(T.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new ff(i,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(i,a){for(const f of a.crossTileIDs)this.usedCrossTileIDs[i].delete(f)}removeStaleBuckets(i){let a=!1;for(const f in this.indexes){const v=this.indexes[f];for(const x in v)i[v[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,v[x]),delete v[x],a=!0)}return a}}class eo{constructor(){this.layerIndexes={},this.crossTileIDs=new pf,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,a,f,v){let x=this.layerIndexes[i.fqid];x===void 0&&(x=this.layerIndexes[i.fqid]=new mf);let T=!1;const I={};v.name!=="globe"&&x.handleWrapJump(f);for(const F of a){const V=F.getBucket(i);V&&i.fqid===V.layerIds[0]&&(V.bucketInstanceId||(V.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(F.tileID,V,this.crossTileIDs)&&(T=!0),I[V.bucketInstanceId]=!0)}return x.removeStaleBuckets(I)&&(T=!0),T}pruneUnusedLayers(i){const a={};i.forEach(f=>{a[f]=!0});for(const f in this.layerIndexes)a[f]||delete this.layerIndexes[f]}}const Sl=771;class Fr{constructor(i,a,f,v){this.blendFunction=i,this.blendColor=a,this.mask=f,this.blendEquation=v}}Fr.Replace=[1,0,1,0],Fr.disabled=new Fr(Fr.Replace,r.aj.transparent,[!1,!1,!1,!1]),Fr.unblended=new Fr(Fr.Replace,r.aj.transparent,[!0,!0,!0,!0]),Fr.alphaBlended=new Fr([1,Sl,1,Sl],r.aj.transparent,[!0,!0,!0,!0]),Fr.alphaBlendedNonPremultiplied=new Fr([770,Sl,770,Sl],r.aj.transparent,[!0,!0,!0,!0]),Fr.multiply=new Fr([774,0,774,0],r.aj.transparent,[!0,!0,!0,!0]);class sr{constructor(i,a,f){this.func=i,this.mask=a,this.range=f}}sr.ReadOnly=!1,sr.ReadWrite=!0,sr.disabled=new sr(519,sr.ReadOnly,[0,1]);const zo=7680;class br{constructor(i,a,f,v,x,T){this.test=i,this.ref=a,this.mask=f,this.fail=v,this.depthFail=x,this.pass=T}}br.disabled=new br({func:519,mask:0},0,0,zo,zo,zo);const El=1029,_c=2305;class rr{constructor(i,a,f){this.enable=i,this.mode=a,this.frontFace=f}}function Fc(d,i){const a=r.bG(d,3);r.ab.mat4.fromQuat(d,i),r.bI(d,3,a)}function ec(d,i){const a=r.ab.quat.identity([]);return r.ab.quat.rotateZ(a,a,-i),r.ab.quat.rotateX(a,a,-d),a}function Ru(d,i){const a=[d[0],d[1],0],f=[i[0],i[1],0];if(r.ab.vec3.length(a)>=1e-15){const T=r.ab.vec3.normalize([],a);r.ab.vec3.scale(f,T,r.ab.vec3.dot(f,T)),i[0]=f[0],i[1]=f[1]}const v=r.ab.vec3.cross([],i,d);if(r.ab.vec3.len(v)<1e-15)return null;const x=Math.atan2(-v[1],v[0]);return ec(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),x)}rr.disabled=new rr(!1,El,_c),rr.backCCW=new rr(!0,El,_c),rr.backCW=new rr(!0,El,2304),rr.frontCW=new rr(!0,1028,2304),rr.frontCCW=new rr(!0,1028,_c);class ch{constructor(i,a){this.position=i,this.orientation=a}get position(){return this._position}set position(i){if(i){const a=i instanceof r.aa?i:new r.aa(i[0],i[1],i[2]);this._renderWorldCopies&&(a.x=r.bF(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(i,a){if(this.orientation=null,!this.position)return;const f=this.position,v=this._elevation?this._elevation.getAtPointOrZero(r.aa.fromLngLat(i)):0,x=r.aa.fromLngLat(i,v),T=[x.x-f.x,x.y-f.y,x.z-f.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Ru(T,a)}setPitchBearing(i,a){this.orientation=ec(r.ai(i),r.ai(-a))}}class Po{constructor(i,a){this._transform=r.ab.mat4.identity([]),this.orientation=a,this.position=i}get mercatorPosition(){const i=this.position;return new r.aa(i[0],i[1],i[2])}get position(){const i=r.bG(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var a;i&&r.bI(this._transform,3,[(a=i)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||r.ab.quat.identity([]),i&&Fc(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,a){this._orientation=ec(i,a),Fc(this._transform,this._orientation)}forward(){const i=r.bG(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=r.bG(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=r.bG(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,a){const f=new Float64Array(16);return r.ab.mat4.invert(f,this.getWorldToCamera(i,a)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,a,f){const v=this.position;r.ab.vec3.scale(v,v,-i);const x=new Float64Array(16);return r.ab.mat4.fromScaling(x,[f,f,f]),r.ab.mat4.translate(x,x,v),x[10]*=a,x}getWorldToCamera(i,a){const f=new Float64Array(16),v=new Float64Array(4),x=this.position;return r.ab.quat.conjugate(v,this._orientation),r.ab.vec3.scale(x,x,-i),r.ab.mat4.fromQuat(f,v),r.ab.mat4.translate(f,f,x),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=a,f[9]*=a,f[10]*=a,f[11]*=a,f}getCameraToClipPerspective(i,a,f,v){const x=new Float64Array(16);return r.ab.mat4.perspective(x,i,a,f,v),x}getCameraToClipOrthographic(i,a,f,v,x,T){const I=new Float64Array(16);return r.ab.mat4.ortho(I,i,a,f,v,x,T),I}getDistanceToElevation(i,a=!1){const f=i===0?0:r.bH(i,a?r.aS(this.position[1]):this.position[1]),v=this.forward();return(f-this.position[2])/v[2]}clone(){return new Po([...this.position],[...this.orientation])}}const bo={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class vn{constructor(i=0,a=0,f=0,v=0){if(isNaN(i)||i<0||isNaN(a)||a<0||isNaN(f)||f<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=a,this.left=f,this.right=v}interpolate(i,a,f){return a.top!=null&&i.top!=null&&(this.top=r.af(i.top,a.top,f)),a.bottom!=null&&i.bottom!=null&&(this.bottom=r.af(i.bottom,a.bottom,f)),a.left!=null&&i.left!=null&&(this.left=r.af(i.left,a.left,f)),a.right!=null&&i.right!=null&&(this.right=r.af(i.right,a.right,f)),this}getCenter(i,a){const f=r.aw((this.left+i-this.right)/2,0,i),v=r.aw((this.top+a-this.bottom)/2,0,a);return new r.P(f,v)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new vn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const tc=(d,i,a)=>(1-a)*d+a*i,iu=d=>d*d*d*d*d;class uh{constructor(i,a,f,v,x,T,I){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=i||0,this._maxZoom=a||22,this._minPitch=f??0,this._maxPitch=v??60,this.setProjection(T),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new r.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new vn,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Po,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const i=new uh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,a=!1){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(i||f)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return r.ay(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=r.bP(this.projectionOptions);const f=this.getProjection(),v=!r.bn(a,f);return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.bP({name:"mercator"});const a=i!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bF(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const a=-i*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=r.ab.mat2.create(),r.ab.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const a=r.aw(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=r.ai(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const a=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){const i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const f=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let v=0,x=0;for(let T=0;T<a.length;T++){const I=new r.P(a[T][0]*this.width,f+a[T][1]*(this.height-f)),F=i.pointCoordinate(I);if(!F)continue;const V=1/Math.hypot(F[0]-this._camera.position[0],F[1]-this._camera.position[1]);v+=F[3]*V,x+=V}return x===0?NaN:v/x}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*a,v=this._mercatorZfromZoom(i),x=this._mercatorZfromZoom(this._maxZoom),T=Math.max(v-f,x);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let f;f=i.z<this._camera.position[2]?[a.x,a.y,a.z]:[i.x,i.y,i.z];const v=r.ab.vec3.length(r.ab.vec3.sub([],this._camera.position,f));return r.aw(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let a=!1;if(i.orientation&&!r.ab.quat.exactEquals(i.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(i.orientation)),i.position){const f=[i.position.x,i.position.y,i.position.z];r.ab.vec3.exactEquals(f,this._camera.position)||(this._setCameraPosition(f),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,a=new ch;return a.position=new r.aa(i[0],i[1],i[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(i){if(!r.ab.quat.length(i))return!1;r.ab.quat.normalize(i,i);const a=r.ab.vec3.transformQuat([],[0,0,-1],i),f=r.ab.vec3.transformQuat([],[0,-1,0],i);if(f[2]<0)return!1;const v=Ru(a,f);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(i){const a=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;i[2]=r.aw(i[2],v/f,v/a),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,a,f){this._unmodified=!1,this._edgeInsets.interpolate(i,a,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const a=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(i){const a=[new r.bQ(0,i)];if(this.renderWorldCopies){const f=this.pointCoordinate(new r.P(0,0)),v=this.pointCoordinate(new r.P(this.width,0)),x=this.pointCoordinate(new r.P(this.width,this.height)),T=this.pointCoordinate(new r.P(0,this.height)),I=Math.floor(Math.min(f.x,v.x,x.x,T.x)),F=Math.floor(Math.max(f.x,v.x,x.x,T.x)),V=1;for(let j=I-V;j<=F+V;j++)j!==0&&a.push(new r.bQ(j,i))}return a}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(i,a,f){let v=[];const x=f!==void 0,T=!x;if(T&&this.zoom<a||x&&f[0]===0&&f[1]===0)return v;const I=new Set,F=(j,Z,X,Q,le)=>{const se=r.c5(Z,j,X,Q,le);I.has(se)||(v.push(new r.aG(j,Z,X,Q,le)),I.add(se))};for(let j=0;j<i.length;j++){const Z=i[j];if(T&&Z.canonical.z!==a)continue;const X=Z.canonical,Q=Z.overscaledZ,le=Z.wrap,se=1<<X.z,me=X.x+1<se,fe=X.x>0,De=X.y+1<se,ke=X.y>0,Ne=Z.wrap-(fe?0:1),tt=Z.wrap+(me?0:1),He=fe?X.x-1:se-1,We=me?X.x+1:0;if(x)f[0]<0?(F(Q,tt,X.z,We,X.y),f[1]<0&&De&&(F(Q,le,X.z,X.x,X.y+1),F(Q,tt,X.z,We,X.y+1)),f[1]>0&&ke&&(F(Q,le,X.z,X.x,X.y-1),F(Q,tt,X.z,We,X.y-1))):f[0]>0?(F(Q,Ne,X.z,He,X.y),f[1]<0&&De&&(F(Q,le,X.z,X.x,X.y+1),F(Q,Ne,X.z,He,X.y+1)),f[1]>0&&ke&&(F(Q,le,X.z,X.x,X.y-1),F(Q,Ne,X.z,He,X.y-1))):f[1]<0&&De?F(Q,le,X.z,X.x,X.y+1):ke&&F(Q,le,X.z,X.x,X.y-1);else{const je=Z.visibleQuadrants;1&je&&(F(Q,Ne,X.z,He,X.y),ke&&(F(Q,le,X.z,X.x,X.y-1),F(Q,Ne,X.z,He,X.y-1))),2&je&&(F(Q,tt,X.z,We,X.y),ke&&(F(Q,le,X.z,X.x,X.y-1),F(Q,tt,X.z,We,X.y-1))),4&je&&(F(Q,Ne,X.z,He,X.y),De&&(F(Q,le,X.z,X.x,X.y+1),F(Q,Ne,X.z,He,X.y+1))),8&je&&(F(Q,tt,X.z,We,X.y),De&&(F(Q,le,X.z,X.x,X.y+1),F(Q,tt,X.z,We,X.y+1)))}}const V=[];for(const j of v)v.some(Z=>j.isChildOf(Z))||V.push(j);if(v=V.filter(j=>!i.some(Z=>!!(j.overscaledZ<a&&Z.isChildOf(j))||j.equals(Z)||j.isChildOf(Z))),T){const j=1<<a,Z=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=[j*Z.x,j*Z.y],Q=4,le=Q*Q;v=v.filter(se=>{const me=se.canonical.x+.5-X[0],fe=se.canonical.y+.5-X[1];return me*me+fe*fe<le})}return v}coveringTiles(i){let a=this.coveringZoomLevel(i);const f=a,v=this.elevation&&this.elevation.exaggeration(),x=v&&!i.isTerrainDEM,T=this.projection.name==="mercator";if(i.minzoom!==void 0&&a<i.minzoom)return[];i.maxzoom!==void 0&&a>i.maxzoom&&(a=i.maxzoom);const I=this.locationCoordinate(this.center),F=this.center.lat,V=1<<a,j=[V*I.x,V*I.y,0],Z=this.projection.name==="globe",X=!Z,Q=r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,X),le=Z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),se=V*r.bH(1,this.center.lat),me=this._camera.position[2]/r.bH(1,this.center.lat),fe=[V*le.x,V*le.y,me*(X?1:se)],De=Z||v,ke=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),Ne=this.isLODDisabled(!0)?a:0;let tt;if(this._elevation&&i.isTerrainDEM)tt=1e4*this._elevation.exaggeration();else if(this._elevation){const Et=this._elevation.getMinMaxForVisibleTiles();tt=Et?Et.max:this._centerAltitude}else tt=this._centerAltitude;const He=i.isTerrainDEM?-tt:this._elevation?this._elevation.getMinElevationBelowMSL():0,We=this.projection.isReprojectedInTileSpace?r.bS(this):1,je=Et=>{const si=new r.aa(Et.x+25e-6,Et.y,Et.z),an=new r.aa(Et.x,Et.y+25e-6,Et.z),zi=Et.toLngLat(),yi=si.toLngLat(),Hi=an.toLngLat(),en=this.locationCoordinate(zi),bn=this.locationCoordinate(yi),Un=this.locationCoordinate(Hi),fr=Math.hypot(bn.x-en.x,bn.y-en.y),ur=Math.hypot(Un.x-en.x,Un.y-en.y);return Math.sqrt(fr*ur)*We/25e-6},at=Et=>{const hi=tt,si=He;return{aabb:r.bV(this,V,0,0,0,Et,si,hi,this.projection),zoom:0,x:0,y:0,minZ:si,maxZ:hi,wrap:Et,fullyVisible:!1}},gt=[];let Jt=[];const jt=a,fi=i.reparseOverscaled?f:a,ui=(me-this._centerAltitude)*se,Pt=Et=>{if(!this._elevation||!Et.tileID||!T)return;const hi=this._elevation.getMinMaxForTile(Et.tileID),si=Et.aabb;hi?(si.min[2]=hi.min,si.max[2]=hi.max,si.center[2]=(si.min[2]+si.max[2])/2):(Et.shouldSplit=Ii(Et),Et.shouldSplit||(si.min[2]=si.max[2]=si.center[2]=this._centerAltitude))},Kt=(Et,hi)=>{if(.707*hi<Et)return 1;const si=hi/Et;return si/(1.4144271570014144+(Math.pow(1.1,si-1.4144271570014144+1)-1)/(1.1-1)-1)},Ii=Et=>{if(Et.zoom<Ne)return!0;if(Et.zoom===jt)return!1;if(Et.shouldSplit!=null)return Et.shouldSplit;const hi=Et.aabb.distanceX(fe),si=Et.aabb.distanceY(fe);let an=ui,zi=1;if(Z){an=Et.aabb.distanceZ(fe);const ur=Math.pow(2,Et.zoom),lr=r.aS((Et.y+1)/ur),wr=r.aS(Et.y/ur),Tr=Math.min(Math.max(F,lr),wr),za=r.c9(Tr)/r.c9(F);if(zi=Tr===F?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,za/this._mercatorScaleRatio),this.zoom<=r.c6&&Et.zoom===jt-1&&za>=.9)return!0}else if(x&&(an=Et.aabb.distanceZ(fe)*se),this.projection.isReprojectedInTileSpace&&f<=5){const ur=Math.pow(2,Et.zoom),lr=je(new r.aa((Et.x+.5)/ur,(Et.y+.5)/ur));zi=lr>.85?1:lr}if(!T){const ur=Math.sqrt(hi*hi+si*si+an*an);let lr=(1<<jt-Et.zoom)*ke*zi;return lr*=Kt(Math.max(an,ui),ur),ur<lr}let yi=Number.MAX_VALUE,Hi=0;const en=Et.aabb.getCorners(),bn=[];for(const ur of en){r.ab.vec3.sub(bn,ur,fe),Z||(x?bn[2]*=se:bn[2]=ui);const lr=r.ab.vec3.dot(bn,this._camera.forward());lr<yi&&(yi=lr,Hi=Math.abs(bn[2]))}let Un=(1<<jt-Et.zoom)*ke*zi;if(Un*=Kt(Math.max(Hi,ui),yi),yi<Un)return!0;const fr=Et.aabb.closestPoint(j);return fr[0]===j[0]&&fr[1]===j[1]};if(this.renderWorldCopies)for(let Et=1;Et<=3;Et++)gt.push(at(-Et)),gt.push(at(Et));for(gt.push(at(0));gt.length>0;){const Et=gt.pop(),hi=Et.x,si=Et.y;let an=Et.fullyVisible;const zi=()=>this.projection.name==="globe"&&(Et.y===0||Et.y===(1<<Et.zoom)-1);if(!an){let yi=De?Et.aabb.intersects(Q):Et.aabb.intersectsFlat(Q);if(yi===0&&zi()){const Hi=new r.bT(Et.zoom,hi,si);yi=r.bU(this,V,Hi,!0).intersects(Q)}if(yi===0)continue;an=yi===2}if(Et.zoom!==jt&&Ii(Et))for(let yi=0;yi<4;yi++){const Hi=(hi<<1)+yi%2,en=(si<<1)+(yi>>1),bn={aabb:T?Et.aabb.quadrant(yi):r.bV(this,V,Et.zoom+1,Hi,en,Et.wrap,Et.minZ,Et.maxZ,this.projection),zoom:Et.zoom+1,x:Hi,y:en,wrap:Et.wrap,fullyVisible:an,tileID:void 0,shouldSplit:void 0,minZ:Et.minZ,maxZ:Et.maxZ};x&&!Z&&(bn.tileID=new r.aG(Et.zoom+1===jt?fi:Et.zoom+1,Et.wrap,Et.zoom+1,Hi,en),Pt(bn)),gt.push(bn)}else{const yi=Et.zoom===jt?fi:Et.zoom;if(i.minzoom&&i.minzoom>yi)continue;let Hi=0;if(!an){let fr=De?Et.aabb.intersectsPrecise(Q):Et.aabb.intersectsPreciseFlat(Q);if(fr===0&&zi()){const ur=new r.bT(Et.zoom,hi,si);fr=r.bU(this,V,ur,!0).intersectsPrecise(Q)}if(fr===0)continue;if(i.calculateQuadrantVisibility)if(Q.containsPoint(Et.aabb.center))Hi=15;else for(let ur=0;ur<4;ur++)Et.aabb.quadrant(ur).intersects(Q)!==0&&(Hi|=1<<ur)}const en=j[0]-(.5+hi+(Et.wrap<<Et.zoom))*(1<<a-Et.zoom),bn=j[1]-.5-si,Un=Et.tileID?Et.tileID:new r.aG(yi,Et.wrap,Et.zoom,hi,si);i.calculateQuadrantVisibility&&(Un.visibleQuadrants=Hi),Jt.push({tileID:Un,distanceSq:en*en+bn*bn})}}if(this.fogCullDistSq){const Et=this.fogCullDistSq,hi=this.horizonLineFromTop();Jt=Jt.filter(si=>{const an=[0,0,0,1],zi=[r.ag,r.ag,0,1],yi=this.calculateFogTileMatrix(si.tileID.toUnwrapped());r.ab.vec4.transformMat4(an,an,yi),r.ab.vec4.transformMat4(zi,zi,yi);const Hi=r.ab.vec4.min([],an,zi),en=r.ab.vec4.max([],an,zi),bn=r.bW(Hi,en);if(bn===0)return!0;let Un=!1;const fr=this._elevation;if(fr&&bn>Et&&hi!==0){const ur=this.calculateProjMatrix(si.tileID.toUnwrapped());let lr;i.isTerrainDEM||(lr=fr.getMinMaxForTile(si.tileID)),lr||(lr={min:He,max:tt});const wr=r.c7(this.rotation),Tr=[wr[0]*r.ag,wr[1]*r.ag,lr.max];r.ab.vec3.transformMat4(Tr,Tr,ur),Un=(1-Tr[1])*this.height*.5<hi}return bn<Et||Un})}return Jt.sort((Et,hi)=>Et.distanceSq-hi.distanceSq).map(Et=>Et.tileID)}resize(i,a){this.width=i,this.height=a,this.pixelsToGLUnits=[2/i,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const a=r.aw(i.lat,-r.bX,r.bX),f=this.projection.project(i.lng,a);return new r.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,a){let f,v;const x=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;f=(a.x-x.x)/I,v=(a.y-x.y)/I}else{const I=this.pointCoordinate(a),F=this.pointCoordinate(x);f=I.x-F.x,v=I.y-F.y}const T=this.locationCoordinate(i);this.setLocation(new r.aa(T.x-f,T.y-v))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,a){const f=a?r.bH(a,i.lat):void 0,v=this.projection.project(i.lng,i.lat);return new r.aa(v.x,v.y,f)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,a){const f=a??this._centerAltitude,v=[i.x,i.y,0,1],x=[i.x,i.y,1,1];r.ab.vec4.transformMat4(v,v,this.pixelMatrixInverse),r.ab.vec4.transformMat4(x,x,this.pixelMatrixInverse);const T=x[3];r.ab.vec4.scale(v,v,1/v[3]),r.ab.vec4.scale(x,x,1/T);const I=v[2],F=x[2];return{p0:v,p1:x,t:I===F?0:(f-I)/(F-I)}}screenPointToMercatorRay(i){const a=[i.x,i.y,0,1],f=[i.x,i.y,1,1];return r.ab.vec4.transformMat4(a,a,this.pixelMatrixInverse),r.ab.vec4.transformMat4(f,f,this.pixelMatrixInverse),r.ab.vec4.scale(a,a,1/a[3]),r.ab.vec4.scale(f,f,1/f[3]),a[2]=r.bH(a[2],this._center.lat)*this.worldSize,f[2]=r.bH(f[2],this._center.lat)*this.worldSize,r.ab.vec4.scale(a,a,1/this.worldSize),r.ab.vec4.scale(f,f,1/this.worldSize),new r.aq([a[0],a[1],a[2]],r.ab.vec3.normalize([],r.ab.vec3.sub([],f,a)))}rayIntersectionCoordinate(i){const{p0:a,p1:f,t:v}=i,x=r.bH(a[2],this._center.lat),T=r.bH(f[2],this._center.lat);return new r.aa(r.af(a[0],f[0],v)/this.worldSize,r.af(a[1],f[1],v)/this.worldSize,r.af(x,T,v))}pointCoordinate(i,a=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,a)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let a=this.projection.pointCoordinate3D(this,i.x,i.y);if(a)return new r.aa(a[0],a[1],a[2]);let f=0,v=this.horizonLineFromTop();if(i.y>v)return this.pointCoordinate(i);const x=.02*v,T=i.clone();for(let I=0;I<10&&v-f>x;I++){T.y=r.af(f,v,.66);const F=this.projection.pointCoordinate3D(this,T.x,T.y);F?(v=T.y,a=F):f=T.y}return a?new r.aa(a[0],a[1],a[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=r.bY)return!this.isPointAboveHorizon(i);const a=this.pointCoordinate(i);return a.y>=0&&a.y<=1}_coordinatePoint(i,a){const f=a&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,v=[i.x*this.worldSize,i.y*this.worldSize,f+i.toAltitude(),1];return r.ab.vec4.transformMat4(v,v,this.pixelMatrix),v[3]>0?new r.P(v[0]/v[3],v[1]/v[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:a}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,x=this.pointLocation3D(new r.P(a,i)),T=this.pointLocation3D(new r.P(v,i)),I=this.pointLocation3D(new r.P(v,f)),F=this.pointLocation3D(new r.P(a,f));let V=Math.min(x.lng,T.lng,I.lng,F.lng),j=Math.max(x.lng,T.lng,I.lng,F.lng),Z=Math.min(x.lat,T.lat,I.lat,F.lat),X=Math.max(x.lat,T.lat,I.lat,F.lat);const Q=Math.pow(2,-this.zoom)/16*270,le=this.projection.name==="globe"?1:4,se=(me,fe,De,ke,Ne)=>{const tt=(me+De)/2,He=(fe+ke)/2,We=new r.P(tt,He),{lng:je,lat:at}=this.pointLocation3D(We),gt=Math.max(0,V-je,Z-at,je-j,at-X);V=Math.min(V,je),j=Math.max(j,je),Z=Math.min(Z,at),X=Math.max(X,at),(Ne<le||gt>Q)&&(se(me,fe,tt,He,Ne+1),se(tt,He,De,ke,Ne+1))};if(se(a,i,v,i,1),se(v,i,v,f,1),se(v,f,a,f,1),se(a,f,a,i,1),this.projection.name==="globe"){const[me,fe]=r.bZ(this);me?(X=90,j=180,V=-180):fe&&(Z=-90,j=180,V=-180)}return new r.az(new r.bO(V,Z),new r.bO(j,X))}_getBoundsRectangular(i,a){const{top:f,left:v}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,I=new r.P(v,f),F=new r.P(T,f),V=new r.P(T,x),j=new r.P(v,x);let Z=this.pointCoordinate(I,i),X=this.pointCoordinate(F,i);const Q=this.pointCoordinate(V,a),le=this.pointCoordinate(j,a),se=(me,fe)=>(fe.y-me.y)/(fe.x-me.x);return Z.y>1&&X.y>=0?Z=new r.aa((1-le.y)/se(le,Z)+le.x,1):Z.y<0&&X.y<=1&&(Z=new r.aa(-le.y/se(le,Z)+le.x,0)),X.y>1&&Z.y>=0?X=new r.aa((1-Q.y)/se(Q,X)+Q.x,1):X.y<0&&Z.y<=1&&(X=new r.aa(-Q.y/se(Q,X)+Q.x,0)),new r.az().extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(le)).extend(this.coordinateLocation(Q))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=i.visibleDemTiles.reduce((f,v)=>{if(v.dem){const x=v.dem.tree;f.min=Math.min(f.min,x.minimums[0]),f.max=Math.max(f.max,x.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*i.exaggeration(),a.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-a*(1-this._horizonShift);return i?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-r.bX,this.maxLat=r.bX,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.at(this.minLng)*this.tileSize,this.worldMaxX=r.at(this.maxLng)*this.tileSize,this.worldMinY=r.aA(this.maxLat)*this.tileSize,this.worldMaxY=r.aA(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,a){return this.projection.createTileMatrix(this,a,i)}calculateDistanceTileData(i){const a=i.key,f=this._distanceTileDataCache;if(f[a])return f[a];const v=i.canonical,x=1/this.height,T=this.cameraWorldSize,I=T/this.zoomScale(v.z),F=(v.x+Math.pow(2,v.z)*i.wrap)*I,V=v.y*I,j=this.point;j.x*=T/this.worldSize,j.y*=T/this.worldSize;const Z=this.angle,X=Math.sin(-Z),Q=-Math.cos(-Z);return f[a]={bearing:[X,Q],center:[(j.x-F)*x,(j.y-V)*x],scale:I/r.ag*x},f[a]}calculateFogTileMatrix(i){const a=i.key,f=this._fogTileMatrixCache;if(f[a])return f[a];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return r.ab.mat4.multiply(v,this.worldToFogMatrix,v),f[a]=new Float32Array(v),f[a]}calculateProjMatrix(i,a=!1,f=!1){const v=i.key;let x;if(x=f?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,x[v])return x[v];const T=this.calculatePosMatrix(i,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,r.ab.mat4.multiply(T,I,T),x[v]=new Float32Array(T),x[v]}calculatePixelsToTileUnitsMatrix(i){const a=i.tileID.key,f=this._pixelsToTileUnitsCache;if(f[a])return f[a];const v=r.b_(i,this);return f[a]=v,f[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,a=r.ab.mat4.fromScaling([],[i,i,i]);return r.ab.mat4.multiply(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const a=r.bH(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(a),v=this._camera.forward(),x=r.bH(1,this._center.lat);f[2]/=x,v[2]/=x,r.ab.vec3.normalize(v,v);const T=i.raycast(f,v,i.exaggeration());if(T){const I=r.ab.vec3.scaleAndAdd([],f,v,T),F=new r.aa(I[0],I[1],r.bH(I[2],r.aS(I[1]))),V=(F.z+r.ab.vec3.length([F.x-f[0],F.y-f[1],F.z-f[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(V),this._centerAltitude=F.toAltitude(),this._center=this.coordinateLocation(F),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const a=this._elevation,f=r.bH(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(f),x=a.getAtPointOrZero(new r.aa(...v)),T=this.pixelsPerMeter/this.worldSize*x,I=this._minimumHeightOverTerrain(),F=v[2]-T;if(F<=I)if(F<0||i){const V=this.locationCoordinate(this._center,this._centerAltitude),j=[v[0],v[1],V.z-v[2]],Z=r.ab.vec3.length(j);j[2]-=(I-F)/this._pixelsPerMercatorPixel;const X=r.ab.vec3.length(j);if(X===0)return;r.ab.vec3.scale(j,j,Z/X*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],V.z*this._pixelsPerMercatorPixel-j[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const X=this.center;return X.lat=r.aw(X.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(X.lng=r.aw(X.lng,this.minLng,this.maxLng)),this.center=X,void(this._constraining=!1)}const a=this._unmodified,{x:f,y:v}=this.point;let x=0,T=f,I=v;const F=this.width/2,V=this.height/2,j=this.worldMinY*this.scale,Z=this.worldMaxY*this.scale;if(v-V<j&&(I=j+V),v+V>Z&&(I=Z-V),Z-j<this.height&&(x=Math.max(x,this.height/(Z-j)),I=(Z+j)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const X=this.worldMinX*this.scale,Q=this.worldMaxX*this.scale,le=this.worldSize/2-(X+Q)/2;T=(f+le+this.worldSize)%this.worldSize-le,T-F<X&&(T=X+F),T+F>Q&&(T=Q-F),Q-X<this.width&&(x=Math.max(x,this.width/(Q-X)),T=(Q+X)/2)}T===f&&I===v||(this.center=this.unproject(new r.P(T,I))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,a=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.bH(1,this.center.lat)/r.bH(1,r.c8));const v=r.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?f:1,T=this._camera.getWorldToCamera(this.worldSize,x);let I;const F=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(F[8]=2*-i.x/this.width,F[9]=2*i.y/this.height,this.isOrthographic){let at=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),gt=at*this.aspect,Jt=-gt,jt=-at;gt-=i.x,Jt-=i.x,at+=i.y,jt+=i.y,I=this._camera.getCameraToClipOrthographic(Jt,gt,jt,at,this._nearZ,this._farZ),((fi,ui,Pt,Kt)=>{for(let Ii=0;Ii<16;Ii++)fi[Ii]=tc(ui[Ii],Pt[Ii],Kt)})(I,I,F,iu(this.pitch>=15?1:this.pitch/15))}else I=F;const V=r.ab.mat4.mul([],F,T);let j=r.ab.mat4.mul([],I,T);if(this.projection.isReprojectedInTileSpace){const at=this.locationCoordinate(this.center),gt=r.ab.mat4.identity([]);r.ab.mat4.translate(gt,gt,[at.x*this.worldSize,at.y*this.worldSize,0]),r.ab.mat4.multiply(gt,gt,r.c0(this)),r.ab.mat4.translate(gt,gt,[-at.x*this.worldSize,-at.y*this.worldSize,0]),r.ab.mat4.multiply(j,j,gt),r.ab.mat4.multiply(V,V,gt),this.inverseAdjustmentMatrix=r.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.ab.mat4.scale([],j,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=j,this.invProjMatrix=r.ab.mat4.invert(new Float64Array(16),this.projMatrix),a){const at=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);at[8]=2*-i.x/this.width,at[9]=2*i.y/this.height,this.expandedFarZProjMatrix=r.ab.mat4.mul([],at,T)}else this.expandedFarZProjMatrix=this.projMatrix;const Z=r.ab.mat4.invert([],I);this.frustumCorners=r.c2.fromInvProjectionMatrix(Z,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);const X=new Float32Array(16);r.ab.mat4.identity(X),r.ab.mat4.scale(X,X,[1,-1,1]),r.ab.mat4.rotateX(X,X,this._pitch),r.ab.mat4.rotateZ(X,X,this.angle);const Q=r.ab.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.ab.mat4.clone(Q);const le=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Q[8]=2*-i.x/this.width,Q[9]=2*(i.y+le)/this.height,this.skyboxMatrix=r.ab.mat4.multiply(X,Q,X);const se=this.point,me=se.x,fe=se.y,De=this.width%2/2,ke=this.height%2/2,Ne=Math.cos(this.angle),tt=Math.sin(this.angle),He=me-Math.round(me)+Ne*De+tt*ke,We=fe-Math.round(fe)+Ne*ke+tt*De,je=new Float64Array(j);if(r.ab.mat4.translate(je,je,[He>.5?He-1:He,We>.5?We-1:We,0]),this.alignedProjMatrix=je,j=r.ab.mat4.create(),r.ab.mat4.scale(j,j,[this.width/2,-this.height/2,1]),r.ab.mat4.translate(j,j,[1,-1,0]),this.labelPlaneMatrix=j,j=r.ab.mat4.create(),r.ab.mat4.scale(j,j,[1,-1,1]),r.ab.mat4.translate(j,j,[-1,-1,0]),r.ab.mat4.scale(j,j,[2/this.width,2/this.height,1]),this.glCoordMatrix=j,this.pixelMatrix=r.ab.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,V),this._calcFogMatrices(),this._distanceTileDataCache={},j=r.ab.mat4.invert(new Float64Array(16),this.pixelMatrix),!j)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=j,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.c3(this);const at=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.ab.vec3.transformMat4(at,at,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=j;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,f=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,x=[i,i,a];r.ab.vec3.scale(x,x,v),r.ab.vec3.scale(f,f,-1),r.ab.vec3.multiply(f,f,x);const T=r.ab.mat4.create();r.ab.mat4.translate(T,T,f),r.ab.mat4.scale(T,T,x),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,a,v)}_computeCameraPosition(i){const a=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),v=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-i/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-f[0]*x,v.y/this.worldSize-f[1]*x,i/this.worldSize*this._centerAltitude-f[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],v=i[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(x=Math.min((a-f)/v,1)),this._camera.position=r.ab.vec3.scaleAndAdd([],this._camera.position,i,x),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,a=this._camera.forward(),{pitch:f,bearing:v}=this._camera.getPitchBearing(),x=r.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.ai(this._maxPitch)),I=Math.max((i[2]-x)/Math.cos(f),T),F=this._zoomFromMercatorZ(I);r.ab.vec3.scaleAndAdd(i,i,a,I),this._pitch=r.aw(f,r.ai(this.minPitch),r.ai(this.maxPitch)),this.angle=r.bF(v,-Math.PI,Math.PI),this._setZoom(r.aw(F,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.aa(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let a=0,f=r.bY,v=0,x=1/0;for(;f-a>1e-6&&f>a;){const T=a+.5*(f-a),I=this.tileSize*Math.pow(2,T),F=this.getCameraToCenterDistance(this.projection,T,I),V=this.scaleZoom(F/(i*this.tileSize)),j=Math.abs(T-V);j<x&&(x=j,v=T),T<V?a=T:f=T}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,a){const f=Math.min(i.x,a.x),v=Math.max(i.x,a.x),x=Math.min(i.y,a.y),T=Math.max(i.y,a.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new r.P(f,x),new r.P(v,T),new r.P(f,T),new r.P(v,x)],F=this.renderWorldCopies?-3:0,V=this.renderWorldCopies?4:1;for(const j of I){const Z=this.pointRayIntersection(j);if(Z.t<0)return!0;const X=this.rayIntersectionCoordinate(Z);if(X.x<F||X.y<0||X.x>V||X.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(i,a){const f=r.ab.vec3.length(r.ab.vec3.sub([],this._camera.position,i)),v=this._zoomFromMercatorZ(f)+a;return f-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([a,f,v],x){const T=[a,f,v,1];r.ab.vec4.transformMat4(T,T,x);const I=T[3]=Math.max(T[3],1e-6);return T[0]/=I,T[1]/=I,T[2]/=I,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,i))}}getCameraToCenterDistance(i,a=this.zoom,f=this.worldSize){const v=r.b$(i,a,this.width,this.height,1024),x=i.pixelSpaceConversion(this.center.lat,f,v);let T=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(T=tc(1,T,iu(this.pitch>=15?1:this.pitch/15))),T}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.ab.mat4.multiply(i,i,this.globeMatrix),i}getFrustum(i){return r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}const yc=(d,i)=>{if(i>0&&d.terrain&&r.w("Cutoff is currently disabled on terrain"),i<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const a=d.transform,f=Math.max(Math.abs(a._zoom-(d.minCutoffZoom-1)),1),v=a.isLODDisabled(!1)?r.ac(60,45,a.pitch):r.ac(30,15,a.pitch),x=a._farZ-a._nearZ,T=i*a.height,I=((1-(F=v))*a.cameraToCenterDistance+F*(a._farZ+T))*f;var F;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(I-a._nearZ)/x,(I-T-a._nearZ)/x]}}},wo={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Iu{constructor(i,a){this.aabb=i,this.lastCascade=a}}class Du{add(i,a){const f=this.receivers[i.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],a.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],a.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],a.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],a.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],a.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],a.max[2])):this.receivers[i.key]=new Iu(a,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,a,f){const v=r.cd.fromPoints(i.points);let x=0;for(const T in this.receivers){const I=this.receivers[T];if(!I||!v.intersectsAabb(I.aabb))continue;I.aabb.min=v.closestPoint(I.aabb.min),I.aabb.max=v.closestPoint(I.aabb.max);const F=I.aabb.getCorners();for(let V=0;V<f.length;V++){let j=!0;for(const Z of F){const X=[Z[0]*a,Z[1]*a,Z[2]];if(r.ab.vec3.transformMat4(X,X,f[V].matrix),X[0]<-1||X[0]>1||X[1]<-1||X[1]>1){j=!1;break}}if(I.lastCascade=V,x=Math.max(x,V),j)break}}return x+1}}class Kr{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Du,this._depthMode=new sr(i.context.gl.LEQUAL,sr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,i.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),i.tp.registerParameter(wo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter(wo,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),i.tp.registerParameter(wo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),i.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,a){const f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;const v=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||v<=0||(this._shadowLayerCount=f.style.order.reduce((le,se)=>{const me=f.style._mergedLayers[se];return le+(me.hasShadowPass()&&!me.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const x=f.context,T=wo.shadowMapResolution,I=wo.shadowMapResolution;if(this._cascades.length===0||wo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let le=0;le<wo.cascadeCount;++le){const se=f._shadowMapDebug,me=x.gl,fe=x.createFramebuffer(T,I,se,"texture"),De=new r.T(x,{width:T,height:I,data:null},me.DEPTH_COMPONENT16);if(fe.depthAttachment.set(De.texture),se){const ke=new r.T(x,{width:T,height:I,data:null},me.RGBA8);fe.colorAttachment.set(ke.texture)}this._cascades.push({framebuffer:fe,texture:De,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.bR,scale:0})}}this.shadowDirection=Zo(a);let F=0;if(i.elevation){const le=i.elevation,se=[1e4,-1e4];le.visibleDemTiles.filter(me=>me.dem).forEach(me=>{const fe=me.dem.tree;se[0]=Math.min(se[0],fe.minimums[0]),se[1]=Math.max(se[1],fe.maximums[0])}),se[0]!==1e4&&(F=(se[1]-se[0])*le.exaggeration())}const V=1.5*i.cameraToCenterDistance,j=3*V,Z=new Float64Array(16);for(let le=0;le<this._cascades.length;++le){const se=this._cascades[le];let me=i.height/50,fe=1;wo.cascadeCount===1?fe=j:le===0?fe=V:(me=V,fe=j);const[De,ke]=Op(i,this.shadowDirection,me,fe,wo.shadowMapResolution,F);se.scale=i.scale,se.matrix=De,se.boundingSphereRadius=ke,r.ab.mat4.invert(Z,se.matrix),se.frustum=r.bR.fromInvProjectionMatrix(Z,1,0,!0),se.far=fe}const X=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[X].far,this._cascades[X].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/wo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=wo.shadowMapResolution,this._uniformValues.u_shadowmap_0=bo.ShadowMap0,this._uniformValues.u_shadowmap_1=bo.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Q=f.transform.elevation;for(const le of this._groundShadowTiles){let se={min:0,max:0};if(Q){const me=Q.getMinMaxForTile(le);me&&(se=me)}this.addShadowReceiver(le.toUnwrapped(),se.min,se.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(i){this._enabled=i}drawShadowPass(i,a){if(!this.enabled)return;const f=this.painter,v=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),v.viewport.set([0,0,wo.shadowMapResolution,wo.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){f.currentShadowCascade=x,v.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),v.clear({color:r.aj.white,depth:1});for(const T of i.order){const I=i._mergedLayers[T];if(!I.hasShadowPass()||I.isHidden(f.transform.zoom))continue;const F=i.getLayerSourceCache(I),V=F?a[F.id]:void 0;(I.type==="model"||V&&V.length)&&f.renderLayer(f,F,I,V)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const i=this.painter,a=i.style,f=i.context,v=a.directionalLight,x=a.ambientLight;if(!v||!x)return;const T=[],I=yc(i,i.longestCutoffRange);I.shouldRenderCutoff&&T.push("RENDER_CUTOFF"),T.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&T.push("NORMAL_OFFSET");const F=qf(a,v,x),V=new sr(f.gl.LEQUAL,sr.ReadOnly,i.depthRangeFor3D);for(const j of this._groundShadowTiles){const Z=j.toUnwrapped(),X=i.isTileAffectedByFog(j),Q=i.getOrCreateProgram("groundShadow",{defines:T,overrideFog:X});this.setupShadows(Z,Q),i.uploadCommonUniforms(f,Q,Z,null,I);const le={u_matrix:i.transform.calculateProjMatrix(Z),u_ground_shadow_factor:F};Q.draw(i,f.gl.TRIANGLES,V,br.disabled,Fr.multiply,rr.disabled,le,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,{},i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Fr.unblended:Fr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){const a=this.painter.transform,f=a.calculatePosMatrix(i,a.worldSize);return r.ab.mat4.multiply(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(i){return r.ab.mat4.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,a,f,v=0){if(!this.enabled)return;const x=this.painter.transform,T=this.painter.context,I=T.gl,F=this._uniformValues,V=new Float64Array(16),j=x.calculatePosMatrix(i,x.worldSize);for(let Z=0;Z<this._cascades.length;Z++)r.ab.mat4.multiply(V,this._cascades[Z].matrix,j),F[Z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(V),T.activeTexture.set(I.TEXTURE0+bo.ShadowMap0+Z),this._cascades[Z].texture.bind(I.NEAREST,I.CLAMP_TO_EDGE);if(this.useNormalOffset=!!f,this.useNormalOffset){const Z=r.cc(i.canonical),X=2/x.tileSize*r.ag/wo.shadowMapResolution,Q=X*this._cascades[0].boundingSphereRadius,le=X*this._cascades[this._cascades.length-1].boundingSphereRadius,se=(f==="vector-tile"?1:3)/Math.pow(2,v-i.canonical.z-(1-x.zoom+Math.floor(x.zoom)));F.u_shadow_normal_offset=[Z,Q*se,le*se],F.u_shadow_bias=[6e-5,.0012,.012]}else F.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(T,F)}setupShadowsFromMatrix(i,a,f=!1){if(!this.enabled)return;const v=this.painter.context,x=v.gl,T=this._uniformValues,I=new Float64Array(16);for(let F=0;F<wo.cascadeCount;F++)r.ab.mat4.multiply(I,this._cascades[F].matrix,i),T[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),v.activeTexture.set(x.TEXTURE0+bo.ShadowMap0+F),this._cascades[F].texture.bind(x.NEAREST,x.CLAMP_TO_EDGE);if(this.useNormalOffset=f,f){const F=wo.normalOffset;T.u_shadow_normal_offset=[1,F,F],T.u_shadow_bias=[6e-5,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(v,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,a,f,v){if(v[2]>=0)return{};const x=function(F,V,j){const Z=j/(1<<F.canonical.z);return new r.cd([F.canonical.x*Z+F.wrap*j,F.canonical.y*Z+F.wrap*j,0],[(F.canonical.x+1)*Z+F.wrap*j,(F.canonical.y+1)*Z+F.wrap*j,V])}(i,a,f).getCorners(),T=a/-v[2];v[0]<0?(r.ab.vec3.add(x[0],x[0],[v[0]*T,0,0]),r.ab.vec3.add(x[3],x[3],[v[0]*T,0,0])):v[0]>0&&(r.ab.vec3.add(x[1],x[1],[v[0]*T,0,0]),r.ab.vec3.add(x[2],x[2],[v[0]*T,0,0])),v[1]<0?(r.ab.vec3.add(x[0],x[0],[0,v[1]*T,0]),r.ab.vec3.add(x[1],x[1],[0,v[1]*T,0])):v[1]>0&&(r.ab.vec3.add(x[2],x[2],[0,v[1]*T,0]),r.ab.vec3.add(x[3],x[3],[0,v[1]*T,0]));const I={};return I.vertices=x,I.planes=[dr(x[1],x[0],x[4]),dr(x[2],x[1],x[5]),dr(x[3],x[2],x[6]),dr(x[0],x[3],x[7])],I}addShadowReceiver(i,a,f){this._receivers.add(i,r.cd.fromTileIdAndHeight(i,a,f))}getMaxCascadeForTile(i){const a=this._receivers.get(i);return a&&a.lastCascade?a.lastCascade:0}}function dr(d,i,a){const f=r.ab.vec3.sub([],a,i),v=r.ab.vec3.sub([],d,i),x=r.ab.vec3.cross([],f,v),T=r.ab.vec3.length(x);return T===0?[0,0,1,0]:(r.ab.vec3.scale(x,x,1/T),[x[0],x[1],x[2],-r.ab.vec3.dot(x,i)])}function Zo(d){const i=d.properties.get("direction"),a=r.cb(i.x,i.y,i.z);a[2]=r.aw(a[2],0,75);const f=r.ce([a[0],a[1],a[2]]);return r.ab.vec3.fromValues(f.x,f.y,f.z)}function qf(d,i,a){const f=i.properties.get("color-use-theme")==="none",v=i.properties.get("color"),x=i.properties.get("intensity"),T=i.properties.get("direction"),I=[T.x,T.y,T.z],F=a.properties.get("color-use-theme")==="none",V=a.properties.get("color"),j=a.properties.get("intensity"),Z=Math.max(r.ab.vec3.dot([0,0,1],I),0),X=[0,0,0];r.ab.vec3.scale(X,V.toRenderColor(F?null:d.getLut(i.scope)).toArray01Linear().slice(0,3),j);const Q=[0,0,0];return r.ab.vec3.scale(Q,v.toRenderColor(f?null:d.getLut(a.scope)).toArray01Linear().slice(0,3),Z*x),r.cf([X[0]>0?X[0]/(X[0]+Q[0]):0,X[1]>0?X[1]/(X[1]+Q[1]):0,X[2]>0?X[2]/(X[2]+Q[2]):0])}function Op(d,i,a,f,v,x){const T=d.zoom,I=d.scale,F=d.worldSize,V=1/F,j=d.aspect,Z=Math.sqrt(1+j*j)*Math.tan(.5*d.fovX),X=Z*Z,Q=f-a,le=f+a;let se,me;X>Q/le?(se=f,me=f*Z):(se=.5*le*(1+X),me=.5*Math.sqrt(Q*Q+2*(f*f+a*a)*X+le*le*X*X));const fe=d.projection.pixelsPerMeter(d.center.lat,F),De=d._camera.getCameraToWorldMercator(),ke=[0,0,-se*V];r.ab.vec3.transformMat4(ke,ke,De);let Ne=me*V;const tt=d._edgeInsets;if(!(tt.left===0&&tt.top===0&&tt.right===0&&tt.bottom===0||tt.left===tt.right&&tt.top===tt.bottom)){const an=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?fe:1),zi=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,a,f);zi[8]=2*-d.centerOffset.x/d.width,zi[9]=2*d.centerOffset.y/d.height;const yi=new Float64Array(16);r.ab.mat4.mul(yi,zi,an);const Hi=new Float64Array(16);r.ab.mat4.invert(Hi,yi);const en=r.bR.fromInvProjectionMatrix(Hi,F,T,!0);for(const bn of en.points){const Un=((He=bn)[0]/=I,He[1]/=I,He[2]=r.bH(He[2],d._center.lat),He);Ne=Math.max(Ne,r.ab.vec3.len(r.ab.vec3.subtract([],ke,Un)))}}var He;Ne*=v/(v-1);const We=Math.acos(i[2]),je=Math.atan2(-i[0],-i[1]),at=new Po;at.position=ke,at.setPitchBearing(We,je);const gt=at.getWorldToCamera(F,fe),Jt=Ne*F,jt=Math.min(d._mercatorZfromZoom(17)*F*-2,-2*Jt),fi=at.getCameraToClipOrthographic(-Jt,Jt,-Jt,Jt,jt,(Jt+x*fe)/i[2]),ui=new Float64Array(16);r.ab.mat4.multiply(ui,fi,gt);const Pt=r.ab.vec3.fromValues(Math.floor(1e6*ke[0])/1e6*F,Math.floor(1e6*ke[1])/1e6*F,0),Kt=.5*v,Ii=[0,0,0];r.ab.vec3.transformMat4(Ii,Pt,ui),r.ab.vec3.scale(Ii,Ii,Kt);const Et=[Math.floor(Ii[0]),Math.floor(Ii[1]),Math.floor(Ii[2])],hi=[0,0,0];r.ab.vec3.sub(hi,Ii,Et),r.ab.vec3.scale(hi,hi,-1/Kt);const si=new Float64Array(16);return r.ab.mat4.identity(si),r.ab.mat4.translate(si,si,hi),r.ab.mat4.multiply(ui,si,ui),[ui,Jt]}class Wf extends r.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(i,a){return r.aM(this.requestManager.transformRequest(a,r.R.Model).url).then(f=>{if(!f)return;const v=r.aN(f),x=new r.aO(i,void 0,void 0,v);return x.computeBoundsAndApplyParent(),x}).catch(f=>{if(f&&f.status===404)return null;this.fire(new r.y(new Error(`Could not load model ${i} from ${a}: ${f.message}`)))})}load(i,a,f={keepNumReferences:!1}){this.models[a]||(this.models[a]={});const v=Object.keys(i);this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+v.length;const x=[];for(const T of v)x.push(this.loadModel(T,i[T]));Promise.allSettled(x).then(T=>{for(let I=0;I<T.length;I++){const{status:F,value:V}=T[I];if(F==="fulfilled"&&V){const j=this.models[a][v[I]];this.models[a][v[I]]={model:V,numReferences:f.keepNumReferences&&j?j.numReferences:1}}}this.numModelsLoading[a]-=v.length,this.fire(new r.z("data",{dataType:"style"}))}).catch(T=>{this.fire(new r.y(new Error(`Could not load models: ${T.message}`)))})}isLoaded(){for(const i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,a){return!!this.getModel(i,a)}getModel(i,a){return this.models[a]||(this.models[a]={}),this.models[a][i]?this.models[a][i].model:void 0}addModel(i,a,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={}),this.hasModel(i,f)&&this.models[f][i].numReferences++,this.modelUris[f][i]=this.requestManager.normalizeModelURL(a),this.load({[i]:this.modelUris[f][i]},f)}addModels(i,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const f=this.modelUris[a];for(const v in i)this.models[a][v]={},f[v]=this.requestManager.normalizeModelURL(i[v]);this.load(f,a,{keepNumReferences:!0})}reloadModels(i){this.load(this.modelUris[i],i)}addModelsFromBucket(i,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const f={};for(const v of i)this.hasModel(v,a)?this.models[a][v].numReferences++:(this.modelUris[a][v]=this.requestManager.normalizeModelURL(v),f[v]=this.modelUris[a][v]);this.load(f,a)}removeModel(i,a){if(this.models[a]&&this.models[a][i]&&(this.models[a][i].numReferences--,this.models[a][i].numReferences===0)){const f=this.models[a][i].model;delete this.models[a][i],delete this.modelUris[a][i],f.destroy()}}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,a){this.models[a]||(this.models[a]={});for(const f in this.models[a])this.models[a][f].model&&this.models[a][f].model.upload(i.context)}}const fp=new r.a5({data:new r.a6(r.a3.colorTheme.data)}),Bp={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function pp(d){return d=d||{},Object.assign(d,Bp)}class vc extends r.E{constructor(i){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},r.aP(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=i,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(i=>{i.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new r.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=i.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=i.stylesheet.indoor.buildingFeaturesetId,this._scope=i.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:i=>(i.feature&&i.feature.properties.floorplan&&this.selectFloorplan(i.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(i){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(T,I){const[F,V]=T,{center:j,radius:Z}=I,[X,Q]=j,le=Math.abs(F-X);return Math.sqrt((le>180?360-le:le)**2+(V-Q)**2)<=Z}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new r.z("floorplangone")));const a={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},f=new r.P(this._map.transform.width/2,this._map.transform.height/2),v=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],x=this._map.queryRenderedFeatures(i?v:f,a);x.length>0&&(this._selectedFloorplan&&x[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=x[0],this._floorplanSelected(!1)))}_floorplanSelected(i){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(x){const[[T,I],[F,V]]=x,j=(F-T+360)%360,Z=j>180?360-j:j;return{center:[(T+Z/2+360)%360,(I+V)/2],radius:Math.sqrt(Z**2+(V-I)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const a=this._floorplanStates[this._indoorData.id].selectedBuilding,f=this._floorplanStates[this._indoorData.id].selectedLevel;let v;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const x of this._indoorData.levels)x.id===this._selectedLevel.id&&(v=x.id);if(this.fire(new r.z("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:v})),a){const x=this._indoorData.buildings.find(T=>T.id===a);this._buildingSelected(x,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(f){const x=this._indoorData.levels.find(T=>T.id===f);this._updateLevels(x,i)}else i&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(i,a){a&&i&&i.extent&&this._map.fitBounds(i.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=i?i.id:void 0;const f=this._indoorData.levels.filter(v=>i.levels.includes(v.id));this.fire(new r.z("buildingselected",{buildingId:i.id,levels:f}))}_levelSelected(i){if(i==="overview")this._updateLevels(void 0,!0);else{const a=this._indoorData.levels.find(f=>f.id===i);this._updateLevels(a,!0)}this.fire(new r.z("levelselected",{levelId:i==="overview"?void 0:i}))}_updateLevels(i,a){if(!i)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(a&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function f(V){const j=V.indexOf("/floor/");if(j===-1)return V;const Z=j+7,X=V.indexOf("/",Z);return X===-1?V.slice(Z):V.slice(Z,X)}this._selectedLevel=i,this._floorplanStates[this._indoorData.id].selectedLevel=i?i.id:void 0;const v=[],x={},T={},I={},F={};for(const V of this._indoorData.levels)if(v.push(V.id),x[V.id]=V.height,T[V.id]=V.base,i){if(this.mergeFloors){const j=f(i.id),Z=f(V.id);I[V.id]=Z===j?"true":"false"}else I[V.id]=V.id===i.id?"true":"false";F[V.id]=V.base<i.base?"true":"false"}else F[V.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",v]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",x]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",T]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",I]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",F]),i&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!i.isUnderground),a&&i.extent)){const V=this._map.cameraForBounds(i.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),j=this._map.getZoom(),Z=V.zoom?Math.abs(j-V.zoom):0;this._map.fitBounds(i.extent,Z>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:j})}}selectFloorplan(i){const a={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},f=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],v=this._map.queryRenderedFeatures(f,a);if(v.length>0){for(const x of v)if(JSON.parse(x.properties["indoor-data"]).floorplanIDs.includes(i)){this._selectedFloorplan=x,this._floorplanSelected(!0);break}}}selectBuilding(i){const a=this._indoorData.buildings.find(f=>f.id===i);this._buildingSelected(a,!0)}selectLevel(i){this._levelSelected(i)}}function hh(d){if(!d.metadata||!d.metadata.content_area)return;const i=r.q.devicePixelRatio,{left:a,top:f,width:v,height:x}=d.metadata.content_area,T=a*i,I=f*i;return[T,I,T+v*i,I+x*i]}function Al(d){if(d)return d.map(([i,a])=>[i*r.q.devicePixelRatio,a*r.q.devicePixelRatio])}const nu=(d,i)=>Io(d,i&&i.filter(a=>a.identifier!=="source.canvas")),mp=r.ay(Di,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),kc=r.ay(Di,["setCenter","setZoom","setBearing","setPitch"]),sl=new Set(["background","sky","slot","custom"]),zu={version:8,layers:[],sources:{}},jh={duration:300,delay:0};class Oo extends r.E{constructor(i,a={}){super(),this.map=i,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=r.l({},jh),this._buildingIndex=new ri(this),this.crossTileSymbolIndex=new eo,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new ra,this.dispatcher=a.dispatcher?a.dispatcher:new r.D(r.ci(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new cn(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new r.cj(i._requestManager,a.localFontFamily?r.ck.all:a.localIdeographFontFamily?r.ck.ideographs:r.ck.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new Wf(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:a.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",r.cl());const f=this;this._rtlTextPluginCallback=Oo.registerForPluginStateChange(v=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(x,T)=>{if(r.cm(x),T&&T.every(I=>I))for(const I in f._sourceCaches){const F=f._sourceCaches[I],V=F.getSource().type;V!=="vector"&&V!=="geojson"||F.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const x=this.getOwnSource(v.sourceId);if(x&&x.vectorLayerIds)for(const T in this._layers){const I=this._layers[T];I.source===x.id&&this._validateLayer(I)}})}load(i){return i?(typeof i=="string"?this.loadURL(i):this.loadJSON(i),this):this}_getGlobalId(i){if(!i)return null;if(typeof i=="string"){if(r.f(i))return i;const a=r.cn(i);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${r.co(JSON.stringify(i))}`}_diffStyle(i,a,f){this.globalId=this._getGlobalId(i);const v=(x,T)=>{try{T(null,this.setState(x,f))}catch(I){T(I,!1)}};if(typeof i=="string"){const x=this.map._requestManager.normalizeStyleURL(i),T=this.map._requestManager.transformRequest(x,r.R.Style);r.n(T,(I,F)=>{I?this.fire(new r.y(I)):F&&v(F,a)})}else typeof i=="object"&&v(i,a)}loadURL(i,a={}){this.fire(new r.z("dataloading",{dataType:"style"}));const f=typeof a.validate=="boolean"?a.validate:!r.f(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,a.accessToken),this.resolvedImports.add(i);const v=this.importsCache.get(i);if(v)return this._load(v,f);const x=this.map._requestManager.transformRequest(i,r.R.Style);this._request=r.n(x,(T,I)=>{if(this._request=null,T)this.fire(new r.y(T));else if(I)return this.importsCache.set(i,I),this._load(I,f)})}loadJSON(i,a={}){this.fire(new r.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=r.q.frame(()=>{this._request=null,this._load(i,a.validate!==!1)})}loadEmpty(){this.fire(new r.z("dataloading",{dataType:"style"})),this._load(zu,!1)}_loadImports(i,a,f){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const v=[];for(const x of i){const T=this._createFragmentStyle(x),I=new Promise(j=>{T.once("style.import.load",j),T.once("error",j)}).then(()=>this.mergeAll());if(v.push(I),this.resolvedImports.has(x.url)){T.loadEmpty();continue}const F=x.data||this.importsCache.get(x.url);F?(T.loadJSON(F,{validate:a}),this._isInternalStyle(F)&&(T.globalId=null)):x.url?T.loadURL(x.url,{validate:a}):T.loadEmpty();const V={style:T,id:x.id,config:x.config};if(f){const j=this.fragments.findIndex(({id:Z})=>Z===f);this.fragments=this.fragments.slice(0,j).concat(V).concat(this.fragments.slice(j))}else this.fragments.push(V)}return Promise.allSettled(v)}getImportGlobalIds(i=this,a=new Set){for(const f of i.fragments)f.style.globalId&&a.add(f.style.globalId),this.getImportGlobalIds(f.style,a);return[...a.values()]}_createFragmentStyle(i){const a=this.scope?r.aC(i.id,this.scope):i.id;let f;const v=this._initialConfig&&this._initialConfig[a];(i.config||v)&&(f=r.l({},i.config,v));const x=new Oo(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:f,configOptions:this.options,colorThemeOverride:i["color-theme"],configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(i){return this.isRootStyle()&&(i.fragment||!!i.schema&&i.fragment!==!1)}_load(i,a){const f=i.indoor?pp(i.schema):i.schema;if(this._isInternalStyle(i)){const T=r.l({},zu,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(T,a)}if(this.updateConfig(this._config,f),a&&nu(this,Us(i)))return;this._loaded=!0,this.stylesheet=r.cp(i);const v=()=>{for(const V in i.sources)this.addSource(V,i.sources[V],{validate:!1,isInitialLoad:!0});i.sprite?this._loadIconset(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(i.glyphs,this.scope);const T=sn(this.stylesheet.layers);if(this._order=T.map(V=>V.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const V=this.stylesheet.lights[0];this.light=new oe(V.properties,V.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new oe(this.stylesheet.light)),this._layers={};for(const V of T){const j=r.cu(V,this.scope,this._styleColorTheme.lut,this.options);j.configDependencies.size!==0&&this._configDependentLayers.add(j.fqid),j.setEventedParent(this,{layer:{id:j.id}}),this._layers[j.id]=j;const Z=this.getOwnLayerSourceCache(j),X=!!this.directionalLight&&this.directionalLight.shadowsEnabled();Z&&j.canCastShadows()&&X&&(Z.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const I=this.stylesheet.terrain;I&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(I,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.z("data",{dataType:"style"}));const F=this.isRootStyle();i.imports?this._loadImports(i.imports,a).then(()=>{this._reloadImports(),this.fire(new r.z(F?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.z(F?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const x=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(x){const T=this._evaluateColorThemeData(x);this._loadColorTheme(T).then(()=>{v()}).catch(I=>{r.w(`Couldn't load color theme from the stylesheet: ${I}`),v()})}else this._styleColorTheme.lut=null,v()}isRootStyle(){return this.importDepth===0}mergeAll(){let i,a,f,v,x,T,I,F,V,j;const Z={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(X=>{if(X.stylesheet){if(X.light!=null&&(i=X.light),X.stylesheet.lights)for(const Q of X.stylesheet.lights)Q.type==="ambient"&&X.ambientLight!=null&&(a=X.ambientLight),Q.type==="directional"&&X.directionalLight!=null&&(f=X.directionalLight);v=this._prioritizeTerrain(v,X.terrain,X.stylesheet.terrain),X.stylesheet.fog&&X.fog!=null&&(x=X.fog),X.stylesheet.snow&&X.snow!=null&&(T=X.snow),X.stylesheet.rain&&X.rain!=null&&(I=X.rain),X.stylesheet.camera!=null&&(j=X.stylesheet.camera),X.stylesheet.projection!=null&&(F=X.stylesheet.projection),X.stylesheet.transition!=null&&(V=X.stylesheet.transition),Z[X.scope]=X._styleColorTheme}}),this.light=i,this.ambientLight=a,this.directionalLight=f,this.fog=x,this.snow=T,this.rain=I,this._styleColorThemeForScope=Z,v===null?delete this.terrain:this.terrain=v,this.camera=j||{"camera-projection":"perspective"},this.projection=F||{name:"mercator"},this.transition=r.l({},jh,V),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){const a=f=>{for(const v of f.fragments)a(v.style);i(f)};a(this)}_prioritizeTerrain(i,a,f){const v=i&&i.drapeRenderMode===0;return f===null?a&&a.drapeRenderMode===0?a:v?i:null:a!=null&&(!i||v||a&&a.drapeRenderMode===1)?a:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{i=this._prioritizeTerrain(i,a.terrain,a.stylesheet.terrain)}),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(i=a.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){const i={},a={},f={};this.forEachFragmentStyle(v=>{for(const x in v._sourceCaches){const T=r.aC(x,v.scope);i[T]=v._sourceCaches[x]}for(const x in v._otherSourceCaches){const T=r.aC(x,v.scope);a[T]=v._otherSourceCaches[x]}for(const x in v._symbolSourceCaches){const T=r.aC(x,v.scope);f[T]=v._symbolSourceCaches[x]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=f}mergeLayers(){const i={},a=[],f={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(x=>{for(const T of x._order){const I=x._layers[T];if(I.type==="slot"){const F=r.cq(T);if(i[F])continue;i[F]=[]}I.slot&&i[I.slot]?i[I.slot].push(I):a.push(I)}}),this._mergedOrder=[];const v=(x=[])=>{for(const T of x)if(T.type==="slot"){const I=r.cq(T.id);i[I]&&v(i[I]),this._mergedSlots.push(I)}else{const I=r.aC(T.id,T.scope);this._mergedOrder.push(I),f[I]=T,T.is3D()&&(this._has3DLayers=!0),T.type==="circle"&&(this._hasCircleLayers=!0),T.type==="symbol"&&(this._hasSymbolLayers=!0),T.type==="clip"&&(this._clipLayerPresent=!0)}};v(a),this._mergedOrder.sort((x,T)=>{const I=f[x],F=f[T];return I.hasInitialOcclusionOpacityProperties?F.is3D()?1:0:I.is3D()&&F.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=r.l({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(i){return i.data?function(a,f,v){const x=r.l({},f);for(const I of Object.keys(r.a3.colorTheme))x[I]===void 0&&(x[I]=r.a3.colorTheme[I].default);const T=new r.a4(fp,a,new Map(v));return T.setTransitionOrValue(x,v),T.untransitioned().possiblyEvaluate(new r.a8(0))}(this.scope,i,this.options).get("data"):null}_loadColorTheme(i){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((f,v)=>{const x="data:image/png;base64,";if(!i||i.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void f();let T=i;T.startsWith(x)||(T=x+T);const I="mapbox-reserved-lut",F=new Image;F.src=T,F.onerror=()=>{this._styleColorTheme.lutLoading=!1,v(new Error("Failed to load image data"))},F.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void f();this._styleColorTheme.lutLoading=!1;const{width:V,height:j,data:Z}=r.q.getImageData(F);if(j>32)return void v(new Error("The height of the image must be less than or equal to 32 pixels."));if(V!==j*j)return void v(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new r.r({width:V,height:j},Z),pixelRatio:1,sdf:!1,usvg:!1,version:0});const X=this.imageManager.getImage(I,this.scope);X?(this._styleColorTheme.lut={image:X.data,data:i},f()):v(new Error("Missing LUT image."))}})}getLut(i){const a=this._styleColorThemeForScope[i];return a?a.lut:null}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(a,f,v){let x,T,I;const F=r.q.devicePixelRatio>1?"@2x":"";let V=r.n(f.transformRequest(f.normalizeSpriteURL(a,F,".json"),r.R.SpriteJSON),(X,Q)=>{V=null,I||(I=X,x=Q,Z())}),j=r.o(f.transformRequest(f.normalizeSpriteURL(a,F,".png"),r.R.SpriteImage),(X,Q)=>{j=null,I||(I=X,T=Q,Z())});function Z(){if(I)v(I);else if(x&&T){const X=r.q.getImageData(T),Q={};for(const le in x){const{width:se,height:me,x:fe,y:De,sdf:ke,pixelRatio:Ne,stretchX:tt,stretchY:He,content:We}=x[le],je=new r.r({width:se,height:me});r.r.copy(X,je,{x:fe,y:De},{x:0,y:0},{width:se,height:me},null),Q[le]={data:je,pixelRatio:Ne,sdf:ke,stretchX:tt,stretchY:He,content:We,usvg:!1}}v(null,Q)}}return{cancel(){V&&(V.cancel(),V=null),j&&(j.cancel(),j=null)}}}(i,this.map._requestManager,(a,f)=>{if(this._spriteRequest=null,a)this.fire(new r.y(a));else if(f)for(const v in f)this.imageManager.addImage(v,this.scope,f[v]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))})}_loadIconset(i){if(!r.f(i)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(i);const a=this.map._spriteFormat==="auto";var f,v;this._spriteRequest=(v=(x,T)=>{if(this._spriteRequest=null,x)a?this._loadSprite(i):this.fire(new r.y(x));else if(T)for(const I in T)this.imageManager.addImage(I,this.scope,T[I]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))},r.bi((f=this.map._requestManager).transformRequest(f.normalizeIconsetURL(i),r.R.Iconset),(x,T)=>{if(x)return void v(x);const I={},F=r.cg(new r.bh(T));for(const V of F.icons){const j={version:1,pixelRatio:r.q.devicePixelRatio,content:hh(V),stretchX:V.metadata?Al(V.metadata.stretch_x_areas):void 0,stretchY:V.metadata?Al(V.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:V};I[V.name]=j}v(null,I)}))}_validateLayer(i){const a=this.getOwnSource(i.source);if(!a)return;const f=i.sourceLayer;f&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(f)===-1)&&this.fire(new r.y(new Error(`Source layer "${f}" does not exist on source "${a.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,a)=>{const f=this.fragments[a];return f&&f.style&&(i.data=f.style.serialize()),i})}_serializeSources(){const i={};for(const a in this._sourceCaches){const f=this._sourceCaches[a].getSource();i[f.id]||(i[f.id]=f.serialize())}return i}_serializeLayers(i){const a=[];for(const f of i){const v=this._layers[f];v&&v.type!=="custom"&&a.push(v.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(i){return i?this.order:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&i.isDraped(this.getLayerSourceCache(i))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){const a=this.getOwnLayer(i);if(a)return a;this.fire(new r.y(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){const a=this.getOwnSource(i);if(a)return a;this.fire(new r.y(new Error(`The source '${i}' does not exist in the map's style.`)))}precompilePrograms(i,a){const f=this.map.painter;if(f)for(let v=i.minzoom||0;v<(i.maxzoom||25.5);v++){const x=i.getProgramIds();if(x)for(const T of x){const I=i.getDefaultProgramParams(T,a.zoom,this._styleColorTheme.lut);I&&(f.style=this,this.fog&&(f._fogVisible=!0,I.overrideFog=!0,f.getOrCreateProgram(T,I)),f._fogVisible=!1,I.overrideFog=!1,f.getOrCreateProgram(T,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,f.getOrCreateProgram(T,I)))}}}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);const a=this.calculateLightsBrightness();i.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a));const f=this._changes.isDirty();let v=!1;if(this._changes.isDirty()){const T=this._changes.getLayerUpdatesByScope();for(const I in T){const{updatedIds:F,removedIds:V}=T[I];(F||V)&&(this._updateWorkerLayers(I,F,V),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this.snow&&this.snow.updateTransitions(i),this.rain&&this.rain.updateTransitions(i),this._changes.reset()}const x={};for(const T in this._mergedSourceCaches){const I=this._mergedSourceCaches[T];x[T]=I.used,I.used=!1,I.tileCoverLift=0}for(const T of this._mergedOrder){const I=this._mergedLayers[T];if(I.recalculate(i,this._availableImages),!I.isHidden(i.zoom)){const F=this.getLayerSourceCache(I);F&&(F.used=!0,F.tileCoverLift=Math.max(F.tileCoverLift,I.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(I,i)}):this.precompilePrograms(I,i))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();for(const T in x){const I=this._mergedSourceCaches[T];x[T]!==I.used&&I.getSource().fire(new r.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.snow&&this.snow.recalculate(i),this.rain&&this.rain.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new r.z("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=this._changes.getUpdatedImages();if(i.length){for(const a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],i);this._changes.resetUpdatedImages()}}_updateWorkerLayers(i,a,f){const v=this.getFragmentStyle(i);v&&this.dispatcher.broadcast("updateLayers",{layers:a?v._serializeLayers(a):[],scope:i,removedIds:f||[],options:v.options})}setState(i,a){if(this._checkLoaded(),nu(this,Us(i)))return!1;(i=r.cp(i)).layers=sn(i.layers);const f=function(T,I){if(!T)return[{command:Di.setStyle,args:[I]}];let F=[];try{if(!r.bn(T.version,I.version))return[{command:Di.setStyle,args:[I]}];if(r.bn(T.center,I.center)||F.push({command:Di.setCenter,args:[I.center]}),r.bn(T.zoom,I.zoom)||F.push({command:Di.setZoom,args:[I.zoom]}),r.bn(T.bearing,I.bearing)||F.push({command:Di.setBearing,args:[I.bearing]}),r.bn(T.pitch,I.pitch)||F.push({command:Di.setPitch,args:[I.pitch]}),r.bn(T.sprite,I.sprite)||F.push({command:Di.setSprite,args:[I.sprite]}),r.bn(T.glyphs,I.glyphs)||F.push({command:Di.setGlyphs,args:[I.glyphs]}),r.bn(T.imports,I.imports)||function(Q=[],le=[],se){le=le||[];const me=(Q=Q||[]).map(qn),fe=le.map(qn),De=Q.reduce(rn,{}),ke=le.reduce(rn,{}),Ne=me.slice();let tt,He,We,je;for(tt=0,He=0;tt<me.length;tt++)We=me[tt],ke.hasOwnProperty(We)?He++:(se.push({command:Di.removeImport,args:[We]}),Ne.splice(Ne.indexOf(We,He),1));for(tt=0,He=0;tt<fe.length;tt++)We=fe[fe.length-1-tt],Ne[Ne.length-1-tt]!==We&&(De.hasOwnProperty(We)?(se.push({command:Di.removeImport,args:[We]}),Ne.splice(Ne.lastIndexOf(We,Ne.length-He),1)):He++,je=Ne[Ne.length-tt],se.push({command:Di.addImport,args:[ke[We],je]}),Ne.splice(Ne.length-tt,0,We));for(const at of le){const gt=De[at.id];gt&&!r.bn(gt,at)&&se.push({command:Di.updateImport,args:[at.id,at]})}}(T.imports,I.imports,F),r.bn(T.transition,I.transition)||F.push({command:Di.setTransition,args:[I.transition]}),r.bn(T.light,I.light)||F.push({command:Di.setLight,args:[I.light]}),r.bn(T.fog,I.fog)||F.push({command:Di.setFog,args:[I.fog]}),r.bn(T.snow,I.snow)||F.push({command:Di.setSnow,args:[I.snow]}),r.bn(T.rain,I.rain)||F.push({command:Di.setRain,args:[I.rain]}),r.bn(T.projection,I.projection)||F.push({command:Di.setProjection,args:[I.projection]}),r.bn(T.lights,I.lights)||F.push({command:Di.setLights,args:[I.lights]}),r.bn(T.camera,I.camera)||F.push({command:Di.setCamera,args:[I.camera]}),!r.bn(T["color-theme"],I["color-theme"]))return[{command:Di.setStyle,args:[I]}];const V={},j=[];(function(Q,le,se,me){let fe;for(fe in le=le||{},Q=Q||{})Q.hasOwnProperty(fe)&&(le.hasOwnProperty(fe)||on(fe,se,me));for(fe in le){if(!le.hasOwnProperty(fe))continue;const De=le[fe];Q.hasOwnProperty(fe)?r.bn(Q[fe],De)||(Q[fe].type==="geojson"&&De.type==="geojson"&&yn(Q,le,fe)?se.push({command:Di.setGeoJSONSourceData,args:[fe,De.data]}):Ft(fe,le,se,me)):Jn(fe,le,se)}})(T.sources,I.sources,j,V);const Z=[];T.layers&&T.layers.forEach(Q=>{Q.source&&V[Q.source]?F.push({command:Di.removeLayer,args:[Q.id]}):Z.push(Q)});let X=T.terrain;X&&V[X.source]&&(F.push({command:Di.setTerrain,args:[void 0]}),X=void 0),F=F.concat(j),r.bn(X,I.terrain)||F.push({command:Di.setTerrain,args:[I.terrain]}),function(Q,le,se){le=le||[];const me=(Q=Q||[]).map(qn),fe=le.map(qn),De=Q.reduce(rn,{}),ke=le.reduce(rn,{}),Ne=me.slice(),tt=Object.create(null);let He,We,je,at,gt,Jt,jt;for(He=0,We=0;He<me.length;He++)je=me[He],ke.hasOwnProperty(je)?We++:(se.push({command:Di.removeLayer,args:[je]}),Ne.splice(Ne.indexOf(je,We),1));for(He=0,We=0;He<fe.length;He++)je=fe[fe.length-1-He],Ne[Ne.length-1-He]!==je&&(De.hasOwnProperty(je)?(se.push({command:Di.removeLayer,args:[je]}),Ne.splice(Ne.lastIndexOf(je,Ne.length-We),1)):We++,Jt=Ne[Ne.length-He],se.push({command:Di.addLayer,args:[ke[je],Jt]}),Ne.splice(Ne.length-He,0,je),tt[je]=!0);for(He=0;He<fe.length;He++)if(je=fe[He],at=De[je],gt=ke[je],!tt[je]&&!r.bn(at,gt))if(r.bn(at.source,gt.source)&&r.bn(at["source-layer"],gt["source-layer"])&&r.bn(at.type,gt.type)){for(jt in Si(at.layout,gt.layout,se,je,null,Di.setLayoutProperty),Si(at.paint,gt.paint,se,je,null,Di.setPaintProperty),r.bn(at.slot,gt.slot)||se.push({command:Di.setSlot,args:[je,gt.slot]}),r.bn(at.filter,gt.filter)||se.push({command:Di.setFilter,args:[je,gt.filter]}),r.bn(at.minzoom,gt.minzoom)&&r.bn(at.maxzoom,gt.maxzoom)||se.push({command:Di.setLayerZoomRange,args:[je,gt.minzoom,gt.maxzoom]}),at)at.hasOwnProperty(jt)&&jt!=="layout"&&jt!=="paint"&&jt!=="filter"&&jt!=="metadata"&&jt!=="minzoom"&&jt!=="maxzoom"&&jt!=="slot"&&(jt.indexOf("paint.")===0?Si(at[jt],gt[jt],se,je,jt.slice(6),Di.setPaintProperty):r.bn(at[jt],gt[jt])||se.push({command:Di.setLayerProperty,args:[je,jt,gt[jt]]}));for(jt in gt)gt.hasOwnProperty(jt)&&!at.hasOwnProperty(jt)&&jt!=="layout"&&jt!=="paint"&&jt!=="filter"&&jt!=="metadata"&&jt!=="minzoom"&&jt!=="maxzoom"&&jt!=="slot"&&(jt.indexOf("paint.")===0?Si(at[jt],gt[jt],se,je,jt.slice(6),Di.setPaintProperty):r.bn(at[jt],gt[jt])||se.push({command:Di.setLayerProperty,args:[je,jt,gt[jt]]}))}else se.push({command:Di.removeLayer,args:[je]}),Jt=Ne[Ne.lastIndexOf(je)+1],se.push({command:Di.addLayer,args:[gt,Jt]})}(Z,I.layers,F)}catch(V){console.warn("Unable to compute style diff:",V),F=[{command:Di.setStyle,args:[I]}]}return F}(this.serialize(),i).filter(T=>!(T.command in kc));if(f.length===0)return!1;const v=f.filter(T=>!(T.command in mp));if(v.length>0)throw new Error(`Unimplemented: ${v.map(T=>T.command).join(", ")}.`);const x=[];return f.forEach(T=>{x.push(this[T.command].apply(this,T.args))}),a&&Promise.all(x).then(a),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(i,a){return this.getImage(i)?this.fire(new r.y(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,this.scope,a),this._afterImageUpdated(i),this)}updateImage(i,a,f=!1){this.imageManager.updateImage(i,this.scope,a),f&&this._afterImageUpdated(i)}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._afterImageUpdated(i),this):this.fire(new r.y(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(i),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.z("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(i,a,f={}){return this._checkLoaded(),this._validate(Ro,`models.${i}`,a,null,f)||(this.modelManager.addModel(i,a,this.scope),this._changes.setDirty()),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope),this):this.fire(new r.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,a,f={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(Ca,`sources.${i}`,a,null,f))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const v=_s(i,a,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));const x=T=>{const I=(T?"symbol:":"other:")+v.id,F=r.aC(I,this.scope),V=this._sourceCaches[I]=new he(F,v,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=V,V.onAdd(this.map)};x(!1),a.type!=="vector"&&a.type!=="geojson"||x(!0),v.onAdd&&v.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();const a=this.getOwnSource(i);if(!a)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===i)return this.fire(new r.y(new Error(`Source "${i}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new r.y(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const f=this.getOwnSourceCaches(i);for(const v of f){const x=r.cq(v.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(v.id),v.fire(new r.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,a){this._checkLoaded(),this.getOwnSource(i).setData(a),this._changes.setDirty()}getOwnSource(i){const a=this.getOwnSourceCache(i);return a&&a.getSource()}getOwnSources(){const i=[];for(const a in this._otherSourceCaches){const f=this.getOwnSourceCache(a);f&&i.push(f.getSource())}return i}areTilesLoaded(){const i=this._mergedSourceCaches;for(const a in i){const f=i[a]._tiles;for(const v in f){const x=f[v];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;const a=this._getTransitionParameters();for(const v of i){if(this._validate(qr,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){const x=this.ambientLight;x.set(v),x.updateTransitions(a)}else this.ambientLight=new ar(v,Qi||(Qi=new r.a5({color:new r.a6(r.a3.properties_light_ambient.color),"color-use-theme":new r.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a6(r.a3.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const x=this.directionalLight;x.set(v),x.updateTransitions(a)}else this.directionalLight=new ar(v,nn||(nn=new r.a5({direction:new r.ak(r.a3.properties_light_directional.direction),color:new r.a6(r.a3.properties_light_directional.color),"color-use-theme":new r.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a6(r.a3.properties_light_directional.intensity),"cast-shadows":new r.a6(r.a3.properties_light_directional["cast-shadows"]),"shadow-quality":new r.a6(r.a3.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.a6(r.a3.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const f=new r.a8(this.z||0,a);this.ambientLight&&this.ambientLight.recalculate(f),this.directionalLight&&this.directionalLight.recalculate(f),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const i=this.directionalLight,a=this.ambientLight;if(!i||!a)return;const f=X=>.2126*(X[0]<=.03928?X[0]/12.92:Math.pow((X[0]+.055)/1.055,2.4))+.7152*(X[1]<=.03928?X[1]/12.92:Math.pow((X[1]+.055)/1.055,2.4))+.0722*(X[2]<=.03928?X[2]/12.92:Math.pow((X[2]+.055)/1.055,2.4)),v=i.properties.get("color").toRenderColor(null).toArray01(),x=i.properties.get("intensity"),T=i.properties.get("direction"),I=1-r.cb(T.x,T.y,T.z)[2]/90,F=f(v)*x*I,V=a.properties.get("color").toRenderColor(null).toArray01(),j=a.properties.get("intensity"),Z=f(V)*j;return Number(((F+Z)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(!i)return this;if(r.cr(i)){const a=r.cs(i),f=this.fragments.find(({id:x})=>x===a);if(!f)throw new Error(`Style import '${i}' not found`);const v=r.cq(i);return f.style.getFragmentStyle(v)}{const a=this.fragments.find(({id:f})=>f===i);return a?a.style:void 0}}setFeaturesetSelectors(i){if(!i)return;const a={},f=(v,x="")=>`${v}::${x}`;this._featuresetSelectors={};for(const v in i){const x=this._featuresetSelectors[v]=[];for(const T of i[v].selectors){if(T.featureNamespace){const F=this.getOwnLayer(T.layer);if(!F){r.w(`Layer is undefined for selector: ${T.layer}`);continue}const V=f(F.source,F.sourceLayer);if(V in a&&a[V]!==T.featureNamespace){r.w(`"featureNamespace ${T.featureNamespace} of featureset ${v}'s selector is not associated to the same source, skip this selector`);continue}a[V]=T.featureNamespace}let I;if(T.properties)for(const F in T.properties){const V=r.U(T.properties[F]);V.result==="success"&&(I=I||{},I[F]=V.value)}x.push({layerId:T.layer,namespace:T.featureNamespace,properties:I,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(i){const a=this.getFragmentStyle(i);if(!a||!a.stylesheet.featuresets)return[];const f=[];for(const v in a.stylesheet.featuresets)f.push({featuresetId:v,importId:a.scope?a.scope:void 0});return f}getFeaturesetLayers(i,a){const f=this.getFragmentStyle(a),v=f.stylesheet.featuresets;if(!v||!v[i])return this.fire(new r.y(new Error(`The featureset '${i}' does not exist in the map's style and cannot be queried.`))),[];const x=[];for(const T of v[i].selectors){const I=f.getOwnLayer(T.layer);I&&x.push(I)}return x}getConfigProperty(i,a){const f=this.getFragmentStyle(i);if(!f)return null;const v=r.aC(a,f.scope),x=f.options.get(v),T=x?x.value||x.default:null;return T?T.serialize():null}setConfigProperty(i,a,f){const v=this.getFragmentStyle(i);if(!v)return;const x=v.stylesheet.indoor?pp(v.stylesheet.schema):v.stylesheet.schema;if(!x||!x[a])return;const T=r.U(f);if(T.result!=="success")return void nu(this,T.value);const I=T.value.expression,F=r.aC(a,v.scope),V=v.options.get(F);if(!V)return;let j;const{minValue:Z,maxValue:X,stepValue:Q,type:le,values:se}=x[a],me=r.U(x[a].default);me.result==="success"&&(j=me.value.expression),j?(this.options.set(F,Object.assign({},V,{value:I,default:j,minValue:Z,maxValue:X,stepValue:Q,type:le,values:se})),this.updateConfigDependencies(a)):this.fire(new r.y(new Error(`No schema defined for the config option "${a}" in the "${i}" fragment.`)))}getConfig(i){const a=this.getFragmentStyle(i);if(!a)return null;const f=a.stylesheet.schema;if(!f)return null;const v={};for(const x in f){const T=r.aC(x,a.scope),I=a.options.get(T),F=I?I.value||I.default:null;v[x]=F?F.serialize():null}return v}setConfig(i,a){const f=this.getFragmentStyle(i);f&&(f.updateConfig(a,f.stylesheet.schema),this.updateConfigDependencies())}getSchema(i){const a=this.getFragmentStyle(i);return a?a.stylesheet.schema:null}setSchema(i,a){const f=this.getFragmentStyle(i);f&&(f.stylesheet.schema=a,f.updateConfig(f._config,a),this.updateConfigDependencies())}updateConfig(i,a){if(this._config=i,i||a)if(a)for(const f in a){let v,x;const T=r.U(a[f].default);if(T.result==="success"&&(v=T.value.expression),i&&i[f]!==void 0){const X=r.U(i[f]);X.result==="success"&&(x=X.value.expression)}const{minValue:I,maxValue:F,stepValue:V,type:j,values:Z}=a[f];if(v){const X=r.aC(f,this.scope);this.options.set(X,{default:v,value:x,minValue:I,maxValue:F,stepValue:V,type:j,values:Z})}else this.fire(new r.y(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new r.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(i){for(const a of this._configDependentLayers){const f=this.getLayer(a);if(f){if(i&&!f.configDependencies.has(i))continue;f.possiblyEvaluateVisibility(),this._updateLayer(f)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(a=>{const f=a._styleColorTheme.colorThemeOverride?a._styleColorTheme.colorThemeOverride:a._styleColorTheme.colorTheme;if(f){const v=a._evaluateColorThemeData(f);(!a._styleColorTheme.lut&&v!==""||a._styleColorTheme.lut&&v!==a._styleColorTheme.lut.data)&&a.setColorTheme(f)}}),this._changes.setDirty()}addLayer(i,a,f={}){this._checkLoaded();const v=i.id;if(this._layers[v])return void this.fire(new r.y(new Error(`Layer with id "${v}" already exists on this map`)));let x;if(i.type==="custom"){if(nu(this,r.ct(i)))return;x=r.cu(i,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof i.source=="object"&&(this.addSource(v,i.source),i=r.cp(i),i=r.l(i,{source:v})),this._validate(ht,`layers.${v}`,i,{arrayIndex:-1},f))return;x=r.cu(i,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:v}})}x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid);let T=this._order.length;if(a){const j=this._order.indexOf(a);if(j===-1)return void this.fire(new r.y(new Error(`Layer with id "${a}" does not exist on this map.`)));x.slot===this._layers[a].slot?T=j:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,v),this._layerOrderChanged=!0,this._layers[v]=x;const I=this.getOwnLayerSourceCache(x),F=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&x.canCastShadows()&&F&&(I.castsShadows=!0);const V=this._changes.getRemovedLayer(x);if(V&&x.source&&I&&x.type!=="custom"){this._changes.discardLayerRemoval(x);const j=r.aC(x.source,x.scope);V.type!==x.type?this._changes.updateSourceCache(j,"clear"):(this._changes.updateSourceCache(j,"reload"),I.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(i,a){this._checkLoaded();const f=this._checkLayer(i);if(!f||i===a)return;const v=this._order.indexOf(i);this._order.splice(v,1);let x=this._order.length;if(a){const T=this._order.indexOf(a);if(T===-1)return void this.fire(new r.y(new Error(`Layer with id "${a}" does not exist on this map.`)));f.slot===this._layers[a].slot?x=T:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();const a=this._checkLayer(i);if(!a)return;a.setEventedParent(null);const f=this._order.indexOf(i);this._order.splice(f,1),delete this._layers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);const v=this.getOwnLayerSourceCache(a);if(v&&v.castsShadows){let x=!1;for(const T in this._layers)if(this._layers[T].source===a.source&&this._layers[T].canCastShadows()){x=!0;break}v.castsShadows=x}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(const a in this._layers)if(this._layers[a].type===i)return!0;return!1}setLayerZoomRange(i,a,f){this._checkLoaded();const v=this._checkLayer(i);v&&(v.minzoom===a&&v.maxzoom===f||(a!=null&&(v.minzoom=a),f!=null&&(v.maxzoom=f),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(i,a){this._checkLoaded();const f=this._checkLayer(i);f&&f.slot!==a&&(f.slot=a,this._updateLayer(f))}setFilter(i,a,f={}){this._checkLoaded();const v=this._checkLayer(i);if(v&&!r.bn(v.filter,a))return a==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(es,`layers.${v.id}.filter`,a,{layerType:v.type},f)||(v.filter=r.cp(a),this._updateLayer(v)))}getFilter(i){const a=this._checkLayer(i);if(a)return r.cp(a.filter)}setLayoutProperty(i,a,f,v={}){this._checkLoaded();const x=this._checkLayer(i);if(x&&!r.bn(x.getLayoutProperty(a),f)){if(f!=null&&(!v||v.validate!==!1)&&nu(x,Js.call(Us,{key:`layers.${i}.layout.${a}`,layerType:x.type,objectKey:a,value:f,styleSpec:r.a3,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(a,f),x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(i,a){const f=this._checkLayer(i);if(f)return f.getLayoutProperty(a)}setPaintProperty(i,a,f,v={}){this._checkLoaded();const x=this._checkLayer(i);if(!x||r.bn(x.getPaintProperty(a),f)||f!=null&&(!v||v.validate!==!1)&&nu(x,Ks.call(Us,{key:`layers.${i}.paint.${a}`,layerType:x.type,objectKey:a,value:f,styleSpec:r.a3})))return;const T=x.setPaintProperty(a,f);x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),T&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(i,a){const f=this._checkLayer(i);if(f)return f.getPaintProperty(a)}setFeatureState(i,a){if(this._checkLoaded(),"target"in i){if("featuresetId"in i.target){const{featuresetId:F,importId:V}=i.target,j=this.getFragmentStyle(V),Z=j.getFeaturesetLayers(F);for(const{source:X,sourceLayer:Q}of Z)j.setFeatureState({id:i.id,source:X,sourceLayer:Q},a)}else if("layerId"in i.target){const{layerId:F}=i.target,V=this.getLayer(F);this.setFeatureState({id:i.id,source:V.source,sourceLayer:V.sourceLayer},a)}return}const f=i.source,v=i.sourceLayer,x=this._checkSource(f);if(!x)return;const T=x.type;if(T==="geojson"&&v)return void this.fire(new r.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!v)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(f);for(const F of I)F.setFeatureState(v,i.id,a)}removeFeatureState(i,a){if(this._checkLoaded(),"target"in i){if("featuresetId"in i.target){const{featuresetId:F,importId:V}=i.target,j=this.getFragmentStyle(V),Z=j.getFeaturesetLayers(F);for(const{source:X,sourceLayer:Q}of Z)j.removeFeatureState({id:i.id,source:X,sourceLayer:Q},a)}else if("layerId"in i.target){const{layerId:F}=i.target,V=this.getLayer(F);this.removeFeatureState({id:i.id,source:V.source,sourceLayer:V.sourceLayer},a)}return}const f=i.source,v=this._checkSource(f);if(!v)return;const x=v.type,T=x==="vector"?i.sourceLayer:void 0;if(x==="vector"&&!T)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new r.y(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(f);for(const F of I)F.removeFeatureState(T,i.id,a)}getFeatureState(i){if(this._checkLoaded(),"target"in i){let x;if("featuresetId"in i.target){const{featuresetId:T,importId:I}=i.target,F=this.getFragmentStyle(I),V=F.getFeaturesetLayers(T);for(const{source:j,sourceLayer:Z}of V){const X=F.getFeatureState({id:i.id,source:j,sourceLayer:Z});if(X&&!x)x=X;else if(!r.bn(x,X))return void this.fire(new r.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in i.target){const{layerId:T}=i.target,I=this.getLayer(T);x=this.getFeatureState({id:i.id,source:I.source,sourceLayer:I.sourceLayer})}return x}const a=i.source,f=i.sourceLayer,v=this._checkSource(a);if(v){if(v.type!=="vector"||f)return i.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(f,i.id);this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=r.l({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return r.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const i=this.getTerrain(),a=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return r.cv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateFilteredLayers(i){for(const a of Object.values(this._mergedLayers))i(a)&&this._updateLayer(a)}_updateLayer(i){this._changes.updateLayer(i);const a=this.getLayerSourceCache(i),f=r.aC(i.source,i.scope),v=this._changes.getUpdatedSourceCaches();i.source&&!v[f]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),a.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const a=I=>this._mergedLayers[I].is3D(),f=this.order,v={},x=[];for(let I=f.length-1;I>=0;I--){const F=f[I];if(a(F)){v[F]=I;for(const V of i){const j=V[F];if(j)for(const Z of j)x.push(Z)}}}x.sort((I,F)=>F.intersectionZ-I.intersectionZ);const T=[];for(let I=f.length-1;I>=0;I--){const F=f[I];if(a(F))for(let V=x.length-1;V>=0;V--){const j=x[V].feature;if(j.layer&&v[j.layer.id]<I)break;T.push(j),x.pop()}else for(const V of i){const j=V[F];if(j)for(const Z of j)T.push(Z.feature)}}return T}queryRenderedFeatures(i,a,f){let v;a&&!Array.isArray(a)&&a.filter&&(this._validate(es,"queryRenderedFeatures.filter",a.filter,null,a),v=r.aZ(a.filter));const x={},T=j=>{if(sl.has(j.type))return;const Z=this.getOwnLayerSourceCache(j),X=x[Z.id]=x[Z.id]||{sourceCache:Z,layers:{},has3DLayers:!1};j.is3D()&&(X.has3DLayers=!0),X.layers[j.fqid]=X.layers[j.fqid]||{styleLayer:j,targets:[]},X.layers[j.fqid].targets.push({filter:v})};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new r.y(new Error("parameters.layers must be an Array."))),[];for(const j of a.layers){const Z=this._layers[j];if(!Z)return this.fire(new r.y(new Error(`The layer '${j}' does not exist in the map's style and cannot be queried for features.`))),[];T(Z)}}else for(const j in this._layers)T(this._layers[j]);const I=this._queryRenderedFeatures(i,x,f),F=this._flattenAndSortRenderedFeatures(I),V=[];for(const j of F)r.cs(j.layer.id)===this.scope&&V.push(j);return V}queryRenderedFeatureset(i,a,f){let v;a&&!Array.isArray(a)&&a.filter&&(this._validate(es,"queryRenderedFeatures.filter",a.filter,null,a),v=r.aZ(a.filter));const x="mock",T=[];if(a&&a.target)T.push(Object.assign({},a,{targetId:x,filter:v}));else{const j=this.getFeaturesetDescriptors();for(const Z of j)T.push({targetId:x,filter:v,target:Z});for(const{style:Z}of this.fragments){const X=Z.getFeaturesetDescriptors();for(const Q of X)T.push({targetId:x,filter:v,target:Q})}}const I=this.queryRenderedTargets(i,T,f),F=[],V=new Set;for(const j of I)for(const Z of j.variants[x])dl(Z,j,V)||F.push(new r.cw(j,Z));return F}queryRenderedTargets(i,a,f){const v={},x=(I,F,V,j)=>{const Z=v[F.id]=v[F.id]||{sourceCache:F,layers:{},has3DLayers:!1};if(Z.layers[I.fqid]=Z.layers[I.fqid]||{styleLayer:I,targets:[]},I.is3D()&&(Z.has3DLayers=!0),!j)return V.uniqueFeatureID=!1,void Z.layers[I.fqid].targets.push(V);Z.layers[I.fqid].targets.push(Object.assign({},V,{namespace:j.namespace,properties:j.properties,uniqueFeatureID:j.uniqueFeatureID}))};for(const I of a)if("featuresetId"in I.target){const{featuresetId:F,importId:V}=I.target,j=this.getFragmentStyle(V);if(!j||!j._featuresetSelectors)continue;const Z=j._featuresetSelectors[F];if(!Z){this.fire(new r.y(new Error(`The featureset '${F}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const X of Z){const Q=j.getOwnLayer(X.layerId);Q&&!sl.has(Q.type)&&x(Q,j.getOwnLayerSourceCache(Q),I,X)}}else if("layerId"in I.target){const{layerId:F}=I.target,V=this.getLayer(F);if(!V||sl.has(V.type))continue;x(V,this.getLayerSourceCache(V),I)}const T=this._queryRenderedFeatures(i,v,f);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(i,a,f){const v=[],x=!!this.map._showQueryGeometry,T=Wn.createFromScreenPoints(i,f);for(const I in a){const F=Vs(T,a[I],this._availableImages,f,x);Object.keys(F).length&&v.push(F)}if(this.placement)for(const I in a){if(!a[I].sourceCache._onlySymbols)continue;const F=Au(T.screenGeometry,a[I],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(F).length&&v.push(F)}return v}querySourceFeatures(i,a){const f=a&&a.filter;f&&this._validate(es,"querySourceFeatures.filter",f,null,a);let v=[];const x=this.getOwnSourceCaches(i);for(const T of x)v=v.concat(Bc(T,a));return v}addSourceType(i,a,f){return Oo.getSourceType(i)?f(new Error(`A source type called "${i}" already exists.`)):(Oo.setSourceType(i,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:a.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,a,f={}){this._checkLoaded();const v=this.light.getLight();let x=!1;for(const I in i)if(!r.bn(i[I],v[I])){x=!0;break}if(!x)return;const T=this._getTransitionParameters();this.light.setLight(i,a,f),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(i,a=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),a===0&&delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let f=i;const v=i.source==null;if(a===1){if(this.disableElevatedTerrain)return;if(typeof f.source=="object"){const I="terrain-dem-src";this.addSource(I,f.source),f=r.cp(f),f=r.l(f,{source:I})}const x=r.l({},f),T={};if(this.terrain&&v){x.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(T.style=I.serialize())}if(this._validate(gs,"terrain",x,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&a!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,a),this.fire(new r.z("data",{dataType:"style"}))}else{const x=this.terrain,T=x.get();for(const I of Object.keys(r.a3.terrain))!f.hasOwnProperty(I)&&r.a3.terrain[I].default&&(f[I]=r.a3.terrain[I].default);for(const I in i)if(!r.bn(i[I],T[I])){x.set(i,this.options),this.stylesheet.terrain=i;const F=this._getTransitionParameters({duration:0});x.updateTransitions(F),this.fire(new r.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const a=this.fog=new Gt(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}_createSnow(i){const a=this.snow=new zn(i,this.map.transform,this.scope,this.options);this.stylesheet.snow=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}_createRain(i){const a=this.rain=new jn(i,this.map.transform,this.scope,this.options);this.stylesheet.rain=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog;if(!r.bn(a.get(),i)){a.set(i,this.options),this.stylesheet.fog=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}}else this._createFog(i);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(i){if(this._checkLoaded(),!i)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const a=this.snow;if(!r.bn(a.get(),i)){a.set(i,this.options),this.stylesheet.snow=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}}else this._createSnow(i);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(i){if(this._checkLoaded(),!i)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const a=this.rain;if(!r.bn(a.get(),i)){a.set(i,this.options),this.stylesheet.rain=a.get();const f=this._getTransitionParameters({duration:0});a.updateTransitions(f)}}else this._createRain(i);this._markersNeedUpdate=!0}_reloadColorTheme(){const i=()=>{for(const v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(const v in this._sourceCaches)this._sourceCaches[v].clearTiles()},a=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!a)return this._styleColorTheme.lut=null,void i();const f=this._evaluateColorThemeData(a);this._loadColorTheme(f).then(()=>{this.fire(new r.z("colorthemeset")),i()}).catch(v=>{r.w(`Couldn't set color theme: ${v}`)})}setColorTheme(i){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=i,this._reloadColorTheme()}setImportColorTheme(i,a){const f=this.getFragmentStyle(i);f&&(f._styleColorTheme.colorThemeOverride=a,f._reloadColorTheme())}_getTransitionParameters(i){return{now:r.q.now(),transition:r.l(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;const i=[],a=[];for(const f of this._mergedOrder)this.isLayerDraped(this._mergedLayers[f])?i.push(f):a.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...a)}_createTerrain(i,a){const f=this.terrain=new pe(i,a,this.scope,this.options);a===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const v=this._getTransitionParameters({duration:0});f.updateTransitions(v)}_force3DLayerUpdate(){for(const i in this._layers){const a=this._layers[i];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const a=this._layers[i];a.type==="symbol"&&this._updateLayer(a)}}_validate(i,a,f,v,x={}){if(x&&x.validate===!1)return!1;const T=r.l({},this.serialize());return nu(this,i.call(Us,r.l({key:a,style:T,value:f,styleSpec:r.a3},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.cx.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(i){const a=this.getSourceCaches(i);for(const f of a)f.clearTiles()}clearSources(){for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}reloadSource(i){const a=this.getSourceCaches(i);for(const f of a)f.resume(),f.reload()}reloadSources(){for(const i of this.getSources())i.reload&&i.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(i=>{i.modelManager.reloadModels(i.scope)})}updateSources(i){let a;this.directionalLight&&(a=Zo(this.directionalLight));for(const f in this._mergedSourceCaches)this._mergedSourceCaches[f].update(i,void 0,void 0,a)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const a=this._sourceCaches[i];a.resume(),a.reload()}}_updatePlacement(i,a,f,v,x,T,I=!1){let F=!1,V=!1;const j={},Z={};for(const X of this._mergedOrder){const Q=this._mergedLayers[X];if(Q.type!=="symbol")continue;const le=r.aC(Q.source,Q.scope);let se=j[le];if(!se){const fe=this.getLayerSourceCache(Q);if(!fe)continue;const De=fe.getRenderableIds(!0).map(ke=>fe.getTileByID(ke));Z[le]=De.slice(),se=j[le]=De.sort((ke,Ne)=>Ne.tileID.overscaledZ-ke.tileID.overscaledZ||(ke.tileID.isLessThan(Ne.tileID)?-1:1))}const me=this.crossTileSymbolIndex.addLayer(Q,se,a.center.lng,a.projection);F=F||me}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new r.z("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.q.now(),a.zoom))&&(this.pauseablePlacement=new jf(a,this._mergedOrder,I,f,v,x,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,j,Z,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.q.now()),V=!0),F&&this.pauseablePlacement.placement.setStale()),V||F){this._buildingIndex.onNewFrame(a.zoom);for(let X=0;X<this._mergedOrder.length;X++){const Q=this._mergedLayers[this._mergedOrder[X]];if(Q.type!=="symbol")continue;const le=this.isLayerClipped(Q);this.placement.updateLayerOpacities(Q,j[r.aC(Q.source,Q.scope)],X,le?T:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.q.now())}}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,a){this._checkLoaded();const f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex(({id:x})=>x===i.id)!==-1)return void this.fire(new r.y(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!a)return f.push(i),this._loadImports([i],!0);const v=f.findIndex(({id:x})=>x===a);return v===-1&&this.fire(new r.y(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=f.slice(0,v).concat(i).concat(f.slice(v)),this._loadImports([i],!0,a)}updateImport(i,a){this._checkLoaded();const f=this.stylesheet.imports||[],v=this.getImportIndex(i);return v===-1?this:typeof a=="string"?(this.setImportUrl(i,a),this):(a.url&&a.url!==f[v].url&&this.setImportUrl(i,a.url),r.bn(a.config,f[v].config)||this.setImportConfig(i,a.config,a.data.schema),r.bn(a.data,f[v].data)||this.setImportData(i,a.data),this)}moveImport(i,a){this._checkLoaded();let f=this.stylesheet.imports||[];const v=this.getImportIndex(i);if(v===-1)return this;const x=this.getImportIndex(a);if(x===-1)return this;const T=f[v],I=this.fragments[v];return f=f.filter(({id:F})=>F!==i),this.fragments=this.fragments.filter(({id:F})=>F!==i),this.stylesheet.imports=f.slice(0,x).concat(T).concat(f.slice(x)),this.fragments=this.fragments.slice(0,x).concat(I).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(i,a){this._checkLoaded();const f=this.stylesheet.imports||[],v=this.getImportIndex(i);if(v===-1)return this;f[v].url=a;const x=this.fragments[v];return x.style=this._createFragmentStyle(f[v]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(a),this}setImportData(i,a){this._checkLoaded();const f=this.getImportIndex(i),v=this.stylesheet.imports||[];return f===-1?this:a?(this.fragments[f].style.setState(a),this._reloadImports(),this):(delete v[f].data,this.setImportUrl(i,v[f].url))}setImportConfig(i,a,f){this._checkLoaded();const v=this.getImportIndex(i),x=this.stylesheet.imports||[];if(v===-1)return this;a?x[v].config=a:delete x[v].config;const T=this.fragments[v];f&&T.style.stylesheet&&(T.style.stylesheet.schema=f);const I=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=a,T.style.updateConfig(a,I),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();const a=this.stylesheet.imports||[],f=this.getImportIndex(i);f!==-1&&(a.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports())}getImportIndex(i){const a=(this.stylesheet.imports||[]).findIndex(f=>f.id===i);return a===-1&&this.fire(new r.y(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),a}getLayer(i){return this._mergedLayers[i]}getSources(){const i=[];for(const a in this._mergedOtherSourceCaches){const f=this._mergedOtherSourceCaches[a];f&&i.push(f.getSource())}return i}getSource(i,a){const f=this.getSourceCache(i,a);return f&&f.getSource()}getLayerSource(i){const a=this.getLayerSourceCache(i);return a&&a.getSource()}getSourceCache(i,a){const f=r.aC(i,a);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(i){const a=r.aC(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(i){if(i==null)return Object.values(this._mergedSourceCaches);const a=[];return this._mergedOtherSourceCaches[i]&&a.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&a.push(this._mergedSymbolSourceCaches[i]),a}updateSourceCaches(){const i=this._changes.getUpdatedSourceCaches();for(const a in i){const f=i[a];f==="reload"?this.reloadSource(a):f==="clear"&&this.clearSource(a)}}updateLayers(i){const a=this._changes.getUpdatedPaintProperties();for(const f of a){const v=this.getLayer(f);v&&v.updateTransitions(i)}}getImages(i,a,f){this.imageManager.getImages(a.icons,a.scope,f),this._updateTilesForChangedImages();const v=x=>{x&&x.setDependencies(a.tileID.key,a.type,a.icons)};v(this._otherSourceCaches[a.source]),v(this._symbolSourceCaches[a.source])}rasterizeImages(i,a,f){this.imageManager.rasterizeImages(a,f)}getGlyphs(i,a,f){this.glyphManager.getGlyphs(a.stacks,a.scope,f)}getResource(i,a,f){return r.cy(a,f)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){const a=[];return this._otherSourceCaches[i]&&a.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&a.push(this._symbolSourceCaches[i]),a}_isSourceCacheLoaded(i){const a=this.getOwnSourceCaches(i);return a.length===0?(this.fire(new r.y(new Error(`There is no source with ID '${i}'`))),!1):a.every(f=>f.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(i,a){if(!this._clipLayerPresent&&i.type!=="fill-extrusion")return!1;const f=i.type==="fill-extrusion"&&i.sourceLayer==="building";if(i.is3D()){if(f||a&&a.type==="batched-model"||i.type==="model")return!0}else if(i.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Oo.getSourceType=function(d){return Da[d]},Oo.setSourceType=function(d,i){Da[d]=i},Oo.registerForPluginStateChange=r.ch;var dh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,qh=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Wh=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Vl="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Pu=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Zf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ou=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Zh=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Dd=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,pl=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,po=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const ic=[];fh(dh,ic),fh(Wh,ic),fh(qh,ic);const Bu={"_prelude_fog.vertex.glsl":Zf,"_prelude_terrain.vertex.glsl":Pu,"_prelude_shadow.vertex.glsl":pl,"_prelude_fog.fragment.glsl":Ou,"_prelude_shadow.fragment.glsl":po,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Zh,"_prelude_raster_particle.glsl":Dd},ru={};ua("",Pu),ua(Ou,Zf),ua(po,pl),ua(Zh,""),ua(Dd,"");const Fu=ua(qh,Wh),Xh=dh;var nc={background:ua(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ua(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:ua(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ua("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ua(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ua(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ua("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ua("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ua("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:ua(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:ua(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ua(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ua(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ua(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:ua(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:ua(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:ua(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:ua(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:ua(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ua(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ua(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:ua(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:ua(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:ua(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:ua("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:ua("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ua(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:ua(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:ua(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:ua("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:ua(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Vl),skyboxGradient:ua(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Vl),skyboxCapture:ua(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ua(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ua(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:ua(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:ua(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:ua(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:ua("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:ua("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:ua("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:ua("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function fh(d,i){const a=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of a)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=f.split(" ");for(const x of v)i.includes(x)||i.push(x)}}function ua(d,i){const a=/#include\s+"([^"]+)"/g,f=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let v=i.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(V=>{const j=V.split(" ");return j[j.length-1]}),v=[...new Set(v)]);const x={},T=[],I=[];if(d=d.replace(a,(V,j)=>(I.push(j),"")),(i=i.replace(a,(V,j)=>(T.push(j),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let F=[...ic];fh(d,F),fh(i,F);for(const V of[...T,...I])Bu[V]||console.error(`Undefined include: ${V}`),ru[V]||(ru[V]=[],fh(Bu[V],ru[V])),F=[...F,...ru[V]];return{fragmentSource:d=d.replace(f,(V,j,Z,X,Q)=>(x[Q]=!0,j==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
in ${Z} ${X} ${Q};
#else
uniform ${Z} ${X} u_${Q};
#endif
`:j==="initialize"?`
#ifdef HAS_UNIFORM_u_${Q}
    ${Z} ${X} ${Q} = u_${Q};
#endif
`:j==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    in ${Z} ${X} ${Q};
#endif
`:j==="initialize-attribute"?"":void 0)),vertexSource:i=i.replace(f,(V,j,Z,X,Q)=>{const le=X==="float"?"vec2":X,se=Q.match(/color/)?"color":le;return j==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
in ${Z} ${X} a_${Q};
#endif
`:x[Q]?j==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
in ${Z} ${le} a_${Q};
out ${Z} ${X} ${Q};
#else
uniform ${Z} ${X} u_${Q};
#endif
`:j==="initialize"?se==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = a_${Q};
#else
    ${Z} ${X} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = unpack_mix_${se}(a_${Q}, u_${Q}_t);
#else
    ${Z} ${X} ${Q} = u_${Q};
#endif
`:j==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    in ${Z} ${X} a_${Q};
    out ${Z} ${X} ${Q};
#endif
`:j==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    ${Q} = a_${Q};
#endif
`:void 0:j==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
in ${Z} ${le} a_${Q};
#else
uniform ${Z} ${X} u_${Q};
#endif
`:j==="define-instanced"?se==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Q}0;
in vec4 a_${Q}1;
in vec4 a_${Q}2;
in vec4 a_${Q}3;
#else
uniform ${Z} ${X} u_${Q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${Z} ${le} a_${Q};
#else
uniform ${Z} ${X} u_${Q};
#endif
`:j==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    ${Z} ${X} ${Q} = a_${Q};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${Z} ${X} ${Q} = a_${Q};
#else
    ${Z} ${X} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    ${Z} ${X} ${Q} = unpack_mix_${se}(a_${Q}, u_${Q}_t);
#else
    ${Z} ${X} ${Q} = u_${Q};
#endif
`}),staticAttributes:v,usedDefines:F,vertexIncludes:T,fragmentIncludes:I}}class Yh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,a,f,v,x,T,I,F){this.context=i;let V=this.boundPaintVertexBuffers.length!==v.length;for(let Z=0;!V&&Z<v.length;Z++)this.boundPaintVertexBuffers[Z]!==v[Z]&&(V=!0);let j=this.boundDynamicVertexBuffers.length!==I.length;for(let Z=0;!j&&Z<I.length;Z++)this.boundDynamicVertexBuffers[Z]!==I[Z]&&(j=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==f||V||j||this.boundIndexBuffer!==x||this.boundVertexOffset!==T)this.freshBind(a,f,v,x,T,I,F);else{i.bindVertexArrayOES.set(this.vao);for(const Z of I)Z&&(Z.bind(),F&&Z.instanceCount&&Z.setVertexAttribDivisor(i.gl,a,F));x&&x.dynamicDraw&&x.bind()}}freshBind(i,a,f,v,x,T,I){const F=i.numAttributes,V=this.context,j=V.gl;this.vao&&this.destroy(),this.vao=V.gl.createVertexArray(),V.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=v,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=T,a.enableAttributes(j,i),a.bind(),a.setVertexAttribPointers(j,i,x);for(const Z of f)Z.enableAttributes(j,i),Z.bind(),Z.setVertexAttribPointers(j,i,x);for(const Z of T)Z&&(Z.enableAttributes(j,i),Z.bind(),Z.setVertexAttribPointers(j,i,x),I&&Z.instanceCount&&Z.setVertexAttribDivisor(j,i,I));v&&v.bind(),V.currentNumAttributes=F}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function $h(d,i){const a=Math.pow(2,i.canonical.z),f=i.canonical.y;return[new r.aa(0,f/a).toLngLat().lat,new r.aa(0,(f+1)/a).toLngLat().lat]}function rc(d,i,a,f,v,x,T){const I=d.context,F=I.gl,V=a.hillshadeFBO;if(!V)return;d.prepareDrawTile();const j=d.isTileAffectedByFog(i),Z=d.getOrCreateProgram("hillshade",{overrideFog:j});I.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,V.colorAttachment.get());const X=((me,fe,De,ke)=>{const Ne=De.paint.get("hillshade-shadow-color"),tt=De.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",He=De.paint.get("hillshade-highlight-color"),We=De.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",je=De.paint.get("hillshade-accent-color"),at=De.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",gt=De.paint.get("hillshade-emissive-strength");let Jt=r.ai(De.paint.get("hillshade-illumination-direction"));if(De.paint.get("hillshade-illumination-anchor")==="viewport")Jt-=me.transform.angle;else if(me.style&&me.style.enable3dLights()&&me.style.directionalLight){const fi=me.style.directionalLight.properties.get("direction"),ui=r.cb(fi.x,fi.y,fi.z);Jt=r.ai(ui[1])}const jt=!me.options.moving;return{u_matrix:ke||me.transform.calculateProjMatrix(fe.tileID.toUnwrapped(),jt),u_image:0,u_latrange:$h(0,fe.tileID),u_light:[De.paint.get("hillshade-exaggeration"),Jt],u_shadow:Ne.toRenderColor(tt?null:De.lut),u_highlight:He.toRenderColor(We?null:De.lut),u_emissive_strength:gt,u_accent:je.toRenderColor(at?null:De.lut)}})(d,a,f,d.terrain?i.projMatrix:null);d.uploadCommonUniforms(I,Z,i.toUnwrapped());const{tileBoundsBuffer:Q,tileBoundsIndexBuffer:le,tileBoundsSegments:se}=d.getTileBoundsBuffers(a);Z.draw(d,F.TRIANGLES,v,x,T,rr.disabled,X,f.id,Q,le,se)}function Kh(d,i,a){if(!i.needsDEMTextureUpload)return;const f=d.context,v=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||d.getTileTexture(a.stride);const x=a.getPixels();i.demTexture?i.demTexture.update(x,{premultiply:!1}):i.demTexture=new r.T(f,x,v.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function zd(d,i,a){const f=d.context,v=f.gl;if(!i.dem)return;const x=i.dem;if(f.activeTexture.set(v.TEXTURE1),Kh(d,i,x),!i.demTexture)return;i.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);const T=x.dim;f.activeTexture.set(v.TEXTURE0);let I=i.hillshadeFBO;if(!I){const X=new r.T(f,{width:T,height:T,data:null},v.RGBA8);X.bind(v.LINEAR,v.CLAMP_TO_EDGE),I=i.hillshadeFBO=f.createFramebuffer(T,T,!0,"renderbuffer"),I.colorAttachment.set(X.texture)}f.bindFramebuffer.set(I.framebuffer),f.viewport.set([0,0,T,T]);const{tileBoundsBuffer:F,tileBoundsIndexBuffer:V,tileBoundsSegments:j}=d.getMercatorTileBoundsBuffers(),Z=[];d.linearFloatFilteringSupported()&&Z.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:Z}).draw(d,v.TRIANGLES,sr.disabled,br.disabled,Fr.unblended,rr.disabled,((X,Q)=>{const le=Q.stride,se=r.ab.mat4.create();return r.ab.mat4.ortho(se,0,r.ag,-r.ag,0,0,1),r.ab.mat4.translate(se,se,[0,-r.ag,0]),{u_matrix:se,u_image:1,u_dimension:[le,le],u_zoom:X.overscaledZ}})(i.tileID,x),a.id,F,V,j),i.needsHillshadePrepare=!1}class Za{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ph extends Za{getDefault(){return r.aj.transparent}set(i){const a=this.current;(i.r!==a.r||i.g!==a.g||i.b!==a.b||i.a!==a.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Cl extends Za{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Gl extends Za{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class ku extends Za{getDefault(){return[!0,!0,!0,!0]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Nc extends Za{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Uc extends Za{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class mh extends Za{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const a=this.current;(i.func!==a.func||i.ref!==a.ref||i.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Jh extends Za{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class gh extends Za{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=i,this.dirty=!1}}class gf extends Za{getDefault(){return[0,1]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class ls extends Za{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=i,this.dirty=!1}}class cs extends Za{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class pa extends Za{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.BLEND):a.disable(a.BLEND),this.current=i,this.dirty=!1}}class Ll extends Za{getDefault(){const i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class xc extends Za{getDefault(){return r.aj.transparent}set(i){const a=this.current;(i.r!==a.r||i.g!==a.g||i.b!==a.b||i.a!==a.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class _f extends Za{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class au extends Za{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=i,this.dirty=!1}}class Xf extends Za{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Yf extends Za{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let _h=class extends Za{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class Pd extends Za{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Od extends Za{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class su extends Za{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Fp extends Za{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class gp extends Za{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class kp extends Za{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class $f extends Za{getDefault(){return null}set(i){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Np extends Za{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class yf extends Za{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class Kf extends Za{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class yh extends Za{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class vh extends Za{constructor(i,a){super(i),this.context=i,this.parent=a}getDefault(){return null}}class Nu extends vh{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Qh extends vh{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class vf extends vh{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class _p extends Qh{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Jf=(d,i,a)=>({u_matrix:d,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:a}),Hl=(d,i,a,f,v,x,T,I,F,V,j,Z,X,Q,le,se)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:a,u_zoom_transition:v,u_merc_center:x,u_image0:0,u_frustum_tl:T,u_frustum_tr:I,u_frustum_br:F,u_frustum_bl:V,u_globe_pos:j,u_globe_radius:Z,u_viewport:X,u_grid_matrix:se?Float32Array.from(se):new Float32Array(9),u_skirt_height:Q,u_far_z_cutoff:le});function Qf(d,i){return d!=null&&i!=null&&!(!d.hasData()||!i.hasData())&&d.demTexture!=null&&i.demTexture!=null&&d.tileID.key!==i.tileID.key}const Xo=new class{constructor(){this.operations={}}newMorphing(d,i,a,f,v){if(d in this.operations){const x=this.operations[d];x.to.tileID.key!==a.tileID.key&&(x.queued=a)}else this.operations[d]={startTime:f,phase:0,duration:v,from:i,to:a,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const i=this.operations[d];return{from:i.from,to:i.to,phase:i.phase}}update(d){for(const i in this.operations){const a=this.operations[i];for(a.phase=(d-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,d)){delete this.operations[i];break}}}_nextOp(d,i){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=i,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},ed={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Bd(d,i,a){if(i===0)return 0;const f=i<1&&a===514?.25/i:1;return 6*Math.pow(1.5,22-d)*Math.max(i,1)*f}function ep(d,i){const a=1<<d.z;return!i&&(d.x===0||d.x===a-1)||d.y===0||d.y===a-1}const Fd=d=>({u_matrix:d});function ml(d,i,a,f,v){if(v>0){const x=r.q.now(),T=(x-d.timeAdded)/v,I=i?(x-i.timeAdded)/v:-1,F=a.getSource(),V=f.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),j=!i||Math.abs(i.tileID.overscaledZ-V)>Math.abs(d.tileID.overscaledZ-V),Z=j&&d.refreshedUponExpiration?1:r.aw(j?T:1-I,0,1);return d.refreshedUponExpiration&&T>=1&&(d.refreshedUponExpiration=!1),i?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}class bc extends he{constructor(i){const a={type:"raster-dem",maxzoom:i.transform.maxZoom},f=new r.D(r.ci(),null),v=_s("mock-dem",a,f,i.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,a){i.state="loaded",a(null)}}class xh extends he{constructor(i){const a=_s("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new r.D(r.ci(),null),i.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,a,f){if(i.freezeTileCoverage)return;this.transform=i;const v=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,T)=>{if(x[T.key]="",!this._tiles[T.key]){const I=new Yi(T,this._source.tileSize*T.overscaleFactor(),i.tileZoom);I.state="loaded",this._tiles[T.key]=I}return x},{});for(const x in this._tiles)x in v||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(i){const a=this.proxyCachedFBO[i];if(a!==void 0){const f=Object.values(a);this.renderCachePool.push(...f),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class tp extends r.aG{constructor(i,a,f){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=a,this.projMatrix=f}}class ac extends r.cJ{constructor(i,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,v,x]=function(F){const V=new r.b4,j=new r.aU,Z=131;V.reserve(17161),j.reserve(33800);const X=r.ag/128,Q=r.ag+X/2,le=Q+X;for(let me=-X;me<le;me+=X)for(let fe=-X;fe<le;fe+=X){const De=fe<0||fe>Q||me<0||me>Q?24575:0,ke=r.aw(Math.round(fe),0,r.ag),Ne=r.aw(Math.round(me),0,r.ag);V.emplaceBack(ke+De,Ne)}const se=(me,fe)=>{const De=fe*Z+me;j.emplaceBack(De+1,De,De+Z),j.emplaceBack(De+Z,De+Z+1,De+1)};for(let me=1;me<129;me++)for(let fe=1;fe<129;fe++)se(fe,me);return[0,129].forEach(me=>{for(let fe=0;fe<130;fe++)se(fe,me),se(me,fe)}),[V,j,32768]}(),T=i.context;this.gridBuffer=T.createVertexBuffer(f,r.b6.members),this.gridIndexBuffer=T.createIndexBuffer(v),this.gridSegments=r.b7.simpleSegment(0,0,f.length,v.length),this.gridNoSkirtSegments=r.b7.simpleSegment(0,0,f.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new xh(a.map),this.orthoMatrix=r.ab.mat4.create(),r.ab.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.ag,0,r.ag,0,1);const I=T.gl;this._overlapStencilMode=new br({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new bc(a.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,a,f){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);const v=i.terrain.properties,x=i.terrain.drapeRenderMode===0,T=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.q.now();const I=i.terrain&&i.terrain.scope,F=v.get("source"),V=x?this._mockSourceCache:i.getSourceCache(F,I);if(!V)return void r.w(`Couldn't find terrain source "${F}".`);if(this.sourceCache=V,this._attenuationRange=i.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(a):v.get("exaggeration"),!a.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const j=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Z=this.getScaledDemTileSize();this.sourceCache.update(a,Z,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,j(),this._initializing=!0),j(),a.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(i){if(this._attenuationRange&&i.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(i.zoom);const a=this._previousCameraAltitude,f=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=f;const v=a!=null?f-a:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;const x=i.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(x);let I=x-this._previousZoom;const F=this._previousUpdateTimestamp;let V=x;this._evaluationZoom!=null&&(V=this._evaluationZoom,Math.abs(x-V)>.5&&(I=.5*(x-V+I)),I*v<0&&(V+=I)),this._evaluationZoom=V;const j=T.getExaggeration(V),Z=j===T.getExaggeration(Math.max(0,V-.1));if(Z&&Math.abs(j-this._exaggeration)<.01)return j;let X=Math.min(.1,.00375*(this._updateTimestamp-F));return(Z||j<.1||Math.abs(I)<1e-4)&&(X=Math.min(.2,4*X)),r.af(this._exaggeration,j,X)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(r.aa.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=a.getIds().map(F=>{const V=a.getTileByID(F).tileID;return V.projMatrix=f.calculateProjMatrix(V.toUnwrapped()),V});(function(F,V){const j=V.transform.pointCoordinate(V.transform.getCameraPoint()),Z=new r.P(j.x,j.y);F.sort((X,Q)=>{if(Q.overscaledZ-X.overscaledZ)return Q.overscaledZ-X.overscaledZ;const le=new r.P(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),se=new r.P(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),me=Z.mult(1<<X.canonical.z);return me.x-=.5,me.y-=.5,me.distSqr(le)-me.distSqr(se)})})(v,this.painter);const x=this.proxyToSource||{};this.proxyToSource={},v.forEach(F=>{this.proxyToSource[F.key]={}}),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const F in T){const V=T[F];if(!V.used||(V!==this.sourceCache&&this.resetTileLookupCache(V.id),this._setupProxiedCoordsForOrtho(V,i[F],x),V.usedForTerrain))continue;const j=i[F];V.getSource().reparseOverscaled&&this._assignTerrainTiles(j)}this.proxiedCoords[a.id]=v.map(F=>new tp(F,F.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const F of this.proxyCoords){const V=this.terrainTileForTile[F.key];if(!V)continue;const j=V.tileID.key;j in I||(this._visibleDemTiles.push(V),I[j]=j)}}_assignTerrainTiles(i){this._initializing||i.forEach(a=>{if(this.terrainTileForTile[a.key])return;const f=this._findTileCoveringTileID(a,this.sourceCache);f&&(this.terrainTileForTile[a.key]=f)})}_prepareDEMTextures(){const i=this.painter.context,a=i.gl;for(const f in this.terrainTileForTile){const v=this.terrainTileForTile[f],x=v.dem;!x||v.demTexture&&!v.needsDEMTextureUpload||(i.activeTexture.set(a.TEXTURE1),Kh(this.painter,v,x))}}_prepareDemTileUniforms(i,a,f,v){if(!a||a.demTexture==null)return!1;const x=i.tileID.canonical,T=Math.pow(2,a.tileID.canonical.z-x.z),I=v||"";return f[`u_dem_tl${I}`]=[x.x*T%1,x.y*T%1],f[`u_dem_scale${I}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let i=0;const a=this._visibleDemTiles.reduce((f,v)=>{if(!v.dem)return f;const x=v.dem.tree.minimums[0];return x>0&&i++,f+x},0);return i?a/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,a=i.gl;i.activeTexture.set(a.TEXTURE2);const f=this._getLoadedAreaMinimum(),v=new r.cK({width:1,height:1},new Float32Array([f]));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(v,{premultiply:!1}):x=this._emptyDEMTexture=new r.T(i,v,a.R32F,{premultiply:!1}),x}setupElevationDraw(i,a,f){const v=this.painter.context,x=v.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let I=null,F=null,V=1;if(f&&f.morphing&&this._useVertexMorphing){const Q=f.morphing.srcDemTile,le=f.morphing.dstDemTile;V=f.morphing.phase,Q&&le&&(this._prepareDemTileUniforms(i,Q,T,"_prev")&&(F=Q),this._prepareDemTileUniforms(i,le,T)&&(I=le))}const j=Q=>Q&&Q.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST;let Z=null;var X;if(this.enabled?F&&I?(Z=I.demTexture,v.activeTexture.set(x.TEXTURE4),F.demTexture.bind(j(F),x.CLAMP_TO_EDGE),T.u_dem_lerp=V):(I=this.terrainTileForTile[i.tileID.key],Z=this._prepareDemTileUniforms(i,I,T)?I.demTexture:this.emptyDEMTexture):Z=this.emptyDEMTexture,v.activeTexture.set(x.TEXTURE2),Z&&(T.u_dem_size=(X=Z).size[0]===1?1:X.size[0]-2,Z.bind(j(I),x.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(f&&f.useDepthForOcclusion,a,T),f&&f.useMeterToDem&&I){const Q=(1<<I.tileID.canonical.z)*r.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=Q}if(f&&f.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),a.setTerrainUniformValues(v,T),this.painter.transform.projection.name==="globe"){const Q=this.globeUniformValues(this.painter.transform,i.tileID.canonical,f&&f.useDenormalizedUpVectorScale);a.setGlobeUniformValues(v,Q)}}globeUniformValues(i,a,f){const v=i.projection;return{u_tile_tl_up:v.upVector(a,0,0),u_tile_tr_up:v.upVector(a,r.ag,0),u_tile_br_up:v.upVector(a,r.ag,r.ag),u_tile_bl_up:v.upVector(a,0,r.ag),u_tile_up_scale:f?r.cL(1):v.upVectorScale(a,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const a=this.painter,f=this.painter.context;i.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,x,T,I,F){if(v.transform.projection.name==="globe")(function(V,j,Z,X,Q){const le=V.context,se=le.gl;let me,fe;const De=V.transform,ke=r.cC(V,le,De),Ne=(fi,ui)=>{if(fe===ui)return;const Pt=[ed[ui],"PROJECTION_GLOBE_VIEW"];ke&&Pt.push("CUSTOM_ANTIALIASING");const Kt=V.isTileAffectedByFog(fi);me=V.getOrCreateProgram("globeRaster",{defines:Pt,overrideFog:Kt}),fe=ui},tt=V.colorModeForRenderPass(),He=new sr(se.LEQUAL,sr.ReadWrite,V.depthRangeFor3D);Xo.update(Q);const We=r.cD(De),je=[r.at(De.center.lng),r.aA(De.center.lat)],at=V.globeSharedBuffers,gt=[De.width*r.q.devicePixelRatio,De.height*r.q.devicePixelRatio],Jt=Float32Array.from(De.globeMatrix),jt={useDenormalizedUpVectorScale:!0};{const fi=V.transform,ui=Bd(fi.zoom,j.exaggeration(),j.sourceCache._source.tileSize);fe=-1;const Pt=se.TRIANGLES;for(const Kt of X){const Ii=Z.getTile(Kt),Et=br.disabled,hi=j.prevTerrainTileForTile[Kt.key],si=j.terrainTileForTile[Kt.key];Qf(hi,si)&&Xo.newMorphing(Kt.key,hi,si,Q,250),le.activeTexture.set(se.TEXTURE0),Ii.texture&&Ii.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE);const an=Xo.getMorphValuesForProxy(Kt.key),zi=an?1:0;an&&r.J(jt,{morphing:{srcDemTile:an.from,dstDemTile:an.to,phase:r.cB(an.phase)}});const yi=r.cE(Kt.canonical),Hi=r.cF(yi.getCenter().lat),en=r.cG(Kt.canonical,yi,Hi,fi.worldSize/fi._pixelsPerMercatorPixel),bn=r.bb(r.cH(Kt.canonical)),Un=Hl(fi.expandedFarZProjMatrix,Jt,We,bn,r.ae(fi.zoom),je,fi.frustumCorners.TL,fi.frustumCorners.TR,fi.frustumCorners.BR,fi.frustumCorners.BL,fi.globeCenterInViewSpace,fi.globeRadius,gt,ui,fi._farZ,en);if(Ne(Kt,zi),me&&(j.setupElevationDraw(Ii,me,jt),V.uploadCommonUniforms(le,me,Kt.toUnwrapped()),at)){const[fr,ur,lr]=at.getGridBuffers(Hi,ui!==0);me.draw(V,Pt,He,Et,tt,rr.backCCW,Un,"globe_raster",fr,ur,lr)}}}if(at&&(V.renderDefaultNorthPole||V.renderDefaultSouthPole)){const fi=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ke&&fi.push("CUSTOM_ANTIALIASING"),me=V.getOrCreateProgram("globeRaster",{defines:fi});for(const ui of X){const{x:Pt,y:Kt,z:Ii}=ui.canonical,Et=Kt===0,hi=Kt===(1<<Ii)-1,[si,an,zi,yi]=at.getPoleBuffers(Ii,!1);if(yi&&(Et||hi)){const Hi=Z.getTile(ui);le.activeTexture.set(se.TEXTURE0),Hi.texture&&Hi.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE);let en=r.cI(Ii,Pt,De);const bn=r.bb(r.cH(ui.canonical)),Un=(fr,ur)=>fr.draw(V,se.TRIANGLES,He,br.disabled,tt,rr.disabled,Hl(De.expandedFarZProjMatrix,en,en,bn,0,je,De.frustumCorners.TL,De.frustumCorners.TR,De.frustumCorners.BR,De.frustumCorners.BL,De.globeCenterInViewSpace,De.globeRadius,gt,0,De._farZ),"globe_pole_raster",ur,zi,yi);j.setupElevationDraw(Hi,me,jt),V.uploadCommonUniforms(le,me,ui.toUnwrapped()),Et&&V.renderDefaultNorthPole&&Un(me,si),hi&&V.renderDefaultSouthPole&&(en=r.ab.mat4.scale(r.ab.mat4.create(),en,[1,-1,1]),Un(me,an))}}}})(v,x,T,I,F);else{const V=v.context,j=V.gl;let Z,X;const Q=v.shadowRenderer,le=yc(v,v.longestCutoffRange),se=tt=>{if(X===tt)return;const He=[];He.push(ed[tt]),le.shouldRenderCutoff&&He.push("RENDER_CUTOFF"),Q&&(He.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Q.useNormalOffset&&He.push("NORMAL_OFFSET")),Z=v.getOrCreateProgram("terrainRaster",{defines:He}),X=tt},me=v.colorModeForRenderPass(),fe=new sr(j.LEQUAL,sr.ReadWrite,v.depthRangeFor3D);Xo.update(F);const De=v.transform,ke=Bd(De.zoom,x.exaggeration(),x.sourceCache._source.tileSize);let Ne=[0,0,0];if(Q){const tt=v.style.directionalLight,He=v.style.ambientLight;tt&&He&&(Ne=qf(v.style,tt,He))}{X=-1;const tt=j.TRIANGLES,[He,We]=[x.gridIndexBuffer,x.gridSegments];for(const je of I){const at=T.getTile(je),gt=br.disabled,Jt=x.prevTerrainTileForTile[je.key],jt=x.terrainTileForTile[je.key];Qf(Jt,jt)&&Xo.newMorphing(je.key,Jt,jt,F,250),V.activeTexture.set(j.TEXTURE0),at.texture&&at.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const fi=Xo.getMorphValuesForProxy(je.key),ui=fi?1:0;let Pt;fi&&(Pt={morphing:{srcDemTile:fi.from,dstDemTile:fi.to,phase:r.cB(fi.phase)}});const Kt=Jf(je.projMatrix,ep(je.canonical,De.renderWorldCopies)?ke/10:ke,Ne);if(se(ui),!Z)continue;x.setupElevationDraw(at,Z,Pt);const Ii=je.toUnwrapped();Q&&Q.setupShadows(Ii,Z),v.uploadCommonUniforms(V,Z,Ii,null,le),Z.draw(v,tt,fe,gt,me,rr.backCCW,Kt,"terrain_raster",x.gridBuffer,He,We)}}}}(a,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const a=this.painter,f=this.painter.context,v=this.proxySourceCache,x=this.proxiedCoords[v.id],T=this._drapedRenderBatches.shift(),I=a.style.order,F=[];let V=0;for(const j of x){const Z=v.getTileByID(j.proxyTileKey),X=v.proxyCachedFBO[j.key]?v.proxyCachedFBO[j.key][i]:void 0,Q=X!==void 0?v.renderCache[X]:this.pool[V++],le=X!==void 0;if(Z.texture=Q.tex,le&&!Q.dirty){F.push(Z.tileID);continue}let se;f.bindFramebuffer.set(Q.fb.framebuffer),this.renderedToTile=!1,Q.dirty&&(f.clear({color:r.aj.transparent,stencil:0}),Q.dirty=!1);for(let me=T.start;me<=T.end;++me){const fe=a.style._mergedLayers[I[me]];if(fe.isHidden(a.transform.zoom))continue;const De=a.style.getLayerSourceCache(fe),ke=De?this.proxyToSource[j.key][De.id]:[j];if(!ke)continue;const Ne=ke;f.viewport.set([0,0,Q.fb.width,Q.fb.height]),se!==(De?De.id:null)&&(this._setupStencil(Q,ke,fe,De),se=De?De.id:null),a.renderLayer(a,De,fe,Ne)}if(this._drapedRenderBatches.length===0)for(const me of this._pendingGroundEffectLayers){const fe=a.style._mergedLayers[I[me]];if(fe.isHidden(a.transform.zoom))continue;const De=a.style.getLayerSourceCache(fe),ke=De?this.proxyToSource[j.key][De.id]:[j];if(!ke)continue;const Ne=ke;f.viewport.set([0,0,Q.fb.width,Q.fb.height]),se!==(De?De.id:null)&&(this._setupStencil(Q,ke,fe,De),se=De?De.id:null),a.renderLayer(a,De,fe,Ne)}this.renderedToTile?(Q.dirty=!0,F.push(Z.tileID)):le||--V,V===5&&(V=0,this.renderToBackBuffer(F))}return this.renderToBackBuffer(F),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,a.width,a.height]),T.end+1}postRender(){}isLayerOrderingCorrect(i){const a=i.order.length;let f=-1,v=a;for(let x=0;x<a;++x)this._style.isLayerDraped(i._mergedLayers[i.order[x]])?f=Math.max(f,x):v=Math.min(v,x);return v>f}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{i=Math.min(i,a.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,a,f){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const T=x.tileID,I=1<<T.overscaledZ,{x:F,y:V}=T.canonical,j=F/I,Z=(F+1)/I,X=V/I,Q=(V+1)/I;return{minx:j,miny:X,maxx:Z,maxy:Q,t:x.dem.tree.raycastRoot(j,X,Z,Q,i,a,f),tile:x}});v.sort((x,T)=>(x.t!==null?x.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const x of v){if(x.t==null)return null;const T=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,i,a,f);if(T!=null)return T}return null}_createFBO(){const i=this.painter.context,a=i.gl,f=this.drapeBufferSize;i.activeTexture.set(a.TEXTURE0);const v=new r.T(i,{width:f[0],height:f[1],data:null},a.RGBA8);v.bind(a.LINEAR,a.CLAMP_TO_EDGE);const x=i.createFramebuffer(f[0],f[1],!0,null);return x.colorAttachment.set(v.texture),x.depthAttachment=new _p(i,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:x,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const a=this._style._mergedLayers[i],f=a.isHidden(this.painter.transform.zoom);return a.type==="hillshade"||a.type==="custom"?!f&&a.shouldRedrape():!f&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const f of this._style.getSources())if(f instanceof tr){i=!0;break}if(!i)return;const a={};for(let f=0;f<this._style.order.length;++f){const v=this._style._mergedLayers[this._style.order[f]],x=this._style.getLayerSourceCache(v);if(x&&!a[x.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof r.a9){a[x.id]=!0;for(const T of this.proxyCoords){const I=this.proxyToSource[T.key][x.id];if(I)for(const F of I)this._clearRenderCacheForTile(x.id,F)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof Rs){i=!0;break}if(!i)return;const a={};for(let f=0;f<this._style.order.length;++f){const v=this._style._mergedLayers[this._style.order[f]],x=this._style.getLayerSourceCache(v);if(!x||a[x.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;const T=v.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const F=this.proxyToSource[I.key][x.id];if(F)for(const V of F){const j=ml(x.getTile(V),x.findLoadedParent(V,0),x,this.painter.transform,T);(j.opacity!==1||j.mix!==0)&&this._clearRenderCacheForTile(x.id,V)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const i=this._style.order,a=i.length;if(a===0)return;const f=[];this._pendingGroundEffectLayers=[];let v,x=0,T=this._style._mergedLayers[i[x]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++x<a;)T=this._style._mergedLayers[i[x]];for(;x<a;++x){const I=this._style._mergedLayers[i[x]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?v===void 0&&(v=x):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),v!==void 0&&(f.push({start:v,end:x-1}),v=void 0)))}if(v!==void 0&&f.push({start:v,end:x-1}),f.length!==0){const I=f[f.length-1];this._pendingGroundEffectLayers.every(F=>F>I.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(i){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const T=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let I=0;I<T.length;++I){const F=Object.values(T[I]);a.renderCachePool.push(...F)}}return}this._clearRasterLayersFromRenderCache();const f=this.proxyCoords,v=this._tilesDirty;for(let T=f.length-1;T>=0;T--){const I=f[T];if(a.getTileByID(I.key),a.proxyCachedFBO[I.key]!==void 0){const F=i[I.key],V=this.proxyToSource[I.key];let j=0;for(const Z in V){const X=V[Z],Q=F[Z];if(!Q||Q.length!==X.length||X.some((le,se)=>le!==Q[se]||v[Z]&&v[Z].hasOwnProperty(le.key))){j=-1;break}++j}for(const Z in a.proxyCachedFBO[I.key])a.renderCache[a.proxyCachedFBO[I.key][Z]].dirty=j<0||j!==Object.values(F).length}}const x=[...this._drapedRenderBatches];x.sort((T,I)=>I.end-I.start-(T.end-T.start));for(const T of x)for(const I of f){if(a.proxyCachedFBO[I.key])continue;let F=a.renderCachePool.pop();F===void 0&&a.renderCache.length<50&&(F=a.renderCache.length,a.renderCache.push(this._createFBO())),F!==void 0&&(a.proxyCachedFBO[I.key]={},a.proxyCachedFBO[I.key][T.start]=F,a.renderCache[F].dirty=!0)}this._tilesDirty={}}_setupStencil(i,a,f,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,T=x.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let I;if(f.isTileClipped())I=a.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):br.disabled}_renderTileClippingMasks(i,a){const f=this.painter,v=this.painter.context,x=v.gl;f._tileClippingMaskIDs={},v.setColorMode(Fr.disabled),v.setDepthMode(sr.disabled);const T=f.getOrCreateProgram("clippingMask");for(const I of i){const F=f._tileClippingMaskIDs[I.key]=--a;T.draw(f,x.TRIANGLES,sr.disabled,new br({func:x.ALWAYS,mask:0},F,255,x.KEEP,x.KEEP,x.REPLACE),Fr.disabled,rr.disabled,Fd(I.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(i){const a=this.painter.transform;if(i.x<0||i.x>a.width||i.y<0||i.y>a.height)return null;const f=[i.x,i.y,1,1];r.ab.vec4.transformMat4(f,f,a.pixelMatrixInverse),r.ab.vec4.scale(f,f,1/f[3]),f[0]/=a.worldSize,f[1]/=a.worldSize;const v=a._camera.position,x=r.bH(1,a.center.lat),T=[v[0],v[1],v[2]/x,0],I=r.ab.vec3.subtract([],f.slice(0,3),T);r.ab.vec3.normalize(I,I);const F=this.raycast(T,I,this._exaggeration);return F!==null&&F?(r.ab.vec3.scaleAndAdd(T,T,I,F),T[3]=T[2],T[2]*=x,T):null}_setupProxiedCoordsForOrtho(i,a,f){if(i.getSource()instanceof r.aJ)return this._setupProxiedCoordsForImageSource(i,a,f);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const v=this.proxiedCoords[i.id]=[],x=this.proxyCoords;for(let F=0;F<x.length;F++){const V=x[F],j=this._findTileCoveringTileID(V,i);if(j){const Z=this._createProxiedId(V,j,f[V.key]&&f[V.key][i.id]);v.push(Z),this.proxyToSource[V.key][i.id]=[Z]}}let T=!1;const I=new Set;for(let F=0;F<a.length;F++){const V=i.getTile(a[F]);if(!V||!V.hasData())continue;const j=this._findTileCoveringTileID(V.tileID,this.proxySourceCache);if(j&&j.tileID.canonical.z!==V.tileID.canonical.z){const Z=this.proxyToSource[j.tileID.key][i.id],X=this._createProxiedId(j.tileID,V,f[j.tileID.key]&&f[j.tileID.key][i.id]);Z?Z.splice(Z.length-1,0,X):this.proxyToSource[j.tileID.key][i.id]=[X];const Q=this.proxyToSource[j.tileID.key][i.id];I.has(Q)||I.add(Q),v.push(X),T=!0}}if(this._sourceTilesOverlap[i.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const F of I)F.sort((V,j)=>j.overscaledZ-V.overscaledZ)}_setupProxiedCoordsForImageSource(i,a,f){if(!i.getSource().loaded())return;const v=this.proxiedCoords[i.id]=[],x=this.proxyCoords,T=i.getSource(),I=T.tileID;if(!I)return;const F=new r.P(I.x,I.y)._div(1<<I.z),V=T.coordinates.map(r.aa.fromLngLat).reduce((Z,X)=>(Z.min.x=Math.min(Z.min.x,X.x-F.x),Z.min.y=Math.min(Z.min.y,X.y-F.y),Z.max.x=Math.max(Z.max.x,X.x-F.x),Z.max.y=Math.max(Z.max.y,X.y-F.y),Z),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),j=(Z,X)=>{const Q=Z.wrap+Z.canonical.x/(1<<Z.canonical.z),le=Z.canonical.y/(1<<Z.canonical.z),se=r.ag/(1<<Z.canonical.z),me=X.wrap+X.canonical.x/(1<<X.canonical.z),fe=X.canonical.y/(1<<X.canonical.z);return Q+se<me+V.min.x||Q>me+V.max.x||le+se<fe+V.min.y||le>fe+V.max.y};for(let Z=0;Z<x.length;Z++){const X=x[Z];for(let Q=0;Q<a.length;Q++){const le=i.getTile(a[Q]);if(!le||!le.hasData()||j(X,le.tileID))continue;const se=this._createProxiedId(X,le,f[X.key]&&f[X.key][i.id]),me=this.proxyToSource[X.key][i.id];me?me.push(se):this.proxyToSource[X.key][i.id]=[se],v.push(se)}}}_createProxiedId(i,a,f){let v=this.orthoMatrix;if(f){const x=f.find(T=>T.key===a.tileID.key);if(x)return x}if(a.tileID.key!==i.key){const x=i.canonical.z-a.tileID.canonical.z;let T,I,F;v=r.ab.mat4.create();const V=a.tileID.wrap-i.wrap<<i.overscaledZ;x>0?(T=r.ag>>x,I=T*((a.tileID.canonical.x<<x)-i.canonical.x+V),F=T*((a.tileID.canonical.y<<x)-i.canonical.y)):(T=r.ag<<-x,I=r.ag*(a.tileID.canonical.x-(i.canonical.x+V<<-x)),F=r.ag*(a.tileID.canonical.y-(i.canonical.y<<-x))),r.ab.mat4.ortho(v,0,T,0,T,0,1),r.ab.mat4.translate(v,v,[I,F,0])}return new tp(a.tileID,i.key,v)}_findTileCoveringTileID(i,a){let f=a.getTile(i);if(f&&f.hasData())return f;const v=this._findCoveringTileCache[a.id],x=v[i.key];if(f=x?a.getTileByID(x):null,f&&f.hasData()||x===null)return f;let T=f?f.tileID:i,I=T.overscaledZ;const F=a.getSource().minzoom,V=[];if(!x){const Z=a.getSource().maxzoom;if(i.canonical.z>=Z){const X=i.canonical.z-Z;a.getSource().reparseOverscaled?(I=Math.max(i.canonical.z+2,a.transform.tileZoom),T=new r.aG(I,i.wrap,Z,i.canonical.x>>X,i.canonical.y>>X)):X!==0&&(I=Z,T=new r.aG(I,i.wrap,Z,i.canonical.x>>X,i.canonical.y>>X))}T.key!==i.key&&(V.push(T.key),f=a.getTile(T))}const j=Z=>{V.forEach(X=>{v[X]=Z}),V.length=0};for(I-=1;I>=F&&(!f||!f.hasData());I--){f&&j(f.tileID.key);const Z=T.calculateScaledKey(I);if(f=a.getTileByID(Z),f&&f.hasData())break;const X=v[Z];if(X===null)break;X===void 0?V.push(Z):f=a.getTileByID(X)}return j(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,a){let f=this._tilesDirty[i];f||(f=this._tilesDirty[i]={}),f[a.key]=!0}}function Uu(d,i,a){const f=function(I,F,V){const j=r.ab.vec3.dot(F,I),Z=r.ab.vec3.dot(V,[.2126,.7152,.0722]),X=(le,se,me)=>(1-me)*le+me*se,Q=X(1-.3*Math.min(Z,1),1,Math.min(j+1,1));return X(.92,1,Math.asin(r.aw(F[2],-1,1))/Math.PI+.5)*Q}(d,[0,0,1],i),v=[0,0,0];r.ab.vec3.scale(v,a.slice(0,3),f);const x=[0,0,0];r.ab.vec3.scale(x,i.slice(0,3),d[2]);const T=[0,0,0];return r.ab.vec3.add(T,v,x),r.cf(T)}const Bo=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],kd=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class yp{static cacheKey(i,a,f,v){let x=`${a}${v?v.cacheKey:""}`;for(const T of f)i.usedDefines.includes(T)&&(x+=`/${T}`);return x}constructor(i,a,f,v,x,T){const I=i.gl;this.program=I.createProgram(),this.configuration=v,this.name=a,this.fixedDefines=[...T];const F=v?v.getBinderAttributes():[],V=(f.staticAttributes||[]).concat(F);let j=v?v.defines():[];j=j.concat(T.map(me=>`#define ${me}`));const Z=`#version 300 es
`;let X=Z+j.concat("precision mediump float;",Xh,Fu.fragmentSource).join(`
`);for(const me of f.fragmentIncludes)X+=`
${Bu[me]}`;X+=`
${f.fragmentSource}`;let Q=Z+j.concat("precision highp float;",Xh,Fu.vertexSource).join(`
`);for(const me of f.vertexIncludes)Q+=`
${Bu[me]}`;this.forceManualRenderingForInstanceIDShaders=i.forceManualRenderingForInstanceIDShaders&&f.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(Q+=`
uniform int u_instanceID;
`),Q+=`
${f.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(Q=Q.replaceAll("gl_InstanceID","u_instanceID"));const le=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(le,X),I.compileShader(le),I.attachShader(this.program,le);const se=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(se,Q),I.compileShader(se),I.attachShader(this.program,se),this.attributes={},this.numAttributes=V.length;for(let me=0;me<this.numAttributes;me++)if(V[me]){const fe=V[me].startsWith("a_")?V[me]:`a_${V[me]}`;I.bindAttribLocation(this.program,me,fe),this.attributes[fe]=me}I.linkProgram(this.program),I.deleteShader(se),I.deleteShader(le),this.fixedUniforms=x(i),this.binderUniforms=v?v.getUniforms(i):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(me=>({u_instanceID:new r.bN(me)}))(i)),(T.includes("TERRAIN")||a.indexOf("symbol")!==-1||a.indexOf("circle")!==-1)&&(this.terrainUniforms=(me=>({u_dem:new r.bN(me),u_dem_prev:new r.bN(me),u_dem_tl:new r.bK(me),u_dem_scale:new r.bM(me),u_dem_tl_prev:new r.bK(me),u_dem_scale_prev:new r.bM(me),u_dem_size:new r.bM(me),u_dem_lerp:new r.bM(me),u_exaggeration:new r.bM(me),u_depth:new r.bN(me),u_depth_size_inv:new r.bK(me),u_depth_range_unpack:new r.bK(me),u_occluder_half_size:new r.bM(me),u_occlusion_depth_offset:new r.bM(me),u_meter_to_dem:new r.bM(me),u_label_plane_matrix_inv:new r.bJ(me)}))(i)),T.includes("GLOBE")&&(this.globeUniforms=(me=>({u_tile_tl_up:new r.bL(me),u_tile_tr_up:new r.bL(me),u_tile_br_up:new r.bL(me),u_tile_bl_up:new r.bL(me),u_tile_up_scale:new r.bM(me)}))(i)),T.includes("FOG")&&(this.fogUniforms=(me=>({u_fog_matrix:new r.bJ(me),u_fog_range:new r.bK(me),u_fog_color:new r.ca(me),u_fog_horizon_blend:new r.bM(me),u_fog_vertical_limit:new r.bK(me),u_fog_temporal_offset:new r.bM(me),u_frustum_tl:new r.bL(me),u_frustum_tr:new r.bL(me),u_frustum_br:new r.bL(me),u_frustum_bl:new r.bL(me),u_globe_pos:new r.bL(me),u_globe_radius:new r.bM(me),u_globe_transition:new r.bM(me),u_is_globe:new r.bN(me),u_viewport:new r.bK(me)}))(i)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(me=>({u_cutoff_params:new r.ca(me)}))(i)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(me=>({u_lighting_ambient_color:new r.bL(me),u_lighting_directional_dir:new r.bL(me),u_lighting_directional_color:new r.bL(me),u_ground_radiance:new r.bL(me)}))(i)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(me=>({u_light_matrix_0:new r.bJ(me),u_light_matrix_1:new r.bJ(me),u_fade_range:new r.bK(me),u_shadow_normal_offset:new r.bL(me),u_shadow_intensity:new r.bM(me),u_shadow_texel_size:new r.bM(me),u_shadow_map_resolution:new r.bM(me),u_shadow_direction:new r.bL(me),u_shadow_bias:new r.bL(me),u_shadowmap_0:new r.bN(me),u_shadowmap_1:new r.bN(me)}))(i))}}setTerrainUniformValues(i,a){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const v in a)f[v]&&f[v].set(this.program,v,a[v])}}setGlobeUniformValues(i,a){if(!this.globeUniforms)return;const f=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const v in a)f[v]&&f[v].set(this.program,v,a[v])}}setFogUniformValues(i,a){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const v in a)f[v].set(this.program,v,a[v])}}setCutoffUniformValues(i,a){if(!this.cutoffUniforms)return;const f=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const v in a)f[v].set(this.program,v,a[v])}}setLightsUniformValues(i,a){if(!this.lightsUniforms)return;const f=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const v in a)f[v].set(this.program,v,a[v])}}setShadowUniformValues(i,a){if(this.failedToCreate||!this.shadowUniforms)return;const f=this.shadowUniforms;i.program.set(this.program);for(const v in a)f[v].set(this.program,v,a[v])}_drawDebugWireframe(i,a,f,v,x,T,I,F,V,j){const Z=i.options.wireframe;if(Z.terrain===!1&&Z.layers2D===!1&&Z.layers3D===!1)return;const X=i.context;if(!(!(!Z.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Z.layers2D||i._terrain&&i._terrain.renderingToTexture||!Bo.includes(this.name))||!(!Z.layers3D||!kd.includes(this.name))))return;const Q=X.gl,le=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,x,X);if(!le)return;const se=[...this.fixedDefines];se.push("DEBUG_WIREFRAME");const me=i.getOrCreateProgram(this.name,{config:this.configuration,defines:se});X.program.set(me.program);const fe=(Ne,tt,He)=>{if(tt[Ne]&&He[Ne])for(const We in tt[Ne])He[Ne][We]&&He[Ne][We].set(He.program,We,tt[Ne][We].current)};V&&V.setUniforms(me.program,X,me.binderUniforms,I,{zoom:F}),fe("fixedUniforms",this,me),fe("terrainUniforms",this,me),fe("globeUniforms",this,me),fe("fogUniforms",this,me),fe("lightsUniforms",this,me),fe("shadowUniforms",this,me),le.bind(),X.setColorMode(new Fr([Q.ONE,Q.ONE_MINUS_SRC_ALPHA,Q.ZERO,Q.ONE],r.aj.transparent,[!0,!0,!0,!1])),X.setDepthMode(new sr(a.func===Q.LESS?Q.LEQUAL:a.func,sr.ReadOnly,a.range)),X.setStencilMode(br.disabled);const De=3*T.primitiveLength*2,ke=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Ne=j||1;for(let tt=0;tt<Ne;++tt)me.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",tt),Q.drawElements(Q.LINES,De,Q.UNSIGNED_SHORT,ke)}else j&&j>1?Q.drawElementsInstanced(Q.LINES,De,Q.UNSIGNED_SHORT,ke,j):Q.drawElements(Q.LINES,De,Q.UNSIGNED_SHORT,ke);x.bind(),X.program.set(this.program),X.setDepthMode(a),X.setStencilMode(f),X.setColorMode(v)}checkUniforms(i,a,f){if(this.fixedDefines.includes(a)){for(const v of Object.keys(f))if(!f[v].initialized)throw new Error(`Program '${this.name}', from draw '${i}': uniform ${v} not set but required by ${a} being defined`)}}draw(i,a,f,v,x,T,I,F,V,j,Z,X,Q,le,se,me){const fe=i.context,De=fe.gl;if(this.failedToCreate)return;fe.program.set(this.program),fe.setDepthMode(f),fe.setStencilMode(v),fe.setColorMode(x),fe.setCullFace(T);for(const tt of Object.keys(this.fixedUniforms))this.fixedUniforms[tt].set(this.program,tt,I[tt]);le&&le.setUniforms(this.program,fe,this.binderUniforms,X,{zoom:Q});const ke={[De.POINTS]:1,[De.LINES]:2,[De.TRIANGLES]:3,[De.LINE_STRIP]:1}[a];this.checkUniforms(F,"RENDER_SHADOWS",this.shadowUniforms);const Ne=me&&me>0?1:void 0;for(const tt of Z.get()){const He=tt.vaos||(tt.vaos={});if((He[F]||(He[F]=new Yh)).bind(fe,this,V,le?le.getPaintVertexBuffers():[],j,tt.vertexOffset,se||[],Ne),this.forceManualRenderingForInstanceIDShaders){const We=me||1;for(let je=0;je<We;++je)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",je),j?De.drawElements(a,tt.primitiveLength*ke,De.UNSIGNED_SHORT,tt.primitiveOffset*ke*2):De.drawArrays(a,tt.vertexOffset,tt.vertexLength)}else me&&me>1?De.drawElementsInstanced(a,tt.primitiveLength*ke,De.UNSIGNED_SHORT,tt.primitiveOffset*ke*2,me):j?De.drawElements(a,tt.primitiveLength*ke,De.UNSIGNED_SHORT,tt.primitiveOffset*ke*2):De.drawArrays(a,tt.vertexOffset,tt.vertexLength);a===De.TRIANGLES&&j&&this._drawDebugWireframe(i,f,v,x,j,tt,X,Q,le,me)}}}function Nd(d,i){const a=Math.pow(2,i.tileID.overscaledZ),f=i.tileSize*Math.pow(2,d.transform.tileZoom)/a,v=f*(i.tileID.canonical.x+i.tileID.wrap*a),x=f*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ar(i,1,d.transform.tileZoom),u_pixel_coord_upper:[v>>16,x>>16],u_pixel_coord_lower:[65535&v,65535&x]}}const td={terrain:0,flat:1},Ws=r.ab.mat4.create(),sc=(d,i,a,f,v,x,T,I,F,V,j,Z,X,Q,le,se,me,fe)=>{const De=i.style.light,ke=De.properties.get("position"),Ne=[ke.x,ke.y,ke.z],tt=r.ab.mat3.create();De.properties.get("anchor")==="viewport"&&(r.ab.mat3.fromRotation(tt,-i.transform.angle),r.ab.vec3.transformMat3(Ne,Ne,tt));const He=De.properties.get("color"),We=i.transform,je={u_matrix:d,u_lightpos:Ne,u_lightintensity:De.properties.get("intensity"),u_lightcolor:[He.r,He.g,He.b],u_vertical_gradient:+a,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ws,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:td[V],u_base_type:td[j],u_ao:v,u_edge_radius:x,u_width_scale:T,u_flood_light_color:le,u_vertical_scale:se,u_flood_light_intensity:me,u_ground_shadow_factor:fe};return We.projection.name==="globe"&&(je.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],je.u_zoom_transition=Z,je.u_inv_rot_matrix=Q,je.u_merc_center=X,je.u_up_dir=We.projection.upVector(new r.bT(0,0,0),X[0]*r.ag,X[1]*r.ag),je.u_height_lift=F),je},ou=(d,i,a,f,v,x)=>({u_matrix:d,u_edge_radius:i,u_width_scale:a,u_vertical_scale:f,u_height_type:td[v],u_base_type:td[x]}),Ud=(d,i,a,f,v,x,T,I,F,V,j,Z,X,Q,le,se,me)=>{const fe=sc(d,i,a,f,v,x,T,I,V,j,Z,X,Q,le,se,me,1,[0,0,0]),De={u_height_factor:-Math.pow(2,I.overscaledZ)/F.tileSize/8};return r.l(fe,Nd(i,F),De)},bh=(d,i)=>({u_matrix:d,u_emissive_strength:i}),Vc=(d,i,a,f)=>r.l(bh(d,i),Nd(a,f)),oc=(d,i,a)=>({u_matrix:d,u_world:a,u_emissive_strength:i}),Up=(d,i,a,f,v)=>r.l(Vc(d,i,a,f),{u_world:v}),Vp=(d,i,a,f)=>{const v=r.ag/a.tileSize;return{u_matrix:d,u_camera_to_center_distance:i.getCameraToCenterDistance(f),u_extrude_scale:[i.pixelsToGLUnits[0]/v,i.pixelsToGLUnits[1]/v]}},Gc=(d,i,a=1)=>({u_matrix:d,u_color:i.toRenderColor(null),u_overlay:0,u_overlay_scale:a}),Vd=r.ab.mat4.create(),kn=(d,i,a,f,v,x,T)=>{const I=d.transform,F=I.projection.name==="globe",V=F?r.cN(I.zoom,i.canonical)*I._pixelsPerMercatorPixel:r.ar(a,1,x),j={u_matrix:i.projMatrix,u_extrude_scale:V,u_intensity:T,u_inv_rot_matrix:Vd,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(F){j.u_inv_rot_matrix=f,j.u_merc_center=v,j.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],j.u_zoom_transition=r.ae(I.zoom);const Z=v[0]*r.ag,X=v[1]*r.ag;j.u_up_dir=I.projection.upVector(new r.bT(0,0,0),Z,X)}return j};function xf(d,[i,a,f,v],[x,T]){if(x===T)return[0,0,0,0];const I=255*(d-1)/(d*(T-x));return[i*I,a*I,f*I,v*I]}function wh(d,i,[a,f]){return a===f?0:.5/d+(i-a)*(d-1)/(d*(f-a))}const Vu=(d,i,a,f,v,x,T,I,F,V,j,Z,X,Q,le,se,me,fe,De,ke,Ne)=>({u_matrix:d,u_normalize_matrix:i,u_globe_matrix:a,u_merc_matrix:f,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:V,u_fade_t:j.mix,u_opacity:j.opacity*Z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Z.paint.get("raster-brightness-min"),u_brightness_high:Z.paint.get("raster-brightness-max"),u_saturation_factor:r.cO(Z.paint.get("raster-saturation")),u_contrast_factor:r.cP(Z.paint.get("raster-contrast")),u_spin_weights:jl(Z.paint.get("raster-hue-rotate")),u_perspective_transform:X,u_raster_elevation:Q,u_zoom_transition:T,u_merc_center:I,u_cutoff_params:F,u_colorization_mix:xf(r.cQ,se,fe),u_colorization_offset:wh(r.cQ,me,fe),u_color_ramp:le,u_texture_offset:[ke/(De+2*ke),De/(De+2*ke)],u_texture_res:[De+2*ke,De+2*ke],u_emissive_strength:Ne});function jl(d){d*=Math.PI/180;const i=Math.sin(d),a=Math.cos(d);return[(2*a+1)/3,(-Math.sqrt(3)*i-a+1)/3,(Math.sqrt(3)*i-a+1)/3]}const un=.05,ys=(d,i,a,f,v,x,T,I,F,V,j,Z)=>({u_matrix:d,u_normalize_matrix:i,u_globe_matrix:a,u_merc_matrix:f,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:V,u_fade_t:j.mix,u_opacity:j.opacity,u_image0:0,u_image1:1,u_raster_elevation:Z,u_zoom_transition:T,u_merc_center:I,u_cutoff_params:F}),Mo=(d,i,a,f,v,x,T,I,F,V)=>({u_particle_texture:d,u_particle_texture_side_len:i,u_tile_offset:a,u_velocity:f,u_color_ramp:x,u_velocity_res:v,u_max_speed:T,u_uv_offset:I,u_data_scale:[255*F[0],255*F[1]],u_data_offset:V,u_particle_pos_scale:1.1,u_particle_pos_offset:[un,un]}),bf=(d,i,a,f,v,x,T,I,F,V)=>({u_particle_texture:d,u_particle_texture_side_len:i,u_velocity:a,u_velocity_res:f,u_max_speed:v,u_speed_factor:x,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*F[0],255*F[1]],u_data_offset:V,u_particle_pos_scale:1.1,u_particle_pos_offset:[un,un]}),lu=r.ab.mat4.create(),Gu=(d,i,a,f,v,x,T,I,F,V,j,Z,X,Q,le,se,me,fe,De,ke,Ne,tt)=>{const He=v.transform,We={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:He.getCameraToCenterDistance(De),u_rotate_symbol:+a,u_aspect_ratio:He.width/He.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:T,u_coord_matrix:I,u_is_text:+V,u_elevation_from_sea:F?1:0,u_pitch_with_map:+f,u_texsize:j,u_texsize_icon:Z,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:lu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:lu,u_up_vector:[0,-1,0],u_color_adj_mat:ke,u_icon_transition:Ne||0,u_gamma_scale:f?v.transform.getCameraToCenterDistance(De)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:r.q.devicePixelRatio,u_is_halo:1,u_scale_factor:tt||1};return De.name==="globe"&&(We.u_tile_id=[Q.canonical.x,Q.canonical.y,1<<Q.canonical.z],We.u_zoom_transition=le,We.u_inv_rot_matrix=me,We.u_merc_center=se,We.u_camera_forward=He._camera.forward(),We.u_ecef_origin=r.cR(He.globeMatrix,Q.toUnwrapped()),We.u_tile_matrix=Float32Array.from(He.globeMatrix),We.u_up_vector=fe),We},Gd=(d,i,a,f)=>({u_matrix:d,u_emissive_strength:i,u_opacity:a,u_color:f}),Hd=(d,i,a,f,v,x,T,I,F)=>r.l(function(V,j,Z,X,Q,le){const{width:se,height:me}=X.imageManager.getPixelSize(j),fe=Math.pow(2,le.tileID.overscaledZ),De=le.tileSize*Math.pow(2,X.transform.tileZoom)/fe,ke=De*(le.tileID.canonical.x+le.tileID.wrap*fe),Ne=De*le.tileID.canonical.y;return{u_image:0,u_pattern_tl:Z.tl,u_pattern_br:Z.br,u_texsize:[se,me],u_pattern_size:Z.displaySize,u_pattern_units_to_pixels:Q?[X.transform.width,-1*X.transform.height]:[1/r.ar(le,1,X.transform.tileZoom),1/r.ar(le,1,X.transform.tileZoom)],u_pixel_coord_upper:[ke>>16,Ne>>16],u_pixel_coord_lower:[65535&ke,65535&Ne]}}(0,x,T,f,I,F),{u_matrix:d,u_emissive_strength:i,u_opacity:a}),Mh=new Float32Array(r.ab.mat4.identity([])),jd=(d,i,a,f,v,x,T,I,F,V,j,Z,X,Q=[0,0,0],le)=>{const se=v.style.light,me=se.properties.get("position"),fe=[-me.x,-me.y,me.z],De=r.ab.mat3.create();se.properties.get("anchor")==="viewport"&&(r.ab.mat3.fromRotation(De,-v.transform.angle),r.ab.vec3.transformMat3(fe,fe,De));const ke=j.alphaMode==="MASK",Ne=se.properties.get("color").toRenderColor(null),tt=X.paint.get("model-ambient-occlusion-intensity"),He=X.paint.get("model-color").constantOr(r.aj.white).toRenderColor(null),We=X.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:d,u_lighting_matrix:i,u_normal_matrix:a,u_node_matrix:f||Mh,u_lightpos:fe,u_lightintensity:se.properties.get("intensity"),u_lightcolor:[Ne.r,Ne.g,Ne.b],u_camera_pos:Q,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+ke,u_alphaCutoff:j.alphaCutoff,u_baseColorFactor:[T.r,T.g,T.b,T.a],u_emissiveFactor:[I[0],I[1],I[2],1],u_metallicFactor:F,u_roughnessFactor:V,u_baseColorTexture:bo.BaseColor,u_metallicRoughnessTexture:bo.MetallicRoughness,u_normalTexture:bo.Normal,u_occlusionTexture:bo.Occlusion,u_emissionTexture:bo.Emission,u_lutTexture:bo.LUT,u_color_mix:[He.r,He.g,He.b,We],u_aoIntensity:tt,u_emissive_strength:Z,u_occlusionTextureTransform:le||[0,0,0,0]}},Hs=(d,i=Mh,a=Mh)=>({u_matrix:d,u_instance:i,u_node_matrix:a}),wf={fillExtrusion:d=>({u_matrix:new r.bJ(d),u_lightpos:new r.bL(d),u_lightintensity:new r.bM(d),u_lightcolor:new r.bL(d),u_vertical_gradient:new r.bM(d),u_opacity:new r.bM(d),u_edge_radius:new r.bM(d),u_width_scale:new r.bM(d),u_ao:new r.bK(d),u_height_type:new r.bN(d),u_base_type:new r.bN(d),u_tile_id:new r.bL(d),u_zoom_transition:new r.bM(d),u_inv_rot_matrix:new r.bJ(d),u_merc_center:new r.bK(d),u_up_dir:new r.bL(d),u_height_lift:new r.bM(d),u_flood_light_color:new r.bL(d),u_vertical_scale:new r.bM(d),u_flood_light_intensity:new r.bM(d),u_ground_shadow_factor:new r.bL(d)}),fillExtrusionDepth:d=>({u_matrix:new r.bJ(d),u_edge_radius:new r.bM(d),u_width_scale:new r.bM(d),u_vertical_scale:new r.bM(d),u_height_type:new r.bN(d),u_base_type:new r.bN(d)}),fillExtrusionPattern:d=>({u_matrix:new r.bJ(d),u_lightpos:new r.bL(d),u_lightintensity:new r.bM(d),u_lightcolor:new r.bL(d),u_vertical_gradient:new r.bM(d),u_height_factor:new r.bM(d),u_edge_radius:new r.bM(d),u_width_scale:new r.bM(d),u_ao:new r.bK(d),u_height_type:new r.bN(d),u_base_type:new r.bN(d),u_tile_id:new r.bL(d),u_zoom_transition:new r.bM(d),u_inv_rot_matrix:new r.bJ(d),u_merc_center:new r.bK(d),u_up_dir:new r.bL(d),u_height_lift:new r.bM(d),u_image:new r.bN(d),u_texsize:new r.bK(d),u_pixel_coord_upper:new r.bK(d),u_pixel_coord_lower:new r.bK(d),u_tile_units_to_pixels:new r.bM(d),u_opacity:new r.bM(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new r.bJ(d),u_opacity:new r.bM(d),u_ao_pass:new r.bM(d),u_meter_to_tile:new r.bM(d),u_ao:new r.bK(d),u_flood_light_intensity:new r.bM(d),u_flood_light_color:new r.bL(d),u_attenuation:new r.bM(d),u_edge_radius:new r.bM(d),u_fb:new r.bN(d),u_fb_size:new r.bM(d),u_dynamic_offset:new r.bM(d)}),fill:d=>({u_matrix:new r.bJ(d),u_emissive_strength:new r.bM(d)}),fillPattern:d=>({u_matrix:new r.bJ(d),u_emissive_strength:new r.bM(d),u_image:new r.bN(d),u_texsize:new r.bK(d),u_pixel_coord_upper:new r.bK(d),u_pixel_coord_lower:new r.bK(d),u_tile_units_to_pixels:new r.bM(d)}),fillOutline:d=>({u_matrix:new r.bJ(d),u_emissive_strength:new r.bM(d),u_world:new r.bK(d)}),fillOutlinePattern:d=>({u_matrix:new r.bJ(d),u_emissive_strength:new r.bM(d),u_world:new r.bK(d),u_image:new r.bN(d),u_texsize:new r.bK(d),u_pixel_coord_upper:new r.bK(d),u_pixel_coord_lower:new r.bK(d),u_tile_units_to_pixels:new r.bM(d)}),circle:r.cS,collisionBox:d=>({u_matrix:new r.bJ(d),u_camera_to_center_distance:new r.bM(d),u_extrude_scale:new r.bK(d)}),collisionCircle:d=>({u_matrix:new r.bJ(d),u_inv_matrix:new r.bJ(d),u_camera_to_center_distance:new r.bM(d),u_viewport_size:new r.bK(d)}),debug:d=>({u_color:new r.cz(d),u_matrix:new r.bJ(d),u_overlay:new r.bN(d),u_overlay_scale:new r.bM(d)}),clippingMask:d=>({u_matrix:new r.bJ(d)}),heatmap:d=>({u_extrude_scale:new r.bM(d),u_intensity:new r.bM(d),u_matrix:new r.bJ(d),u_inv_rot_matrix:new r.bJ(d),u_merc_center:new r.bK(d),u_tile_id:new r.bL(d),u_zoom_transition:new r.bM(d),u_up_dir:new r.bL(d)}),heatmapTexture:d=>({u_image:new r.bN(d),u_color_ramp:new r.bN(d),u_opacity:new r.bM(d)}),hillshade:d=>({u_matrix:new r.bJ(d),u_image:new r.bN(d),u_latrange:new r.bK(d),u_light:new r.bK(d),u_shadow:new r.cz(d),u_highlight:new r.cz(d),u_emissive_strength:new r.bM(d),u_accent:new r.cz(d)}),hillshadePrepare:d=>({u_matrix:new r.bJ(d),u_image:new r.bN(d),u_dimension:new r.bK(d),u_zoom:new r.bM(d)}),line:r.cT,linePattern:r.cU,raster:d=>({u_matrix:new r.bJ(d),u_normalize_matrix:new r.bJ(d),u_globe_matrix:new r.bJ(d),u_merc_matrix:new r.bJ(d),u_grid_matrix:new r.cA(d),u_tl_parent:new r.bK(d),u_scale_parent:new r.bM(d),u_fade_t:new r.bM(d),u_opacity:new r.bM(d),u_image0:new r.bN(d),u_image1:new r.bN(d),u_brightness_low:new r.bM(d),u_brightness_high:new r.bM(d),u_saturation_factor:new r.bM(d),u_contrast_factor:new r.bM(d),u_spin_weights:new r.bL(d),u_perspective_transform:new r.bK(d),u_raster_elevation:new r.bM(d),u_zoom_transition:new r.bM(d),u_merc_center:new r.bK(d),u_cutoff_params:new r.ca(d),u_colorization_mix:new r.ca(d),u_colorization_offset:new r.bM(d),u_color_ramp:new r.bN(d),u_texture_offset:new r.bK(d),u_texture_res:new r.bK(d),u_emissive_strength:new r.bM(d)}),rasterParticle:d=>({u_matrix:new r.bJ(d),u_normalize_matrix:new r.bJ(d),u_globe_matrix:new r.bJ(d),u_merc_matrix:new r.bJ(d),u_grid_matrix:new r.cA(d),u_tl_parent:new r.bK(d),u_scale_parent:new r.bM(d),u_fade_t:new r.bM(d),u_opacity:new r.bM(d),u_image0:new r.bN(d),u_image1:new r.bN(d),u_raster_elevation:new r.bM(d),u_zoom_transition:new r.bM(d),u_merc_center:new r.bK(d),u_cutoff_params:new r.ca(d)}),rasterParticleTexture:d=>({u_texture:new r.bN(d),u_opacity:new r.bM(d)}),rasterParticleDraw:d=>({u_particle_texture:new r.bN(d),u_particle_texture_side_len:new r.bM(d),u_tile_offset:new r.bK(d),u_velocity:new r.bN(d),u_color_ramp:new r.bN(d),u_velocity_res:new r.bK(d),u_max_speed:new r.bM(d),u_uv_offset:new r.bK(d),u_data_scale:new r.bK(d),u_data_offset:new r.bM(d),u_particle_pos_scale:new r.bM(d),u_particle_pos_offset:new r.bK(d)}),rasterParticleUpdate:d=>({u_particle_texture:new r.bN(d),u_particle_texture_side_len:new r.bM(d),u_velocity:new r.bN(d),u_velocity_res:new r.bK(d),u_max_speed:new r.bM(d),u_speed_factor:new r.bM(d),u_reset_rate:new r.bM(d),u_rand_seed:new r.bM(d),u_uv_offset:new r.bK(d),u_data_scale:new r.bK(d),u_data_offset:new r.bM(d),u_particle_pos_scale:new r.bM(d),u_particle_pos_offset:new r.bK(d)}),symbol:d=>({u_is_size_zoom_constant:new r.bN(d),u_is_size_feature_constant:new r.bN(d),u_size_t:new r.bM(d),u_size:new r.bM(d),u_camera_to_center_distance:new r.bM(d),u_rotate_symbol:new r.bN(d),u_aspect_ratio:new r.bM(d),u_fade_change:new r.bM(d),u_matrix:new r.bJ(d),u_label_plane_matrix:new r.bJ(d),u_coord_matrix:new r.bJ(d),u_is_text:new r.bN(d),u_elevation_from_sea:new r.bN(d),u_pitch_with_map:new r.bN(d),u_texsize:new r.bK(d),u_texsize_icon:new r.bK(d),u_texture:new r.bN(d),u_texture_icon:new r.bN(d),u_gamma_scale:new r.bM(d),u_device_pixel_ratio:new r.bM(d),u_tile_id:new r.bL(d),u_zoom_transition:new r.bM(d),u_inv_rot_matrix:new r.bJ(d),u_merc_center:new r.bK(d),u_camera_forward:new r.bL(d),u_tile_matrix:new r.bJ(d),u_up_vector:new r.bL(d),u_ecef_origin:new r.bL(d),u_is_halo:new r.bN(d),u_icon_transition:new r.bM(d),u_color_adj_mat:new r.bJ(d),u_scale_factor:new r.bM(d)}),background:d=>({u_matrix:new r.bJ(d),u_emissive_strength:new r.bM(d),u_opacity:new r.bM(d),u_color:new r.cz(d)}),backgroundPattern:d=>({u_matrix:new r.bJ(d),u_emissive_strength:new r.bM(d),u_opacity:new r.bM(d),u_image:new r.bN(d),u_pattern_tl:new r.bK(d),u_pattern_br:new r.bK(d),u_texsize:new r.bK(d),u_pattern_size:new r.bK(d),u_pixel_coord_upper:new r.bK(d),u_pixel_coord_lower:new r.bK(d),u_pattern_units_to_pixels:new r.bK(d)}),terrainRaster:d=>({u_matrix:new r.bJ(d),u_image0:new r.bN(d),u_skirt_height:new r.bM(d),u_ground_shadow_factor:new r.bL(d)}),skybox:d=>({u_matrix:new r.bJ(d),u_sun_direction:new r.bL(d),u_cubemap:new r.bN(d),u_opacity:new r.bM(d),u_temporal_offset:new r.bM(d)}),skyboxGradient:d=>({u_matrix:new r.bJ(d),u_color_ramp:new r.bN(d),u_center_direction:new r.bL(d),u_radius:new r.bM(d),u_opacity:new r.bM(d),u_temporal_offset:new r.bM(d)}),skyboxCapture:d=>({u_matrix_3f:new r.cA(d),u_sun_direction:new r.bL(d),u_sun_intensity:new r.bM(d),u_color_tint_r:new r.ca(d),u_color_tint_m:new r.ca(d),u_luminance:new r.bM(d)}),globeRaster:d=>({u_proj_matrix:new r.bJ(d),u_globe_matrix:new r.bJ(d),u_normalize_matrix:new r.bJ(d),u_merc_matrix:new r.bJ(d),u_zoom_transition:new r.bM(d),u_merc_center:new r.bK(d),u_image0:new r.bN(d),u_grid_matrix:new r.cA(d),u_skirt_height:new r.bM(d),u_far_z_cutoff:new r.bM(d),u_frustum_tl:new r.bL(d),u_frustum_tr:new r.bL(d),u_frustum_br:new r.bL(d),u_frustum_bl:new r.bL(d),u_globe_pos:new r.bL(d),u_globe_radius:new r.bM(d),u_viewport:new r.bK(d)}),globeAtmosphere:d=>({u_frustum_tl:new r.bL(d),u_frustum_tr:new r.bL(d),u_frustum_br:new r.bL(d),u_frustum_bl:new r.bL(d),u_horizon:new r.bM(d),u_transition:new r.bM(d),u_fadeout_range:new r.bM(d),u_color:new r.ca(d),u_high_color:new r.ca(d),u_space_color:new r.ca(d),u_temporal_offset:new r.bM(d),u_horizon_angle:new r.bM(d)}),model:d=>({u_matrix:new r.bJ(d),u_lighting_matrix:new r.bJ(d),u_normal_matrix:new r.bJ(d),u_node_matrix:new r.bJ(d),u_lightpos:new r.bL(d),u_lightintensity:new r.bM(d),u_lightcolor:new r.bL(d),u_camera_pos:new r.bL(d),u_opacity:new r.bM(d),u_baseColorFactor:new r.ca(d),u_emissiveFactor:new r.ca(d),u_metallicFactor:new r.bM(d),u_roughnessFactor:new r.bM(d),u_baseTextureIsAlpha:new r.bN(d),u_alphaMask:new r.bN(d),u_alphaCutoff:new r.bM(d),u_baseColorTexture:new r.bN(d),u_metallicRoughnessTexture:new r.bN(d),u_normalTexture:new r.bN(d),u_occlusionTexture:new r.bN(d),u_emissionTexture:new r.bN(d),u_lutTexture:new r.bN(d),u_color_mix:new r.ca(d),u_aoIntensity:new r.bM(d),u_emissive_strength:new r.bM(d),u_occlusionTextureTransform:new r.ca(d)}),modelDepth:d=>({u_matrix:new r.bJ(d),u_instance:new r.bJ(d),u_node_matrix:new r.bJ(d)}),groundShadow:d=>({u_matrix:new r.bJ(d),u_ground_shadow_factor:new r.bL(d)}),stars:d=>({u_matrix:new r.bJ(d),u_up:new r.bL(d),u_right:new r.bL(d),u_intensity_multiplier:new r.bM(d)}),snowParticle:d=>({u_modelview:new r.bJ(d),u_projection:new r.bJ(d),u_time:new r.bM(d),u_cam_pos:new r.bL(d),u_velocityConeAperture:new r.bM(d),u_velocity:new r.bM(d),u_horizontalOscillationRadius:new r.bM(d),u_horizontalOscillationRate:new r.bM(d),u_boxSize:new r.bM(d),u_billboardSize:new r.bM(d),u_simpleShapeParameters:new r.bK(d),u_screenSize:new r.bK(d),u_thinningCenterPos:new r.bK(d),u_thinningShape:new r.bL(d),u_thinningAffectedRatio:new r.bM(d),u_thinningParticleOffset:new r.bM(d),u_particleColor:new r.ca(d),u_direction:new r.bL(d)}),rainParticle:d=>({u_modelview:new r.bJ(d),u_projection:new r.bJ(d),u_time:new r.bM(d),u_cam_pos:new r.bL(d),u_texScreen:new r.bN(d),u_velocityConeAperture:new r.bM(d),u_velocity:new r.bM(d),u_boxSize:new r.bM(d),u_rainDropletSize:new r.bK(d),u_distortionStrength:new r.bM(d),u_rainDirection:new r.bL(d),u_color:new r.ca(d),u_screenSize:new r.bK(d),u_thinningCenterPos:new r.bK(d),u_thinningShape:new r.bL(d),u_thinningAffectedRatio:new r.bM(d),u_thinningParticleOffset:new r.bM(d),u_shapeDirectionalPower:new r.bM(d),u_shapeNormalPower:new r.bM(d),u_mode:new r.bM(d)}),vignette:d=>({u_vignetteShape:new r.bL(d),u_vignetteColor:new r.ca(d)}),occlusion:d=>({u_matrix:new r.bJ(d),u_anchorPos:new r.bL(d),u_screenSizePx:new r.bK(d),u_occluderSizePx:new r.bK(d),u_color:new r.ca(d)})};class wc{constructor(i,a,f,v){this.id=wc.uniqueIdxCounter,wc.uniqueIdxCounter++,this.context=i;const x=i.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||v||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){this.id=wc.uniqueIdxCounter,wc.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}wc.uniqueIdxCounter=0;const Rl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Hu{constructor(i,a,f,v,x,T){this.length=a.length,this.attributes=f,this.itemSize=a.bytesPerElement,this.dynamicDraw=v,this.instanceCount=T,this.context=i;const I=i.gl;this.buffer=I.createBuffer(),i.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||x||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,a){for(let f=0;f<this.attributes.length;f++){const v=a.attributes[this.attributes[f].name];v!==void 0&&i.enableVertexAttribArray(v)}}setVertexAttribPointers(i,a,f){for(let v=0;v<this.attributes.length;v++){const x=this.attributes[v],T=a.attributes[x.name];T!==void 0&&i.vertexAttribPointer(T,x.components,i[Rl[x.type]],!1,this.itemSize,x.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(i,a,f){for(let v=0;v<this.attributes.length;v++){const x=a.attributes[this.attributes[v].name];x!==void 0&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(x,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class vp{constructor(i,a,f,v,x){this.context=i,this.width=a,this.height=f;const T=this.framebuffer=i.gl.createFramebuffer();v&&(this.colorAttachment=new Nu(i,T)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new Qh(i,T):new vf(i,T))}destroy(){const i=this.context.gl;if(this.colorAttachment){const a=this.colorAttachment.get();a&&i.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const a=this.depthAttachment.get();a&&i.deleteRenderbuffer(a)}else{const a=this.depthAttachment.get();a&&i.deleteTexture(a)}i.deleteFramebuffer(this.framebuffer)}}class qd{constructor(i,a){this.gl=i,this.clearColor=new ph(this),this.clearDepth=new Cl(this),this.clearStencil=new Gl(this),this.colorMask=new ku(this),this.depthMask=new Nc(this),this.stencilMask=new Uc(this),this.stencilFunc=new mh(this),this.stencilOp=new Jh(this),this.stencilTest=new gh(this),this.depthRange=new gf(this),this.depthTest=new ls(this),this.depthFunc=new cs(this),this.blend=new pa(this),this.blendFunc=new Ll(this),this.blendColor=new xc(this),this.blendEquation=new _f(this),this.cullFace=new au(this),this.cullFaceSide=new Xf(this),this.frontFace=new Yf(this),this.program=new _h(this),this.activeTexture=new Pd(this),this.viewport=new Od(this),this.bindFramebuffer=new su(this),this.bindRenderbuffer=new Fp(this),this.bindTexture=new gp(this),this.bindVertexBuffer=new kp(this),this.bindElementBuffer=new $f(this),this.bindVertexArrayOES=new Np(this),this.pixelStoreUnpack=new yf(this),this.pixelStoreUnpackPremultiplyAlpha=new Kf(this),this.pixelStoreUnpackFlipY=new yh(this),this.options=a?Object.assign({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=a&&!!a.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,a,f){return new wc(this,i,a,f)}createVertexBuffer(i,a,f,v,x){return new Hu(this,i,a,f,v,x)}createRenderbuffer(i,a,f){const v=this.gl,x=v.createRenderbuffer();return this.bindRenderbuffer.set(x),v.renderbufferStorage(v.RENDERBUFFER,i,a,f),this.bindRenderbuffer.set(null),x}createFramebuffer(i,a,f,v){return new vp(this,i,a,f,v)}clear({color:i,depth:a,stencil:f,colorMask:v}){const x=this.gl;let T=0;i&&(T|=x.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set(v||[!0,!0,!0,!0])),a!==void 0&&(T|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),f!==void 0&&(T|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),x.clear(T)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){r.bn(i.blendFunction,Fr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Th;function ju(d,i,a,f,v,x,T){const I=d.context,F=I.gl,V=d.transform,j=d.getOrCreateProgram("collisionBox"),Z=[];let X=0,Q=0;for(let Ne=0;Ne<f.length;Ne++){const tt=f[Ne],He=i.getTile(tt),We=He.getBucket(a);if(!We)continue;const je=kl(tt,We,V);let at=je;v[0]===0&&v[1]===0||(at=d.translatePosMatrix(je,He,v,x));const gt=T?We.textCollisionBox:We.iconCollisionBox,Jt=We.collisionCircleArray;if(Jt.length>0){const jt=r.ab.mat4.create(),fi=at;r.ab.mat4.mul(jt,We.placementInvProjMatrix,V.glCoordMatrix),r.ab.mat4.mul(jt,jt,We.placementViewportMatrix),Z.push({circleArray:Jt,circleOffset:Q,transform:fi,invTransform:jt,projection:We.getProjection()}),X+=Jt.length/4,Q=X}gt&&(d.terrain&&d.terrain.setupElevationDraw(He,j),j.draw(d,F.LINES,sr.disabled,br.disabled,d.colorModeForRenderPass(),rr.disabled,Vp(at,V,He,We.getProjection()),a.id,gt.layoutVertexBuffer,gt.indexBuffer,gt.segments,null,V.zoom,null,[gt.collisionVertexBuffer,gt.collisionVertexBufferExt]))}if(!T||!Z.length)return;const le=d.getOrCreateProgram("collisionCircle"),se=new r.cV;se.resize(4*X),se._trim();let me=0;for(const Ne of Z)for(let tt=0;tt<Ne.circleArray.length/4;tt++){const He=4*tt,We=Ne.circleArray[He+0],je=Ne.circleArray[He+1],at=Ne.circleArray[He+2],gt=Ne.circleArray[He+3];se.emplace(me++,We,je,at,gt,0),se.emplace(me++,We,je,at,gt,1),se.emplace(me++,We,je,at,gt,2),se.emplace(me++,We,je,at,gt,3)}(!Th||Th.length<2*X)&&(Th=function(Ne){const tt=2*Ne,He=new r.aU;He.resize(tt),He._trim();for(let We=0;We<tt;We++){const je=6*We;He.uint16[je+0]=4*We+0,He.uint16[je+1]=4*We+1,He.uint16[je+2]=4*We+2,He.uint16[je+3]=4*We+2,He.uint16[je+4]=4*We+3,He.uint16[je+5]=4*We+0}return He}(X));const fe=I.createIndexBuffer(Th,!0),De=I.createVertexBuffer(se,r.cW.members,!0);for(const Ne of Z){const tt={u_matrix:Ne.transform,u_inv_matrix:Ne.invTransform,u_camera_to_center_distance:(ke=V).getCameraToCenterDistance(Ne.projection),u_viewport_size:[ke.width,ke.height]};le.draw(d,F.TRIANGLES,sr.disabled,br.disabled,d.colorModeForRenderPass(),rr.disabled,tt,a.id,De,fe,r.b7.simpleSegment(0,2*Ne.circleOffset,Ne.circleArray.length,Ne.circleArray.length/2),null,V.zoom)}var ke;De.destroy(),fe.destroy()}const mo=r.ab.mat4.create();function us(d){const i=d._camera.getWorldToCamera(d.worldSize,1),a=r.ab.mat4.multiply([],i,d.globeMatrix);r.ab.mat4.invert(a,a);const f=[0,0,0],v=[0,1,0,0];return r.ab.vec4.transformMat4(v,v,a),f[0]=v[0],f[1]=v[1],f[2]=v[2],r.ab.vec3.normalize(f,f),f}function Ka({width:d,height:i,anchor:a,textOffset:f,textScale:v},x){const{horizontalAlign:T,verticalAlign:I}=r.bD(a),F=-(T-.5)*d,V=-(I-.5)*i,j=r.bC(a,f);return new r.P((F/v+j[0])*x,(V/v+j[1])*x)}function Sh(d,i,a,f,v,x,T,I,F,V,j){const Z=d.text.placedSymbolArray,X=d.text.dynamicLayoutVertexArray,Q=d.icon.dynamicLayoutVertexArray,le={},se=d.getProjection(),me=fl(I,se,x),fe=x.elevation,De=se.upVectorScale(I.canonical,x.center.lat,x.worldSize).metersToTile;X.clear();for(let ke=0;ke<Z.length;ke++){const Ne=Z.get(ke),{tileAnchorX:tt,tileAnchorY:He,numGlyphs:We}=Ne,je=Ne.hidden||!Ne.crossTileID||d.allowVerticalPlacement&&!Ne.placedOrientation?null:f[Ne.crossTileID];if(je){let at=0,gt=0,Jt=0;if(fe){const si=fe?fe.getAtTileOffset(I,tt,He):0,[an,zi,yi]=se.upVector(I.canonical,tt,He);at=si*an*De,gt=si*zi*De,Jt=si*yi*De}let[jt,fi,ui,Pt]=fa(Ne.projectedAnchorX+at,Ne.projectedAnchorY+gt,Ne.projectedAnchorZ+Jt,a?me:T);const Kt=$r(x.getCameraToCenterDistance(se),Pt);let Ii=v.evaluateSizeForFeature(d.textSizeData,V,Ne)*Kt/r.bw;a&&(Ii*=d.tilePixelRatio/F);const Et=Ka(je,Ii);a?({x:jt,y:fi,z:ui}=se.projectTilePoint(tt+Et.x,He+Et.y,I.canonical),[jt,fi,ui]=fa(jt+at,fi+gt,ui+Jt,T)):(i&&Et._rotate(-x.angle),jt+=Et.x,fi+=Et.y,ui=0);const hi=d.allowVerticalPlacement&&Ne.placedOrientation===r.bq.vertical?Math.PI/2:0;for(let si=0;si<We;si++)r.bt(X,jt,fi,ui,hi);j&&Ne.associatedIconIndex>=0&&(le[Ne.associatedIconIndex]={x:jt,y:fi,z:ui,angle:hi})}else _a(We,X)}if(j){Q.clear();const ke=d.icon.placedSymbolArray;for(let Ne=0;Ne<ke.length;Ne++){const tt=ke.get(Ne),{numGlyphs:He}=tt,We=le[Ne];if(tt.hidden||!We)_a(He,Q);else{const{x:je,y:at,z:gt,angle:Jt}=We;for(let jt=0;jt<He;jt++)r.bt(Q,je,at,gt,Jt)}}d.icon.dynamicLayoutVertexBuffer.updateData(Q)}d.text.dynamicLayoutVertexBuffer.updateData(X)}function qu(d,i,a,f,v,x,T={}){const I=a.paint.get("icon-translate"),F=a.paint.get("text-translate"),V=a.paint.get("icon-translate-anchor"),j=a.paint.get("text-translate-anchor"),Z=a.layout.get("icon-rotation-alignment"),X=a.layout.get("text-rotation-alignment"),Q=a.layout.get("icon-pitch-alignment"),le=a.layout.get("text-pitch-alignment"),se=a.layout.get("icon-keep-upright"),me=a.layout.get("text-keep-upright"),fe=a.paint.get("icon-color-saturation"),De=a.paint.get("icon-color-contrast"),ke=a.paint.get("icon-color-brightness-min"),Ne=a.paint.get("icon-color-brightness-max"),tt=a.layout.get("symbol-elevation-reference")==="sea",He=d.context,We=He.gl,je=d.transform,at=Z==="map",gt=X==="map",Jt=Q==="map",jt=le==="map",fi=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ui=!1;const Pt=d.depthModeForSublayer(0,sr.ReadOnly),Kt=[r.at(je.center.lng),r.aA(je.center.lat)],Ii=a.layout.get("text-variable-anchor"),Et=je.projection.name==="globe",hi=[],si=[0,-1,0];for(const an of f){const zi=i.getTile(an),yi=zi.getBucket(a);if(!yi||yi.projection.name==="mercator"&&Et||yi.fullyClipped)continue;const Hi=yi.projection.name==="globe",en=Hi?r.ae(je.zoom):0,bn=fl(an,yi.getProjection(),je),Un=je.calculatePixelsToTileUnitsMatrix(zi),fr=Ii&&yi.hasTextData(),ur=yi.hasIconTextFit()&&fr&&yi.hasIconData(),lr=yi.getProjection().createInversionMatrix(je,an.canonical),wr=pr=>{je.depthOcclusionForSymbolsAndCircles&&(a.hasInitialOcclusionOpacityProperties||d.terrain)&&(pr.push("DEPTH_D24"),pr.push("DEPTH_OCCLUSION"))},Tr=()=>{const pr=at&&a.layout.get("symbol-placement")!=="point",yr=[];wr(yr);const Jr=pr||ur,is=a.paint.get("icon-image-cross-fade").constantOr(0);d.terrainRenderModeElevated()&&Jt&&yr.push("PITCH_WITH_MAP_TERRAIN"),Hi&&(yr.push("PROJECTION_GLOBE_VIEW"),Jr&&yr.push("PROJECTED_POS_ON_VIEWPORT")),is>0&&yr.push("ICON_TRANSITION"),yi.icon.zOffsetVertexBuffer&&yr.push("Z_OFFSET"),fe===0&&De===0&&ke===0&&Ne===1||yr.push("COLOR_ADJUSTMENT"),yi.sdfIcons&&yr.push("RENDER_SDF");const ns=yi.icon.programConfigurations.get(a.id),Es=d.getOrCreateProgram("symbol",{config:ns,defines:yr}),el=zi.imageAtlasTexture?zi.imageAtlasTexture.size:[0,0],Ps=yi.iconSizeData,da=r.bp(Ps,je.zoom),Pa=Jt||je.pitch!==0,Sa=Lr(bn,zi.tileID.canonical,Jt,at,je,yi.getProjection(),Un),ha=On(bn,zi.tileID.canonical,Jt,at,je,yi.getProjection(),Un),Xa=d.translatePosMatrix(ha,zi,I,V,!0),Os=d.translatePosMatrix(bn,zi,I,V),Oa=Jr?mo:Sa,ks=at&&!Jt&&!pr;let ul=si;!Et&&!je.mercatorFromTransition||at||(ul=us(je));const tl=Hi?ul:si,No=a.getColorAdjustmentMatrix(fe,De,ke,Ne),$l=Gu(Ps.kind,da,ks,Jt,d,Os,Oa,Xa,tt,!1,el,[0,0],!0,an,en,Kt,lr,tl,yi.getProjection(),No,is),Eo=zi.imageAtlasTexture?zi.imageAtlasTexture:null,hl=a.layout.get("icon-size").constantOr(0)!==1||yi.iconsNeedLinear,Kl=yi.sdfIcons||d.options.rotating||d.options.zooming||hl||Pa?We.LINEAR:We.NEAREST,Bl=yi.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,Mu=d.terrain&&Jt&&pr?r.ab.mat4.invert(r.ab.mat4.create(),Sa):mo;if(pr&&yi.icon){const Jl=je.elevation,Qu=Jl?Jl.getAtTileOffsetFunc(an,je.center.lat,je.worldSize,yi.getProjection()):null,Lf=xr(bn,zi.tileID.canonical,Jt,at,je,yi.getProjection(),Un);aa(yi,bn,d,!1,Lf,ha,Jt,se,Qu,an)}return{program:Es,buffers:yi.icon,uniformValues:$l,atlasTexture:Eo,atlasTextureIcon:null,atlasInterpolation:Kl,atlasInterpolationIcon:null,isSDF:yi.sdfIcons,hasHalo:Bl,tile:zi,labelPlaneMatrixInv:Mu}},za=()=>{const pr=gt&&a.layout.get("symbol-placement")!=="point",yr=[],Jr=pr||Ii||ur;d.terrainRenderModeElevated()&&jt&&yr.push("PITCH_WITH_MAP_TERRAIN"),Hi&&(yr.push("PROJECTION_GLOBE_VIEW"),Jr&&yr.push("PROJECTED_POS_ON_VIEWPORT")),yi.text.zOffsetVertexBuffer&&yr.push("Z_OFFSET"),yi.iconsInText&&yr.push("RENDER_TEXT_AND_SYMBOL"),yr.push("RENDER_SDF"),wr(yr);const is=yi.text.programConfigurations.get(a.id),ns=d.getOrCreateProgram("symbol",{config:is,defines:yr});let Es,el=[0,0],Ps=null;const da=yi.textSizeData;yi.iconsInText&&(el=zi.imageAtlasTexture?zi.imageAtlasTexture.size:[0,0],Ps=zi.imageAtlasTexture?zi.imageAtlasTexture:null,Es=jt||je.pitch!==0||d.options.rotating||d.options.zooming||da.kind==="composite"||da.kind==="camera"?We.LINEAR:We.NEAREST);const Pa=zi.glyphAtlasTexture?zi.glyphAtlasTexture.size:[0,0],Sa=a.layout.get("text-size-scale-range"),ha=r.aw(d.scaleFactor,Sa[0],Sa[1]),Xa=r.bp(da,je.zoom,ha),Os=Lr(bn,zi.tileID.canonical,jt,gt,je,yi.getProjection(),Un),Oa=On(bn,zi.tileID.canonical,jt,gt,je,yi.getProjection(),Un),ks=d.translatePosMatrix(Oa,zi,F,j,!0),ul=d.translatePosMatrix(bn,zi,F,j),tl=Jr?mo:Os,No=gt&&!jt&&!pr;let $l=si;!Et&&!je.mercatorFromTransition||gt||($l=us(je));const Eo=Gu(da.kind,Xa,No,jt,d,ul,tl,ks,tt,!0,Pa,el,!0,an,en,Kt,lr,Hi?$l:si,yi.getProjection(),null,null,ha),hl=zi.glyphAtlasTexture?zi.glyphAtlasTexture:null,Kl=We.LINEAR,Bl=a.paint.get("text-halo-width").constantOr(1)!==0,Mu=d.terrain&&jt&&pr?r.ab.mat4.invert(r.ab.mat4.create(),Os):mo;if(pr&&yi.text){const Jl=je.elevation,Qu=Jl?Jl.getAtTileOffsetFunc(an,je.center.lat,je.worldSize,yi.getProjection()):null,Lf=xr(bn,zi.tileID.canonical,jt,gt,je,yi.getProjection(),Un);aa(yi,bn,d,!0,Lf,Oa,jt,me,Qu,an)}return{program:ns,buffers:yi.text,uniformValues:Eo,atlasTexture:hl,atlasTextureIcon:Ps,atlasInterpolation:Kl,atlasInterpolationIcon:Es,isSDF:!0,hasHalo:Bl,tile:zi,labelPlaneMatrixInv:Mu}},Ss=yi.icon.segments.get().length,qa=yi.text.segments.get().length,Pr=Ss&&!T.onlyText?Tr():null,ba=qa&&!T.onlyIcons?za():null,In=a.paint.get("icon-opacity").constantOr(1),_r=a.paint.get("text-opacity").constantOr(1);if(fi&&yi.canOverlap){ui=!0;const pr=In&&!T.onlyText?yi.icon.segments.get():[],yr=_r&&!T.onlyIcons?yi.text.segments.get():[];for(const Jr of pr)hi.push({segments:new r.b7([Jr]),sortKey:Jr.sortKey,state:Pr});for(const Jr of yr)hi.push({segments:new r.b7([Jr]),sortKey:Jr.sortKey,state:ba})}else T.onlyText||hi.push({segments:In?yi.icon.segments:new r.b7([]),sortKey:0,state:Pr}),T.onlyIcons||hi.push({segments:_r?yi.text.segments:new r.b7([]),sortKey:0,state:ba})}ui&&hi.sort((an,zi)=>an.sortKey-zi.sortKey);for(const an of hi){const zi=an.state;if(zi)if(d.terrain?d.terrain.setupElevationDraw(zi.tile,zi.program,{useDepthForOcclusion:je.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:zi.labelPlaneMatrixInv}):d.setupDepthForOcclusion(je.depthOcclusionForSymbolsAndCircles,zi.program),He.activeTexture.set(We.TEXTURE0),zi.atlasTexture&&zi.atlasTexture.bind(zi.atlasInterpolation,We.CLAMP_TO_EDGE,!0),zi.atlasTextureIcon&&(He.activeTexture.set(We.TEXTURE1),zi.atlasTextureIcon&&zi.atlasTextureIcon.bind(zi.atlasInterpolationIcon,We.CLAMP_TO_EDGE,!0)),d.uploadCommonLightUniforms(d.context,zi.program),zi.hasHalo){const yi=zi.uniformValues;yi.u_is_halo=1,Eh(zi.buffers,an.segments,a,d,zi.program,Pt,v,x,yi,2),yi.u_is_halo=0}else{if(zi.isSDF){const yi=zi.uniformValues;zi.hasHalo&&(yi.u_is_halo=1,Eh(zi.buffers,an.segments,a,d,zi.program,Pt,v,x,yi,1)),yi.u_is_halo=0}Eh(zi.buffers,an.segments,a,d,zi.program,Pt,v,x,zi.uniformValues,1)}}}function Eh(d,i,a,f,v,x,T,I,F,V){const j=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer];v.draw(f,f.context.gl.TRIANGLES,x,T,I,rr.disabled,F,a.id,d.layoutVertexBuffer,d.indexBuffer,i,a.paint,f.transform.zoom,d.programConfigurations.get(a.id),j,V)}function ol(d,i,a,f,v,x,T){const I=d.context.gl,F=a.paint.get("fill-pattern"),V=a.is3D(),j=V?d.stencilModeFor3D():br.disabled,Z=F&&F.constantOr(1);let X,Q,le,se,me;T?(Q=Z&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",X=I.LINES):(Q=Z?"fillPattern":"fill",X=I.TRIANGLES);for(const fe of f){const De=i.getTile(fe);if(Z&&!De.patternsLoaded())continue;const ke=De.getBucket(a);if(!ke)continue;d.prepareDrawTile();const Ne=ke.programConfigurations.get(a.id),tt=d.isTileAffectedByFog(fe),He=d.getOrCreateProgram(Q,{config:Ne,overrideFog:tt});Z&&(d.context.activeTexture.set(I.TEXTURE0),De.imageAtlasTexture&&De.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Ne.updatePaintBuffers());const We=F.constantOr(null);if(We&&De.imageAtlas){const gt=De.imageAtlas,Jt=r.A.from(We).getPrimary().scaleSelf(r.q.devicePixelRatio).serialize(),jt=gt.patternPositions[Jt];jt&&Ne.setConstantPatternPositions(jt)}const je=d.translatePosMatrix(fe.projMatrix,De,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),at=a.paint.get("fill-emissive-strength");if(T){se=ke.indexBuffer2,me=ke.segments2;const gt=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];le=Q==="fillOutlinePattern"&&Z?Up(je,at,d,De,gt):oc(je,at,gt)}else se=ke.indexBuffer,me=ke.segments,le=Z?Vc(je,at,d,De):bh(je,at);d.uploadCommonUniforms(d.context,He,fe.toUnwrapped()),He.draw(d,X,v,V?j:d.stencilModeForClipping(fe),x,rr.disabled,le,a.id,ke.layoutVertexBuffer,se,me,a.paint,d.transform.zoom,Ne,void 0)}}function Ah(d,i,a,f,v,x,T,I){a.resetLayerRenderingStats(d);const F=d.context,V=F.gl,j=d.transform,Z=a.paint.get("fill-extrusion-pattern"),X=Z.constantOr(1),Q=a.paint.get("fill-extrusion-opacity"),le=d.style.enable3dLights(),se=a.paint.get(le&&!X?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),me=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),se],fe=a.layout.get("fill-extrusion-edge-radius"),De=fe>0&&!a.paint.get("fill-extrusion-rounded-roof"),ke=De?0:fe,Ne=j.projection.name==="globe"?r.d3():0,tt=j.projection.name==="globe",He=tt?r.ae(j.zoom):0,We=[r.at(j.center.lng),r.aA(j.center.lat)],je=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",at=a.paint.get("fill-extrusion-flood-light-color").toRenderColor(je?null:a.lut).toArray01().slice(0,3),gt=a.paint.get("fill-extrusion-flood-light-intensity"),Jt=a.paint.get("fill-extrusion-vertical-scale"),jt=a.paint.get("fill-extrusion-line-width").constantOr(1)!==0,fi=a.paint.get("fill-extrusion-height-alignment"),ui=a.paint.get("fill-extrusion-base-alignment"),Pt=yc(d,a.paint.get("fill-extrusion-cutoff-fade-range")),Kt=[];let Ii;tt&&Kt.push("PROJECTION_GLOBE_VIEW"),me[0]>0&&Kt.push("FAUX_AO"),De&&Kt.push("ZERO_ROOF_RADIUS"),I&&Kt.push("HAS_CENTROID"),gt>0&&Kt.push("FLOOD_LIGHT"),Pt.shouldRenderCutoff&&Kt.push("RENDER_CUTOFF"),jt&&Kt.push("RENDER_WALL_MODE");const Et=d.renderPass==="shadow",hi=d.shadowRenderer,si=Et&&!!hi;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let an=[0,0,0];if(hi){const Hi=d.style.directionalLight,en=d.style.ambientLight;Hi&&en&&(an=qf(d.style,Hi,en)),Et||(Kt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),hi.useNormalOffset&&Kt.push("NORMAL_OFFSET")),Ii=Kt.concat(["SHADOWS_SINGLE_CASCADE"])}const zi=si?"fillExtrusionDepth":X?"fillExtrusionPattern":"fillExtrusion",yi=a.getLayerRenderingStats();for(const Hi of f){const en=i.getTile(Hi),bn=en.getBucket(a);if(!bn||bn.projection.name!==j.projection.name)continue;let Un=!1;hi&&(Un=hi.getMaxCascadeForTile(Hi.toUnwrapped())===0);const fr=d.isTileAffectedByFog(Hi),ur=bn.programConfigurations.get(a.id),lr=d.getOrCreateProgram(zi,{config:ur,defines:Un?Ii:Kt,overrideFog:fr});if(d.terrain&&d.terrain.setupElevationDraw(en,lr,{useMeterToDem:!0}),!bn.centroidVertexBuffer){const ba=lr.attributes.a_centroid_pos;ba!==void 0&&V.vertexAttrib2f(ba,0,0)}!Et&&hi&&hi.setupShadows(en.tileID.toUnwrapped(),lr,"vector-tile",en.tileID.overscaledZ),X&&(d.context.activeTexture.set(V.TEXTURE0),en.imageAtlasTexture&&en.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),ur.updatePaintBuffers());const wr=Z.constantOr(null);if(wr&&en.imageAtlas){const ba=en.imageAtlas,In=r.A.from(wr).getPrimary().scaleSelf(r.q.devicePixelRatio),_r=ba.patternPositions[In.serialize()];_r&&ur.setConstantPatternPositions(_r)}const Tr=a.paint.get("fill-extrusion-vertical-gradient"),za=1/bn.tileToMeter;let Ss;if(Et&&hi){if(Hc(en.tileID,bn,d))continue;const ba=hi.calculateShadowPassMatrixFromTile(en.tileID.toUnwrapped());Ss=ou(ba,ke,za,Jt,fi,ui)}else{const ba=d.translatePosMatrix(Hi.expandedProjMatrix,en,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),In=j.projection.createInversionMatrix(j,Hi.canonical);Ss=X?Ud(ba,d,Tr,Q,me,ke,za,Hi,en,Ne,fi,ui,He,We,In,at,Jt):sc(ba,d,Tr,Q,me,ke,za,Hi,Ne,fi,ui,He,We,In,at,Jt,gt,an)}d.uploadCommonUniforms(F,lr,Hi.toUnwrapped(),null,Pt);let qa=bn.segments;if(j.projection.name==="mercator"&&!Et&&(qa=bn.getVisibleSegments(en.tileID,d.terrain,d.transform.getFrustum(0)),!qa.get().length))continue;if(yi)if(Et)for(const ba of qa.get())yi.numRenderedVerticesInShadowPass+=ba.primitiveLength;else for(const ba of qa.get())yi.numRenderedVerticesInTransparentPass+=ba.primitiveLength;const Pr=[];(d.terrain||I)&&Pr.push(bn.centroidVertexBuffer),tt&&Pr.push(bn.layoutVertexExtBuffer),jt&&Pr.push(bn.wallVertexBuffer),lr.draw(d,F.gl.TRIANGLES,v,x,T,rr.backCCW,Ss,a.id,bn.layoutVertexBuffer,bn.indexBuffer,qa,a.paint,d.transform.zoom,ur,Pr)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}function cu(d,i,a,f,v,x,T,I,F,V,j,Z,X,Q,le,se,me,fe,De){const ke=d.context,Ne=ke.gl,tt=d.transform,He=d.transform.zoom,We=[],je=yc(d,a.paint.get("fill-extrusion-cutoff-fade-range"));V==="clear"?(We.push("CLEAR_SUBPASS"),De&&(We.push("CLEAR_FROM_TEXTURE"),ke.activeTexture.set(Ne.TEXTURE0),De.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE))):V==="sdf"&&We.push("SDF_SUBPASS"),me&&We.push("HAS_CENTROID"),je.shouldRenderCutoff&&We.push("RENDER_CUTOFF");const at=a.layout.get("fill-extrusion-edge-radius"),gt=(Jt,jt,fi,ui,Pt)=>{const Kt=jt.programConfigurations.get(a.id),Ii=d.isTileAffectedByFog(Jt),Et=d.getOrCreateProgram("fillExtrusionGroundEffect",{config:Kt,defines:We,overrideFog:Ii}),hi=((an,zi,yi,Hi,en,bn,Un,fr,ur,lr,wr)=>({u_matrix:zi,u_opacity:yi,u_ao_pass:Hi?1:0,u_meter_to_tile:en,u_ao:bn,u_flood_light_intensity:Un,u_flood_light_color:fr,u_attenuation:ur,u_edge_radius:lr,u_fb:0,u_fb_size:wr,u_dynamic_offset:1}))(0,ui,j,F,Pt,[Z,X*Pt],Q,le,se,He>=17?0:at*Pt,De?De.size[0]:0),si=[];me&&si.push(jt.hiddenByLandmarkVertexBuffer),d.uploadCommonUniforms(ke,Et,Jt.toUnwrapped(),null,je),Et.draw(d,ke.gl.TRIANGLES,v,x,T,I,hi,a.id,jt.vertexBuffer,jt.indexBuffer,fi,a.paint,He,Kt,si)};for(const Jt of f){const jt=i.getTile(Jt),fi=jt.getBucket(a);if(!fi||fi.projection.name!==tt.projection.name||!fi.groundEffect||fi.groundEffect&&!fi.groundEffect.hasData())continue;const ui=fi.groundEffect,Pt=1/fi.tileToMeter;{const Kt=d.translatePosMatrix(Jt.projMatrix,jt,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ii=ui.getDefaultSegment();gt(Jt,ui,Ii,Kt,Pt)}if(fe)for(let Kt=0;Kt<4;Kt++){const Ii=r.d4[Kt](Jt),Et=i.getTile(Ii);if(!Et)continue;const hi=Et.getBucket(a);if(!hi||hi.projection.name!==tt.projection.name||!hi.groundEffect||hi.groundEffect&&!hi.groundEffect.hasData())continue;const si=hi.groundEffect;let an,zi;Kt===0?(an=[-r.ag,0,0],zi=1):Kt===1?(an=[r.ag,0,0],zi=0):Kt===2?(an=[0,-r.ag,0],zi=3):(an=[0,r.ag,0],zi=2);const yi=si.regionSegments[zi];if(!yi)continue;const Hi=new Float32Array(16);r.ab.mat4.translate(Hi,Jt.projMatrix,an),gt(Jt,si,yi,d.translatePosMatrix(Hi,jt,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Pt)}}}function Ch(d,i,a,f,v,x,T){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();const I=x?x.findDEMTileFor(a):null;if(!(I&&I.dem||T))return;x&&I&&I.dem&&f.selfDEMTileTimestamp!==I.dem._timestamp&&(f.borderDoneWithNeighborZ=[-1,-1,-1,-1],f.selfDEMTileTimestamp=I.dem._timestamp);const F=fe=>new r.P(Math.ceil((fe+r.d7)*r.d8),0),V=fe=>{const De=i.getSource().minzoom,ke=tt=>{const He=i.getTileByID(tt);if(He&&He.hasData())return He.getBucket(v)},Ne=[0,-1,1];for(const tt of Ne){if(fe.overscaledZ+tt<De)continue;const He=ke(fe.calculateScaledKey(fe.overscaledZ+tt));if(He)return He}},j=[0,0,0],Z=(fe,De)=>(j[0]=Math.min(fe.min.y,De.min.y),j[1]=Math.max(fe.max.y,De.max.y),j[2]=r.ag-De.min.x>fe.max.x?De.min.x-r.ag:fe.max.x,j),X=(fe,De)=>(j[0]=Math.min(fe.min.x,De.min.x),j[1]=Math.max(fe.max.x,De.max.x),j[2]=r.ag-De.min.y>fe.max.y?De.min.y-r.ag:fe.max.y,j),Q=[(fe,De)=>Z(fe,De),(fe,De)=>Z(De,fe),(fe,De)=>X(fe,De),(fe,De)=>X(De,fe)],le=(fe,De,ke,Ne,tt,He,We)=>{if(!x)return 0;const je=[[He?ke:fe,He?fe:ke,0],[He?ke:De,He?De:ke,0]],at=We<0?r.ag+We:We,gt=[He?at:(fe+De)/2,He?(fe+De)/2:at,0];return ke===0&&We<0||ke!==0&&We>0?x.getForTilePoints(tt,[gt],!0,Ne):je.push(gt),x.getForTilePoints(a,je,!0,I),Math.max(je[0][2],je[1][2],gt[2])/x.exaggeration()};for(let fe=0;fe<4;fe++){const De=f.borderFeatureIndices[fe];if(De.length===0)continue;const ke=r.d4[fe](a),Ne=V(ke);if(!(Ne&&Ne instanceof r.d5))continue;const tt=x?x.findDEMTileFor(ke):null;if(!(tt&&tt.dem||T)||(x&&tt&&tt.dem&&f.borderDEMTileTimestamp[fe]!==tt.dem._timestamp&&(f.borderDoneWithNeighborZ[fe]=-1,f.borderDEMTileTimestamp[fe]=tt.dem._timestamp),f.borderDoneWithNeighborZ[fe]===Ne.canonical.z))continue;Ne.centroidVertexArray.length===0&&Ne.createCentroidsBuffer();const He=(fe<2?1:5)-fe,We=Ne.borderDoneWithNeighborZ[He]!==f.canonical.z,je=Ne.borderFeatureIndices[He];let at=0;if(f.canonical.z!==Ne.canonical.z){for(const gt of De)f.showCentroid(f.featuresOnBorder[gt]);if(We)for(const gt of je)Ne.showCentroid(Ne.featuresOnBorder[gt]);f.borderDoneWithNeighborZ[fe]=Ne.canonical.z,Ne.borderDoneWithNeighborZ[He]=f.canonical.z}for(const gt of De){const Jt=f.featuresOnBorder[gt],jt=f.centroidData[Jt.centroidDataIndex],fi=Jt.borders[fe];let ui;for(;at<je.length;){ui=Ne.featuresOnBorder[je[at]];const Pt=ui.borders[He];if(Pt[1]>fi[0]+3||Pt[0]>fi[0]-3)break;Ne.showCentroid(ui),at++}if(ui&&at<je.length){const Pt=at;let Kt=0;for(;!(ui.borders[He][0]>fi[1]-3)&&(Kt++,++at!==je.length);)ui=Ne.featuresOnBorder[je[at]];ui=Ne.featuresOnBorder[je[Pt]];let Ii=!1;if(Kt>=1){const si=ui.borders[He];Math.abs(fi[0]-si[0])<3&&Math.abs(fi[1]-si[1])<3&&(Kt=1,Ii=!0,at=Pt+1)}else if(Kt===0){f.showCentroid(Jt);continue}const Et=Ne.centroidData[ui.centroidDataIndex];T&&Ii&&(((se=jt).flags|(me=Et).flags)&r.d6?(se.flags|=r.d6,me.flags|=r.d6):(se.flags&=~r.d6,me.flags&=~r.d6));const hi=Jt.intersectsCount()>1||ui.intersectsCount()>1;if(Kt>1)at=Pt,jt.centroidXY=Et.centroidXY=new r.P(0,0);else if(tt&&tt.dem&&!hi){const si=Q[fe](jt,Et),an=fe%2?r.ag-1:0,zi=le(si[0],Math.min(r.ag-1,si[1]),an,tt,ke,fe<2,si[2]);jt.centroidXY=Et.centroidXY=F(zi)}else hi?jt.centroidXY=Et.centroidXY=new r.P(0,0):(jt.centroidXY=f.encodeBorderCentroid(Jt),Et.centroidXY=Ne.encodeBorderCentroid(ui));f.writeCentroidToBuffer(jt),Ne.writeCentroidToBuffer(Et)}else f.showCentroid(Jt)}f.borderDoneWithNeighborZ[fe]=Ne.canonical.z,Ne.borderDoneWithNeighborZ[He]=f.canonical.z}var se,me;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(d)}const id=[1,0,0],Ri=[0,1,0],Pn=[0,0,1];function Hc(d,i,a){const f=a.transform,v=a.shadowRenderer;if(!v)return!0;const x=d.toUnwrapped(),T=f.tileSize*v._cascades[a.currentShadowCascade].scale;let I=i.maxHeight;if(f.elevation){const se=f.elevation.getMinMaxForTile(d);se&&(I+=se.max)}const F=[...v.shadowDirection];F[2]=-F[2];const V=v.computeSimplifiedTileShadowVolume(x,I,T,F);if(!V)return!1;const j=[id,Ri,Pn,F,[F[0],0,F[2]],[0,F[1],F[2]]],Z=f.projection.name==="globe",X=f.scaleZoom(T),Q=r.bR.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,X,!Z),le=v.getCurrentCascadeFrustum();return Q.intersectsPrecise(V.vertices,V.planes,j)===0||le.intersectsPrecise(V.vertices,V.planes,j)===0}function ss(d){return[d[0]*r.d9,d[1]*r.d9,d[2]*r.d9,0]}function Ht(d,i,a,f,v,x,T,I,F){const V=f.getSource(),j=a.globeSharedBuffers;if(!j)return;let Z,X,Q;if(i&&(Z=f.getTile(i)),V instanceof r.aJ?(X=V.texture,Q=r.cI(0,0,a.transform)):Z&&i&&(X=Z.texture,Q=r.cI(i.canonical.z,i.canonical.x,a.transform)),!X||!Q)return;d||(Q=r.ab.mat4.scale(r.ab.mat4.create(),Q,[1,-1,1]));const le=a.context,se=le.gl,me=v.paint.get("raster-resampling")==="nearest"?se.NEAREST:se.LINEAR,fe=a.colorModeForDrapableLayerRenderPass(x),De=T.defines;De.push("GLOBE_POLES");const ke=new sr(se.LEQUAL,sr.ReadWrite,a.depthRangeFor3D),Ne=Float32Array.from(a.transform.expandedFarZProjMatrix),tt=Float32Array.from(r.bb(r.cH(new r.bT(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),le.activeTexture.set(se.TEXTURE0),X.bind(me,se.CLAMP_TO_EDGE),le.activeTexture.set(se.TEXTURE1),X.bind(me,se.CLAMP_TO_EDGE),X.useMipmap&&le.extTextureFilterAnisotropic&&a.transform.pitch>20&&se.texParameterf(se.TEXTURE_2D,le.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,le.extTextureFilterAnisotropicMax);const[He,We,je,at]=i?j.getPoleBuffers(i.canonical.z,!1):j.getPoleBuffers(0,!0),gt=v.paint.get("raster-elevation");let Jt;d?(Jt=He,a.renderDefaultNorthPole=gt!==0):(Jt=We,a.renderDefaultSouthPole=gt!==0);const jt=ss(T.mix),fi=((Pt,Kt,Ii,Et,hi,si,an,zi,yi,Hi,en,bn,Un)=>Vu(Pt,Kt,Ii,new Float32Array(16),new Float32Array(9),[0,0],Et,[0,0],[0,0,0,0],1,{opacity:1,mix:0},si,[0,0],zi,2,Hi,en,bn,1,0,Un))(Ne,tt,Q,r.ae(a.transform.zoom),0,v,0,gt,0,jt,T.offset,T.range,x),ui=a.getOrCreateProgram("raster",{defines:De});a.uploadCommonUniforms(le,ui,null),ui.draw(a,se.TRIANGLES,ke,F,fe,I,fi,v.id,Jt,je,at)}function uu(d){const i=d._nearZ,a=d.projection.farthestPixelDistance(d),f=a-i,v=.2*d.height,x=i+v;return[i,a,(x-v-i)/f,(x-i)/f]}function js(d,i,a,f){if(d)return i instanceof Ia&&d instanceof wi?i.getTextureDescriptor(d,a,!0):{texture:d.texture,mix:ss(f.mix),offset:f.offset,buffer:0,tileSize:1}}var hu=r.da([{name:"a_index",type:"Int16",components:1}]);class Wd{constructor(i,a,f,v){const x={width:f[0],height:f[1],data:null},T=i.gl;this.targetColorTexture=new r.T(i,x,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(i,x,T.RGBA8,{useMipmap:!1}),this.context=i,this.updateParticleTexture(a,v),this.lastInvalidatedAt=0}updateParticleTexture(i,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const f=this.context.gl,v=a.width*a.height;this.particleTexture0=new r.T(this.context,a,f.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,a,f.RGBA8,{premultiply:!1,useMipmap:!1});const x=new r.db;x.reserve(v);for(let T=0;T<v;T++)x.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(x,hu.members,!0),this.particleSegment=r.b7.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=r.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Lh(d,i,a){if(!d)return null;const f=i.getTextureDescriptor(d,a,!0);if(!f)return null;let{texture:v,mix:x,offset:T,tileSize:I,buffer:F,format:V}=f;if(!v||!V)return null;let j=!1;return V==="uint32"&&(j=!0,x[3]=0,x=xf(r.dc,x,[0,a.paint.get("raster-particle-max-speed")]),T=wh(r.dc,T,[0,a.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[F/(I+2*F),I/(I+2*F)],tileSize:I,scalarData:j,scale:x,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[V]]}}function nd(d){const i=d._nearZ,a=d.projection.farthestPixelDistance(d),f=a-i,v=.2*d.height,x=i+v;return[i,a,(x-v-i)/f,(x-i)/f]}const lc=new r.aj(1,0,0,1),rd=new r.aj(0,1,0,1),ad=new r.aj(0,0,1,1),sd=new r.aj(1,0,1,1),Zd=new r.aj(0,1,1,1);function Mc(d,i,a,f,v,x,T){const I=d.context,F=d.transform,V=I.gl,j=F.projection.name==="globe",Z=j?["PROJECTION_GLOBE_VIEW"]:[];let X=r.ab.mat4.clone(a.projMatrix);if(j&&r.ae(F.zoom)>0){const jt=r.ba(a.canonical,F),fi=r.dd(jt);X=r.ab.mat4.multiply(new Float32Array(16),F.globeMatrix,fi),r.ab.mat4.multiply(X,F.projMatrix,X)}const Q=r.ab.mat4.create();Q[12]+=2*v/(r.q.devicePixelRatio*F.width),Q[13]+=2*x/(r.q.devicePixelRatio*F.height),r.ab.mat4.multiply(X,Q,X);const le=d.getOrCreateProgram("debug",{defines:Z}),se=i.getTileByID(a.key);d.terrain&&d.terrain.setupElevationDraw(se,le);const me=sr.disabled,fe=br.disabled,De=d.colorModeForRenderPass(),ke="$debug";I.activeTexture.set(V.TEXTURE0),d.emptyTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),j?se._makeGlobeTileDebugBuffers(d.context,F):se._makeDebugTileBoundsBuffers(d.context,F.projection);const Ne=se._tileDebugBuffer||d.debugBuffer,tt=se._tileDebugIndexBuffer||d.debugIndexBuffer,He=se._tileDebugSegments||d.debugSegments;if(le.draw(d,V.LINE_STRIP,me,fe,De,rr.disabled,Gc(X,f),ke,Ne,tt,He,null,null,null,[se._globeTileDebugBorderBuffer]),T){const jt=se.latestRawTileData,fi=Math.floor((jt&&jt.byteLength||0)/1024);let ui=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(ui+=` => ${a.overscaledZ}`),ui+=` ${se.state}`,ui+=` ${fi}kb`,function(Pt,Kt){Pt.initDebugOverlayCanvas();const Ii=Pt.debugOverlayCanvas,Et=Pt.context.gl,hi=Pt.debugOverlayCanvas.getContext("2d");hi.clearRect(0,0,Ii.width,Ii.height),hi.shadowColor="white",hi.shadowBlur=2,hi.lineWidth=1.5,hi.strokeStyle="white",hi.textBaseline="top",hi.font="bold 36px Open Sans, sans-serif",hi.fillText(Kt,5,5),hi.strokeText(Kt,5,5),Pt.debugOverlayTexture.update(Ii),Pt.debugOverlayTexture.bind(Et.LINEAR,Et.CLAMP_TO_EDGE)}(d,ui)}const We=i.getTile(a).tileSize,je=512/Math.min(We,512)*(a.overscaledZ/F.zoom)*.5,at=se._tileDebugTextBuffer||d.debugBuffer,gt=se._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,Jt=se._tileDebugTextSegments||d.debugSegments;le.draw(d,V.TRIANGLES,me,fe,Fr.alphaBlended,rr.disabled,Gc(X,r.aj.transparent,je),ke,at,gt,Jt,null,null,null,[se._globeTileDebugTextBuffer])}function od(d,i,a,f){cc(d,0,i+a/2,d.transform.width,a,f)}function ld(d,i,a,f){cc(d,i-a/2,0,a,d.transform.height,f)}function cc(d,i,a,f,v,x){const T=d.context,I=T.gl;I.enable(I.SCISSOR_TEST),I.scissor(i*r.q.devicePixelRatio,a*r.q.devicePixelRatio,f*r.q.devicePixelRatio,v*r.q.devicePixelRatio),T.clear({color:x}),I.disable(I.SCISSOR_TEST)}const cd=r.da([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ql}=cd;function Il(d,i,a,f){d.emplaceBack(i,a,f)}class Xd{constructor(i){this.vertexArray=new r.de,this.indices=new r.aU,Il(this.vertexArray,-1,-1,1),Il(this.vertexArray,1,-1,1),Il(this.vertexArray,-1,1,1),Il(this.vertexArray,1,1,1),Il(this.vertexArray,-1,-1,-1),Il(this.vertexArray,1,-1,-1),Il(this.vertexArray,-1,1,-1),Il(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,ql),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=r.b7.simpleSegment(0,0,36,12)}}function qs(d,i,a,f,v,x){const T=d.context.gl,I=i.paint.get("sky-atmosphere-color"),F=i.paint.get("sky-atmosphere-halo-color"),V=i.paint.get("sky-atmosphere-sun-intensity"),j=((Z,X,Q,le,se)=>({u_matrix_3f:Z,u_sun_direction:X,u_sun_intensity:Q,u_color_tint_r:[le.r,le.g,le.b,le.a],u_color_tint_m:[se.r,se.g,se.b,se.a],u_luminance:5e-5}))(r.ab.mat3.fromMat4(r.ab.mat3.create(),f),v,V,I,F);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+x,i.skyboxTexture,0),a.draw(d,T.TRIANGLES,sr.disabled,br.disabled,Fr.unblended,rr.frontCW,j,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const xp=r.da([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ud{constructor(i){const a=new r.df;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const f=new r.aU;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(a,xp.members),this.indexBuffer=i.createIndexBuffer(f),this.segments=r.b7.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ts=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Ta{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Mf{constructor(i){this.colorModeAlphaBlendedWriteRGB=new Fr([1,Sl,1,Sl],r.aj.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Fr([1,0,1,0],r.aj.transparent,[!1,!1,!1,!0]),this.params=new Ta,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){const a=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ud(a);const f=this.params.sizeRange,v=this.params.intensityRange,x=function(j){const Z=r.di(30),X=[];for(let Q=0;Q<j;++Q){const le=2*Math.PI*Z(),se=Math.acos(1-2*Z())-.5*Math.PI;X.push(r.ab.vec3.fromValues(Math.cos(se)*Math.cos(le),Math.cos(se)*Math.sin(le),Math.sin(se)))}return X}(this.params.starsCount),T=r.di(300),I=new r.dg,F=new r.aU;let V=0;for(let j=0;j<x.length;++j){const Z=r.ab.vec3.scale([],x[j],200),X=Math.max(0,1+.01*f*(1*T()-.5)),Q=Math.max(0,1+.01*v*(1*T()-.5));I.emplaceBack(Z[0],Z[1],Z[2],-1,-1,X,Q),I.emplaceBack(Z[0],Z[1],Z[2],1,-1,X,Q),I.emplaceBack(Z[0],Z[1],Z[2],1,1,X,Q),I.emplaceBack(Z[0],Z[1],Z[2],-1,1,X,Q),F.emplaceBack(V+0,V+1,V+2),F.emplaceBack(V+0,V+2,V+3),V+=4}this.starsVx=a.createVertexBuffer(I,ts.members),this.starsIdx=a.createIndexBuffer(F),this.starsSegments=r.b7.simpleSegment(0,0,I.length,F.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,a){const f=i.context,v=f.gl,x=i.transform,T=new sr(v.LEQUAL,sr.ReadOnly,[0,1]),I=r.ae(x.zoom),F=i.style.getLut(a.scope),V=a.properties.get("color-use-theme")==="none",j=a.properties.get("color").toRenderColor(V?null:F).toArray01(),Z=a.properties.get("high-color-use-theme")==="none",X=a.properties.get("high-color").toRenderColor(Z?null:F).toArray01(),Q=a.properties.get("space-color-use-theme")==="none",le=a.properties.get("space-color").toRenderColor(Q?null:F).toArray01PremultipliedAlpha(),se=5e-4,me=r.dh(a.properties.get("horizon-blend"),0,1,se,.25),fe=r.cC(i,f,x)&&me===se?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,De=i.frameCounter/1e3%1,ke=r.ab.vec3.length(x.globeCenterInViewSpace),Ne=Math.sqrt(Math.pow(ke,2)-Math.pow(fe,2)),tt=Math.acos(Ne/ke),He=We=>{const je=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];We&&je.push("ALPHA_PASS");const at=i.getOrCreateProgram("globeAtmosphere",{defines:je}),gt=((jt,fi,ui,Pt,Kt,Ii,Et,hi,si,an,zi,yi)=>({u_frustum_tl:jt,u_frustum_tr:fi,u_frustum_br:ui,u_frustum_bl:Pt,u_horizon:Kt,u_transition:Ii,u_fadeout_range:Et,u_color:hi,u_high_color:si,u_space_color:an,u_temporal_offset:zi,u_horizon_angle:yi}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,I,me,j,X,le,De,tt);i.uploadCommonUniforms(f,at);const Jt=this.atmosphereBuffer;Jt&&at.draw(i,v.TRIANGLES,T,br.disabled,We?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,rr.backCW,gt,We?"atmosphere_glow_alpha":"atmosphere_glow",Jt.vertexBuffer,Jt.indexBuffer,Jt.segments)};He(!1),He(!0)}drawStars(i,a){const f=r.aw(a.properties.get("star-intensity"),0,1);if(f===0)return;const v=i.context,x=v.gl,T=i.transform,I=i.getOrCreateProgram("stars"),F=r.ab.quat.identity([]);r.ab.quat.rotateX(F,F,-T._pitch),r.ab.quat.rotateZ(F,F,-T.angle),r.ab.quat.rotateX(F,F,r.ai(T._center.lat)),r.ab.quat.rotateY(F,F,-r.ai(T._center.lng));const V=r.ab.mat4.fromQuat(new Float32Array(16),F),j=r.ab.mat4.multiply([],T.starsProjMatrix,V),Z=r.ab.mat3.fromMat4([],V),X=r.ab.mat3.invert([],Z),Q=[0,1,0];r.ab.vec3.transformMat3(Q,Q,X),r.ab.vec3.scale(Q,Q,this.params.sizeMultiplier);const le=[1,0,0];r.ab.vec3.transformMat3(le,le,X),r.ab.vec3.scale(le,le,this.params.sizeMultiplier);const se=(me=Q,fe=le,De=f,{u_matrix:Float32Array.from(j),u_up:me,u_right:fe,u_intensity_multiplier:De});var me,fe,De;i.uploadCommonUniforms(v,I),this.starsVx&&this.starsIdx&&I.draw(i,x.TRIANGLES,sr.disabled,br.disabled,this.colorModeAlphaBlendedWriteRGB,rr.disabled,se,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function du(d,i){const a=[...d],f=i.cameraWorldSizeForFog/i.worldSize,v=r.ab.mat4.identity([]);return r.ab.mat4.scale(v,v,[f,f,1]),r.ab.mat4.multiply(a,v,a),r.ab.mat4.multiply(a,i.worldToFogMatrix,a),a}function Rh(d,i,a,f,v){const x=a.material,T=f.context,{baseColorTexture:I,metallicRoughnessTexture:F}=x.pbrMetallicRoughness,{normalTexture:V,occlusionTexture:j,emissionTexture:Z}=x;function X(le,se,me){if(le&&(d.push(se),T.activeTexture.set(T.gl.TEXTURE0+me),le.gfxTexture)){const{minFilter:fe,magFilter:De,wrapS:ke,wrapT:Ne}=le.sampler;le.gfxTexture.bindExtraParam(fe,De,ke,Ne)}}X(I,"HAS_TEXTURE_u_baseColorTexture",bo.BaseColor),X(F,"HAS_TEXTURE_u_metallicRoughnessTexture",bo.MetallicRoughness),X(V,"HAS_TEXTURE_u_normalTexture",bo.Normal),X(j,"HAS_TEXTURE_u_occlusionTexture",bo.Occlusion),X(Z,"HAS_TEXTURE_u_emissionTexture",bo.Emission),v&&(v.texture||(v.texture=new r.dk(f.context,v.image,[v.image.height,v.image.height,v.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+bo.LUT),v.texture&&v.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),d.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(a.texcoordBuffer)),a.colorBuffer&&(d.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(a.colorBuffer)),a.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(a.normalBuffer)),a.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(a.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||d.push("DIFFUSE_SHADED");const Q=f.shadowRenderer;Q&&(d.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Q.useNormalOffset&&d.push("NORMAL_OFFSET"))}function Wl(d,i,a,f,v,x){const T=a.paint.get("model-opacity").constantOr(1),I=i.context,F=new sr(i.context.gl.LEQUAL,sr.ReadWrite,i.depthRangeFor3D),V=i.transform,j=d.mesh,Z=j.material,X=Z.pbrMetallicRoughness,Q=i.style.fog;let le;le=i.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:r.ab.mat4.multiply([],f.zScaleMatrix,d.nodeModelMatrix),r.ab.mat4.multiply(le,f.negCameraPosMatrix,le);const se=r.ab.mat4.invert([],le);r.ab.mat4.transpose(se,se);const me=a.paint.get("model-color-use-theme").constantOr("default")==="none",fe=a.paint.get("model-emissive-strength").constantOr(0),De=jd(new Float32Array(d.worldViewProjection),new Float32Array(le),new Float32Array(se),null,i,T,X.baseColorFactor.toRenderColor(null),Z.emissiveFactor,X.metallicFactor,X.roughnessFactor,Z,fe,a),ke={defines:[]},Ne=[],tt=i.shadowRenderer;tt&&(tt.useNormalOffset=!1),Rh(ke.defines,Ne,j,i,me?null:a.lut);let He=null;if(Q){const at=du(d.nodeModelMatrix,i.transform);if(He=new Float32Array(at),V.projection.name!=="globe"){const gt=j.aabb.min,Jt=j.aabb.max,[jt,fi]=Q.getOpacityForBounds(at,gt[0],gt[1],Jt[0],Jt[1]);ke.overrideFog=jt>=Qe||fi>=Qe}}const We=yc(i,a.paint.get("model-cutoff-fade-range"));We.shouldRenderCutoff&&ke.defines.push("RENDER_CUTOFF");const je=i.getOrCreateProgram("model",ke);i.uploadCommonUniforms(I,je,null,He,We),i.renderPass!=="shadow"&&tt&&tt.setupShadowsFromMatrix(d.nodeModelMatrix,je),je.draw(i,I.gl.TRIANGLES,F,v,x,j.material.doubleSided?rr.disabled:rr.backCCW,De,a.id,j.vertexBuffer,j.indexBuffer,j.segments,a.paint,i.transform.zoom,void 0,Ne)}function Ih(d,i,a,f,v,x,T){let I;I=d.projection.name==="globe"?r.dl(a,d):[...a],r.ab.mat4.multiply(I,I,i.matrix);const F=r.ab.mat4.multiply([],f,I);if(i.meshes)for(const V of i.meshes){if(V.material.alphaMode!=="BLEND"){T.push({mesh:V,depth:0,modelIndex:v,worldViewProjection:F,nodeModelMatrix:I});continue}const j=r.ab.vec3.transformMat4([],V.centroid,F);!d.isOrthographic&&j[2]<=0||x.push({mesh:V,depth:j[2],modelIndex:v,worldViewProjection:F,nodeModelMatrix:I})}if(i.children)for(const V of i.children)Ih(d,V,a,f,v,x,T)}function Tc(d,i,a,f){const v=a.shadowRenderer;if(!v)return;const x=v.getShadowPassDepthMode(),T=v.getShadowPassColorMode(),I=v.calculateShadowPassMatrixFromMatrix(i),F=Hs(I);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,x,br.disabled,T,rr.backCCW,F,f.id,d.vertexBuffer,d.indexBuffer,d.segments,f.paint,a.transform.zoom,void 0,void 0)}function jc(d,i,a){const f=i.updateZoomBasedPaintProperties(),v=function(x,T,I){let F,V,j,Z=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&Z>0){const X=x.terrain,Q=X.findDEMTileFor(I);Q&&Q.dem?F=r.dn.create(X,I,Q):Z=0}if(Z===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),Z===T.validForExaggeration&&(Z===0||F&&F._demTile&&F._demTile.tileID===T.validForDEMTile.id&&F._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const X in T.instancesPerModel){const Q=T.instancesPerModel[X];for(let le=0;le<Q.instancedDataArray.length;++le){const se=(F?Z*F.getElevationAt(0|Q.instancedDataArray.float32[16*le],0|Q.instancedDataArray.float32[16*le+1],!0,!0):0)+Q.instancesEvaluatedElevation[le];Q.instancedDataArray.float32[16*le+6]=se,V=V?Math.min(T.terrainElevationMin,se):se,j=j?Math.max(T.terrainElevationMax,se):se}}return T.terrainElevationMin=V||0,T.terrainElevationMax=j||0,T.validForExaggeration=Z,T.validForDEMTile=F&&F._demTile?{id:F._demTile.tileID,timestamp:F._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,i,a);(f||v)&&(i.uploaded=!1,i.upload(d.context))}const Fo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.cd([0,0,0],[r.ag,r.ag,0])};function Dh(d,i){const a=1<<d.canonical.z,f=i.getFreeCameraOptions().position,v=i.elevation,x=d.canonical.x/a,T=(d.canonical.x+1)/a,I=d.canonical.y/a,F=(d.canonical.y+1)/a;let V=i._centerAltitude;if(v){const Q=v.getMinMaxForTile(d);Q&&Q.max>V&&(V=Q.max)}const j=r.aw(f.x,x,T)-f.x,Z=r.aw(f.y,I,F)-f.y,X=r.bH(V,i.center.lat)-f.z;return i._zoomFromMercatorZ(Math.sqrt(j*j+Z*Z+X*X))}function Sc(d,i,a,f,v,x,T){const I=d.context,F=d.renderPass==="shadow",V=d.shadowRenderer,j=F&&V?V.getShadowPassDepthMode():new sr(I.gl.LEQUAL,sr.ReadWrite,d.depthRangeFor3D),Z=d.isTileAffectedByFog(x);if(a.meshes)for(const X of a.meshes){const Q=["MODEL_POSITION_ON_GPU"],le=[];let se,me,fe;f.instancedDataArray.length>20&&Q.push("INSTANCED_ARRAYS");const De=yc(d,i.paint.get("model-cutoff-fade-range"));if(De.shouldRenderCutoff&&Q.push("RENDER_CUTOFF"),F&&V)se=d.getOrCreateProgram("modelDepth",{defines:Q}),me=Hs(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(a.matrix)),fe=V.getShadowPassColorMode();else{Rh(Q,le,X,d,i.paint.get("model-color-use-theme").constantOr("default")==="none"?null:i.lut),se=d.getOrCreateProgram("model",{defines:Q,overrideFog:Z});const Ne=X.material,tt=Ne.pbrMetallicRoughness,He=i.paint.get("model-opacity").constantOr(1),We=i.paint.get("model-emissive-strength").constantOr(0);me=jd(x.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),null,d,He,tt.baseColorFactor.toRenderColor(null),Ne.emissiveFactor,tt.metallicFactor,tt.roughnessFactor,Ne,We,i,v),V&&(T.shadowUniformsInitialized?se.setShadowUniformValues(I,V.getShadowUniformValues()):(V.setupShadows(x.toUnwrapped(),se,"model-tile",x.overscaledZ),T.shadowUniformsInitialized=!0)),fe=De.shouldRenderCutoff||He<1||Ne.alphaMode!=="OPAQUE"?Fr.alphaBlended:Fr.unblended}d.uploadCommonUniforms(I,se,x.toUnwrapped(),null,De);const ke=X.material.doubleSided?rr.disabled:rr.backCCW;if(f.instancedDataArray.length>20)le.push(f.instancedDataBuffer),se.draw(d,I.gl.TRIANGLES,j,br.disabled,fe,ke,me,i.id,X.vertexBuffer,X.indexBuffer,X.segments,i.paint,d.transform.zoom,void 0,le,f.instancedDataArray.length);else{const Ne=F?"u_instance":"u_normal_matrix";for(let tt=0;tt<f.instancedDataArray.length;++tt)me[Ne]=new Float32Array(f.instancedDataArray.arrayBuffer,64*tt,16),se.draw(d,I.gl.TRIANGLES,j,br.disabled,fe,ke,me,i.id,X.vertexBuffer,X.indexBuffer,X.segments,i.paint,d.transform.zoom,void 0,le)}}if(a.children)for(const X of a.children)Sc(d,i,X,f,v,x,T)}const Yd=[1,-1,1];function Tf(d,i,a,f){if(!a.modelManager)return!0;const v=a.modelManager;if(!a.shadowRenderer)return!0;const x=a.shadowRenderer,T=i.aabb;let I=!0,F=d.maxHeight;if(F===0){let j=0;for(const Z in d.instancesPerModel){const X=v.getModel(Z,f);X?j=Math.max(j,Math.max(Math.max(X.aabb.max[0],X.aabb.max[1]),X.aabb.max[2])):I=!1}F=d.maxScale*j*1.41+d.maxVerticalOffset,I&&(d.maxHeight=F)}T.max[2]=F,T.min[2]+=d.terrainElevationMin,T.max[2]+=d.terrainElevationMax,r.ab.vec3.transformMat4(T.min,T.min,i.tileMatrix),r.ab.vec3.transformMat4(T.max,T.max,i.tileMatrix);const V=T.intersects(x.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=V===2),V===0}function qc(d,i){const a=d.uniformValues.u_cutoff_params[0],f=d.uniformValues.u_cutoff_params[1],v=d.uniformValues.u_cutoff_params[2],x=d.uniformValues.u_cutoff_params[3];return f===a||x===v?1:r.aw(((i-a)/(f-a)-v)/(x-v),0,1)}function hd(d,i,a,f){if(i.pitch<20)return 1;const v=i.getWorldToCameraMatrix();r.ab.mat4.multiply(v,v,d);const x=r.ab.vec4.fromValues(a.min[0],a.min[1],a.min[2],1);let T=r.ab.vec4.transformMat4(r.ab.vec4.create(),x,v),I=T,F=T;x[1]=a.max[1],T=r.ab.vec4.transformMat4(r.ab.vec4.create(),x,v),I=T[1]<I[1]?T:I,F=T[1]>F[1]?T:F,x[0]=a.max[0],T=r.ab.vec4.transformMat4(r.ab.vec4.create(),x,v),I=T[1]<I[1]?T:I,F=T[1]>F[1]?T:F,x[1]=a.min[1],T=r.ab.vec4.transformMat4(r.ab.vec4.create(),x,v),I=T[1]<I[1]?T:I,F=T[1]>F[1]?T:F;const V=r.aw(f[0],0,1),j=100*i.pixelsPerMeter*r.aw(f[1],0,1),Z=r.aw(f[2],0,1),X=r.ab.vec4.lerp(r.ab.vec4.create(),I,F,V),Q=Math.tan(.5*i.fovX),le=-X[2]*Q;if(j===0)return X[1]<-Math.abs(le)?Z:1;const se=(-Math.abs(le)-X[1])/j,me=(De,ke,Ne)=>(1-Ne)*De+Ne*ke,fe=r.aw(me(1,Z,se),Z,1);return me(1,fe,r.aw((i.pitch-20)/20,0,1))}class fu{}class go{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,a,f){{const Z=this._storage.get(a.id);if(Z)return Z.lastUsedFrameIdx=i,Z.buf}const v=f.gl,x=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),T=new ArrayBuffer(x),I=new Int16Array(T);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const F=new r.dq;for(let Z=0;Z<x/2;Z+=3){const X=I[Z],Q=I[Z+1],le=I[Z+2];F.emplaceBack(X,Q),F.emplaceBack(Q,le),F.emplaceBack(le,X)}const V=f.bindVertexArrayOES.current,j=new fu;return j.buf=new wc(f,F),j.lastUsedFrameIdx=i,this._storage.set(a.id,j),f.bindVertexArrayOES.set(V),j.buf}update(i){for(const[a,f]of this._storage)i-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(a))}destroy(){for(const[i,a]of this._storage)a.buf.destroy(),this._storage.delete(i)}}class Wu{constructor(i){this.occluderSize=30,this.depthOffset=-1e-4,i.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),i.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const $d=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class dd{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class uo{constructor(i,a){this.revealStart=11,this.revealRange=2,i.registerParameter(this,[...a,"Reveal"],"revealStart",{min:0,max:17,step:.05}),i.registerParameter(this,[...a,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const fd=r.da([{type:"Float32",name:"a_pos_2f",components:2}]);class To{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(i,a){const f=i.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new r.dr,I=new r.aU;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),this.vignetteVx=i.context.createVertexBuffer(T,fd.members),this.vignetteIdx=i.context.createIndexBuffer(I)}const v=r.b7.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){i.uploadCommonUniforms(i.context,f);const T={u_vignetteShape:(x={vignetteShape:[a.start,a.range,Math.pow(10,a.fadePower)],vignetteColor:[a.color.r,a.color.g,a.color.b,a.color.a*a.strength]}).vignetteShape,u_vignetteColor:x.vignetteColor};f.draw(i,i.context.gl.TRIANGLES,sr.disabled,br.disabled,Fr.alphaBlended,rr.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,v,{})}var x}}class Ec{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(i,a){const f=i.getFreeCameraOptions().position,v=f.toAltitude(),x=f.toLngLat(),T=r.ai(x.lng),I=r.ai(x.lat),F=i.pixelsPerMeter/a,V=T*r.ds,j=r.ds*Math.log(Math.tan(Math.PI/4+I/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const Z=-this._offsetYPrev+j,X=-this._elevationPrev+v;this._accumulatedOffsetX+=(-this._offsetXPrev+V)*F,this._accumulatedOffsetY+=Z*F,this._accumulatedElevation+=X*F,this._offsetXPrev=V,this._offsetYPrev=j,this._elevationPrev=v}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function gl(d,i){return[-(d[0]-Math.floor(d[0]/i)*i),-(d[1]-Math.floor(d[1]/i)*i),-(d[2]-Math.floor(d[2]/i)*i)]}function to(d){const i=r.di(1323123451230),a=[];for(let f=0;f<d;++f){const v=2*i()-1,x=2*i()-1,T=2*i()-1;a.push(r.ab.vec3.fromValues(v,x,T))}return a}function Zl(d,i,a,f,v){const x=r.aw((v-a)/(f-a),0,1);return(1-x)*d+x*i}class Ac{constructor(i){this._movement=new Ec,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new To,this._ppmScaleFactor=i}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(i,a){const f=i.transform;this._movement.update(f,this._ppmScaleFactor);const v=f.starsProjMatrix,x=r.ab.quat.identity([]);r.ab.quat.rotateX(x,x,r.ai(90)-f._pitch),r.ab.quat.rotateZ(x,x,-f.angle);const T=r.ab.mat4.fromQuat(new Float32Array(16),x),I=r.ab.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),F=r.ab.mat4.transpose([],I),V=r.ab.mat4.multiply([],F,T),j=Date.now()/1e3;return this._accumulatedTimeFromStart+=(j-this._prevTime)*a,this._prevTime=j,{projectionMatrix:v,modelviewMatrix:V}}}class zh extends Ac{constructor(i){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new uo(i.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(i){const a=i.context;if(!this.particlesVx){const f=to(this.particlesCount),v=new r.dt,x=new r.aU;let T=0;const I=r.di(1323123451230);for(let F=0;F<f.length;++F){const V=f[F],j=[2*I()-1,I(),I(),I()];v.emplaceBack(V[0],V[1],V[2],-1,-1,...j),v.emplaceBack(V[0],V[1],V[2],1,-1,...j),v.emplaceBack(V[0],V[1],V[2],1,1,...j),v.emplaceBack(V[0],V[1],V[2],-1,1,...j),x.emplaceBack(T+0,T+1,T+2),x.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=a.createVertexBuffer(v,$d.members),this.particlesIdx=a.createIndexBuffer(x)}}draw(i){if(!this._params.overrideStyleParameters&&!i.style.rain)return;const a=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},f=i.transform.zoom;if(a.revealStart>f)return;const v=Zl(0,1,a.revealStart,a.revealStart+a.revealRange,f);if(!this.particlesVx||!this.particlesIdx)return;const x=structuredClone(this._params);let T=[-x.direction.x,x.direction.y,-100];r.ab.vec3.normalize(T,T);const I=structuredClone(this._vignetteParams);I.strength*=v,x.overrideStyleParameters||(x.intensity=i.style.rain.state.density,x.timeFactor=i.style.rain.state.intensity,x.color=structuredClone(i.style.rain.state.color),T=structuredClone(i.style.rain.state.direction),x.screenThinning.intensity=i.style.rain.state.centerThinning,x.dropletSizeX=i.style.rain.state.dropletSize[0],x.dropletSizeYScale=i.style.rain.state.dropletSize[1]/i.style.rain.state.dropletSize[0],x.distortionStrength=100*i.style.rain.state.distortionStrength,I.strength=1,I.color=structuredClone(i.style.rain.state.vignetteColor));const F=this.updateOnRender(i,x.timeFactor),V=i.context,j=V.gl,Z=i.transform;this.screenTexture&&this.screenTexture.size[0]===i.width&&this.screenTexture.size[1]===i.height||(this.screenTexture=new r.T(V,{width:i.width,height:i.height,data:null},j.RGBA8)),x.distortionStrength>0&&(V.activeTexture.set(j.TEXTURE0),this.screenTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),j.copyTexSubImage2D(j.TEXTURE_2D,0,0,0,0,0,i.width,i.height));const X=i.getOrCreateProgram("rainParticle");i.uploadCommonUniforms(V,X),V.activeTexture.set(j.TEXTURE0),this.screenTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const Q=[x.color.r,x.color.g,x.color.b,x.color.a],le=(se,me)=>{const fe=gl(this._movement.getPosition(),se),De=x.dropletSizeX,ke=x.dropletSizeX*x.dropletSizeYScale,Ne=i.width/2,tt=i.height/2,He=Zl(0,x.screenThinning.start,0,1,x.screenThinning.intensity),We=Zl(.001,x.screenThinning.range,0,1,x.screenThinning.intensity),je=Zl(0,x.screenThinning.particleOffset,0,1,x.screenThinning.intensity),at=(gt={modelview:F.modelviewMatrix,projection:F.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:fe,velocityConeAperture:x.velocityConeAperture,velocity:x.velocity,boxSize:se,rainDropletSize:[De,ke],distortionStrength:x.distortionStrength,rainDirection:T,color:Q,screenSize:[Z.width,Z.height],thinningCenterPos:[Ne,tt],thinningShape:[He,We,Math.pow(10,x.screenThinning.fadePower)],thinningAffectedRatio:x.screenThinning.affectedRatio,thinningParticleOffset:je,shapeDirectionalPower:x.shapeDirPower,shapeNormalPower:x.shapeNormalPower,mode:me?0:1},{u_modelview:Float32Array.from(gt.modelview),u_projection:Float32Array.from(gt.projection),u_time:gt.time,u_cam_pos:gt.camPos,u_texScreen:0,u_velocityConeAperture:gt.velocityConeAperture,u_velocity:gt.velocity,u_boxSize:gt.boxSize,u_rainDropletSize:gt.rainDropletSize,u_distortionStrength:gt.distortionStrength,u_rainDirection:gt.rainDirection,u_color:gt.color,u_screenSize:gt.screenSize,u_thinningCenterPos:gt.thinningCenterPos,u_thinningShape:gt.thinningShape,u_thinningAffectedRatio:gt.thinningAffectedRatio,u_thinningParticleOffset:gt.thinningParticleOffset,u_shapeDirectionalPower:gt.shapeDirectionalPower,u_shapeNormalPower:gt.shapeNormalPower,u_mode:gt.mode});var gt;const Jt=Math.round(x.intensity*this.particlesCount),jt=r.b7.simpleSegment(0,0,4*Jt,2*Jt);X.draw(i,j.TRIANGLES,sr.disabled,br.disabled,Fr.alphaBlended,rr.disabled,at,"rain_particles",this.particlesVx,this.particlesIdx,jt,{})};x.distortionStrength>0&&le(x.boxSize,!0),le(x.boxSize,!1),this._vignette.draw(i,I)}}const Kd=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Cc extends Ac{constructor(i){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new uo(i.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(i){const a=i.context;if(!this.particlesVx){const f=to(this.particlesCount),v=new r.du,x=new r.aU;let T=0;const I=r.di(1323123451230);for(let F=0;F<f.length;++F){const V=f[F],j=I(),Z=I(),X=I(),Q=[F/f.length,j,Z,X],le=[I(),I()];v.emplaceBack(V[0],V[1],V[2],-1,-1,...Q,...le),v.emplaceBack(V[0],V[1],V[2],1,-1,...Q,...le),v.emplaceBack(V[0],V[1],V[2],1,1,...Q,...le),v.emplaceBack(V[0],V[1],V[2],-1,1,...Q,...le),x.emplaceBack(T+0,T+1,T+2),x.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=a.createVertexBuffer(v,Kd.members),this.particlesIdx=a.createIndexBuffer(x)}}draw(i){if(!this._params.overrideStyleParameters&&!i.style.snow)return;const a=structuredClone(this._params);let f=[-a.direction.x,a.direction.y,-100];r.ab.vec3.normalize(f,f);const v=structuredClone(this._vignetteParams),x=a.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=i.transform.zoom;if(x.revealStart>T)return;const I=Zl(0,1,x.revealStart,x.revealStart+x.revealRange,T);v.strength*=I,a.overrideStyleParameters||(a.intensity=i.style.snow.state.density,a.timeFactor=i.style.snow.state.intensity,a.color=structuredClone(i.style.snow.state.color),f=structuredClone(i.style.snow.state.direction),a.screenThinning.intensity=i.style.snow.state.centerThinning,a.billboardSize=2.79*i.style.snow.state.flakeSize,v.strength=1,v.color=structuredClone(i.style.snow.state.vignetteColor));const F=this.updateOnRender(i,a.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const V=i.context,j=V.gl,Z=i.transform,X=i.getOrCreateProgram("snowParticle");i.uploadCommonUniforms(V,X),((Q,le,se)=>{const me=gl(this._movement.getPosition(),Q),fe=Z.width/2,De=Z.height/2,ke=Zl(0,se.screenThinning.start,0,1,se.screenThinning.intensity),Ne=Zl(.001,se.screenThinning.range,0,1,se.screenThinning.intensity),tt=Zl(0,se.screenThinning.particleOffset,0,1,se.screenThinning.intensity),He=(We={modelview:F.modelviewMatrix,projection:F.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:me,velocityConeAperture:se.velocityConeAperture,velocity:se.velocity,horizontalOscillationRadius:se.horizontalOscillationRadius,horizontalOscillationRate:se.horizontalOscillationRate,boxSize:Q,billboardSize:1*se.billboardSize,simpleShapeParameters:[se.shapeFadeStart,se.shapeFadePower],screenSize:[Z.width,Z.height],thinningCenterPos:[fe,De],thinningShape:[ke,Ne,Math.pow(10,se.screenThinning.fadePower)],thinningAffectedRatio:se.screenThinning.affectedRatio,thinningParticleOffset:tt,color:[se.color.r,se.color.g,se.color.b,se.color.a],direction:f},{u_modelview:Float32Array.from(We.modelview),u_projection:Float32Array.from(We.projection),u_time:We.time,u_cam_pos:We.camPos,u_velocityConeAperture:We.velocityConeAperture,u_velocity:We.velocity,u_horizontalOscillationRadius:We.horizontalOscillationRadius,u_horizontalOscillationRate:We.horizontalOscillationRate,u_boxSize:We.boxSize,u_billboardSize:We.billboardSize,u_simpleShapeParameters:We.simpleShapeParameters,u_screenSize:We.screenSize,u_thinningCenterPos:We.thinningCenterPos,u_thinningShape:We.thinningShape,u_thinningAffectedRatio:We.thinningAffectedRatio,u_thinningParticleOffset:We.thinningParticleOffset,u_particleColor:We.color,u_direction:We.direction});var We;const je=Math.round(se.intensity*this.particlesCount),at=r.b7.simpleSegment(0,0,4*je,2*je);this.particlesVx&&this.particlesIdx&&X.draw(i,j.TRIANGLES,sr.disabled,br.disabled,Fr.alphaBlended,rr.disabled,He,"snow_particles",this.particlesVx,this.particlesIdx,at,{})})(a.boxSize,0,a),this._vignette.draw(i,v)}}const Wc={symbol:function(d,i,a,f,v){if(d.renderPass!=="translucent")return;const x=br.disabled,T=d.colorModeForRenderPass(),I=a.layout.get("text-variable-anchor"),F=a.layout.get("text-size-scale-range"),V=r.aw(d.scaleFactor,F[0],F[1]);I&&function(X,Q,le,se,me,fe,De,ke){const Ne=Q.transform,tt=me==="map",He=fe==="map";for(const We of X){const je=se.getTile(We),at=je.getBucket(le);if(!at||!at.text||!at.text.segments.get().length)continue;const gt=r.bp(at.textSizeData,Ne.zoom,ke),Jt=fl(We,at.getProjection(),Ne),jt=Ne.calculatePixelsToTileUnitsMatrix(je),fi=Lr(Jt,je.tileID.canonical,He,tt,Ne,at.getProjection(),jt),ui=at.hasIconTextFit()&&at.hasIconData();if(gt){const Pt=Math.pow(2,Ne.zoom-je.tileID.overscaledZ);Sh(at,tt,He,De,r.cX,Ne,fi,We,Pt,gt,ui)}}}(f,d,a,i,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),v,V);const j=a.paint.get("icon-opacity").constantOr(1)!==0,Z=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(j||Z)?qu(d,i,a,f,x,T):(j&&qu(d,i,a,f,x,T,{onlyIcons:!0}),Z&&qu(d,i,a,f,x,T,{onlyText:!0})),i.map.showCollisionBoxes&&(ju(d,i,a,f,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),ju(d,i,a,f,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(d,i,a,f){if(d.renderPass!=="translucent")return;const v=a.paint.get("circle-opacity"),x=a.paint.get("circle-stroke-width"),T=a.paint.get("circle-stroke-opacity"),I=a.layout.get("circle-sort-key").constantOr(1)!==void 0,F=a.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(x.constantOr(1)===0||T.constantOr(1)===0))return;const V=d.context,j=V.gl,Z=d.transform,X=d.depthModeForSublayer(0,sr.ReadOnly),Q=br.disabled,le=d.colorModeForDrapableLayerRenderPass(F),se=Z.projection.name==="globe",me=[r.at(Z.center.lng),r.aA(Z.center.lat)],fe=[];for(let ke=0;ke<f.length;ke++){const Ne=f[ke],tt=i.getTile(Ne),He=tt.getBucket(a);if(!He||He.projection.name!==Z.projection.name)continue;const We=He.programConfigurations.get(a.id),je=r.cY(a),at=d.isTileAffectedByFog(Ne);se&&je.push("PROJECTION_GLOBE_VIEW"),je.push("DEPTH_D24"),d.terrain&&Z.depthOcclusionForSymbolsAndCircles&&je.push("DEPTH_OCCLUSION");const gt=d.getOrCreateProgram("circle",{config:We,defines:je,overrideFog:at}),Jt=He.layoutVertexBuffer,jt=He.globeExtVertexBuffer,fi=He.indexBuffer,ui=Z.projection.createInversionMatrix(Z,Ne.canonical),Pt={programConfiguration:We,program:gt,layoutVertexBuffer:Jt,globeExtVertexBuffer:jt,indexBuffer:fi,uniformValues:r.cZ(d,Ne,tt,ui,me,a),tile:tt};if(I){const Kt=He.segments.get();for(const Ii of Kt)fe.push({segments:new r.b7([Ii]),sortKey:Ii.sortKey,state:Pt})}else fe.push({segments:He.segments,sortKey:0,state:Pt})}I&&fe.sort((ke,Ne)=>ke.sortKey-Ne.sortKey);const De={useDepthForOcclusion:Z.depthOcclusionForSymbolsAndCircles};for(const ke of fe){const{programConfiguration:Ne,program:tt,layoutVertexBuffer:He,globeExtVertexBuffer:We,indexBuffer:je,uniformValues:at,tile:gt}=ke.state,Jt=ke.segments;d.terrain&&d.terrain.setupElevationDraw(gt,tt,De),d.uploadCommonUniforms(V,tt,gt.tileID.toUnwrapped()),tt.draw(d,j.TRIANGLES,X,Q,le,rr.disabled,at,a.id,He,je,Jt,a.paint,Z.zoom,Ne,[We])}},heatmap:function(d,i,a,f){if(a.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const v=d.context,x=v.gl,T=br.disabled,I=new Fr([x.ONE,x.ONE,x.ONE,x.ONE],r.aj.transparent,[!0,!0,!0,!0]);(function(Q,le,se,me){const fe=Q.gl,De=le.width*me,ke=le.height*me;Q.activeTexture.set(fe.TEXTURE1),Q.viewport.set([0,0,De,ke]);let Ne=se.heatmapFbo;if(!Ne||Ne&&(Ne.width!==De||Ne.height!==ke)){Ne&&Ne.destroy();const tt=fe.createTexture();fe.bindTexture(fe.TEXTURE_2D,tt),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_WRAP_S,fe.CLAMP_TO_EDGE),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_WRAP_T,fe.CLAMP_TO_EDGE),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_MIN_FILTER,fe.LINEAR),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_MAG_FILTER,fe.LINEAR),Ne=se.heatmapFbo=Q.createFramebuffer(De,ke,!0,null),function(He,We,je,at,gt,Jt){const jt=He.gl;jt.texImage2D(jt.TEXTURE_2D,0,He.extRenderToTextureHalfFloat?jt.RGBA16F:jt.RGBA,gt,Jt,0,jt.RGBA,He.extRenderToTextureHalfFloat?jt.HALF_FLOAT:jt.UNSIGNED_BYTE,null),at.colorAttachment.set(je)}(Q,0,tt,Ne,De,ke)}else fe.bindTexture(fe.TEXTURE_2D,Ne.colorAttachment.get()),Q.bindFramebuffer.set(Ne.framebuffer)})(v,d,a,d.transform.projection.name==="globe"?.5:.25),v.clear({color:r.aj.transparent});const F=d.transform,V=F.projection.name==="globe",j=V?["PROJECTION_GLOBE_VIEW"]:[],Z=V?rr.frontCCW:rr.disabled,X=[r.at(F.center.lng),r.aA(F.center.lat)];for(let Q=0;Q<f.length;Q++){const le=f[Q];if(i.hasRenderableParent(le))continue;const se=i.getTile(le),me=se.getBucket(a);if(!me||me.projection.name!==F.projection.name)continue;const fe=d.isTileAffectedByFog(le),De=me.programConfigurations.get(a.id),ke=d.getOrCreateProgram("heatmap",{config:De,defines:j,overrideFog:fe}),{zoom:Ne}=d.transform;d.terrain&&d.terrain.setupElevationDraw(se,ke),d.uploadCommonUniforms(v,ke,le.toUnwrapped());const tt=F.projection.createInversionMatrix(F,le.canonical);ke.draw(d,x.TRIANGLES,sr.disabled,T,I,Z,kn(d,le,se,tt,X,Ne,a.paint.get("heatmap-intensity")),a.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,a.paint,d.transform.zoom,De,V?[me.globeExtVertexBuffer]:null)}v.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(v,x){const T=v.context,I=T.gl,F=x.heatmapFbo;if(!F)return;T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,F.colorAttachment.get()),T.activeTexture.set(I.TEXTURE1);let V=x.colorRampTexture;V||(V=x.colorRampTexture=new r.T(T,x.colorRamp,I.RGBA8)),V.bind(I.LINEAR,I.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,I.TRIANGLES,sr.disabled,br.disabled,v.colorModeForRenderPass(),rr.disabled,((j,Z,X,Q)=>({u_image:0,u_color_ramp:1,u_opacity:Z.paint.get("heatmap-opacity")}))(0,x),x.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,x.paint,v.transform.zoom)}(d,a))},line:function(d,i,a,f){if(d.renderPass!=="translucent")return;const v=a.paint.get("line-opacity"),x=a.paint.get("line-width");if(v.constantOr(1)===0||x.constantOr(1)===0)return;const T=a.paint.get("line-emissive-strength"),I=a.paint.get("line-occlusion-opacity"),F=a.layout.get("line-elevation-reference"),V=a.layout.get("line-width-unit")==="meters",j=F==="sea",Z=d.context,X=Z.gl;if(a.hasElevatedBuckets&&d.transform.projection.name==="globe")return;const Q=a.layout.get("line-cross-slope"),le=Q!==void 0,se=Q<1,me=d.colorModeForDrapableLayerRenderPass(T),fe=d.terrain&&d.terrain.renderingToTexture,De=fe?1:r.q.devicePixelRatio,ke=a.paint.get("line-dasharray"),Ne=ke.constantOr(1),tt=a.layout.get("line-cap"),He=ke.constantOr(null),We=tt.constantOr(null),je=a.paint.get("line-pattern"),at=je.constantOr(1),gt=je.constantOr(null),Jt=a.paint.get("line-opacity").constantOr(1);let jt=!at&&Jt!==1||d.depthOcclusion&&I>0&&I<1;const fi=a.paint.get("line-gradient"),ui=at?"linePattern":"line",Pt=r.c_(a);let Kt;if(fe&&d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(jt=!1),I!==0&&d.depthOcclusion){const Et=a.paint._values["line-opacity"];Et&&Et.value&&Et.value.kind==="constant"?Kt=Et.value:r.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}x.value.kind!=="constant"&&x.value.isLineProgressConstant===!1&&Pt.push("VARIABLE_LINE_WIDTH");const Ii=(Et,hi,si,an,zi)=>{for(const yi of Et){const Hi=i.getTile(yi);if(at&&!Hi.patternsLoaded())continue;const en=Hi.getBucket(a);if(!en||en.hasZOffset&&!zi||!en.hasZOffset&&zi)continue;d.prepareDrawTile();const bn=en.programConfigurations.get(a.id),Un=d.isTileAffectedByFog(yi),fr=d.getOrCreateProgram(ui,{config:bn,defines:hi,overrideFog:Un,overrideRtt:!zi&&void 0});if(gt&&Hi.imageAtlas){const Pr=r.A.from(gt).getPrimary().scaleSelf(De).serialize(),ba=Hi.imageAtlas.patternPositions[Pr];ba&&bn.setConstantPatternPositions(ba)}if(!at&&He&&We&&Hi.lineAtlas){const Pr=Hi.lineAtlas.getDash(He,We);Pr&&bn.setConstantPatternPositions(Pr)}let[ur,lr]=a.paint.get("line-trim-offset");(We==="round"||We==="square")&&ur!==lr&&(ur===0&&(ur-=1),lr===1&&(lr+=1));const wr=fe?yi.projMatrix:null,Tr=V?1/en.tileToMeter/r.ar(Hi,1,d.transform.zoom):1,za=V?1/en.tileToMeter/r.ar(Hi,1,Math.floor(d.transform.zoom)):1,Ss=at?r.c$(d,Hi,a,wr,De,Tr,za,[ur,lr]):r.d0(d,Hi,a,wr,en.lineClipsArray.length,De,Tr,za,[ur,lr]);if(fi){const Pr=en.gradients[a.id];let ba=Pr.texture;if(a.gradientVersion!==Pr.version){let In=256;if(a.stepInterpolant){const _r=i.getSource().maxzoom,pr=yi.canonical.z===_r?Math.ceil(1<<d.transform.maxZoom-yi.canonical.z):1;In=r.aw(r.d1(en.maxLineLength/r.ag*1024*pr),256,Z.maxTextureSize)}Pr.gradient=r.d2({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:In,image:Pr.gradient||void 0,clips:en.lineClipsArray}),Pr.texture?Pr.texture.update(Pr.gradient):Pr.texture=new r.T(Z,Pr.gradient,X.RGBA8),Pr.version=a.gradientVersion,ba=Pr.texture}Z.activeTexture.set(X.TEXTURE1),ba.bind(a.stepInterpolant?X.NEAREST:X.LINEAR,X.CLAMP_TO_EDGE)}Ne&&(Z.activeTexture.set(X.TEXTURE0),Hi.lineAtlasTexture&&Hi.lineAtlasTexture.bind(X.LINEAR,X.REPEAT),bn.updatePaintBuffers()),at&&(Z.activeTexture.set(X.TEXTURE0),Hi.imageAtlasTexture&&Hi.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),bn.updatePaintBuffers()),zi&&!j&&d.terrain.setupElevationDraw(Hi,fr),d.uploadCommonUniforms(Z,fr,yi.toUnwrapped());const qa=Pr=>{Kt!=null&&(Kt.value=Jt*I),fr.draw(d,X.TRIANGLES,si,Pr,me,rr.disabled,Ss,a.id,en.layoutVertexBuffer,en.indexBuffer,en.segments,a.paint,d.transform.zoom,bn,[en.layoutVertexBuffer2,en.patternVertexBuffer,en.zOffsetVertexBuffer]),Kt!=null&&(Kt.value=Jt)};if(jt&&!zi){const Pr=d.stencilModeForClipping(yi).ref;Pr===0&&fe&&Z.clear({stencil:0});const ba={func:X.EQUAL,mask:255};Ss.u_alpha_discard_threshold=.8,qa(new br(ba,Pr,255,X.KEEP,X.KEEP,X.INVERT)),Ss.u_alpha_discard_threshold=0,qa(new br(ba,Pr,255,X.KEEP,X.KEEP,X.KEEP))}else jt&&zi&&(Ss.u_alpha_discard_threshold=.001),qa(zi?an:d.stencilModeForClipping(yi))}};if(a.hasNonElevatedBuckets){const Et=!fe&&d.terrain;I!==0&&Et?r.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has line-z-offset enabled.`):Et?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${a.id}.`):Ii(f,Pt,d.depthModeForSublayer(0,sr.ReadOnly),br.disabled,!1)}if(a.hasElevatedBuckets){Pt.push("ELEVATED"),le&&Pt.push(se?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),j&&Pt.push("ELEVATION_REFERENCE_SEA");const Et=jt?d.stencilModeFor3D():br.disabled,hi=new sr(d.depthOcclusion?X.GREATER:X.LEQUAL,sr.ReadOnly,d.depthRangeFor3D);d.forceTerrainMode=!0,Ii(f,Pt,hi,Et,!0),d.forceTerrainMode=!1}jt&&(d.resetStencilClippingMasks(),fe&&Z.clear({stencil:0})),I===0||d.depthOcclusion||fe||d.layersWithOcclusionOpacity.push(d.currentLayer)},fill:function(d,i,a,f){const v=a.paint.get("fill-color"),x=a.paint.get("fill-opacity"),T=a.is3D(),I=new sr(d.context.gl.LEQUAL,sr.ReadWrite,d.depthRangeFor3D);if(x.constantOr(1)===0)return;const F=a.paint.get("fill-emissive-strength"),V=d.colorModeForDrapableLayerRenderPass(F),j=a.paint.get("fill-pattern"),Z=d.opaquePassEnabledForLayer()&&!j.constantOr(1)&&v.constantOr(r.aj.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===Z){const X=T?I:d.depthModeForSublayer(1,d.renderPass==="opaque"?sr.ReadWrite:sr.ReadOnly);ol(d,i,a,f,X,V,!1)}if(!T&&d.renderPass==="translucent"&&a.paint.get("fill-antialias")){const X=T?I:d.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,sr.ReadOnly);ol(d,i,a,f,X,V,!0)}},"fill-extrusion":function(d,i,a,f){const v=a.paint.get("fill-extrusion-opacity"),x=d.context,T=x.gl,I=d.terrain,F=I&&I.renderingToTexture;if(v===0)return;const V=d.conflationActive&&d.style.isLayerClipped(a,i.getSource()),j=d.style.order.indexOf(a.fqid);if(V&&function(Z,X,Q,le,se){for(const me of le){const fe=X.getTile(me).getBucket(Q);fe&&(fe.updateReplacement(me,Z.replacementSource,se),fe.uploadCentroid(Z.context))}}(d,i,a,f,j),I||V)for(const Z of f){const X=i.getTile(Z).getBucket(a);X&&Ch(d.context,i,Z,X,a,I,V)}if(d.renderPass==="shadow"&&d.shadowRenderer){const Z=d.shadowRenderer;if(I&&v<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.a9)return;const X=Z.getShadowPassDepthMode(),Q=Z.getShadowPassColorMode();Ah(d,i,a,f,X,br.disabled,Q,V)}else if(d.renderPass==="translucent"){const Z=!a.paint.get("fill-extrusion-pattern").constantOr(1),X=a.paint.get("fill-extrusion-color").constantOr(r.aj.white);if(!F&&X.a!==0){const Q=new sr(d.context.gl.LEQUAL,sr.ReadWrite,d.depthRangeFor3D);v===1&&Z?Ah(d,i,a,f,Q,br.disabled,Fr.unblended,V):(Ah(d,i,a,f,Q,br.disabled,Fr.disabled,V),Ah(d,i,a,f,Q,d.stencilModeFor3D(),d.colorModeForRenderPass(),V),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&Z&&(!I&&d.transform.projection.name!=="globe"||F)){const Q=a.paint.get("fill-extrusion-opacity"),le=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),se=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),me=a.paint.get("fill-extrusion-flood-light-intensity"),fe=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",De=a.paint.get("fill-extrusion-flood-light-color").toRenderColor(fe?null:a.lut).toArray01().slice(0,3),ke=le>0&&se>0,Ne=me>0,tt=(We,je,at)=>(1-at)*We+at*je,He=We=>{const je=d.depthModeForSublayer(1,sr.ReadOnly,T.LEQUAL,!0),at=a.paint.get(We?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),gt=tt(.1,3,at),Jt=d._showOverdrawInspector;if(!Jt){const jt=new br({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),fi=new Fr([T.ONE,T.ONE,T.ONE,T.ONE],r.aj.transparent,[!1,!1,!1,!0],T.MIN);cu(d,i,a,f,je,jt,fi,rr.disabled,We,"sdf",Q,le,se,me,De,gt,V,!1)}{const jt=Jt?br.disabled:new br({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),fi=Jt?d.colorModeForRenderPass():new Fr([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],r.aj.transparent,[!0,!0,!0,!0]);cu(d,i,a,f,je,jt,fi,rr.disabled,We,"color",Q,le,se,me,De,gt,V,!1)}};if(F){const We=(je,at,gt)=>{const Jt=d.depthModeForSublayer(1,sr.ReadOnly,T.LEQUAL,!1),jt=a.paint.get(je?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),fi=tt(.1,3,jt);{const ui=new Fr([T.ONE,T.ONE,T.ONE,T.ONE],r.aj.transparent,[!1,!1,!1,!0]);cu(d,i,a,f,Jt,br.disabled,ui,rr.disabled,je,"clear",Q,le,se,me,De,fi,V,at)}{const ui=new br({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),Pt=new Fr([T.ONE,T.ONE,T.ONE,T.ONE],r.aj.transparent,[!1,!1,!1,!0],T.MIN);cu(d,i,a,f,Jt,ui,Pt,rr.disabled,je,"sdf",Q,le,se,me,De,fi,V,at)}{const ui=je?T.ZERO:T.ONE_MINUS_DST_ALPHA,Pt=new br({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),Kt=new Fr([ui,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],r.aj.transparent,[!0,!0,!0,!0]);cu(d,i,a,f,Jt,Pt,Kt,rr.disabled,je,"color",Q,le,se,me,De,fi,V,at)}{const ui=new Fr([T.ONE,T.ONE,T.ONE,je?T.ZERO:T.ONE],r.aj.transparent,[!1,!1,!1,!0],je?T.FUNC_ADD:T.MAX);cu(d,i,a,f,Jt,br.disabled,ui,rr.disabled,je,"clear",Q,le,se,me,De,fi,V,at,gt)}};if(ke||Ne){let je;if(d.prepareDrawTile(),I){const at=I.drapeBufferSize[0],gt=I.drapeBufferSize[1];je=I.framebufferCopyTexture,je&&(!je||je.size[0]===at&&je.size[1]===gt)||(je&&je.destroy(),je=I.framebufferCopyTexture=new r.T(x,new r.r({width:at,height:gt}),T.RGBA8)),je.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,at,gt)}ke&&We(!0,!1,je),Ne&&We(!1,!0,je)}}else ke&&He(!0),Ne&&He(!1),(ke||Ne)&&d.resetStencilClippingMasks()}}},hillshade:function(d,i,a,f){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;const v=d.context,x=d.terrain&&d.terrain.renderingToTexture,[T,I]=d.renderPass!=="translucent"||x?[{},f]:d.stencilConfigForOverlap(f);for(const F of I){const V=i.getTile(F);if(V.needsHillshadePrepare&&d.renderPass==="offscreen")zd(d,V,a);else if(d.renderPass==="translucent"){const j=d.depthModeForSublayer(0,sr.ReadOnly),Z=a.paint.get("hillshade-emissive-strength"),X=d.colorModeForDrapableLayerRenderPass(Z),Q=x&&d.terrain?d.terrain.stencilModeForRTTOverlap(F):T[F.overscaledZ];rc(d,F,V,a,j,Q,X)}}v.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,i,a,f,v,x){if(d.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;const T=d.transform.projection.name==="globe",I=a.paint.get("raster-elevation")!==0,F=I&&T;if(d.renderElevatedRasterBackface&&!F)return;const V=d.context,j=V.gl,Z=i.getSource(),X=function(He,We,je,at){const gt=We.paint.get("raster-color"),Jt=He.type==="raster-array",jt=[],fi=We.paint.get("raster-resampling"),ui=We.paint.get("raster-color-mix");let Pt=We.paint.get("raster-color-range");const Kt=[ui[0],ui[1],ui[2],0],Ii=ui[3];let Et=fi==="nearest"?at.NEAREST:at.LINEAR;if(Jt&&(jt.push("RASTER_ARRAY"),gt||jt.push("RASTER_COLOR"),fi==="linear"&&jt.push("RASTER_ARRAY_LINEAR"),Et=at.NEAREST,!Pt&&He.rasterLayers)){const hi=He.rasterLayers.find(({id:si})=>si===We.sourceLayer);hi&&hi.fields&&hi.fields.range&&(Pt=hi.fields.range)}if(Pt=Pt||[0,1],gt){jt.push("RASTER_COLOR"),je.activeTexture.set(at.TEXTURE2),We.updateColorRamp(Pt);let hi=We.colorRampTexture;hi||(hi=We.colorRampTexture=new r.T(je,We.colorRamp,at.RGBA8)),hi.bind(at.LINEAR,at.CLAMP_TO_EDGE)}return{mix:Kt,range:Pt,offset:Ii,defines:jt,resampling:Et}}(Z,a,V,j);if(Z instanceof r.aJ&&!f.length&&!T)return;const Q=a.paint.get("raster-emissive-strength"),le=d.colorModeForDrapableLayerRenderPass(Q),se=d.terrain&&d.terrain.renderingToTexture,me=!d.options.moving,fe=a.paint.get("raster-resampling")==="nearest"?j.NEAREST:j.LINEAR;if(Z instanceof r.aJ&&!f.length&&(Z.onNorthPole||Z.onSouthPole)){const He=I?d.stencilModeFor3D():br.disabled;return void Ht(!!Z.onNorthPole,null,d,i,a,Q,X,rr.disabled,He)}if(!f.length)return;const[De,ke]=Z instanceof r.aJ||se?[{},f]:d.stencilConfigForOverlap(f),Ne=ke[ke.length-1].overscaledZ;F&&X.defines.push("PROJECTION_GLOBE_VIEW"),I&&X.defines.push("RENDER_CUTOFF");const tt=(He,We,je)=>{for(const at of He){const gt=at.toUnwrapped(),Jt=i.getTile(at);if(se&&(!Jt||!Jt.hasData()))continue;V.activeTexture.set(j.TEXTURE0);const jt=js(Jt,Z,a,X);if(!jt||!jt.texture)continue;const{texture:fi,mix:ui,offset:Pt,tileSize:Kt,buffer:Ii}=jt;let Et,hi;se?(Et=sr.disabled,hi=at.projMatrix):I?(Et=new sr(j.LEQUAL,sr.ReadWrite,d.depthRangeFor3D),hi=T?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(gt,me)):(Et=d.depthModeForSublayer(at.overscaledZ-Ne,a.paint.get("raster-opacity")===1?sr.ReadWrite:sr.ReadOnly,j.LESS),hi=d.transform.calculateProjMatrix(gt,me));const si=d.terrain&&se?d.terrain.stencilModeForRTTOverlap(at):De[at.overscaledZ],an=x?0:a.paint.get("raster-fade-duration");Jt.registerFadeDuration(an);const zi=i.findLoadedParent(at,0),yi=ml(Jt,zi,i,d.transform,an);let Hi,en;d.terrain&&d.terrain.prepareDrawTile(),V.activeTexture.set(j.TEXTURE0),fi.bind(fe,j.CLAMP_TO_EDGE),V.activeTexture.set(j.TEXTURE1),zi?(zi.texture&&zi.texture.bind(fe,j.CLAMP_TO_EDGE),Hi=Math.pow(2,zi.tileID.overscaledZ-Jt.tileID.overscaledZ),en=[Jt.tileID.canonical.x*Hi%1,Jt.tileID.canonical.y*Hi%1]):fi.bind(fe,j.CLAMP_TO_EDGE),fi.useMipmap&&V.extTextureFilterAnisotropic&&d.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax);const bn=d.transform;let Un;const fr=I?uu(bn):[0,0,0,0];let ur,lr,wr,Tr,za,Ss=0;if(F&&Z instanceof r.aJ&&Z.coordinates.length>3)ur=Float32Array.from(r.bb(r.cH(new r.bT(0,0,0)))),lr=Float32Array.from(bn.globeMatrix),wr=Float32Array.from(r.cD(bn)),Tr=[r.at(bn.center.lng),r.aA(bn.center.lat)],Un=Z.elevatedGlobePerspectiveTransform,za=Z.elevatedGlobeGridMatrix||new Float32Array(9);else if(F){const In=r.cE(at.canonical);Ss=r.cF(In.getCenter().lat),ur=Float32Array.from(r.bb(r.cH(at.canonical))),lr=Float32Array.from(bn.globeMatrix),wr=Float32Array.from(r.cD(bn)),Tr=[r.at(bn.center.lng),r.aA(bn.center.lat)],Un=[0,0],za=Float32Array.from(r.cG(at.canonical,In,Ss,bn.worldSize/bn._pixelsPerMercatorPixel))}else Un=Z instanceof r.aJ?Z.perspectiveTransform:[0,0],ur=new Float32Array(16),lr=new Float32Array(9),wr=new Float32Array(16),Tr=[0,0],za=new Float32Array(9);const qa=Vu(hi,ur,lr,wr,za,en||[0,0],r.ae(d.transform.zoom),Tr,fr,Hi||1,yi,a,Un,I?a.paint.get("raster-elevation"):0,2,ui,Pt,X.range,Kt,Ii,Q),Pr=d.isTileAffectedByFog(at),ba=d.getOrCreateProgram("raster",{defines:X.defines,overrideFog:Pr});if(d.uploadCommonUniforms(V,ba,gt),Z instanceof r.aJ){const In=Z.elevatedGlobeVertexBuffer,_r=Z.elevatedGlobeIndexBuffer;if(se||!T)Z.boundsBuffer&&Z.boundsSegments&&ba.draw(d,j.TRIANGLES,Et,br.disabled,le,rr.disabled,qa,a.id,Z.boundsBuffer,d.quadTriangleIndexBuffer,Z.boundsSegments);else if(In&&_r){const pr=bn.zoom<=r.c6?Z.elevatedGlobeSegments:Z.getSegmentsForLongitude(bn.center.lng);pr&&ba.draw(d,j.TRIANGLES,Et,br.disabled,le,We,qa,a.id,In,_r,pr)}}else if(F){Et=new sr(j.LEQUAL,sr.ReadOnly,d.depthRangeFor3D);const In=d.globeSharedBuffers;if(In){const[_r,pr,yr]=In.getGridBuffers(Ss,!1);ba.draw(d,j.TRIANGLES,Et,je||si,d.colorModeForRenderPass(),We,qa,a.id,_r,pr,yr)}}else{const{tileBoundsBuffer:In,tileBoundsIndexBuffer:_r,tileBoundsSegments:pr}=d.getTileBoundsBuffers(Jt);ba.draw(d,j.TRIANGLES,Et,si,le,rr.disabled,qa,a.id,In,_r,pr)}}if(!(Z instanceof r.aJ)&&F)for(const at of He){const gt=at.canonical.y===(1<<at.canonical.z)-1;at.canonical.y===0&&Ht(!0,at,d,i,a,Q,X,We,je||br.disabled),gt&&Ht(!1,at,d,i,a,Q,X,We===rr.frontCW?rr.backCW:rr.frontCW,je||br.disabled)}};F?tt(ke,d.renderElevatedRasterBackface?rr.backCW:rr.frontCW,d.stencilModeFor3D()):tt(ke,rr.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,i,a,f,v,x){d.renderPass==="offscreen"&&function(T,I,F,V){if(!V.length)return;const j=T.context,Z=j.gl,X=I.getSource();if(!(X instanceof Ia))return;const Q=Math.ceil(Math.sqrt(F.paint.get("raster-particle-count")));let le=F.particlePositionRGBAImage;if(!le||le.width!==Q){const ke=function(Ne){const tt=Ne*Ne,He=new Uint8Array(4*tt),We=function(at){return at|=0,at=Math.imul(2747636419^at,2654435769),at=Math.imul(at^at>>>16,2654435769),((at=Math.imul(at^at>>>16,2654435769))>>>0)/4294967296},je=1/1.1;for(let at=0;at<tt;at++){const gt=je*(We(2*at+0)+un),Jt=je*(We(2*at+1)+un),jt=255*gt%1,fi=255*Jt%1,ui=jt,Pt=Jt-fi/255,Kt=fi;He[4*at+0]=255*(gt-jt/255),He[4*at+1]=255*ui,He[4*at+2]=255*Pt,He[4*at+3]=255*Kt}return He}(Q);le=F.particlePositionRGBAImage=new r.r({width:Q,height:Q},ke)}let se=F.particleFramebuffer;se?se.width!==Q&&(se.destroy(),se=F.particleFramebuffer=j.createFramebuffer(Q,Q,!0,null)):se=F.particleFramebuffer=j.createFramebuffer(Q,Q,!0,null);const me=[];for(const ke of V){const Ne=I.getTile(ke);if(!(Ne instanceof wi))continue;const tt=Lh(Ne,X,F);if(!tt)continue;const He=[Ne.tileSize,Ne.tileSize];let We=F.tileFramebuffer;We||(We=F.tileFramebuffer=j.createFramebuffer(He[0],He[1],!0,null));let je=Ne.rasterParticleState;je||(je=Ne.rasterParticleState=new Wd(j,ke,He,le));const at=je.update(F.lastInvalidatedAt);je.particleTextureDimension!==Q&&je.updateParticleTexture(ke,le);const gt=je.targetColorTexture;je.targetColorTexture=je.backgroundColorTexture,je.backgroundColorTexture=gt;const Jt=je.particleTexture0;je.particleTexture0=je.particleTexture1,je.particleTexture1=Jt,me.push([ke,tt,je,at])}if(me.length===0)return;const fe=r.q.now(),De=F.previousDrawTimestamp?.001*(fe-F.previousDrawTimestamp):.0167;if(F.previousDrawTimestamp=fe,F.hasColorMap()){j.activeTexture.set(Z.TEXTURE0+2);let ke=F.colorRampTexture;ke||(ke=F.colorRampTexture=new r.T(j,F.colorRamp,Z.RGBA8)),ke.bind(Z.LINEAR,Z.CLAMP_TO_EDGE)}j.bindFramebuffer.set(F.tileFramebuffer.framebuffer),function(ke,Ne,tt){const He=ke.context,We=He.gl,je=Ne.tileFramebuffer;He.activeTexture.set(We.TEXTURE0);const at={u_texture:0,u_opacity:1.05*(Jt=Ne.paint.get("raster-particle-fade-opacity-factor"))/(Jt+.05)},gt=ke.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Jt;for(const jt of tt){const[,,fi,ui]=jt;je.colorAttachment.set(fi.targetColorTexture.texture),He.viewport.set([0,0,je.width,je.height]),He.clear({color:r.aj.transparent}),ui&&(fi.backgroundColorTexture.bind(We.NEAREST,We.CLAMP_TO_EDGE),gt.draw(ke,We.TRIANGLES,sr.disabled,br.disabled,Fr.alphaBlended,rr.disabled,at,Ne.id,ke.viewportBuffer,ke.quadTriangleIndexBuffer,ke.viewportSegments))}}(T,F,me),function(ke,Ne,tt,He){const We=ke.context,je=We.gl,at=tt.tileFramebuffer,gt=ke.transform.projection.name==="globe",Jt=tt.paint.get("raster-particle-max-speed");for(const jt of He){const[fi,ui,Pt]=jt;We.activeTexture.set(je.TEXTURE0+0),ui.texture.bind(je.LINEAR,je.CLAMP_TO_EDGE),at.colorAttachment.set(Pt.targetColorTexture.texture);const Kt=ke.getOrCreateProgram("rasterParticleDraw",{defines:ui.defines,overrideFog:!1});We.activeTexture.set(je.TEXTURE0+1);const Ii=ui.scalarData?[]:[0,1,2,3].map(si=>r.d4[si](fi));Ii.push(fi);const Et=fi.canonical.x,hi=fi.canonical.y;for(const si of Ii){const an=Ne.getTile(gt?si.wrapped():si);if(!an)continue;const zi=an.rasterParticleState;if(!zi)continue;const yi=si.canonical.x+(1<<si.canonical.z)*(si.wrap-fi.wrap),Hi=si.canonical.y;zi.particleTexture0.bind(je.NEAREST,je.CLAMP_TO_EDGE);const en=Mo(1,zi.particleTexture0.size[0],[yi-Et,Hi-hi],0,ui.texture.size,2,Jt,ui.textureOffset,ui.scale,ui.offset);Kt.draw(ke,je.POINTS,sr.disabled,br.disabled,Fr.alphaBlended,rr.disabled,en,tt.id,zi.particleIndexBuffer,void 0,zi.particleSegment)}}}(T,I,F,me),j.bindFramebuffer.set(F.particleFramebuffer.framebuffer),function(ke,Ne,tt,He){const We=ke.context,je=We.gl,at=Ne.paint.get("raster-particle-max-speed"),gt=He*Ne.paint.get("raster-particle-speed-factor")*.15,Jt=function(fi){return Math.pow(fi,6)}(.01+1*Ne.paint.get("raster-particle-reset-rate-factor")),jt=Ne.particleFramebuffer;We.viewport.set([0,0,jt.width,jt.height]);for(const fi of tt){const[,ui,Pt]=fi;We.activeTexture.set(je.TEXTURE0+0),ui.texture.bind(je.LINEAR,je.CLAMP_TO_EDGE),We.activeTexture.set(je.TEXTURE0+1);const Kt=Pt.particleTexture0;Kt.bind(je.NEAREST,je.CLAMP_TO_EDGE);const Ii=bf(1,Kt.size[0],0,ui.texture.size,at,gt,Jt,ui.textureOffset,ui.scale,ui.offset);jt.colorAttachment.set(Pt.particleTexture1.texture),We.clear({color:r.aj.transparent}),ke.getOrCreateProgram("rasterParticleUpdate",{defines:ui.defines}).draw(ke,je.TRIANGLES,sr.disabled,br.disabled,Fr.unblended,rr.disabled,Ii,Ne.id,ke.viewportBuffer,ke.quadTriangleIndexBuffer,ke.viewportSegments)}}(T,F,me,De)}(d,i,a,f),d.renderPass==="translucent"&&(function(T,I,F,V,j){const Z=T.context,X=Z.gl,Q=I.getSource().tileSize,le=5*(1-r.ac(r.bY,r.bY+1,T.transform.zoom))*Q+F.paint.get("raster-particle-elevation"),se=!T.options.moving,me=T.transform.projection.name==="globe";if(!V.length)return;const[fe,De]=T.stencilConfigForOverlap(V),ke=[];me&&ke.push("PROJECTION_GLOBE_VIEW");const Ne=T.stencilModeFor3D();for(const tt of De){const He=tt.toUnwrapped(),We=I.getTile(tt);if(!We.rasterParticleState)continue;const je=We.rasterParticleState,at=100;We.registerFadeDuration(at);const gt=I.findLoadedParent(tt,0),Jt=ml(We,gt,I,T.transform,at);let jt,fi;T.terrain&&T.terrain.prepareDrawTile(),Z.activeTexture.set(X.TEXTURE0),je.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),Z.activeTexture.set(X.TEXTURE1),gt&&gt.rasterParticleState?(gt.rasterParticleState.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),jt=Math.pow(2,gt.tileID.overscaledZ-We.tileID.overscaledZ),fi=[We.tileID.canonical.x*jt%1,We.tileID.canonical.y*jt%1]):je.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const ui=me?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(He,se),Pt=T.transform,Kt=nd(Pt),Ii=r.cE(tt.canonical),Et=r.cF(Ii.getCenter().lat);let hi,si,an,zi,yi;me?(hi=Float32Array.from(r.bb(r.cH(tt.canonical))),si=Float32Array.from(Pt.globeMatrix),an=Float32Array.from(r.cD(Pt)),zi=[r.at(Pt.center.lng),r.aA(Pt.center.lat)],yi=Float32Array.from(r.cG(tt.canonical,Ii,Et,Pt.worldSize/Pt._pixelsPerMercatorPixel))):(hi=new Float32Array(16),si=new Float32Array(9),an=new Float32Array(16),zi=[0,0],yi=new Float32Array(9));const Hi=ys(ui,hi,si,an,yi,fi||[0,0],r.ae(T.transform.zoom),zi,Kt,jt||1,Jt,le),en=T.isTileAffectedByFog(tt),bn=T.getOrCreateProgram("rasterParticle",{defines:ke,overrideFog:en});if(T.uploadCommonUniforms(Z,bn,He),me){const Un=new sr(X.LEQUAL,sr.ReadOnly,T.depthRangeFor3D),fr=0,ur=T.globeSharedBuffers;if(ur){const[lr,wr,Tr]=ur.getGridBuffers(Et,fr!==0);bn.draw(T,X.TRIANGLES,Un,Ne,Fr.alphaBlended,T.renderElevatedRasterBackface?rr.frontCCW:rr.backCCW,Hi,F.id,lr,wr,Tr)}}else{const Un=T.depthModeForSublayer(0,sr.ReadOnly),fr=fe[tt.overscaledZ],{tileBoundsBuffer:ur,tileBoundsIndexBuffer:lr,tileBoundsSegments:wr}=T.getTileBoundsBuffers(We);bn.draw(T,X.TRIANGLES,Un,fr,Fr.alphaBlended,rr.disabled,Hi,F.id,ur,lr,wr)}}T.resetStencilClippingMasks()}(d,i,a,f),d.style.map.triggerRepaint())},background:function(d,i,a,f){const v=a.paint.get("background-color"),x=a.paint.get("background-color-use-theme").constantOr("default")==="none",T=a.paint.get("background-opacity"),I=a.paint.get("background-emissive-strength"),F=a.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const V=d.context,j=V.gl,Z=d.transform,X=Z.tileSize,Q=a.paint.get("background-pattern");let le;if(Q!==void 0&&(Q===null||(le=d.imageManager.getPattern(Q.toString(),a.scope,d.style.getLut(a.scope)),!le)))return;const se=!Q&&v.a===1&&T===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==se)return;const me=br.disabled,fe=d.depthModeForSublayer(0,se==="opaque"?sr.ReadWrite:sr.ReadOnly),De=d.colorModeForDrapableLayerRenderPass(I),ke=Q?"backgroundPattern":"background";let Ne,tt=f;if(tt||(Ne=d.getBackgroundTiles(),tt=Object.values(Ne).map(He=>He.tileID)),Q&&(V.activeTexture.set(j.TEXTURE0),d.imageManager.bind(d.context,a.scope)),F){const He=d.getOrCreateProgram(ke,{overrideFog:!1,overrideRtt:!0}),We=new Float32Array(r.ab.mat4.identity([])),je=new r.aG(0,0,0,0,0),at=Q?Hd(We,I,T,d,0,a.scope,le,F,{tileID:je,tileSize:X}):Gd(We,I,T,v.toRenderColor(x?null:a.lut));He.draw(d,j.TRIANGLES,fe,me,De,rr.disabled,at,a.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments)}else for(const He of tt){const We=d.isTileAffectedByFog(He),je=d.getOrCreateProgram(ke,{overrideFog:We}),at=He.toUnwrapped(),gt=f?He.projMatrix:d.transform.calculateProjMatrix(at);d.prepareDrawTile();const Jt=i?i.getTile(He):Ne?Ne[He.key]:new Yi(He,X,Z.zoom,d),jt=Q?Hd(gt,I,T,d,0,a.scope,le,F,{tileID:He,tileSize:X}):Gd(gt,I,T,v.toRenderColor(x?null:a.lut));d.uploadCommonUniforms(V,je,at);const{tileBoundsBuffer:fi,tileBoundsIndexBuffer:ui,tileBoundsSegments:Pt}=d.getTileBoundsBuffers(Jt);je.draw(d,j.TRIANGLES,fe,me,De,rr.disabled,jt,a.id,fi,ui,Pt)}},sky:function(d,i,a){const f=d._atmosphere?r.ae(d.transform.zoom):1,v=a.paint.get("sky-opacity")*f;if(v===0)return;const x=d.context,T=a.paint.get("sky-type"),I=new sr(x.gl.LEQUAL,sr.ReadOnly,[0,1]),F=d.frameCounter/1e3%1;T==="atmosphere"?d.renderPass==="offscreen"?a.needsSkyboxCapture(d)&&(function(V,j,Z,X){const Q=V.context,le=Q.gl;let se=j.skyboxFbo;if(!se){se=j.skyboxFbo=Q.createFramebuffer(32,32,!0,null),j.skyboxGeometry=new Xd(Q),j.skyboxTexture=Q.gl.createTexture(),le.bindTexture(le.TEXTURE_CUBE_MAP,j.skyboxTexture),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MAG_FILTER,le.LINEAR);for(let ke=0;ke<6;++ke)le.texImage2D(le.TEXTURE_CUBE_MAP_POSITIVE_X+ke,0,le.RGBA,32,32,0,le.RGBA,le.UNSIGNED_BYTE,null)}Q.bindFramebuffer.set(se.framebuffer),Q.viewport.set([0,0,32,32]);const me=j.getCenter(V,!0),fe=V.getOrCreateProgram("skyboxCapture"),De=new Float64Array(16);r.ab.mat4.identity(De),r.ab.mat4.rotateY(De,De,.5*-Math.PI),qs(V,j,fe,De,me,0),r.ab.mat4.identity(De),r.ab.mat4.rotateY(De,De,.5*Math.PI),qs(V,j,fe,De,me,1),r.ab.mat4.identity(De),r.ab.mat4.rotateX(De,De,.5*-Math.PI),qs(V,j,fe,De,me,2),r.ab.mat4.identity(De),r.ab.mat4.rotateX(De,De,.5*Math.PI),qs(V,j,fe,De,me,3),r.ab.mat4.identity(De),qs(V,j,fe,De,me,4),r.ab.mat4.identity(De),r.ab.mat4.rotateY(De,De,Math.PI),qs(V,j,fe,De,me,5),Q.viewport.set([0,0,V.width,V.height])}(d,a),a.markSkyboxValid(d)):d.renderPass==="sky"&&function(V,j,Z,X,Q){const le=V.context,se=le.gl,me=V.transform,fe=V.getOrCreateProgram("skybox");le.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_CUBE_MAP,j.skyboxTexture);const De=((ke,Ne,tt,He,We)=>({u_matrix:ke,u_sun_direction:Ne,u_cubemap:0,u_opacity:He,u_temporal_offset:We}))(me.skyboxMatrix,j.getCenter(V,!1),0,X,Q);V.uploadCommonUniforms(le,fe),fe.draw(V,se.TRIANGLES,Z,br.disabled,V.colorModeForRenderPass(),rr.backCW,De,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(d,a,I,v,F):T==="gradient"&&d.renderPass==="sky"&&function(V,j,Z,X,Q){const le=V.context,se=le.gl,me=V.transform,fe=V.getOrCreateProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new Xd(le)),le.activeTexture.set(se.TEXTURE0);let De=j.colorRampTexture;De||(De=j.colorRampTexture=new r.T(le,j.colorRamp,se.RGBA8)),De.bind(se.LINEAR,se.CLAMP_TO_EDGE);const ke=((Ne,tt,He,We,je)=>({u_matrix:Ne,u_color_ramp:0,u_center_direction:tt,u_radius:r.ai(He),u_opacity:We,u_temporal_offset:je}))(me.skyboxMatrix,j.getCenter(V,!1),j.paint.get("sky-gradient-radius"),X,Q);V.uploadCommonUniforms(le,fe),fe.draw(V,se.TRIANGLES,Z,br.disabled,V.colorModeForRenderPass(),rr.backCW,ke,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(d,a,I,v,F)},debug:function(d,i,a,f,v,x){for(let T=0;T<a.length;T++)if(v){const V=new r.aj(f.r*.8,f.g*.8,f.b*.8,1);Mc(d,i,a[T],f,-1,-1,x),Mc(d,i,a[T],f,-1,1,x),Mc(d,i,a[T],f,1,1,x),Mc(d,i,a[T],f,1,-1,x),Mc(d,i,a[T],V,0,0,x)}else Mc(d,i,a[T],f,0,0,x)},custom:function(d,i,a,f){const v=d.context,x=a.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&a.isDraped(i)){if(d.renderPass==="offscreen"){const T=x.prerender;if(T){if(d.setCustomLayerDefaults(),v.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const I=d.transform.pointMerc;T.call(x,v.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),r.ae(d.transform.zoom),[I.x,I.y],d.transform.pixelsPerMeterRatio)}else T.call(x,v.gl,d.transform.customLayerMatrix());v.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const I=x.renderToTile;if(I){const F=f[0].canonical,V=new r.aa(F.x+f[0].wrap*(1<<F.z),F.y,F.z);v.setDepthMode(sr.disabled),v.setStencilMode(br.disabled),v.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),I.call(x,v.gl,V),v.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),v.setColorMode(d.colorModeForRenderPass()),v.setStencilMode(br.disabled);const T=x.renderingMode==="3d"?new sr(d.context.gl.LEQUAL,sr.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,sr.ReadOnly);if(v.setDepthMode(T),d.transform.projection.name==="globe"){const I=d.transform.pointMerc;x.render(v.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),r.ae(d.transform.zoom),[I.x,I.y],d.transform.pixelsPerMeterRatio)}else x.render(v.gl,d.transform.customLayerMatrix());v.setDirty(),d.setBaseState(),v.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,i,a,f){if(d.renderPass==="opaque")return;const v=a.paint.get("model-opacity").constantOr(1);if(v===0)return;const x=a.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!x||d.terrain&&v<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof r.a9))return;const T=d.shadowRenderer,I=a.paint.get("model-receive-shadows");T&&(T.useNormalOffset=!0,I||(T.enabled=!1));const F=()=>{T&&(T.useNormalOffset=!0,I||(T.enabled=!0))},V=i.getSource();if(d.renderPass==="light-beam"&&V.type!=="batched-model")return;if(V.type==="vector"||V.type==="geojson")return function(fe,De,ke,Ne,tt){const He=fe.transform;if(He.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${He.projection.name} projection is not yet implemented`);const We=He.getFreeCameraOptions().position;if(!fe.modelManager)return;const je=fe.modelManager;ke.modelManager=je;const at=fe.shadowRenderer;if(!ke._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const gt=ke._unevaluatedLayout._values["model-id"],Jt=Object.assign({},ke.layout.get("model-id").parameters),jt=fe.style.order.indexOf(ke.fqid);for(const fi of Ne){const ui=De.getTile(fi).getBucket(ke);if(!ui||ui.projection.name!==He.projection.name)continue;const Pt=ui.getModelUris();Pt&&!ui.modelsRequested&&(je.addModelsFromBucket(Pt,tt),ui.modelsRequested=!0);const Kt=Dh(fi,He);Jt.zoom=Kt;const Ii=gt.possiblyEvaluate(Jt);if(jc(fe,ui,fi),Fo.shadowUniformsInitialized=!1,Fo.useSingleShadowCascade=!!at&&at.getMaxCascadeForTile(fi.toUnwrapped())===0,fe.renderPass==="shadow"&&at){if(fe.currentShadowCascade===1&&ui.isInsideFirstShadowMapFrustum)continue;const si=He.calculatePosMatrix(fi.toUnwrapped(),He.worldSize);if(Fo.tileMatrix.set(si),Fo.shadowTileMatrix=Float32Array.from(at.calculateShadowPassMatrixFromMatrix(si)),Fo.aabb.min.fill(0),Fo.aabb.max[0]=Fo.aabb.max[1]=r.ag,Fo.aabb.max[2]=0,Tf(ui,Fo,fe,ke.scope))continue}const Et=1<<fi.canonical.z,hi=[((We.x-fi.wrap)*Et-fi.canonical.x)*r.ag,(We.y*Et-fi.canonical.y)*r.ag,We.z*Et*r.ag];fe.conflationActive&&Object.keys(ui.instancesPerModel).length>0&&fe.style.isLayerClipped(ke,De.getSource())&&ui.updateReplacement(fi,fe.replacementSource,jt,tt)&&(ui.uploaded=!1,ui.upload(fe.context));for(let si in ui.instancesPerModel){const an=ui.instancesPerModel[si];an.features.length>0&&(si=Ii.evaluate(an.features[0].feature,{}));const zi=je.getModel(si,tt);if(zi&&zi.uploaded)for(const yi of zi.nodes)Sc(fe,ke,yi,an,hi,fi,Fo)}}}(d,i,a,f,V.type==="vector"?a.scope:""),void F();if(!V.loaded())return;if(V.type==="batched-model")return function(fe,De,ke,Ne){ke.resetLayerRenderingStats(fe);const tt=fe.context,He=fe.transform,We=fe.style.fog,je=fe.shadowRenderer;if(He.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${He.projection.name} projection is not yet implemented`);const at=fe.transform.getFreeCameraOptions().position,gt=r.ab.vec3.scale([],[at.x,at.y,at.z],fe.transform.worldSize),Jt=r.ab.vec3.negate([],gt),jt=r.ab.mat4.identity([]),fi=r.dj(He.center.lat,He.zoom),ui=r.ab.mat4.fromScaling([],[1,1,1/fi]);r.ab.mat4.translate(jt,jt,Jt);const Pt=ke.paint.get("model-opacity").constantOr(1),Kt=new sr(tt.gl.LEQUAL,sr.ReadWrite,fe.depthRangeFor3D),Ii=new sr(tt.gl.LEQUAL,sr.ReadOnly,fe.depthRangeFor3D),Et=new r.cd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),hi=fe.renderPass==="shadow",si=hi&&je?je.getCurrentCascadeFrustum():He.getFrustum(He.scaleZoom(He.worldSize)),an=ke.paint.get("model-front-cutoff"),zi=an[2]<1,yi=yc(fe,ke.paint.get("model-cutoff-fade-range")),Hi=ke.getLayerRenderingStats();(function(en,bn,Un,fr){const ur=en.terrain?en.terrain.exaggeration():0,lr=en.transform.zoom;for(const wr of fr){const Tr=bn.getTile(wr).getBucket(Un);Tr&&(en.conflationActive&&Tr.updateReplacement(wr,en.replacementSource),Tr.evaluateScale(en,Un),en.terrain&&ur>0&&Tr.elevationUpdate(en.terrain,ur,wr,Un.source),Tr.needsReEvaluation(en,lr,Un)&&Tr.evaluate(Un))}})(fe,De,ke,Ne),function(){let en,bn,Un;zi?(en=Ne.length-1,bn=-1,Un=-1):(en=0,bn=Ne.length,Un=1);const fr=new Float64Array(16),ur=r.ab.vec3.create(),lr=new r.P(0,0);for(let wr=en;wr!==bn;wr+=Un){const Tr=Ne[wr],za=De.getTile(Tr).getBucket(ke);if(!za||!za.uploaded)continue;let Ss=!1;je&&(Ss=je.getMaxCascadeForTile(Tr.toUnwrapped())===0);const qa=He.calculatePosMatrix(Tr.toUnwrapped(),He.worldSize),Pr=za.modelTraits;!hi&&zi&&(r.ab.mat4.invert(fr,qa),r.ab.vec3.transformMat4(ur,gt,fr),lr.x=ur[0],lr.y=ur[1]);const ba=[];for(const In of za.getNodesInfo()){if(In.hiddenByReplacement||!In.node.meshes)continue;const _r=In.node;let pr=0;fe.terrain&&_r.elevation&&(pr=_r.elevation*fe.terrain.exaggeration());const yr=(()=>{const ha=In.aabb;return Et.min=[...ha.min],Et.max=[...ha.max],Et.min[2]+=pr,Et.max[2]+=pr,r.ab.vec3.transformMat4(Et.min,Et.min,qa),r.ab.vec3.transformMat4(Et.max,Et.max,qa),Et})(),Jr=In.evaluatedScale;if(Jr[0]<=1&&Jr[1]<=1&&Jr[2]<=1&&yr.intersects(si)===0)continue;if(!hi&&zi){const ha=.16666666666666666;In.cameraCollisionOpacity=gt[0]>yr.min[0]&&gt[0]<yr.max[0]&&gt[1]>yr.min[1]&&gt[1]<yr.max[1]&&gt[2]*fi<yr.max[2]&&_r.footprint&&r.bA(lr,_r.footprint)?Math.max(In.cameraCollisionOpacity-ha,0):Math.min(1,In.cameraCollisionOpacity+ha)}const is=[...qa],ns=_r.anchor?_r.anchor[0]:0,Es=_r.anchor?_r.anchor[1]:0;r.ab.mat4.translate(is,is,[ns*(Jr[0]-1),Es*(Jr[1]-1),pr]),r.ab.vec3.exactEquals(Jr,r.dm)||r.ab.mat4.scale(is,is,Jr);const el=r.ab.mat4.multiply([],is,_r.matrix),Ps=r.ab.mat4.multiply([],He.expandedFarZProjMatrix,el),da=r.ab.mat4.multiply([],He.expandedFarZProjMatrix,is),Pa=r.ab.vec4.transformMat4([],[ns,Es,pr,1],Ps)[2];_r.hidden=!1;let Sa=Pt;hi||(zi&&(Sa*=In.cameraCollisionOpacity,Sa*=hd(is,He,In.aabb,an)),Sa*=qc(yi,Pa)),Sa!==0?ba.push({nodeInfo:In,depth:Pa,opacity:Sa,wvpForNode:Ps,wvpForTile:da,nodeModelMatrix:el,tileModelMatrix:is}):_r.hidden=!0}hi||ba.sort((In,_r)=>!zi||In.opacity===1&&_r.opacity===1?In.depth<_r.depth?-1:1:In.opacity===1?-1:_r.opacity===1?1:In.depth>_r.depth?-1:1);for(const In of ba){const _r=In.nodeInfo,pr=_r.node;let yr=r.ab.mat4.multiply([],ui,In.tileModelMatrix);r.ab.mat4.multiply(yr,jt,yr);const Jr=r.ab.mat4.invert([],yr);r.ab.mat4.transpose(Jr,Jr),r.ab.mat4.scale(Jr,Jr,Yd),yr=r.ab.mat4.multiply(yr,yr,pr.matrix);const is=fe.renderPass==="light-beam",ns=ke.paint.get("model-color-use-theme").constantOr("default")==="none",Es=Pr&r.dp.HasMapboxMeshFeatures,el=Es?0:_r.evaluatedRMEA[0][2];for(let Ps=0;Ps<pr.meshes.length;++Ps){const da=pr.meshes[Ps],Pa=Ps===pr.lightMeshIndex;let Sa=In.wvpForNode;if(Pa){if(!is&&!fe.terrain&&fe.shadowRenderer){fe.currentLayer<fe.firstLightBeamLayer&&(fe.firstLightBeamLayer=fe.currentLayer);continue}Sa=In.wvpForTile}else if(is)continue;const ha={defines:[]},Xa=[];if(!hi&&je&&(je.useNormalOffset=!!da.normalBuffer),Rh(ha.defines,Xa,da,fe,ns?null:ke.lut),Es||ha.defines.push("DIFFUSE_SHADED"),Ss&&ha.defines.push("SHADOWS_SINGLE_CASCADE"),Hi&&(hi?Hi.numRenderedVerticesInShadowPass+=da.vertexArray.length:Hi.numRenderedVerticesInTransparentPass+=da.vertexArray.length),hi){Tc(da,In.nodeModelMatrix,fe,ke);continue}let Os=null;if(We){const $l=du(In.nodeModelMatrix,fe.transform);if(Os=new Float32Array($l),He.projection.name!=="globe"){const Eo=da.aabb.min,hl=da.aabb.max,[Kl,Bl]=We.getOpacityForBounds($l,Eo[0],Eo[1],hl[0],hl[1]);ha.overrideFog=Kl>=Qe||Bl>=Qe}}const Oa=da.material;let ks;Oa.occlusionTexture&&Oa.occlusionTexture.offsetScale&&(ks=Oa.occlusionTexture.offsetScale,ha.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const ul=fe.getOrCreateProgram("model",ha);!hi&&je&&je.setupShadowsFromMatrix(In.tileModelMatrix,ul,je.useNormalOffset),fe.uploadCommonUniforms(tt,ul,null,Os);const tl=Oa.pbrMetallicRoughness;tl.metallicFactor=.9,tl.roughnessFactor=.5;const No=jd(new Float32Array(Sa),new Float32Array(yr),new Float32Array(Jr),new Float32Array(pr.matrix),fe,In.opacity,tl.baseColorFactor.toRenderColor(null),Oa.emissiveFactor,tl.metallicFactor,tl.roughnessFactor,Oa,el,ke,[0,0,0],ks);!Pa&&(_r.hasTranslucentParts||In.opacity<1)&&ul.draw(fe,tt.gl.TRIANGLES,Kt,br.disabled,Fr.disabled,rr.backCCW,No,ke.id,da.vertexBuffer,da.indexBuffer,da.segments,ke.paint,fe.transform.zoom,void 0,Xa),ul.draw(fe,tt.gl.TRIANGLES,Pa?Ii:Kt,br.disabled,Pa||In.opacity<1||_r.hasTranslucentParts?Fr.alphaBlended:Fr.unblended,rr.backCCW,No,ke.id,da.vertexBuffer,da.indexBuffer,da.segments,ke.paint,fe.transform.zoom,void 0,Xa)}}}}()}(d,i,a,f),void F();if(V.type!=="model")return;const j=V.getModels(),Z=[],X=d.transform.getFreeCameraOptions().position,Q=r.ab.vec3.scale([],[X.x,X.y,X.z],d.transform.worldSize);r.ab.vec3.negate(Q,Q);const le=[],se=[];let me=0;for(const fe of j){const De=a.paint.get("model-rotation").constantOr(null),ke=a.paint.get("model-scale").constantOr(null),Ne=a.paint.get("model-translation").constantOr(null);fe.computeModelMatrix(d,De,ke,Ne,!0,!0,!1);const tt=r.ab.mat4.identity([]),He=r.dj(fe.position.lat,d.transform.zoom),We=r.ab.mat4.fromScaling([],[1,1,1/He]);r.ab.mat4.translate(tt,tt,Q),Z.push({zScaleMatrix:We,negCameraPosMatrix:tt});for(const je of fe.nodes)Ih(d.transform,je,fe.matrix,d.transform.expandedFarZProjMatrix,me,le,se);me++}if(le.sort((fe,De)=>De.depth-fe.depth),d.renderPass!=="shadow"){if(v===1)for(const fe of se)Wl(fe,d,a,Z[fe.modelIndex],br.disabled,d.colorModeForRenderPass());else{for(const fe of se)Wl(fe,d,a,Z[fe.modelIndex],br.disabled,Fr.disabled);for(const fe of se)Wl(fe,d,a,Z[fe.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}for(const fe of le)Wl(fe,d,a,Z[fe.modelIndex],br.disabled,d.colorModeForRenderPass());F()}else{for(const fe of se)Tc(fe.mesh,fe.nodeModelMatrix,d,a);for(const fe of le)Tc(fe.mesh,fe.nodeModelMatrix,d,a);F()}}},pu={line:function(d,i,a){if(d.hasElevatedBuckets=!1,d.hasNonElevatedBuckets=!1,d._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||d._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(i){const f=i.getVisibleCoordinates();for(const v of f){const x=i.getTile(v).getBucket(d);if(x&&(x.hasZOffset?d.hasElevatedBuckets=!0:d.hasNonElevatedBuckets=!0,d.hasElevatedBuckets&&d.hasNonElevatedBuckets))break}}}else d.hasNonElevatedBuckets=!0},model:function(d,i,a){const f=i.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,f.type==="vector"?d.scope:""));if(f.type==="batched-model"||f.type!=="model")return;const v=f.getModels();for(const x of v)x.upload(a.context)},raster:function(d,i,a){const f=i.getSource();if(!(f instanceof Ia&&f.loaded()))return;const v=d.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!v)return;const x=d.paint.get("raster-array-band")||f.getInitialBand(v);if(x==null)return;const T=i.getIds().map(I=>i.getTileByID(I));for(const I of T)I.updateNeeded(v,x)&&f.prepareTile(I,v,x)},"raster-particle":function(d,i,a){const f=i.getSource();if(!(f instanceof Ia&&f.loaded()))return;const v=d.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!v)return;const x=d.paint.get("raster-particle-array-band")||f.getInitialBand(v);if(x==null)return;const T=i.getIds().map(I=>i.getTileByID(I));for(const I of T)I.updateNeeded(v,x)&&f.prepareTile(I,v,x)}};class Sf{constructor(i,a,f,v,x){this.context=new qd(i,a),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=x,this._timeStamp=r.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const T=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const F of T)this._debugParams.enabledLayers[F]=!0;x.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),x.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),x.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),x.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const F of T)x.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],F);this.occlusionParams=new Wu(x),this.setup(),this.numSublayers=he.maxUnderzooming+he.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.dv,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Kr(this),this._wireframeDebugCache=new go,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const I=new r.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,I,i.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=v}updateTerrain(i,a){const f=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ac(this,i));const v=this._terrain;this.transform.elevation=f?v:null,v.update(i,this.transform,a),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(i){const a=i.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,v]=a.getFovAdjustedRange(this.transform._fov);if(f>v)return void(this.transform.fogCullDistSq=null);const x=f+.78*(v-f);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(i){i&&!this._terrain&&(this._terrain=new ac(this,this.style)),this._forceTerrainMode=i}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,a){if(this.width=i*r.q.devicePixelRatio,this.height=a*r.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._mergedLayers[f].resize()}setup(){const i=this.context,a=new r.b4;a.emplaceBack(0,0),a.emplaceBack(r.ag,0),a.emplaceBack(0,r.ag),a.emplaceBack(r.ag,r.ag),this.tileExtentBuffer=i.createVertexBuffer(a,r.b6.members),this.tileExtentSegments=r.b7.simpleSegment(0,0,4,2);const f=new r.b4;f.emplaceBack(0,0),f.emplaceBack(r.ag,0),f.emplaceBack(0,r.ag),f.emplaceBack(r.ag,r.ag),this.debugBuffer=i.createVertexBuffer(f,r.b6.members),this.debugSegments=r.b7.simpleSegment(0,0,4,5);const v=new r.b4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(v,r.b6.members),this.viewportSegments=r.b7.simpleSegment(0,0,4,2);const x=new r.aT;x.emplaceBack(0,0,0,0),x.emplaceBack(r.ag,0,r.ag,0),x.emplaceBack(0,r.ag,0,r.ag),x.emplaceBack(r.ag,r.ag,r.ag,r.ag),this.mercatorBoundsBuffer=i.createVertexBuffer(x,r.b9.members),this.mercatorBoundsSegments=r.b7.simpleSegment(0,0,4,2);const T=new r.aU;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(T);const I=new r.b5;for(const V of[0,1,3,2,0])I.emplaceBack(V);this.debugIndexBuffer=i.createIndexBuffer(I),this.emptyTexture=new r.T(i,new r.r({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA8),this.identityMat=r.ab.mat4.create();const F=this.context.gl;this.stencilClearMode=new br({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,sr.disabled,this.stencilClearMode,Fr.disabled,rr.disabled,Fd(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,a,f){if(!a||this.currentStencilSource===a.id||!i.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const F of f)if(this._tileClippingMaskIDs[F.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=a.id;const v=this.context,x=v.gl;this.nextStencilID+f.length>256&&this.clearStencil(),v.setColorMode(Fr.disabled),v.setDepthMode(sr.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of f){const F=a.getTile(I),V=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:j,tileBoundsIndexBuffer:Z,tileBoundsSegments:X}=this.getTileBoundsBuffers(F);T.draw(this,x.TRIANGLES,sr.disabled,new br({func:x.ALWAYS,mask:0},V,255,x.KEEP,x.KEEP,x.REPLACE),Fr.disabled,rr.disabled,Fd(I.projMatrix),"$clipping",j,Z,X)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,a=this.context.gl;return new br({func:a.NOTEQUAL,mask:255},i,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const a=this.context.gl;return new br({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(i){const a=this.context.gl,f=i.sort((T,I)=>I.overscaledZ-T.overscaledZ),v=f[f.length-1].overscaledZ,x=f[0].overscaledZ-v+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const T={};for(let I=0;I<x;I++)T[I+v]=new br({func:a.GEQUAL,mask:255},I+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=x,[T,f]}return[{[v]:br.disabled},f]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Fr([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new r.aj(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Fr.unblended:Fr.alphaBlended}colorModeForDrapableLayerRenderPass(i){const a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Fr([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new r.aj(0,0,0,i===void 0?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,a,f,v=!1){if(this.depthOcclusion)return new sr(this.context.gl.GREATER,sr.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return sr.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new sr(f||this.context.gl.LEQUAL,a,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const i=this.context.gl,a=Math.ceil(this.width),f=Math.ceil(this.height),v=this.context.bindFramebuffer.get(),x=i.getParameter(i.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===a&&this.depthFBO.height===f||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),a!==0&&f!==0&&(this.depthFBO=new vp(this.context,a,f,!1,"texture"),this.depthTexture=new r.T(this.context,{width:a,height:f,data:null},i.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(v),i.bindTexture(i.TEXTURE_2D,x),this.depthFBO&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),i.blitFramebuffer(0,0,a,f,0,0,a,f,i.DEPTH_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((i,a)=>i+a/this._fpsHistory.length,0))}render(i,a){const f=r.q.now();this._dt=f-this._timeStamp,this._timeStamp=f,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=a;const v=this.style._mergedLayers,x=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(x).filter(Pt=>{const Kt=v[Pt];return!(Kt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Kt.type]});let I=T(),F=!1,V=!1;for(const Pt of I){const Kt=v[Pt];Kt.type==="circle"&&(F=!0),Kt.type==="symbol"&&(Kt.hasInitialOcclusionOpacityProperties?V=!0:F=!0)}let j=I.map(Pt=>v[Pt]);const Z=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(r.q.now()),this.imageManager.beginFrame();let X=0,Q=!1;for(const Pt in Z){const Kt=Z[Pt];Kt.used&&(Kt.prepare(this.context),Kt.getSource().usedInConflation&&++X)}let le=!1;for(const Pt of j)Pt.isHidden(this.transform.zoom)||(Pt.type==="clip"&&(le=!0),this.prepareLayer(Pt));const se={},me={},fe={},De={},ke={};for(const Pt in Z){const Kt=Z[Pt];se[Pt]=Kt.getVisibleCoordinates(),me[Pt]=se[Pt].slice().reverse(),fe[Pt]=Kt.getVisibleCoordinates(!0).reverse(),De[Pt]=Kt.getShadowCasterCoordinates(),ke[Pt]=Kt.sortCoordinatesByDistance(se[Pt])}const Ne=Pt=>{const Kt=this.style.getLayerSourceCache(Pt);return Kt&&Kt.used?Kt.getSource():null};if(X||le||this._clippingActiveLastFrame){const Pt=[],Kt=[];let Ii=0;for(const Et of j)this.isSourceForClippingOrConflation(Et,Ne(Et))&&(Pt.push(Et),Kt.push(Ii)),Ii++;if(Pt&&(le||Pt.length>1)||this._clippingActiveLastFrame){le=!1;const Et=[];for(let hi=0;hi<Pt.length;hi++){const si=Pt[hi],an=Kt[hi],zi=this.style.getLayerSourceCache(si);if(!zi||!zi.used||!zi.getSource().usedInConflation&&si.type!=="clip")continue;let yi=r.dx,Hi=r.by.None;const en=[];let bn=!0;if(si.type==="clip"){yi=an;for(const Un of si.layout.get("clip-layer-types"))Hi|=Un==="model"?r.by.Model:Un==="symbol"?r.by.Symbol:r.by.FillExtrusion;for(const Un of si.layout.get("clip-layer-scope"))en.push(Un);si.isHidden(this.transform.zoom)?bn=!1:le=!0}bn&&Et.push({layer:si.fqid,cache:zi,order:yi,clipMask:Hi,clipScope:en})}this.replacementSource.setSources(Et),Q=!0}}this._clippingActiveLastFrame=le,Q||this.replacementSource.clear(),this.conflationActive=Q,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Pt=0;Pt<j.length;Pt++){const Kt=j[Pt],Ii=Kt.cutoffRange();if(this.longestCutoffRange=Math.max(Ii,this.longestCutoffRange),Ii>0){const Et=Ne(Kt);Et&&(this.minCutoffZoom=Math.max(Et.minzoom,this.minCutoffZoom)),Kt.minzoom&&(this.minCutoffZoom=Math.max(Kt.minzoom,this.minCutoffZoom))}Kt.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Pt),this._lastOcclusionLayer=Pt)}const tt=this.style&&this.style.fog;tt?(this._fogVisible=tt.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=tt.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(fe),this.opaquePassCutoff=0,I=T(),j=I.map(Pt=>v[Pt]));const He=this._shadowRenderer;if(He){He.updateShadowParameters(this.transform,this.style.directionalLight);for(const Pt in Z)for(const Kt of se[Pt]){let Ii={min:0,max:0};this.terrain&&(Ii=this.terrain.getMinMaxForTile(Kt)||Ii),He.addShadowReceiver(Kt.toUnwrapped(),Ii.min,Ii.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.dw(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Mf(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const We=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),je=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(We&&!this._snow&&(this._snow=new Cc(this)),!We&&this._snow&&(this._snow.destroy(),delete this._snow),je&&!this._rain&&(this._rain=new zh(this)),!je&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!jr.has(this.context.gl))return;this.renderPass="offscreen";for(const Pt of j){const Kt=i.getLayerSourceCache(Pt);if(!Pt.hasOffscreenPass()||Pt.isHidden(this.transform.zoom))continue;const Ii=Kt?me[Kt.id]:void 0;(Pt.type==="custom"||Pt.type==="raster"||Pt.type==="raster-particle"||Pt.isSky()||Ii&&Ii.length)&&this.renderLayer(this,Kt,Pt,Ii)}this.depthRangeFor3D=[0,1-(j.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,De)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const at=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),gt=(()=>{if(a.showOverdrawInspector)return r.aj.black;const Pt=this.style.fog;if(Pt&&this.transform.projection.supportsFog){const Kt=this.style.getLut(Pt.scope);if(!at){const Ii=Pt.properties.get("color-use-theme")==="none",Et=Pt.properties.get("color").toRenderColor(Ii?null:Kt).toArray01();return new r.aj(...Et)}if(at){const Ii=Pt.properties.get("space-color-use-theme")==="none",Et=Pt.properties.get("space-color").toRenderColor(Ii?null:Kt).toArray01();return new r.aj(...Et)}}return r.aj.transparent})();if(this.context.clear({color:gt,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&at&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const Pt=j[this.currentLayer],Kt=i.getLayerSourceCache(Pt);if(Pt.isSky())continue;const Ii=Kt?(Pt.is3D()?ke:me)[Kt.id]:void 0;this._renderTileClippingMasks(Pt,Kt,Ii),this.renderLayer(this,Kt,Pt,Ii)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&at&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.ae(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const Pt=j[this.currentLayer],Kt=i.getLayerSourceCache(Pt);Pt.isSky()&&this.renderLayer(this,Kt,Pt,Kt?me[Kt.id]:void 0)}function Jt(Pt,Kt){let Ii;return Kt&&(Ii=(Pt.type==="symbol"?fe:Pt.is3D()?ke:me)[Kt.id]),Ii}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<I.length;){const Pt=j[this.currentLayer];if(Pt.type==="raster"||Pt.type==="raster-particle"){const Kt=i.getLayerSourceCache(Pt);this.renderLayer(this,Kt,Pt,Jt(Pt,Kt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let jt=0;He&&(jt=He.getShadowCastingLayerCount());let fi=!1,ui=-1;for(let Pt=0;Pt<I.length;++Pt){const Kt=j[Pt];Kt.isHidden(this.transform.zoom)||Kt.is3D()&&(ui=Pt)}for(V&&ui===-1&&(F=!0);this.currentLayer<I.length;){const Pt=j[this.currentLayer],Kt=i.getLayerSourceCache(Pt);if(Pt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Pt)){if(Pt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(F&&!fi&&this.terrain&&!this.transform.isOrthographic&&(fi=!0,this.blitDepth()),V&&ui!==-1&&this.currentLayer===ui+1&&!this.transform.isOrthographic&&this.blitDepth(),Pt.is3D()||this.terrain||this._renderTileClippingMasks(Pt,Kt,Kt?se[Kt.id]:void 0),this.renderLayer(this,Kt,Pt,Jt(Pt,Kt)),!this.terrain&&He&&jt>0&&Pt.hasShadowPass()&&--jt==0&&(He.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Ii=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ii;this.currentLayer++){const Et=j[this.currentLayer];if(!Et.hasLightBeamPass())continue;const hi=i.getLayerSourceCache(Et);this.renderLayer(this,hi,Et,hi?me[hi.id]:void 0)}this.currentLayer=Ii,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ii=this.currentLayer;this.depthOcclusion=!0;for(const Et of this.layersWithOcclusionOpacity){this.currentLayer=Et;const hi=j[this.currentLayer],si=i.getLayerSourceCache(hi),an=si?me[si.id]:void 0;hi.is3D()||this.terrain||this._renderTileClippingMasks(hi,si,si?se[si.id]:void 0),this.renderLayer(this,si,hi,an)}this.depthOcclusion=!1,this.currentLayer=Ii,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Pt=null;j.forEach(Kt=>{const Ii=i.getLayerSourceCache(Kt);Ii&&!Kt.isHidden(this.transform.zoom)&&Ii.getVisibleCoordinates().length&&(!Pt||Pt.getSource().maxzoom<Ii.getSource().maxzoom)&&(Pt=Ii)}),Pt&&this.options.showTileBoundaries&&Wc.debug(this,Pt,Pt.getVisibleCoordinates(),r.aj.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Wc.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.aj(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Pt){const Kt=Pt.transform.padding;od(Pt,Pt.transform.height-(Kt.top||0),3,lc),od(Pt,Kt.bottom||0,3,rd),ld(Pt,Kt.left||0,3,ad),ld(Pt,Pt.transform.width-(Kt.right||0),3,sd);const Ii=Pt.transform.centerPoint;(function(Et,hi,si,an){cc(Et,hi-1,si-10,2,20,an),cc(Et,hi-10,si-1,20,2,an)})(Pt,Ii.x,Pt.transform.height-Ii.y,Zd)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Q||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);const{unsupportedLayers:a}=this.transform.projection,f=!a||!a.includes(i.type);if(pu[i.type]&&(f||this.terrain&&i.type==="custom")){const v=this.style.getLayerSourceCache(i);pu[i.type](i,v,this)}this.gpuTimingEnd()}renderLayer(i,a,f,v){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||v&&v.length)&&(this.id=f.id,this.gpuTimingStart(f),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(f.type)&&(!i.terrain||f.type!=="custom")||f.type==="clip"||Wc[f.type](i,a,f,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery,f=this.context.gl;let v=this.gpuTimers[i.id];v||(v=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:f.createQuery()}),v.calls++,f.beginQuery(a.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,a=this.context.gl,f=a.createQuery();this.deferredRenderGpuTimeQueries.push(f),a.beginQuery(i.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const a={};for(const f in i){const v=i[f],x=this.context.extTimerQuery,T=x.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(v.query),a[f]=T}return a}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.gl;let f=0;for(const v of i)f+=a.getQueryParameter(v,a.QUERY_RESULT)/1e6,a.deleteQuery(v);return f}translatePosMatrix(i,a,f,v,x){if(!f[0]&&!f[1])return i;const T=x?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(T){const V=Math.sin(T),j=Math.cos(T);f=[f[0]*j-f[1]*V,f[0]*V+f[1]*j]}const I=[x?f[0]:r.ar(a,f[0],this.transform.zoom),x?f[1]:r.ar(a,f[1],this.transform.zoom),0],F=new Float32Array(16);return r.ab.mat4.translate(F,i,I),F}saveTileTexture(i){const a=i.size[0],f=this._tileTextures[a];f?f.push(i):this._tileTextures[a]=[i]}getTileTexture(i){const a=this._tileTextures[i];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,a,f){const v=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,x=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||x.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||v||a!==void 0&&!a||x.push("FOG","FOG_DITHERING"),v&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(i,a){this.cache=this.cache||{};const f=a&&a.defines||[],v=a&&a.config,x=this.currentGlobalDefines(i,a&&a.overrideFog,a&&a.overrideRtt).concat(f),T=yp.cacheKey(nc[i],i,x,v);return this.cache[T]||(this.cache[T]=new yp(this.context,i,nc[i],v,wf[i],x)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,a){if(this.style.enable3dLights()){const f=this.style.directionalLight,v=this.style.ambientLight;if(f&&v){const x=((T,I,F)=>{const V=T.properties.get("direction"),j=T.properties.get("color-use-theme")==="none",Z=T.properties.get("color").toRenderColor(j?null:F.getLut(T.scope)).toArray01(),X=T.properties.get("intensity"),Q=I.properties.get("color-use-theme")==="none",le=I.properties.get("color").toRenderColor(Q?null:F.getLut(I.scope)).toArray01(),se=I.properties.get("intensity"),me=[V.x,V.y,V.z],fe=r.cM(le,se),De=r.cM(Z,X);return{u_lighting_ambient_color:fe,u_lighting_directional_dir:me,u_lighting_directional_color:De,u_ground_radiance:Uu(me,De,fe)}})(f,v,this.style);a.setLightsUniformValues(i,x)}}}uploadCommonUniforms(i,a,f,v,x){if(this.uploadCommonLightUniforms(i,a),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const I=T.getOpacity(this.transform.pitch),F=((V,j,Z,X,Q,le,se,me,fe,De,ke,Ne)=>{const tt=V.transform,He=j.properties.get("color-use-theme")==="none",We=j.properties.get("color").toRenderColor(He?null:V.style.getLut(j.scope)).toArray01();We[3]=X;const je=V.frameCounter/1e3%1,[at,gt]=j.properties.get("vertical-range");return{u_fog_matrix:Z?tt.calculateFogTileMatrix(Z):Ne||V.identityMat,u_fog_range:j.getFovAdjustedRange(tt._fov),u_fog_color:We,u_fog_horizon_blend:j.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(at,gt),gt],u_fog_temporal_offset:je,u_frustum_tl:Q,u_frustum_tr:le,u_frustum_br:se,u_frustum_bl:me,u_globe_pos:fe,u_globe_radius:De,u_viewport:ke,u_globe_transition:r.ae(tt.zoom),u_is_globe:+(tt.projection.name==="globe")}})(this,T,f,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.q.devicePixelRatio,this.transform.height*r.q.devicePixelRatio],v);a.setFogUniformValues(i,F)}x&&a.setCutoffUniformValues(i,x.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,a=i.createTexture();return i.bindTexture(i.TEXTURE_2D,a),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,a=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const v of f)a[v.key]=i[v.key]||new Yi(v,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(i,a){return!(!i.is3D()||i.type!=="clip"&&(i.minzoom&&i.minzoom>this.transform.zoom||(this.style._clipLayerPresent||i.sourceLayer!=="building")&&(!a||a.type!=="batched-model")))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[i.key];return a||(this._cachedTileFogOpacities[i.key]=a=this.style.fog.getOpacityForTile(i)),a[0]>=Qe||a[1]>=Qe}setupDepthForOcclusion(i,a,f){const v=this.context,x=v.gl,T=!!f;var I;f||(f={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),v.activeTexture.set(x.TEXTURE3),i&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),f.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],f.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],f.u_occluder_half_size=.5*this.occlusionParams.occluderSize,f.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),v.activeTexture.set(x.TEXTURE0),T||a.setTerrainUniformValues(v,f)}}function Jd(d,i){let a=!1,f=null;const v=()=>{f=null,a&&(d(),f=setTimeout(v,i),a=!1)};return()=>(a=!0,f||v(),f)}class pd{constructor(i){this._hashName=i&&encodeURIComponent(i),r.aP(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Jd(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const a=Ef(i);if(this._hashName){const f=this._hashName;let v=!1;const x=location.hash.slice(1).split("&").map(T=>{const I=T.split("=")[0];return I===f?(v=!0,`${I}=${a}`):T}).filter(T=>T);return v||x.push(`${f}=${a}`),`#${x.join("&")}`}return`#${a}`}_getCurrentHash(){const i=location.hash.replace("#","");if(this._hashName){let a;return i.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(a=f)}),(a&&a[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(f=>isNaN(f))){const f=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(a[3]||0):i.getBearing();return i.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:f,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ef(d,i){const a=d.getCenter(),f=Math.round(100*d.getZoom())/100,v=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,v),T=Math.round(a.lng*x)/x,I=Math.round(a.lat*x)/x,F=d.getBearing(),V=d.getPitch();let j=i?`/${T}/${I}/${f}`:`${f}/${I}/${T}`;return(F||V)&&(j+="/"+Math.round(10*F)/10),V&&(j+=`/${Math.round(V)}`),j}const Ph={linearity:.3,easing:r.dy(0,0,.3,1)},Oh=r.l({deceleration:2500,maxSpeed:1400},Ph),mu=r.l({deceleration:20,maxSpeed:1400},Ph),md=r.l({deceleration:1e3,maxSpeed:360},Ph),Lc=r.l({deceleration:1e3,maxSpeed:90},Ph);class Zs{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.q.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,a=r.q.now();for(;i.length>0&&a-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)a.zoom+=x.zoomDelta||0,a.bearing+=x.bearingDelta||0,a.pitch+=x.pitchDelta||0,x.panDelta&&a.pan._add(x.panDelta),x.around&&(a.around=x.around),x.pinchAround&&(a.pinchAround=x.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(a.pan.mag()){const x=Zu(a.pan.mag(),f,r.l({},Oh,i||{}));v.offset=a.pan.mult(x.amount/a.pan.mag()),v.center=this._map.transform.center,Xs(v,x)}if(a.zoom){const x=Zu(a.zoom,f,mu);v.zoom=this._map.transform.zoom+x.amount,Xs(v,x)}if(a.bearing){const x=Zu(a.bearing,f,md);v.bearing=this._map.transform.bearing+r.aw(x.amount,-179,179),Xs(v,x)}if(a.pitch){const x=Zu(a.pitch,f,Lc);v.pitch=this._map.transform.pitch+x.amount,Xs(v,x)}if(v.zoom||v.bearing){const x=a.pinchAround===void 0?a.around:a.pinchAround;v.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function Xs(d,i){(!d.duration||d.duration<i.duration)&&(d.duration=i.duration,d.easing=i.easing)}function Zu(d,i,a){const{maxSpeed:f,linearity:v,deceleration:x}=a,T=r.aw(d*v/(i/1e3),-f,f),I=Math.abs(T)/(x*v);return{easing:a.easing,duration:1e3*I,amount:T*(I/2)}}class ll extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,f,v={}){const x=Nn(a.getCanvasContainer(),f),T=a.unproject(x);super(i,r.l({point:x,lngLat:T,originalEvent:f},v)),this._defaultPrevented=!1,this.target=a}}class Xu extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,f){const v=i==="touchend"?f.changedTouches:f.touches,x=Fi(a.getCanvasContainer(),v),T=x.map(F=>a.unproject(F)),I=x.reduce((F,V,j,Z)=>F.add(V.div(Z.length)),new r.P(0,0));super(i,{points:x,point:I,lngLats:T,lngLat:a.unproject(I),originalEvent:f}),this._defaultPrevented=!1}}class Af extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class Xl{constructor(i,a){this._map=i,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new Af(this._map,i))}mousedown(i,a){return this._mousedownPos=a,this._firePreventable(new ll(i.type,this._map,i))}mouseup(i){this._map.fire(new ll(i.type,this._map,i))}preclick(i){const a=r.l({},i);a.type="preclick",this._map.fire(new ll(a.type,this._map,a))}click(i,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(i),this._map.fire(new ll(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new ll(i.type,this._map,i))}mouseover(i){this._map.fire(new ll(i.type,this._map,i))}mouseout(i){this._map.fire(new ll(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Xu(i.type,this._map,i))}touchmove(i){this._map.fire(new Xu(i.type,this._map,i))}touchend(i){this._map.fire(new Xu(i.type,this._map,i))}touchcancel(i){this._map.fire(new Xu(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yu{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new ll(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ll("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new ll(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bs{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,a){this.isEnabled()&&i.shiftKey&&i.button===0&&(Xi(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(i,a){if(!this._active)return;const f=a,v=this._startPos,x=this._lastPos;if(!v||!x||x.equals(f)||!this._box&&f.dist(v)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=qt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const T=Math.min(v.x,f.x),I=Math.max(v.x,f.x),F=Math.min(v.y,f.y),V=Math.max(v.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${F}px)`,this._box.style.width=I-T+"px",this._box.style.height=V-F+"px")})}mouseupWindow(i,a){if(!this._active)return;const f=this._startPos,v=a;if(f&&i.button===0){if(this.reset(),ci(),f.x!==v.x||f.y!==v.y)return this._map.fire(new r.z("boxzoomend",{originalEvent:i})),{cameraAnimation:x=>x.fitScreenCoordinates(f,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Dt(),delete this._startPos,delete this._lastPos}_fireEvent(i,a){return this._map.fire(new r.z(i,{originalEvent:a}))}}function gd(d,i){const a={};for(let f=0;f<d.length;f++)a[d[f].identifier]=i[f];return a}class Cf{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,a,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),f.length===this.numTouches&&(this.centroid=function(v){const x=new r.P(0,0);for(const T of v)x._add(T);return x.div(v.length)}(a),this.touches=gd(f,a)))}touchmove(i,a,f){if(this.aborted||!this.centroid)return;const v=gd(f,a);for(const x in this.touches){const T=v[x];(!T||T.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(i,a,f){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Qd{constructor(i){this.singleTap=new Cf(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,a,f){this.singleTap.touchstart(i,a,f)}touchmove(i,a,f){this.singleTap.touchmove(i,a,f)}touchend(i,a,f){const v=this.singleTap.touchend(i,a,f);if(v){const x=i.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(v)<30;if(x&&T||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class $u{constructor(){this._zoomIn=new Qd({numTouches:1,numTaps:2}),this._zoomOut=new Qd({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,a,f){this._zoomIn.touchstart(i,a,f),this._zoomOut.touchstart(i,a,f)}touchmove(i,a,f){this._zoomIn.touchmove(i,a,f),this._zoomOut.touchmove(i,a,f)}touchend(i,a,f){const v=this._zoomIn.touchend(i,a,f),x=this._zoomOut.touchend(i,a,f);return v?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(v)},{originalEvent:i})}):x?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(x)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ef={0:1,2:2};class Ku{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,a){return!1}_move(i,a){return{}}mousedown(i,a){if(this._lastPoint)return;const f=oi(i);this._correctButton(i,f)&&(this._lastPoint=a,this._eventButton=f)}mousemoveWindow(i,a){const f=this._lastPoint;if(f){if(i.preventDefault(),this._eventButton!=null&&function(v,x){const T=ef[x];return v.buttons===void 0||(v.buttons&T)!==T}(i,this._eventButton))this.reset();else if(this._moved||!(a.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(f,a)}}mouseupWindow(i){this._lastPoint&&oi(i)===this._eventButton&&(this._moved&&ci(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tf extends Ku{mousedown(i,a){super.mousedown(i,a),this._lastPoint&&(this._active=!0)}_correctButton(i,a){return a===0&&!i.ctrlKey}_move(i,a){return{around:a,panDelta:a.sub(i)}}}class _l extends Ku{_correctButton(i,a){return a===0&&i.ctrlKey||a===2}_move(i,a){const f=.8*(a.x-i.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(i){i.preventDefault()}}class Zc extends Ku{_correctButton(i,a){return a===0&&i.ctrlKey||a===2}_move(i,a){const f=-.5*(a.y-i.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(i){i.preventDefault()}}class ws{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),r.aP(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(i,a,f){return this._calculateTransform(i,a,f)}touchmove(i,a,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!r.dz())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,a,f)}}touchend(i,a,f){this._calculateTransform(i,a,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,a,f){f.length>0&&(this._active=!0);const v=gd(f,a),x=new r.P(0,0),T=new r.P(0,0);let I=0;for(const V in v){const j=v[V],Z=this._touches[V];Z&&(x._add(j),T._add(j.sub(Z)),I++,v[V]=j)}if(this._touches=v,I<this._minTouches||!T.mag())return;const F=T.div(I);return this._sum._add(F),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(I),panDelta:F}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=qt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Dl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,a,f){return{}}touchstart(i,a,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([a[0],a[1]]))}touchmove(i,a,f){const v=this._firstTwoTouches;if(!v)return;i.preventDefault();const[x,T]=v,I=Rc(f,a,x),F=Rc(f,a,T);if(!I||!F)return;const V=this._aroundCenter?null:I.add(F).div(2);return this._move([I,F],V,i)}touchend(i,a,f){if(!this._firstTwoTouches)return;const[v,x]=this._firstTwoTouches,T=Rc(f,a,v),I=Rc(f,a,x);T&&I||(this._active&&ci(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Rc(d,i,a){for(let f=0;f<d.length;f++)if(d[f].identifier===a)return i[f]}function _d(d,i){return Math.log(d/i)/Math.LN2}class uc extends Dl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,a){const f=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(_d(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:_d(this._distance,f),pinchAround:a}}}function nf(d,i){return 180*d.angleWith(i)/Math.PI}class Bh extends Dl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,a){const f=this._vector;if(this._vector=i[0].sub(i[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:nf(this._vector,f),pinchAround:a}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const a=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;const v=nf(i,f);return Math.abs(v)<a}}function rf(d){return Math.abs(d.y)>Math.abs(d.x)}class bp extends Dl{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,rf(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,a,f){const v=this._lastPoints;if(!v)return;const x=i[0].sub(v[0]),T=i[1].sub(v[1]);return this._map._cooperativeGestures&&!r.dz()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(x,T,f.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(x.y+T.y)/2*-.5})}gestureBeginsVertically(i,a,f){if(this._valid!==void 0)return this._valid;const v=i.mag()>=2,x=a.mag()>=2;if(!v&&!x)return;if(!v||!x)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;const T=i.y>0==a.y>0;return rf(i)&&rf(a)&&T}}const gu={panStep:100,bearingStep:15,pitchStep:10};class Yo{constructor(){const i=gu;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let a=0,f=0,v=0,x=0,T=0;switch(i.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:i.shiftKey?f=-1:(i.preventDefault(),x=-1);break;case 39:i.shiftKey?f=1:(i.preventDefault(),x=1);break;case 38:i.shiftKey?v=1:(i.preventDefault(),T=-1);break;case 40:i.shiftKey?v=-1:(i.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(f=0,v=0),{cameraAnimation:I=>{const F=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:$o,zoom:a?Math.round(F)+a*(i.shiftKey?2:1):F,bearing:I.getBearing()+f*this._bearingStep,pitch:I.getPitch()+v*this._pitchStep,offset:[-x*this._panStep,-T*this._panStep],center:I.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function $o(d){return d*(2-d)}const zl=4.000244140625,Xc=1/450;class hc{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Xc,r.aP(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||r.dz()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const f=r.q.now(),v=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,a!==0&&a%zl==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=a,this._timeout=window.setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(v*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),i.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=i,this._delta-=a,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=Nn(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const V=this._type==="wheel"&&Math.abs(this._delta)>zl?this._wheelZoomRate:this._defaultZoomRate;let j=2/(1+Math.exp(-Math.abs(this._delta*V)));this._delta<0&&j!==0&&(j=1/j);const Z=a(),X=Math.pow(2,Z),Q=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):X;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(Q*j))),this._type==="wheel"&&(this._startZoom=Z,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:a(),v=this._startZoom,x=this._easing;let T,I=!1;if(this._type==="wheel"&&v&&x){const V=Math.min((r.q.now()-this._lastWheelEventTime)/200,1),j=x(V);T=r.af(v,f,j),V<1?this._frameId||(this._frameId=!0):I=!0}else T=f,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let F=T-a();return F*this._lastDelta<0&&(F=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:F,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let a=r.dA;if(this._prevEase){const f=this._prevEase,v=(r.q.now()-f.start)/f.duration,x=f.easing(v+.01)-f.easing(v),T=.27/Math.sqrt(x*x+1e-4)*.01,I=Math.sqrt(.0729-T*T);a=r.dy(T,I,.25,1)}return this._prevEase={start:r.q.now(),duration:i,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=qt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Ic{constructor(i,a){this._clickZoom=i,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _u{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,a){return i.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(i.shiftKey?-1:1),around:f.unproject(a)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yl{constructor(){this._tap=new Qd({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,a,f){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=a[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(i,a,f))}touchmove(i,a,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const v=a[0],x=v.y-this._swipePoint.y;return this._swipePoint=v,i.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(i,a,f)}touchend(i,a,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(i,a,f)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yl{constructor(i,a,f){this._el=i,this._mousePan=a,this._touchPan=f}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class af{constructor(i,a,f){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=a,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Gp{constructor(i,a,f,v){this._el=i,this._touchZoom=a,this._touchRotate=f,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const vl=d=>d.zoom||d.drag||d.pitch||d.rotate;class ip extends r.z{}class Na{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,a){const f=r.ab.vec3.sub([],a,i);this.radius=r.ab.vec3.length(f[2]<0?r.ab.vec3.div([],f,this.constants):[f[0],f[1],0])}projectRay(i){r.ab.vec3.div(i,i,this.constants),r.ab.vec3.normalize(i,i),r.ab.vec3.mul(i,i,this.constants);const a=r.ab.vec3.scale([],i,this.radius);if(a[2]>0){const f=r.ab.vec3.scale([],[0,0,1],r.ab.vec3.dot(a,[0,0,1])),v=r.ab.vec3.scale([],r.ab.vec3.normalize([],[a[0],a[1],0]),this.radius),x=r.ab.vec3.add([],a,r.ab.vec3.scale([],r.ab.vec3.sub([],r.ab.vec3.add([],v,f),a),2));a[0]=x[0],a[1]=x[1]}return a}}function xl(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class yu{constructor(i,a){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Zs(i),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Na,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),r.aP(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,x,T]of this._listeners){const I=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(x,I,T)}}destroy(){for(const[i,a,f]of this._listeners){const v=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(a,v,f)}}_addDefaultHandlers(i){const a=this._map,f=a.getCanvasContainer();this._add("mapEvent",new Xl(a,i));const v=a.boxZoom=new bs(a,i);this._add("boxZoom",v);const x=new $u,T=new _u;a.doubleClickZoom=new Ic(T,x),this._add("tapZoom",x),this._add("clickZoom",T);const I=new Yl;this._add("tapDragZoom",I);const F=a.touchPitch=new bp(a);this._add("touchPitch",F);const V=new _l(i),j=new Zc(i);a.dragRotate=new af(i,V,j),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]);const Z=new tf(i),X=new ws(a,i);a.dragPan=new yl(f,Z,X),this._add("mousePan",Z),this._add("touchPan",X,["touchZoom","touchRotate"]);const Q=new Bh,le=new uc;a.touchZoomRotate=new Gp(f,le,Q,I),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Yu(a));const se=a.scrollZoom=new hc(a,this);this._add("scrollZoom",se,["mousePan"]);const me=a.keyboard=new Yo;this._add("keyboard",me);for(const fe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[fe]&&a[fe].enable(i[fe])}_add(i,a,f){this._handlers.push({handlerName:i,handler:a,allowed:f}),this._handlersById[i]=a}stop(i){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!vl(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,a,f){for(const v in i)if(v!==f&&(!a||a.indexOf(v)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const a=[];for(const f of i)this._el.contains(f.target)&&a.push(f);return a}handleEvent(i,a){this._updatingCamera=!0;const f=i.type==="renderFrame",v=f?void 0:i,x={needsRenderFrame:!1},T={},I={},F=i.touches?this._getMapTouches(i.touches):void 0,V=F?Fi(this._el,F):f?void 0:Nn(this._el,i);for(const{handlerName:X,handler:Q,allowed:le}of this._handlers){if(!Q.isEnabled())continue;let se;this._blockedByActive(I,le,X)?Q.reset():Q[a||i.type]&&(se=Q[a||i.type](i,V,F),this.mergeHandlerResult(x,T,se,X,v),se&&se.needsRenderFrame&&this._triggerRenderFrame()),(se||Q.isActive())&&(I[X]=Q)}const j={};for(const X in this._previousActiveHandlers)I[X]||(j[X]=v);this._previousActiveHandlers=I,(Object.keys(j).length||xl(x))&&(this._changes.push([x,T,j]),this._triggerRenderFrame()),(Object.keys(I).length||xl(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Z}=x;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))}mergeHandlerResult(i,a,f,v,x){if(!f)return;r.l(i,f);const T={handlerName:v,originalEvent:f.originalEvent||x};f.zoomDelta!==void 0&&(a.zoom=T),f.panDelta!==void 0&&(a.drag=T),f.pitchDelta!==void 0&&(a.pitch=T),f.bearingDelta!==void 0&&(a.rotate=T)}_applyChanges(){const i={},a={},f={};for(const[v,x,T]of this._changes)v.panDelta&&(i.panDelta=(i.panDelta||new r.P(0,0))._add(v.panDelta)),v.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(i.around=v.around),v.aroundCoord!==void 0&&(i.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(i.pinchAround=v.pinchAround),v.noInertia&&(i.noInertia=v.noInertia),r.l(a,x),r.l(f,T);this._updateMapTransform(i,a,f),this._changes=[]}_updateMapTransform(i,a,f){const v=this._map,x=v.transform,T=De=>[De.x,De.y,De.z];if((De=>{const ke=this._eventsInProgress.drag;return ke&&!this._handlersById[ke.handlerName].isActive()})()&&!xl(i)){const De=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),De!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&v._stop(!0),!xl(i))return void this._fireEvents(a,f,!0);let{panDelta:I,zoomDelta:F,bearingDelta:V,pitchDelta:j,around:Z,aroundCoord:X,pinchAround:Q}=i;x._isCameraConstrained&&(F>0&&(F=0),x._isCameraConstrained=!1),Q!==void 0&&(Z=Q),(F||(De=>a[De]&&!this._eventsInProgress[De])("drag"))&&Z&&(this._dragOrigin=T(x.pointCoordinate3D(Z)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",v._stop(!0),Z=Z||v.transform.centerPoint,V&&(x.bearing+=V),j&&(x.pitch+=j),x._updateCameraState();const le=[0,0,0];if(I)if(x.projection.name==="mercator"){const De=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(Z).dir),ke=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(Z.sub(I)).dir);le[0]=ke[0]-De[0],le[1]=ke[1]-De[1]}else{const De=x.pointCoordinate(Z);if(x.projection.name==="globe"){I=I.rotate(-x.angle);const ke=x._pixelsPerMercatorPixel/x.worldSize;le[0]=-I.x*r.dB(r.aS(De.y))*ke,le[1]=-I.y*r.dB(x.center.lat)*ke}else{const ke=x.pointCoordinate(Z.sub(I));De&&ke&&(le[0]=ke.x-De.x,le[1]=ke.y-De.y)}}const se=x.zoom,me=[0,0,0];if(F){const De=T(X||x.pointCoordinate3D(Z)),ke={dir:r.ab.vec3.normalize([],r.ab.vec3.sub([],De,x._camera.position))};if(ke.dir[2]<0){const Ne=x.zoomDeltaToMovement(De,F);r.ab.vec3.scale(me,ke.dir,Ne)}}const fe=r.ab.vec3.add(le,le,me);x._translateCameraConstrained(fe),F&&Math.abs(x.zoom-se)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(a,f,!0)}_fireEvents(i,a,f){const v=vl(this._eventsInProgress),x=vl(i),T={};for(const j in i){const{originalEvent:Z}=i[j];this._eventsInProgress[j]||(T[`${j}start`]=Z),this._eventsInProgress[j]=i[j]}!v&&x&&this._fireEvent("movestart",x.originalEvent);for(const j in T)this._fireEvent(j,T[j]);x&&this._fireEvent("move",x.originalEvent);for(const j in i){const{originalEvent:Z}=i[j];this._fireEvent(j,Z)}const I={};let F;for(const j in this._eventsInProgress){const{handlerName:Z,originalEvent:X}=this._eventsInProgress[j];this._handlersById[Z].isActive()||(delete this._eventsInProgress[j],F=a[Z]||X,I[`${j}end`]=F)}for(const j in I)this._fireEvent(j,I[j]);const V=vl(this._eventsInProgress);if(f&&(v||x)&&!V){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Z=X=>X!==0&&-this._bearingSnap<X&&X<this._bearingSnap;j?(Z(j.bearing||this._map.getBearing())&&(j.bearing=0),this._map.easeTo(j,{originalEvent:F})):(this._map.fire(new r.z("moveend",{originalEvent:F})),Z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,a){this._map.fire(new r.z(i,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new ip("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ju="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Yc extends r.E{constructor(i,a){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,r.aP(["_renderFrameCallback"],this)}getCenter(){return new r.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(i,a){return this.jumpTo({center:i},a)}panBy(i,a,f){return i=r.P.convert(i).mult(-1),this.panTo(this.transform.center,r.l({offset:i},a),f)}panTo(i,a,f){return this.easeTo(r.l({center:i},a),f)}getZoom(){return this.transform.zoom}setZoom(i,a){return this.jumpTo({zoom:i},a),this}zoomTo(i,a,f){return this.easeTo(r.l({zoom:i},a),f)}zoomIn(i,a){return this.zoomTo(this.getZoom()+1,i,a),this}zoomOut(i,a){return this.zoomTo(this.getZoom()-1,i,a),this}getBearing(){return this.transform.bearing}setBearing(i,a){return this.jumpTo({bearing:i},a),this}getPadding(){return this.transform.padding}setPadding(i,a){return this.jumpTo({padding:i},a),this}rotateTo(i,a,f){return this.easeTo(r.l({bearing:i},a),f)}resetNorth(i,a){return this.rotateTo(0,r.l({duration:1e3},i),a),this}resetNorthPitch(i,a){return this.easeTo(r.l({bearing:0,pitch:0,duration:1e3},i),a),this}snapToNorth(i,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,a):this}getPitch(){return this.transform.pitch}setPitch(i,a){return this.jumpTo({pitch:i},a),this}cameraForBounds(i,a){i=r.az.convert(i);const f=a&&a.bearing||0,v=a&&a.pitch||0,x=i.getNorthWest(),T=i.getSouthEast();return this._cameraForBounds(this.transform,x,T,f,v,a)}_extendPadding(i){const a={top:0,right:0,bottom:0,left:0};return i==null?r.l({},a,this.transform.padding):typeof i=="number"?{top:i,bottom:i,right:i,left:i}:r.l({},a,i)}_extendCameraOptions(i){return(i=r.l({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(i,a){const f=a.max[0]-a.min[0],v=a.max[1]-a.min[1];return f/v>i.aspect?f/(2*Math.tan(.5*i.fovX)*i.aspect):v/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,a,f,v,x,T){const I=i.clone(),F=this._extendCameraOptions(T);I.bearing=v,I.pitch=x;const V=r.bO.convert(a),j=r.bO.convert(f),Z=.5*(V.lat+j.lat),X=.5*(V.lng+j.lng),Q=r.dC(Z,X),le=r.ab.vec3.normalize([],Q),se=r.ab.vec3.normalize([],r.ab.vec3.cross([],le,[0,1,0])),me=r.ab.vec3.cross([],se,le),fe=[se[0],se[1],se[2],0,me[0],me[1],me[2],0,le[0],le[1],le[2],0,0,0,0,1],De=[Q,r.dC(V.lat,V.lng),r.dC(j.lat,V.lng),r.dC(j.lat,j.lng),r.dC(V.lat,j.lng),r.dC(Z,V.lng),r.dC(Z,j.lng),r.dC(V.lat,X),r.dC(j.lat,X)];let ke=r.cd.fromPoints(De.map(si=>[r.ab.vec3.dot(se,si),r.ab.vec3.dot(me,si),r.ab.vec3.dot(le,si)]));const Ne=r.ab.vec3.transformMat4([],ke.center,fe);r.ab.vec3.squaredLength(Ne)===0&&r.ab.vec3.set(Ne,0,0,1),r.ab.vec3.normalize(Ne,Ne),r.ab.vec3.scale(Ne,Ne,r.ax),I.center=r.dD(Ne);const tt=I.getWorldToCameraMatrix(),He=r.ab.mat4.invert(new Float64Array(16),tt);ke=r.cd.applyTransform(ke,r.ab.mat4.multiply([],tt,fe));const We=this._extendAABB(ke,I,F,v);if(!We)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ke=We,r.ab.vec3.transformMat4(Ne,Ne,tt);const je=.5*(ke.max[2]-ke.min[2]),at=this._minimumAABBFrustumDistance(I,ke),gt=r.ab.vec3.scale([],[0,0,1],je),Jt=r.ab.vec3.add(gt,Ne,gt),jt=at+(I.pitch===0?0:r.ab.vec3.distance(Ne,Jt)),fi=I.globeCenterInViewSpace,ui=r.ab.vec3.sub([],Ne,[fi[0],fi[1],fi[2]]);r.ab.vec3.normalize(ui,ui),r.ab.vec3.scale(ui,ui,jt);const Pt=r.ab.vec3.add([],Ne,ui);r.ab.vec3.transformMat4(Pt,Pt,He);const Kt=r.ds/r.ax,Ii=r.ab.vec3.length(Pt),Et=r.bH(Math.max(Ii*Kt-r.ds,Number.EPSILON),0),hi=Math.min(I.zoomFromMercatorZAdjusted(Et),F.maxZoom);return hi>.5*(r.c6+r.bY)?(I.setProjection({name:"mercator"}),I.zoom=hi,this._cameraForBounds(I,a,f,v,x,T)):{center:I.center,zoom:hi,bearing:v,pitch:x}}_extendAABB(i,a,f,v){const x=.5*((f.padding.left||0)+(f.padding.right||0)),T=.5*((f.padding.top||0)+(f.padding.bottom||0)),I=T,F=x,V=x,j=T,Z=a.width-(F+V),X=a.height-(I+j),Q=r.ab.vec3.sub([],i.max,i.min),le=Math.min(Z/Q[0],X/Q[1]),se=Math.min(a.scaleZoom(a.scale*le),f.maxZoom);if(isNaN(se))return null;const me=a.scale/a.zoomScale(se),fe=new r.cd([i.min[0]-F*me,i.min[1]-j*me,i.min[2]],[i.max[0]+V*me,i.max[1]+I*me,i.max[2]]),De=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new r.P(f.offset.x,f.offset.y):r.P.convert(f.offset)).rotate(-r.ai(v));return fe.center[0]-=De.x*me,fe.center[1]+=De.y*me,fe}queryTerrainElevation(i,a){const f=this.transform.elevation;return f?(a=r.l({},{exaggerated:!0},a),f.getAtPoint(r.aa.fromLngLat(i),null,a.exaggerated)):null}_cameraForBounds(i,a,f,v,x,T){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,a,f,v,x,T);const I=i.clone(),F=this._extendCameraOptions(T);I.bearing=v,I.pitch=x;const V=r.bO.convert(a),j=r.bO.convert(f),Z=new r.bO(V.lng,j.lat),X=new r.bO(j.lng,V.lat),Q=I.project(V),le=I.project(j),se=this.queryTerrainElevation(V),me=this.queryTerrainElevation(j),fe=this.queryTerrainElevation(Z),De=this.queryTerrainElevation(X),ke=[[Q.x,Q.y,Math.min(se||0,me||0,fe||0,De||0)],[le.x,le.y,Math.max(se||0,me||0,fe||0,De||0)]];let Ne=r.cd.fromPoints(ke);const tt=I.getWorldToCameraMatrix(),He=r.ab.mat4.invert(new Float64Array(16),tt);Ne=r.cd.applyTransform(Ne,tt);const We=this._extendAABB(Ne,I,F,v);if(!We)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ne=We;const je=.5*r.ab.vec3.sub([],Ne.max,Ne.min)[2],at=this._minimumAABBFrustumDistance(I,Ne),gt=[0,0,1,0];r.ab.vec4.transformMat4(gt,gt,tt),r.ab.vec4.normalize(gt,gt);const Jt=r.ab.vec3.scale([],gt,at+je),jt=r.ab.vec3.add([],Ne.center,Jt);r.ab.vec3.transformMat4(Ne.center,Ne.center,He),r.ab.vec3.transformMat4(jt,jt,He);const fi=I.unproject(new r.P(Ne.center[0],Ne.center[1])),ui=r.dE(I.projection,fi),Pt=Math.pow(2,ui),Kt=Math.min(I._zoomFromMercatorZ(jt[2]*I.pixelsPerMeter*Pt/I.worldSize),F.maxZoom);return I.mercatorFromTransition&&Kt<.5*(r.c6+r.bY)?(I.setProjection({name:"globe"}),I.zoom=Kt,this._cameraForBounds(I,a,f,v,x,T)):{center:fi,zoom:Kt,bearing:v,pitch:x}}fitBounds(i,a,f){const v=this.cameraForBounds(i,a);return this._fitInternal(v,a,f)}fitScreenCoordinates(i,a,f,v,x){const T=r.P.convert(i),I=r.P.convert(a),F=new r.P(Math.min(T.x,I.x),Math.min(T.y,I.y)),V=new r.P(Math.max(T.x,I.x),Math.max(T.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,I))return this;const j=this.transform.pointLocation3D(F),Z=this.transform.pointLocation3D(V),X=this.transform.pointLocation3D(new r.P(F.x,V.y)),Q=this.transform.pointLocation3D(new r.P(V.x,F.y)),le=[Math.min(j.lng,Z.lng,X.lng,Q.lng),Math.min(j.lat,Z.lat,X.lat,Q.lat)],se=[Math.max(j.lng,Z.lng,X.lng,Q.lng),Math.max(j.lat,Z.lat,X.lat,Q.lat)],me=v&&v.pitch?v.pitch:this.getPitch(),fe=this._cameraForBounds(this.transform,le,se,f,me,v);return this._fitInternal(fe,v,x)}_fitInternal(i,a,f){return i?(a=r.l(i,a)).linear?this.easeTo(a,f):this.flyTo(a,f):this}jumpTo(i,a){this.stop();const f=i.preloadOnly?this.transform.clone():this.transform;let v=!1,x=!1,T=!1;"zoom"in i&&f.zoom!==+i.zoom&&(v=!0,f.zoom=+i.zoom),i.center!==void 0&&(f.center=r.bO.convert(i.center)),"bearing"in i&&f.bearing!==+i.bearing&&(x=!0,f.bearing=+i.bearing),"pitch"in i&&f.pitch!==+i.pitch&&(T=!0,f.pitch=+i.pitch);const I=typeof i.padding=="number"?this._extendPadding(i.padding):i.padding;if(i.padding!=null&&!f.isPaddingEqual(I))if(i.retainPadding===!1){const F=f.clone();F.padding=I,f.setLocationAtPoint(f.center,F.centerPoint)}else f.padding=I;return i.preloadOnly?(this._preloadTiles(f),this):(this.fire(new r.z("movestart",a)).fire(new r.z("move",a)),v&&this.fire(new r.z("zoomstart",a)).fire(new r.z("zoom",a)).fire(new r.z("zoomend",a)),x&&this.fire(new r.z("rotatestart",a)).fire(new r.z("rotate",a)).fire(new r.z("rotateend",a)),T&&this.fire(new r.z("pitchstart",a)).fire(new r.z("pitch",a)).fire(new r.z("pitchend",a)),this.fire(new r.z("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(Ju),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,a){const f=this.transform;if(!f.projection.supportsFreeCamera)return r.w(Ju),this;this.stop();const v=f.zoom,x=f.pitch,T=f.bearing;f.setFreeCameraOptions(i);const I=v!==f.zoom,F=x!==f.pitch,V=T!==f.bearing;return this.fire(new r.z("movestart",a)).fire(new r.z("move",a)),I&&this.fire(new r.z("zoomstart",a)).fire(new r.z("zoom",a)).fire(new r.z("zoomend",a)),V&&this.fire(new r.z("rotatestart",a)).fire(new r.z("rotate",a)).fire(new r.z("rotateend",a)),F&&this.fire(new r.z("pitchstart",a)).fire(new r.z("pitch",a)).fire(new r.z("pitchend",a)),this.fire(new r.z("moveend",a)),this}easeTo(i,a){this._stop(!1,i.easeId),((i=r.l({offset:[0,0],duration:500,easing:r.dA},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const f=this.transform,v=this.getZoom(),x=this.getBearing(),T=this.getPitch(),I=this.getPadding(),F="zoom"in i?+i.zoom:v,V="bearing"in i?this._normalizeBearing(i.bearing,x):x,j="pitch"in i?+i.pitch:T,Z=this._extendPadding(i.padding),X=r.P.convert(i.offset);let Q,le,se;if(f.projection.name==="globe"){const gt=r.aa.fromLngLat(f.center),Jt=X.rotate(-f.angle);gt.x+=Jt.x/f.worldSize,gt.y+=Jt.y/f.worldSize;const jt=gt.toLngLat(),fi=r.bO.convert(i.center||jt);this._normalizeCenter(fi),Q=f.centerPoint.add(Jt),le=new r.P(gt.x,gt.y).mult(f.worldSize),se=new r.P(r.at(fi.lng),r.aA(fi.lat)).mult(f.worldSize).sub(le)}else{Q=f.centerPoint.add(X);const gt=f.pointLocation(Q),Jt=r.bO.convert(i.center||gt);this._normalizeCenter(Jt),le=f.project(gt),se=f.project(Jt).sub(le)}const me=f.zoomScale(F-v);let fe,De;i.around&&(fe=r.bO.convert(i.around),De=f.locationPoint(fe));const ke=this._zooming||F!==v,Ne=this._rotating||x!==V,tt=this._pitching||j!==T,He=!f.isPaddingEqual(Z),We=i.retainPadding===!1?f.clone():f,je=gt=>Jt=>{if(ke&&(gt.zoom=r.af(v,F,Jt)),Ne&&(gt.bearing=r.af(x,V,Jt)),tt&&(gt.pitch=r.af(T,j,Jt)),He&&(We.interpolatePadding(I,Z,Jt),Q=We.centerPoint.add(X)),fe)gt.setLocationAtPoint(fe,De);else{const jt=gt.zoomScale(gt.zoom-v),fi=F>v?Math.min(2,me):Math.max(.5,me),ui=Math.pow(fi,1-Jt),Pt=gt.unproject(le.add(se.mult(Jt*ui)).mult(jt));gt.setLocationAtPoint(gt.renderWorldCopies?Pt.wrap():Pt,Q)}return i.preloadOnly||this._fireMoveEvents(a),gt};if(i.preloadOnly){const gt=this._emulate(je,i.duration,f);return this._preloadTiles(gt),this}const at={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ke,this._rotating=Ne,this._pitching=tt,this._padding=He,this._easeId=i.easeId,this._prepareEase(a,i.noMoveStart,at),this._ease(je(f),gt=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(a,gt)},i),this}_prepareEase(i,a,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||f.moving||this.fire(new r.z("movestart",i)),this._zooming&&!f.zooming&&this.fire(new r.z("zoomstart",i)),this._rotating&&!f.rotating&&this.fire(new r.z("rotatestart",i)),this._pitching&&!f.pitching&&this.fire(new r.z("pitchstart",i))}_fireMoveEvents(i){this.fire(new r.z("move",i)),this._zooming&&this.fire(new r.z("zoom",i)),this._rotating&&this.fire(new r.z("rotate",i)),this._pitching&&this.fire(new r.z("pitch",i))}_afterEase(i,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const f=this._zooming,v=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new r.z("zoomend",i)),v&&this.fire(new r.z("rotateend",i)),x&&this.fire(new r.z("pitchend",i)),this.fire(new r.z("moveend",i))}flyTo(i,a){if(this._prefersReducedMotion(i)){const si=r.ay(i,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(si,a)}this.stop(),i=r.l({offset:[0,0],speed:1.2,curve:1.42,easing:r.dA},i);const f=this.transform,v=this.getZoom(),x=this.getBearing(),T=this.getPitch(),I=this.getPadding(),F="zoom"in i?r.aw(+i.zoom,f.minZoom,f.maxZoom):v,V="bearing"in i?this._normalizeBearing(i.bearing,x):x,j="pitch"in i?+i.pitch:T,Z=this._extendPadding(i.padding),X=f.zoomScale(F-v),Q=r.P.convert(i.offset);let le=f.centerPoint.add(Q);const se=f.pointLocation(le),me=r.bO.convert(i.center||se);this._normalizeCenter(me);const fe=f.project(se),De=f.project(me).sub(fe);let ke=i.curve;const Ne=Math.max(f.width,f.height),tt=Ne/X,He=De.mag();if("minZoom"in i){const si=r.aw(Math.min(i.minZoom,v,F),f.minZoom,f.maxZoom),an=Ne/f.zoomScale(si-v);ke=Math.sqrt(an/He*2)}const We=ke*ke;function je(si){const an=(tt*tt-Ne*Ne+(si?-1:1)*We*We*He*He)/(2*(si?tt:Ne)*We*He);return Math.log(Math.sqrt(an*an+1)-an)}function at(si){return(Math.exp(si)-Math.exp(-si))/2}function gt(si){return(Math.exp(si)+Math.exp(-si))/2}const Jt=je(0);let jt=function(si){return gt(Jt)/gt(Jt+ke*si)},fi=function(si){return Ne*((gt(Jt)*(at(an=Jt+ke*si)/gt(an))-at(Jt))/We)/He;var an},ui=(je(1)-Jt)/ke;if(Math.abs(He)<1e-6||!isFinite(ui)){if(Math.abs(Ne-tt)<1e-6)return this.easeTo(i,a);const si=tt<Ne?-1:1;ui=Math.abs(Math.log(tt/Ne))/ke,fi=function(){return 0},jt=function(an){return Math.exp(si*ke*an)}}i.duration="duration"in i?+i.duration:1e3*ui/("screenSpeed"in i?+i.screenSpeed/ke:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const Pt=x!==V,Kt=j!==T,Ii=!f.isPaddingEqual(Z),Et=i.retainPadding===!1?f.clone():f,hi=si=>an=>{const zi=an*ui,yi=1/jt(zi);si.zoom=an===1?F:v+si.scaleZoom(yi),Pt&&(si.bearing=r.af(x,V,an)),Kt&&(si.pitch=r.af(T,j,an)),Ii&&(Et.interpolatePadding(I,Z,an),le=Et.centerPoint.add(Q));const Hi=an===1?me:si.unproject(fe.add(De.mult(fi(zi))).mult(yi));return si.setLocationAtPoint(si.renderWorldCopies?Hi.wrap():Hi,le),si._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(a),si};if(i.preloadOnly){const si=this._emulate(hi,i.duration,f);return this._preloadTiles(si),this}return this._zooming=!0,this._rotating=Pt,this._pitching=Kt,this._padding=Ii,this._prepareEase(a,!1),this._ease(hi(f),()=>this._afterEase(a),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(i){}_cancelRenderFrame(i){}_stop(i,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,a)}if(!i){const f=this.handlers;f&&f.stop(!1)}return this}_ease(i,a,f){f.animate===!1||f.duration===0?(i(1),a()):(this._easeStart=r.q.now(),this._easeOptions=f,this._onEaseFrame=i,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((r.q.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,a){i=r.bF(i,-180,180);const f=Math.abs(i-a);return Math.abs(i-360-a)<f&&(i-=360),Math.abs(i+360-a)<f&&(i+=360),i}_normalizeCenter(i){const a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;const f=i.lng-a.center.lng;i.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&r.q.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,a,f){const v=Math.ceil(15*a/1e3),x=[],T=i(f.clone());for(let I=0;I<=v;I++){const F=T(I/v);x.push(F.clone())}return x}_preloadTiles(i,a){}}class vu{constructor(i={}){this.options=i,r.aP(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const a=this.options&&this.options.compact,f=i._getUIString("AttributionControl.ToggleAttribution");this._map=i,this._container=qt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=qt("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",f);const v=qt("span","mapboxgl-ctrl-icon",this._compactButton);return v.setAttribute("aria-hidden","true"),v.setAttribute("title",f),this._innerContainer=qt("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(i){const f=a.reduce((v,x,T)=>(x.value&&(v+=`${x.key}=${x.value}${T<a.length-1?"&":""}`),v),"?");i.href=`${r.e.FEEDBACK_URL}/${f}#${Ef(this._map,!0)}`,i.rel="noopener nofollow"}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const a=this._map.style._mergedSourceCaches;for(const v in a){const x=a[v];if(x.used){const T=x.getSource();T.attribution&&i.indexOf(T.attribution)<0&&i.push(T.attribution)}}i.sort((v,x)=>v.length-x.length),i=i.filter((v,x)=>{for(let T=x+1;T<i.length;T++)if(i[T].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const f=i.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,i.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ko{constructor(){r.aP(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=qt("div","mapboxgl-ctrl");const a=qt("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const a in i){const f=i[a].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const a=i[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class Jo{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const a=++this._id;return this._queue.push({callback:i,id:a,cancelled:!1}),a}remove(i){const a=this._currentlyRunning,f=a?this._queue.concat(a):this._queue;for(const v of f)if(v.id===i)return void(v.cancelled=!0)}run(i=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const f of a)if(!f.cancelled&&(f.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class $c{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const a=r.cB((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,a,f){this._start=this.getValue(a),this._end=i,this._startTime=a,this._endTime=a+f}}const xu={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class So extends r.z{constructor(i,a,f,v){const{point:x,lngLat:T,originalEvent:I,target:F}=i;super(i.type,{point:x,lngLat:T,originalEvent:I,target:F}),this.preventDefault=()=>{i.preventDefault()},this.id=a,this.interaction=f,this.feature=v}}class Kc{constructor(i){this.map=i,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(i,a){if(this.typeById.has(i))throw new Error(`Interaction id "${i}" already exists.`);const f=a.filter;let v=a.type;f&&this.filters.set(i,r.aZ(f)),v==="mouseover"&&(v="mouseenter"),v==="mouseout"&&(v="mouseleave");const x=this.interactionsByType.get(v)||new Map;v==="mouseenter"||v==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(i,a)):x.size===0&&this.map.on(v,this.handleType),x.size===0&&this.interactionsByType.set(v,x),x.set(i,a),this.typeById.set(i,v)}get(i){const a=this.typeById.get(i);if(!a)return;const f=this.interactionsByType.get(a);return f?f.get(i):void 0}remove(i){const a=this.typeById.get(i);if(!a)return;this.typeById.delete(i),this.filters.delete(i);const f=this.interactionsByType.get(a);f&&(f.delete(i),a==="mouseenter"||a==="mouseleave"?(this.delegatedInteractions.delete(i),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):f.size===0&&this.map.off(a,this.handleType))}queryTargets(i,a){const f=[];for(const[v,x]of a)x.target&&f.push({targetId:v,target:x.target,filter:this.filters.get(v)});return this.map.style.queryRenderedTargets(i,f,this.map.transform)}handleMove(i){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const a=this.queryTargets(i.point,Array.from(this.delegatedInteractions).reverse());a.length&&(i.type="mouseenter",this.handleType(i,a));const f=new Map;for(const[v,{feature:x}]of this.prevHoveredFeatures)this.hoveredFeatures.has(v)||f.set(x.id,x);f.size&&(i.type="mouseleave",this.handleType(i,Array.from(f.values())))}handleOut(i){const a=Array.from(this.hoveredFeatures.values()).map(({feature:f})=>f);a.length&&(i.type="mouseleave",this.handleType(i,a)),this.hoveredFeatures.clear()}handleType(i,a){const f=Array.from(this.interactionsByType.get(i.type)).reverse(),v=!!a;a=a||this.queryTargets(i.point,f);const x=i.type==="mouseenter";let T=!1;const I=new Set;for(const F of a){for(const[V,j]of f){if(!j.target)continue;const Z=F.variants?F.variants[V]:null;if(Z){for(const X of Z){if(dl(X,F,I,V))continue;const Q=new r.cw(F,X),le=qo(X,F,V);v&&(Q.state=this.map.getFeatureState(Q));const se=x?this.prevHoveredFeatures.get(le):null,me=new So(i,V,j,Q),fe=se?se.stop:j.handler(me);if(x&&this.hoveredFeatures.set(le,{feature:F,stop:fe}),fe!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[F,V]of f){const{handler:j,target:Z}=V;if(!Z&&j(new So(i,F,V,null))!==!1)break}}}function xa(d,i){if(Array.isArray(d)&&Array.isArray(i)){const a=new Set(d),f=new Set(i);return a.size===f.size&&d.every(v=>f.has(v))}return r.bn(d,i)}const ko={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},yd={showCompass:!0,showZoom:!0,visualizePitch:!1};class Qo{constructor(i,a,f=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new _l({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,f&&(this.mousePitch=new Zc({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),r.aP(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(i,a){this.mouseRotate.mousedown(i,a),this.mousePitch&&this.mousePitch.mousedown(i,a),Xi()}move(i,a){const f=this.map,v=this.mouseRotate.mousemoveWindow(i,a),x=v&&v.bearingDelta;if(x&&f.setBearing(f.getBearing()+x),this.mousePitch){const T=this.mousePitch.mousemoveWindow(i,a),I=T&&T.pitchDelta;I&&f.setPitch(f.getPitch()+I)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Dt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(r.l({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),Nn(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,Nn(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Fi(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=Fi(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function bu(d,i,a){if(d=new r.bO(d.lng,d.lat),i){const f=new r.bO(d.lng-360,d.lat),v=new r.bO(d.lng+360,d.lat),x=360*Math.ceil(Math.abs(d.lng-a.center.lng)/360),T=a.locationPoint(d).distSqr(i),I=i.x<0||i.y<0||i.x>a.width||i.y>a.height;a.locationPoint(f).distSqr(i)<T&&(I||Math.abs(f.lng-a.center.lng)<x)?d=f:a.locationPoint(v).distSqr(i)<T&&(I||Math.abs(v.lng-a.center.lng)<x)&&(d=v)}for(;Math.abs(d.lng-a.center.lng)>180;){const f=a.locationPoint(d);if(f.x>=0&&f.y>=0&&f.x<=a.width&&f.y<=a.height)break;d.lng>a.center.lng?d.lng-=360:d.lng+=360}return d}const cl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Pl extends r.E{constructor(i,a){if(super(),(i instanceof HTMLElement||a)&&(i=r.l({element:i},a)),r.aP(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=r.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=qt("div");const x=41,T=27,I=xi("svg",{display:"block",height:x*this._scale+"px",width:T*this._scale+"px",viewBox:`0 0 ${T} ${x}`},this._element),F=xi("radialGradient",{id:"shadowGradient"},xi("defs",{},I));xi("stop",{offset:"10%","stop-opacity":.4},F),xi("stop",{offset:"100%","stop-opacity":.05},F),xi("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),xi("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),xi("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),xi("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=r.P.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const f=this._element.classList;for(const x in cl)f.remove(`mapboxgl-marker-anchor-${x}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`);const v=i&&i.className?i.className.trim().split(/\s+/):[];f.add(...v),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=r.bO.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const a=i.code,f=i.charCode||i.keyCode;a!=="Space"&&a!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(i){const a=i.originalEvent.target,f=this._element;this._popup&&(a===f||f.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,a=this._pos;if(!i||!a)return!1;const f=i.unproject(a),v=i.getFreeCameraOptions();if(!v.position)return!1;const x=v.position.toLngLat();return x.distanceTo(f)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const a=this._pos;if(!a||a.x<0||a.x>i.transform.width||a.y<0||a.y>i.transform.height)return void this._clearFadeTimer();const f=i.unproject(a);let v;i._showingGlobe()&&r.dH(i.transform,this._lngLat)?v=0:(v=1-i._queryFogOpacity(f),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${cl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const i=this._pos,a=this._map,f=this.getPitchAlignment();if(!a||!i||f!=="map")return"";if(!a._showingGlobe()){const F=a.getPitch();return F?`rotateX(${F}deg)`:""}const v=r.c4(r.dI(a.transform,this._lngLat)),x=i.sub(r.dJ(a.transform)),T=Math.abs(x.x)+Math.abs(x.y);if(T===0)return"";const I=v/T;return`rotateX(${-x.y*I}deg) rotateY(${x.x*I}deg)`}_calculateZTransform(){const i=this._pos,a=this._map;if(!a||!i)return"";let f=0;const v=this.getRotationAlignment();if(v==="map")if(a._showingGlobe()){const x=a.project(new r.bO(this._lngLat.lng,this._lngLat.lat+.001)),T=a.project(new r.bO(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);f=r.c4(Math.atan2(T.y,T.x))-90}else f=-a.getBearing();else if(v==="horizon"){const x=r.ac(4,6,a.getZoom()),T=r.dJ(a.transform);T.y+=x*a.transform.height;const I=i.sub(T),F=r.c4(Math.atan2(I.y,I.x));f=(F>90?F-270:F+90)*(1-x)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=bu(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),i===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=r.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){const a=this._map;if(!a)return;const f=this._pointerdownPos,v=this._positionDelta;if(f&&v){if(!this._isDragging){const x=this._clickTolerance||a._clickTolerance;if(i.point.dist(f)<x)return;this._isDragging=!0}this._pos=i.point.sub(v),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.z("dragstart"))),this.fire(new r.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.z("dragend")),this._state="inactive"}_addDragHandler(i){const a=this._map,f=this._pos;a&&f&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(f),this._pointerdownPos=i.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const a=this._map;return a&&(i?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const io={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ho={maxWidth:100,unit:"metric"},Is={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ol={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Va=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function wu(d=new r.P(0,0),i="bottom"){if(typeof d=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(i){case"top":return new r.P(0,d);case"top-left":return new r.P(a,a);case"top-right":return new r.P(-a,a);case"bottom":return new r.P(0,-d);case"bottom-left":return new r.P(a,-a);case"bottom-right":return new r.P(-a,-a);case"left":return new r.P(d,0);case"right":return new r.P(-d,0)}return new r.P(0,0)}return d instanceof r.P||Array.isArray(d)?r.P.convert(d):r.P.convert(d[i]||[0,0])}return{version:Ge,supported:Ai.supported,setRTLTextPlugin:r.dK,getRTLTextPluginStatus:r.dL,Map:class extends Yc{constructor(d){Je.mark(de.create);const i=d;if((d=r.l({},ko,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&r.dF(window)&&(d.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new uh(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._repaint=!!d.repaint,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new Jo,this._domRenderTaskQueue=new Jo,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.aV(),this._locale=r.l({},xu,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._tessellationStep=d.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=d.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new $c(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=d.scaleFactor,this._requestManager=new vi(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?Object.assign({},d.contextCreateOptions):{},typeof d.container=="string"){const a=document.getElementById(d.container);if(!a)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=a}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),this._spriteFormat=d.spriteFormat,r.aP(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new dd),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new yu(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||r.e.DEFAULT_STYLE,{config:d.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this.indoor=new vc(this),d.hash&&(this._hash=new pd(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});const a=d.bounds;a&&(this.resize(),this.fitBounds(a,r.l({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new vu({customAttribution:d.customAttribution})),this._logoControl=new Ko,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new r.z(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new r.z(`${a.dataType}dataloading`,a))}),this._interactions=new Kc(this)}_getMapId(){return this._mapId}addControl(d,i){if(i===void 0&&(i=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new r.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=d.onAdd(this);this._controls.push(d);const f=this._controlPositions[i];return i.indexOf("bottom")!==-1?f.insertBefore(a,f.firstChild):f.appendChild(a),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new r.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(d);return i>-1&&this._controls.splice(i,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new r.z("movestart",d)).fire(new r.z("move",d)),this.fire(new r.z("resize",d)),i&&this.fire(new r.z("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(r.az.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(d){return this._scaleFactor=d,this.painter.scaleFactor=d,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(i=>i.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(i=>i==="auto"?navigator.language:i):d}setLanguage(d){const i=this._parseLanguage(d);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,i=d.projection.name;let a;i==="globe"&&d.zoom>=r.bY?(d.setMercatorFromTransition(),a=!0):i==="mercator"&&d.zoom<r.bY&&(d.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,i){return this._updateProjection(d||i||{name:"mercator"})}_updateProjection(d){let i;return i=d.name==="globe"&&this.transform.zoom>=r.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d){return this.transform.locationPoint3D(r.bO.convert(d))}unproject(d){return this.transform.pointLocation3D(r.P.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,i,a){const f=v=>{let x=[];if(Array.isArray(i)){const T=i.filter(I=>this.getLayer(I));x=T.length?this.queryRenderedFeatures(v,{layers:T}):[]}else x=this.queryRenderedFeatures(v,{target:i});return x};if(d==="mouseenter"||d==="mouseover"){let v=!1;return{listener:a,targets:i,delegates:{mousemove:T=>{const I=f(T.point);I.length?v||(v=!0,a.call(this,new ll(d,this,T.originalEvent,{features:I}))):v=!1},mouseout:()=>{v=!1}}}}if(d==="mouseleave"||d==="mouseout"){let v=!1;return{listener:a,targets:i,delegates:{mousemove:I=>{f(I.point).length?v=!0:v&&(v=!1,a.call(this,new ll(d,this,I.originalEvent)))},mouseout:I=>{v&&(v=!1,a.call(this,new ll(d,this,I.originalEvent)))}}}}{const v=x=>{const T=f(x.point);T.length&&(x.features=T,a.call(this,x),delete x.features)};return{listener:a,targets:i,delegates:{[d]:v}}}}on(d,i,a){if(typeof i=="function"||a===void 0)return super.on(d,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const f=this._createDelegatedListener(d,i,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(f);for(const v in f.delegates)this.on(v,f.delegates[v]);return this}once(d,i,a){if(typeof i=="function"||a===void 0)return super.once(d,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const f=this._createDelegatedListener(d,i,a);for(const v in f.delegates)this.once(v,f.delegates[v]);return this}off(d,i,a){if(typeof i=="function"||a===void 0)return super.off(d,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const f=this._delegatedListeners?this._delegatedListeners[d]:void 0;return f&&(v=>{for(let x=0;x<v.length;x++){const T=v[x];if(T.listener===a&&xa(T.targets,i)){for(const I in T.delegates)this.off(I,T.delegates[I]);return v.splice(x,1),this}}})(f),this}queryRenderedFeatures(d,i){if(!this.style)return[];if(d===void 0||d instanceof r.P||Array.isArray(d)||i!==void 0||(i=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],!i){const x=this.style.queryRenderedFeatures(d,void 0,this.transform),T=this.style.queryRenderedFeatureset(d,void 0,this.transform);return x.concat(T)}let a=!0;if(i.target&&(a=this._isTargetValid(i.target),a&&!i.layers))return this.style.queryRenderedFeatureset(d,i,this.transform);let f=!0;if(i.layers&&Array.isArray(i.layers)){for(const x of i.layers)if(!this._isValidId(x)){f=!1;break}if(f&&!i.target)return this.style.queryRenderedFeatures(d,i,this.transform)}let v=[];return f&&(v=v.concat(this.style.queryRenderedFeatures(d,i,this.transform))),a&&(v=v.concat(this.style.queryRenderedFeatureset(d,i,this.transform))),v}querySourceFeatures(d,i){return!d||typeof d=="string"&&!this._isValidId(d)?[]:this.style.querySourceFeatures(d,i)}isPointOnSurface(d){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&r.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(d))}addInteraction(d,i){return this._interactions.add(d,i),this}removeInteraction(d){return this._interactions.remove(d),this}setStyle(d,i){return i=r.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&d&&i.diff!==!1&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(d,(a,f)=>{a?(r.w(`Unable to perform style diff: ${String(a.message||a.error||a)}. Rebuilding the style from scratch.`),this._updateStyle(d,i)):f&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(d,i))}_getUIString(d){const i=this._locale[d];if(i==null)throw new Error(`Missing UI string '${d}'`);return i}_updateStyle(d,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d){const a=r.l({},i);i&&i.config&&(a.initialConfig=i.config,delete a.config),this.style=new Oo(this,a).load(d),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Oo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new r.y(new Error("IDs can't be empty."))),!1):!r.cr(d)||(this.fire(new r.y(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}_isTargetValid(d){return"featuresetId"in d?this._isValidId("importId"in d?d.importId:d.featuresetId):"layerId"in d&&this._isValidId(d.layerId)}_areTargetsValid(d){if(Array.isArray(d)){for(const i of d)if(!this._isValidId(i))return!1;return!0}return this._isTargetValid(d)}addSource(d,i){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,i),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,i,a){this._lazyInitEmptyStyle(),this.style.addSourceType(d,i,a)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,i,{pixelRatio:a=1,sdf:f=!1,stretchX:v,stretchY:x,content:T}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:I,height:F,data:V}=r.q.getImageData(i);this.style.addImage(d,{data:new r.r({width:I,height:F},V),pixelRatio:a,stretchX:v,stretchY:x,content:T,sdf:f,version:0,usvg:!1})}else if(i.width===void 0||i.height===void 0)this.fire(new r.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:F}=i,V=i;this.style.addImage(d,{data:new r.r({width:I,height:F},new Uint8Array(V.data)),pixelRatio:a,stretchX:v,stretchY:x,content:T,sdf:f,usvg:!1,version:0,userImage:V}),V.onAdd&&V.onAdd(this,d)}}updateImage(d,i){this._lazyInitEmptyStyle();const a=this.style.getImage(d);if(!a)return void this.fire(new r.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?r.q.getImageData(i):i,{width:v,height:x,data:T}=f;if(v===void 0||x===void 0)return void this.fire(new r.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==(a.usvg?a.icon.usvg_tree.width:a.data.width)||x!==(a.usvg?a.icon.usvg_tree.height:a.data.height))return void this.fire(new r.y(new Error(`The width and height of the updated image (${v}, ${x})
                must be that same as the previous version of the image
                (${a.data.width}, ${a.data.height})`)));const I=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);let F=!1;a.usvg?(a.data=new r.r({width:v,height:x},new Uint8Array(T)),a.usvg=!1,a.icon=void 0,F=!0):a.data.replace(T,I),this.style.updateImage(d,a,F)}hasImage(d){return d?!!this.style&&!!this.style.getImage(d):(this.fire(new r.y(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,i){r.o(this._requestManager.transformRequest(d,r.R.Image),(a,f)=>{i(a,f instanceof HTMLImageElement?r.q.getImageData(f):f)})}listImages(){return this.style.listImages()}addModel(d,i){this._lazyInitEmptyStyle(),this.style.addModel(d,i)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new r.y(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,i){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,i),this._update(!0)):this}getSlot(d){const i=this.getLayer(d);return i&&i.slot||null}setSlot(d,i){return this.style.setSlot(d,i),this.style.mergeLayers(),this._update(!0)}addImport(d,i){return this.style.addImport(d,i),this}updateImport(d,i){return typeof i!="string"&&i.id!==d?(this.removeImport(d),this.addImport(i)):(this.style.updateImport(d,i),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,i){return this.style.moveImport(d,i),this._update(!0)}moveLayer(d,i){return this._isValidId(d)?(this.style.moveLayer(d,i),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){if(!this._isValidId(d))return null;const i=this.style.getOwnLayer(d);return i?i.type==="custom"?i.implementation:i.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(d,i,a){return this._isValidId(d)?(this.style.setLayerZoomRange(d,i,a),this._update(!0)):this}setFilter(d,i,a={}){return this._isValidId(d)?(this.style.setFilter(d,i,a),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,i,a,f={}){return this._isValidId(d)?(this.style.setPaintProperty(d,i,a,f),this._update(!0)):this}getPaintProperty(d,i){return this._isValidId(d)?this.style.getPaintProperty(d,i):null}setLayoutProperty(d,i,a,f={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,i,a,f),this._update(!0)):this}getLayoutProperty(d,i){return this._isValidId(d)?this.style.getLayoutProperty(d,i):null}getSchema(d){return this.style.getSchema(d)}setSchema(d,i){return this.style.setSchema(d,i),this._update(!0)}getConfig(d){return this.style.getConfig(d)}setConfig(d,i){return this.style.setConfig(d,i),this._update(!0)}getConfigProperty(d,i){return this.style.getConfigProperty(d,i)}setConfigProperty(d,i,a){return this.style.setConfigProperty(d,i,a),this._update(!0)}getFeaturesetDescriptors(d){return this.style.getFeaturesetDescriptors(d)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){const i=d[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(d){return this._lazyInitEmptyStyle(),this.style.setSnow(d),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(d){return this._lazyInitEmptyStyle(),this.style.setRain(d),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(d){return this._lazyInitEmptyStyle(),this.style.setColorTheme(d),this._update(!0)}setImportColorTheme(d,i){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(d,i),this._update(!0)}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.bO.convert(d),this.transform):0}setFeatureState(d,i){return d.source&&!this._isValidId(d.source)?this:(this.style.setFeatureState(d,i),this._update())}removeFeatureState(d,i){return d.source&&!this._isValidId(d.source)?this:(this.style.removeFeatureState(d,i),this._update())}getFeatureState(d){return d.source&&!this._isValidId(d.source)?null:this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let a,f,v,x=this._container;for(;x&&(!f||!v);){const T=window.getComputedStyle(x).transform;T&&T!=="none"&&(a=T.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(f=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(v=a[3])),x=x.parentElement}this._containerWidth=f?Math.abs(d/f):d,this._containerHeight=v?Math.abs(i/v):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=qt("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=qt("div","mapboxgl-canvas-container",d);this._canvas=qt("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=qt("div","mapboxgl-control-container",d),f=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(v=>{f[v]=qt("div",`mapboxgl-ctrl-${v}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,i){const a=r.q.devicePixelRatio||1;this._canvas.width=a*Math.ceil(d),this._canvas.height=a*Math.ceil(i),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${i}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const i=this._markers.indexOf(d);i!==-1&&this._markers.splice(i,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const i=this._popups.indexOf(d);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const d=r.l({},Ai.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",d);i?(Ra(i,!0),this.painter=new Sf(i,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.m.testSupport(i)):this.fire(new r.y(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.z("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new r.z("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let i;this.fire(new r.z("renderstart")),++this._frameId;const a=this.painter.context.extTimerQuery,f=r.q.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=v.createQuery(),v.beginQuery(a.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const V=this.transform.zoom,j=this.transform.pitch,Z=r.q.now(),X=new r.a8(V,{now:Z,fadeDuration:x,pitch:j,transition:this.style.transition});this.style.update(X)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(f),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(f);const I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),I&&(this._placementDirty=I.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,Je.mark(de.load),this.fire(new r.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const V=r.q.now()-f;v.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{const j=v.getQueryParameter(i,v.QUERY_RESULT)/1e6;v.deleteQuery(i),this.fire(new r.z("gpu-timing-frame",{cpuTime:V,gpuTime:j}))},50)}if(this.listens("gpu-timing-layer")){const V=this.painter.collectGpuTimers();setTimeout(()=>{const j=this.painter.queryGpuTimers(V);this.fire(new r.z("gpu-timing-layer",{layerTimes:j}))},50)}if(this.listens("gpu-timing-deferred-render")){const V=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const j=this.painter.queryGpuTimeDeferredRender(V);this.fire(new r.z("gpu-timing-deferred-render",{gpuTime:j}))},50)}const F=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(F||this._repaint)this.triggerRepaint();else{const V=this.idle();if(V&&(T=this._updateAverageElevation(f,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),V&&(this.fire(new r.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const j=this._calculateSpeedIndex();this.fire(new r.z("speedindexcompleted",{speedIndex:j})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||F||(this._fullyLoaded=!0,Je.mark(de.fullLoad),this._performanceMetricsCollection&&fn(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const i of this._markers)d&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!d||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(d,i=!1){const a=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);const f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(i||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const v=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=d;const T=Math.abs(v-x);if(T>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(x),a(x);this._averageElevation.easeTo(x,d,300)}else if(T>1e-4)return this._averageElevation.jumpTo(x),a(x)}return!!this._averageElevation.isEasing(d)&&a(this._averageElevation.getValue(d))}_authenticate(){et(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===Yt||d.status===401)){const i=this.painter.context.gl;Ra(i,!1),this._logoControl instanceof Ko&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),pt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Wi(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const a=this.painter.context.gl,f=a.createFramebuffer();function v(x){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,x,0);const T=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,T),T}return a.bindFramebuffer(a.FRAMEBUFFER,f),this._canvasPixelComparison(v(d),i.canvasCopies.map(v),i.timeStamps)}_canvasPixelComparison(d,i,a){let f=a[1]-a[0];const v=d.length/4;for(let x=0;x<i.length;x++){const T=i[x];let I=0;for(let F=0;F<T.length;F+=4)T[F]===d[F]&&T[F+1]===d[F+1]&&T[F+2]===d[F+2]&&T[F+3]===d[F+3]&&(I+=1);f+=(a[x+2]-a[x+1])*(1-I/v)}return f}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),jr.delete(this.painter.context.gl),vr.remove(),bt.remove(),this._removed=!0,this.fire(new r.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=r.q.frame(i=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(i)}))}_preloadTiles(d){const i=this.style?this.style.getSourceCaches():[];return r.bl(i,(a,f)=>a._preloadTiles(d,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,this._tp.refreshUI(),d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,this._tp.refreshUI(),d&&this._update())}_setCacheLimits(d,i){r.dG(d,i)}get version(){return Ge}},NavigationControl:class{constructor(d={}){this.options=r.l({},yd,d),this._container=qt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(r.aP(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),qt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),qt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aP(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:i}):a.resetNorth({},{originalEvent:i}))}),this._compassIcon=qt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const i=d.getZoom(),a=i===d.getMaxZoom(),f=i===d.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Qo(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,i){const a=qt("button",d,this._container);return a.type="button",a.addEventListener("click",i),a}_setButtonTitle(d,i){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${i}`);d.setAttribute("aria-label",a),d.firstElementChild&&d.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends r.E{constructor(d={}){super();const i=navigator.geolocation;this.options=r.l({geolocation:i},io,d),r.aP(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Jd(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=qt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const i=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,d(a)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>i(a.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(d){const i=this._map.getMaxBounds(),a=d.coords;return!!i&&(a.longitude<i.getWest()||a.longitude>i.getEast()||a.latitude<i.getSouth()||a.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new r.z("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("geolocate",d)),this._finish()}}_updateCamera(d){const i=new r.bO(d.coords.longitude,d.coords.latitude),a=d.coords.accuracy,f=this._map.getBearing(),v=r.l({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(a),v,{geolocateSource:!0})}_updateMarker(d){if(d){const i=new r.bO(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,i=r.bH(1,d._center.lat)*d.worldSize,a=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=qt("button","mapboxgl-ctrl-geolocate",this._container),qt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=qt("div","mapboxgl-user-location"),this._dotElement.appendChild(qt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(qt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Pl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=qt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Pl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.z("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:vu,ScaleControl:class{constructor(d={}){this.options=r.l({},ho,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aP(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,i=this._map,a=i._containerHeight/2,f=i._containerWidth/2-d/2,v=i.unproject([f,a]),x=i.unproject([f+d,a]),T=v.distanceTo(x);if(this.options.unit==="imperial"){const I=3.2808*T;I>5280?this._setScale(d,I/5280,"mile"):this._setScale(d,I,"foot")}else this.options.unit==="nautical"?this._setScale(d,T/1852,"nautical-mile"):T>=1e3?this._setScale(d,T/1e3,"kilometer"):this._setScale(d,T,"meter")}_setScale(d,i,a){this._map._requestDomTask(()=>{const f=function(x){const T=Math.pow(10,`${Math.floor(x)}`.length-1);let I=x/T;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(F){const V=Math.pow(10,Math.ceil(-Math.log(F)/Math.LN10));return Math.round(F*V)/V}(I),T*I}(i),v=f/i;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(f):`${f}&nbsp;${Is[a]}`,this._container.style.width=d*v+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=qt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d={}){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:r.w("Full screen control 'container' must be a DOM element.")),r.aP(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=qt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=qt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);qt("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(d){super(),this.options=r.l(Object.create(Ol),d),r.aP(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new r.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new r.z("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=r.bO.convert(d),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const i=document.createDocumentFragment(),a=document.createElement("body");let f;for(a.innerHTML=d;f=a.firstChild,f;)i.appendChild(f);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=qt("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(d),this.options.closeButton){const a=this._closeButton=qt("button","mapboxgl-popup-close-button",i);a.type="button",a.setAttribute("aria-label","Close popup"),a.innerHTML='<span aria-hidden="true">&#215;</span>',a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let i;return this._classList.delete(d)?i=!1:(this._classList.add(d),i=!0),this._updateClassList(),i}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const i=this._map,a=this._container,f=this._pos;if(!i||!a||!f)return"bottom";const v=a.offsetWidth,x=a.offsetHeight,T=f.x<v/2,I=f.x>i.transform.width-v/2;if(f.y+d<x)return T?"top-left":I?"top-right":"top";if(f.y>i.transform.height-x){if(T)return"bottom-left";if(I)return"bottom-right"}return T?"left":I?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),d.className=i.join(" ")}_update(d){const i=this._map,a=this._content;if(!i||!this._lngLat&&!this._trackPointer||!a)return;let f=this._container;if(f||(f=this._container=qt("div","mapboxgl-popup",i.getContainer()),this._tip=qt("div","mapboxgl-popup-tip",f),f.appendChild(a)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=bu(this._lngLat,this._pos,i.transform)),!this._trackPointer||d){const v=this._pos=this._trackPointer&&d instanceof r.P?d:i.project(this._lngLat),x=wu(this.options.offset),T=this._anchor=this._getAnchor(x.y),I=wu(this.options.offset,T),F=v.add(I).round();i._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${cl[T]} translate(${F.x}px,${F.y}px)`)})}if(!this._marker&&i._showingGlobe()){const v=r.dH(i.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Va);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:Pl,Style:Oo,LngLat:r.bO,LngLatBounds:r.az,Point:r.P,MercatorCoordinate:r.aa,FreeCameraOptions:ch,Evented:r.E,config:r.e,prewarm:r.dM,clearPrewarmedResources:r.dN,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(d){r.e.ACCESS_TOKEN=d},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(d){r.e.API_URL=d},get workerCount(){return r.dO.workerCount},set workerCount(d){r.dO.workerCount=d},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){r.e.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){r.dP(d)},get workerUrl(){return r.dQ.workerUrl},set workerUrl(d){r.dQ.workerUrl=d},get workerClass(){return r.dQ.workerClass},set workerClass(d){r.dQ.workerClass=d},get workerParams(){return r.dQ.workerParams},set workerParams(d){r.dQ.workerParams=d},get dracoUrl(){return r.dR()},set dracoUrl(d){r.dS(d)},get meshoptUrl(){return r.dT()},set meshoptUrl(d){r.dU(d)},setNow:r.q.setNow,restoreNow:r.q.restoreNow}});var Le=St;return Le})}(Qg)),Qg.exports}var gb=mb();const _x=px(gb);var ty={exports:{}},iy={exports:{}},vg={exports:{}};/**
 * @license
 * Copyright 2010-2021 Three.js Authors
 * SPDX-License-Identifier: MIT
 */var _b=vg.exports,Nv;function Oc(){return Nv||(Nv=1,function(En,na){(function(U,Ze){Ze(na)})(_b,function(U){const Ze="132",$t="300 es";class ii{addEventListener(e,l){this._listeners===void 0&&(this._listeners={});const _=this._listeners;_[e]===void 0&&(_[e]=[]),_[e].indexOf(l)===-1&&_[e].push(l)}hasEventListener(e,l){if(this._listeners===void 0)return!1;const _=this._listeners;return _[e]!==void 0&&_[e].indexOf(l)!==-1}removeEventListener(e,l){if(this._listeners===void 0)return;const _=this._listeners[e];if(_!==void 0){const y=_.indexOf(l);y!==-1&&_.splice(y,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const l=this._listeners[e.type];if(l!==void 0){e.target=this;const _=l.slice(0);for(let y=0,S=_.length;y<S;y++)_[y].call(this,e);e.target=null}}}const Tn=[];for(let E=0;E<256;E++)Tn[E]=(E<16?"0":"")+E.toString(16);let wn=1234567;const gr=Math.PI/180,cr=180/Math.PI;function Sr(){const E=4294967295*Math.random()|0,e=4294967295*Math.random()|0,l=4294967295*Math.random()|0,_=4294967295*Math.random()|0;return(Tn[255&E]+Tn[E>>8&255]+Tn[E>>16&255]+Tn[E>>24&255]+"-"+Tn[255&e]+Tn[e>>8&255]+"-"+Tn[e>>16&15|64]+Tn[e>>24&255]+"-"+Tn[63&l|128]+Tn[l>>8&255]+"-"+Tn[l>>16&255]+Tn[l>>24&255]+Tn[255&_]+Tn[_>>8&255]+Tn[_>>16&255]+Tn[_>>24&255]).toUpperCase()}function Er(E,e,l){return Math.max(e,Math.min(l,E))}function mr(E,e){return(E%e+e)%e}function Nr(E,e,l){return(1-l)*E+l*e}function Ma(E){return(E&E-1)==0&&E!==0}function ga(E){return Math.pow(2,Math.ceil(Math.log(E)/Math.LN2))}function oo(E){return Math.pow(2,Math.floor(Math.log(E)/Math.LN2))}var $a=Object.freeze({__proto__:null,DEG2RAD:gr,RAD2DEG:cr,generateUUID:Sr,clamp:Er,euclideanModulo:mr,mapLinear:function(E,e,l,_,y){return _+(E-e)*(y-_)/(l-e)},inverseLerp:function(E,e,l){return E!==e?(l-E)/(e-E):0},lerp:Nr,damp:function(E,e,l,_){return Nr(E,e,1-Math.exp(-l*_))},pingpong:function(E,e=1){return e-Math.abs(mr(E,2*e)-e)},smoothstep:function(E,e,l){return E<=e?0:E>=l?1:(E=(E-e)/(l-e))*E*(3-2*E)},smootherstep:function(E,e,l){return E<=e?0:E>=l?1:(E=(E-e)/(l-e))*E*E*(E*(6*E-15)+10)},randInt:function(E,e){return E+Math.floor(Math.random()*(e-E+1))},randFloat:function(E,e){return E+Math.random()*(e-E)},randFloatSpread:function(E){return E*(.5-Math.random())},seededRandom:function(E){return E!==void 0&&(wn=E%2147483647),wn=16807*wn%2147483647,(wn-1)/2147483646},degToRad:function(E){return E*gr},radToDeg:function(E){return E*cr},isPowerOfTwo:Ma,ceilPowerOfTwo:ga,floorPowerOfTwo:oo,setQuaternionFromProperEuler:function(E,e,l,_,y){const S=Math.cos,O=Math.sin,k=S(l/2),N=O(l/2),G=S((e+_)/2),$=O((e+_)/2),K=S((e-_)/2),ie=O((e-_)/2),ne=S((_-e)/2),ue=O((_-e)/2);switch(y){case"XYX":E.set(k*$,N*K,N*ie,k*G);break;case"YZY":E.set(N*ie,k*$,N*K,k*G);break;case"ZXZ":E.set(N*K,N*ie,k*$,k*G);break;case"XZX":E.set(k*$,N*ue,N*ne,k*G);break;case"YXY":E.set(N*ne,k*$,N*ue,k*G);break;case"ZYZ":E.set(N*ue,N*ne,k*$,k*G);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+y)}}});class dn{constructor(e=0,l=0){this.x=e,this.y=l}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,l){return this.x=e,this.y=l,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,l){switch(e){case 0:this.x=l;break;case 1:this.y=l;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,l){return l!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,l)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,l){return this.x=e.x+l.x,this.y=e.y+l.y,this}addScaledVector(e,l){return this.x+=e.x*l,this.y+=e.y*l,this}sub(e,l){return l!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,l)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,l){return this.x=e.x-l.x,this.y=e.y-l.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const l=this.x,_=this.y,y=e.elements;return this.x=y[0]*l+y[3]*_+y[6],this.y=y[1]*l+y[4]*_+y[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,l){return this.x=Math.max(e.x,Math.min(l.x,this.x)),this.y=Math.max(e.y,Math.min(l.y,this.y)),this}clampScalar(e,l){return this.x=Math.max(e,Math.min(l,this.x)),this.y=Math.max(e,Math.min(l,this.y)),this}clampLength(e,l){const _=this.length();return this.divideScalar(_||1).multiplyScalar(Math.max(e,Math.min(l,_)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const l=this.x-e.x,_=this.y-e.y;return l*l+_*_}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,l){return this.x+=(e.x-this.x)*l,this.y+=(e.y-this.y)*l,this}lerpVectors(e,l,_){return this.x=e.x+(l.x-e.x)*_,this.y=e.y+(l.y-e.y)*_,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,l=0){return this.x=e[l],this.y=e[l+1],this}toArray(e=[],l=0){return e[l]=this.x,e[l+1]=this.y,e}fromBufferAttribute(e,l,_){return _!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(l),this.y=e.getY(l),this}rotateAround(e,l){const _=Math.cos(l),y=Math.sin(l),S=this.x-e.x,O=this.y-e.y;return this.x=S*_-O*y+e.x,this.y=S*y+O*_+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}dn.prototype.isVector2=!0;class Xn{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,l,_,y,S,O,k,N,G){const $=this.elements;return $[0]=e,$[1]=y,$[2]=k,$[3]=l,$[4]=S,$[5]=N,$[6]=_,$[7]=O,$[8]=G,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const l=this.elements,_=e.elements;return l[0]=_[0],l[1]=_[1],l[2]=_[2],l[3]=_[3],l[4]=_[4],l[5]=_[5],l[6]=_[6],l[7]=_[7],l[8]=_[8],this}extractBasis(e,l,_){return e.setFromMatrix3Column(this,0),l.setFromMatrix3Column(this,1),_.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const l=e.elements;return this.set(l[0],l[4],l[8],l[1],l[5],l[9],l[2],l[6],l[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,l){const _=e.elements,y=l.elements,S=this.elements,O=_[0],k=_[3],N=_[6],G=_[1],$=_[4],K=_[7],ie=_[2],ne=_[5],ue=_[8],ye=y[0],Se=y[3],_e=y[6],$e=y[1],st=y[4],ot=y[7],Lt=y[2],Bt=y[5],di=y[8];return S[0]=O*ye+k*$e+N*Lt,S[3]=O*Se+k*st+N*Bt,S[6]=O*_e+k*ot+N*di,S[1]=G*ye+$*$e+K*Lt,S[4]=G*Se+$*st+K*Bt,S[7]=G*_e+$*ot+K*di,S[2]=ie*ye+ne*$e+ue*Lt,S[5]=ie*Se+ne*st+ue*Bt,S[8]=ie*_e+ne*ot+ue*di,this}multiplyScalar(e){const l=this.elements;return l[0]*=e,l[3]*=e,l[6]*=e,l[1]*=e,l[4]*=e,l[7]*=e,l[2]*=e,l[5]*=e,l[8]*=e,this}determinant(){const e=this.elements,l=e[0],_=e[1],y=e[2],S=e[3],O=e[4],k=e[5],N=e[6],G=e[7],$=e[8];return l*O*$-l*k*G-_*S*$+_*k*N+y*S*G-y*O*N}invert(){const e=this.elements,l=e[0],_=e[1],y=e[2],S=e[3],O=e[4],k=e[5],N=e[6],G=e[7],$=e[8],K=$*O-k*G,ie=k*N-$*S,ne=G*S-O*N,ue=l*K+_*ie+y*ne;if(ue===0)return this.set(0,0,0,0,0,0,0,0,0);const ye=1/ue;return e[0]=K*ye,e[1]=(y*G-$*_)*ye,e[2]=(k*_-y*O)*ye,e[3]=ie*ye,e[4]=($*l-y*N)*ye,e[5]=(y*S-k*l)*ye,e[6]=ne*ye,e[7]=(_*N-G*l)*ye,e[8]=(O*l-_*S)*ye,this}transpose(){let e;const l=this.elements;return e=l[1],l[1]=l[3],l[3]=e,e=l[2],l[2]=l[6],l[6]=e,e=l[5],l[5]=l[7],l[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const l=this.elements;return e[0]=l[0],e[1]=l[3],e[2]=l[6],e[3]=l[1],e[4]=l[4],e[5]=l[7],e[6]=l[2],e[7]=l[5],e[8]=l[8],this}setUvTransform(e,l,_,y,S,O,k){const N=Math.cos(S),G=Math.sin(S);return this.set(_*N,_*G,-_*(N*O+G*k)+O+e,-y*G,y*N,-y*(-G*O+N*k)+k+l,0,0,1),this}scale(e,l){const _=this.elements;return _[0]*=e,_[3]*=e,_[6]*=e,_[1]*=l,_[4]*=l,_[7]*=l,this}rotate(e){const l=Math.cos(e),_=Math.sin(e),y=this.elements,S=y[0],O=y[3],k=y[6],N=y[1],G=y[4],$=y[7];return y[0]=l*S+_*N,y[3]=l*O+_*G,y[6]=l*k+_*$,y[1]=-_*S+l*N,y[4]=-_*O+l*G,y[7]=-_*k+l*$,this}translate(e,l){const _=this.elements;return _[0]+=e*_[2],_[3]+=e*_[5],_[6]+=e*_[8],_[1]+=l*_[2],_[4]+=l*_[5],_[7]+=l*_[8],this}equals(e){const l=this.elements,_=e.elements;for(let y=0;y<9;y++)if(l[y]!==_[y])return!1;return!0}fromArray(e,l=0){for(let _=0;_<9;_++)this.elements[_]=e[_+l];return this}toArray(e=[],l=0){const _=this.elements;return e[l]=_[0],e[l+1]=_[1],e[l+2]=_[2],e[l+3]=_[3],e[l+4]=_[4],e[l+5]=_[5],e[l+6]=_[6],e[l+7]=_[7],e[l+8]=_[8],e}clone(){return new this.constructor().fromArray(this.elements)}}let Qa;Xn.prototype.isMatrix3=!0;class lo{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let l;if(e instanceof HTMLCanvasElement)l=e;else{Qa===void 0&&(Qa=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Qa.width=e.width,Qa.height=e.height;const _=Qa.getContext("2d");e instanceof ImageData?_.putImageData(e,0,0):_.drawImage(e,0,0,e.width,e.height),l=Qa}return l.width>2048||l.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),l.toDataURL("image/jpeg",.6)):l.toDataURL("image/png")}}let Us=0;class Ca extends ii{constructor(e=Ca.DEFAULT_IMAGE,l=Ca.DEFAULT_MAPPING,_=1001,y=1001,S=1006,O=1008,k=1023,N=1009,G=1,$=3e3){super(),Object.defineProperty(this,"id",{value:Us++}),this.uuid=Sr(),this.name="",this.image=e,this.mipmaps=[],this.mapping=l,this.wrapS=_,this.wrapT=y,this.magFilter=S,this.minFilter=O,this.anisotropy=G,this.format=k,this.internalFormat=null,this.type=N,this.offset=new dn(0,0),this.repeat=new dn(1,1),this.center=new dn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Xn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=$,this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const l=e===void 0||typeof e=="string";if(!l&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const _={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){const y=this.image;if(y.uuid===void 0&&(y.uuid=Sr()),!l&&e.images[y.uuid]===void 0){let S;if(Array.isArray(y)){S=[];for(let O=0,k=y.length;O<k;O++)y[O].isDataTexture?S.push(ja(y[O].image)):S.push(ja(y[O]))}else S=ja(y);e.images[y.uuid]={uuid:y.uuid,url:S}}_.image=y.uuid}return l||(e.textures[this.uuid]=_),_}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&this.version++}}function ja(E){return typeof HTMLImageElement<"u"&&E instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&E instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&E instanceof ImageBitmap?lo.getDataURL(E):E.data?{data:Array.prototype.slice.call(E.data),width:E.width,height:E.height,type:E.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Ca.DEFAULT_IMAGE=void 0,Ca.DEFAULT_MAPPING=300,Ca.prototype.isTexture=!0;class qr{constructor(e=0,l=0,_=0,y=1){this.x=e,this.y=l,this.z=_,this.w=y}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,l,_,y){return this.x=e,this.y=l,this.z=_,this.w=y,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,l){switch(e){case 0:this.x=l;break;case 1:this.y=l;break;case 2:this.z=l;break;case 3:this.w=l;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,l){return l!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,l)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,l){return this.x=e.x+l.x,this.y=e.y+l.y,this.z=e.z+l.z,this.w=e.w+l.w,this}addScaledVector(e,l){return this.x+=e.x*l,this.y+=e.y*l,this.z+=e.z*l,this.w+=e.w*l,this}sub(e,l){return l!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,l)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,l){return this.x=e.x-l.x,this.y=e.y-l.y,this.z=e.z-l.z,this.w=e.w-l.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const l=this.x,_=this.y,y=this.z,S=this.w,O=e.elements;return this.x=O[0]*l+O[4]*_+O[8]*y+O[12]*S,this.y=O[1]*l+O[5]*_+O[9]*y+O[13]*S,this.z=O[2]*l+O[6]*_+O[10]*y+O[14]*S,this.w=O[3]*l+O[7]*_+O[11]*y+O[15]*S,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const l=Math.sqrt(1-e.w*e.w);return l<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/l,this.y=e.y/l,this.z=e.z/l),this}setAxisAngleFromRotationMatrix(e){let l,_,y,S;const N=e.elements,G=N[0],$=N[4],K=N[8],ie=N[1],ne=N[5],ue=N[9],ye=N[2],Se=N[6],_e=N[10];if(Math.abs($-ie)<.01&&Math.abs(K-ye)<.01&&Math.abs(ue-Se)<.01){if(Math.abs($+ie)<.1&&Math.abs(K+ye)<.1&&Math.abs(ue+Se)<.1&&Math.abs(G+ne+_e-3)<.1)return this.set(1,0,0,0),this;l=Math.PI;const st=(G+1)/2,ot=(ne+1)/2,Lt=(_e+1)/2,Bt=($+ie)/4,di=(K+ye)/4,Ti=(ue+Se)/4;return st>ot&&st>Lt?st<.01?(_=0,y=.707106781,S=.707106781):(_=Math.sqrt(st),y=Bt/_,S=di/_):ot>Lt?ot<.01?(_=.707106781,y=0,S=.707106781):(y=Math.sqrt(ot),_=Bt/y,S=Ti/y):Lt<.01?(_=.707106781,y=.707106781,S=0):(S=Math.sqrt(Lt),_=di/S,y=Ti/S),this.set(_,y,S,l),this}let $e=Math.sqrt((Se-ue)*(Se-ue)+(K-ye)*(K-ye)+(ie-$)*(ie-$));return Math.abs($e)<.001&&($e=1),this.x=(Se-ue)/$e,this.y=(K-ye)/$e,this.z=(ie-$)/$e,this.w=Math.acos((G+ne+_e-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,l){return this.x=Math.max(e.x,Math.min(l.x,this.x)),this.y=Math.max(e.y,Math.min(l.y,this.y)),this.z=Math.max(e.z,Math.min(l.z,this.z)),this.w=Math.max(e.w,Math.min(l.w,this.w)),this}clampScalar(e,l){return this.x=Math.max(e,Math.min(l,this.x)),this.y=Math.max(e,Math.min(l,this.y)),this.z=Math.max(e,Math.min(l,this.z)),this.w=Math.max(e,Math.min(l,this.w)),this}clampLength(e,l){const _=this.length();return this.divideScalar(_||1).multiplyScalar(Math.max(e,Math.min(l,_)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,l){return this.x+=(e.x-this.x)*l,this.y+=(e.y-this.y)*l,this.z+=(e.z-this.z)*l,this.w+=(e.w-this.w)*l,this}lerpVectors(e,l,_){return this.x=e.x+(l.x-e.x)*_,this.y=e.y+(l.y-e.y)*_,this.z=e.z+(l.z-e.z)*_,this.w=e.w+(l.w-e.w)*_,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,l=0){return this.x=e[l],this.y=e[l+1],this.z=e[l+2],this.w=e[l+3],this}toArray(e=[],l=0){return e[l]=this.x,e[l+1]=this.y,e[l+2]=this.z,e[l+3]=this.w,e}fromBufferAttribute(e,l,_){return _!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(l),this.y=e.getY(l),this.z=e.getZ(l),this.w=e.getW(l),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}qr.prototype.isVector4=!0;class gs extends ii{constructor(e,l,_={}){super(),this.width=e,this.height=l,this.depth=1,this.scissor=new qr(0,0,e,l),this.scissorTest=!1,this.viewport=new qr(0,0,e,l),this.texture=new Ca(void 0,_.mapping,_.wrapS,_.wrapT,_.magFilter,_.minFilter,_.format,_.type,_.anisotropy,_.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:l,depth:1},this.texture.generateMipmaps=_.generateMipmaps!==void 0&&_.generateMipmaps,this.texture.internalFormat=_.internalFormat!==void 0?_.internalFormat:null,this.texture.minFilter=_.minFilter!==void 0?_.minFilter:1006,this.depthBuffer=_.depthBuffer===void 0||_.depthBuffer,this.stencilBuffer=_.stencilBuffer!==void 0&&_.stencilBuffer,this.depthTexture=_.depthTexture!==void 0?_.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,l,_=1){this.width===e&&this.height===l&&this.depth===_||(this.width=e,this.height=l,this.depth=_,this.texture.image.width=e,this.texture.image.height=l,this.texture.image.depth=_,this.dispose()),this.viewport.set(0,0,e,l),this.scissor.set(0,0,e,l)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}gs.prototype.isWebGLRenderTarget=!0;class $s extends gs{constructor(e,l,_){super(e,l);const y=this.texture;this.texture=[];for(let S=0;S<_;S++)this.texture[S]=y.clone()}setSize(e,l,_=1){if(this.width!==e||this.height!==l||this.depth!==_){this.width=e,this.height=l,this.depth=_;for(let y=0,S=this.texture.length;y<S;y++)this.texture[y].image.width=e,this.texture[y].image.height=l,this.texture[y].image.depth=_;this.dispose()}return this.viewport.set(0,0,e,l),this.scissor.set(0,0,e,l),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let l=0,_=e.texture.length;l<_;l++)this.texture[l]=e.texture[l].clone();return this}}$s.prototype.isWebGLMultipleRenderTargets=!0;class Lo extends gs{constructor(e,l,_){super(e,l,_),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}Lo.prototype.isWebGLMultisampleRenderTarget=!0;class Ls{constructor(e=0,l=0,_=0,y=1){this._x=e,this._y=l,this._z=_,this._w=y}static slerp(e,l,_,y){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),_.slerpQuaternions(e,l,y)}static slerpFlat(e,l,_,y,S,O,k){let N=_[y+0],G=_[y+1],$=_[y+2],K=_[y+3];const ie=S[O+0],ne=S[O+1],ue=S[O+2],ye=S[O+3];if(k===0)return e[l+0]=N,e[l+1]=G,e[l+2]=$,void(e[l+3]=K);if(k===1)return e[l+0]=ie,e[l+1]=ne,e[l+2]=ue,void(e[l+3]=ye);if(K!==ye||N!==ie||G!==ne||$!==ue){let Se=1-k;const _e=N*ie+G*ne+$*ue+K*ye,$e=_e>=0?1:-1,st=1-_e*_e;if(st>Number.EPSILON){const Lt=Math.sqrt(st),Bt=Math.atan2(Lt,_e*$e);Se=Math.sin(Se*Bt)/Lt,k=Math.sin(k*Bt)/Lt}const ot=k*$e;if(N=N*Se+ie*ot,G=G*Se+ne*ot,$=$*Se+ue*ot,K=K*Se+ye*ot,Se===1-k){const Lt=1/Math.sqrt(N*N+G*G+$*$+K*K);N*=Lt,G*=Lt,$*=Lt,K*=Lt}}e[l]=N,e[l+1]=G,e[l+2]=$,e[l+3]=K}static multiplyQuaternionsFlat(e,l,_,y,S,O){const k=_[y],N=_[y+1],G=_[y+2],$=_[y+3],K=S[O],ie=S[O+1],ne=S[O+2],ue=S[O+3];return e[l]=k*ue+$*K+N*ne-G*ie,e[l+1]=N*ue+$*ie+G*K-k*ne,e[l+2]=G*ue+$*ne+k*ie-N*K,e[l+3]=$*ue-k*K-N*ie-G*ne,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,l,_,y){return this._x=e,this._y=l,this._z=_,this._w=y,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,l){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const _=e._x,y=e._y,S=e._z,O=e._order,k=Math.cos,N=Math.sin,G=k(_/2),$=k(y/2),K=k(S/2),ie=N(_/2),ne=N(y/2),ue=N(S/2);switch(O){case"XYZ":this._x=ie*$*K+G*ne*ue,this._y=G*ne*K-ie*$*ue,this._z=G*$*ue+ie*ne*K,this._w=G*$*K-ie*ne*ue;break;case"YXZ":this._x=ie*$*K+G*ne*ue,this._y=G*ne*K-ie*$*ue,this._z=G*$*ue-ie*ne*K,this._w=G*$*K+ie*ne*ue;break;case"ZXY":this._x=ie*$*K-G*ne*ue,this._y=G*ne*K+ie*$*ue,this._z=G*$*ue+ie*ne*K,this._w=G*$*K-ie*ne*ue;break;case"ZYX":this._x=ie*$*K-G*ne*ue,this._y=G*ne*K+ie*$*ue,this._z=G*$*ue-ie*ne*K,this._w=G*$*K+ie*ne*ue;break;case"YZX":this._x=ie*$*K+G*ne*ue,this._y=G*ne*K+ie*$*ue,this._z=G*$*ue-ie*ne*K,this._w=G*$*K-ie*ne*ue;break;case"XZY":this._x=ie*$*K-G*ne*ue,this._y=G*ne*K-ie*$*ue,this._z=G*$*ue+ie*ne*K,this._w=G*$*K+ie*ne*ue;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+O)}return l!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,l){const _=l/2,y=Math.sin(_);return this._x=e.x*y,this._y=e.y*y,this._z=e.z*y,this._w=Math.cos(_),this._onChangeCallback(),this}setFromRotationMatrix(e){const l=e.elements,_=l[0],y=l[4],S=l[8],O=l[1],k=l[5],N=l[9],G=l[2],$=l[6],K=l[10],ie=_+k+K;if(ie>0){const ne=.5/Math.sqrt(ie+1);this._w=.25/ne,this._x=($-N)*ne,this._y=(S-G)*ne,this._z=(O-y)*ne}else if(_>k&&_>K){const ne=2*Math.sqrt(1+_-k-K);this._w=($-N)/ne,this._x=.25*ne,this._y=(y+O)/ne,this._z=(S+G)/ne}else if(k>K){const ne=2*Math.sqrt(1+k-_-K);this._w=(S-G)/ne,this._x=(y+O)/ne,this._y=.25*ne,this._z=(N+$)/ne}else{const ne=2*Math.sqrt(1+K-_-k);this._w=(O-y)/ne,this._x=(S+G)/ne,this._y=(N+$)/ne,this._z=.25*ne}return this._onChangeCallback(),this}setFromUnitVectors(e,l){let _=e.dot(l)+1;return _<Number.EPSILON?(_=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=_):(this._x=0,this._y=-e.z,this._z=e.y,this._w=_)):(this._x=e.y*l.z-e.z*l.y,this._y=e.z*l.x-e.x*l.z,this._z=e.x*l.y-e.y*l.x,this._w=_),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Er(this.dot(e),-1,1)))}rotateTowards(e,l){const _=this.angleTo(e);if(_===0)return this;const y=Math.min(1,l/_);return this.slerp(e,y),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,l){return l!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,l)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,l){const _=e._x,y=e._y,S=e._z,O=e._w,k=l._x,N=l._y,G=l._z,$=l._w;return this._x=_*$+O*k+y*G-S*N,this._y=y*$+O*N+S*k-_*G,this._z=S*$+O*G+_*N-y*k,this._w=O*$-_*k-y*N-S*G,this._onChangeCallback(),this}slerp(e,l){if(l===0)return this;if(l===1)return this.copy(e);const _=this._x,y=this._y,S=this._z,O=this._w;let k=O*e._w+_*e._x+y*e._y+S*e._z;if(k<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,k=-k):this.copy(e),k>=1)return this._w=O,this._x=_,this._y=y,this._z=S,this;const N=1-k*k;if(N<=Number.EPSILON){const ne=1-l;return this._w=ne*O+l*this._w,this._x=ne*_+l*this._x,this._y=ne*y+l*this._y,this._z=ne*S+l*this._z,this.normalize(),this._onChangeCallback(),this}const G=Math.sqrt(N),$=Math.atan2(G,k),K=Math.sin((1-l)*$)/G,ie=Math.sin(l*$)/G;return this._w=O*K+this._w*ie,this._x=_*K+this._x*ie,this._y=y*K+this._y*ie,this._z=S*K+this._z*ie,this._onChangeCallback(),this}slerpQuaternions(e,l,_){this.copy(e).slerp(l,_)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,l=0){return this._x=e[l],this._y=e[l+1],this._z=e[l+2],this._w=e[l+3],this._onChangeCallback(),this}toArray(e=[],l=0){return e[l]=this._x,e[l+1]=this._y,e[l+2]=this._z,e[l+3]=this._w,e}fromBufferAttribute(e,l){return this._x=e.getX(l),this._y=e.getY(l),this._z=e.getZ(l),this._w=e.getW(l),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Ls.prototype.isQuaternion=!0;class ht{constructor(e=0,l=0,_=0){this.x=e,this.y=l,this.z=_}set(e,l,_){return _===void 0&&(_=this.z),this.x=e,this.y=l,this.z=_,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,l){switch(e){case 0:this.x=l;break;case 1:this.y=l;break;case 2:this.z=l;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,l){return l!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,l)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,l){return this.x=e.x+l.x,this.y=e.y+l.y,this.z=e.z+l.z,this}addScaledVector(e,l){return this.x+=e.x*l,this.y+=e.y*l,this.z+=e.z*l,this}sub(e,l){return l!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,l)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,l){return this.x=e.x-l.x,this.y=e.y-l.y,this.z=e.z-l.z,this}multiply(e,l){return l!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,l)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,l){return this.x=e.x*l.x,this.y=e.y*l.y,this.z=e.z*l.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Ks.setFromEuler(e))}applyAxisAngle(e,l){return this.applyQuaternion(Ks.setFromAxisAngle(e,l))}applyMatrix3(e){const l=this.x,_=this.y,y=this.z,S=e.elements;return this.x=S[0]*l+S[3]*_+S[6]*y,this.y=S[1]*l+S[4]*_+S[7]*y,this.z=S[2]*l+S[5]*_+S[8]*y,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const l=this.x,_=this.y,y=this.z,S=e.elements,O=1/(S[3]*l+S[7]*_+S[11]*y+S[15]);return this.x=(S[0]*l+S[4]*_+S[8]*y+S[12])*O,this.y=(S[1]*l+S[5]*_+S[9]*y+S[13])*O,this.z=(S[2]*l+S[6]*_+S[10]*y+S[14])*O,this}applyQuaternion(e){const l=this.x,_=this.y,y=this.z,S=e.x,O=e.y,k=e.z,N=e.w,G=N*l+O*y-k*_,$=N*_+k*l-S*y,K=N*y+S*_-O*l,ie=-S*l-O*_-k*y;return this.x=G*N+ie*-S+$*-k-K*-O,this.y=$*N+ie*-O+K*-S-G*-k,this.z=K*N+ie*-k+G*-O-$*-S,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const l=this.x,_=this.y,y=this.z,S=e.elements;return this.x=S[0]*l+S[4]*_+S[8]*y,this.y=S[1]*l+S[5]*_+S[9]*y,this.z=S[2]*l+S[6]*_+S[10]*y,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,l){return this.x=Math.max(e.x,Math.min(l.x,this.x)),this.y=Math.max(e.y,Math.min(l.y,this.y)),this.z=Math.max(e.z,Math.min(l.z,this.z)),this}clampScalar(e,l){return this.x=Math.max(e,Math.min(l,this.x)),this.y=Math.max(e,Math.min(l,this.y)),this.z=Math.max(e,Math.min(l,this.z)),this}clampLength(e,l){const _=this.length();return this.divideScalar(_||1).multiplyScalar(Math.max(e,Math.min(l,_)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,l){return this.x+=(e.x-this.x)*l,this.y+=(e.y-this.y)*l,this.z+=(e.z-this.z)*l,this}lerpVectors(e,l,_){return this.x=e.x+(l.x-e.x)*_,this.y=e.y+(l.y-e.y)*_,this.z=e.z+(l.z-e.z)*_,this}cross(e,l){return l!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,l)):this.crossVectors(this,e)}crossVectors(e,l){const _=e.x,y=e.y,S=e.z,O=l.x,k=l.y,N=l.z;return this.x=y*N-S*k,this.y=S*O-_*N,this.z=_*k-y*O,this}projectOnVector(e){const l=e.lengthSq();if(l===0)return this.set(0,0,0);const _=e.dot(this)/l;return this.copy(e).multiplyScalar(_)}projectOnPlane(e){return es.copy(this).projectOnVector(e),this.sub(es)}reflect(e){return this.sub(es.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const l=Math.sqrt(this.lengthSq()*e.lengthSq());if(l===0)return Math.PI/2;const _=this.dot(e)/l;return Math.acos(Er(_,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const l=this.x-e.x,_=this.y-e.y,y=this.z-e.z;return l*l+_*_+y*y}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,l,_){const y=Math.sin(l)*e;return this.x=y*Math.sin(_),this.y=Math.cos(l)*e,this.z=y*Math.cos(_),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,l,_){return this.x=e*Math.sin(l),this.y=_,this.z=e*Math.cos(l),this}setFromMatrixPosition(e){const l=e.elements;return this.x=l[12],this.y=l[13],this.z=l[14],this}setFromMatrixScale(e){const l=this.setFromMatrixColumn(e,0).length(),_=this.setFromMatrixColumn(e,1).length(),y=this.setFromMatrixColumn(e,2).length();return this.x=l,this.y=_,this.z=y,this}setFromMatrixColumn(e,l){return this.fromArray(e.elements,4*l)}setFromMatrix3Column(e,l){return this.fromArray(e.elements,3*l)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,l=0){return this.x=e[l],this.y=e[l+1],this.z=e[l+2],this}toArray(e=[],l=0){return e[l]=this.x,e[l+1]=this.y,e[l+2]=this.z,e}fromBufferAttribute(e,l,_){return _!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(l),this.y=e.getY(l),this.z=e.getZ(l),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}ht.prototype.isVector3=!0;const es=new ht,Ks=new Ls;class Js{constructor(e=new ht(1/0,1/0,1/0),l=new ht(-1/0,-1/0,-1/0)){this.min=e,this.max=l}set(e,l){return this.min.copy(e),this.max.copy(l),this}setFromArray(e){let l=1/0,_=1/0,y=1/0,S=-1/0,O=-1/0,k=-1/0;for(let N=0,G=e.length;N<G;N+=3){const $=e[N],K=e[N+1],ie=e[N+2];$<l&&(l=$),K<_&&(_=K),ie<y&&(y=ie),$>S&&(S=$),K>O&&(O=K),ie>k&&(k=ie)}return this.min.set(l,_,y),this.max.set(S,O,k),this}setFromBufferAttribute(e){let l=1/0,_=1/0,y=1/0,S=-1/0,O=-1/0,k=-1/0;for(let N=0,G=e.count;N<G;N++){const $=e.getX(N),K=e.getY(N),ie=e.getZ(N);$<l&&(l=$),K<_&&(_=K),ie<y&&(y=ie),$>S&&(S=$),K>O&&(O=K),ie>k&&(k=ie)}return this.min.set(l,_,y),this.max.set(S,O,k),this}setFromPoints(e){this.makeEmpty();for(let l=0,_=e.length;l<_;l++)this.expandByPoint(e[l]);return this}setFromCenterAndSize(e,l){const _=xs.copy(l).multiplyScalar(.5);return this.min.copy(e).sub(_),this.max.copy(e).add(_),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const l=e.geometry;l!==void 0&&(l.boundingBox===null&&l.computeBoundingBox(),Io.copy(l.boundingBox),Io.applyMatrix4(e.matrixWorld),this.union(Io));const _=e.children;for(let y=0,S=_.length;y<S;y++)this.expandByObject(_[y]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,l){return l.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,xs),xs.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let l,_;return e.normal.x>0?(l=e.normal.x*this.min.x,_=e.normal.x*this.max.x):(l=e.normal.x*this.max.x,_=e.normal.x*this.min.x),e.normal.y>0?(l+=e.normal.y*this.min.y,_+=e.normal.y*this.max.y):(l+=e.normal.y*this.max.y,_+=e.normal.y*this.min.y),e.normal.z>0?(l+=e.normal.z*this.min.z,_+=e.normal.z*this.max.z):(l+=e.normal.z*this.max.z,_+=e.normal.z*this.min.z),l<=-e.constant&&_>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(ut),It.subVectors(this.max,ut),Xt.subVectors(e.a,ut),oe.subVectors(e.b,ut),pe.subVectors(e.c,ut),Ce.subVectors(oe,Xt),qe.subVectors(pe,oe),Qe.subVectors(Xt,pe);let l=[0,-Ce.z,Ce.y,0,-qe.z,qe.y,0,-Qe.z,Qe.y,Ce.z,0,-Ce.x,qe.z,0,-qe.x,Qe.z,0,-Qe.x,-Ce.y,Ce.x,0,-qe.y,qe.x,0,-Qe.y,Qe.x,0];return!!Gt(l,Xt,oe,pe,It)&&(l=[1,0,0,0,1,0,0,0,1],!!Gt(l,Xt,oe,pe,It)&&(mt.crossVectors(Ce,qe),l=[mt.x,mt.y,mt.z],Gt(l,Xt,oe,pe,It)))}clampPoint(e,l){return l.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return xs.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(xs).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Ro[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ro[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ro[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ro[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ro[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ro[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ro[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ro[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ro)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Js.prototype.isBox3=!0;const Ro=[new ht,new ht,new ht,new ht,new ht,new ht,new ht,new ht],xs=new ht,Io=new Js,Xt=new ht,oe=new ht,pe=new ht,Ce=new ht,qe=new ht,Qe=new ht,ut=new ht,It=new ht,mt=new ht,Vt=new ht;function Gt(E,e,l,_,y){for(let S=0,O=E.length-3;S<=O;S+=3){Vt.fromArray(E,S);const k=y.x*Math.abs(Vt.x)+y.y*Math.abs(Vt.y)+y.z*Math.abs(Vt.z),N=e.dot(Vt),G=l.dot(Vt),$=_.dot(Vt);if(Math.max(-Math.max(N,G,$),Math.min(N,G,$))>k)return!1}return!0}const Wt=new Js,Mi=new ht,Qi=new ht,nn=new ht;class zn{constructor(e=new ht,l=-1){this.center=e,this.radius=l}set(e,l){return this.center.copy(e),this.radius=l,this}setFromPoints(e,l){const _=this.center;l!==void 0?_.copy(l):Wt.setFromPoints(e).getCenter(_);let y=0;for(let S=0,O=e.length;S<O;S++)y=Math.max(y,_.distanceToSquared(e[S]));return this.radius=Math.sqrt(y),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const l=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=l*l}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,l){const _=this.center.distanceToSquared(e);return l.copy(e),_>this.radius*this.radius&&(l.sub(this.center).normalize(),l.multiplyScalar(this.radius).add(this.center)),l}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){nn.subVectors(e,this.center);const l=nn.lengthSq();if(l>this.radius*this.radius){const _=Math.sqrt(l),y=.5*(_-this.radius);this.center.add(nn.multiplyScalar(y/_)),this.radius+=y}return this}union(e){return Qi.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(Mi.copy(e.center).add(Qi)),this.expandByPoint(Mi.copy(e.center).sub(Qi)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const jn=new ht,ar=new ht,Wn=new ht,Rr=new ht,Ur=new ht,Br=new ht,sa=new ht;class Wr{constructor(e=new ht,l=new ht(0,0,-1)){this.origin=e,this.direction=l}set(e,l){return this.origin.copy(e),this.direction.copy(l),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,l){return l.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,jn)),this}closestPointToPoint(e,l){l.subVectors(e,this.origin);const _=l.dot(this.direction);return _<0?l.copy(this.origin):l.copy(this.direction).multiplyScalar(_).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const l=jn.subVectors(e,this.origin).dot(this.direction);return l<0?this.origin.distanceToSquared(e):(jn.copy(this.direction).multiplyScalar(l).add(this.origin),jn.distanceToSquared(e))}distanceSqToSegment(e,l,_,y){ar.copy(e).add(l).multiplyScalar(.5),Wn.copy(l).sub(e).normalize(),Rr.copy(this.origin).sub(ar);const S=.5*e.distanceTo(l),O=-this.direction.dot(Wn),k=Rr.dot(this.direction),N=-Rr.dot(Wn),G=Rr.lengthSq(),$=Math.abs(1-O*O);let K,ie,ne,ue;if($>0)if(K=O*N-k,ie=O*k-N,ue=S*$,K>=0)if(ie>=-ue)if(ie<=ue){const ye=1/$;K*=ye,ie*=ye,ne=K*(K+O*ie+2*k)+ie*(O*K+ie+2*N)+G}else ie=S,K=Math.max(0,-(O*ie+k)),ne=-K*K+ie*(ie+2*N)+G;else ie=-S,K=Math.max(0,-(O*ie+k)),ne=-K*K+ie*(ie+2*N)+G;else ie<=-ue?(K=Math.max(0,-(-O*S+k)),ie=K>0?-S:Math.min(Math.max(-S,-N),S),ne=-K*K+ie*(ie+2*N)+G):ie<=ue?(K=0,ie=Math.min(Math.max(-S,-N),S),ne=ie*(ie+2*N)+G):(K=Math.max(0,-(O*S+k)),ie=K>0?S:Math.min(Math.max(-S,-N),S),ne=-K*K+ie*(ie+2*N)+G);else ie=O>0?-S:S,K=Math.max(0,-(O*ie+k)),ne=-K*K+ie*(ie+2*N)+G;return _&&_.copy(this.direction).multiplyScalar(K).add(this.origin),y&&y.copy(Wn).multiplyScalar(ie).add(ar),ne}intersectSphere(e,l){jn.subVectors(e.center,this.origin);const _=jn.dot(this.direction),y=jn.dot(jn)-_*_,S=e.radius*e.radius;if(y>S)return null;const O=Math.sqrt(S-y),k=_-O,N=_+O;return k<0&&N<0?null:k<0?this.at(N,l):this.at(k,l)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const l=e.normal.dot(this.direction);if(l===0)return e.distanceToPoint(this.origin)===0?0:null;const _=-(this.origin.dot(e.normal)+e.constant)/l;return _>=0?_:null}intersectPlane(e,l){const _=this.distanceToPlane(e);return _===null?null:this.at(_,l)}intersectsPlane(e){const l=e.distanceToPoint(this.origin);return l===0?!0:e.normal.dot(this.direction)*l<0}intersectBox(e,l){let _,y,S,O,k,N;const G=1/this.direction.x,$=1/this.direction.y,K=1/this.direction.z,ie=this.origin;return G>=0?(_=(e.min.x-ie.x)*G,y=(e.max.x-ie.x)*G):(_=(e.max.x-ie.x)*G,y=(e.min.x-ie.x)*G),$>=0?(S=(e.min.y-ie.y)*$,O=(e.max.y-ie.y)*$):(S=(e.max.y-ie.y)*$,O=(e.min.y-ie.y)*$),_>O||S>y?null:((S>_||_!=_)&&(_=S),(O<y||y!=y)&&(y=O),K>=0?(k=(e.min.z-ie.z)*K,N=(e.max.z-ie.z)*K):(k=(e.max.z-ie.z)*K,N=(e.min.z-ie.z)*K),_>N||k>y?null:((k>_||_!=_)&&(_=k),(N<y||y!=y)&&(y=N),y<0?null:this.at(_>=0?_:y,l)))}intersectsBox(e){return this.intersectBox(e,jn)!==null}intersectTriangle(e,l,_,y,S){Ur.subVectors(l,e),Br.subVectors(_,e),sa.crossVectors(Ur,Br);let O,k=this.direction.dot(sa);if(k>0){if(y)return null;O=1}else{if(!(k<0))return null;O=-1,k=-k}Rr.subVectors(this.origin,e);const N=O*this.direction.dot(Br.crossVectors(Rr,Br));if(N<0)return null;const G=O*this.direction.dot(Ur.cross(Rr));if(G<0||N+G>k)return null;const $=-O*Rr.dot(sa);return $<0?null:this.at($/k,S)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class tr{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,l,_,y,S,O,k,N,G,$,K,ie,ne,ue,ye,Se){const _e=this.elements;return _e[0]=e,_e[4]=l,_e[8]=_,_e[12]=y,_e[1]=S,_e[5]=O,_e[9]=k,_e[13]=N,_e[2]=G,_e[6]=$,_e[10]=K,_e[14]=ie,_e[3]=ne,_e[7]=ue,_e[11]=ye,_e[15]=Se,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new tr().fromArray(this.elements)}copy(e){const l=this.elements,_=e.elements;return l[0]=_[0],l[1]=_[1],l[2]=_[2],l[3]=_[3],l[4]=_[4],l[5]=_[5],l[6]=_[6],l[7]=_[7],l[8]=_[8],l[9]=_[9],l[10]=_[10],l[11]=_[11],l[12]=_[12],l[13]=_[13],l[14]=_[14],l[15]=_[15],this}copyPosition(e){const l=this.elements,_=e.elements;return l[12]=_[12],l[13]=_[13],l[14]=_[14],this}setFromMatrix3(e){const l=e.elements;return this.set(l[0],l[3],l[6],0,l[1],l[4],l[7],0,l[2],l[5],l[8],0,0,0,0,1),this}extractBasis(e,l,_){return e.setFromMatrixColumn(this,0),l.setFromMatrixColumn(this,1),_.setFromMatrixColumn(this,2),this}makeBasis(e,l,_){return this.set(e.x,l.x,_.x,0,e.y,l.y,_.y,0,e.z,l.z,_.z,0,0,0,0,1),this}extractRotation(e){const l=this.elements,_=e.elements,y=1/Rs.setFromMatrixColumn(e,0).length(),S=1/Rs.setFromMatrixColumn(e,1).length(),O=1/Rs.setFromMatrixColumn(e,2).length();return l[0]=_[0]*y,l[1]=_[1]*y,l[2]=_[2]*y,l[3]=0,l[4]=_[4]*S,l[5]=_[5]*S,l[6]=_[6]*S,l[7]=0,l[8]=_[8]*O,l[9]=_[9]*O,l[10]=_[10]*O,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const l=this.elements,_=e.x,y=e.y,S=e.z,O=Math.cos(_),k=Math.sin(_),N=Math.cos(y),G=Math.sin(y),$=Math.cos(S),K=Math.sin(S);if(e.order==="XYZ"){const ie=O*$,ne=O*K,ue=k*$,ye=k*K;l[0]=N*$,l[4]=-N*K,l[8]=G,l[1]=ne+ue*G,l[5]=ie-ye*G,l[9]=-k*N,l[2]=ye-ie*G,l[6]=ue+ne*G,l[10]=O*N}else if(e.order==="YXZ"){const ie=N*$,ne=N*K,ue=G*$,ye=G*K;l[0]=ie+ye*k,l[4]=ue*k-ne,l[8]=O*G,l[1]=O*K,l[5]=O*$,l[9]=-k,l[2]=ne*k-ue,l[6]=ye+ie*k,l[10]=O*N}else if(e.order==="ZXY"){const ie=N*$,ne=N*K,ue=G*$,ye=G*K;l[0]=ie-ye*k,l[4]=-O*K,l[8]=ue+ne*k,l[1]=ne+ue*k,l[5]=O*$,l[9]=ye-ie*k,l[2]=-O*G,l[6]=k,l[10]=O*N}else if(e.order==="ZYX"){const ie=O*$,ne=O*K,ue=k*$,ye=k*K;l[0]=N*$,l[4]=ue*G-ne,l[8]=ie*G+ye,l[1]=N*K,l[5]=ye*G+ie,l[9]=ne*G-ue,l[2]=-G,l[6]=k*N,l[10]=O*N}else if(e.order==="YZX"){const ie=O*N,ne=O*G,ue=k*N,ye=k*G;l[0]=N*$,l[4]=ye-ie*K,l[8]=ue*K+ne,l[1]=K,l[5]=O*$,l[9]=-k*$,l[2]=-G*$,l[6]=ne*K+ue,l[10]=ie-ye*K}else if(e.order==="XZY"){const ie=O*N,ne=O*G,ue=k*N,ye=k*G;l[0]=N*$,l[4]=-K,l[8]=G*$,l[1]=ie*K+ye,l[5]=O*$,l[9]=ne*K-ue,l[2]=ue*K-ne,l[6]=k*$,l[10]=ye*K+ie}return l[3]=0,l[7]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Da,e,_s)}lookAt(e,l,_){const y=this.elements;return Vs.subVectors(e,l),Vs.lengthSq()===0&&(Vs.z=1),Vs.normalize(),qo.crossVectors(_,Vs),qo.lengthSq()===0&&(Math.abs(_.z)===1?Vs.x+=1e-4:Vs.z+=1e-4,Vs.normalize(),qo.crossVectors(_,Vs)),qo.normalize(),dl.crossVectors(Vs,qo),y[0]=qo.x,y[4]=dl.x,y[8]=Vs.x,y[1]=qo.y,y[5]=dl.y,y[9]=Vs.y,y[2]=qo.z,y[6]=dl.z,y[10]=Vs.z,this}multiply(e,l){return l!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,l)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,l){const _=e.elements,y=l.elements,S=this.elements,O=_[0],k=_[4],N=_[8],G=_[12],$=_[1],K=_[5],ie=_[9],ne=_[13],ue=_[2],ye=_[6],Se=_[10],_e=_[14],$e=_[3],st=_[7],ot=_[11],Lt=_[15],Bt=y[0],di=y[4],Ti=y[8],Ki=y[12],Bi=y[1],Zi=y[5],hr=y[9],Gn=y[13],gn=y[2],Yn=y[6],Mr=y[10],Cr=y[14],kr=y[3],Zr=y[7],la=y[11],Kn=y[15];return S[0]=O*Bt+k*Bi+N*gn+G*kr,S[4]=O*di+k*Zi+N*Yn+G*Zr,S[8]=O*Ti+k*hr+N*Mr+G*la,S[12]=O*Ki+k*Gn+N*Cr+G*Kn,S[1]=$*Bt+K*Bi+ie*gn+ne*kr,S[5]=$*di+K*Zi+ie*Yn+ne*Zr,S[9]=$*Ti+K*hr+ie*Mr+ne*la,S[13]=$*Ki+K*Gn+ie*Cr+ne*Kn,S[2]=ue*Bt+ye*Bi+Se*gn+_e*kr,S[6]=ue*di+ye*Zi+Se*Yn+_e*Zr,S[10]=ue*Ti+ye*hr+Se*Mr+_e*la,S[14]=ue*Ki+ye*Gn+Se*Cr+_e*Kn,S[3]=$e*Bt+st*Bi+ot*gn+Lt*kr,S[7]=$e*di+st*Zi+ot*Yn+Lt*Zr,S[11]=$e*Ti+st*hr+ot*Mr+Lt*la,S[15]=$e*Ki+st*Gn+ot*Cr+Lt*Kn,this}multiplyScalar(e){const l=this.elements;return l[0]*=e,l[4]*=e,l[8]*=e,l[12]*=e,l[1]*=e,l[5]*=e,l[9]*=e,l[13]*=e,l[2]*=e,l[6]*=e,l[10]*=e,l[14]*=e,l[3]*=e,l[7]*=e,l[11]*=e,l[15]*=e,this}determinant(){const e=this.elements,l=e[0],_=e[4],y=e[8],S=e[12],O=e[1],k=e[5],N=e[9],G=e[13],$=e[2],K=e[6],ie=e[10],ne=e[14];return e[3]*(+S*N*K-y*G*K-S*k*ie+_*G*ie+y*k*ne-_*N*ne)+e[7]*(+l*N*ne-l*G*ie+S*O*ie-y*O*ne+y*G*$-S*N*$)+e[11]*(+l*G*K-l*k*ne-S*O*K+_*O*ne+S*k*$-_*G*$)+e[15]*(-y*k*$-l*N*K+l*k*ie+y*O*K-_*O*ie+_*N*$)}transpose(){const e=this.elements;let l;return l=e[1],e[1]=e[4],e[4]=l,l=e[2],e[2]=e[8],e[8]=l,l=e[6],e[6]=e[9],e[9]=l,l=e[3],e[3]=e[12],e[12]=l,l=e[7],e[7]=e[13],e[13]=l,l=e[11],e[11]=e[14],e[14]=l,this}setPosition(e,l,_){const y=this.elements;return e.isVector3?(y[12]=e.x,y[13]=e.y,y[14]=e.z):(y[12]=e,y[13]=l,y[14]=_),this}invert(){const e=this.elements,l=e[0],_=e[1],y=e[2],S=e[3],O=e[4],k=e[5],N=e[6],G=e[7],$=e[8],K=e[9],ie=e[10],ne=e[11],ue=e[12],ye=e[13],Se=e[14],_e=e[15],$e=K*Se*G-ye*ie*G+ye*N*ne-k*Se*ne-K*N*_e+k*ie*_e,st=ue*ie*G-$*Se*G-ue*N*ne+O*Se*ne+$*N*_e-O*ie*_e,ot=$*ye*G-ue*K*G+ue*k*ne-O*ye*ne-$*k*_e+O*K*_e,Lt=ue*K*N-$*ye*N-ue*k*ie+O*ye*ie+$*k*Se-O*K*Se,Bt=l*$e+_*st+y*ot+S*Lt;if(Bt===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const di=1/Bt;return e[0]=$e*di,e[1]=(ye*ie*S-K*Se*S-ye*y*ne+_*Se*ne+K*y*_e-_*ie*_e)*di,e[2]=(k*Se*S-ye*N*S+ye*y*G-_*Se*G-k*y*_e+_*N*_e)*di,e[3]=(K*N*S-k*ie*S-K*y*G+_*ie*G+k*y*ne-_*N*ne)*di,e[4]=st*di,e[5]=($*Se*S-ue*ie*S+ue*y*ne-l*Se*ne-$*y*_e+l*ie*_e)*di,e[6]=(ue*N*S-O*Se*S-ue*y*G+l*Se*G+O*y*_e-l*N*_e)*di,e[7]=(O*ie*S-$*N*S+$*y*G-l*ie*G-O*y*ne+l*N*ne)*di,e[8]=ot*di,e[9]=(ue*K*S-$*ye*S-ue*_*ne+l*ye*ne+$*_*_e-l*K*_e)*di,e[10]=(O*ye*S-ue*k*S+ue*_*G-l*ye*G-O*_*_e+l*k*_e)*di,e[11]=($*k*S-O*K*S-$*_*G+l*K*G+O*_*ne-l*k*ne)*di,e[12]=Lt*di,e[13]=($*ye*y-ue*K*y+ue*_*ie-l*ye*ie-$*_*Se+l*K*Se)*di,e[14]=(ue*k*y-O*ye*y-ue*_*N+l*ye*N+O*_*Se-l*k*Se)*di,e[15]=(O*K*y-$*k*y+$*_*N-l*K*N-O*_*ie+l*k*ie)*di,this}scale(e){const l=this.elements,_=e.x,y=e.y,S=e.z;return l[0]*=_,l[4]*=y,l[8]*=S,l[1]*=_,l[5]*=y,l[9]*=S,l[2]*=_,l[6]*=y,l[10]*=S,l[3]*=_,l[7]*=y,l[11]*=S,this}getMaxScaleOnAxis(){const e=this.elements,l=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],_=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],y=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(l,_,y))}makeTranslation(e,l,_){return this.set(1,0,0,e,0,1,0,l,0,0,1,_,0,0,0,1),this}makeRotationX(e){const l=Math.cos(e),_=Math.sin(e);return this.set(1,0,0,0,0,l,-_,0,0,_,l,0,0,0,0,1),this}makeRotationY(e){const l=Math.cos(e),_=Math.sin(e);return this.set(l,0,_,0,0,1,0,0,-_,0,l,0,0,0,0,1),this}makeRotationZ(e){const l=Math.cos(e),_=Math.sin(e);return this.set(l,-_,0,0,_,l,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,l){const _=Math.cos(l),y=Math.sin(l),S=1-_,O=e.x,k=e.y,N=e.z,G=S*O,$=S*k;return this.set(G*O+_,G*k-y*N,G*N+y*k,0,G*k+y*N,$*k+_,$*N-y*O,0,G*N-y*k,$*N+y*O,S*N*N+_,0,0,0,0,1),this}makeScale(e,l,_){return this.set(e,0,0,0,0,l,0,0,0,0,_,0,0,0,0,1),this}makeShear(e,l,_,y,S,O){return this.set(1,_,S,0,e,1,O,0,l,y,1,0,0,0,0,1),this}compose(e,l,_){const y=this.elements,S=l._x,O=l._y,k=l._z,N=l._w,G=S+S,$=O+O,K=k+k,ie=S*G,ne=S*$,ue=S*K,ye=O*$,Se=O*K,_e=k*K,$e=N*G,st=N*$,ot=N*K,Lt=_.x,Bt=_.y,di=_.z;return y[0]=(1-(ye+_e))*Lt,y[1]=(ne+ot)*Lt,y[2]=(ue-st)*Lt,y[3]=0,y[4]=(ne-ot)*Bt,y[5]=(1-(ie+_e))*Bt,y[6]=(Se+$e)*Bt,y[7]=0,y[8]=(ue+st)*di,y[9]=(Se-$e)*di,y[10]=(1-(ie+ye))*di,y[11]=0,y[12]=e.x,y[13]=e.y,y[14]=e.z,y[15]=1,this}decompose(e,l,_){const y=this.elements;let S=Rs.set(y[0],y[1],y[2]).length();const O=Rs.set(y[4],y[5],y[6]).length(),k=Rs.set(y[8],y[9],y[10]).length();this.determinant()<0&&(S=-S),e.x=y[12],e.y=y[13],e.z=y[14],Ia.copy(this);const N=1/S,G=1/O,$=1/k;return Ia.elements[0]*=N,Ia.elements[1]*=N,Ia.elements[2]*=N,Ia.elements[4]*=G,Ia.elements[5]*=G,Ia.elements[6]*=G,Ia.elements[8]*=$,Ia.elements[9]*=$,Ia.elements[10]*=$,l.setFromRotationMatrix(Ia),_.x=S,_.y=O,_.z=k,this}makePerspective(e,l,_,y,S,O){O===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const k=this.elements,N=2*S/(l-e),G=2*S/(_-y),$=(l+e)/(l-e),K=(_+y)/(_-y),ie=-(O+S)/(O-S),ne=-2*O*S/(O-S);return k[0]=N,k[4]=0,k[8]=$,k[12]=0,k[1]=0,k[5]=G,k[9]=K,k[13]=0,k[2]=0,k[6]=0,k[10]=ie,k[14]=ne,k[3]=0,k[7]=0,k[11]=-1,k[15]=0,this}makeOrthographic(e,l,_,y,S,O){const k=this.elements,N=1/(l-e),G=1/(_-y),$=1/(O-S),K=(l+e)*N,ie=(_+y)*G,ne=(O+S)*$;return k[0]=2*N,k[4]=0,k[8]=0,k[12]=-K,k[1]=0,k[5]=2*G,k[9]=0,k[13]=-ie,k[2]=0,k[6]=0,k[10]=-2*$,k[14]=-ne,k[3]=0,k[7]=0,k[11]=0,k[15]=1,this}equals(e){const l=this.elements,_=e.elements;for(let y=0;y<16;y++)if(l[y]!==_[y])return!1;return!0}fromArray(e,l=0){for(let _=0;_<16;_++)this.elements[_]=e[_+l];return this}toArray(e=[],l=0){const _=this.elements;return e[l]=_[0],e[l+1]=_[1],e[l+2]=_[2],e[l+3]=_[3],e[l+4]=_[4],e[l+5]=_[5],e[l+6]=_[6],e[l+7]=_[7],e[l+8]=_[8],e[l+9]=_[9],e[l+10]=_[10],e[l+11]=_[11],e[l+12]=_[12],e[l+13]=_[13],e[l+14]=_[14],e[l+15]=_[15],e}}tr.prototype.isMatrix4=!0;const Rs=new ht,Ia=new tr,Da=new ht(0,0,0),_s=new ht(1,1,1),qo=new ht,dl=new ht,Vs=new ht,Au=new tr,Bc=new Ls;class Ql{constructor(e=0,l=0,_=0,y=Ql.DefaultOrder){this._x=e,this._y=l,this._z=_,this._order=y}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,l,_,y=this._order){return this._x=e,this._y=l,this._z=_,this._order=y,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,l=this._order,_=!0){const y=e.elements,S=y[0],O=y[4],k=y[8],N=y[1],G=y[5],$=y[9],K=y[2],ie=y[6],ne=y[10];switch(l){case"XYZ":this._y=Math.asin(Er(k,-1,1)),Math.abs(k)<.9999999?(this._x=Math.atan2(-$,ne),this._z=Math.atan2(-O,S)):(this._x=Math.atan2(ie,G),this._z=0);break;case"YXZ":this._x=Math.asin(-Er($,-1,1)),Math.abs($)<.9999999?(this._y=Math.atan2(k,ne),this._z=Math.atan2(N,G)):(this._y=Math.atan2(-K,S),this._z=0);break;case"ZXY":this._x=Math.asin(Er(ie,-1,1)),Math.abs(ie)<.9999999?(this._y=Math.atan2(-K,ne),this._z=Math.atan2(-O,G)):(this._y=0,this._z=Math.atan2(N,S));break;case"ZYX":this._y=Math.asin(-Er(K,-1,1)),Math.abs(K)<.9999999?(this._x=Math.atan2(ie,ne),this._z=Math.atan2(N,S)):(this._x=0,this._z=Math.atan2(-O,G));break;case"YZX":this._z=Math.asin(Er(N,-1,1)),Math.abs(N)<.9999999?(this._x=Math.atan2(-$,G),this._y=Math.atan2(-K,S)):(this._x=0,this._y=Math.atan2(k,ne));break;case"XZY":this._z=Math.asin(-Er(O,-1,1)),Math.abs(O)<.9999999?(this._x=Math.atan2(ie,G),this._y=Math.atan2(k,S)):(this._x=Math.atan2(-$,ne),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+l)}return this._order=l,_===!0&&this._onChangeCallback(),this}setFromQuaternion(e,l,_){return Au.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Au,l,_)}setFromVector3(e,l=this._order){return this.set(e.x,e.y,e.z,l)}reorder(e){return Bc.setFromEuler(this),this.setFromQuaternion(Bc,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],l=0){return e[l]=this._x,e[l+1]=this._y,e[l+2]=this._z,e[l+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new ht(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Ql.prototype.isEuler=!0,Ql.DefaultOrder="XYZ",Ql.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class fo{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!=0}}let ka=0;const Do=new ht,xo=new Ls,Me=new tr,be=new ht,Fe=new ht,yt=new ht,ki=new Ls,Yi=new ht(1,0,0),wi=new ht(0,1,0),hn=new ht(0,0,1),xe={type:"added"},he={type:"removed"};class we extends ii{constructor(){super(),Object.defineProperty(this,"id",{value:ka++}),this.uuid=Sr(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=we.DefaultUp.clone();const e=new ht,l=new Ql,_=new Ls,y=new ht(1,1,1);l._onChange(function(){_.setFromEuler(l,!1)}),_._onChange(function(){l.setFromQuaternion(_,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:l},quaternion:{configurable:!0,enumerable:!0,value:_},scale:{configurable:!0,enumerable:!0,value:y},modelViewMatrix:{value:new tr},normalMatrix:{value:new Xn}}),this.matrix=new tr,this.matrixWorld=new tr,this.matrixAutoUpdate=we.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new fo,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,l){this.quaternion.setFromAxisAngle(e,l)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,l){return xo.setFromAxisAngle(e,l),this.quaternion.multiply(xo),this}rotateOnWorldAxis(e,l){return xo.setFromAxisAngle(e,l),this.quaternion.premultiply(xo),this}rotateX(e){return this.rotateOnAxis(Yi,e)}rotateY(e){return this.rotateOnAxis(wi,e)}rotateZ(e){return this.rotateOnAxis(hn,e)}translateOnAxis(e,l){return Do.copy(e).applyQuaternion(this.quaternion),this.position.add(Do.multiplyScalar(l)),this}translateX(e){return this.translateOnAxis(Yi,e)}translateY(e){return this.translateOnAxis(wi,e)}translateZ(e){return this.translateOnAxis(hn,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Me.copy(this.matrixWorld).invert())}lookAt(e,l,_){e.isVector3?be.copy(e):be.set(e,l,_);const y=this.parent;this.updateWorldMatrix(!0,!1),Fe.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Me.lookAt(Fe,be,this.up):Me.lookAt(be,Fe,this.up),this.quaternion.setFromRotationMatrix(Me),y&&(Me.extractRotation(y.matrixWorld),xo.setFromRotationMatrix(Me),this.quaternion.premultiply(xo.invert()))}add(e){if(arguments.length>1){for(let l=0;l<arguments.length;l++)this.add(arguments[l]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(xe)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let _=0;_<arguments.length;_++)this.remove(arguments[_]);return this}const l=this.children.indexOf(e);return l!==-1&&(e.parent=null,this.children.splice(l,1),e.dispatchEvent(he)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const l=this.children[e];l.parent=null,l.dispatchEvent(he)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Me.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Me.multiply(e.parent.matrixWorld)),e.applyMatrix4(Me),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,l){if(this[e]===l)return this;for(let _=0,y=this.children.length;_<y;_++){const S=this.children[_].getObjectByProperty(e,l);if(S!==void 0)return S}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Fe,e,yt),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Fe,ki,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const l=this.matrixWorld.elements;return e.set(l[8],l[9],l[10]).normalize()}raycast(){}traverse(e){e(this);const l=this.children;for(let _=0,y=l.length;_<y;_++)l[_].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const l=this.children;for(let _=0,y=l.length;_<y;_++)l[_].traverseVisible(e)}traverseAncestors(e){const l=this.parent;l!==null&&(e(l),l.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const l=this.children;for(let _=0,y=l.length;_<y;_++)l[_].updateMatrixWorld(e)}updateWorldMatrix(e,l){const _=this.parent;if(e===!0&&_!==null&&_.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),l===!0){const y=this.children;for(let S=0,O=y.length;S<O;S++)y[S].updateWorldMatrix(!1,!0)}}toJSON(e){const l=e===void 0||typeof e=="string",_={};l&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},_.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const y={};function S(k,N){return k[N.uuid]===void 0&&(k[N.uuid]=N.toJSON(e)),N.uuid}if(y.uuid=this.uuid,y.type=this.type,this.name!==""&&(y.name=this.name),this.castShadow===!0&&(y.castShadow=!0),this.receiveShadow===!0&&(y.receiveShadow=!0),this.visible===!1&&(y.visible=!1),this.frustumCulled===!1&&(y.frustumCulled=!1),this.renderOrder!==0&&(y.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(y.userData=this.userData),y.layers=this.layers.mask,y.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(y.matrixAutoUpdate=!1),this.isInstancedMesh&&(y.type="InstancedMesh",y.count=this.count,y.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(y.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?y.background=this.background.toJSON():this.background.isTexture&&(y.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(y.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){y.geometry=S(e.geometries,this.geometry);const k=this.geometry.parameters;if(k!==void 0&&k.shapes!==void 0){const N=k.shapes;if(Array.isArray(N))for(let G=0,$=N.length;G<$;G++){const K=N[G];S(e.shapes,K)}else S(e.shapes,N)}}if(this.isSkinnedMesh&&(y.bindMode=this.bindMode,y.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(S(e.skeletons,this.skeleton),y.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const k=[];for(let N=0,G=this.material.length;N<G;N++)k.push(S(e.materials,this.material[N]));y.material=k}else y.material=S(e.materials,this.material);if(this.children.length>0){y.children=[];for(let k=0;k<this.children.length;k++)y.children.push(this.children[k].toJSON(e).object)}if(this.animations.length>0){y.animations=[];for(let k=0;k<this.animations.length;k++){const N=this.animations[k];y.animations.push(S(e.animations,N))}}if(l){const k=O(e.geometries),N=O(e.materials),G=O(e.textures),$=O(e.images),K=O(e.shapes),ie=O(e.skeletons),ne=O(e.animations);k.length>0&&(_.geometries=k),N.length>0&&(_.materials=N),G.length>0&&(_.textures=G),$.length>0&&(_.images=$),K.length>0&&(_.shapes=K),ie.length>0&&(_.skeletons=ie),ne.length>0&&(_.animations=ne)}return _.object=y,_;function O(k){const N=[];for(const G in k){const $=k[G];delete $.metadata,N.push($)}return N}}clone(e){return new this.constructor().copy(this,e)}copy(e,l=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),l===!0)for(let _=0;_<e.children.length;_++){const y=e.children[_];this.add(y.clone())}return this}}we.DefaultUp=new ht(0,1,0),we.DefaultMatrixAutoUpdate=!0,we.prototype.isObject3D=!0;const Ve=new ht,Ee=new ht,ri=new ht,Ei=new ht,sn=new ht,Di=new ht,Jn=new ht,on=new ht,Ft=new ht,yn=new ht;class Si{constructor(e=new ht,l=new ht,_=new ht){this.a=e,this.b=l,this.c=_}static getNormal(e,l,_,y){y.subVectors(_,l),Ve.subVectors(e,l),y.cross(Ve);const S=y.lengthSq();return S>0?y.multiplyScalar(1/Math.sqrt(S)):y.set(0,0,0)}static getBarycoord(e,l,_,y,S){Ve.subVectors(y,l),Ee.subVectors(_,l),ri.subVectors(e,l);const O=Ve.dot(Ve),k=Ve.dot(Ee),N=Ve.dot(ri),G=Ee.dot(Ee),$=Ee.dot(ri),K=O*G-k*k;if(K===0)return S.set(-2,-1,-1);const ie=1/K,ne=(G*N-k*$)*ie,ue=(O*$-k*N)*ie;return S.set(1-ne-ue,ue,ne)}static containsPoint(e,l,_,y){return this.getBarycoord(e,l,_,y,Ei),Ei.x>=0&&Ei.y>=0&&Ei.x+Ei.y<=1}static getUV(e,l,_,y,S,O,k,N){return this.getBarycoord(e,l,_,y,Ei),N.set(0,0),N.addScaledVector(S,Ei.x),N.addScaledVector(O,Ei.y),N.addScaledVector(k,Ei.z),N}static isFrontFacing(e,l,_,y){return Ve.subVectors(_,l),Ee.subVectors(e,l),Ve.cross(Ee).dot(y)<0}set(e,l,_){return this.a.copy(e),this.b.copy(l),this.c.copy(_),this}setFromPointsAndIndices(e,l,_,y){return this.a.copy(e[l]),this.b.copy(e[_]),this.c.copy(e[y]),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ve.subVectors(this.c,this.b),Ee.subVectors(this.a,this.b),.5*Ve.cross(Ee).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Si.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,l){return Si.getBarycoord(e,this.a,this.b,this.c,l)}getUV(e,l,_,y,S){return Si.getUV(e,this.a,this.b,this.c,l,_,y,S)}containsPoint(e){return Si.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Si.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,l){const _=this.a,y=this.b,S=this.c;let O,k;sn.subVectors(y,_),Di.subVectors(S,_),on.subVectors(e,_);const N=sn.dot(on),G=Di.dot(on);if(N<=0&&G<=0)return l.copy(_);Ft.subVectors(e,y);const $=sn.dot(Ft),K=Di.dot(Ft);if($>=0&&K<=$)return l.copy(y);const ie=N*K-$*G;if(ie<=0&&N>=0&&$<=0)return O=N/(N-$),l.copy(_).addScaledVector(sn,O);yn.subVectors(e,S);const ne=sn.dot(yn),ue=Di.dot(yn);if(ue>=0&&ne<=ue)return l.copy(S);const ye=ne*G-N*ue;if(ye<=0&&G>=0&&ue<=0)return k=G/(G-ue),l.copy(_).addScaledVector(Di,k);const Se=$*ue-ne*K;if(Se<=0&&K-$>=0&&ne-ue>=0)return Jn.subVectors(S,y),k=(K-$)/(K-$+(ne-ue)),l.copy(y).addScaledVector(Jn,k);const _e=1/(Se+ye+ie);return O=ye*_e,k=ie*_e,l.copy(_).addScaledVector(sn,O).addScaledVector(Di,k)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let qn=0;class rn extends ii{constructor(){super(),Object.defineProperty(this,"id",{value:qn++}),this.uuid=Sr(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.format=1023,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const l in e){const _=e[l];if(_===void 0){console.warn("THREE.Material: '"+l+"' parameter is undefined.");continue}if(l==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=_===1;continue}const y=this[l];y!==void 0?y&&y.isColor?y.set(_):y&&y.isVector3&&_&&_.isVector3?y.copy(_):this[l]=_:console.warn("THREE."+this.type+": '"+l+"' is not a property of this material.")}}toJSON(e){const l=e===void 0||typeof e=="string";l&&(e={textures:{},images:{}});const _={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function y(S){const O=[];for(const k in S){const N=S[k];delete N.metadata,O.push(N)}return O}if(_.uuid=this.uuid,_.type=this.type,this.name!==""&&(_.name=this.name),this.color&&this.color.isColor&&(_.color=this.color.getHex()),this.roughness!==void 0&&(_.roughness=this.roughness),this.metalness!==void 0&&(_.metalness=this.metalness),this.sheenTint&&this.sheenTint.isColor&&(_.sheenTint=this.sheenTint.getHex()),this.emissive&&this.emissive.isColor&&(_.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(_.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(_.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(_.specularIntensity=this.specularIntensity),this.specularTint&&this.specularTint.isColor&&(_.specularTint=this.specularTint.getHex()),this.shininess!==void 0&&(_.shininess=this.shininess),this.clearcoat!==void 0&&(_.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(_.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(_.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(_.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(_.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,_.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(_.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(_.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(_.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(_.lightMap=this.lightMap.toJSON(e).uuid,_.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(_.aoMap=this.aoMap.toJSON(e).uuid,_.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(_.bumpMap=this.bumpMap.toJSON(e).uuid,_.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(_.normalMap=this.normalMap.toJSON(e).uuid,_.normalMapType=this.normalMapType,_.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(_.displacementMap=this.displacementMap.toJSON(e).uuid,_.displacementScale=this.displacementScale,_.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(_.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(_.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(_.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(_.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(_.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularTintMap&&this.specularTintMap.isTexture&&(_.specularTintMap=this.specularTintMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(_.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(_.combine=this.combine)),this.envMapIntensity!==void 0&&(_.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(_.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(_.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(_.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(_.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(_.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(_.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(_.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(_.attenuationDistance=this.attenuationDistance),this.attenuationTint!==void 0&&(_.attenuationTint=this.attenuationTint.getHex()),this.size!==void 0&&(_.size=this.size),this.shadowSide!==null&&(_.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(_.sizeAttenuation=this.sizeAttenuation),this.blending!==1&&(_.blending=this.blending),this.side!==0&&(_.side=this.side),this.vertexColors&&(_.vertexColors=!0),this.opacity<1&&(_.opacity=this.opacity),this.format!==1023&&(_.format=this.format),this.transparent===!0&&(_.transparent=this.transparent),_.depthFunc=this.depthFunc,_.depthTest=this.depthTest,_.depthWrite=this.depthWrite,_.colorWrite=this.colorWrite,_.stencilWrite=this.stencilWrite,_.stencilWriteMask=this.stencilWriteMask,_.stencilFunc=this.stencilFunc,_.stencilRef=this.stencilRef,_.stencilFuncMask=this.stencilFuncMask,_.stencilFail=this.stencilFail,_.stencilZFail=this.stencilZFail,_.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(_.rotation=this.rotation),this.polygonOffset===!0&&(_.polygonOffset=!0),this.polygonOffsetFactor!==0&&(_.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(_.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(_.linewidth=this.linewidth),this.dashSize!==void 0&&(_.dashSize=this.dashSize),this.gapSize!==void 0&&(_.gapSize=this.gapSize),this.scale!==void 0&&(_.scale=this.scale),this.dithering===!0&&(_.dithering=!0),this.alphaTest>0&&(_.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(_.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(_.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(_.wireframe=this.wireframe),this.wireframeLinewidth>1&&(_.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(_.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(_.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(_.flatShading=this.flatShading),this.visible===!1&&(_.visible=!1),this.toneMapped===!1&&(_.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(_.userData=this.userData),l){const S=y(e.textures),O=y(e.images);S.length>0&&(_.textures=S),O.length>0&&(_.images=O)}return _}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const l=e.clippingPlanes;let _=null;if(l!==null){const y=l.length;_=new Array(y);for(let S=0;S!==y;++S)_[S]=l[S].clone()}return this.clippingPlanes=_,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}rn.prototype.isMaterial=!0;const Cn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ar={h:0,s:0,l:0},Ir={h:0,s:0,l:0};function Gr(E,e,l){return l<0&&(l+=1),l>1&&(l-=1),l<1/6?E+6*(e-E)*l:l<.5?e:l<2/3?E+6*(e-E)*(2/3-l):E}function Lr(E){return E<.04045?.0773993808*E:Math.pow(.9478672986*E+.0521327014,2.4)}function xr(E){return E<.0031308?12.92*E:1.055*Math.pow(E,.41666)-.055}class On{constructor(e,l,_){return l===void 0&&_===void 0?this.set(e):this.setRGB(e,l,_)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,l,_){return this.r=e,this.g=l,this.b=_,this}setHSL(e,l,_){if(e=mr(e,1),l=Er(l,0,1),_=Er(_,0,1),l===0)this.r=this.g=this.b=_;else{const y=_<=.5?_*(1+l):_+l-_*l,S=2*_-y;this.r=Gr(S,y,e+1/3),this.g=Gr(S,y,e),this.b=Gr(S,y,e-1/3)}return this}setStyle(e){function l(y){y!==void 0&&parseFloat(y)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let _;if(_=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let y;const S=_[1],O=_[2];switch(S){case"rgb":case"rgba":if(y=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(O))return this.r=Math.min(255,parseInt(y[1],10))/255,this.g=Math.min(255,parseInt(y[2],10))/255,this.b=Math.min(255,parseInt(y[3],10))/255,l(y[4]),this;if(y=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(O))return this.r=Math.min(100,parseInt(y[1],10))/100,this.g=Math.min(100,parseInt(y[2],10))/100,this.b=Math.min(100,parseInt(y[3],10))/100,l(y[4]),this;break;case"hsl":case"hsla":if(y=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(O)){const k=parseFloat(y[1])/360,N=parseInt(y[2],10)/100,G=parseInt(y[3],10)/100;return l(y[4]),this.setHSL(k,N,G)}}}else if(_=/^\#([A-Fa-f\d]+)$/.exec(e)){const y=_[1],S=y.length;if(S===3)return this.r=parseInt(y.charAt(0)+y.charAt(0),16)/255,this.g=parseInt(y.charAt(1)+y.charAt(1),16)/255,this.b=parseInt(y.charAt(2)+y.charAt(2),16)/255,this;if(S===6)return this.r=parseInt(y.charAt(0)+y.charAt(1),16)/255,this.g=parseInt(y.charAt(2)+y.charAt(3),16)/255,this.b=parseInt(y.charAt(4)+y.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const l=Cn[e.toLowerCase()];return l!==void 0?this.setHex(l):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,l=2){return this.r=Math.pow(e.r,l),this.g=Math.pow(e.g,l),this.b=Math.pow(e.b,l),this}copyLinearToGamma(e,l=2){const _=l>0?1/l:1;return this.r=Math.pow(e.r,_),this.g=Math.pow(e.g,_),this.b=Math.pow(e.b,_),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Lr(e.r),this.g=Lr(e.g),this.b=Lr(e.b),this}copyLinearToSRGB(e){return this.r=xr(e.r),this.g=xr(e.g),this.b=xr(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const l=this.r,_=this.g,y=this.b,S=Math.max(l,_,y),O=Math.min(l,_,y);let k,N;const G=(O+S)/2;if(O===S)k=0,N=0;else{const $=S-O;switch(N=G<=.5?$/(S+O):$/(2-S-O),S){case l:k=(_-y)/$+(_<y?6:0);break;case _:k=(y-l)/$+2;break;case y:k=(l-_)/$+4}k/=6}return e.h=k,e.s=N,e.l=G,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,l,_){return this.getHSL(Ar),Ar.h+=e,Ar.s+=l,Ar.l+=_,this.setHSL(Ar.h,Ar.s,Ar.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,l){return this.r=e.r+l.r,this.g=e.g+l.g,this.b=e.b+l.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,l){return this.r+=(e.r-this.r)*l,this.g+=(e.g-this.g)*l,this.b+=(e.b-this.b)*l,this}lerpColors(e,l,_){return this.r=e.r+(l.r-e.r)*_,this.g=e.g+(l.g-e.g)*_,this.b=e.b+(l.b-e.b)*_,this}lerpHSL(e,l){this.getHSL(Ar),e.getHSL(Ir);const _=Nr(Ar.h,Ir.h,l),y=Nr(Ar.s,Ir.s,l),S=Nr(Ar.l,Ir.l,l);return this.setHSL(_,y,S),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,l=0){return this.r=e[l],this.g=e[l+1],this.b=e[l+2],this}toArray(e=[],l=0){return e[l]=this.r,e[l+1]=this.g,e[l+2]=this.b,e}fromBufferAttribute(e,l){return this.r=e.getX(l),this.g=e.getY(l),this.b=e.getZ(l),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}On.NAMES=Cn,On.prototype.isColor=!0,On.prototype.r=1,On.prototype.g=1,On.prototype.b=1;class fa extends rn{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new On(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}fa.prototype.isMeshBasicMaterial=!0;const $r=new ht,Ms=new dn;class aa{constructor(e,l,_){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=l,this.count=e!==void 0?e.length/l:0,this.normalized=_===!0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,l,_){e*=this.itemSize,_*=l.itemSize;for(let y=0,S=this.itemSize;y<S;y++)this.array[e+y]=l.array[_+y];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const l=this.array;let _=0;for(let y=0,S=e.length;y<S;y++){let O=e[y];O===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",y),O=new On),l[_++]=O.r,l[_++]=O.g,l[_++]=O.b}return this}copyVector2sArray(e){const l=this.array;let _=0;for(let y=0,S=e.length;y<S;y++){let O=e[y];O===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",y),O=new dn),l[_++]=O.x,l[_++]=O.y}return this}copyVector3sArray(e){const l=this.array;let _=0;for(let y=0,S=e.length;y<S;y++){let O=e[y];O===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",y),O=new ht),l[_++]=O.x,l[_++]=O.y,l[_++]=O.z}return this}copyVector4sArray(e){const l=this.array;let _=0;for(let y=0,S=e.length;y<S;y++){let O=e[y];O===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",y),O=new qr),l[_++]=O.x,l[_++]=O.y,l[_++]=O.z,l[_++]=O.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let l=0,_=this.count;l<_;l++)Ms.fromBufferAttribute(this,l),Ms.applyMatrix3(e),this.setXY(l,Ms.x,Ms.y);else if(this.itemSize===3)for(let l=0,_=this.count;l<_;l++)$r.fromBufferAttribute(this,l),$r.applyMatrix3(e),this.setXYZ(l,$r.x,$r.y,$r.z);return this}applyMatrix4(e){for(let l=0,_=this.count;l<_;l++)$r.x=this.getX(l),$r.y=this.getY(l),$r.z=this.getZ(l),$r.applyMatrix4(e),this.setXYZ(l,$r.x,$r.y,$r.z);return this}applyNormalMatrix(e){for(let l=0,_=this.count;l<_;l++)$r.x=this.getX(l),$r.y=this.getY(l),$r.z=this.getZ(l),$r.applyNormalMatrix(e),this.setXYZ(l,$r.x,$r.y,$r.z);return this}transformDirection(e){for(let l=0,_=this.count;l<_;l++)$r.x=this.getX(l),$r.y=this.getY(l),$r.z=this.getZ(l),$r.transformDirection(e),this.setXYZ(l,$r.x,$r.y,$r.z);return this}set(e,l=0){return this.array.set(e,l),this}getX(e){return this.array[e*this.itemSize]}setX(e,l){return this.array[e*this.itemSize]=l,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,l){return this.array[e*this.itemSize+1]=l,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,l){return this.array[e*this.itemSize+2]=l,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,l){return this.array[e*this.itemSize+3]=l,this}setXY(e,l,_){return e*=this.itemSize,this.array[e+0]=l,this.array[e+1]=_,this}setXYZ(e,l,_,y){return e*=this.itemSize,this.array[e+0]=l,this.array[e+1]=_,this.array[e+2]=y,this}setXYZW(e,l,_,y,S){return e*=this.itemSize,this.array[e+0]=l,this.array[e+1]=_,this.array[e+2]=y,this.array[e+3]=S,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==35044&&(e.usage=this.usage),this.updateRange.offset===0&&this.updateRange.count===-1||(e.updateRange=this.updateRange),e}}aa.prototype.isBufferAttribute=!0;class Qs extends aa{constructor(e,l,_){super(new Int8Array(e),l,_)}}class ds extends aa{constructor(e,l,_){super(new Uint8Array(e),l,_)}}class Fs extends aa{constructor(e,l,_){super(new Uint8ClampedArray(e),l,_)}}class Ts extends aa{constructor(e,l,_){super(new Int16Array(e),l,_)}}class al extends aa{constructor(e,l,_){super(new Uint16Array(e),l,_)}}class Gs extends aa{constructor(e,l,_){super(new Int32Array(e),l,_)}}class _a extends aa{constructor(e,l,_){super(new Uint32Array(e),l,_)}}class Wo extends aa{constructor(e,l,_){super(new Uint16Array(e),l,_)}}Wo.prototype.isFloat16BufferAttribute=!0;class or extends aa{constructor(e,l,_){super(new Float32Array(e),l,_)}}class fs extends aa{constructor(e,l,_){super(new Float64Array(e),l,_)}}function Cu(E){if(E.length===0)return-1/0;let e=E[0];for(let l=1,_=E.length;l<_;++l)E[l]>e&&(e=E[l]);return e}const kl={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function fl(E,e){return new kl[E](e)}let Lu=0;const co=new tr,df=new we,Nl=new ht,Ml=new Js,Uh=new Js,ps=new ht;class oa extends ii{constructor(){super(),Object.defineProperty(this,"id",{value:Lu++}),this.uuid=Sr(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Cu(e)>65535?_a:al)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,l){return this.attributes[e]=l,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,l,_=0){this.groups.push({start:e,count:l,materialIndex:_})}clearGroups(){this.groups=[]}setDrawRange(e,l){this.drawRange.start=e,this.drawRange.count=l}applyMatrix4(e){const l=this.attributes.position;l!==void 0&&(l.applyMatrix4(e),l.needsUpdate=!0);const _=this.attributes.normal;if(_!==void 0){const S=new Xn().getNormalMatrix(e);_.applyNormalMatrix(S),_.needsUpdate=!0}const y=this.attributes.tangent;return y!==void 0&&(y.transformDirection(e),y.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return co.makeRotationFromQuaternion(e),this.applyMatrix4(co),this}rotateX(e){return co.makeRotationX(e),this.applyMatrix4(co),this}rotateY(e){return co.makeRotationY(e),this.applyMatrix4(co),this}rotateZ(e){return co.makeRotationZ(e),this.applyMatrix4(co),this}translate(e,l,_){return co.makeTranslation(e,l,_),this.applyMatrix4(co),this}scale(e,l,_){return co.makeScale(e,l,_),this.applyMatrix4(co),this}lookAt(e){return df.lookAt(e),df.updateMatrix(),this.applyMatrix4(df.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Nl).negate(),this.translate(Nl.x,Nl.y,Nl.z),this}setFromPoints(e){const l=[];for(let _=0,y=e.length;_<y;_++){const S=e[_];l.push(S.x,S.y,S.z||0)}return this.setAttribute("position",new or(l,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Js);const e=this.attributes.position,l=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new ht(-1/0,-1/0,-1/0),new ht(1/0,1/0,1/0));if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),l)for(let _=0,y=l.length;_<y;_++){const S=l[_];Ml.setFromBufferAttribute(S),this.morphTargetsRelative?(ps.addVectors(this.boundingBox.min,Ml.min),this.boundingBox.expandByPoint(ps),ps.addVectors(this.boundingBox.max,Ml.max),this.boundingBox.expandByPoint(ps)):(this.boundingBox.expandByPoint(Ml.min),this.boundingBox.expandByPoint(Ml.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new zn);const e=this.attributes.position,l=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new ht,1/0);if(e){const _=this.boundingSphere.center;if(Ml.setFromBufferAttribute(e),l)for(let S=0,O=l.length;S<O;S++){const k=l[S];Uh.setFromBufferAttribute(k),this.morphTargetsRelative?(ps.addVectors(Ml.min,Uh.min),Ml.expandByPoint(ps),ps.addVectors(Ml.max,Uh.max),Ml.expandByPoint(ps)):(Ml.expandByPoint(Uh.min),Ml.expandByPoint(Uh.max))}Ml.getCenter(_);let y=0;for(let S=0,O=e.count;S<O;S++)ps.fromBufferAttribute(e,S),y=Math.max(y,_.distanceToSquared(ps));if(l)for(let S=0,O=l.length;S<O;S++){const k=l[S],N=this.morphTargetsRelative;for(let G=0,$=k.count;G<$;G++)ps.fromBufferAttribute(k,G),N&&(Nl.fromBufferAttribute(e,G),ps.add(Nl)),y=Math.max(y,_.distanceToSquared(ps))}this.boundingSphere.radius=Math.sqrt(y),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,l=this.attributes;if(e===null||l.position===void 0||l.normal===void 0||l.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const _=e.array,y=l.position.array,S=l.normal.array,O=l.uv.array,k=y.length/3;l.tangent===void 0&&this.setAttribute("tangent",new aa(new Float32Array(4*k),4));const N=l.tangent.array,G=[],$=[];for(let Bi=0;Bi<k;Bi++)G[Bi]=new ht,$[Bi]=new ht;const K=new ht,ie=new ht,ne=new ht,ue=new dn,ye=new dn,Se=new dn,_e=new ht,$e=new ht;function st(Bi,Zi,hr){K.fromArray(y,3*Bi),ie.fromArray(y,3*Zi),ne.fromArray(y,3*hr),ue.fromArray(O,2*Bi),ye.fromArray(O,2*Zi),Se.fromArray(O,2*hr),ie.sub(K),ne.sub(K),ye.sub(ue),Se.sub(ue);const Gn=1/(ye.x*Se.y-Se.x*ye.y);isFinite(Gn)&&(_e.copy(ie).multiplyScalar(Se.y).addScaledVector(ne,-ye.y).multiplyScalar(Gn),$e.copy(ne).multiplyScalar(ye.x).addScaledVector(ie,-Se.x).multiplyScalar(Gn),G[Bi].add(_e),G[Zi].add(_e),G[hr].add(_e),$[Bi].add($e),$[Zi].add($e),$[hr].add($e))}let ot=this.groups;ot.length===0&&(ot=[{start:0,count:_.length}]);for(let Bi=0,Zi=ot.length;Bi<Zi;++Bi){const hr=ot[Bi],Gn=hr.start;for(let gn=Gn,Yn=Gn+hr.count;gn<Yn;gn+=3)st(_[gn+0],_[gn+1],_[gn+2])}const Lt=new ht,Bt=new ht,di=new ht,Ti=new ht;function Ki(Bi){di.fromArray(S,3*Bi),Ti.copy(di);const Zi=G[Bi];Lt.copy(Zi),Lt.sub(di.multiplyScalar(di.dot(Zi))).normalize(),Bt.crossVectors(Ti,Zi);const hr=Bt.dot($[Bi])<0?-1:1;N[4*Bi]=Lt.x,N[4*Bi+1]=Lt.y,N[4*Bi+2]=Lt.z,N[4*Bi+3]=hr}for(let Bi=0,Zi=ot.length;Bi<Zi;++Bi){const hr=ot[Bi],Gn=hr.start;for(let gn=Gn,Yn=Gn+hr.count;gn<Yn;gn+=3)Ki(_[gn+0]),Ki(_[gn+1]),Ki(_[gn+2])}}computeVertexNormals(){const e=this.index,l=this.getAttribute("position");if(l!==void 0){let _=this.getAttribute("normal");if(_===void 0)_=new aa(new Float32Array(3*l.count),3),this.setAttribute("normal",_);else for(let ie=0,ne=_.count;ie<ne;ie++)_.setXYZ(ie,0,0,0);const y=new ht,S=new ht,O=new ht,k=new ht,N=new ht,G=new ht,$=new ht,K=new ht;if(e)for(let ie=0,ne=e.count;ie<ne;ie+=3){const ue=e.getX(ie+0),ye=e.getX(ie+1),Se=e.getX(ie+2);y.fromBufferAttribute(l,ue),S.fromBufferAttribute(l,ye),O.fromBufferAttribute(l,Se),$.subVectors(O,S),K.subVectors(y,S),$.cross(K),k.fromBufferAttribute(_,ue),N.fromBufferAttribute(_,ye),G.fromBufferAttribute(_,Se),k.add($),N.add($),G.add($),_.setXYZ(ue,k.x,k.y,k.z),_.setXYZ(ye,N.x,N.y,N.z),_.setXYZ(Se,G.x,G.y,G.z)}else for(let ie=0,ne=l.count;ie<ne;ie+=3)y.fromBufferAttribute(l,ie+0),S.fromBufferAttribute(l,ie+1),O.fromBufferAttribute(l,ie+2),$.subVectors(O,S),K.subVectors(y,S),$.cross(K),_.setXYZ(ie+0,$.x,$.y,$.z),_.setXYZ(ie+1,$.x,$.y,$.z),_.setXYZ(ie+2,$.x,$.y,$.z);this.normalizeNormals(),_.needsUpdate=!0}}merge(e,l){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);l===void 0&&(l=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const _=this.attributes;for(const y in _){if(e.attributes[y]===void 0)continue;const S=_[y].array,O=e.attributes[y],k=O.array,N=O.itemSize*l,G=Math.min(k.length,S.length-N);for(let $=0,K=N;$<G;$++,K++)S[K]=k[$]}return this}normalizeNormals(){const e=this.attributes.normal;for(let l=0,_=e.count;l<_;l++)ps.fromBufferAttribute(e,l),ps.normalize(),e.setXYZ(l,ps.x,ps.y,ps.z)}toNonIndexed(){function e(k,N){const G=k.array,$=k.itemSize,K=k.normalized,ie=new G.constructor(N.length*$);let ne=0,ue=0;for(let ye=0,Se=N.length;ye<Se;ye++){ne=k.isInterleavedBufferAttribute?N[ye]*k.data.stride+k.offset:N[ye]*$;for(let _e=0;_e<$;_e++)ie[ue++]=G[ne++]}return new aa(ie,$,K)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const l=new oa,_=this.index.array,y=this.attributes;for(const k in y){const N=e(y[k],_);l.setAttribute(k,N)}const S=this.morphAttributes;for(const k in S){const N=[],G=S[k];for(let $=0,K=G.length;$<K;$++){const ie=e(G[$],_);N.push(ie)}l.morphAttributes[k]=N}l.morphTargetsRelative=this.morphTargetsRelative;const O=this.groups;for(let k=0,N=O.length;k<N;k++){const G=O[k];l.addGroup(G.start,G.count,G.materialIndex)}return l}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const N=this.parameters;for(const G in N)N[G]!==void 0&&(e[G]=N[G]);return e}e.data={attributes:{}};const l=this.index;l!==null&&(e.data.index={type:l.array.constructor.name,array:Array.prototype.slice.call(l.array)});const _=this.attributes;for(const N in _){const G=_[N];e.data.attributes[N]=G.toJSON(e.data)}const y={};let S=!1;for(const N in this.morphAttributes){const G=this.morphAttributes[N],$=[];for(let K=0,ie=G.length;K<ie;K++){const ne=G[K];$.push(ne.toJSON(e.data))}$.length>0&&(y[N]=$,S=!0)}S&&(e.data.morphAttributes=y,e.data.morphTargetsRelative=this.morphTargetsRelative);const O=this.groups;O.length>0&&(e.data.groups=JSON.parse(JSON.stringify(O)));const k=this.boundingSphere;return k!==null&&(e.data.boundingSphere={center:k.center.toArray(),radius:k.radius}),e}clone(){return new oa().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const l={};this.name=e.name;const _=e.index;_!==null&&this.setIndex(_.clone(l));const y=e.attributes;for(const G in y){const $=y[G];this.setAttribute(G,$.clone(l))}const S=e.morphAttributes;for(const G in S){const $=[],K=S[G];for(let ie=0,ne=K.length;ie<ne;ie++)$.push(K[ie].clone(l));this.morphAttributes[G]=$}this.morphTargetsRelative=e.morphTargetsRelative;const O=e.groups;for(let G=0,$=O.length;G<$;G++){const K=O[G];this.addGroup(K.start,K.count,K.materialIndex)}const k=e.boundingBox;k!==null&&(this.boundingBox=k.clone());const N=e.boundingSphere;return N!==null&&(this.boundingSphere=N.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}oa.prototype.isBufferGeometry=!0;const Rd=new tr,tu=new Wr,Vh=new zn,sh=new ht,oh=new ht,gc=new ht,Gh=new ht,dp=new ht,lh=new ht,Id=new ht,Ul=new ht,Tl=new ht,jf=new dn,Hh=new dn,ff=new dn,pf=new ht,mf=new ht;class eo extends we{constructor(e=new oa,l=new fa){super(),this.type="Mesh",this.geometry=e,this.material=l,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const l=e.morphAttributes,_=Object.keys(l);if(_.length>0){const y=l[_[0]];if(y!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let S=0,O=y.length;S<O;S++){const k=y[S].name||String(S);this.morphTargetInfluences.push(0),this.morphTargetDictionary[k]=S}}}}else{const l=e.morphTargets;l!==void 0&&l.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,l){const _=this.geometry,y=this.material,S=this.matrixWorld;if(y===void 0||(_.boundingSphere===null&&_.computeBoundingSphere(),Vh.copy(_.boundingSphere),Vh.applyMatrix4(S),e.ray.intersectsSphere(Vh)===!1)||(Rd.copy(S).invert(),tu.copy(e.ray).applyMatrix4(Rd),_.boundingBox!==null&&tu.intersectsBox(_.boundingBox)===!1))return;let O;if(_.isBufferGeometry){const k=_.index,N=_.attributes.position,G=_.morphAttributes.position,$=_.morphTargetsRelative,K=_.attributes.uv,ie=_.attributes.uv2,ne=_.groups,ue=_.drawRange;if(k!==null)if(Array.isArray(y))for(let ye=0,Se=ne.length;ye<Se;ye++){const _e=ne[ye],$e=y[_e.materialIndex];for(let st=Math.max(_e.start,ue.start),ot=Math.min(_e.start+_e.count,ue.start+ue.count);st<ot;st+=3){const Lt=k.getX(st),Bt=k.getX(st+1),di=k.getX(st+2);O=Sl(this,$e,e,tu,N,G,$,K,ie,Lt,Bt,di),O&&(O.faceIndex=Math.floor(st/3),O.face.materialIndex=_e.materialIndex,l.push(O))}}else for(let ye=Math.max(0,ue.start),Se=Math.min(k.count,ue.start+ue.count);ye<Se;ye+=3){const _e=k.getX(ye),$e=k.getX(ye+1),st=k.getX(ye+2);O=Sl(this,y,e,tu,N,G,$,K,ie,_e,$e,st),O&&(O.faceIndex=Math.floor(ye/3),l.push(O))}else if(N!==void 0)if(Array.isArray(y))for(let ye=0,Se=ne.length;ye<Se;ye++){const _e=ne[ye],$e=y[_e.materialIndex];for(let st=Math.max(_e.start,ue.start),ot=Math.min(_e.start+_e.count,ue.start+ue.count);st<ot;st+=3)O=Sl(this,$e,e,tu,N,G,$,K,ie,st,st+1,st+2),O&&(O.faceIndex=Math.floor(st/3),O.face.materialIndex=_e.materialIndex,l.push(O))}else for(let ye=Math.max(0,ue.start),Se=Math.min(N.count,ue.start+ue.count);ye<Se;ye+=3)O=Sl(this,y,e,tu,N,G,$,K,ie,ye,ye+1,ye+2),O&&(O.faceIndex=Math.floor(ye/3),l.push(O))}else _.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Sl(E,e,l,_,y,S,O,k,N,G,$,K){sh.fromBufferAttribute(y,G),oh.fromBufferAttribute(y,$),gc.fromBufferAttribute(y,K);const ie=E.morphTargetInfluences;if(S&&ie){Id.set(0,0,0),Ul.set(0,0,0),Tl.set(0,0,0);for(let ue=0,ye=S.length;ue<ye;ue++){const Se=ie[ue],_e=S[ue];Se!==0&&(Gh.fromBufferAttribute(_e,G),dp.fromBufferAttribute(_e,$),lh.fromBufferAttribute(_e,K),O?(Id.addScaledVector(Gh,Se),Ul.addScaledVector(dp,Se),Tl.addScaledVector(lh,Se)):(Id.addScaledVector(Gh.sub(sh),Se),Ul.addScaledVector(dp.sub(oh),Se),Tl.addScaledVector(lh.sub(gc),Se)))}sh.add(Id),oh.add(Ul),gc.add(Tl)}E.isSkinnedMesh&&(E.boneTransform(G,sh),E.boneTransform($,oh),E.boneTransform(K,gc));const ne=function(ue,ye,Se,_e,$e,st,ot,Lt){let Bt;if(Bt=ye.side===1?_e.intersectTriangle(ot,st,$e,!0,Lt):_e.intersectTriangle($e,st,ot,ye.side!==2,Lt),Bt===null)return null;mf.copy(Lt),mf.applyMatrix4(ue.matrixWorld);const di=Se.ray.origin.distanceTo(mf);return di<Se.near||di>Se.far?null:{distance:di,point:mf.clone(),object:ue}}(E,e,l,_,sh,oh,gc,pf);if(ne){k&&(jf.fromBufferAttribute(k,G),Hh.fromBufferAttribute(k,$),ff.fromBufferAttribute(k,K),ne.uv=Si.getUV(pf,sh,oh,gc,jf,Hh,ff,new dn)),N&&(jf.fromBufferAttribute(N,G),Hh.fromBufferAttribute(N,$),ff.fromBufferAttribute(N,K),ne.uv2=Si.getUV(pf,sh,oh,gc,jf,Hh,ff,new dn));const ue={a:G,b:$,c:K,normal:new ht,materialIndex:0};Si.getNormal(sh,oh,gc,ue.normal),ne.face=ue}return ne}eo.prototype.isMesh=!0;class Fr extends oa{constructor(e=1,l=1,_=1,y=1,S=1,O=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:l,depth:_,widthSegments:y,heightSegments:S,depthSegments:O};const k=this;y=Math.floor(y),S=Math.floor(S),O=Math.floor(O);const N=[],G=[],$=[],K=[];let ie=0,ne=0;function ue(ye,Se,_e,$e,st,ot,Lt,Bt,di,Ti,Ki){const Bi=ot/di,Zi=Lt/Ti,hr=ot/2,Gn=Lt/2,gn=Bt/2,Yn=di+1,Mr=Ti+1;let Cr=0,kr=0;const Zr=new ht;for(let la=0;la<Mr;la++){const Kn=la*Zi-Gn;for(let At=0;At<Yn;At++){const Qt=At*Bi-hr;Zr[ye]=Qt*$e,Zr[Se]=Kn*st,Zr[_e]=gn,G.push(Zr.x,Zr.y,Zr.z),Zr[ye]=0,Zr[Se]=0,Zr[_e]=Bt>0?1:-1,$.push(Zr.x,Zr.y,Zr.z),K.push(At/di),K.push(1-la/Ti),Cr+=1}}for(let la=0;la<Ti;la++)for(let Kn=0;Kn<di;Kn++){const At=ie+Kn+Yn*la,Qt=ie+Kn+Yn*(la+1),xn=ie+(Kn+1)+Yn*(la+1),Vi=ie+(Kn+1)+Yn*la;N.push(At,Qt,Vi),N.push(Qt,xn,Vi),kr+=6}k.addGroup(ne,kr,Ki),ne+=kr,ie+=Cr}ue("z","y","x",-1,-1,_,l,e,O,S,0),ue("z","y","x",1,-1,_,l,-e,O,S,1),ue("x","z","y",1,1,e,_,l,y,O,2),ue("x","z","y",1,-1,e,_,-l,y,O,3),ue("x","y","z",1,-1,e,l,_,y,S,4),ue("x","y","z",-1,-1,e,l,-_,y,S,5),this.setIndex(N),this.setAttribute("position",new or(G,3)),this.setAttribute("normal",new or($,3)),this.setAttribute("uv",new or(K,2))}static fromJSON(e){return new Fr(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function sr(E){const e={};for(const l in E){e[l]={};for(const _ in E[l]){const y=E[l][_];y&&(y.isColor||y.isMatrix3||y.isMatrix4||y.isVector2||y.isVector3||y.isVector4||y.isTexture||y.isQuaternion)?e[l][_]=y.clone():Array.isArray(y)?e[l][_]=y.slice():e[l][_]=y}}return e}function zo(E){const e={};for(let l=0;l<E.length;l++){const _=sr(E[l]);for(const y in _)e[y]=_[y]}return e}const br={clone:sr,merge:zo};class El extends rn{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=sr(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const l=super.toJSON(e);l.glslVersion=this.glslVersion,l.uniforms={};for(const y in this.uniforms){const S=this.uniforms[y].value;S&&S.isTexture?l.uniforms[y]={type:"t",value:S.toJSON(e).uuid}:S&&S.isColor?l.uniforms[y]={type:"c",value:S.getHex()}:S&&S.isVector2?l.uniforms[y]={type:"v2",value:S.toArray()}:S&&S.isVector3?l.uniforms[y]={type:"v3",value:S.toArray()}:S&&S.isVector4?l.uniforms[y]={type:"v4",value:S.toArray()}:S&&S.isMatrix3?l.uniforms[y]={type:"m3",value:S.toArray()}:S&&S.isMatrix4?l.uniforms[y]={type:"m4",value:S.toArray()}:l.uniforms[y]={value:S}}Object.keys(this.defines).length>0&&(l.defines=this.defines),l.vertexShader=this.vertexShader,l.fragmentShader=this.fragmentShader;const _={};for(const y in this.extensions)this.extensions[y]===!0&&(_[y]=!0);return Object.keys(_).length>0&&(l.extensions=_),l}}El.prototype.isShaderMaterial=!0;class _c extends we{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new tr,this.projectionMatrix=new tr,this.projectionMatrixInverse=new tr}copy(e,l){return super.copy(e,l),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const l=this.matrixWorld.elements;return e.set(-l[8],-l[9],-l[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,l){super.updateWorldMatrix(e,l),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}_c.prototype.isCamera=!0;class rr extends _c{constructor(e=50,l=1,_=.1,y=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=_,this.far=y,this.focus=10,this.aspect=l,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,l){return super.copy(e,l),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const l=.5*this.getFilmHeight()/e;this.fov=2*cr*Math.atan(l),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*gr*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*cr*Math.atan(Math.tan(.5*gr*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,l,_,y,S,O){this.aspect=e/l,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=l,this.view.offsetX=_,this.view.offsetY=y,this.view.width=S,this.view.height=O,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let l=e*Math.tan(.5*gr*this.fov)/this.zoom,_=2*l,y=this.aspect*_,S=-.5*y;const O=this.view;if(this.view!==null&&this.view.enabled){const N=O.fullWidth,G=O.fullHeight;S+=O.offsetX*y/N,l-=O.offsetY*_/G,y*=O.width/N,_*=O.height/G}const k=this.filmOffset;k!==0&&(S+=e*k/this.getFilmWidth()),this.projectionMatrix.makePerspective(S,S+y,l,l-_,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const l=super.toJSON(e);return l.object.fov=this.fov,l.object.zoom=this.zoom,l.object.near=this.near,l.object.far=this.far,l.object.focus=this.focus,l.object.aspect=this.aspect,this.view!==null&&(l.object.view=Object.assign({},this.view)),l.object.filmGauge=this.filmGauge,l.object.filmOffset=this.filmOffset,l}}rr.prototype.isPerspectiveCamera=!0;const Fc=90;class ec extends we{constructor(e,l,_){if(super(),this.type="CubeCamera",_.isWebGLCubeRenderTarget!==!0)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=_;const y=new rr(Fc,1,e,l);y.layers=this.layers,y.up.set(0,-1,0),y.lookAt(new ht(1,0,0)),this.add(y);const S=new rr(Fc,1,e,l);S.layers=this.layers,S.up.set(0,-1,0),S.lookAt(new ht(-1,0,0)),this.add(S);const O=new rr(Fc,1,e,l);O.layers=this.layers,O.up.set(0,0,1),O.lookAt(new ht(0,1,0)),this.add(O);const k=new rr(Fc,1,e,l);k.layers=this.layers,k.up.set(0,0,-1),k.lookAt(new ht(0,-1,0)),this.add(k);const N=new rr(Fc,1,e,l);N.layers=this.layers,N.up.set(0,-1,0),N.lookAt(new ht(0,0,1)),this.add(N);const G=new rr(Fc,1,e,l);G.layers=this.layers,G.up.set(0,-1,0),G.lookAt(new ht(0,0,-1)),this.add(G)}update(e,l){this.parent===null&&this.updateMatrixWorld();const _=this.renderTarget,[y,S,O,k,N,G]=this.children,$=e.xr.enabled,K=e.getRenderTarget();e.xr.enabled=!1;const ie=_.texture.generateMipmaps;_.texture.generateMipmaps=!1,e.setRenderTarget(_,0),e.render(l,y),e.setRenderTarget(_,1),e.render(l,S),e.setRenderTarget(_,2),e.render(l,O),e.setRenderTarget(_,3),e.render(l,k),e.setRenderTarget(_,4),e.render(l,N),_.texture.generateMipmaps=ie,e.setRenderTarget(_,5),e.render(l,G),e.setRenderTarget(K),e.xr.enabled=$}}class Ru extends Ca{constructor(e,l,_,y,S,O,k,N,G,$){super(e=e!==void 0?e:[],l=l!==void 0?l:301,_,y,S,O,k=k!==void 0?k:1022,N,G,$),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}Ru.prototype.isCubeTexture=!0;class ch extends gs{constructor(e,l,_){Number.isInteger(l)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),l=_),super(e,e,l),l=l||{},this.texture=new Ru(void 0,l.mapping,l.wrapS,l.wrapT,l.magFilter,l.minFilter,l.format,l.type,l.anisotropy,l.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=l.generateMipmaps!==void 0&&l.generateMipmaps,this.texture.minFilter=l.minFilter!==void 0?l.minFilter:1006,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,l){this.texture.type=l.type,this.texture.format=1023,this.texture.encoding=l.encoding,this.texture.generateMipmaps=l.generateMipmaps,this.texture.minFilter=l.minFilter,this.texture.magFilter=l.magFilter;const _={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},y=new Fr(5,5,5),S=new El({name:"CubemapFromEquirect",uniforms:sr(_.uniforms),vertexShader:_.vertexShader,fragmentShader:_.fragmentShader,side:1,blending:0});S.uniforms.tEquirect.value=l;const O=new eo(y,S),k=l.minFilter;return l.minFilter===1008&&(l.minFilter=1006),new ec(1,10,this).update(e,O),l.minFilter=k,O.geometry.dispose(),O.material.dispose(),this}clear(e,l,_,y){const S=e.getRenderTarget();for(let O=0;O<6;O++)e.setRenderTarget(this,O),e.clear(l,_,y);e.setRenderTarget(S)}}ch.prototype.isWebGLCubeRenderTarget=!0;const Po=new ht,bo=new ht,vn=new Xn;class tc{constructor(e=new ht(1,0,0),l=0){this.normal=e,this.constant=l}set(e,l){return this.normal.copy(e),this.constant=l,this}setComponents(e,l,_,y){return this.normal.set(e,l,_),this.constant=y,this}setFromNormalAndCoplanarPoint(e,l){return this.normal.copy(e),this.constant=-l.dot(this.normal),this}setFromCoplanarPoints(e,l,_){const y=Po.subVectors(_,l).cross(bo.subVectors(e,l)).normalize();return this.setFromNormalAndCoplanarPoint(y,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,l){return l.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,l){const _=e.delta(Po),y=this.normal.dot(_);if(y===0)return this.distanceToPoint(e.start)===0?l.copy(e.start):null;const S=-(e.start.dot(this.normal)+this.constant)/y;return S<0||S>1?null:l.copy(_).multiplyScalar(S).add(e.start)}intersectsLine(e){const l=this.distanceToPoint(e.start),_=this.distanceToPoint(e.end);return l<0&&_>0||_<0&&l>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,l){const _=l||vn.getNormalMatrix(e),y=this.coplanarPoint(Po).applyMatrix4(e),S=this.normal.applyMatrix3(_).normalize();return this.constant=-y.dot(S),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}tc.prototype.isPlane=!0;const iu=new zn,uh=new ht;class yc{constructor(e=new tc,l=new tc,_=new tc,y=new tc,S=new tc,O=new tc){this.planes=[e,l,_,y,S,O]}set(e,l,_,y,S,O){const k=this.planes;return k[0].copy(e),k[1].copy(l),k[2].copy(_),k[3].copy(y),k[4].copy(S),k[5].copy(O),this}copy(e){const l=this.planes;for(let _=0;_<6;_++)l[_].copy(e.planes[_]);return this}setFromProjectionMatrix(e){const l=this.planes,_=e.elements,y=_[0],S=_[1],O=_[2],k=_[3],N=_[4],G=_[5],$=_[6],K=_[7],ie=_[8],ne=_[9],ue=_[10],ye=_[11],Se=_[12],_e=_[13],$e=_[14],st=_[15];return l[0].setComponents(k-y,K-N,ye-ie,st-Se).normalize(),l[1].setComponents(k+y,K+N,ye+ie,st+Se).normalize(),l[2].setComponents(k+S,K+G,ye+ne,st+_e).normalize(),l[3].setComponents(k-S,K-G,ye-ne,st-_e).normalize(),l[4].setComponents(k-O,K-$,ye-ue,st-$e).normalize(),l[5].setComponents(k+O,K+$,ye+ue,st+$e).normalize(),this}intersectsObject(e){const l=e.geometry;return l.boundingSphere===null&&l.computeBoundingSphere(),iu.copy(l.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(iu)}intersectsSprite(e){return iu.center.set(0,0,0),iu.radius=.7071067811865476,iu.applyMatrix4(e.matrixWorld),this.intersectsSphere(iu)}intersectsSphere(e){const l=this.planes,_=e.center,y=-e.radius;for(let S=0;S<6;S++)if(l[S].distanceToPoint(_)<y)return!1;return!0}intersectsBox(e){const l=this.planes;for(let _=0;_<6;_++){const y=l[_];if(uh.x=y.normal.x>0?e.max.x:e.min.x,uh.y=y.normal.y>0?e.max.y:e.min.y,uh.z=y.normal.z>0?e.max.z:e.min.z,y.distanceToPoint(uh)<0)return!1}return!0}containsPoint(e){const l=this.planes;for(let _=0;_<6;_++)if(l[_].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function wo(){let E=null,e=!1,l=null,_=null;function y(S,O){l(S,O),_=E.requestAnimationFrame(y)}return{start:function(){e!==!0&&l!==null&&(_=E.requestAnimationFrame(y),e=!0)},stop:function(){E.cancelAnimationFrame(_),e=!1},setAnimationLoop:function(S){l=S},setContext:function(S){E=S}}}function Iu(E,e){const l=e.isWebGL2,_=new WeakMap;return{get:function(y){return y.isInterleavedBufferAttribute&&(y=y.data),_.get(y)},remove:function(y){y.isInterleavedBufferAttribute&&(y=y.data);const S=_.get(y);S&&(E.deleteBuffer(S.buffer),_.delete(y))},update:function(y,S){if(y.isGLBufferAttribute){const k=_.get(y);return void((!k||k.version<y.version)&&_.set(y,{buffer:y.buffer,type:y.type,bytesPerElement:y.elementSize,version:y.version}))}y.isInterleavedBufferAttribute&&(y=y.data);const O=_.get(y);O===void 0?_.set(y,function(k,N){const G=k.array,$=k.usage,K=E.createBuffer();E.bindBuffer(N,K),E.bufferData(N,G,$),k.onUploadCallback();let ie=5126;return G instanceof Float32Array?ie=5126:G instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):G instanceof Uint16Array?k.isFloat16BufferAttribute?l?ie=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):ie=5123:G instanceof Int16Array?ie=5122:G instanceof Uint32Array?ie=5125:G instanceof Int32Array?ie=5124:G instanceof Int8Array?ie=5120:(G instanceof Uint8Array||G instanceof Uint8ClampedArray)&&(ie=5121),{buffer:K,type:ie,bytesPerElement:G.BYTES_PER_ELEMENT,version:k.version}}(y,S)):O.version<y.version&&(function(k,N,G){const $=N.array,K=N.updateRange;E.bindBuffer(G,k),K.count===-1?E.bufferSubData(G,0,$):(l?E.bufferSubData(G,K.offset*$.BYTES_PER_ELEMENT,$,K.offset,K.count):E.bufferSubData(G,K.offset*$.BYTES_PER_ELEMENT,$.subarray(K.offset,K.offset+K.count)),K.count=-1)}(O.buffer,y,S),O.version=y.version)}}}class Du extends oa{constructor(e=1,l=1,_=1,y=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:l,widthSegments:_,heightSegments:y};const S=e/2,O=l/2,k=Math.floor(_),N=Math.floor(y),G=k+1,$=N+1,K=e/k,ie=l/N,ne=[],ue=[],ye=[],Se=[];for(let _e=0;_e<$;_e++){const $e=_e*ie-O;for(let st=0;st<G;st++){const ot=st*K-S;ue.push(ot,-$e,0),ye.push(0,0,1),Se.push(st/k),Se.push(1-_e/N)}}for(let _e=0;_e<N;_e++)for(let $e=0;$e<k;$e++){const st=$e+G*_e,ot=$e+G*(_e+1),Lt=$e+1+G*(_e+1),Bt=$e+1+G*_e;ne.push(st,ot,Bt),ne.push(ot,Lt,Bt)}this.setIndex(ne),this.setAttribute("position",new or(ue,3)),this.setAttribute("normal",new or(ye,3)),this.setAttribute("uv",new or(Se,2))}static fromJSON(e){return new Du(e.width,e.height,e.widthSegments,e.heightSegments)}}const Kr={alphamap_fragment:`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotVH = saturate( dot( geometry.viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float NoH ) {
	float invAlpha = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float NoV, float NoL ) {
	return saturate( 1.0 / ( 4.0 * ( NoL + NoV - NoL * NoV ) ) );
}
vec3 BRDF_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_maxMipLevel 8.0
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_maxTileSize 256.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		float texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );
		vec2 f = fract( uv );
		uv += 0.5 - f;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		if ( mipInt < cubeUV_maxMipLevel ) {
			uv.y += 2.0 * cubeUV_maxTileSize;
		}
		uv.y += filterInt * 2.0 * cubeUV_minTileSize;
		uv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );
		uv *= texelSize;
		vec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x += texelSize;
		vec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.y += texelSize;
		vec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		uv.x -= texelSize;
		vec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;
		vec3 tm = mix( tl, tr, f.x );
		vec3 bm = mix( bl, br, f.x );
		return mix( tm, bm, f.y );
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value ) {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
		envColor = envMapTexelToLinear( envColor );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getIBLIrradiance( const in GeometricContext geometry ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec;
			#ifdef ENVMAP_MODE_REFLECTION
				reflectVec = reflect( - viewDir, normal );
				reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#else
				reflectVec = refract( - viewDir, normal, refractionRatio );
			#endif
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		lightMapIrradiance *= PI;
	#endif
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_vertex:`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
	#pragma unroll_loop_end
#endif`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularTintFactor = specularTint;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARTINTMAP
			specularTintFactor *= specularTintMapTexelToLinear( texture2D( specularTintMap, vUv ) ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularTintFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularTintFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenTint = sheenTint;
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenTint;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(		0, 1,		0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += irradiance * BRDF_Sheen( material.roughness, directLight.direction, geometry, material.sheenTint );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
		uniform float morphTargetInfluences[ 8 ];
	#else
		uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
		transformed += morphTarget4 * morphTargetInfluences[ 4 ];
		transformed += morphTarget5 * morphTargetInfluences[ 5 ];
		transformed += morphTarget6 * morphTargetInfluences[ 6 ];
		transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,output_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
							texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
							f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
							texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
							f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(	1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,	1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,	1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationTint, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = transmission.a;
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationTint;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( float roughness, float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef TEXTURE_LOD_EXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,
		vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,
		vec3 attenuationColor, float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,uv_pars_fragment:`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_frag:`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,cube_frag:`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularTint;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARTINTMAP
		uniform sampler2D specularTintMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenTint;
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`},dr={common:{diffuse:{value:new On(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Xn},uv2Transform:{value:new Xn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new dn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new On(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new On(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Xn}},sprite:{diffuse:{value:new On(16777215)},opacity:{value:1},center:{value:new dn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Xn}}},Zo={basic:{uniforms:zo([dr.common,dr.specularmap,dr.envmap,dr.aomap,dr.lightmap,dr.fog]),vertexShader:Kr.meshbasic_vert,fragmentShader:Kr.meshbasic_frag},lambert:{uniforms:zo([dr.common,dr.specularmap,dr.envmap,dr.aomap,dr.lightmap,dr.emissivemap,dr.fog,dr.lights,{emissive:{value:new On(0)}}]),vertexShader:Kr.meshlambert_vert,fragmentShader:Kr.meshlambert_frag},phong:{uniforms:zo([dr.common,dr.specularmap,dr.envmap,dr.aomap,dr.lightmap,dr.emissivemap,dr.bumpmap,dr.normalmap,dr.displacementmap,dr.fog,dr.lights,{emissive:{value:new On(0)},specular:{value:new On(1118481)},shininess:{value:30}}]),vertexShader:Kr.meshphong_vert,fragmentShader:Kr.meshphong_frag},standard:{uniforms:zo([dr.common,dr.envmap,dr.aomap,dr.lightmap,dr.emissivemap,dr.bumpmap,dr.normalmap,dr.displacementmap,dr.roughnessmap,dr.metalnessmap,dr.fog,dr.lights,{emissive:{value:new On(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Kr.meshphysical_vert,fragmentShader:Kr.meshphysical_frag},toon:{uniforms:zo([dr.common,dr.aomap,dr.lightmap,dr.emissivemap,dr.bumpmap,dr.normalmap,dr.displacementmap,dr.gradientmap,dr.fog,dr.lights,{emissive:{value:new On(0)}}]),vertexShader:Kr.meshtoon_vert,fragmentShader:Kr.meshtoon_frag},matcap:{uniforms:zo([dr.common,dr.bumpmap,dr.normalmap,dr.displacementmap,dr.fog,{matcap:{value:null}}]),vertexShader:Kr.meshmatcap_vert,fragmentShader:Kr.meshmatcap_frag},points:{uniforms:zo([dr.points,dr.fog]),vertexShader:Kr.points_vert,fragmentShader:Kr.points_frag},dashed:{uniforms:zo([dr.common,dr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Kr.linedashed_vert,fragmentShader:Kr.linedashed_frag},depth:{uniforms:zo([dr.common,dr.displacementmap]),vertexShader:Kr.depth_vert,fragmentShader:Kr.depth_frag},normal:{uniforms:zo([dr.common,dr.bumpmap,dr.normalmap,dr.displacementmap,{opacity:{value:1}}]),vertexShader:Kr.meshnormal_vert,fragmentShader:Kr.meshnormal_frag},sprite:{uniforms:zo([dr.sprite,dr.fog]),vertexShader:Kr.sprite_vert,fragmentShader:Kr.sprite_frag},background:{uniforms:{uvTransform:{value:new Xn},t2D:{value:null}},vertexShader:Kr.background_vert,fragmentShader:Kr.background_frag},cube:{uniforms:zo([dr.envmap,{opacity:{value:1}}]),vertexShader:Kr.cube_vert,fragmentShader:Kr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Kr.equirect_vert,fragmentShader:Kr.equirect_frag},distanceRGBA:{uniforms:zo([dr.common,dr.displacementmap,{referencePosition:{value:new ht},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Kr.distanceRGBA_vert,fragmentShader:Kr.distanceRGBA_frag},shadow:{uniforms:zo([dr.lights,dr.fog,{color:{value:new On(0)},opacity:{value:1}}]),vertexShader:Kr.shadow_vert,fragmentShader:Kr.shadow_frag}};function qf(E,e,l,_,y){const S=new On(0);let O,k,N=0,G=null,$=0,K=null;function ie(ne,ue){l.buffers.color.setClear(ne.r,ne.g,ne.b,ue,y)}return{getClearColor:function(){return S},setClearColor:function(ne,ue=1){S.set(ne),N=ue,ie(S,N)},getClearAlpha:function(){return N},setClearAlpha:function(ne){N=ne,ie(S,N)},render:function(ne,ue){let ye=!1,Se=ue.isScene===!0?ue.background:null;Se&&Se.isTexture&&(Se=e.get(Se));const _e=E.xr,$e=_e.getSession&&_e.getSession();$e&&$e.environmentBlendMode==="additive"&&(Se=null),Se===null?ie(S,N):Se&&Se.isColor&&(ie(Se,1),ye=!0),(E.autoClear||ye)&&E.clear(E.autoClearColor,E.autoClearDepth,E.autoClearStencil),Se&&(Se.isCubeTexture||Se.mapping===306)?(k===void 0&&(k=new eo(new Fr(1,1,1),new El({name:"BackgroundCubeMaterial",uniforms:sr(Zo.cube.uniforms),vertexShader:Zo.cube.vertexShader,fragmentShader:Zo.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),k.geometry.deleteAttribute("normal"),k.geometry.deleteAttribute("uv"),k.onBeforeRender=function(st,ot,Lt){this.matrixWorld.copyPosition(Lt.matrixWorld)},Object.defineProperty(k.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),_.update(k)),k.material.uniforms.envMap.value=Se,k.material.uniforms.flipEnvMap.value=Se.isCubeTexture&&Se.isRenderTargetTexture===!1?-1:1,G===Se&&$===Se.version&&K===E.toneMapping||(k.material.needsUpdate=!0,G=Se,$=Se.version,K=E.toneMapping),ne.unshift(k,k.geometry,k.material,0,0,null)):Se&&Se.isTexture&&(O===void 0&&(O=new eo(new Du(2,2),new El({name:"BackgroundMaterial",uniforms:sr(Zo.background.uniforms),vertexShader:Zo.background.vertexShader,fragmentShader:Zo.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),O.geometry.deleteAttribute("normal"),Object.defineProperty(O.material,"map",{get:function(){return this.uniforms.t2D.value}}),_.update(O)),O.material.uniforms.t2D.value=Se,Se.matrixAutoUpdate===!0&&Se.updateMatrix(),O.material.uniforms.uvTransform.value.copy(Se.matrix),G===Se&&$===Se.version&&K===E.toneMapping||(O.material.needsUpdate=!0,G=Se,$=Se.version,K=E.toneMapping),ne.unshift(O,O.geometry,O.material,0,0,null))}}}function Op(E,e,l,_){const y=E.getParameter(34921),S=_.isWebGL2?null:e.get("OES_vertex_array_object"),O=_.isWebGL2||S!==null,k={},N=ie(null);let G=N;function $(ot){return _.isWebGL2?E.bindVertexArray(ot):S.bindVertexArrayOES(ot)}function K(ot){return _.isWebGL2?E.deleteVertexArray(ot):S.deleteVertexArrayOES(ot)}function ie(ot){const Lt=[],Bt=[],di=[];for(let Ti=0;Ti<y;Ti++)Lt[Ti]=0,Bt[Ti]=0,di[Ti]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Lt,enabledAttributes:Bt,attributeDivisors:di,object:ot,attributes:{},index:null}}function ne(){const ot=G.newAttributes;for(let Lt=0,Bt=ot.length;Lt<Bt;Lt++)ot[Lt]=0}function ue(ot){ye(ot,0)}function ye(ot,Lt){const Bt=G.newAttributes,di=G.enabledAttributes,Ti=G.attributeDivisors;Bt[ot]=1,di[ot]===0&&(E.enableVertexAttribArray(ot),di[ot]=1),Ti[ot]!==Lt&&((_.isWebGL2?E:e.get("ANGLE_instanced_arrays"))[_.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](ot,Lt),Ti[ot]=Lt)}function Se(){const ot=G.newAttributes,Lt=G.enabledAttributes;for(let Bt=0,di=Lt.length;Bt<di;Bt++)Lt[Bt]!==ot[Bt]&&(E.disableVertexAttribArray(Bt),Lt[Bt]=0)}function _e(ot,Lt,Bt,di,Ti,Ki){_.isWebGL2!==!0||Bt!==5124&&Bt!==5125?E.vertexAttribPointer(ot,Lt,Bt,di,Ti,Ki):E.vertexAttribIPointer(ot,Lt,Bt,Ti,Ki)}function $e(){st(),G!==N&&(G=N,$(G.object))}function st(){N.geometry=null,N.program=null,N.wireframe=!1}return{setup:function(ot,Lt,Bt,di,Ti){let Ki=!1;if(O){const Bi=function(Zi,hr,Gn){const gn=Gn.wireframe===!0;let Yn=k[Zi.id];Yn===void 0&&(Yn={},k[Zi.id]=Yn);let Mr=Yn[hr.id];Mr===void 0&&(Mr={},Yn[hr.id]=Mr);let Cr=Mr[gn];return Cr===void 0&&(Cr=ie(_.isWebGL2?E.createVertexArray():S.createVertexArrayOES()),Mr[gn]=Cr),Cr}(di,Bt,Lt);G!==Bi&&(G=Bi,$(G.object)),Ki=function(Zi,hr){const Gn=G.attributes,gn=Zi.attributes;let Yn=0;for(const Mr in gn){const Cr=Gn[Mr],kr=gn[Mr];if(Cr===void 0||Cr.attribute!==kr||Cr.data!==kr.data)return!0;Yn++}return G.attributesNum!==Yn||G.index!==hr}(di,Ti),Ki&&function(Zi,hr){const Gn={},gn=Zi.attributes;let Yn=0;for(const Mr in gn){const Cr=gn[Mr],kr={};kr.attribute=Cr,Cr.data&&(kr.data=Cr.data),Gn[Mr]=kr,Yn++}G.attributes=Gn,G.attributesNum=Yn,G.index=hr}(di,Ti)}else{const Bi=Lt.wireframe===!0;G.geometry===di.id&&G.program===Bt.id&&G.wireframe===Bi||(G.geometry=di.id,G.program=Bt.id,G.wireframe=Bi,Ki=!0)}ot.isInstancedMesh===!0&&(Ki=!0),Ti!==null&&l.update(Ti,34963),Ki&&(function(Bi,Zi,hr,Gn){if(_.isWebGL2===!1&&(Bi.isInstancedMesh||Gn.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;ne();const gn=Gn.attributes,Yn=hr.getAttributes(),Mr=Zi.defaultAttributeValues;for(const Cr in Yn){const kr=Yn[Cr];if(kr.location>=0){let Zr=gn[Cr];if(Zr===void 0&&(Cr==="instanceMatrix"&&Bi.instanceMatrix&&(Zr=Bi.instanceMatrix),Cr==="instanceColor"&&Bi.instanceColor&&(Zr=Bi.instanceColor)),Zr!==void 0){const la=Zr.normalized,Kn=Zr.itemSize,At=l.get(Zr);if(At===void 0)continue;const Qt=At.buffer,xn=At.type,Vi=At.bytesPerElement;if(Zr.isInterleavedBufferAttribute){const ji=Zr.data,ir=ji.stride,$n=Zr.offset;if(ji&&ji.isInstancedInterleavedBuffer){for(let $i=0;$i<kr.locationSize;$i++)ye(kr.location+$i,ji.meshPerAttribute);Bi.isInstancedMesh!==!0&&Gn._maxInstanceCount===void 0&&(Gn._maxInstanceCount=ji.meshPerAttribute*ji.count)}else for(let $i=0;$i<kr.locationSize;$i++)ue(kr.location+$i);E.bindBuffer(34962,Qt);for(let $i=0;$i<kr.locationSize;$i++)_e(kr.location+$i,Kn/kr.locationSize,xn,la,ir*Vi,($n+Kn/kr.locationSize*$i)*Vi)}else{if(Zr.isInstancedBufferAttribute){for(let ji=0;ji<kr.locationSize;ji++)ye(kr.location+ji,Zr.meshPerAttribute);Bi.isInstancedMesh!==!0&&Gn._maxInstanceCount===void 0&&(Gn._maxInstanceCount=Zr.meshPerAttribute*Zr.count)}else for(let ji=0;ji<kr.locationSize;ji++)ue(kr.location+ji);E.bindBuffer(34962,Qt);for(let ji=0;ji<kr.locationSize;ji++)_e(kr.location+ji,Kn/kr.locationSize,xn,la,Kn*Vi,Kn/kr.locationSize*ji*Vi)}}else if(Mr!==void 0){const la=Mr[Cr];if(la!==void 0)switch(la.length){case 2:E.vertexAttrib2fv(kr.location,la);break;case 3:E.vertexAttrib3fv(kr.location,la);break;case 4:E.vertexAttrib4fv(kr.location,la);break;default:E.vertexAttrib1fv(kr.location,la)}}}}Se()}(ot,Lt,Bt,di),Ti!==null&&E.bindBuffer(34963,l.get(Ti).buffer))},reset:$e,resetDefaultState:st,dispose:function(){$e();for(const ot in k){const Lt=k[ot];for(const Bt in Lt){const di=Lt[Bt];for(const Ti in di)K(di[Ti].object),delete di[Ti];delete Lt[Bt]}delete k[ot]}},releaseStatesOfGeometry:function(ot){if(k[ot.id]===void 0)return;const Lt=k[ot.id];for(const Bt in Lt){const di=Lt[Bt];for(const Ti in di)K(di[Ti].object),delete di[Ti];delete Lt[Bt]}delete k[ot.id]},releaseStatesOfProgram:function(ot){for(const Lt in k){const Bt=k[Lt];if(Bt[ot.id]===void 0)continue;const di=Bt[ot.id];for(const Ti in di)K(di[Ti].object),delete di[Ti];delete Bt[ot.id]}},initAttributes:ne,enableAttribute:ue,disableUnusedAttributes:Se}}function Wf(E,e,l,_){const y=_.isWebGL2;let S;this.setMode=function(O){S=O},this.render=function(O,k){E.drawArrays(S,O,k),l.update(k,S,1)},this.renderInstances=function(O,k,N){if(N===0)return;let G,$;if(y)G=E,$="drawArraysInstanced";else if(G=e.get("ANGLE_instanced_arrays"),$="drawArraysInstancedANGLE",G===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");G[$](S,O,k,N),l.update(k,S,N)}}function fp(E,e,l){let _;function y(ot){if(ot==="highp"){if(E.getShaderPrecisionFormat(35633,36338).precision>0&&E.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";ot="mediump"}return ot==="mediump"&&E.getShaderPrecisionFormat(35633,36337).precision>0&&E.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const S=typeof WebGL2RenderingContext<"u"&&E instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&E instanceof WebGL2ComputeRenderingContext;let O=l.precision!==void 0?l.precision:"highp";const k=y(O);k!==O&&(console.warn("THREE.WebGLRenderer:",O,"not supported, using",k,"instead."),O=k);const N=S||e.has("WEBGL_draw_buffers"),G=l.logarithmicDepthBuffer===!0,$=E.getParameter(34930),K=E.getParameter(35660),ie=E.getParameter(3379),ne=E.getParameter(34076),ue=E.getParameter(34921),ye=E.getParameter(36347),Se=E.getParameter(36348),_e=E.getParameter(36349),$e=K>0,st=S||e.has("OES_texture_float");return{isWebGL2:S,drawBuffers:N,getMaxAnisotropy:function(){if(_!==void 0)return _;if(e.has("EXT_texture_filter_anisotropic")===!0){const ot=e.get("EXT_texture_filter_anisotropic");_=E.getParameter(ot.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else _=0;return _},getMaxPrecision:y,precision:O,logarithmicDepthBuffer:G,maxTextures:$,maxVertexTextures:K,maxTextureSize:ie,maxCubemapSize:ne,maxAttributes:ue,maxVertexUniforms:ye,maxVaryings:Se,maxFragmentUniforms:_e,vertexTextures:$e,floatFragmentTextures:st,floatVertexTextures:$e&&st,maxSamples:S?E.getParameter(36183):0}}function Bp(E){const e=this;let l=null,_=0,y=!1,S=!1;const O=new tc,k=new Xn,N={value:null,needsUpdate:!1};function G(){N.value!==l&&(N.value=l,N.needsUpdate=_>0),e.numPlanes=_,e.numIntersection=0}function $(K,ie,ne,ue){const ye=K!==null?K.length:0;let Se=null;if(ye!==0){if(Se=N.value,ue!==!0||Se===null){const _e=ne+4*ye,$e=ie.matrixWorldInverse;k.getNormalMatrix($e),(Se===null||Se.length<_e)&&(Se=new Float32Array(_e));for(let st=0,ot=ne;st!==ye;++st,ot+=4)O.copy(K[st]).applyMatrix4($e,k),O.normal.toArray(Se,ot),Se[ot+3]=O.constant}N.value=Se,N.needsUpdate=!0}return e.numPlanes=ye,e.numIntersection=0,Se}this.uniform=N,this.numPlanes=0,this.numIntersection=0,this.init=function(K,ie,ne){const ue=K.length!==0||ie||_!==0||y;return y=ie,l=$(K,ne,0),_=K.length,ue},this.beginShadows=function(){S=!0,$(null)},this.endShadows=function(){S=!1,G()},this.setState=function(K,ie,ne){const ue=K.clippingPlanes,ye=K.clipIntersection,Se=K.clipShadows,_e=E.get(K);if(!y||ue===null||ue.length===0||S&&!Se)S?$(null):G();else{const $e=S?0:_,st=4*$e;let ot=_e.clippingState||null;N.value=ot,ot=$(ue,ie,st,ne);for(let Lt=0;Lt!==st;++Lt)ot[Lt]=l[Lt];_e.clippingState=ot,this.numIntersection=ye?this.numPlanes:0,this.numPlanes+=$e}}}function pp(E){let e=new WeakMap;function l(y,S){return S===303?y.mapping=301:S===304&&(y.mapping=302),y}function _(y){const S=y.target;S.removeEventListener("dispose",_);const O=e.get(S);O!==void 0&&(e.delete(S),O.dispose())}return{get:function(y){if(y&&y.isTexture&&y.isRenderTargetTexture===!1){const S=y.mapping;if(S===303||S===304){if(e.has(y))return l(e.get(y).texture,y.mapping);{const O=y.image;if(O&&O.height>0){const k=E.getRenderTarget(),N=new ch(O.height/2);return N.fromEquirectangularTexture(E,y),e.set(y,N),E.setRenderTarget(k),y.addEventListener("dispose",_),l(N.texture,y.mapping)}return null}}}return y},dispose:function(){e=new WeakMap}}}Zo.physical={uniforms:zo([Zo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new dn(1,1)},clearcoatNormalMap:{value:null},sheenTint:{value:new On(0)},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new dn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationTint:{value:new On(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularTint:{value:new On(1,1,1)},specularTintMap:{value:null}}]),vertexShader:Kr.meshphysical_vert,fragmentShader:Kr.meshphysical_frag};class vc extends _c{constructor(e=-1,l=1,_=1,y=-1,S=.1,O=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=l,this.top=_,this.bottom=y,this.near=S,this.far=O,this.updateProjectionMatrix()}copy(e,l){return super.copy(e,l),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,l,_,y,S,O){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=l,this.view.offsetX=_,this.view.offsetY=y,this.view.width=S,this.view.height=O,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),l=(this.top-this.bottom)/(2*this.zoom),_=(this.right+this.left)/2,y=(this.top+this.bottom)/2;let S=_-e,O=_+e,k=y+l,N=y-l;if(this.view!==null&&this.view.enabled){const G=(this.right-this.left)/this.view.fullWidth/this.zoom,$=(this.top-this.bottom)/this.view.fullHeight/this.zoom;S+=G*this.view.offsetX,O=S+G*this.view.width,k-=$*this.view.offsetY,N=k-$*this.view.height}this.projectionMatrix.makeOrthographic(S,O,k,N,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const l=super.toJSON(e);return l.object.zoom=this.zoom,l.object.left=this.left,l.object.right=this.right,l.object.top=this.top,l.object.bottom=this.bottom,l.object.near=this.near,l.object.far=this.far,this.view!==null&&(l.object.view=Object.assign({},this.view)),l}}vc.prototype.isOrthographicCamera=!0;class hh extends El{constructor(e){super(e),this.type="RawShaderMaterial"}}hh.prototype.isRawShaderMaterial=!0;const Al=Math.pow(2,8),nu=[.125,.215,.35,.446,.526,.582],mp=5+nu.length,kc=20,sl={3e3:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},zu=new vc,{_lodPlanes:jh,_sizeLods:Oo,_sigmas:dh}=Dd(),qh=new On;let Wh=null;const Vl=(1+Math.sqrt(5))/2,Pu=1/Vl,Zf=[new ht(1,1,1),new ht(-1,1,1),new ht(1,1,-1),new ht(-1,1,-1),new ht(0,Vl,Pu),new ht(0,Vl,-Pu),new ht(Pu,0,Vl),new ht(-Pu,0,Vl),new ht(Vl,Pu,0),new ht(-Vl,Pu,0)];class Ou{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function(l){const _=new Float32Array(l),y=new ht(0,1,0);return new hh({name:"SphericalGaussianBlur",defines:{n:l},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:_},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:y},inputEncoding:{value:sl[3e3]},outputEncoding:{value:sl[3e3]}},vertexShader:ru(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			${Fu()}

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}(kc),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,l=0,_=.1,y=100){Wh=this._renderer.getRenderTarget();const S=this._allocateTargets();return this._sceneToCubeUV(e,_,y,S),l>0&&this._blur(S,0,0,l),this._applyPMREM(S),this._cleanup(S),S}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){this._cubemapShader===null&&(this._cubemapShader=Bu(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){this._equirectShader===null&&(this._equirectShader=ic(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let e=0;e<jh.length;e++)jh[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Wh),e.scissorTest=!1,po(e,0,0,e.width,e.height)}_fromTexture(e){Wh=this._renderer.getRenderTarget();const l=this._allocateTargets(e);return this._textureToCubeUV(e,l),this._applyPMREM(l),this._cleanup(l),l}_allocateTargets(e){const l={magFilter:1003,minFilter:1003,generateMipmaps:!1,type:1009,format:1023,encoding:Zh(e)?e.encoding:3002,depthBuffer:!1},_=pl(l);return _.depthBuffer=!e,this._pingPongRenderTarget=pl(l),_}_compileMaterial(e){const l=new eo(jh[0],e);this._renderer.compile(l,zu)}_sceneToCubeUV(e,l,_,y){const S=new rr(90,1,l,_),O=[1,-1,1,1,1,1],k=[1,1,1,-1,-1,-1],N=this._renderer,G=N.autoClear,$=N.outputEncoding,K=N.toneMapping;N.getClearColor(qh),N.toneMapping=0,N.outputEncoding=3e3,N.autoClear=!1;const ie=new fa({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),ne=new eo(new Fr,ie);let ue=!1;const ye=e.background;ye?ye.isColor&&(ie.color.copy(ye),e.background=null,ue=!0):(ie.color.copy(qh),ue=!0);for(let Se=0;Se<6;Se++){const _e=Se%3;_e==0?(S.up.set(0,O[Se],0),S.lookAt(k[Se],0,0)):_e==1?(S.up.set(0,0,O[Se]),S.lookAt(0,k[Se],0)):(S.up.set(0,O[Se],0),S.lookAt(0,0,k[Se])),po(y,_e*Al,Se>2?Al:0,Al,Al),N.setRenderTarget(y),ue&&N.render(ne,S),N.render(e,S)}ne.geometry.dispose(),ne.material.dispose(),N.toneMapping=K,N.outputEncoding=$,N.autoClear=G,e.background=ye}_textureToCubeUV(e,l){const _=this._renderer;e.isCubeTexture?this._cubemapShader==null&&(this._cubemapShader=Bu()):this._equirectShader==null&&(this._equirectShader=ic());const y=e.isCubeTexture?this._cubemapShader:this._equirectShader,S=new eo(jh[0],y),O=y.uniforms;O.envMap.value=e,e.isCubeTexture||O.texelSize.value.set(1/e.image.width,1/e.image.height),O.inputEncoding.value=sl[e.encoding],O.outputEncoding.value=sl[l.texture.encoding],po(l,0,0,3*Al,2*Al),_.setRenderTarget(l),_.render(S,zu)}_applyPMREM(e){const l=this._renderer,_=l.autoClear;l.autoClear=!1;for(let y=1;y<mp;y++){const S=Math.sqrt(dh[y]*dh[y]-dh[y-1]*dh[y-1]),O=Zf[(y-1)%Zf.length];this._blur(e,y-1,y,S,O)}l.autoClear=_}_blur(e,l,_,y,S){const O=this._pingPongRenderTarget;this._halfBlur(e,O,l,_,y,"latitudinal",S),this._halfBlur(O,e,_,_,y,"longitudinal",S)}_halfBlur(e,l,_,y,S,O,k){const N=this._renderer,G=this._blurMaterial;O!=="latitudinal"&&O!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const $=new eo(jh[y],G),K=G.uniforms,ie=Oo[_]-1,ne=isFinite(S)?Math.PI/(2*ie):2*Math.PI/39,ue=S/ne,ye=isFinite(S)?1+Math.floor(3*ue):kc;ye>kc&&console.warn(`sigmaRadians, ${S}, is too large and will clip, as it requested ${ye} samples when the maximum is set to 20`);const Se=[];let _e=0;for(let st=0;st<kc;++st){const ot=st/ue,Lt=Math.exp(-ot*ot/2);Se.push(Lt),st==0?_e+=Lt:st<ye&&(_e+=2*Lt)}for(let st=0;st<Se.length;st++)Se[st]=Se[st]/_e;K.envMap.value=e.texture,K.samples.value=ye,K.weights.value=Se,K.latitudinal.value=O==="latitudinal",k&&(K.poleAxis.value=k),K.dTheta.value=ne,K.mipInt.value=8-_,K.inputEncoding.value=sl[e.texture.encoding],K.outputEncoding.value=sl[e.texture.encoding];const $e=Oo[y];po(l,3*Math.max(0,Al-2*$e),(y===0?0:2*Al)+2*$e*(y>4?y-8+4:0),3*$e,2*$e),N.setRenderTarget(l),N.render($,zu)}}function Zh(E){return E!==void 0&&E.type===1009&&(E.encoding===3e3||E.encoding===3001||E.encoding===3007)}function Dd(){const E=[],e=[],l=[];let _=8;for(let y=0;y<mp;y++){const S=Math.pow(2,_);e.push(S);let O=1/S;y>4?O=nu[y-8+4-1]:y==0&&(O=0),l.push(O);const k=1/(S-1),N=-k/2,G=1+k/2,$=[N,N,G,N,G,G,N,N,G,G,N,G],K=6,ie=6,ne=3,ue=2,ye=1,Se=new Float32Array(ne*ie*K),_e=new Float32Array(ue*ie*K),$e=new Float32Array(ye*ie*K);for(let ot=0;ot<K;ot++){const Lt=ot%3*2/3-1,Bt=ot>2?0:-1,di=[Lt,Bt,0,Lt+2/3,Bt,0,Lt+2/3,Bt+1,0,Lt,Bt,0,Lt+2/3,Bt+1,0,Lt,Bt+1,0];Se.set(di,ne*ie*ot),_e.set($,ue*ie*ot);const Ti=[ot,ot,ot,ot,ot,ot];$e.set(Ti,ye*ie*ot)}const st=new oa;st.setAttribute("position",new aa(Se,ne)),st.setAttribute("uv",new aa(_e,ue)),st.setAttribute("faceIndex",new aa($e,ye)),E.push(st),_>4&&_--}return{_lodPlanes:E,_sizeLods:e,_sigmas:l}}function pl(E){const e=new gs(3*Al,3*Al,E);return e.texture.mapping=306,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function po(E,e,l,_,y){E.viewport.set(e,l,_,y),E.scissor.set(e,l,_,y)}function ic(){const E=new dn(1,1);return new hh({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:E},inputEncoding:{value:sl[3e3]},outputEncoding:{value:sl[3e3]}},vertexShader:ru(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform vec2 texelSize;

			${Fu()}

			#include <common>

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				vec2 f = fract( uv / texelSize - 0.5 );
				uv -= f * texelSize;
				vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x += texelSize.x;
				vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.y += texelSize.y;
				vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;
				uv.x -= texelSize.x;
				vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;

				vec3 tm = mix( tl, tr, f.x );
				vec3 bm = mix( bl, br, f.x );
				gl_FragColor.rgb = mix( tm, bm, f.y );

				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function Bu(){return new hh({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:sl[3e3]},outputEncoding:{value:sl[3e3]}},vertexShader:ru(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			${Fu()}

			void main() {

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;
				gl_FragColor = linearToOutputTexel( gl_FragColor );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function ru(){return`

		precision mediump float;
		precision mediump int;

		attribute vec3 position;
		attribute vec2 uv;
		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Fu(){return`

		uniform int inputEncoding;
		uniform int outputEncoding;

		#include <encodings_pars_fragment>

		vec4 inputTexelToLinear( vec4 value ) {

			if ( inputEncoding == 0 ) {

				return value;

			} else if ( inputEncoding == 1 ) {

				return sRGBToLinear( value );

			} else if ( inputEncoding == 2 ) {

				return RGBEToLinear( value );

			} else if ( inputEncoding == 3 ) {

				return RGBMToLinear( value, 7.0 );

			} else if ( inputEncoding == 4 ) {

				return RGBMToLinear( value, 16.0 );

			} else if ( inputEncoding == 5 ) {

				return RGBDToLinear( value, 256.0 );

			} else {

				return GammaToLinear( value, 2.2 );

			}

		}

		vec4 linearToOutputTexel( vec4 value ) {

			if ( outputEncoding == 0 ) {

				return value;

			} else if ( outputEncoding == 1 ) {

				return LinearTosRGB( value );

			} else if ( outputEncoding == 2 ) {

				return LinearToRGBE( value );

			} else if ( outputEncoding == 3 ) {

				return LinearToRGBM( value, 7.0 );

			} else if ( outputEncoding == 4 ) {

				return LinearToRGBM( value, 16.0 );

			} else if ( outputEncoding == 5 ) {

				return LinearToRGBD( value, 256.0 );

			} else {

				return LinearToGamma( value, 2.2 );

			}

		}

		vec4 envMapTexelToLinear( vec4 color ) {

			return inputTexelToLinear( color );

		}
	`}function Xh(E){let e=new WeakMap,l=null;function _(y){const S=y.target;S.removeEventListener("dispose",_);const O=e.get(S);O!==void 0&&(e.delete(S),O.dispose())}return{get:function(y){if(y&&y.isTexture&&y.isRenderTargetTexture===!1){const S=y.mapping,O=S===303||S===304,k=S===301||S===302;if(O||k){if(e.has(y))return e.get(y).texture;{const N=y.image;if(O&&N&&N.height>0||k&&N&&function(G){let $=0;const K=6;for(let ie=0;ie<K;ie++)G[ie]!==void 0&&$++;return $===K}(N)){const G=E.getRenderTarget();l===null&&(l=new Ou(E));const $=O?l.fromEquirectangular(y):l.fromCubemap(y);return e.set(y,$),E.setRenderTarget(G),y.addEventListener("dispose",_),$.texture}return null}}}return y},dispose:function(){e=new WeakMap,l!==null&&(l.dispose(),l=null)}}}function nc(E){const e={};function l(_){if(e[_]!==void 0)return e[_];let y;switch(_){case"WEBGL_depth_texture":y=E.getExtension("WEBGL_depth_texture")||E.getExtension("MOZ_WEBGL_depth_texture")||E.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":y=E.getExtension("EXT_texture_filter_anisotropic")||E.getExtension("MOZ_EXT_texture_filter_anisotropic")||E.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":y=E.getExtension("WEBGL_compressed_texture_s3tc")||E.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||E.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":y=E.getExtension("WEBGL_compressed_texture_pvrtc")||E.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:y=E.getExtension(_)}return e[_]=y,y}return{has:function(_){return l(_)!==null},init:function(_){_.isWebGL2?l("EXT_color_buffer_float"):(l("WEBGL_depth_texture"),l("OES_texture_float"),l("OES_texture_half_float"),l("OES_texture_half_float_linear"),l("OES_standard_derivatives"),l("OES_element_index_uint"),l("OES_vertex_array_object"),l("ANGLE_instanced_arrays")),l("OES_texture_float_linear"),l("EXT_color_buffer_half_float")},get:function(_){const y=l(_);return y===null&&console.warn("THREE.WebGLRenderer: "+_+" extension not supported."),y}}}function fh(E,e,l,_){const y={},S=new WeakMap;function O(N){const G=N.target;G.index!==null&&e.remove(G.index);for(const K in G.attributes)e.remove(G.attributes[K]);G.removeEventListener("dispose",O),delete y[G.id];const $=S.get(G);$&&(e.remove($),S.delete(G)),_.releaseStatesOfGeometry(G),G.isInstancedBufferGeometry===!0&&delete G._maxInstanceCount,l.memory.geometries--}function k(N){const G=[],$=N.index,K=N.attributes.position;let ie=0;if($!==null){const ye=$.array;ie=$.version;for(let Se=0,_e=ye.length;Se<_e;Se+=3){const $e=ye[Se+0],st=ye[Se+1],ot=ye[Se+2];G.push($e,st,st,ot,ot,$e)}}else{const ye=K.array;ie=K.version;for(let Se=0,_e=ye.length/3-1;Se<_e;Se+=3){const $e=Se+0,st=Se+1,ot=Se+2;G.push($e,st,st,ot,ot,$e)}}const ne=new(Cu(G)>65535?_a:al)(G,1);ne.version=ie;const ue=S.get(N);ue&&e.remove(ue),S.set(N,ne)}return{get:function(N,G){return y[G.id]===!0||(G.addEventListener("dispose",O),y[G.id]=!0,l.memory.geometries++),G},update:function(N){const G=N.attributes;for(const K in G)e.update(G[K],34962);const $=N.morphAttributes;for(const K in $){const ie=$[K];for(let ne=0,ue=ie.length;ne<ue;ne++)e.update(ie[ne],34962)}},getWireframeAttribute:function(N){const G=S.get(N);if(G){const $=N.index;$!==null&&G.version<$.version&&k(N)}else k(N);return S.get(N)}}}function ua(E,e,l,_){const y=_.isWebGL2;let S,O,k;this.setMode=function(N){S=N},this.setIndex=function(N){O=N.type,k=N.bytesPerElement},this.render=function(N,G){E.drawElements(S,G,O,N*k),l.update(G,S,1)},this.renderInstances=function(N,G,$){if($===0)return;let K,ie;if(y)K=E,ie="drawElementsInstanced";else if(K=e.get("ANGLE_instanced_arrays"),ie="drawElementsInstancedANGLE",K===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");K[ie](S,G,O,N*k,$),l.update(G,S,$)}}function Yh(E){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(l,_,y){switch(e.calls++,_){case 4:e.triangles+=y*(l/3);break;case 1:e.lines+=y*(l/2);break;case 3:e.lines+=y*(l-1);break;case 2:e.lines+=y*l;break;case 0:e.points+=y*l;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",_)}}}}function $h(E,e){return E[0]-e[0]}function rc(E,e){return Math.abs(e[1])-Math.abs(E[1])}function Kh(E){const e={},l=new Float32Array(8),_=[];for(let y=0;y<8;y++)_[y]=[y,0];return{update:function(y,S,O,k){const N=y.morphTargetInfluences,G=N===void 0?0:N.length;let $=e[S.id];if($===void 0||$.length!==G){$=[];for(let ye=0;ye<G;ye++)$[ye]=[ye,0];e[S.id]=$}for(let ye=0;ye<G;ye++){const Se=$[ye];Se[0]=ye,Se[1]=N[ye]}$.sort(rc);for(let ye=0;ye<8;ye++)ye<G&&$[ye][1]?(_[ye][0]=$[ye][0],_[ye][1]=$[ye][1]):(_[ye][0]=Number.MAX_SAFE_INTEGER,_[ye][1]=0);_.sort($h);const K=S.morphAttributes.position,ie=S.morphAttributes.normal;let ne=0;for(let ye=0;ye<8;ye++){const Se=_[ye],_e=Se[0],$e=Se[1];_e!==Number.MAX_SAFE_INTEGER&&$e?(K&&S.getAttribute("morphTarget"+ye)!==K[_e]&&S.setAttribute("morphTarget"+ye,K[_e]),ie&&S.getAttribute("morphNormal"+ye)!==ie[_e]&&S.setAttribute("morphNormal"+ye,ie[_e]),l[ye]=$e,ne+=$e):(K&&S.hasAttribute("morphTarget"+ye)===!0&&S.deleteAttribute("morphTarget"+ye),ie&&S.hasAttribute("morphNormal"+ye)===!0&&S.deleteAttribute("morphNormal"+ye),l[ye]=0)}const ue=S.morphTargetsRelative?1:1-ne;k.getUniforms().setValue(E,"morphTargetBaseInfluence",ue),k.getUniforms().setValue(E,"morphTargetInfluences",l)}}}function zd(E,e,l,_){let y=new WeakMap;function S(O){const k=O.target;k.removeEventListener("dispose",S),l.remove(k.instanceMatrix),k.instanceColor!==null&&l.remove(k.instanceColor)}return{update:function(O){const k=_.render.frame,N=O.geometry,G=e.get(O,N);return y.get(G)!==k&&(e.update(G),y.set(G,k)),O.isInstancedMesh&&(O.hasEventListener("dispose",S)===!1&&O.addEventListener("dispose",S),l.update(O.instanceMatrix,34962),O.instanceColor!==null&&l.update(O.instanceColor,34962)),G},dispose:function(){y=new WeakMap}}}class Za extends Ca{constructor(e=null,l=1,_=1,y=1){super(null),this.image={data:e,width:l,height:_,depth:y},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Za.prototype.isDataTexture2DArray=!0;class ph extends Ca{constructor(e=null,l=1,_=1,y=1){super(null),this.image={data:e,width:l,height:_,depth:y},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}ph.prototype.isDataTexture3D=!0;const Cl=new Ca,Gl=new Za,ku=new ph,Nc=new Ru,Uc=[],mh=[],Jh=new Float32Array(16),gh=new Float32Array(9),gf=new Float32Array(4);function ls(E,e,l){const _=E[0];if(_<=0||_>0)return E;const y=e*l;let S=Uc[y];if(S===void 0&&(S=new Float32Array(y),Uc[y]=S),e!==0){_.toArray(S,0);for(let O=1,k=0;O!==e;++O)k+=l,E[O].toArray(S,k)}return S}function cs(E,e){if(E.length!==e.length)return!1;for(let l=0,_=E.length;l<_;l++)if(E[l]!==e[l])return!1;return!0}function pa(E,e){for(let l=0,_=e.length;l<_;l++)E[l]=e[l]}function Ll(E,e){let l=mh[e];l===void 0&&(l=new Int32Array(e),mh[e]=l);for(let _=0;_!==e;++_)l[_]=E.allocateTextureUnit();return l}function xc(E,e){const l=this.cache;l[0]!==e&&(E.uniform1f(this.addr,e),l[0]=e)}function _f(E,e){const l=this.cache;if(e.x!==void 0)l[0]===e.x&&l[1]===e.y||(E.uniform2f(this.addr,e.x,e.y),l[0]=e.x,l[1]=e.y);else{if(cs(l,e))return;E.uniform2fv(this.addr,e),pa(l,e)}}function au(E,e){const l=this.cache;if(e.x!==void 0)l[0]===e.x&&l[1]===e.y&&l[2]===e.z||(E.uniform3f(this.addr,e.x,e.y,e.z),l[0]=e.x,l[1]=e.y,l[2]=e.z);else if(e.r!==void 0)l[0]===e.r&&l[1]===e.g&&l[2]===e.b||(E.uniform3f(this.addr,e.r,e.g,e.b),l[0]=e.r,l[1]=e.g,l[2]=e.b);else{if(cs(l,e))return;E.uniform3fv(this.addr,e),pa(l,e)}}function Xf(E,e){const l=this.cache;if(e.x!==void 0)l[0]===e.x&&l[1]===e.y&&l[2]===e.z&&l[3]===e.w||(E.uniform4f(this.addr,e.x,e.y,e.z,e.w),l[0]=e.x,l[1]=e.y,l[2]=e.z,l[3]=e.w);else{if(cs(l,e))return;E.uniform4fv(this.addr,e),pa(l,e)}}function Yf(E,e){const l=this.cache,_=e.elements;if(_===void 0){if(cs(l,e))return;E.uniformMatrix2fv(this.addr,!1,e),pa(l,e)}else{if(cs(l,_))return;gf.set(_),E.uniformMatrix2fv(this.addr,!1,gf),pa(l,_)}}function _h(E,e){const l=this.cache,_=e.elements;if(_===void 0){if(cs(l,e))return;E.uniformMatrix3fv(this.addr,!1,e),pa(l,e)}else{if(cs(l,_))return;gh.set(_),E.uniformMatrix3fv(this.addr,!1,gh),pa(l,_)}}function Pd(E,e){const l=this.cache,_=e.elements;if(_===void 0){if(cs(l,e))return;E.uniformMatrix4fv(this.addr,!1,e),pa(l,e)}else{if(cs(l,_))return;Jh.set(_),E.uniformMatrix4fv(this.addr,!1,Jh),pa(l,_)}}function Od(E,e){const l=this.cache;l[0]!==e&&(E.uniform1i(this.addr,e),l[0]=e)}function su(E,e){const l=this.cache;cs(l,e)||(E.uniform2iv(this.addr,e),pa(l,e))}function Fp(E,e){const l=this.cache;cs(l,e)||(E.uniform3iv(this.addr,e),pa(l,e))}function gp(E,e){const l=this.cache;cs(l,e)||(E.uniform4iv(this.addr,e),pa(l,e))}function kp(E,e){const l=this.cache;l[0]!==e&&(E.uniform1ui(this.addr,e),l[0]=e)}function $f(E,e){const l=this.cache;cs(l,e)||(E.uniform2uiv(this.addr,e),pa(l,e))}function Np(E,e){const l=this.cache;cs(l,e)||(E.uniform3uiv(this.addr,e),pa(l,e))}function yf(E,e){const l=this.cache;cs(l,e)||(E.uniform4uiv(this.addr,e),pa(l,e))}function Kf(E,e,l){const _=this.cache,y=l.allocateTextureUnit();_[0]!==y&&(E.uniform1i(this.addr,y),_[0]=y),l.safeSetTexture2D(e||Cl,y)}function yh(E,e,l){const _=this.cache,y=l.allocateTextureUnit();_[0]!==y&&(E.uniform1i(this.addr,y),_[0]=y),l.setTexture3D(e||ku,y)}function vh(E,e,l){const _=this.cache,y=l.allocateTextureUnit();_[0]!==y&&(E.uniform1i(this.addr,y),_[0]=y),l.safeSetTextureCube(e||Nc,y)}function Nu(E,e,l){const _=this.cache,y=l.allocateTextureUnit();_[0]!==y&&(E.uniform1i(this.addr,y),_[0]=y),l.setTexture2DArray(e||Gl,y)}function Qh(E,e){E.uniform1fv(this.addr,e)}function vf(E,e){const l=ls(e,this.size,2);E.uniform2fv(this.addr,l)}function _p(E,e){const l=ls(e,this.size,3);E.uniform3fv(this.addr,l)}function Jf(E,e){const l=ls(e,this.size,4);E.uniform4fv(this.addr,l)}function Hl(E,e){const l=ls(e,this.size,4);E.uniformMatrix2fv(this.addr,!1,l)}function Qf(E,e){const l=ls(e,this.size,9);E.uniformMatrix3fv(this.addr,!1,l)}function Xo(E,e){const l=ls(e,this.size,16);E.uniformMatrix4fv(this.addr,!1,l)}function ed(E,e){E.uniform1iv(this.addr,e)}function Bd(E,e){E.uniform2iv(this.addr,e)}function ep(E,e){E.uniform3iv(this.addr,e)}function Fd(E,e){E.uniform4iv(this.addr,e)}function ml(E,e){E.uniform1uiv(this.addr,e)}function bc(E,e){E.uniform2uiv(this.addr,e)}function xh(E,e){E.uniform3uiv(this.addr,e)}function tp(E,e){E.uniform4uiv(this.addr,e)}function ac(E,e,l){const _=e.length,y=Ll(l,_);E.uniform1iv(this.addr,y);for(let S=0;S!==_;++S)l.safeSetTexture2D(e[S]||Cl,y[S])}function Uu(E,e,l){const _=e.length,y=Ll(l,_);E.uniform1iv(this.addr,y);for(let S=0;S!==_;++S)l.safeSetTextureCube(e[S]||Nc,y[S])}function Bo(E,e,l){this.id=E,this.addr=l,this.cache=[],this.setValue=function(_){switch(_){case 5126:return xc;case 35664:return _f;case 35665:return au;case 35666:return Xf;case 35674:return Yf;case 35675:return _h;case 35676:return Pd;case 5124:case 35670:return Od;case 35667:case 35671:return su;case 35668:case 35672:return Fp;case 35669:case 35673:return gp;case 5125:return kp;case 36294:return $f;case 36295:return Np;case 36296:return yf;case 35678:case 36198:case 36298:case 36306:case 35682:return Kf;case 35679:case 36299:case 36307:return yh;case 35680:case 36300:case 36308:case 36293:return vh;case 36289:case 36303:case 36311:case 36292:return Nu}}(e.type)}function kd(E,e,l){this.id=E,this.addr=l,this.cache=[],this.size=e.size,this.setValue=function(_){switch(_){case 5126:return Qh;case 35664:return vf;case 35665:return _p;case 35666:return Jf;case 35674:return Hl;case 35675:return Qf;case 35676:return Xo;case 5124:case 35670:return ed;case 35667:case 35671:return Bd;case 35668:case 35672:return ep;case 35669:case 35673:return Fd;case 5125:return ml;case 36294:return bc;case 36295:return xh;case 36296:return tp;case 35678:case 36198:case 36298:case 36306:case 35682:return ac;case 35680:case 36300:case 36308:case 36293:return Uu}}(e.type)}function yp(E){this.id=E,this.seq=[],this.map={}}kd.prototype.updateCache=function(E){const e=this.cache;E instanceof Float32Array&&e.length!==E.length&&(this.cache=new Float32Array(E.length)),pa(e,E)},yp.prototype.setValue=function(E,e,l){const _=this.seq;for(let y=0,S=_.length;y!==S;++y){const O=_[y];O.setValue(E,e[O.id],l)}};const Nd=/(\w+)(\])?(\[|\.)?/g;function td(E,e){E.seq.push(e),E.map[e.id]=e}function Ws(E,e,l){const _=E.name,y=_.length;for(Nd.lastIndex=0;;){const S=Nd.exec(_),O=Nd.lastIndex;let k=S[1];const N=S[2]==="]",G=S[3];if(N&&(k|=0),G===void 0||G==="["&&O+2===y){td(l,G===void 0?new Bo(k,E,e):new kd(k,E,e));break}{let $=l.map[k];$===void 0&&($=new yp(k),td(l,$)),l=$}}}function sc(E,e){this.seq=[],this.map={};const l=E.getProgramParameter(e,35718);for(let _=0;_<l;++_){const y=E.getActiveUniform(e,_);Ws(y,E.getUniformLocation(e,y.name),this)}}function ou(E,e,l){const _=E.createShader(e);return E.shaderSource(_,l),E.compileShader(_),_}sc.prototype.setValue=function(E,e,l,_){const y=this.map[e];y!==void 0&&y.setValue(E,l,_)},sc.prototype.setOptional=function(E,e,l){const _=e[l];_!==void 0&&this.setValue(E,l,_)},sc.upload=function(E,e,l,_){for(let y=0,S=e.length;y!==S;++y){const O=e[y],k=l[O.id];k.needsUpdate!==!1&&O.setValue(E,k.value,_)}},sc.seqWithValue=function(E,e){const l=[];for(let _=0,y=E.length;_!==y;++_){const S=E[_];S.id in e&&l.push(S)}return l};let Ud=0;function bh(E){switch(E){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",E),["Linear","( value )"]}}function Vc(E,e,l){const _=E.getShaderParameter(e,35713),y=E.getShaderInfoLog(e).trim();return _&&y===""?"":l.toUpperCase()+`

`+y+`

`+function(S){const O=S.split(`
`);for(let k=0;k<O.length;k++)O[k]=k+1+": "+O[k];return O.join(`
`)}(E.getShaderSource(e))}function oc(E,e){const l=bh(e);return"vec4 "+E+"( vec4 value ) { return "+l[0]+"ToLinear"+l[1]+"; }"}function Up(E,e){const l=bh(e);return"vec4 "+E+"( vec4 value ) { return LinearTo"+l[0]+l[1]+"; }"}function Vp(E,e){let l;switch(e){case 1:l="Linear";break;case 2:l="Reinhard";break;case 3:l="OptimizedCineon";break;case 4:l="ACESFilmic";break;case 5:l="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),l="Linear"}return"vec3 "+E+"( vec3 color ) { return "+l+"ToneMapping( color ); }"}function Gc(E){return E!==""}function Vd(E,e){return E.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function kn(E,e){return E.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const xf=/^[ \t]*#include +<([\w\d./]+)>/gm;function wh(E){return E.replace(xf,Vu)}function Vu(E,e){const l=Kr[e];if(l===void 0)throw new Error("Can not resolve #include <"+e+">");return wh(l)}const jl=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,un=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function ys(E){return E.replace(un,bf).replace(jl,Mo)}function Mo(E,e,l,_){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),bf(E,e,l,_)}function bf(E,e,l,_){let y="";for(let S=parseInt(e);S<parseInt(l);S++)y+=_.replace(/\[\s*i\s*\]/g,"[ "+S+" ]").replace(/UNROLLED_LOOP_INDEX/g,S);return y}function lu(E){let e="precision "+E.precision+` float;
precision `+E.precision+" int;";return E.precision==="highp"?e+=`
#define HIGH_PRECISION`:E.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:E.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Gu(E,e,l,_){const y=E.getContext(),S=l.defines;let O=l.vertexShader,k=l.fragmentShader;const N=function(Ti){let Ki="SHADOWMAP_TYPE_BASIC";return Ti.shadowMapType===1?Ki="SHADOWMAP_TYPE_PCF":Ti.shadowMapType===2?Ki="SHADOWMAP_TYPE_PCF_SOFT":Ti.shadowMapType===3&&(Ki="SHADOWMAP_TYPE_VSM"),Ki}(l),G=function(Ti){let Ki="ENVMAP_TYPE_CUBE";if(Ti.envMap)switch(Ti.envMapMode){case 301:case 302:Ki="ENVMAP_TYPE_CUBE";break;case 306:case 307:Ki="ENVMAP_TYPE_CUBE_UV"}return Ki}(l),$=function(Ti){let Ki="ENVMAP_MODE_REFLECTION";if(Ti.envMap)switch(Ti.envMapMode){case 302:case 307:Ki="ENVMAP_MODE_REFRACTION"}return Ki}(l),K=function(Ti){let Ki="ENVMAP_BLENDING_NONE";if(Ti.envMap)switch(Ti.combine){case 0:Ki="ENVMAP_BLENDING_MULTIPLY";break;case 1:Ki="ENVMAP_BLENDING_MIX";break;case 2:Ki="ENVMAP_BLENDING_ADD"}return Ki}(l),ie=E.gammaFactor>0?E.gammaFactor:1,ne=l.isWebGL2?"":function(Ti){return[Ti.extensionDerivatives||Ti.envMapCubeUV||Ti.bumpMap||Ti.tangentSpaceNormalMap||Ti.clearcoatNormalMap||Ti.flatShading||Ti.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(Ti.extensionFragDepth||Ti.logarithmicDepthBuffer)&&Ti.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",Ti.extensionDrawBuffers&&Ti.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(Ti.extensionShaderTextureLOD||Ti.envMap||Ti.transmission)&&Ti.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Gc).join(`
`)}(l),ue=function(Ti){const Ki=[];for(const Bi in Ti){const Zi=Ti[Bi];Zi!==!1&&Ki.push("#define "+Bi+" "+Zi)}return Ki.join(`
`)}(S),ye=y.createProgram();let Se,_e,$e=l.glslVersion?"#version "+l.glslVersion+`
`:"";l.isRawShaderMaterial?(Se=[ue].filter(Gc).join(`
`),Se.length>0&&(Se+=`
`),_e=[ne,ue].filter(Gc).join(`
`),_e.length>0&&(_e+=`
`)):(Se=[lu(l),"#define SHADER_NAME "+l.shaderName,ue,l.instancing?"#define USE_INSTANCING":"",l.instancingColor?"#define USE_INSTANCING_COLOR":"",l.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+ie,"#define MAX_BONES "+l.maxBones,l.useFog&&l.fog?"#define USE_FOG":"",l.useFog&&l.fogExp2?"#define FOG_EXP2":"",l.map?"#define USE_MAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+$:"",l.lightMap?"#define USE_LIGHTMAP":"",l.aoMap?"#define USE_AOMAP":"",l.emissiveMap?"#define USE_EMISSIVEMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.normalMap&&l.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",l.normalMap&&l.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",l.clearcoatMap?"#define USE_CLEARCOATMAP":"",l.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",l.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",l.displacementMap&&l.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",l.specularTintMap?"#define USE_SPECULARTINTMAP":"",l.roughnessMap?"#define USE_ROUGHNESSMAP":"",l.metalnessMap?"#define USE_METALNESSMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.transmission?"#define USE_TRANSMISSION":"",l.transmissionMap?"#define USE_TRANSMISSIONMAP":"",l.thicknessMap?"#define USE_THICKNESSMAP":"",l.vertexTangents?"#define USE_TANGENT":"",l.vertexColors?"#define USE_COLOR":"",l.vertexAlphas?"#define USE_COLOR_ALPHA":"",l.vertexUvs?"#define USE_UV":"",l.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",l.flatShading?"#define FLAT_SHADED":"",l.skinning?"#define USE_SKINNING":"",l.useVertexTexture?"#define BONE_TEXTURE":"",l.morphTargets?"#define USE_MORPHTARGETS":"",l.morphNormals&&l.flatShading===!1?"#define USE_MORPHNORMALS":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+N:"",l.sizeAttenuation?"#define USE_SIZEATTENUATION":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",l.logarithmicDepthBuffer&&l.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Gc).join(`
`),_e=[ne,lu(l),"#define SHADER_NAME "+l.shaderName,ue,"#define GAMMA_FACTOR "+ie,l.useFog&&l.fog?"#define USE_FOG":"",l.useFog&&l.fogExp2?"#define FOG_EXP2":"",l.map?"#define USE_MAP":"",l.matcap?"#define USE_MATCAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+G:"",l.envMap?"#define "+$:"",l.envMap?"#define "+K:"",l.lightMap?"#define USE_LIGHTMAP":"",l.aoMap?"#define USE_AOMAP":"",l.emissiveMap?"#define USE_EMISSIVEMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.normalMap&&l.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",l.normalMap&&l.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",l.clearcoat?"#define USE_CLEARCOAT":"",l.clearcoatMap?"#define USE_CLEARCOATMAP":"",l.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",l.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",l.specularTintMap?"#define USE_SPECULARTINTMAP":"",l.roughnessMap?"#define USE_ROUGHNESSMAP":"",l.metalnessMap?"#define USE_METALNESSMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.alphaTest?"#define USE_ALPHATEST":"",l.sheenTint?"#define USE_SHEEN":"",l.transmission?"#define USE_TRANSMISSION":"",l.transmissionMap?"#define USE_TRANSMISSIONMAP":"",l.thicknessMap?"#define USE_THICKNESSMAP":"",l.vertexTangents?"#define USE_TANGENT":"",l.vertexColors||l.instancingColor?"#define USE_COLOR":"",l.vertexAlphas?"#define USE_COLOR_ALPHA":"",l.vertexUvs?"#define USE_UV":"",l.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",l.gradientMap?"#define USE_GRADIENTMAP":"",l.flatShading?"#define FLAT_SHADED":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+N:"",l.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",l.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",l.logarithmicDepthBuffer&&l.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(l.extensionShaderTextureLOD||l.envMap)&&l.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",l.toneMapping!==0?"#define TONE_MAPPING":"",l.toneMapping!==0?Kr.tonemapping_pars_fragment:"",l.toneMapping!==0?Vp("toneMapping",l.toneMapping):"",l.dithering?"#define DITHERING":"",l.format===1022?"#define OPAQUE":"",Kr.encodings_pars_fragment,l.map?oc("mapTexelToLinear",l.mapEncoding):"",l.matcap?oc("matcapTexelToLinear",l.matcapEncoding):"",l.envMap?oc("envMapTexelToLinear",l.envMapEncoding):"",l.emissiveMap?oc("emissiveMapTexelToLinear",l.emissiveMapEncoding):"",l.specularTintMap?oc("specularTintMapTexelToLinear",l.specularTintMapEncoding):"",l.lightMap?oc("lightMapTexelToLinear",l.lightMapEncoding):"",Up("linearToOutputTexel",l.outputEncoding),l.depthPacking?"#define DEPTH_PACKING "+l.depthPacking:"",`
`].filter(Gc).join(`
`)),O=wh(O),O=Vd(O,l),O=kn(O,l),k=wh(k),k=Vd(k,l),k=kn(k,l),O=ys(O),k=ys(k),l.isWebGL2&&l.isRawShaderMaterial!==!0&&($e=`#version 300 es
`,Se=["#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+Se,_e=["#define varying in",l.glslVersion===$t?"":"out highp vec4 pc_fragColor;",l.glslVersion===$t?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+_e);const st=$e+_e+k,ot=ou(y,35633,$e+Se+O),Lt=ou(y,35632,st);if(y.attachShader(ye,ot),y.attachShader(ye,Lt),l.index0AttributeName!==void 0?y.bindAttribLocation(ye,0,l.index0AttributeName):l.morphTargets===!0&&y.bindAttribLocation(ye,0,"position"),y.linkProgram(ye),E.debug.checkShaderErrors){const Ti=y.getProgramInfoLog(ye).trim(),Ki=y.getShaderInfoLog(ot).trim(),Bi=y.getShaderInfoLog(Lt).trim();let Zi=!0,hr=!0;if(y.getProgramParameter(ye,35714)===!1){Zi=!1;const Gn=Vc(y,ot,"vertex"),gn=Vc(y,Lt,"fragment");console.error("THREE.WebGLProgram: Shader Error "+y.getError()+" - VALIDATE_STATUS "+y.getProgramParameter(ye,35715)+`

Program Info Log: `+Ti+`
`+Gn+`
`+gn)}else Ti!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Ti):Ki!==""&&Bi!==""||(hr=!1);hr&&(this.diagnostics={runnable:Zi,programLog:Ti,vertexShader:{log:Ki,prefix:Se},fragmentShader:{log:Bi,prefix:_e}})}let Bt,di;return y.deleteShader(ot),y.deleteShader(Lt),this.getUniforms=function(){return Bt===void 0&&(Bt=new sc(y,ye)),Bt},this.getAttributes=function(){return di===void 0&&(di=function(Ti,Ki){const Bi={},Zi=Ti.getProgramParameter(Ki,35721);for(let hr=0;hr<Zi;hr++){const Gn=Ti.getActiveAttrib(Ki,hr),gn=Gn.name;let Yn=1;Gn.type===35674&&(Yn=2),Gn.type===35675&&(Yn=3),Gn.type===35676&&(Yn=4),Bi[gn]={type:Gn.type,location:Ti.getAttribLocation(Ki,gn),locationSize:Yn}}return Bi}(y,ye)),di},this.destroy=function(){_.releaseStatesOfProgram(this),y.deleteProgram(ye),this.program=void 0},this.name=l.shaderName,this.id=Ud++,this.cacheKey=e,this.usedTimes=1,this.program=ye,this.vertexShader=ot,this.fragmentShader=Lt,this}function Gd(E,e,l,_,y,S,O){const k=[],N=y.isWebGL2,G=y.logarithmicDepthBuffer,$=y.floatVertexTextures,K=y.maxVertexUniforms,ie=y.vertexTextures;let ne=y.precision;const ue={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},ye=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","specularIntensityMap","specularTintMap","specularTintMapEncoding","roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","sheenTint","transmission","transmissionMap","thicknessMap"];function Se(_e){let $e;return _e&&_e.isTexture?$e=_e.encoding:_e&&_e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),$e=_e.texture.encoding):$e=3e3,$e}return{getParameters:function(_e,$e,st,ot,Lt){const Bt=ot.fog,di=_e.isMeshStandardMaterial?ot.environment:null,Ti=(_e.isMeshStandardMaterial?l:e).get(_e.envMap||di),Ki=ue[_e.type],Bi=Lt.isSkinnedMesh?function(Mr){const Cr=Mr.skeleton.bones;if($)return 1024;{const kr=K,Zr=Math.floor((kr-20)/4),la=Math.min(Zr,Cr.length);return la<Cr.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+Cr.length+" bones. This GPU supports "+la+"."),0):la}}(Lt):0;let Zi,hr;if(_e.precision!==null&&(ne=y.getMaxPrecision(_e.precision),ne!==_e.precision&&console.warn("THREE.WebGLProgram.getParameters:",_e.precision,"not supported, using",ne,"instead.")),Ki){const Mr=Zo[Ki];Zi=Mr.vertexShader,hr=Mr.fragmentShader}else Zi=_e.vertexShader,hr=_e.fragmentShader;const Gn=E.getRenderTarget(),gn=_e.alphaTest>0,Yn=_e.clearcoat>0;return{isWebGL2:N,shaderID:Ki,shaderName:_e.type,vertexShader:Zi,fragmentShader:hr,defines:_e.defines,isRawShaderMaterial:_e.isRawShaderMaterial===!0,glslVersion:_e.glslVersion,precision:ne,instancing:Lt.isInstancedMesh===!0,instancingColor:Lt.isInstancedMesh===!0&&Lt.instanceColor!==null,supportsVertexTextures:ie,outputEncoding:Gn!==null?Se(Gn.texture):E.outputEncoding,map:!!_e.map,mapEncoding:Se(_e.map),matcap:!!_e.matcap,matcapEncoding:Se(_e.matcap),envMap:!!Ti,envMapMode:Ti&&Ti.mapping,envMapEncoding:Se(Ti),envMapCubeUV:!!Ti&&(Ti.mapping===306||Ti.mapping===307),lightMap:!!_e.lightMap,lightMapEncoding:Se(_e.lightMap),aoMap:!!_e.aoMap,emissiveMap:!!_e.emissiveMap,emissiveMapEncoding:Se(_e.emissiveMap),bumpMap:!!_e.bumpMap,normalMap:!!_e.normalMap,objectSpaceNormalMap:_e.normalMapType===1,tangentSpaceNormalMap:_e.normalMapType===0,clearcoat:Yn,clearcoatMap:Yn&&!!_e.clearcoatMap,clearcoatRoughnessMap:Yn&&!!_e.clearcoatRoughnessMap,clearcoatNormalMap:Yn&&!!_e.clearcoatNormalMap,displacementMap:!!_e.displacementMap,roughnessMap:!!_e.roughnessMap,metalnessMap:!!_e.metalnessMap,specularMap:!!_e.specularMap,specularIntensityMap:!!_e.specularIntensityMap,specularTintMap:!!_e.specularTintMap,specularTintMapEncoding:Se(_e.specularTintMap),alphaMap:!!_e.alphaMap,alphaTest:gn,gradientMap:!!_e.gradientMap,sheenTint:!!_e.sheenTint&&(_e.sheenTint.r>0||_e.sheenTint.g>0||_e.sheenTint.b>0),transmission:_e.transmission>0,transmissionMap:!!_e.transmissionMap,thicknessMap:!!_e.thicknessMap,combine:_e.combine,vertexTangents:!!_e.normalMap&&!!Lt.geometry&&!!Lt.geometry.attributes.tangent,vertexColors:_e.vertexColors,vertexAlphas:_e.vertexColors===!0&&!!Lt.geometry&&!!Lt.geometry.attributes.color&&Lt.geometry.attributes.color.itemSize===4,vertexUvs:!!(_e.map||_e.bumpMap||_e.normalMap||_e.specularMap||_e.alphaMap||_e.emissiveMap||_e.roughnessMap||_e.metalnessMap||_e.clearcoatMap||_e.clearcoatRoughnessMap||_e.clearcoatNormalMap||_e.displacementMap||_e.transmissionMap||_e.thicknessMap||_e.specularIntensityMap||_e.specularTintMap),uvsVertexOnly:!(_e.map||_e.bumpMap||_e.normalMap||_e.specularMap||_e.alphaMap||_e.emissiveMap||_e.roughnessMap||_e.metalnessMap||_e.clearcoatNormalMap||_e.transmission>0||_e.transmissionMap||_e.thicknessMap||_e.specularIntensityMap||_e.specularTintMap||!_e.displacementMap),fog:!!Bt,useFog:_e.fog,fogExp2:Bt&&Bt.isFogExp2,flatShading:!!_e.flatShading,sizeAttenuation:_e.sizeAttenuation,logarithmicDepthBuffer:G,skinning:Lt.isSkinnedMesh===!0&&Bi>0,maxBones:Bi,useVertexTexture:$,morphTargets:!!Lt.geometry&&!!Lt.geometry.morphAttributes.position,morphNormals:!!Lt.geometry&&!!Lt.geometry.morphAttributes.normal,numDirLights:$e.directional.length,numPointLights:$e.point.length,numSpotLights:$e.spot.length,numRectAreaLights:$e.rectArea.length,numHemiLights:$e.hemi.length,numDirLightShadows:$e.directionalShadowMap.length,numPointLightShadows:$e.pointShadowMap.length,numSpotLightShadows:$e.spotShadowMap.length,numClippingPlanes:O.numPlanes,numClipIntersection:O.numIntersection,format:_e.format,dithering:_e.dithering,shadowMapEnabled:E.shadowMap.enabled&&st.length>0,shadowMapType:E.shadowMap.type,toneMapping:_e.toneMapped?E.toneMapping:0,physicallyCorrectLights:E.physicallyCorrectLights,premultipliedAlpha:_e.premultipliedAlpha,doubleSided:_e.side===2,flipSided:_e.side===1,depthPacking:_e.depthPacking!==void 0&&_e.depthPacking,index0AttributeName:_e.index0AttributeName,extensionDerivatives:_e.extensions&&_e.extensions.derivatives,extensionFragDepth:_e.extensions&&_e.extensions.fragDepth,extensionDrawBuffers:_e.extensions&&_e.extensions.drawBuffers,extensionShaderTextureLOD:_e.extensions&&_e.extensions.shaderTextureLOD,rendererExtensionFragDepth:N||_.has("EXT_frag_depth"),rendererExtensionDrawBuffers:N||_.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:N||_.has("EXT_shader_texture_lod"),customProgramCacheKey:_e.customProgramCacheKey()}},getProgramCacheKey:function(_e){const $e=[];if(_e.shaderID?$e.push(_e.shaderID):($e.push(_e.fragmentShader),$e.push(_e.vertexShader)),_e.defines!==void 0)for(const st in _e.defines)$e.push(st),$e.push(_e.defines[st]);if(_e.isRawShaderMaterial===!1){for(let st=0;st<ye.length;st++)$e.push(_e[ye[st]]);$e.push(E.outputEncoding),$e.push(E.gammaFactor)}return $e.push(_e.customProgramCacheKey),$e.join()},getUniforms:function(_e){const $e=ue[_e.type];let st;if($e){const ot=Zo[$e];st=br.clone(ot.uniforms)}else st=_e.uniforms;return st},acquireProgram:function(_e,$e){let st;for(let ot=0,Lt=k.length;ot<Lt;ot++){const Bt=k[ot];if(Bt.cacheKey===$e){st=Bt,++st.usedTimes;break}}return st===void 0&&(st=new Gu(E,$e,_e,S),k.push(st)),st},releaseProgram:function(_e){if(--_e.usedTimes==0){const $e=k.indexOf(_e);k[$e]=k[k.length-1],k.pop(),_e.destroy()}},programs:k}}function Hd(){let E=new WeakMap;return{get:function(e){let l=E.get(e);return l===void 0&&(l={},E.set(e,l)),l},remove:function(e){E.delete(e)},update:function(e,l,_){E.get(e)[l]=_},dispose:function(){E=new WeakMap}}}function Mh(E,e){return E.groupOrder!==e.groupOrder?E.groupOrder-e.groupOrder:E.renderOrder!==e.renderOrder?E.renderOrder-e.renderOrder:E.program!==e.program?E.program.id-e.program.id:E.material.id!==e.material.id?E.material.id-e.material.id:E.z!==e.z?E.z-e.z:E.id-e.id}function jd(E,e){return E.groupOrder!==e.groupOrder?E.groupOrder-e.groupOrder:E.renderOrder!==e.renderOrder?E.renderOrder-e.renderOrder:E.z!==e.z?e.z-E.z:E.id-e.id}function Hs(E){const e=[];let l=0;const _=[],y=[],S=[],O={id:-1};function k(N,G,$,K,ie,ne){let ue=e[l];const ye=E.get($);return ue===void 0?(ue={id:N.id,object:N,geometry:G,material:$,program:ye.program||O,groupOrder:K,renderOrder:N.renderOrder,z:ie,group:ne},e[l]=ue):(ue.id=N.id,ue.object=N,ue.geometry=G,ue.material=$,ue.program=ye.program||O,ue.groupOrder=K,ue.renderOrder=N.renderOrder,ue.z=ie,ue.group=ne),l++,ue}return{opaque:_,transmissive:y,transparent:S,init:function(){l=0,_.length=0,y.length=0,S.length=0},push:function(N,G,$,K,ie,ne){const ue=k(N,G,$,K,ie,ne);$.transmission>0?y.push(ue):$.transparent===!0?S.push(ue):_.push(ue)},unshift:function(N,G,$,K,ie,ne){const ue=k(N,G,$,K,ie,ne);$.transmission>0?y.unshift(ue):$.transparent===!0?S.unshift(ue):_.unshift(ue)},finish:function(){for(let N=l,G=e.length;N<G;N++){const $=e[N];if($.id===null)break;$.id=null,$.object=null,$.geometry=null,$.material=null,$.program=null,$.group=null}},sort:function(N,G){_.length>1&&_.sort(N||Mh),y.length>1&&y.sort(G||jd),S.length>1&&S.sort(G||jd)}}}function wf(E){let e=new WeakMap;return{get:function(l,_){let y;return e.has(l)===!1?(y=new Hs(E),e.set(l,[y])):_>=e.get(l).length?(y=new Hs(E),e.get(l).push(y)):y=e.get(l)[_],y},dispose:function(){e=new WeakMap}}}function wc(){const E={};return{get:function(e){if(E[e.id]!==void 0)return E[e.id];let l;switch(e.type){case"DirectionalLight":l={direction:new ht,color:new On};break;case"SpotLight":l={position:new ht,direction:new ht,color:new On,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":l={position:new ht,color:new On,distance:0,decay:0};break;case"HemisphereLight":l={direction:new ht,skyColor:new On,groundColor:new On};break;case"RectAreaLight":l={color:new On,position:new ht,halfWidth:new ht,halfHeight:new ht}}return E[e.id]=l,l}}}let Rl=0;function Hu(E,e){return(e.castShadow?1:0)-(E.castShadow?1:0)}function vp(E,e){const l=new wc,_=function(){const N={};return{get:function(G){if(N[G.id]!==void 0)return N[G.id];let $;switch(G.type){case"DirectionalLight":case"SpotLight":$={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new dn};break;case"PointLight":$={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new dn,shadowCameraNear:1,shadowCameraFar:1e3}}return N[G.id]=$,$}}}(),y={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let N=0;N<9;N++)y.probe.push(new ht);const S=new ht,O=new tr,k=new tr;return{setup:function(N,G){let $=0,K=0,ie=0;for(let di=0;di<9;di++)y.probe[di].set(0,0,0);let ne=0,ue=0,ye=0,Se=0,_e=0,$e=0,st=0,ot=0;N.sort(Hu);const Lt=G!==!0?Math.PI:1;for(let di=0,Ti=N.length;di<Ti;di++){const Ki=N[di],Bi=Ki.color,Zi=Ki.intensity,hr=Ki.distance,Gn=Ki.shadow&&Ki.shadow.map?Ki.shadow.map.texture:null;if(Ki.isAmbientLight)$+=Bi.r*Zi*Lt,K+=Bi.g*Zi*Lt,ie+=Bi.b*Zi*Lt;else if(Ki.isLightProbe)for(let gn=0;gn<9;gn++)y.probe[gn].addScaledVector(Ki.sh.coefficients[gn],Zi);else if(Ki.isDirectionalLight){const gn=l.get(Ki);if(gn.color.copy(Ki.color).multiplyScalar(Ki.intensity*Lt),Ki.castShadow){const Yn=Ki.shadow,Mr=_.get(Ki);Mr.shadowBias=Yn.bias,Mr.shadowNormalBias=Yn.normalBias,Mr.shadowRadius=Yn.radius,Mr.shadowMapSize=Yn.mapSize,y.directionalShadow[ne]=Mr,y.directionalShadowMap[ne]=Gn,y.directionalShadowMatrix[ne]=Ki.shadow.matrix,$e++}y.directional[ne]=gn,ne++}else if(Ki.isSpotLight){const gn=l.get(Ki);if(gn.position.setFromMatrixPosition(Ki.matrixWorld),gn.color.copy(Bi).multiplyScalar(Zi*Lt),gn.distance=hr,gn.coneCos=Math.cos(Ki.angle),gn.penumbraCos=Math.cos(Ki.angle*(1-Ki.penumbra)),gn.decay=Ki.decay,Ki.castShadow){const Yn=Ki.shadow,Mr=_.get(Ki);Mr.shadowBias=Yn.bias,Mr.shadowNormalBias=Yn.normalBias,Mr.shadowRadius=Yn.radius,Mr.shadowMapSize=Yn.mapSize,y.spotShadow[ye]=Mr,y.spotShadowMap[ye]=Gn,y.spotShadowMatrix[ye]=Ki.shadow.matrix,ot++}y.spot[ye]=gn,ye++}else if(Ki.isRectAreaLight){const gn=l.get(Ki);gn.color.copy(Bi).multiplyScalar(Zi),gn.halfWidth.set(.5*Ki.width,0,0),gn.halfHeight.set(0,.5*Ki.height,0),y.rectArea[Se]=gn,Se++}else if(Ki.isPointLight){const gn=l.get(Ki);if(gn.color.copy(Ki.color).multiplyScalar(Ki.intensity*Lt),gn.distance=Ki.distance,gn.decay=Ki.decay,Ki.castShadow){const Yn=Ki.shadow,Mr=_.get(Ki);Mr.shadowBias=Yn.bias,Mr.shadowNormalBias=Yn.normalBias,Mr.shadowRadius=Yn.radius,Mr.shadowMapSize=Yn.mapSize,Mr.shadowCameraNear=Yn.camera.near,Mr.shadowCameraFar=Yn.camera.far,y.pointShadow[ue]=Mr,y.pointShadowMap[ue]=Gn,y.pointShadowMatrix[ue]=Ki.shadow.matrix,st++}y.point[ue]=gn,ue++}else if(Ki.isHemisphereLight){const gn=l.get(Ki);gn.skyColor.copy(Ki.color).multiplyScalar(Zi*Lt),gn.groundColor.copy(Ki.groundColor).multiplyScalar(Zi*Lt),y.hemi[_e]=gn,_e++}}Se>0&&(e.isWebGL2||E.has("OES_texture_float_linear")===!0?(y.rectAreaLTC1=dr.LTC_FLOAT_1,y.rectAreaLTC2=dr.LTC_FLOAT_2):E.has("OES_texture_half_float_linear")===!0?(y.rectAreaLTC1=dr.LTC_HALF_1,y.rectAreaLTC2=dr.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),y.ambient[0]=$,y.ambient[1]=K,y.ambient[2]=ie;const Bt=y.hash;Bt.directionalLength===ne&&Bt.pointLength===ue&&Bt.spotLength===ye&&Bt.rectAreaLength===Se&&Bt.hemiLength===_e&&Bt.numDirectionalShadows===$e&&Bt.numPointShadows===st&&Bt.numSpotShadows===ot||(y.directional.length=ne,y.spot.length=ye,y.rectArea.length=Se,y.point.length=ue,y.hemi.length=_e,y.directionalShadow.length=$e,y.directionalShadowMap.length=$e,y.pointShadow.length=st,y.pointShadowMap.length=st,y.spotShadow.length=ot,y.spotShadowMap.length=ot,y.directionalShadowMatrix.length=$e,y.pointShadowMatrix.length=st,y.spotShadowMatrix.length=ot,Bt.directionalLength=ne,Bt.pointLength=ue,Bt.spotLength=ye,Bt.rectAreaLength=Se,Bt.hemiLength=_e,Bt.numDirectionalShadows=$e,Bt.numPointShadows=st,Bt.numSpotShadows=ot,y.version=Rl++)},setupView:function(N,G){let $=0,K=0,ie=0,ne=0,ue=0;const ye=G.matrixWorldInverse;for(let Se=0,_e=N.length;Se<_e;Se++){const $e=N[Se];if($e.isDirectionalLight){const st=y.directional[$];st.direction.setFromMatrixPosition($e.matrixWorld),S.setFromMatrixPosition($e.target.matrixWorld),st.direction.sub(S),st.direction.transformDirection(ye),$++}else if($e.isSpotLight){const st=y.spot[ie];st.position.setFromMatrixPosition($e.matrixWorld),st.position.applyMatrix4(ye),st.direction.setFromMatrixPosition($e.matrixWorld),S.setFromMatrixPosition($e.target.matrixWorld),st.direction.sub(S),st.direction.transformDirection(ye),ie++}else if($e.isRectAreaLight){const st=y.rectArea[ne];st.position.setFromMatrixPosition($e.matrixWorld),st.position.applyMatrix4(ye),k.identity(),O.copy($e.matrixWorld),O.premultiply(ye),k.extractRotation(O),st.halfWidth.set(.5*$e.width,0,0),st.halfHeight.set(0,.5*$e.height,0),st.halfWidth.applyMatrix4(k),st.halfHeight.applyMatrix4(k),ne++}else if($e.isPointLight){const st=y.point[K];st.position.setFromMatrixPosition($e.matrixWorld),st.position.applyMatrix4(ye),K++}else if($e.isHemisphereLight){const st=y.hemi[ue];st.direction.setFromMatrixPosition($e.matrixWorld),st.direction.transformDirection(ye),st.direction.normalize(),ue++}}},state:y}}function qd(E,e){const l=new vp(E,e),_=[],y=[];return{init:function(){_.length=0,y.length=0},state:{lightsArray:_,shadowsArray:y,lights:l},setupLights:function(S){l.setup(_,S)},setupLightsView:function(S){l.setupView(_,S)},pushLight:function(S){_.push(S)},pushShadow:function(S){y.push(S)}}}function Th(E,e){let l=new WeakMap;return{get:function(_,y=0){let S;return l.has(_)===!1?(S=new qd(E,e),l.set(_,[S])):y>=l.get(_).length?(S=new qd(E,e),l.get(_).push(S)):S=l.get(_)[y],S},dispose:function(){l=new WeakMap}}}class ju extends rn{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}ju.prototype.isMeshDepthMaterial=!0;class mo extends rn{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new ht,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}mo.prototype.isMeshDistanceMaterial=!0;function us(E,e,l){let _=new yc;const y=new dn,S=new dn,O=new qr,k=new ju({depthPacking:3201}),N=new mo,G={},$=l.maxTextureSize,K={0:1,1:0,2:2},ie=new El({uniforms:{shadow_pass:{value:null},resolution:{value:new dn},radius:{value:4},samples:{value:8}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
uniform float samples;
#include <packing>
void main() {
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),ne=ie.clone();ne.defines.HORIZONTAL_PASS=1;const ue=new oa;ue.setAttribute("position",new aa(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const ye=new eo(ue,ie),Se=this;function _e(ot,Lt){const Bt=e.update(ye);ie.uniforms.shadow_pass.value=ot.map.texture,ie.uniforms.resolution.value=ot.mapSize,ie.uniforms.radius.value=ot.radius,ie.uniforms.samples.value=ot.blurSamples,E.setRenderTarget(ot.mapPass),E.clear(),E.renderBufferDirect(Lt,null,Bt,ie,ye,null),ne.uniforms.shadow_pass.value=ot.mapPass.texture,ne.uniforms.resolution.value=ot.mapSize,ne.uniforms.radius.value=ot.radius,ne.uniforms.samples.value=ot.blurSamples,E.setRenderTarget(ot.map),E.clear(),E.renderBufferDirect(Lt,null,Bt,ne,ye,null)}function $e(ot,Lt,Bt,di,Ti,Ki,Bi){let Zi=null;const hr=di.isPointLight===!0?ot.customDistanceMaterial:ot.customDepthMaterial;if(Zi=hr!==void 0?hr:di.isPointLight===!0?N:k,E.localClippingEnabled&&Bt.clipShadows===!0&&Bt.clippingPlanes.length!==0||Bt.displacementMap&&Bt.displacementScale!==0||Bt.alphaMap&&Bt.alphaTest>0){const Gn=Zi.uuid,gn=Bt.uuid;let Yn=G[Gn];Yn===void 0&&(Yn={},G[Gn]=Yn);let Mr=Yn[gn];Mr===void 0&&(Mr=Zi.clone(),Yn[gn]=Mr),Zi=Mr}return Zi.visible=Bt.visible,Zi.wireframe=Bt.wireframe,Zi.side=Bi===3?Bt.shadowSide!==null?Bt.shadowSide:Bt.side:Bt.shadowSide!==null?Bt.shadowSide:K[Bt.side],Zi.alphaMap=Bt.alphaMap,Zi.alphaTest=Bt.alphaTest,Zi.clipShadows=Bt.clipShadows,Zi.clippingPlanes=Bt.clippingPlanes,Zi.clipIntersection=Bt.clipIntersection,Zi.displacementMap=Bt.displacementMap,Zi.displacementScale=Bt.displacementScale,Zi.displacementBias=Bt.displacementBias,Zi.wireframeLinewidth=Bt.wireframeLinewidth,Zi.linewidth=Bt.linewidth,di.isPointLight===!0&&Zi.isMeshDistanceMaterial===!0&&(Zi.referencePosition.setFromMatrixPosition(di.matrixWorld),Zi.nearDistance=Ti,Zi.farDistance=Ki),Zi}function st(ot,Lt,Bt,di,Ti){if(ot.visible===!1)return;if(ot.layers.test(Lt.layers)&&(ot.isMesh||ot.isLine||ot.isPoints)&&(ot.castShadow||ot.receiveShadow&&Ti===3)&&(!ot.frustumCulled||_.intersectsObject(ot))){ot.modelViewMatrix.multiplyMatrices(Bt.matrixWorldInverse,ot.matrixWorld);const Bi=e.update(ot),Zi=ot.material;if(Array.isArray(Zi)){const hr=Bi.groups;for(let Gn=0,gn=hr.length;Gn<gn;Gn++){const Yn=hr[Gn],Mr=Zi[Yn.materialIndex];if(Mr&&Mr.visible){const Cr=$e(ot,0,Mr,di,Bt.near,Bt.far,Ti);E.renderBufferDirect(Bt,null,Bi,Cr,ot,Yn)}}}else if(Zi.visible){const hr=$e(ot,0,Zi,di,Bt.near,Bt.far,Ti);E.renderBufferDirect(Bt,null,Bi,hr,ot,null)}}const Ki=ot.children;for(let Bi=0,Zi=Ki.length;Bi<Zi;Bi++)st(Ki[Bi],Lt,Bt,di,Ti)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(ot,Lt,Bt){if(Se.enabled===!1||Se.autoUpdate===!1&&Se.needsUpdate===!1||ot.length===0)return;const di=E.getRenderTarget(),Ti=E.getActiveCubeFace(),Ki=E.getActiveMipmapLevel(),Bi=E.state;Bi.setBlending(0),Bi.buffers.color.setClear(1,1,1,1),Bi.buffers.depth.setTest(!0),Bi.setScissorTest(!1);for(let Zi=0,hr=ot.length;Zi<hr;Zi++){const Gn=ot[Zi],gn=Gn.shadow;if(gn===void 0){console.warn("THREE.WebGLShadowMap:",Gn,"has no shadow.");continue}if(gn.autoUpdate===!1&&gn.needsUpdate===!1)continue;y.copy(gn.mapSize);const Yn=gn.getFrameExtents();if(y.multiply(Yn),S.copy(gn.mapSize),(y.x>$||y.y>$)&&(y.x>$&&(S.x=Math.floor($/Yn.x),y.x=S.x*Yn.x,gn.mapSize.x=S.x),y.y>$&&(S.y=Math.floor($/Yn.y),y.y=S.y*Yn.y,gn.mapSize.y=S.y)),gn.map===null&&!gn.isPointLightShadow&&this.type===3){const Cr={minFilter:1006,magFilter:1006,format:1023};gn.map=new gs(y.x,y.y,Cr),gn.map.texture.name=Gn.name+".shadowMap",gn.mapPass=new gs(y.x,y.y,Cr),gn.camera.updateProjectionMatrix()}if(gn.map===null){const Cr={minFilter:1003,magFilter:1003,format:1023};gn.map=new gs(y.x,y.y,Cr),gn.map.texture.name=Gn.name+".shadowMap",gn.camera.updateProjectionMatrix()}E.setRenderTarget(gn.map),E.clear();const Mr=gn.getViewportCount();for(let Cr=0;Cr<Mr;Cr++){const kr=gn.getViewport(Cr);O.set(S.x*kr.x,S.y*kr.y,S.x*kr.z,S.y*kr.w),Bi.viewport(O),gn.updateMatrices(Gn,Cr),_=gn.getFrustum(),st(Lt,Bt,gn.camera,Gn,this.type)}gn.isPointLightShadow||this.type!==3||_e(gn,Bt),gn.needsUpdate=!1}Se.needsUpdate=!1,E.setRenderTarget(di,Ti,Ki)}}function Ka(E,e,l){const _=l.isWebGL2,y=new function(){let Mt=!1;const Oi=new qr;let Ln=null;const Bn=new qr(0,0,0,0);return{setMask:function(Rn){Ln===Rn||Mt||(E.colorMask(Rn,Rn,Rn,Rn),Ln=Rn)},setLocked:function(Rn){Mt=Rn},setClear:function(Rn,Dr,Qr,Or,Ba){Ba===!0&&(Rn*=Or,Dr*=Or,Qr*=Or),Oi.set(Rn,Dr,Qr,Or),Bn.equals(Oi)===!1&&(E.clearColor(Rn,Dr,Qr,Or),Bn.copy(Oi))},reset:function(){Mt=!1,Ln=null,Bn.set(-1,0,0,0)}}},S=new function(){let Mt=!1,Oi=null,Ln=null,Bn=null;return{setTest:function(Rn){Rn?Kn(2929):At(2929)},setMask:function(Rn){Oi===Rn||Mt||(E.depthMask(Rn),Oi=Rn)},setFunc:function(Rn){if(Ln!==Rn){if(Rn)switch(Rn){case 0:E.depthFunc(512);break;case 1:E.depthFunc(519);break;case 2:E.depthFunc(513);break;case 3:E.depthFunc(515);break;case 4:E.depthFunc(514);break;case 5:E.depthFunc(518);break;case 6:E.depthFunc(516);break;case 7:E.depthFunc(517);break;default:E.depthFunc(515)}else E.depthFunc(515);Ln=Rn}},setLocked:function(Rn){Mt=Rn},setClear:function(Rn){Bn!==Rn&&(E.clearDepth(Rn),Bn=Rn)},reset:function(){Mt=!1,Oi=null,Ln=null,Bn=null}}},O=new function(){let Mt=!1,Oi=null,Ln=null,Bn=null,Rn=null,Dr=null,Qr=null,Or=null,Ba=null;return{setTest:function(Ea){Mt||(Ea?Kn(2960):At(2960))},setMask:function(Ea){Oi===Ea||Mt||(E.stencilMask(Ea),Oi=Ea)},setFunc:function(Ea,nl,os){Ln===Ea&&Bn===nl&&Rn===os||(E.stencilFunc(Ea,nl,os),Ln=Ea,Bn=nl,Rn=os)},setOp:function(Ea,nl,os){Dr===Ea&&Qr===nl&&Or===os||(E.stencilOp(Ea,nl,os),Dr=Ea,Qr=nl,Or=os)},setLocked:function(Ea){Mt=Ea},setClear:function(Ea){Ba!==Ea&&(E.clearStencil(Ea),Ba=Ea)},reset:function(){Mt=!1,Oi=null,Ln=null,Bn=null,Rn=null,Dr=null,Qr=null,Or=null,Ba=null}}};let k={},N=null,G={},$=null,K=!1,ie=null,ne=null,ue=null,ye=null,Se=null,_e=null,$e=null,st=!1,ot=null,Lt=null,Bt=null,di=null,Ti=null;const Ki=E.getParameter(35661);let Bi=!1,Zi=0;const hr=E.getParameter(7938);hr.indexOf("WebGL")!==-1?(Zi=parseFloat(/^WebGL (\d)/.exec(hr)[1]),Bi=Zi>=1):hr.indexOf("OpenGL ES")!==-1&&(Zi=parseFloat(/^OpenGL ES (\d)/.exec(hr)[1]),Bi=Zi>=2);let Gn=null,gn={};const Yn=E.getParameter(3088),Mr=E.getParameter(2978),Cr=new qr().fromArray(Yn),kr=new qr().fromArray(Mr);function Zr(Mt,Oi,Ln){const Bn=new Uint8Array(4),Rn=E.createTexture();E.bindTexture(Mt,Rn),E.texParameteri(Mt,10241,9728),E.texParameteri(Mt,10240,9728);for(let Dr=0;Dr<Ln;Dr++)E.texImage2D(Oi+Dr,0,6408,1,1,0,6408,5121,Bn);return Rn}const la={};function Kn(Mt){k[Mt]!==!0&&(E.enable(Mt),k[Mt]=!0)}function At(Mt){k[Mt]!==!1&&(E.disable(Mt),k[Mt]=!1)}la[3553]=Zr(3553,3553,1),la[34067]=Zr(34067,34069,6),y.setClear(0,0,0,1),S.setClear(1),O.setClear(0),Kn(2929),S.setFunc(3),ji(!1),ir(1),Kn(2884),Vi(0);const Qt={100:32774,101:32778,102:32779};if(_)Qt[103]=32775,Qt[104]=32776;else{const Mt=e.get("EXT_blend_minmax");Mt!==null&&(Qt[103]=Mt.MIN_EXT,Qt[104]=Mt.MAX_EXT)}const xn={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function Vi(Mt,Oi,Ln,Bn,Rn,Dr,Qr,Or){if(Mt!==0){if(K===!1&&(Kn(3042),K=!0),Mt===5)Rn=Rn||Oi,Dr=Dr||Ln,Qr=Qr||Bn,Oi===ne&&Rn===Se||(E.blendEquationSeparate(Qt[Oi],Qt[Rn]),ne=Oi,Se=Rn),Ln===ue&&Bn===ye&&Dr===_e&&Qr===$e||(E.blendFuncSeparate(xn[Ln],xn[Bn],xn[Dr],xn[Qr]),ue=Ln,ye=Bn,_e=Dr,$e=Qr),ie=Mt,st=null;else if(Mt!==ie||Or!==st){if(ne===100&&Se===100||(E.blendEquation(32774),ne=100,Se=100),Or)switch(Mt){case 1:E.blendFuncSeparate(1,771,1,771);break;case 2:E.blendFunc(1,1);break;case 3:E.blendFuncSeparate(0,0,769,771);break;case 4:E.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Mt)}else switch(Mt){case 1:E.blendFuncSeparate(770,771,1,771);break;case 2:E.blendFunc(770,1);break;case 3:E.blendFunc(0,769);break;case 4:E.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Mt)}ue=null,ye=null,_e=null,$e=null,ie=Mt,st=Or}}else K===!0&&(At(3042),K=!1)}function ji(Mt){ot!==Mt&&(Mt?E.frontFace(2304):E.frontFace(2305),ot=Mt)}function ir(Mt){Mt!==0?(Kn(2884),Mt!==Lt&&(Mt===1?E.cullFace(1029):Mt===2?E.cullFace(1028):E.cullFace(1032))):At(2884),Lt=Mt}function $n(Mt,Oi,Ln){Mt?(Kn(32823),di===Oi&&Ti===Ln||(E.polygonOffset(Oi,Ln),di=Oi,Ti=Ln)):At(32823)}function $i(Mt){Mt===void 0&&(Mt=33984+Ki-1),Gn!==Mt&&(E.activeTexture(Mt),Gn=Mt)}return{buffers:{color:y,depth:S,stencil:O},enable:Kn,disable:At,bindFramebuffer:function(Mt,Oi){return Oi===null&&N!==null&&(Oi=N),G[Mt]!==Oi&&(E.bindFramebuffer(Mt,Oi),G[Mt]=Oi,_&&(Mt===36009&&(G[36160]=Oi),Mt===36160&&(G[36009]=Oi)),!0)},bindXRFramebuffer:function(Mt){Mt!==N&&(E.bindFramebuffer(36160,Mt),N=Mt)},useProgram:function(Mt){return $!==Mt&&(E.useProgram(Mt),$=Mt,!0)},setBlending:Vi,setMaterial:function(Mt,Oi){Mt.side===2?At(2884):Kn(2884);let Ln=Mt.side===1;Oi&&(Ln=!Ln),ji(Ln),Mt.blending===1&&Mt.transparent===!1?Vi(0):Vi(Mt.blending,Mt.blendEquation,Mt.blendSrc,Mt.blendDst,Mt.blendEquationAlpha,Mt.blendSrcAlpha,Mt.blendDstAlpha,Mt.premultipliedAlpha),S.setFunc(Mt.depthFunc),S.setTest(Mt.depthTest),S.setMask(Mt.depthWrite),y.setMask(Mt.colorWrite);const Bn=Mt.stencilWrite;O.setTest(Bn),Bn&&(O.setMask(Mt.stencilWriteMask),O.setFunc(Mt.stencilFunc,Mt.stencilRef,Mt.stencilFuncMask),O.setOp(Mt.stencilFail,Mt.stencilZFail,Mt.stencilZPass)),$n(Mt.polygonOffset,Mt.polygonOffsetFactor,Mt.polygonOffsetUnits),Mt.alphaToCoverage===!0?Kn(32926):At(32926)},setFlipSided:ji,setCullFace:ir,setLineWidth:function(Mt){Mt!==Bt&&(Bi&&E.lineWidth(Mt),Bt=Mt)},setPolygonOffset:$n,setScissorTest:function(Mt){Mt?Kn(3089):At(3089)},activeTexture:$i,bindTexture:function(Mt,Oi){Gn===null&&$i();let Ln=gn[Gn];Ln===void 0&&(Ln={type:void 0,texture:void 0},gn[Gn]=Ln),Ln.type===Mt&&Ln.texture===Oi||(E.bindTexture(Mt,Oi||la[Mt]),Ln.type=Mt,Ln.texture=Oi)},unbindTexture:function(){const Mt=gn[Gn];Mt!==void 0&&Mt.type!==void 0&&(E.bindTexture(Mt.type,null),Mt.type=void 0,Mt.texture=void 0)},compressedTexImage2D:function(){try{E.compressedTexImage2D.apply(E,arguments)}catch(Mt){console.error("THREE.WebGLState:",Mt)}},texImage2D:function(){try{E.texImage2D.apply(E,arguments)}catch(Mt){console.error("THREE.WebGLState:",Mt)}},texImage3D:function(){try{E.texImage3D.apply(E,arguments)}catch(Mt){console.error("THREE.WebGLState:",Mt)}},scissor:function(Mt){Cr.equals(Mt)===!1&&(E.scissor(Mt.x,Mt.y,Mt.z,Mt.w),Cr.copy(Mt))},viewport:function(Mt){kr.equals(Mt)===!1&&(E.viewport(Mt.x,Mt.y,Mt.z,Mt.w),kr.copy(Mt))},reset:function(){E.disable(3042),E.disable(2884),E.disable(2929),E.disable(32823),E.disable(3089),E.disable(2960),E.disable(32926),E.blendEquation(32774),E.blendFunc(1,0),E.blendFuncSeparate(1,0,1,0),E.colorMask(!0,!0,!0,!0),E.clearColor(0,0,0,0),E.depthMask(!0),E.depthFunc(513),E.clearDepth(1),E.stencilMask(4294967295),E.stencilFunc(519,0,4294967295),E.stencilOp(7680,7680,7680),E.clearStencil(0),E.cullFace(1029),E.frontFace(2305),E.polygonOffset(0,0),E.activeTexture(33984),E.bindFramebuffer(36160,null),_===!0&&(E.bindFramebuffer(36009,null),E.bindFramebuffer(36008,null)),E.useProgram(null),E.lineWidth(1),E.scissor(0,0,E.canvas.width,E.canvas.height),E.viewport(0,0,E.canvas.width,E.canvas.height),k={},Gn=null,gn={},N=null,G={},$=null,K=!1,ie=null,ne=null,ue=null,ye=null,Se=null,_e=null,$e=null,st=!1,ot=null,Lt=null,Bt=null,di=null,Ti=null,Cr.set(0,0,E.canvas.width,E.canvas.height),kr.set(0,0,E.canvas.width,E.canvas.height),y.reset(),S.reset(),O.reset()}}}function Sh(E,e,l,_,y,S,O){const k=y.isWebGL2,N=y.maxTextures,G=y.maxCubemapSize,$=y.maxTextureSize,K=y.maxSamples,ie=new WeakMap;let ne,ue=!1;try{ue=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function ye(At,Qt){return ue?new OffscreenCanvas(At,Qt):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function Se(At,Qt,xn,Vi){let ji=1;if((At.width>Vi||At.height>Vi)&&(ji=Vi/Math.max(At.width,At.height)),ji<1||Qt===!0){if(typeof HTMLImageElement<"u"&&At instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&At instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&At instanceof ImageBitmap){const ir=Qt?oo:Math.floor,$n=ir(ji*At.width),$i=ir(ji*At.height);ne===void 0&&(ne=ye($n,$i));const Mt=xn?ye($n,$i):ne;return Mt.width=$n,Mt.height=$i,Mt.getContext("2d").drawImage(At,0,0,$n,$i),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+At.width+"x"+At.height+") to ("+$n+"x"+$i+")."),Mt}return"data"in At&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+At.width+"x"+At.height+")."),At}return At}function _e(At){return Ma(At.width)&&Ma(At.height)}function $e(At,Qt){return At.generateMipmaps&&Qt&&At.minFilter!==1003&&At.minFilter!==1006}function st(At,Qt,xn,Vi,ji=1){E.generateMipmap(At),_.get(Qt).__maxMipLevel=Math.log2(Math.max(xn,Vi,ji))}function ot(At,Qt,xn){if(k===!1)return Qt;if(At!==null){if(E[At]!==void 0)return E[At];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+At+"'")}let Vi=Qt;return Qt===6403&&(xn===5126&&(Vi=33326),xn===5131&&(Vi=33325),xn===5121&&(Vi=33321)),Qt===6407&&(xn===5126&&(Vi=34837),xn===5131&&(Vi=34843),xn===5121&&(Vi=32849)),Qt===6408&&(xn===5126&&(Vi=34836),xn===5131&&(Vi=34842),xn===5121&&(Vi=32856)),Vi!==33325&&Vi!==33326&&Vi!==34842&&Vi!==34836||e.get("EXT_color_buffer_float"),Vi}function Lt(At){return At===1003||At===1004||At===1005?9728:9729}function Bt(At){const Qt=At.target;Qt.removeEventListener("dispose",Bt),function(xn){const Vi=_.get(xn);Vi.__webglInit!==void 0&&(E.deleteTexture(Vi.__webglTexture),_.remove(xn))}(Qt),Qt.isVideoTexture&&ie.delete(Qt),O.memory.textures--}function di(At){const Qt=At.target;Qt.removeEventListener("dispose",di),function(xn){const Vi=xn.texture,ji=_.get(xn),ir=_.get(Vi);if(xn){if(ir.__webglTexture!==void 0&&(E.deleteTexture(ir.__webglTexture),O.memory.textures--),xn.depthTexture&&xn.depthTexture.dispose(),xn.isWebGLCubeRenderTarget)for(let $n=0;$n<6;$n++)E.deleteFramebuffer(ji.__webglFramebuffer[$n]),ji.__webglDepthbuffer&&E.deleteRenderbuffer(ji.__webglDepthbuffer[$n]);else E.deleteFramebuffer(ji.__webglFramebuffer),ji.__webglDepthbuffer&&E.deleteRenderbuffer(ji.__webglDepthbuffer),ji.__webglMultisampledFramebuffer&&E.deleteFramebuffer(ji.__webglMultisampledFramebuffer),ji.__webglColorRenderbuffer&&E.deleteRenderbuffer(ji.__webglColorRenderbuffer),ji.__webglDepthRenderbuffer&&E.deleteRenderbuffer(ji.__webglDepthRenderbuffer);if(xn.isWebGLMultipleRenderTargets)for(let $n=0,$i=Vi.length;$n<$i;$n++){const Mt=_.get(Vi[$n]);Mt.__webglTexture&&(E.deleteTexture(Mt.__webglTexture),O.memory.textures--),_.remove(Vi[$n])}_.remove(Vi),_.remove(xn)}}(Qt)}let Ti=0;function Ki(At,Qt){const xn=_.get(At);if(At.isVideoTexture&&function(Vi){const ji=O.render.frame;ie.get(Vi)!==ji&&(ie.set(Vi,ji),Vi.update())}(At),At.version>0&&xn.__version!==At.version){const Vi=At.image;if(Vi===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(Vi.complete!==!1)return void Yn(xn,At,Qt);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}l.activeTexture(33984+Qt),l.bindTexture(3553,xn.__webglTexture)}function Bi(At,Qt){const xn=_.get(At);At.version>0&&xn.__version!==At.version?function(Vi,ji,ir){if(ji.image.length!==6)return;gn(Vi,ji),l.activeTexture(33984+ir),l.bindTexture(34067,Vi.__webglTexture),E.pixelStorei(37440,ji.flipY),E.pixelStorei(37441,ji.premultiplyAlpha),E.pixelStorei(3317,ji.unpackAlignment),E.pixelStorei(37443,0);const $n=ji&&(ji.isCompressedTexture||ji.image[0].isCompressedTexture),$i=ji.image[0]&&ji.image[0].isDataTexture,Mt=[];for(let Or=0;Or<6;Or++)Mt[Or]=$n||$i?$i?ji.image[Or].image:ji.image[Or]:Se(ji.image[Or],!1,!0,G);const Oi=Mt[0],Ln=_e(Oi)||k,Bn=S.convert(ji.format),Rn=S.convert(ji.type),Dr=ot(ji.internalFormat,Bn,Rn);let Qr;if(Gn(34067,ji,Ln),$n){for(let Or=0;Or<6;Or++){Qr=Mt[Or].mipmaps;for(let Ba=0;Ba<Qr.length;Ba++){const Ea=Qr[Ba];ji.format!==1023&&ji.format!==1022?Bn!==null?l.compressedTexImage2D(34069+Or,Ba,Dr,Ea.width,Ea.height,0,Ea.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):l.texImage2D(34069+Or,Ba,Dr,Ea.width,Ea.height,0,Bn,Rn,Ea.data)}}Vi.__maxMipLevel=Qr.length-1}else{Qr=ji.mipmaps;for(let Or=0;Or<6;Or++)if($i){l.texImage2D(34069+Or,0,Dr,Mt[Or].width,Mt[Or].height,0,Bn,Rn,Mt[Or].data);for(let Ba=0;Ba<Qr.length;Ba++){const Ea=Qr[Ba].image[Or].image;l.texImage2D(34069+Or,Ba+1,Dr,Ea.width,Ea.height,0,Bn,Rn,Ea.data)}}else{l.texImage2D(34069+Or,0,Dr,Bn,Rn,Mt[Or]);for(let Ba=0;Ba<Qr.length;Ba++){const Ea=Qr[Ba];l.texImage2D(34069+Or,Ba+1,Dr,Bn,Rn,Ea.image[Or])}}Vi.__maxMipLevel=Qr.length}$e(ji,Ln)&&st(34067,ji,Oi.width,Oi.height),Vi.__version=ji.version,ji.onUpdate&&ji.onUpdate(ji)}(xn,At,Qt):(l.activeTexture(33984+Qt),l.bindTexture(34067,xn.__webglTexture))}const Zi={1e3:10497,1001:33071,1002:33648},hr={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987};function Gn(At,Qt,xn){if(xn?(E.texParameteri(At,10242,Zi[Qt.wrapS]),E.texParameteri(At,10243,Zi[Qt.wrapT]),At!==32879&&At!==35866||E.texParameteri(At,32882,Zi[Qt.wrapR]),E.texParameteri(At,10240,hr[Qt.magFilter]),E.texParameteri(At,10241,hr[Qt.minFilter])):(E.texParameteri(At,10242,33071),E.texParameteri(At,10243,33071),At!==32879&&At!==35866||E.texParameteri(At,32882,33071),Qt.wrapS===1001&&Qt.wrapT===1001||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),E.texParameteri(At,10240,Lt(Qt.magFilter)),E.texParameteri(At,10241,Lt(Qt.minFilter)),Qt.minFilter!==1003&&Qt.minFilter!==1006&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const Vi=e.get("EXT_texture_filter_anisotropic");if(Qt.type===1015&&e.has("OES_texture_float_linear")===!1||k===!1&&Qt.type===1016&&e.has("OES_texture_half_float_linear")===!1)return;(Qt.anisotropy>1||_.get(Qt).__currentAnisotropy)&&(E.texParameterf(At,Vi.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Qt.anisotropy,y.getMaxAnisotropy())),_.get(Qt).__currentAnisotropy=Qt.anisotropy)}}function gn(At,Qt){At.__webglInit===void 0&&(At.__webglInit=!0,Qt.addEventListener("dispose",Bt),At.__webglTexture=E.createTexture(),O.memory.textures++)}function Yn(At,Qt,xn){let Vi=3553;Qt.isDataTexture2DArray&&(Vi=35866),Qt.isDataTexture3D&&(Vi=32879),gn(At,Qt),l.activeTexture(33984+xn),l.bindTexture(Vi,At.__webglTexture),E.pixelStorei(37440,Qt.flipY),E.pixelStorei(37441,Qt.premultiplyAlpha),E.pixelStorei(3317,Qt.unpackAlignment),E.pixelStorei(37443,0);const ji=function(Rn){return!k&&(Rn.wrapS!==1001||Rn.wrapT!==1001||Rn.minFilter!==1003&&Rn.minFilter!==1006)}(Qt)&&_e(Qt.image)===!1,ir=Se(Qt.image,ji,!1,$),$n=_e(ir)||k,$i=S.convert(Qt.format);let Mt,Oi=S.convert(Qt.type),Ln=ot(Qt.internalFormat,$i,Oi);Gn(Vi,Qt,$n);const Bn=Qt.mipmaps;if(Qt.isDepthTexture)Ln=6402,k?Ln=Qt.type===1015?36012:Qt.type===1014?33190:Qt.type===1020?35056:33189:Qt.type===1015&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Qt.format===1026&&Ln===6402&&Qt.type!==1012&&Qt.type!==1014&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Qt.type=1012,Oi=S.convert(Qt.type)),Qt.format===1027&&Ln===6402&&(Ln=34041,Qt.type!==1020&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Qt.type=1020,Oi=S.convert(Qt.type))),l.texImage2D(3553,0,Ln,ir.width,ir.height,0,$i,Oi,null);else if(Qt.isDataTexture)if(Bn.length>0&&$n){for(let Rn=0,Dr=Bn.length;Rn<Dr;Rn++)Mt=Bn[Rn],l.texImage2D(3553,Rn,Ln,Mt.width,Mt.height,0,$i,Oi,Mt.data);Qt.generateMipmaps=!1,At.__maxMipLevel=Bn.length-1}else l.texImage2D(3553,0,Ln,ir.width,ir.height,0,$i,Oi,ir.data),At.__maxMipLevel=0;else if(Qt.isCompressedTexture){for(let Rn=0,Dr=Bn.length;Rn<Dr;Rn++)Mt=Bn[Rn],Qt.format!==1023&&Qt.format!==1022?$i!==null?l.compressedTexImage2D(3553,Rn,Ln,Mt.width,Mt.height,0,Mt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):l.texImage2D(3553,Rn,Ln,Mt.width,Mt.height,0,$i,Oi,Mt.data);At.__maxMipLevel=Bn.length-1}else if(Qt.isDataTexture2DArray)l.texImage3D(35866,0,Ln,ir.width,ir.height,ir.depth,0,$i,Oi,ir.data),At.__maxMipLevel=0;else if(Qt.isDataTexture3D)l.texImage3D(32879,0,Ln,ir.width,ir.height,ir.depth,0,$i,Oi,ir.data),At.__maxMipLevel=0;else if(Bn.length>0&&$n){for(let Rn=0,Dr=Bn.length;Rn<Dr;Rn++)Mt=Bn[Rn],l.texImage2D(3553,Rn,Ln,$i,Oi,Mt);Qt.generateMipmaps=!1,At.__maxMipLevel=Bn.length-1}else l.texImage2D(3553,0,Ln,$i,Oi,ir),At.__maxMipLevel=0;$e(Qt,$n)&&st(Vi,Qt,ir.width,ir.height),At.__version=Qt.version,Qt.onUpdate&&Qt.onUpdate(Qt)}function Mr(At,Qt,xn,Vi,ji){const ir=S.convert(xn.format),$n=S.convert(xn.type),$i=ot(xn.internalFormat,ir,$n);ji===32879||ji===35866?l.texImage3D(ji,0,$i,Qt.width,Qt.height,Qt.depth,0,ir,$n,null):l.texImage2D(ji,0,$i,Qt.width,Qt.height,0,ir,$n,null),l.bindFramebuffer(36160,At),E.framebufferTexture2D(36160,Vi,ji,_.get(xn).__webglTexture,0),l.bindFramebuffer(36160,null)}function Cr(At,Qt,xn){if(E.bindRenderbuffer(36161,At),Qt.depthBuffer&&!Qt.stencilBuffer){let Vi=33189;if(xn){const ji=Qt.depthTexture;ji&&ji.isDepthTexture&&(ji.type===1015?Vi=36012:ji.type===1014&&(Vi=33190));const ir=Zr(Qt);E.renderbufferStorageMultisample(36161,ir,Vi,Qt.width,Qt.height)}else E.renderbufferStorage(36161,Vi,Qt.width,Qt.height);E.framebufferRenderbuffer(36160,36096,36161,At)}else if(Qt.depthBuffer&&Qt.stencilBuffer){if(xn){const Vi=Zr(Qt);E.renderbufferStorageMultisample(36161,Vi,35056,Qt.width,Qt.height)}else E.renderbufferStorage(36161,34041,Qt.width,Qt.height);E.framebufferRenderbuffer(36160,33306,36161,At)}else{const Vi=Qt.isWebGLMultipleRenderTargets===!0?Qt.texture[0]:Qt.texture,ji=S.convert(Vi.format),ir=S.convert(Vi.type),$n=ot(Vi.internalFormat,ji,ir);if(xn){const $i=Zr(Qt);E.renderbufferStorageMultisample(36161,$i,$n,Qt.width,Qt.height)}else E.renderbufferStorage(36161,$n,Qt.width,Qt.height)}E.bindRenderbuffer(36161,null)}function kr(At){const Qt=_.get(At),xn=At.isWebGLCubeRenderTarget===!0;if(At.depthTexture){if(xn)throw new Error("target.depthTexture not supported in Cube render targets");(function(Vi,ji){if(ji&&ji.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(l.bindFramebuffer(36160,Vi),!ji.depthTexture||!ji.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");_.get(ji.depthTexture).__webglTexture&&ji.depthTexture.image.width===ji.width&&ji.depthTexture.image.height===ji.height||(ji.depthTexture.image.width=ji.width,ji.depthTexture.image.height=ji.height,ji.depthTexture.needsUpdate=!0),Ki(ji.depthTexture,0);const ir=_.get(ji.depthTexture).__webglTexture;if(ji.depthTexture.format===1026)E.framebufferTexture2D(36160,36096,3553,ir,0);else{if(ji.depthTexture.format!==1027)throw new Error("Unknown depthTexture format");E.framebufferTexture2D(36160,33306,3553,ir,0)}})(Qt.__webglFramebuffer,At)}else if(xn){Qt.__webglDepthbuffer=[];for(let Vi=0;Vi<6;Vi++)l.bindFramebuffer(36160,Qt.__webglFramebuffer[Vi]),Qt.__webglDepthbuffer[Vi]=E.createRenderbuffer(),Cr(Qt.__webglDepthbuffer[Vi],At,!1)}else l.bindFramebuffer(36160,Qt.__webglFramebuffer),Qt.__webglDepthbuffer=E.createRenderbuffer(),Cr(Qt.__webglDepthbuffer,At,!1);l.bindFramebuffer(36160,null)}function Zr(At){return k&&At.isWebGLMultisampleRenderTarget?Math.min(K,At.samples):0}let la=!1,Kn=!1;this.allocateTextureUnit=function(){const At=Ti;return At>=N&&console.warn("THREE.WebGLTextures: Trying to use "+At+" texture units while this GPU supports only "+N),Ti+=1,At},this.resetTextureUnits=function(){Ti=0},this.setTexture2D=Ki,this.setTexture2DArray=function(At,Qt){const xn=_.get(At);At.version>0&&xn.__version!==At.version?Yn(xn,At,Qt):(l.activeTexture(33984+Qt),l.bindTexture(35866,xn.__webglTexture))},this.setTexture3D=function(At,Qt){const xn=_.get(At);At.version>0&&xn.__version!==At.version?Yn(xn,At,Qt):(l.activeTexture(33984+Qt),l.bindTexture(32879,xn.__webglTexture))},this.setTextureCube=Bi,this.setupRenderTarget=function(At){const Qt=At.texture,xn=_.get(At),Vi=_.get(Qt);At.addEventListener("dispose",di),At.isWebGLMultipleRenderTargets!==!0&&(Vi.__webglTexture=E.createTexture(),Vi.__version=Qt.version,O.memory.textures++);const ji=At.isWebGLCubeRenderTarget===!0,ir=At.isWebGLMultipleRenderTargets===!0,$n=At.isWebGLMultisampleRenderTarget===!0,$i=Qt.isDataTexture3D||Qt.isDataTexture2DArray,Mt=_e(At)||k;if(!k||Qt.format!==1022||Qt.type!==1015&&Qt.type!==1016||(Qt.format=1023,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),ji){xn.__webglFramebuffer=[];for(let Oi=0;Oi<6;Oi++)xn.__webglFramebuffer[Oi]=E.createFramebuffer()}else if(xn.__webglFramebuffer=E.createFramebuffer(),ir)if(y.drawBuffers){const Oi=At.texture;for(let Ln=0,Bn=Oi.length;Ln<Bn;Ln++){const Rn=_.get(Oi[Ln]);Rn.__webglTexture===void 0&&(Rn.__webglTexture=E.createTexture(),O.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if($n)if(k){xn.__webglMultisampledFramebuffer=E.createFramebuffer(),xn.__webglColorRenderbuffer=E.createRenderbuffer(),E.bindRenderbuffer(36161,xn.__webglColorRenderbuffer);const Oi=S.convert(Qt.format),Ln=S.convert(Qt.type),Bn=ot(Qt.internalFormat,Oi,Ln),Rn=Zr(At);E.renderbufferStorageMultisample(36161,Rn,Bn,At.width,At.height),l.bindFramebuffer(36160,xn.__webglMultisampledFramebuffer),E.framebufferRenderbuffer(36160,36064,36161,xn.__webglColorRenderbuffer),E.bindRenderbuffer(36161,null),At.depthBuffer&&(xn.__webglDepthRenderbuffer=E.createRenderbuffer(),Cr(xn.__webglDepthRenderbuffer,At,!0)),l.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(ji){l.bindTexture(34067,Vi.__webglTexture),Gn(34067,Qt,Mt);for(let Oi=0;Oi<6;Oi++)Mr(xn.__webglFramebuffer[Oi],At,Qt,36064,34069+Oi);$e(Qt,Mt)&&st(34067,Qt,At.width,At.height),l.unbindTexture()}else if(ir){const Oi=At.texture;for(let Ln=0,Bn=Oi.length;Ln<Bn;Ln++){const Rn=Oi[Ln],Dr=_.get(Rn);l.bindTexture(3553,Dr.__webglTexture),Gn(3553,Rn,Mt),Mr(xn.__webglFramebuffer,At,Rn,36064+Ln,3553),$e(Rn,Mt)&&st(3553,Rn,At.width,At.height)}l.unbindTexture()}else{let Oi=3553;$i&&(k?Oi=Qt.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),l.bindTexture(Oi,Vi.__webglTexture),Gn(Oi,Qt,Mt),Mr(xn.__webglFramebuffer,At,Qt,36064,Oi),$e(Qt,Mt)&&st(Oi,Qt,At.width,At.height,At.depth),l.unbindTexture()}At.depthBuffer&&kr(At)},this.updateRenderTargetMipmap=function(At){const Qt=_e(At)||k,xn=At.isWebGLMultipleRenderTargets===!0?At.texture:[At.texture];for(let Vi=0,ji=xn.length;Vi<ji;Vi++){const ir=xn[Vi];if($e(ir,Qt)){const $n=At.isWebGLCubeRenderTarget?34067:3553,$i=_.get(ir).__webglTexture;l.bindTexture($n,$i),st($n,ir,At.width,At.height),l.unbindTexture()}}},this.updateMultisampleRenderTarget=function(At){if(At.isWebGLMultisampleRenderTarget)if(k){const Qt=At.width,xn=At.height;let Vi=16384;At.depthBuffer&&(Vi|=256),At.stencilBuffer&&(Vi|=1024);const ji=_.get(At);l.bindFramebuffer(36008,ji.__webglMultisampledFramebuffer),l.bindFramebuffer(36009,ji.__webglFramebuffer),E.blitFramebuffer(0,0,Qt,xn,0,0,Qt,xn,Vi,9728),l.bindFramebuffer(36008,null),l.bindFramebuffer(36009,ji.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(At,Qt){At&&At.isWebGLRenderTarget&&(la===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),la=!0),At=At.texture),Ki(At,Qt)},this.safeSetTextureCube=function(At,Qt){At&&At.isWebGLCubeRenderTarget&&(Kn===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),Kn=!0),At=At.texture),Bi(At,Qt)}}function qu(E,e,l){const _=l.isWebGL2;return{convert:function(y){let S;if(y===1009)return 5121;if(y===1017)return 32819;if(y===1018)return 32820;if(y===1019)return 33635;if(y===1010)return 5120;if(y===1011)return 5122;if(y===1012)return 5123;if(y===1013)return 5124;if(y===1014)return 5125;if(y===1015)return 5126;if(y===1016)return _?5131:(S=e.get("OES_texture_half_float"),S!==null?S.HALF_FLOAT_OES:null);if(y===1021)return 6406;if(y===1022)return 6407;if(y===1023)return 6408;if(y===1024)return 6409;if(y===1025)return 6410;if(y===1026)return 6402;if(y===1027)return 34041;if(y===1028)return 6403;if(y===1029)return 36244;if(y===1030)return 33319;if(y===1031)return 33320;if(y===1032)return 36248;if(y===1033)return 36249;if(y===33776||y===33777||y===33778||y===33779){if(S=e.get("WEBGL_compressed_texture_s3tc"),S===null)return null;if(y===33776)return S.COMPRESSED_RGB_S3TC_DXT1_EXT;if(y===33777)return S.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(y===33778)return S.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(y===33779)return S.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(y===35840||y===35841||y===35842||y===35843){if(S=e.get("WEBGL_compressed_texture_pvrtc"),S===null)return null;if(y===35840)return S.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(y===35841)return S.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(y===35842)return S.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(y===35843)return S.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(y===36196)return S=e.get("WEBGL_compressed_texture_etc1"),S!==null?S.COMPRESSED_RGB_ETC1_WEBGL:null;if((y===37492||y===37496)&&(S=e.get("WEBGL_compressed_texture_etc"),S!==null)){if(y===37492)return S.COMPRESSED_RGB8_ETC2;if(y===37496)return S.COMPRESSED_RGBA8_ETC2_EAC}return y===37808||y===37809||y===37810||y===37811||y===37812||y===37813||y===37814||y===37815||y===37816||y===37817||y===37818||y===37819||y===37820||y===37821||y===37840||y===37841||y===37842||y===37843||y===37844||y===37845||y===37846||y===37847||y===37848||y===37849||y===37850||y===37851||y===37852||y===37853?(S=e.get("WEBGL_compressed_texture_astc"),S!==null?y:null):y===36492?(S=e.get("EXT_texture_compression_bptc"),S!==null?y:null):y===1020?_?34042:(S=e.get("WEBGL_depth_texture"),S!==null?S.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class Eh extends rr{constructor(e=[]){super(),this.cameras=e}}Eh.prototype.isArrayCamera=!0;class ol extends we{constructor(){super(),this.type="Group"}}ol.prototype.isGroup=!0;const Ah={type:"move"};class cu{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ol,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ol,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ht,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ht),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ol,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ht,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ht),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,l,_){let y=null,S=null,O=null;const k=this._targetRay,N=this._grip,G=this._hand;if(e&&l.session.visibilityState!=="visible-blurred")if(k!==null&&(y=l.getPose(e.targetRaySpace,_),y!==null&&(k.matrix.fromArray(y.transform.matrix),k.matrix.decompose(k.position,k.rotation,k.scale),y.linearVelocity?(k.hasLinearVelocity=!0,k.linearVelocity.copy(y.linearVelocity)):k.hasLinearVelocity=!1,y.angularVelocity?(k.hasAngularVelocity=!0,k.angularVelocity.copy(y.angularVelocity)):k.hasAngularVelocity=!1,this.dispatchEvent(Ah))),G&&e.hand){O=!0;for(const ye of e.hand.values()){const Se=l.getJointPose(ye,_);if(G.joints[ye.jointName]===void 0){const $e=new ol;$e.matrixAutoUpdate=!1,$e.visible=!1,G.joints[ye.jointName]=$e,G.add($e)}const _e=G.joints[ye.jointName];Se!==null&&(_e.matrix.fromArray(Se.transform.matrix),_e.matrix.decompose(_e.position,_e.rotation,_e.scale),_e.jointRadius=Se.radius),_e.visible=Se!==null}const $=G.joints["index-finger-tip"],K=G.joints["thumb-tip"],ie=$.position.distanceTo(K.position),ne=.02,ue=.005;G.inputState.pinching&&ie>ne+ue?(G.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!G.inputState.pinching&&ie<=ne-ue&&(G.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else N!==null&&e.gripSpace&&(S=l.getPose(e.gripSpace,_),S!==null&&(N.matrix.fromArray(S.transform.matrix),N.matrix.decompose(N.position,N.rotation,N.scale),S.linearVelocity?(N.hasLinearVelocity=!0,N.linearVelocity.copy(S.linearVelocity)):N.hasLinearVelocity=!1,S.angularVelocity?(N.hasAngularVelocity=!0,N.angularVelocity.copy(S.angularVelocity)):N.hasAngularVelocity=!1));return k!==null&&(k.visible=y!==null),N!==null&&(N.visible=S!==null),G!==null&&(G.visible=O!==null),this}}class Ch extends ii{constructor(e,l){super();const _=this,y=e.state;let S=null,O=1,k=null,N="local-floor",G=null,$=null,K=null,ie=null,ne=null,ue=!1,ye=null,Se=null,_e=null,$e=null,st=null,ot=null;const Lt=[],Bt=new Map,di=new rr;di.layers.enable(1),di.viewport=new qr;const Ti=new rr;Ti.layers.enable(2),Ti.viewport=new qr;const Ki=[di,Ti],Bi=new Eh;Bi.layers.enable(1),Bi.layers.enable(2);let Zi=null,hr=null;function Gn(Kn){const At=Bt.get(Kn.inputSource);At&&At.dispatchEvent({type:Kn.type,data:Kn.inputSource})}function gn(){Bt.forEach(function(Kn,At){Kn.disconnect(At)}),Bt.clear(),Zi=null,hr=null,y.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),K&&l.deleteFramebuffer(K),ye&&l.deleteFramebuffer(ye),Se&&l.deleteRenderbuffer(Se),_e&&l.deleteRenderbuffer(_e),K=null,ye=null,Se=null,_e=null,ne=null,ie=null,$=null,S=null,la.stop(),_.isPresenting=!1,_.dispatchEvent({type:"sessionend"})}function Yn(Kn){const At=S.inputSources;for(let Qt=0;Qt<Lt.length;Qt++)Bt.set(At[Qt],Lt[Qt]);for(let Qt=0;Qt<Kn.removed.length;Qt++){const xn=Kn.removed[Qt],Vi=Bt.get(xn);Vi&&(Vi.dispatchEvent({type:"disconnected",data:xn}),Bt.delete(xn))}for(let Qt=0;Qt<Kn.added.length;Qt++){const xn=Kn.added[Qt],Vi=Bt.get(xn);Vi&&Vi.dispatchEvent({type:"connected",data:xn})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Kn){let At=Lt[Kn];return At===void 0&&(At=new cu,Lt[Kn]=At),At.getTargetRaySpace()},this.getControllerGrip=function(Kn){let At=Lt[Kn];return At===void 0&&(At=new cu,Lt[Kn]=At),At.getGripSpace()},this.getHand=function(Kn){let At=Lt[Kn];return At===void 0&&(At=new cu,Lt[Kn]=At),At.getHandSpace()},this.setFramebufferScaleFactor=function(Kn){O=Kn,_.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Kn){N=Kn,_.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return k},this.getBaseLayer=function(){return ie!==null?ie:ne},this.getBinding=function(){return $},this.getFrame=function(){return $e},this.getSession=function(){return S},this.setSession=async function(Kn){if(S=Kn,S!==null){S.addEventListener("select",Gn),S.addEventListener("selectstart",Gn),S.addEventListener("selectend",Gn),S.addEventListener("squeeze",Gn),S.addEventListener("squeezestart",Gn),S.addEventListener("squeezeend",Gn),S.addEventListener("end",gn),S.addEventListener("inputsourceschange",Yn);const At=l.getContextAttributes();if(At.xrCompatible!==!0&&await l.makeXRCompatible(),S.renderState.layers===void 0){const Qt={antialias:At.antialias,alpha:At.alpha,depth:At.depth,stencil:At.stencil,framebufferScaleFactor:O};ne=new XRWebGLLayer(S,l,Qt),S.updateRenderState({baseLayer:ne})}else if(l instanceof WebGLRenderingContext){const Qt={antialias:!0,alpha:At.alpha,depth:At.depth,stencil:At.stencil,framebufferScaleFactor:O};ne=new XRWebGLLayer(S,l,Qt),S.updateRenderState({layers:[ne]})}else{ue=At.antialias;let Qt=null;At.depth&&(ot=256,At.stencil&&(ot|=1024),st=At.stencil?33306:36096,Qt=At.stencil?35056:33190);const xn={colorFormat:At.alpha?32856:32849,depthFormat:Qt,scaleFactor:O};$=new XRWebGLBinding(S,l),ie=$.createProjectionLayer(xn),K=l.createFramebuffer(),S.updateRenderState({layers:[ie]}),ue&&(ye=l.createFramebuffer(),Se=l.createRenderbuffer(),l.bindRenderbuffer(36161,Se),l.renderbufferStorageMultisample(36161,4,32856,ie.textureWidth,ie.textureHeight),y.bindFramebuffer(36160,ye),l.framebufferRenderbuffer(36160,36064,36161,Se),l.bindRenderbuffer(36161,null),Qt!==null&&(_e=l.createRenderbuffer(),l.bindRenderbuffer(36161,_e),l.renderbufferStorageMultisample(36161,4,Qt,ie.textureWidth,ie.textureHeight),l.framebufferRenderbuffer(36160,st,36161,_e),l.bindRenderbuffer(36161,null)),y.bindFramebuffer(36160,null))}k=await S.requestReferenceSpace(N),la.setContext(S),la.start(),_.isPresenting=!0,_.dispatchEvent({type:"sessionstart"})}};const Mr=new ht,Cr=new ht;function kr(Kn,At){At===null?Kn.matrixWorld.copy(Kn.matrix):Kn.matrixWorld.multiplyMatrices(At.matrixWorld,Kn.matrix),Kn.matrixWorldInverse.copy(Kn.matrixWorld).invert()}this.updateCamera=function(Kn){if(S===null)return;Bi.near=Ti.near=di.near=Kn.near,Bi.far=Ti.far=di.far=Kn.far,Zi===Bi.near&&hr===Bi.far||(S.updateRenderState({depthNear:Bi.near,depthFar:Bi.far}),Zi=Bi.near,hr=Bi.far);const At=Kn.parent,Qt=Bi.cameras;kr(Bi,At);for(let Vi=0;Vi<Qt.length;Vi++)kr(Qt[Vi],At);Bi.matrixWorld.decompose(Bi.position,Bi.quaternion,Bi.scale),Kn.position.copy(Bi.position),Kn.quaternion.copy(Bi.quaternion),Kn.scale.copy(Bi.scale),Kn.matrix.copy(Bi.matrix),Kn.matrixWorld.copy(Bi.matrixWorld);const xn=Kn.children;for(let Vi=0,ji=xn.length;Vi<ji;Vi++)xn[Vi].updateMatrixWorld(!0);Qt.length===2?function(Vi,ji,ir){Mr.setFromMatrixPosition(ji.matrixWorld),Cr.setFromMatrixPosition(ir.matrixWorld);const $n=Mr.distanceTo(Cr),$i=ji.projectionMatrix.elements,Mt=ir.projectionMatrix.elements,Oi=$i[14]/($i[10]-1),Ln=$i[14]/($i[10]+1),Bn=($i[9]+1)/$i[5],Rn=($i[9]-1)/$i[5],Dr=($i[8]-1)/$i[0],Qr=(Mt[8]+1)/Mt[0],Or=Oi*Dr,Ba=Oi*Qr,Ea=$n/(-Dr+Qr),nl=Ea*-Dr;ji.matrixWorld.decompose(Vi.position,Vi.quaternion,Vi.scale),Vi.translateX(nl),Vi.translateZ(Ea),Vi.matrixWorld.compose(Vi.position,Vi.quaternion,Vi.scale),Vi.matrixWorldInverse.copy(Vi.matrixWorld).invert();const os=Oi+Ea,_o=Ln+Ea,dc=Or-nl,of=Ba+($n-nl),Jc=Bn*Ln/_o*os,Tu=Rn*Ln/_o*os;Vi.projectionMatrix.makePerspective(dc,of,Jc,Tu,os,_o)}(Bi,di,Ti):Bi.projectionMatrix.copy(di.projectionMatrix)},this.getCamera=function(){return Bi},this.getFoveation=function(){return ie!==null?ie.fixedFoveation:ne!==null?ne.fixedFoveation:void 0},this.setFoveation=function(Kn){ie!==null&&(ie.fixedFoveation=Kn),ne!==null&&ne.fixedFoveation!==void 0&&(ne.fixedFoveation=Kn)};let Zr=null;const la=new wo;la.setAnimationLoop(function(Kn,At){if(G=At.getViewerPose(k),$e=At,G!==null){const xn=G.views;ne!==null&&y.bindXRFramebuffer(ne.framebuffer);let Vi=!1;xn.length!==Bi.cameras.length&&(Bi.cameras.length=0,Vi=!0);for(let ji=0;ji<xn.length;ji++){const ir=xn[ji];let $n=null;if(ne!==null)$n=ne.getViewport(ir);else{const Mt=$.getViewSubImage(ie,ir);y.bindXRFramebuffer(K),Mt.depthStencilTexture!==void 0&&l.framebufferTexture2D(36160,st,3553,Mt.depthStencilTexture,0),l.framebufferTexture2D(36160,36064,3553,Mt.colorTexture,0),$n=Mt.viewport}const $i=Ki[ji];$i.matrix.fromArray(ir.transform.matrix),$i.projectionMatrix.fromArray(ir.projectionMatrix),$i.viewport.set($n.x,$n.y,$n.width,$n.height),ji===0&&Bi.matrix.copy($i.matrix),Vi===!0&&Bi.cameras.push($i)}ue&&(y.bindXRFramebuffer(ye),ot!==null&&l.clear(ot))}const Qt=S.inputSources;for(let xn=0;xn<Lt.length;xn++){const Vi=Lt[xn],ji=Qt[xn];Vi.update(ji,At,k)}if(Zr&&Zr(Kn,At),ue){const xn=ie.textureWidth,Vi=ie.textureHeight;y.bindFramebuffer(36008,ye),y.bindFramebuffer(36009,K),l.invalidateFramebuffer(36008,[st]),l.invalidateFramebuffer(36009,[st]),l.blitFramebuffer(0,0,xn,Vi,0,0,xn,Vi,16384,9728),l.invalidateFramebuffer(36008,[36064]),y.bindFramebuffer(36008,null),y.bindFramebuffer(36009,null),y.bindFramebuffer(36160,ye)}$e=null}),this.setAnimationLoop=function(Kn){Zr=Kn},this.dispose=function(){}}}function id(E){function e(_,y){_.opacity.value=y.opacity,y.color&&_.diffuse.value.copy(y.color),y.emissive&&_.emissive.value.copy(y.emissive).multiplyScalar(y.emissiveIntensity),y.map&&(_.map.value=y.map),y.alphaMap&&(_.alphaMap.value=y.alphaMap),y.specularMap&&(_.specularMap.value=y.specularMap),y.alphaTest>0&&(_.alphaTest.value=y.alphaTest);const S=E.get(y).envMap;if(S){_.envMap.value=S,_.flipEnvMap.value=S.isCubeTexture&&S.isRenderTargetTexture===!1?-1:1,_.reflectivity.value=y.reflectivity,_.ior.value=y.ior,_.refractionRatio.value=y.refractionRatio;const N=E.get(S).__maxMipLevel;N!==void 0&&(_.maxMipLevel.value=N)}let O,k;y.lightMap&&(_.lightMap.value=y.lightMap,_.lightMapIntensity.value=y.lightMapIntensity),y.aoMap&&(_.aoMap.value=y.aoMap,_.aoMapIntensity.value=y.aoMapIntensity),y.map?O=y.map:y.specularMap?O=y.specularMap:y.displacementMap?O=y.displacementMap:y.normalMap?O=y.normalMap:y.bumpMap?O=y.bumpMap:y.roughnessMap?O=y.roughnessMap:y.metalnessMap?O=y.metalnessMap:y.alphaMap?O=y.alphaMap:y.emissiveMap?O=y.emissiveMap:y.clearcoatMap?O=y.clearcoatMap:y.clearcoatNormalMap?O=y.clearcoatNormalMap:y.clearcoatRoughnessMap?O=y.clearcoatRoughnessMap:y.specularIntensityMap?O=y.specularIntensityMap:y.specularTintMap?O=y.specularTintMap:y.transmissionMap?O=y.transmissionMap:y.thicknessMap&&(O=y.thicknessMap),O!==void 0&&(O.isWebGLRenderTarget&&(O=O.texture),O.matrixAutoUpdate===!0&&O.updateMatrix(),_.uvTransform.value.copy(O.matrix)),y.aoMap?k=y.aoMap:y.lightMap&&(k=y.lightMap),k!==void 0&&(k.isWebGLRenderTarget&&(k=k.texture),k.matrixAutoUpdate===!0&&k.updateMatrix(),_.uv2Transform.value.copy(k.matrix))}function l(_,y){_.roughness.value=y.roughness,_.metalness.value=y.metalness,y.roughnessMap&&(_.roughnessMap.value=y.roughnessMap),y.metalnessMap&&(_.metalnessMap.value=y.metalnessMap),y.emissiveMap&&(_.emissiveMap.value=y.emissiveMap),y.bumpMap&&(_.bumpMap.value=y.bumpMap,_.bumpScale.value=y.bumpScale,y.side===1&&(_.bumpScale.value*=-1)),y.normalMap&&(_.normalMap.value=y.normalMap,_.normalScale.value.copy(y.normalScale),y.side===1&&_.normalScale.value.negate()),y.displacementMap&&(_.displacementMap.value=y.displacementMap,_.displacementScale.value=y.displacementScale,_.displacementBias.value=y.displacementBias),E.get(y).envMap&&(_.envMapIntensity.value=y.envMapIntensity)}return{refreshFogUniforms:function(_,y){_.fogColor.value.copy(y.color),y.isFog?(_.fogNear.value=y.near,_.fogFar.value=y.far):y.isFogExp2&&(_.fogDensity.value=y.density)},refreshMaterialUniforms:function(_,y,S,O,k){y.isMeshBasicMaterial?e(_,y):y.isMeshLambertMaterial?(e(_,y),function(N,G){G.emissiveMap&&(N.emissiveMap.value=G.emissiveMap)}(_,y)):y.isMeshToonMaterial?(e(_,y),function(N,G){G.gradientMap&&(N.gradientMap.value=G.gradientMap),G.emissiveMap&&(N.emissiveMap.value=G.emissiveMap),G.bumpMap&&(N.bumpMap.value=G.bumpMap,N.bumpScale.value=G.bumpScale,G.side===1&&(N.bumpScale.value*=-1)),G.normalMap&&(N.normalMap.value=G.normalMap,N.normalScale.value.copy(G.normalScale),G.side===1&&N.normalScale.value.negate()),G.displacementMap&&(N.displacementMap.value=G.displacementMap,N.displacementScale.value=G.displacementScale,N.displacementBias.value=G.displacementBias)}(_,y)):y.isMeshPhongMaterial?(e(_,y),function(N,G){N.specular.value.copy(G.specular),N.shininess.value=Math.max(G.shininess,1e-4),G.emissiveMap&&(N.emissiveMap.value=G.emissiveMap),G.bumpMap&&(N.bumpMap.value=G.bumpMap,N.bumpScale.value=G.bumpScale,G.side===1&&(N.bumpScale.value*=-1)),G.normalMap&&(N.normalMap.value=G.normalMap,N.normalScale.value.copy(G.normalScale),G.side===1&&N.normalScale.value.negate()),G.displacementMap&&(N.displacementMap.value=G.displacementMap,N.displacementScale.value=G.displacementScale,N.displacementBias.value=G.displacementBias)}(_,y)):y.isMeshStandardMaterial?(e(_,y),y.isMeshPhysicalMaterial?function(N,G,$){l(N,G),N.ior.value=G.ior,G.sheenTint&&N.sheenTint.value.copy(G.sheenTint),G.clearcoat>0&&(N.clearcoat.value=G.clearcoat,N.clearcoatRoughness.value=G.clearcoatRoughness,G.clearcoatMap&&(N.clearcoatMap.value=G.clearcoatMap),G.clearcoatRoughnessMap&&(N.clearcoatRoughnessMap.value=G.clearcoatRoughnessMap),G.clearcoatNormalMap&&(N.clearcoatNormalScale.value.copy(G.clearcoatNormalScale),N.clearcoatNormalMap.value=G.clearcoatNormalMap,G.side===1&&N.clearcoatNormalScale.value.negate())),G.transmission>0&&(N.transmission.value=G.transmission,N.transmissionSamplerMap.value=$.texture,N.transmissionSamplerSize.value.set($.width,$.height),G.transmissionMap&&(N.transmissionMap.value=G.transmissionMap),N.thickness.value=G.thickness,G.thicknessMap&&(N.thicknessMap.value=G.thicknessMap),N.attenuationDistance.value=G.attenuationDistance,N.attenuationTint.value.copy(G.attenuationTint)),N.specularIntensity.value=G.specularIntensity,N.specularTint.value.copy(G.specularTint),G.specularIntensityMap&&(N.specularIntensityMap.value=G.specularIntensityMap),G.specularTintMap&&(N.specularTintMap.value=G.specularTintMap)}(_,y,k):l(_,y)):y.isMeshMatcapMaterial?(e(_,y),function(N,G){G.matcap&&(N.matcap.value=G.matcap),G.bumpMap&&(N.bumpMap.value=G.bumpMap,N.bumpScale.value=G.bumpScale,G.side===1&&(N.bumpScale.value*=-1)),G.normalMap&&(N.normalMap.value=G.normalMap,N.normalScale.value.copy(G.normalScale),G.side===1&&N.normalScale.value.negate()),G.displacementMap&&(N.displacementMap.value=G.displacementMap,N.displacementScale.value=G.displacementScale,N.displacementBias.value=G.displacementBias)}(_,y)):y.isMeshDepthMaterial?(e(_,y),function(N,G){G.displacementMap&&(N.displacementMap.value=G.displacementMap,N.displacementScale.value=G.displacementScale,N.displacementBias.value=G.displacementBias)}(_,y)):y.isMeshDistanceMaterial?(e(_,y),function(N,G){G.displacementMap&&(N.displacementMap.value=G.displacementMap,N.displacementScale.value=G.displacementScale,N.displacementBias.value=G.displacementBias),N.referencePosition.value.copy(G.referencePosition),N.nearDistance.value=G.nearDistance,N.farDistance.value=G.farDistance}(_,y)):y.isMeshNormalMaterial?(e(_,y),function(N,G){G.bumpMap&&(N.bumpMap.value=G.bumpMap,N.bumpScale.value=G.bumpScale,G.side===1&&(N.bumpScale.value*=-1)),G.normalMap&&(N.normalMap.value=G.normalMap,N.normalScale.value.copy(G.normalScale),G.side===1&&N.normalScale.value.negate()),G.displacementMap&&(N.displacementMap.value=G.displacementMap,N.displacementScale.value=G.displacementScale,N.displacementBias.value=G.displacementBias)}(_,y)):y.isLineBasicMaterial?(function(N,G){N.diffuse.value.copy(G.color),N.opacity.value=G.opacity}(_,y),y.isLineDashedMaterial&&function(N,G){N.dashSize.value=G.dashSize,N.totalSize.value=G.dashSize+G.gapSize,N.scale.value=G.scale}(_,y)):y.isPointsMaterial?function(N,G,$,K){N.diffuse.value.copy(G.color),N.opacity.value=G.opacity,N.size.value=G.size*$,N.scale.value=.5*K,G.map&&(N.map.value=G.map),G.alphaMap&&(N.alphaMap.value=G.alphaMap),G.alphaTest>0&&(N.alphaTest.value=G.alphaTest);let ie;G.map?ie=G.map:G.alphaMap&&(ie=G.alphaMap),ie!==void 0&&(ie.matrixAutoUpdate===!0&&ie.updateMatrix(),N.uvTransform.value.copy(ie.matrix))}(_,y,S,O):y.isSpriteMaterial?function(N,G){N.diffuse.value.copy(G.color),N.opacity.value=G.opacity,N.rotation.value=G.rotation,G.map&&(N.map.value=G.map),G.alphaMap&&(N.alphaMap.value=G.alphaMap),G.alphaTest>0&&(N.alphaTest.value=G.alphaTest);let $;G.map?$=G.map:G.alphaMap&&($=G.alphaMap),$!==void 0&&($.matrixAutoUpdate===!0&&$.updateMatrix(),N.uvTransform.value.copy($.matrix))}(_,y):y.isShadowMaterial?(_.color.value.copy(y.color),_.opacity.value=y.opacity):y.isShaderMaterial&&(y.uniformsNeedUpdate=!1)}}}function Ri(E={}){const e=E.canvas!==void 0?E.canvas:function(){const zt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return zt.style.display="block",zt}(),l=E.context!==void 0?E.context:null,_=E.alpha!==void 0&&E.alpha,y=E.depth===void 0||E.depth,S=E.stencil===void 0||E.stencil,O=E.antialias!==void 0&&E.antialias,k=E.premultipliedAlpha===void 0||E.premultipliedAlpha,N=E.preserveDrawingBuffer!==void 0&&E.preserveDrawingBuffer,G=E.powerPreference!==void 0?E.powerPreference:"default",$=E.failIfMajorPerformanceCaveat!==void 0&&E.failIfMajorPerformanceCaveat;let K=null,ie=null;const ne=[],ue=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const ye=this;let Se=!1,_e=0,$e=0,st=null,ot=-1,Lt=null;const Bt=new qr,di=new qr;let Ti=null,Ki=e.width,Bi=e.height,Zi=1,hr=null,Gn=null;const gn=new qr(0,0,Ki,Bi),Yn=new qr(0,0,Ki,Bi);let Mr=!1;const Cr=[],kr=new yc;let Zr=!1,la=!1,Kn=null;const At=new tr,Qt=new ht,xn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Vi(){return st===null?Zi:1}let ji,ir,$n,$i,Mt,Oi,Ln,Bn,Rn,Dr,Qr,Or,Ba,Ea,nl,os,_o,dc,of,Jc,Tu,Qc,bl,er=l;function lf(zt,_n){for(let Ni=0;Ni<zt.length;Ni++){const pn=zt[Ni],Qn=e.getContext(pn,_n);if(Qn!==null)return Qn}return null}try{const zt={alpha:_,depth:y,stencil:S,antialias:O,premultipliedAlpha:k,preserveDrawingBuffer:N,powerPreference:G,failIfMajorPerformanceCaveat:$};if(e.addEventListener("webglcontextlost",um,!1),e.addEventListener("webglcontextrestored",Sm,!1),er===null){const _n=["webgl2","webgl","experimental-webgl"];if(ye.isWebGL1Renderer===!0&&_n.shift(),er=lf(_n,zt),er===null)throw lf(_n)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}er.getShaderPrecisionFormat===void 0&&(er.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(zt){throw console.error("THREE.WebGLRenderer: "+zt.message),zt}function sp(){ji=new nc(er),ir=new fp(er,ji,E),ji.init(ir),Qc=new qu(er,ji,ir),$n=new Ka(er,ji,ir),Cr[0]=1029,$i=new Yh,Mt=new Hd,Oi=new Sh(er,ji,$n,Mt,ir,Qc,$i),Ln=new pp(ye),Bn=new Xh(ye),Rn=new Iu(er,ir),bl=new Op(er,ji,Rn,ir),Dr=new fh(er,Rn,$i,bl),Qr=new zd(er,Dr,Rn,$i),of=new Kh(er),os=new Bp(Mt),Or=new Gd(ye,Ln,Bn,ji,ir,bl,os),Ba=new id(Mt),Ea=new wf(Mt),nl=new Th(ji,ir),dc=new qf(ye,Ln,$n,Qr,k),_o=new us(ye,Qr,ir),Jc=new Wf(er,ji,$i,ir),Tu=new ua(er,ji,$i,ir),$i.programs=Or.programs,ye.capabilities=ir,ye.extensions=ji,ye.properties=Mt,ye.renderLists=Ea,ye.shadowMap=_o,ye.state=$n,ye.info=$i}sp();const fc=new Ch(ye,er);function um(zt){zt.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Se=!0}function Sm(){console.log("THREE.WebGLRenderer: Context Restored."),Se=!1;const zt=$i.autoReset,_n=_o.enabled,Ni=_o.autoUpdate,pn=_o.needsUpdate,Qn=_o.type;sp(),$i.autoReset=zt,_o.enabled=_n,_o.autoUpdate=Ni,_o.needsUpdate=pn,_o.type=Qn}function hm(zt){const _n=zt.target;_n.removeEventListener("dispose",hm),function(Ni){(function(pn){const Qn=Mt.get(pn).programs;Qn!==void 0&&Qn.forEach(function(ya){Or.releaseProgram(ya)})})(Ni),Mt.remove(Ni)}(_n)}this.xr=fc,this.getContext=function(){return er},this.getContextAttributes=function(){return er.getContextAttributes()},this.forceContextLoss=function(){const zt=ji.get("WEBGL_lose_context");zt&&zt.loseContext()},this.forceContextRestore=function(){const zt=ji.get("WEBGL_lose_context");zt&&zt.restoreContext()},this.getPixelRatio=function(){return Zi},this.setPixelRatio=function(zt){zt!==void 0&&(Zi=zt,this.setSize(Ki,Bi,!1))},this.getSize=function(zt){return zt.set(Ki,Bi)},this.setSize=function(zt,_n,Ni){fc.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Ki=zt,Bi=_n,e.width=Math.floor(zt*Zi),e.height=Math.floor(_n*Zi),Ni!==!1&&(e.style.width=zt+"px",e.style.height=_n+"px"),this.setViewport(0,0,zt,_n))},this.getDrawingBufferSize=function(zt){return zt.set(Ki*Zi,Bi*Zi).floor()},this.setDrawingBufferSize=function(zt,_n,Ni){Ki=zt,Bi=_n,Zi=Ni,e.width=Math.floor(zt*Ni),e.height=Math.floor(_n*Ni),this.setViewport(0,0,zt,_n)},this.getCurrentViewport=function(zt){return zt.copy(Bt)},this.getViewport=function(zt){return zt.copy(gn)},this.setViewport=function(zt,_n,Ni,pn){zt.isVector4?gn.set(zt.x,zt.y,zt.z,zt.w):gn.set(zt,_n,Ni,pn),$n.viewport(Bt.copy(gn).multiplyScalar(Zi).floor())},this.getScissor=function(zt){return zt.copy(Yn)},this.setScissor=function(zt,_n,Ni,pn){zt.isVector4?Yn.set(zt.x,zt.y,zt.z,zt.w):Yn.set(zt,_n,Ni,pn),$n.scissor(di.copy(Yn).multiplyScalar(Zi).floor())},this.getScissorTest=function(){return Mr},this.setScissorTest=function(zt){$n.setScissorTest(Mr=zt)},this.setOpaqueSort=function(zt){hr=zt},this.setTransparentSort=function(zt){Gn=zt},this.getClearColor=function(zt){return zt.copy(dc.getClearColor())},this.setClearColor=function(){dc.setClearColor.apply(dc,arguments)},this.getClearAlpha=function(){return dc.getClearAlpha()},this.setClearAlpha=function(){dc.setClearAlpha.apply(dc,arguments)},this.clear=function(zt,_n,Ni){let pn=0;(zt===void 0||zt)&&(pn|=16384),(_n===void 0||_n)&&(pn|=256),(Ni===void 0||Ni)&&(pn|=1024),er.clear(pn)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",um,!1),e.removeEventListener("webglcontextrestored",Sm,!1),Ea.dispose(),nl.dispose(),Mt.dispose(),Ln.dispose(),Bn.dispose(),Qr.dispose(),bl.dispose(),fc.dispose(),fc.removeEventListener("sessionstart",Em),fc.removeEventListener("sessionend",Am),Kn&&(Kn.dispose(),Kn=null),kf.stop()},this.renderBufferImmediate=function(zt,_n){bl.initAttributes();const Ni=Mt.get(zt);zt.hasPositions&&!Ni.position&&(Ni.position=er.createBuffer()),zt.hasNormals&&!Ni.normal&&(Ni.normal=er.createBuffer()),zt.hasUvs&&!Ni.uv&&(Ni.uv=er.createBuffer()),zt.hasColors&&!Ni.color&&(Ni.color=er.createBuffer());const pn=_n.getAttributes();zt.hasPositions&&(er.bindBuffer(34962,Ni.position),er.bufferData(34962,zt.positionArray,35048),bl.enableAttribute(pn.position.location),er.vertexAttribPointer(pn.position.location,3,5126,!1,0,0)),zt.hasNormals&&(er.bindBuffer(34962,Ni.normal),er.bufferData(34962,zt.normalArray,35048),bl.enableAttribute(pn.normal.location),er.vertexAttribPointer(pn.normal.location,3,5126,!1,0,0)),zt.hasUvs&&(er.bindBuffer(34962,Ni.uv),er.bufferData(34962,zt.uvArray,35048),bl.enableAttribute(pn.uv.location),er.vertexAttribPointer(pn.uv.location,2,5126,!1,0,0)),zt.hasColors&&(er.bindBuffer(34962,Ni.color),er.bufferData(34962,zt.colorArray,35048),bl.enableAttribute(pn.color.location),er.vertexAttribPointer(pn.color.location,3,5126,!1,0,0)),bl.disableUnusedAttributes(),er.drawArrays(4,0,zt.count),zt.count=0},this.renderBufferDirect=function(zt,_n,Ni,pn,Qn,ya){_n===null&&(_n=xn);const Xr=Qn.isMesh&&Qn.matrixWorld.determinant()<0,Aa=Kp(zt,_n,pn,Qn);$n.setMaterial(pn,Xr);let Ga=Ni.index;const Ds=Ni.attributes.position;if(Ga===null){if(Ds===void 0||Ds.count===0)return}else if(Ga.count===0)return;let Wa,Ha=1;pn.wireframe===!0&&(Ga=Dr.getWireframeAttribute(Ni),Ha=2),Ni.morphAttributes.position===void 0&&Ni.morphAttributes.normal===void 0||of.update(Qn,Ni,pn,Aa),bl.setup(Qn,pn,Aa,Ni,Ga);let La=Jc;Ga!==null&&(Wa=Rn.get(Ga),La=Tu,La.setIndex(Wa));const Ed=Ga!==null?Ga.count:Ds.count,Bs=Ni.drawRange.start*Ha,pc=Ni.drawRange.count*Ha,wl=ya!==null?ya.start*Ha:0,nh=ya!==null?ya.count*Ha:1/0,Su=Math.max(Bs,wl),Ys=Math.min(Ed,Bs+pc,wl+nh)-1,Nh=Math.max(0,Ys-Su+1);if(Nh!==0){if(Qn.isMesh)pn.wireframe===!0?($n.setLineWidth(pn.wireframeLinewidth*Vi()),La.setMode(1)):La.setMode(4);else if(Qn.isLine){let hs=pn.linewidth;hs===void 0&&(hs=1),$n.setLineWidth(hs*Vi()),Qn.isLineSegments?La.setMode(1):Qn.isLineLoop?La.setMode(2):La.setMode(3)}else Qn.isPoints?La.setMode(0):Qn.isSprite&&La.setMode(4);if(Qn.isInstancedMesh)La.renderInstances(Su,Nh,Qn.count);else if(Ni.isInstancedBufferGeometry){const hs=Math.min(Ni.instanceCount,Ni._maxInstanceCount);La.renderInstances(Su,Nh,hs)}else La.render(Su,Nh)}},this.compile=function(zt,_n){ie=nl.get(zt),ie.init(),ue.push(ie),zt.traverseVisible(function(Ni){Ni.isLight&&Ni.layers.test(_n.layers)&&(ie.pushLight(Ni),Ni.castShadow&&ie.pushShadow(Ni))}),ie.setupLights(ye.physicallyCorrectLights),zt.traverse(function(Ni){const pn=Ni.material;if(pn)if(Array.isArray(pn))for(let Qn=0;Qn<pn.length;Qn++)Sd(pn[Qn],zt,Ni);else Sd(pn,zt,Ni)}),ue.pop(),ie=null};let Ff=null;function Em(){kf.stop()}function Am(){kf.start()}const kf=new wo;function op(zt,_n,Ni,pn){if(zt.visible===!1)return;if(zt.layers.test(_n.layers)){if(zt.isGroup)Ni=zt.renderOrder;else if(zt.isLOD)zt.autoUpdate===!0&&zt.update(_n);else if(zt.isLight)ie.pushLight(zt),zt.castShadow&&ie.pushShadow(zt);else if(zt.isSprite){if(!zt.frustumCulled||kr.intersectsSprite(zt)){pn&&Qt.setFromMatrixPosition(zt.matrixWorld).applyMatrix4(At);const ya=Qr.update(zt),Xr=zt.material;Xr.visible&&K.push(zt,ya,Xr,Ni,Qt.z,null)}}else if(zt.isImmediateRenderObject)pn&&Qt.setFromMatrixPosition(zt.matrixWorld).applyMatrix4(At),K.push(zt,null,zt.material,Ni,Qt.z,null);else if((zt.isMesh||zt.isLine||zt.isPoints)&&(zt.isSkinnedMesh&&zt.skeleton.frame!==$i.render.frame&&(zt.skeleton.update(),zt.skeleton.frame=$i.render.frame),!zt.frustumCulled||kr.intersectsObject(zt))){pn&&Qt.setFromMatrixPosition(zt.matrixWorld).applyMatrix4(At);const ya=Qr.update(zt),Xr=zt.material;if(Array.isArray(Xr)){const Aa=ya.groups;for(let Ga=0,Ds=Aa.length;Ga<Ds;Ga++){const Wa=Aa[Ga],Ha=Xr[Wa.materialIndex];Ha&&Ha.visible&&K.push(zt,ya,Ha,Ni,Qt.z,Wa)}}else Xr.visible&&K.push(zt,ya,Xr,Ni,Qt.z,null)}}const Qn=zt.children;for(let ya=0,Xr=Qn.length;ya<Xr;ya++)op(Qn[ya],_n,Ni,pn)}function Ip(zt,_n,Ni,pn){const Qn=zt.opaque,ya=zt.transmissive,Xr=zt.transparent;ie.setupLightsView(Ni),ya.length>0&&function(Aa,Ga,Ds){if(Kn===null){const La=O===!0&&ir.isWebGL2===!0;Kn=new(La?Lo:gs)(1024,1024,{generateMipmaps:!0,type:Qc.convert(1016)!==null?1016:1009,minFilter:1008,magFilter:1003,wrapS:1001,wrapT:1001})}const Wa=ye.getRenderTarget();ye.setRenderTarget(Kn),ye.clear();const Ha=ye.toneMapping;ye.toneMapping=0,lp(Aa,Ga,Ds),ye.toneMapping=Ha,Oi.updateMultisampleRenderTarget(Kn),Oi.updateRenderTargetMipmap(Kn),ye.setRenderTarget(Wa)}(Qn,_n,Ni),pn&&$n.viewport(Bt.copy(pn)),Qn.length>0&&lp(Qn,_n,Ni),ya.length>0&&lp(ya,_n,Ni),Xr.length>0&&lp(Xr,_n,Ni)}function lp(zt,_n,Ni){const pn=_n.isScene===!0?_n.overrideMaterial:null;for(let Qn=0,ya=zt.length;Qn<ya;Qn++){const Xr=zt[Qn],Aa=Xr.object,Ga=Xr.geometry,Ds=pn===null?Xr.material:pn,Wa=Xr.group;Aa.layers.test(Ni.layers)&&Wm(Aa,_n,Ni,Ga,Ds,Wa)}}function Wm(zt,_n,Ni,pn,Qn,ya){if(zt.onBeforeRender(ye,_n,Ni,pn,Qn,ya),zt.modelViewMatrix.multiplyMatrices(Ni.matrixWorldInverse,zt.matrixWorld),zt.normalMatrix.getNormalMatrix(zt.modelViewMatrix),zt.isImmediateRenderObject){const Xr=Kp(Ni,_n,Qn,zt);$n.setMaterial(Qn),bl.reset(),function(Aa,Ga){Aa.render(function(Ds){ye.renderBufferImmediate(Ds,Ga)})}(zt,Xr)}else Qn.transparent===!0&&Qn.side===2?(Qn.side=1,Qn.needsUpdate=!0,ye.renderBufferDirect(Ni,_n,pn,Qn,zt,ya),Qn.side=0,Qn.needsUpdate=!0,ye.renderBufferDirect(Ni,_n,pn,Qn,zt,ya),Qn.side=2):ye.renderBufferDirect(Ni,_n,pn,Qn,zt,ya);zt.onAfterRender(ye,_n,Ni,pn,Qn,ya)}function Sd(zt,_n,Ni){_n.isScene!==!0&&(_n=xn);const pn=Mt.get(zt),Qn=ie.state.lights,ya=ie.state.shadowsArray,Xr=Qn.state.version,Aa=Or.getParameters(zt,Qn.state,ya,_n,Ni),Ga=Or.getProgramCacheKey(Aa);let Ds=pn.programs;pn.environment=zt.isMeshStandardMaterial?_n.environment:null,pn.fog=_n.fog,pn.envMap=(zt.isMeshStandardMaterial?Bn:Ln).get(zt.envMap||pn.environment),Ds===void 0&&(zt.addEventListener("dispose",hm),Ds=new Map,pn.programs=Ds);let Wa=Ds.get(Ga);if(Wa!==void 0){if(pn.currentProgram===Wa&&pn.lightsStateVersion===Xr)return $p(zt,Aa),Wa}else Aa.uniforms=Or.getUniforms(zt),zt.onBuild(Aa,ye),zt.onBeforeCompile(Aa,ye),Wa=Or.acquireProgram(Aa,Ga),Ds.set(Ga,Wa),pn.uniforms=Aa.uniforms;const Ha=pn.uniforms;(zt.isShaderMaterial||zt.isRawShaderMaterial)&&zt.clipping!==!0||(Ha.clippingPlanes=os.uniform),$p(zt,Aa),pn.needsLights=function(Bs){return Bs.isMeshLambertMaterial||Bs.isMeshToonMaterial||Bs.isMeshPhongMaterial||Bs.isMeshStandardMaterial||Bs.isShadowMaterial||Bs.isShaderMaterial&&Bs.lights===!0}(zt),pn.lightsStateVersion=Xr,pn.needsLights&&(Ha.ambientLightColor.value=Qn.state.ambient,Ha.lightProbe.value=Qn.state.probe,Ha.directionalLights.value=Qn.state.directional,Ha.directionalLightShadows.value=Qn.state.directionalShadow,Ha.spotLights.value=Qn.state.spot,Ha.spotLightShadows.value=Qn.state.spotShadow,Ha.rectAreaLights.value=Qn.state.rectArea,Ha.ltc_1.value=Qn.state.rectAreaLTC1,Ha.ltc_2.value=Qn.state.rectAreaLTC2,Ha.pointLights.value=Qn.state.point,Ha.pointLightShadows.value=Qn.state.pointShadow,Ha.hemisphereLights.value=Qn.state.hemi,Ha.directionalShadowMap.value=Qn.state.directionalShadowMap,Ha.directionalShadowMatrix.value=Qn.state.directionalShadowMatrix,Ha.spotShadowMap.value=Qn.state.spotShadowMap,Ha.spotShadowMatrix.value=Qn.state.spotShadowMatrix,Ha.pointShadowMap.value=Qn.state.pointShadowMap,Ha.pointShadowMatrix.value=Qn.state.pointShadowMatrix);const La=Wa.getUniforms(),Ed=sc.seqWithValue(La.seq,Ha);return pn.currentProgram=Wa,pn.uniformsList=Ed,Wa}function $p(zt,_n){const Ni=Mt.get(zt);Ni.outputEncoding=_n.outputEncoding,Ni.instancing=_n.instancing,Ni.skinning=_n.skinning,Ni.morphTargets=_n.morphTargets,Ni.morphNormals=_n.morphNormals,Ni.numClippingPlanes=_n.numClippingPlanes,Ni.numIntersection=_n.numClipIntersection,Ni.vertexAlphas=_n.vertexAlphas,Ni.vertexTangents=_n.vertexTangents}function Kp(zt,_n,Ni,pn){_n.isScene!==!0&&(_n=xn),Oi.resetTextureUnits();const Qn=_n.fog,ya=Ni.isMeshStandardMaterial?_n.environment:null,Xr=st===null?ye.outputEncoding:st.texture.encoding,Aa=(Ni.isMeshStandardMaterial?Bn:Ln).get(Ni.envMap||ya),Ga=Ni.vertexColors===!0&&!!pn.geometry&&!!pn.geometry.attributes.color&&pn.geometry.attributes.color.itemSize===4,Ds=!!pn.geometry&&!!pn.geometry.attributes.tangent,Wa=!!pn.geometry&&!!pn.geometry.morphAttributes.position,Ha=!!pn.geometry&&!!pn.geometry.morphAttributes.normal,La=Mt.get(Ni),Ed=ie.state.lights;if(Zr===!0&&(la===!0||zt!==Lt)){const eu=zt===Lt&&Ni.id===ot;os.setState(Ni,zt,eu)}let Bs=!1;Ni.version===La.__version?La.needsLights&&La.lightsStateVersion!==Ed.state.version||La.outputEncoding!==Xr||pn.isInstancedMesh&&La.instancing===!1?Bs=!0:pn.isInstancedMesh||La.instancing!==!0?pn.isSkinnedMesh&&La.skinning===!1?Bs=!0:pn.isSkinnedMesh||La.skinning!==!0?La.envMap!==Aa||Ni.fog&&La.fog!==Qn?Bs=!0:La.numClippingPlanes===void 0||La.numClippingPlanes===os.numPlanes&&La.numIntersection===os.numIntersection?(La.vertexAlphas!==Ga||La.vertexTangents!==Ds||La.morphTargets!==Wa||La.morphNormals!==Ha)&&(Bs=!0):Bs=!0:Bs=!0:Bs=!0:(Bs=!0,La.__version=Ni.version);let pc=La.currentProgram;Bs===!0&&(pc=Sd(Ni,_n,pn));let wl=!1,nh=!1,Su=!1;const Ys=pc.getUniforms(),Nh=La.uniforms;if($n.useProgram(pc.program)&&(wl=!0,nh=!0,Su=!0),Ni.id!==ot&&(ot=Ni.id,nh=!0),wl||Lt!==zt){if(Ys.setValue(er,"projectionMatrix",zt.projectionMatrix),ir.logarithmicDepthBuffer&&Ys.setValue(er,"logDepthBufFC",2/(Math.log(zt.far+1)/Math.LN2)),Lt!==zt&&(Lt=zt,nh=!0,Su=!0),Ni.isShaderMaterial||Ni.isMeshPhongMaterial||Ni.isMeshToonMaterial||Ni.isMeshStandardMaterial||Ni.envMap){const eu=Ys.map.cameraPosition;eu!==void 0&&eu.setValue(er,Qt.setFromMatrixPosition(zt.matrixWorld))}(Ni.isMeshPhongMaterial||Ni.isMeshToonMaterial||Ni.isMeshLambertMaterial||Ni.isMeshBasicMaterial||Ni.isMeshStandardMaterial||Ni.isShaderMaterial)&&Ys.setValue(er,"isOrthographic",zt.isOrthographicCamera===!0),(Ni.isMeshPhongMaterial||Ni.isMeshToonMaterial||Ni.isMeshLambertMaterial||Ni.isMeshBasicMaterial||Ni.isMeshStandardMaterial||Ni.isShaderMaterial||Ni.isShadowMaterial||pn.isSkinnedMesh)&&Ys.setValue(er,"viewMatrix",zt.matrixWorldInverse)}if(pn.isSkinnedMesh){Ys.setOptional(er,pn,"bindMatrix"),Ys.setOptional(er,pn,"bindMatrixInverse");const eu=pn.skeleton;eu&&(ir.floatVertexTextures?(eu.boneTexture===null&&eu.computeBoneTexture(),Ys.setValue(er,"boneTexture",eu.boneTexture,Oi),Ys.setValue(er,"boneTextureSize",eu.boneTextureSize)):Ys.setOptional(er,eu,"boneMatrices"))}var hs,ao;return(nh||La.receiveShadow!==pn.receiveShadow)&&(La.receiveShadow=pn.receiveShadow,Ys.setValue(er,"receiveShadow",pn.receiveShadow)),nh&&(Ys.setValue(er,"toneMappingExposure",ye.toneMappingExposure),La.needsLights&&(ao=Su,(hs=Nh).ambientLightColor.needsUpdate=ao,hs.lightProbe.needsUpdate=ao,hs.directionalLights.needsUpdate=ao,hs.directionalLightShadows.needsUpdate=ao,hs.pointLights.needsUpdate=ao,hs.pointLightShadows.needsUpdate=ao,hs.spotLights.needsUpdate=ao,hs.spotLightShadows.needsUpdate=ao,hs.rectAreaLights.needsUpdate=ao,hs.hemisphereLights.needsUpdate=ao),Qn&&Ni.fog&&Ba.refreshFogUniforms(Nh,Qn),Ba.refreshMaterialUniforms(Nh,Ni,Zi,Bi,Kn),sc.upload(er,La.uniformsList,Nh,Oi)),Ni.isShaderMaterial&&Ni.uniformsNeedUpdate===!0&&(sc.upload(er,La.uniformsList,Nh,Oi),Ni.uniformsNeedUpdate=!1),Ni.isSpriteMaterial&&Ys.setValue(er,"center",pn.center),Ys.setValue(er,"modelViewMatrix",pn.modelViewMatrix),Ys.setValue(er,"normalMatrix",pn.normalMatrix),Ys.setValue(er,"modelMatrix",pn.matrixWorld),pc}kf.setAnimationLoop(function(zt){Ff&&Ff(zt)}),typeof window<"u"&&kf.setContext(window),this.setAnimationLoop=function(zt){Ff=zt,fc.setAnimationLoop(zt),zt===null?kf.stop():kf.start()},fc.addEventListener("sessionstart",Em),fc.addEventListener("sessionend",Am),this.render=function(zt,_n){if(_n!==void 0&&_n.isCamera!==!0)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(Se===!0)return;zt.autoUpdate===!0&&zt.updateMatrixWorld(),_n.parent===null&&_n.updateMatrixWorld(),fc.enabled===!0&&fc.isPresenting===!0&&(fc.cameraAutoUpdate===!0&&fc.updateCamera(_n),_n=fc.getCamera()),zt.isScene===!0&&zt.onBeforeRender(ye,zt,_n,st),ie=nl.get(zt,ue.length),ie.init(),ue.push(ie),At.multiplyMatrices(_n.projectionMatrix,_n.matrixWorldInverse),kr.setFromProjectionMatrix(At),la=this.localClippingEnabled,Zr=os.init(this.clippingPlanes,la,_n),K=Ea.get(zt,ne.length),K.init(),ne.push(K),op(zt,_n,0,ye.sortObjects),K.finish(),ye.sortObjects===!0&&K.sort(hr,Gn),Zr===!0&&os.beginShadows();const Ni=ie.state.shadowsArray;if(_o.render(Ni,zt,_n),Zr===!0&&os.endShadows(),this.info.autoReset===!0&&this.info.reset(),dc.render(K,zt),ie.setupLights(ye.physicallyCorrectLights),_n.isArrayCamera){const pn=_n.cameras;for(let Qn=0,ya=pn.length;Qn<ya;Qn++){const Xr=pn[Qn];Ip(K,zt,Xr,Xr.viewport)}}else Ip(K,zt,_n);st!==null&&(Oi.updateMultisampleRenderTarget(st),Oi.updateRenderTargetMipmap(st)),zt.isScene===!0&&zt.onAfterRender(ye,zt,_n),$n.buffers.depth.setTest(!0),$n.buffers.depth.setMask(!0),$n.buffers.color.setMask(!0),$n.setPolygonOffset(!1),bl.resetDefaultState(),ot=-1,Lt=null,ue.pop(),ie=ue.length>0?ue[ue.length-1]:null,ne.pop(),K=ne.length>0?ne[ne.length-1]:null},this.getActiveCubeFace=function(){return _e},this.getActiveMipmapLevel=function(){return $e},this.getRenderTarget=function(){return st},this.setRenderTarget=function(zt,_n=0,Ni=0){st=zt,_e=_n,$e=Ni,zt&&Mt.get(zt).__webglFramebuffer===void 0&&Oi.setupRenderTarget(zt);let pn=null,Qn=!1,ya=!1;if(zt){const Xr=zt.texture;(Xr.isDataTexture3D||Xr.isDataTexture2DArray)&&(ya=!0);const Aa=Mt.get(zt).__webglFramebuffer;zt.isWebGLCubeRenderTarget?(pn=Aa[_n],Qn=!0):pn=zt.isWebGLMultisampleRenderTarget?Mt.get(zt).__webglMultisampledFramebuffer:Aa,Bt.copy(zt.viewport),di.copy(zt.scissor),Ti=zt.scissorTest}else Bt.copy(gn).multiplyScalar(Zi).floor(),di.copy(Yn).multiplyScalar(Zi).floor(),Ti=Mr;if($n.bindFramebuffer(36160,pn)&&ir.drawBuffers){let Xr=!1;if(zt)if(zt.isWebGLMultipleRenderTargets){const Aa=zt.texture;if(Cr.length!==Aa.length||Cr[0]!==36064){for(let Ga=0,Ds=Aa.length;Ga<Ds;Ga++)Cr[Ga]=36064+Ga;Cr.length=Aa.length,Xr=!0}}else Cr.length===1&&Cr[0]===36064||(Cr[0]=36064,Cr.length=1,Xr=!0);else Cr.length===1&&Cr[0]===1029||(Cr[0]=1029,Cr.length=1,Xr=!0);Xr&&(ir.isWebGL2?er.drawBuffers(Cr):ji.get("WEBGL_draw_buffers").drawBuffersWEBGL(Cr))}if($n.viewport(Bt),$n.scissor(di),$n.setScissorTest(Ti),Qn){const Xr=Mt.get(zt.texture);er.framebufferTexture2D(36160,36064,34069+_n,Xr.__webglTexture,Ni)}else if(ya){const Xr=Mt.get(zt.texture),Aa=_n||0;er.framebufferTextureLayer(36160,36064,Xr.__webglTexture,Ni||0,Aa)}ot=-1},this.readRenderTargetPixels=function(zt,_n,Ni,pn,Qn,ya,Xr){if(!zt||!zt.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Aa=Mt.get(zt).__webglFramebuffer;if(zt.isWebGLCubeRenderTarget&&Xr!==void 0&&(Aa=Aa[Xr]),Aa){$n.bindFramebuffer(36160,Aa);try{const Ga=zt.texture,Ds=Ga.format,Wa=Ga.type;if(Ds!==1023&&Qc.convert(Ds)!==er.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const Ha=Wa===1016&&(ji.has("EXT_color_buffer_half_float")||ir.isWebGL2&&ji.has("EXT_color_buffer_float"));if(!(Wa===1009||Qc.convert(Wa)===er.getParameter(35738)||Wa===1015&&(ir.isWebGL2||ji.has("OES_texture_float")||ji.has("WEBGL_color_buffer_float"))||Ha))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");er.checkFramebufferStatus(36160)===36053?_n>=0&&_n<=zt.width-pn&&Ni>=0&&Ni<=zt.height-Qn&&er.readPixels(_n,Ni,pn,Qn,Qc.convert(Ds),Qc.convert(Wa),ya):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const Ga=st!==null?Mt.get(st).__webglFramebuffer:null;$n.bindFramebuffer(36160,Ga)}}},this.copyFramebufferToTexture=function(zt,_n,Ni=0){const pn=Math.pow(2,-Ni),Qn=Math.floor(_n.image.width*pn),ya=Math.floor(_n.image.height*pn);let Xr=Qc.convert(_n.format);ir.isWebGL2&&(Xr===6407&&(Xr=32849),Xr===6408&&(Xr=32856)),Oi.setTexture2D(_n,0),er.copyTexImage2D(3553,Ni,Xr,zt.x,zt.y,Qn,ya,0),$n.unbindTexture()},this.copyTextureToTexture=function(zt,_n,Ni,pn=0){const Qn=_n.image.width,ya=_n.image.height,Xr=Qc.convert(Ni.format),Aa=Qc.convert(Ni.type);Oi.setTexture2D(Ni,0),er.pixelStorei(37440,Ni.flipY),er.pixelStorei(37441,Ni.premultiplyAlpha),er.pixelStorei(3317,Ni.unpackAlignment),_n.isDataTexture?er.texSubImage2D(3553,pn,zt.x,zt.y,Qn,ya,Xr,Aa,_n.image.data):_n.isCompressedTexture?er.compressedTexSubImage2D(3553,pn,zt.x,zt.y,_n.mipmaps[0].width,_n.mipmaps[0].height,Xr,_n.mipmaps[0].data):er.texSubImage2D(3553,pn,zt.x,zt.y,Xr,Aa,_n.image),pn===0&&Ni.generateMipmaps&&er.generateMipmap(3553),$n.unbindTexture()},this.copyTextureToTexture3D=function(zt,_n,Ni,pn,Qn=0){if(ye.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const ya=zt.max.x-zt.min.x+1,Xr=zt.max.y-zt.min.y+1,Aa=zt.max.z-zt.min.z+1,Ga=Qc.convert(pn.format),Ds=Qc.convert(pn.type);let Wa;if(pn.isDataTexture3D)Oi.setTexture3D(pn,0),Wa=32879;else{if(!pn.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Oi.setTexture2DArray(pn,0),Wa=35866}er.pixelStorei(37440,pn.flipY),er.pixelStorei(37441,pn.premultiplyAlpha),er.pixelStorei(3317,pn.unpackAlignment);const Ha=er.getParameter(3314),La=er.getParameter(32878),Ed=er.getParameter(3316),Bs=er.getParameter(3315),pc=er.getParameter(32877),wl=Ni.isCompressedTexture?Ni.mipmaps[0]:Ni.image;er.pixelStorei(3314,wl.width),er.pixelStorei(32878,wl.height),er.pixelStorei(3316,zt.min.x),er.pixelStorei(3315,zt.min.y),er.pixelStorei(32877,zt.min.z),Ni.isDataTexture||Ni.isDataTexture3D?er.texSubImage3D(Wa,Qn,_n.x,_n.y,_n.z,ya,Xr,Aa,Ga,Ds,wl.data):Ni.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),er.compressedTexSubImage3D(Wa,Qn,_n.x,_n.y,_n.z,ya,Xr,Aa,Ga,wl.data)):er.texSubImage3D(Wa,Qn,_n.x,_n.y,_n.z,ya,Xr,Aa,Ga,Ds,wl),er.pixelStorei(3314,Ha),er.pixelStorei(32878,La),er.pixelStorei(3316,Ed),er.pixelStorei(3315,Bs),er.pixelStorei(32877,pc),Qn===0&&pn.generateMipmaps&&er.generateMipmap(Wa),$n.unbindTexture()},this.initTexture=function(zt){Oi.setTexture2D(zt,0),$n.unbindTexture()},this.resetState=function(){_e=0,$e=0,st=null,$n.reset(),bl.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class Pn extends Ri{}Pn.prototype.isWebGL1Renderer=!0;class Hc{constructor(e,l=25e-5){this.name="",this.color=new On(e),this.density=l}clone(){return new Hc(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}Hc.prototype.isFogExp2=!0;class ss{constructor(e,l=1,_=1e3){this.name="",this.color=new On(e),this.near=l,this.far=_}clone(){return new ss(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}ss.prototype.isFog=!0;class Ht extends we{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,l){return super.copy(e,l),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const l=super.toJSON(e);return this.fog!==null&&(l.object.fog=this.fog.toJSON()),l}}Ht.prototype.isScene=!0;class uu{constructor(e,l){this.array=e,this.stride=l,this.count=e!==void 0?e.length/l:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Sr()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,l,_){e*=this.stride,_*=l.stride;for(let y=0,S=this.stride;y<S;y++)this.array[e+y]=l.array[_+y];return this}set(e,l=0){return this.array.set(e,l),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Sr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const l=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),_=new this.constructor(l,this.stride);return _.setUsage(this.usage),_}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Sr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}uu.prototype.isInterleavedBuffer=!0;const js=new ht;class hu{constructor(e,l,_,y=!1){this.name="",this.data=e,this.itemSize=l,this.offset=_,this.normalized=y===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let l=0,_=this.data.count;l<_;l++)js.x=this.getX(l),js.y=this.getY(l),js.z=this.getZ(l),js.applyMatrix4(e),this.setXYZ(l,js.x,js.y,js.z);return this}applyNormalMatrix(e){for(let l=0,_=this.count;l<_;l++)js.x=this.getX(l),js.y=this.getY(l),js.z=this.getZ(l),js.applyNormalMatrix(e),this.setXYZ(l,js.x,js.y,js.z);return this}transformDirection(e){for(let l=0,_=this.count;l<_;l++)js.x=this.getX(l),js.y=this.getY(l),js.z=this.getZ(l),js.transformDirection(e),this.setXYZ(l,js.x,js.y,js.z);return this}setX(e,l){return this.data.array[e*this.data.stride+this.offset]=l,this}setY(e,l){return this.data.array[e*this.data.stride+this.offset+1]=l,this}setZ(e,l){return this.data.array[e*this.data.stride+this.offset+2]=l,this}setW(e,l){return this.data.array[e*this.data.stride+this.offset+3]=l,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,l,_){return e=e*this.data.stride+this.offset,this.data.array[e+0]=l,this.data.array[e+1]=_,this}setXYZ(e,l,_,y){return e=e*this.data.stride+this.offset,this.data.array[e+0]=l,this.data.array[e+1]=_,this.data.array[e+2]=y,this}setXYZW(e,l,_,y,S){return e=e*this.data.stride+this.offset,this.data.array[e+0]=l,this.data.array[e+1]=_,this.data.array[e+2]=y,this.data.array[e+3]=S,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const l=[];for(let _=0;_<this.count;_++){const y=_*this.data.stride+this.offset;for(let S=0;S<this.itemSize;S++)l.push(this.data.array[y+S])}return new aa(new this.array.constructor(l),this.itemSize,this.normalized)}return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new hu(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const l=[];for(let _=0;_<this.count;_++){const y=_*this.data.stride+this.offset;for(let S=0;S<this.itemSize;S++)l.push(this.data.array[y+S])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:l,normalized:this.normalized}}return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}hu.prototype.isInterleavedBufferAttribute=!0;class Wd extends rn{constructor(e){super(),this.type="SpriteMaterial",this.color=new On(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let Lh;Wd.prototype.isSpriteMaterial=!0;const nd=new ht,lc=new ht,rd=new ht,ad=new dn,sd=new dn,Zd=new tr,Mc=new ht,od=new ht,ld=new ht,cc=new dn,cd=new dn,ql=new dn;class Il extends we{constructor(e){if(super(),this.type="Sprite",Lh===void 0){Lh=new oa;const l=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),_=new uu(l,5);Lh.setIndex([0,1,2,0,2,3]),Lh.setAttribute("position",new hu(_,3,0,!1)),Lh.setAttribute("uv",new hu(_,2,3,!1))}this.geometry=Lh,this.material=e!==void 0?e:new Wd,this.center=new dn(.5,.5)}raycast(e,l){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),lc.setFromMatrixScale(this.matrixWorld),Zd.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),rd.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&lc.multiplyScalar(-rd.z);const _=this.material.rotation;let y,S;_!==0&&(S=Math.cos(_),y=Math.sin(_));const O=this.center;Xd(Mc.set(-.5,-.5,0),rd,O,lc,y,S),Xd(od.set(.5,-.5,0),rd,O,lc,y,S),Xd(ld.set(.5,.5,0),rd,O,lc,y,S),cc.set(0,0),cd.set(1,0),ql.set(1,1);let k=e.ray.intersectTriangle(Mc,od,ld,!1,nd);if(k===null&&(Xd(od.set(-.5,.5,0),rd,O,lc,y,S),cd.set(0,1),k=e.ray.intersectTriangle(Mc,ld,od,!1,nd),k===null))return;const N=e.ray.origin.distanceTo(nd);N<e.near||N>e.far||l.push({distance:N,point:nd.clone(),uv:Si.getUV(nd,Mc,od,ld,cc,cd,ql,new dn),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function Xd(E,e,l,_,y,S){ad.subVectors(E,l).addScalar(.5).multiply(_),y!==void 0?(sd.x=S*ad.x-y*ad.y,sd.y=y*ad.x+S*ad.y):sd.copy(ad),E.copy(e),E.x+=sd.x,E.y+=sd.y,E.applyMatrix4(Zd)}Il.prototype.isSprite=!0;const qs=new ht,xp=new ht;class ud extends we{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const l=e.levels;for(let _=0,y=l.length;_<y;_++){const S=l[_];this.addLevel(S.object.clone(),S.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,l=0){l=Math.abs(l);const _=this.levels;let y;for(y=0;y<_.length&&!(l<_[y].distance);y++);return _.splice(y,0,{distance:l,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const l=this.levels;if(l.length>0){let _,y;for(_=1,y=l.length;_<y&&!(e<l[_].distance);_++);return l[_-1].object}return null}raycast(e,l){if(this.levels.length>0){qs.setFromMatrixPosition(this.matrixWorld);const _=e.ray.origin.distanceTo(qs);this.getObjectForDistance(_).raycast(e,l)}}update(e){const l=this.levels;if(l.length>1){qs.setFromMatrixPosition(e.matrixWorld),xp.setFromMatrixPosition(this.matrixWorld);const _=qs.distanceTo(xp)/e.zoom;let y,S;for(l[0].object.visible=!0,y=1,S=l.length;y<S&&_>=l[y].distance;y++)l[y-1].object.visible=!1,l[y].object.visible=!0;for(this._currentLevel=y-1;y<S;y++)l[y].object.visible=!1}}toJSON(e){const l=super.toJSON(e);this.autoUpdate===!1&&(l.object.autoUpdate=!1),l.object.levels=[];const _=this.levels;for(let y=0,S=_.length;y<S;y++){const O=_[y];l.object.levels.push({object:O.object.uuid,distance:O.distance})}return l}}const ts=new ht,Ta=new qr,Mf=new qr,du=new ht,Rh=new tr;class Wl extends eo{constructor(e,l){super(e,l),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new tr,this.bindMatrixInverse=new tr}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,l){this.skeleton=e,l===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),l=this.matrixWorld),this.bindMatrix.copy(l),this.bindMatrixInverse.copy(l).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new qr,l=this.geometry.attributes.skinWeight;for(let _=0,y=l.count;_<y;_++){e.x=l.getX(_),e.y=l.getY(_),e.z=l.getZ(_),e.w=l.getW(_);const S=1/e.manhattanLength();S!==1/0?e.multiplyScalar(S):e.set(1,0,0,0),l.setXYZW(_,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,l){const _=this.skeleton,y=this.geometry;Ta.fromBufferAttribute(y.attributes.skinIndex,e),Mf.fromBufferAttribute(y.attributes.skinWeight,e),ts.fromBufferAttribute(y.attributes.position,e).applyMatrix4(this.bindMatrix),l.set(0,0,0);for(let S=0;S<4;S++){const O=Mf.getComponent(S);if(O!==0){const k=Ta.getComponent(S);Rh.multiplyMatrices(_.bones[k].matrixWorld,_.boneInverses[k]),l.addScaledVector(du.copy(ts).applyMatrix4(Rh),O)}}return l.applyMatrix4(this.bindMatrixInverse)}}Wl.prototype.isSkinnedMesh=!0;class Ih extends we{constructor(){super(),this.type="Bone"}}Ih.prototype.isBone=!0;class Tc extends Ca{constructor(e=null,l=1,_=1,y,S,O,k,N,G=1003,$=1003,K,ie){super(null,O,k,N,G,$,y,S,K,ie),this.image={data:e,width:l,height:_},this.magFilter=G,this.minFilter=$,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Tc.prototype.isDataTexture=!0;const jc=new tr,Fo=new tr;class Dh{constructor(e=[],l=[]){this.uuid=Sr(),this.bones=e.slice(0),this.boneInverses=l,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,l=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),l.length===0)this.calculateInverses();else if(e.length!==l.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let _=0,y=this.bones.length;_<y;_++)this.boneInverses.push(new tr)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,l=this.bones.length;e<l;e++){const _=new tr;this.bones[e]&&_.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(_)}}pose(){for(let e=0,l=this.bones.length;e<l;e++){const _=this.bones[e];_&&_.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,l=this.bones.length;e<l;e++){const _=this.bones[e];_&&(_.parent&&_.parent.isBone?(_.matrix.copy(_.parent.matrixWorld).invert(),_.matrix.multiply(_.matrixWorld)):_.matrix.copy(_.matrixWorld),_.matrix.decompose(_.position,_.quaternion,_.scale))}}update(){const e=this.bones,l=this.boneInverses,_=this.boneMatrices,y=this.boneTexture;for(let S=0,O=e.length;S<O;S++){const k=e[S]?e[S].matrixWorld:Fo;jc.multiplyMatrices(k,l[S]),jc.toArray(_,16*S)}y!==null&&(y.needsUpdate=!0)}clone(){return new Dh(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=ga(e),e=Math.max(e,4);const l=new Float32Array(e*e*4);l.set(this.boneMatrices);const _=new Tc(l,e,e,1023,1015);return this.boneMatrices=l,this.boneTexture=_,this.boneTextureSize=e,this}getBoneByName(e){for(let l=0,_=this.bones.length;l<_;l++){const y=this.bones[l];if(y.name===e)return y}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,l){this.uuid=e.uuid;for(let _=0,y=e.bones.length;_<y;_++){const S=e.bones[_];let O=l[S];O===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",S),O=new Ih),this.bones.push(O),this.boneInverses.push(new tr().fromArray(e.boneInverses[_]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const l=this.bones,_=this.boneInverses;for(let y=0,S=l.length;y<S;y++){const O=l[y];e.bones.push(O.uuid);const k=_[y];e.boneInverses.push(k.toArray())}return e}}class Sc extends aa{constructor(e,l,_,y=1){typeof _=="number"&&(y=_,_=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,l,_),this.meshPerAttribute=y}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}Sc.prototype.isInstancedBufferAttribute=!0;const Yd=new tr,Tf=new tr,qc=[],hd=new eo;class fu extends eo{constructor(e,l,_){super(e,l),this.instanceMatrix=new Sc(new Float32Array(16*_),16),this.instanceColor=null,this.count=_,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,l){l.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,l){l.fromArray(this.instanceMatrix.array,16*e)}raycast(e,l){const _=this.matrixWorld,y=this.count;if(hd.geometry=this.geometry,hd.material=this.material,hd.material!==void 0)for(let S=0;S<y;S++){this.getMatrixAt(S,Yd),Tf.multiplyMatrices(_,Yd),hd.matrixWorld=Tf,hd.raycast(e,qc);for(let O=0,k=qc.length;O<k;O++){const N=qc[O];N.instanceId=S,N.object=this,l.push(N)}qc.length=0}}setColorAt(e,l){this.instanceColor===null&&(this.instanceColor=new Sc(new Float32Array(3*this.instanceMatrix.count),3)),l.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,l){l.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}fu.prototype.isInstancedMesh=!0;class go extends rn{constructor(e){super(),this.type="LineBasicMaterial",this.color=new On(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}go.prototype.isLineBasicMaterial=!0;const Wu=new ht,$d=new ht,dd=new tr,uo=new Wr,fd=new zn;class To extends we{constructor(e=new oa,l=new go){super(),this.type="Line",this.geometry=e,this.material=l,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const l=e.attributes.position,_=[0];for(let y=1,S=l.count;y<S;y++)Wu.fromBufferAttribute(l,y-1),$d.fromBufferAttribute(l,y),_[y]=_[y-1],_[y]+=Wu.distanceTo($d);e.setAttribute("lineDistance",new or(_,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,l){const _=this.geometry,y=this.matrixWorld,S=e.params.Line.threshold,O=_.drawRange;if(_.boundingSphere===null&&_.computeBoundingSphere(),fd.copy(_.boundingSphere),fd.applyMatrix4(y),fd.radius+=S,e.ray.intersectsSphere(fd)===!1)return;dd.copy(y).invert(),uo.copy(e.ray).applyMatrix4(dd);const k=S/((this.scale.x+this.scale.y+this.scale.z)/3),N=k*k,G=new ht,$=new ht,K=new ht,ie=new ht,ne=this.isLineSegments?2:1;if(_.isBufferGeometry){const ue=_.index,ye=_.attributes.position;if(ue!==null)for(let Se=Math.max(0,O.start),_e=Math.min(ue.count,O.start+O.count)-1;Se<_e;Se+=ne){const $e=ue.getX(Se),st=ue.getX(Se+1);if(G.fromBufferAttribute(ye,$e),$.fromBufferAttribute(ye,st),uo.distanceSqToSegment(G,$,ie,K)>N)continue;ie.applyMatrix4(this.matrixWorld);const ot=e.ray.origin.distanceTo(ie);ot<e.near||ot>e.far||l.push({distance:ot,point:K.clone().applyMatrix4(this.matrixWorld),index:Se,face:null,faceIndex:null,object:this})}else for(let Se=Math.max(0,O.start),_e=Math.min(ye.count,O.start+O.count)-1;Se<_e;Se+=ne){if(G.fromBufferAttribute(ye,Se),$.fromBufferAttribute(ye,Se+1),uo.distanceSqToSegment(G,$,ie,K)>N)continue;ie.applyMatrix4(this.matrixWorld);const $e=e.ray.origin.distanceTo(ie);$e<e.near||$e>e.far||l.push({distance:$e,point:K.clone().applyMatrix4(this.matrixWorld),index:Se,face:null,faceIndex:null,object:this})}}else _.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const l=e.morphAttributes,_=Object.keys(l);if(_.length>0){const y=l[_[0]];if(y!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let S=0,O=y.length;S<O;S++){const k=y[S].name||String(S);this.morphTargetInfluences.push(0),this.morphTargetDictionary[k]=S}}}}else{const l=e.morphTargets;l!==void 0&&l.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}To.prototype.isLine=!0;const Ec=new ht,gl=new ht;class to extends To{constructor(e,l){super(e,l),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(e.index===null){const l=e.attributes.position,_=[];for(let y=0,S=l.count;y<S;y+=2)Ec.fromBufferAttribute(l,y),gl.fromBufferAttribute(l,y+1),_[y]=y===0?0:_[y-1],_[y+1]=_[y]+Ec.distanceTo(gl);e.setAttribute("lineDistance",new or(_,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}to.prototype.isLineSegments=!0;class Zl extends To{constructor(e,l){super(e,l),this.type="LineLoop"}}Zl.prototype.isLineLoop=!0;class Ac extends rn{constructor(e){super(),this.type="PointsMaterial",this.color=new On(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}Ac.prototype.isPointsMaterial=!0;const zh=new tr,Kd=new Wr,Cc=new zn,Wc=new ht;class pu extends we{constructor(e=new oa,l=new Ac){super(),this.type="Points",this.geometry=e,this.material=l,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,l){const _=this.geometry,y=this.matrixWorld,S=e.params.Points.threshold,O=_.drawRange;if(_.boundingSphere===null&&_.computeBoundingSphere(),Cc.copy(_.boundingSphere),Cc.applyMatrix4(y),Cc.radius+=S,e.ray.intersectsSphere(Cc)===!1)return;zh.copy(y).invert(),Kd.copy(e.ray).applyMatrix4(zh);const k=S/((this.scale.x+this.scale.y+this.scale.z)/3),N=k*k;if(_.isBufferGeometry){const G=_.index,$=_.attributes.position;if(G!==null)for(let K=Math.max(0,O.start),ie=Math.min(G.count,O.start+O.count);K<ie;K++){const ne=G.getX(K);Wc.fromBufferAttribute($,ne),Sf(Wc,ne,N,y,e,l,this)}else for(let K=Math.max(0,O.start),ie=Math.min($.count,O.start+O.count);K<ie;K++)Wc.fromBufferAttribute($,K),Sf(Wc,K,N,y,e,l,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const l=e.morphAttributes,_=Object.keys(l);if(_.length>0){const y=l[_[0]];if(y!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let S=0,O=y.length;S<O;S++){const k=y[S].name||String(S);this.morphTargetInfluences.push(0),this.morphTargetDictionary[k]=S}}}}else{const l=e.morphTargets;l!==void 0&&l.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function Sf(E,e,l,_,y,S,O){const k=Kd.distanceSqToPoint(E);if(k<l){const N=new ht;Kd.closestPointToPoint(E,N),N.applyMatrix4(_);const G=y.ray.origin.distanceTo(N);if(G<y.near||G>y.far)return;S.push({distance:G,distanceToRay:Math.sqrt(k),point:N,index:e,face:null,object:O})}}pu.prototype.isPoints=!0;class Jd extends Ca{constructor(e,l,_,y,S,O,k,N,G){super(e,l,_,y,S,O,k,N,G),this.format=k!==void 0?k:1022,this.minFilter=O!==void 0?O:1006,this.magFilter=S!==void 0?S:1006,this.generateMipmaps=!1;const $=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function K(){$.needsUpdate=!0,e.requestVideoFrameCallback(K)})}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}Jd.prototype.isVideoTexture=!0;class pd extends Ca{constructor(e,l,_,y,S,O,k,N,G,$,K,ie){super(null,O,k,N,G,$,y,S,K,ie),this.image={width:l,height:_},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}pd.prototype.isCompressedTexture=!0;class Ef extends Ca{constructor(e,l,_,y,S,O,k,N,G){super(e,l,_,y,S,O,k,N,G),this.needsUpdate=!0}}Ef.prototype.isCanvasTexture=!0;class Ph extends Ca{constructor(e,l,_,y,S,O,k,N,G,$){if(($=$!==void 0?$:1026)!==1026&&$!==1027)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");_===void 0&&$===1026&&(_=1012),_===void 0&&$===1027&&(_=1020),super(null,y,S,O,k,N,$,_,G),this.image={width:e,height:l},this.magFilter=k!==void 0?k:1003,this.minFilter=N!==void 0?N:1003,this.flipY=!1,this.generateMipmaps=!1}}Ph.prototype.isDepthTexture=!0;class Oh extends oa{constructor(e=1,l=8,_=0,y=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:l,thetaStart:_,thetaLength:y},l=Math.max(3,l);const S=[],O=[],k=[],N=[],G=new ht,$=new dn;O.push(0,0,0),k.push(0,0,1),N.push(.5,.5);for(let K=0,ie=3;K<=l;K++,ie+=3){const ne=_+K/l*y;G.x=e*Math.cos(ne),G.y=e*Math.sin(ne),O.push(G.x,G.y,G.z),k.push(0,0,1),$.x=(O[ie]/e+1)/2,$.y=(O[ie+1]/e+1)/2,N.push($.x,$.y)}for(let K=1;K<=l;K++)S.push(K,K+1,0);this.setIndex(S),this.setAttribute("position",new or(O,3)),this.setAttribute("normal",new or(k,3)),this.setAttribute("uv",new or(N,2))}static fromJSON(e){return new Oh(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class mu extends oa{constructor(e=1,l=1,_=1,y=8,S=1,O=!1,k=0,N=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:l,height:_,radialSegments:y,heightSegments:S,openEnded:O,thetaStart:k,thetaLength:N};const G=this;y=Math.floor(y),S=Math.floor(S);const $=[],K=[],ie=[],ne=[];let ue=0;const ye=[],Se=_/2;let _e=0;function $e(st){const ot=ue,Lt=new dn,Bt=new ht;let di=0;const Ti=st===!0?e:l,Ki=st===!0?1:-1;for(let Zi=1;Zi<=y;Zi++)K.push(0,Se*Ki,0),ie.push(0,Ki,0),ne.push(.5,.5),ue++;const Bi=ue;for(let Zi=0;Zi<=y;Zi++){const hr=Zi/y*N+k,Gn=Math.cos(hr),gn=Math.sin(hr);Bt.x=Ti*gn,Bt.y=Se*Ki,Bt.z=Ti*Gn,K.push(Bt.x,Bt.y,Bt.z),ie.push(0,Ki,0),Lt.x=.5*Gn+.5,Lt.y=.5*gn*Ki+.5,ne.push(Lt.x,Lt.y),ue++}for(let Zi=0;Zi<y;Zi++){const hr=ot+Zi,Gn=Bi+Zi;st===!0?$.push(Gn,Gn+1,hr):$.push(Gn+1,Gn,hr),di+=3}G.addGroup(_e,di,st===!0?1:2),_e+=di}(function(){const st=new ht,ot=new ht;let Lt=0;const Bt=(l-e)/_;for(let di=0;di<=S;di++){const Ti=[],Ki=di/S,Bi=Ki*(l-e)+e;for(let Zi=0;Zi<=y;Zi++){const hr=Zi/y,Gn=hr*N+k,gn=Math.sin(Gn),Yn=Math.cos(Gn);ot.x=Bi*gn,ot.y=-Ki*_+Se,ot.z=Bi*Yn,K.push(ot.x,ot.y,ot.z),st.set(gn,Bt,Yn).normalize(),ie.push(st.x,st.y,st.z),ne.push(hr,1-Ki),Ti.push(ue++)}ye.push(Ti)}for(let di=0;di<y;di++)for(let Ti=0;Ti<S;Ti++){const Ki=ye[Ti][di],Bi=ye[Ti+1][di],Zi=ye[Ti+1][di+1],hr=ye[Ti][di+1];$.push(Ki,Bi,hr),$.push(Bi,Zi,hr),Lt+=6}G.addGroup(_e,Lt,0),_e+=Lt})(),O===!1&&(e>0&&$e(!0),l>0&&$e(!1)),this.setIndex($),this.setAttribute("position",new or(K,3)),this.setAttribute("normal",new or(ie,3)),this.setAttribute("uv",new or(ne,2))}static fromJSON(e){return new mu(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class md extends mu{constructor(e=1,l=1,_=8,y=1,S=!1,O=0,k=2*Math.PI){super(0,e,l,_,y,S,O,k),this.type="ConeGeometry",this.parameters={radius:e,height:l,radialSegments:_,heightSegments:y,openEnded:S,thetaStart:O,thetaLength:k}}static fromJSON(e){return new md(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Lc extends oa{constructor(e,l,_=1,y=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:l,radius:_,detail:y};const S=[],O=[];function k(ie,ne,ue,ye){const Se=ye+1,_e=[];for(let $e=0;$e<=Se;$e++){_e[$e]=[];const st=ie.clone().lerp(ue,$e/Se),ot=ne.clone().lerp(ue,$e/Se),Lt=Se-$e;for(let Bt=0;Bt<=Lt;Bt++)_e[$e][Bt]=Bt===0&&$e===Se?st:st.clone().lerp(ot,Bt/Lt)}for(let $e=0;$e<Se;$e++)for(let st=0;st<2*(Se-$e)-1;st++){const ot=Math.floor(st/2);st%2==0?(N(_e[$e][ot+1]),N(_e[$e+1][ot]),N(_e[$e][ot])):(N(_e[$e][ot+1]),N(_e[$e+1][ot+1]),N(_e[$e+1][ot]))}}function N(ie){S.push(ie.x,ie.y,ie.z)}function G(ie,ne){const ue=3*ie;ne.x=e[ue+0],ne.y=e[ue+1],ne.z=e[ue+2]}function $(ie,ne,ue,ye){ye<0&&ie.x===1&&(O[ne]=ie.x-1),ue.x===0&&ue.z===0&&(O[ne]=ye/2/Math.PI+.5)}function K(ie){return Math.atan2(ie.z,-ie.x)}(function(ie){const ne=new ht,ue=new ht,ye=new ht;for(let Se=0;Se<l.length;Se+=3)G(l[Se+0],ne),G(l[Se+1],ue),G(l[Se+2],ye),k(ne,ue,ye,ie)})(y),function(ie){const ne=new ht;for(let ue=0;ue<S.length;ue+=3)ne.x=S[ue+0],ne.y=S[ue+1],ne.z=S[ue+2],ne.normalize().multiplyScalar(ie),S[ue+0]=ne.x,S[ue+1]=ne.y,S[ue+2]=ne.z}(_),function(){const ie=new ht;for(let ue=0;ue<S.length;ue+=3){ie.x=S[ue+0],ie.y=S[ue+1],ie.z=S[ue+2];const ye=K(ie)/2/Math.PI+.5,Se=(ne=ie,Math.atan2(-ne.y,Math.sqrt(ne.x*ne.x+ne.z*ne.z))/Math.PI+.5);O.push(ye,1-Se)}var ne;(function(){const ue=new ht,ye=new ht,Se=new ht,_e=new ht,$e=new dn,st=new dn,ot=new dn;for(let Lt=0,Bt=0;Lt<S.length;Lt+=9,Bt+=6){ue.set(S[Lt+0],S[Lt+1],S[Lt+2]),ye.set(S[Lt+3],S[Lt+4],S[Lt+5]),Se.set(S[Lt+6],S[Lt+7],S[Lt+8]),$e.set(O[Bt+0],O[Bt+1]),st.set(O[Bt+2],O[Bt+3]),ot.set(O[Bt+4],O[Bt+5]),_e.copy(ue).add(ye).add(Se).divideScalar(3);const di=K(_e);$($e,Bt+0,ue,di),$(st,Bt+2,ye,di),$(ot,Bt+4,Se,di)}})(),function(){for(let ue=0;ue<O.length;ue+=6){const ye=O[ue+0],Se=O[ue+2],_e=O[ue+4],$e=Math.max(ye,Se,_e),st=Math.min(ye,Se,_e);$e>.9&&st<.1&&(ye<.2&&(O[ue+0]+=1),Se<.2&&(O[ue+2]+=1),_e<.2&&(O[ue+4]+=1))}}()}(),this.setAttribute("position",new or(S,3)),this.setAttribute("normal",new or(S.slice(),3)),this.setAttribute("uv",new or(O,2)),y===0?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new Lc(e.vertices,e.indices,e.radius,e.details)}}class Zs extends Lc{constructor(e=1,l=0){const _=(1+Math.sqrt(5))/2,y=1/_;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-y,-_,0,-y,_,0,y,-_,0,y,_,-y,-_,0,-y,_,0,y,-_,0,y,_,0,-_,0,-y,_,0,-y,-_,0,y,_,0,y],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,l),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:l}}static fromJSON(e){return new Zs(e.radius,e.detail)}}const Xs=new ht,Zu=new ht,ll=new ht,Xu=new Si;class Af extends oa{constructor(e,l){if(super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:l},l=l!==void 0?l:1,e.isGeometry===!0)return void console.error("THREE.EdgesGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const _=Math.pow(10,4),y=Math.cos(gr*l),S=e.getIndex(),O=e.getAttribute("position"),k=S?S.count:O.count,N=[0,0,0],G=["a","b","c"],$=new Array(3),K={},ie=[];for(let ne=0;ne<k;ne+=3){S?(N[0]=S.getX(ne),N[1]=S.getX(ne+1),N[2]=S.getX(ne+2)):(N[0]=ne,N[1]=ne+1,N[2]=ne+2);const{a:ue,b:ye,c:Se}=Xu;if(ue.fromBufferAttribute(O,N[0]),ye.fromBufferAttribute(O,N[1]),Se.fromBufferAttribute(O,N[2]),Xu.getNormal(ll),$[0]=`${Math.round(ue.x*_)},${Math.round(ue.y*_)},${Math.round(ue.z*_)}`,$[1]=`${Math.round(ye.x*_)},${Math.round(ye.y*_)},${Math.round(ye.z*_)}`,$[2]=`${Math.round(Se.x*_)},${Math.round(Se.y*_)},${Math.round(Se.z*_)}`,$[0]!==$[1]&&$[1]!==$[2]&&$[2]!==$[0])for(let _e=0;_e<3;_e++){const $e=(_e+1)%3,st=$[_e],ot=$[$e],Lt=Xu[G[_e]],Bt=Xu[G[$e]],di=`${st}_${ot}`,Ti=`${ot}_${st}`;Ti in K&&K[Ti]?(ll.dot(K[Ti].normal)<=y&&(ie.push(Lt.x,Lt.y,Lt.z),ie.push(Bt.x,Bt.y,Bt.z)),K[Ti]=null):di in K||(K[di]={index0:N[_e],index1:N[$e],normal:ll.clone()})}}for(const ne in K)if(K[ne]){const{index0:ue,index1:ye}=K[ne];Xs.fromBufferAttribute(O,ue),Zu.fromBufferAttribute(O,ye),ie.push(Xs.x,Xs.y,Xs.z),ie.push(Zu.x,Zu.y,Zu.z)}this.setAttribute("position",new or(ie,3))}}class Xl{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,l){const _=this.getUtoTmapping(e);return this.getPoint(_,l)}getPoints(e=5){const l=[];for(let _=0;_<=e;_++)l.push(this.getPoint(_/e));return l}getSpacedPoints(e=5){const l=[];for(let _=0;_<=e;_++)l.push(this.getPointAt(_/e));return l}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const l=[];let _,y=this.getPoint(0),S=0;l.push(0);for(let O=1;O<=e;O++)_=this.getPoint(O/e),S+=_.distanceTo(y),l.push(S),y=_;return this.cacheArcLengths=l,l}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,l){const _=this.getLengths();let y=0;const S=_.length;let O;O=l||e*_[S-1];let k,N=0,G=S-1;for(;N<=G;)if(y=Math.floor(N+(G-N)/2),k=_[y]-O,k<0)N=y+1;else{if(!(k>0)){G=y;break}G=y-1}if(y=G,_[y]===O)return y/(S-1);const $=_[y];return(y+(O-$)/(_[y+1]-$))/(S-1)}getTangent(e,l){let y=e-1e-4,S=e+1e-4;y<0&&(y=0),S>1&&(S=1);const O=this.getPoint(y),k=this.getPoint(S),N=l||(O.isVector2?new dn:new ht);return N.copy(k).sub(O).normalize(),N}getTangentAt(e,l){const _=this.getUtoTmapping(e);return this.getTangent(_,l)}computeFrenetFrames(e,l){const _=new ht,y=[],S=[],O=[],k=new ht,N=new tr;for(let ne=0;ne<=e;ne++){const ue=ne/e;y[ne]=this.getTangentAt(ue,new ht),y[ne].normalize()}S[0]=new ht,O[0]=new ht;let G=Number.MAX_VALUE;const $=Math.abs(y[0].x),K=Math.abs(y[0].y),ie=Math.abs(y[0].z);$<=G&&(G=$,_.set(1,0,0)),K<=G&&(G=K,_.set(0,1,0)),ie<=G&&_.set(0,0,1),k.crossVectors(y[0],_).normalize(),S[0].crossVectors(y[0],k),O[0].crossVectors(y[0],S[0]);for(let ne=1;ne<=e;ne++){if(S[ne]=S[ne-1].clone(),O[ne]=O[ne-1].clone(),k.crossVectors(y[ne-1],y[ne]),k.length()>Number.EPSILON){k.normalize();const ue=Math.acos(Er(y[ne-1].dot(y[ne]),-1,1));S[ne].applyMatrix4(N.makeRotationAxis(k,ue))}O[ne].crossVectors(y[ne],S[ne])}if(l===!0){let ne=Math.acos(Er(S[0].dot(S[e]),-1,1));ne/=e,y[0].dot(k.crossVectors(S[0],S[e]))>0&&(ne=-ne);for(let ue=1;ue<=e;ue++)S[ue].applyMatrix4(N.makeRotationAxis(y[ue],ne*ue)),O[ue].crossVectors(y[ue],S[ue])}return{tangents:y,normals:S,binormals:O}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Yu extends Xl{constructor(e=0,l=0,_=1,y=1,S=0,O=2*Math.PI,k=!1,N=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=l,this.xRadius=_,this.yRadius=y,this.aStartAngle=S,this.aEndAngle=O,this.aClockwise=k,this.aRotation=N}getPoint(e,l){const _=l||new dn,y=2*Math.PI;let S=this.aEndAngle-this.aStartAngle;const O=Math.abs(S)<Number.EPSILON;for(;S<0;)S+=y;for(;S>y;)S-=y;S<Number.EPSILON&&(S=O?0:y),this.aClockwise!==!0||O||(S===y?S=-y:S-=y);const k=this.aStartAngle+e*S;let N=this.aX+this.xRadius*Math.cos(k),G=this.aY+this.yRadius*Math.sin(k);if(this.aRotation!==0){const $=Math.cos(this.aRotation),K=Math.sin(this.aRotation),ie=N-this.aX,ne=G-this.aY;N=ie*$-ne*K+this.aX,G=ie*K+ne*$+this.aY}return _.set(N,G)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Yu.prototype.isEllipseCurve=!0;class bs extends Yu{constructor(e,l,_,y,S,O){super(e,l,_,_,y,S,O),this.type="ArcCurve"}}function gd(){let E=0,e=0,l=0,_=0;function y(S,O,k,N){E=S,e=k,l=-3*S+3*O-2*k-N,_=2*S-2*O+k+N}return{initCatmullRom:function(S,O,k,N,G){y(O,k,G*(k-S),G*(N-O))},initNonuniformCatmullRom:function(S,O,k,N,G,$,K){let ie=(O-S)/G-(k-S)/(G+$)+(k-O)/$,ne=(k-O)/$-(N-O)/($+K)+(N-k)/K;ie*=$,ne*=$,y(O,k,ie,ne)},calc:function(S){const O=S*S;return E+e*S+l*O+_*(O*S)}}}bs.prototype.isArcCurve=!0;const Cf=new ht,Qd=new gd,$u=new gd,ef=new gd;class Ku extends Xl{constructor(e=[],l=!1,_="centripetal",y=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=l,this.curveType=_,this.tension=y}getPoint(e,l=new ht){const _=l,y=this.points,S=y.length,O=(S-(this.closed?0:1))*e;let k,N,G=Math.floor(O),$=O-G;this.closed?G+=G>0?0:(Math.floor(Math.abs(G)/S)+1)*S:$===0&&G===S-1&&(G=S-2,$=1),this.closed||G>0?k=y[(G-1)%S]:(Cf.subVectors(y[0],y[1]).add(y[0]),k=Cf);const K=y[G%S],ie=y[(G+1)%S];if(this.closed||G+2<S?N=y[(G+2)%S]:(Cf.subVectors(y[S-1],y[S-2]).add(y[S-1]),N=Cf),this.curveType==="centripetal"||this.curveType==="chordal"){const ne=this.curveType==="chordal"?.5:.25;let ue=Math.pow(k.distanceToSquared(K),ne),ye=Math.pow(K.distanceToSquared(ie),ne),Se=Math.pow(ie.distanceToSquared(N),ne);ye<1e-4&&(ye=1),ue<1e-4&&(ue=ye),Se<1e-4&&(Se=ye),Qd.initNonuniformCatmullRom(k.x,K.x,ie.x,N.x,ue,ye,Se),$u.initNonuniformCatmullRom(k.y,K.y,ie.y,N.y,ue,ye,Se),ef.initNonuniformCatmullRom(k.z,K.z,ie.z,N.z,ue,ye,Se)}else this.curveType==="catmullrom"&&(Qd.initCatmullRom(k.x,K.x,ie.x,N.x,this.tension),$u.initCatmullRom(k.y,K.y,ie.y,N.y,this.tension),ef.initCatmullRom(k.z,K.z,ie.z,N.z,this.tension));return _.set(Qd.calc($),$u.calc($),ef.calc($)),_}copy(e){super.copy(e),this.points=[];for(let l=0,_=e.points.length;l<_;l++){const y=e.points[l];this.points.push(y.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let l=0,_=this.points.length;l<_;l++){const y=this.points[l];e.points.push(y.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let l=0,_=e.points.length;l<_;l++){const y=e.points[l];this.points.push(new ht().fromArray(y))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function tf(E,e,l,_,y){const S=.5*(_-e),O=.5*(y-l),k=E*E;return(2*l-2*_+S+O)*(E*k)+(-3*l+3*_-2*S-O)*k+S*E+l}function _l(E,e,l,_){return function(y,S){const O=1-y;return O*O*S}(E,e)+function(y,S){return 2*(1-y)*y*S}(E,l)+function(y,S){return y*y*S}(E,_)}function Zc(E,e,l,_,y){return function(S,O){const k=1-S;return k*k*k*O}(E,e)+function(S,O){const k=1-S;return 3*k*k*S*O}(E,l)+function(S,O){return 3*(1-S)*S*S*O}(E,_)+function(S,O){return S*S*S*O}(E,y)}Ku.prototype.isCatmullRomCurve3=!0;class ws extends Xl{constructor(e=new dn,l=new dn,_=new dn,y=new dn){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=l,this.v2=_,this.v3=y}getPoint(e,l=new dn){const _=l,y=this.v0,S=this.v1,O=this.v2,k=this.v3;return _.set(Zc(e,y.x,S.x,O.x,k.x),Zc(e,y.y,S.y,O.y,k.y)),_}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}ws.prototype.isCubicBezierCurve=!0;class Dl extends Xl{constructor(e=new ht,l=new ht,_=new ht,y=new ht){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=l,this.v2=_,this.v3=y}getPoint(e,l=new ht){const _=l,y=this.v0,S=this.v1,O=this.v2,k=this.v3;return _.set(Zc(e,y.x,S.x,O.x,k.x),Zc(e,y.y,S.y,O.y,k.y),Zc(e,y.z,S.z,O.z,k.z)),_}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Dl.prototype.isCubicBezierCurve3=!0;class Rc extends Xl{constructor(e=new dn,l=new dn){super(),this.type="LineCurve",this.v1=e,this.v2=l}getPoint(e,l=new dn){const _=l;return e===1?_.copy(this.v2):(_.copy(this.v2).sub(this.v1),_.multiplyScalar(e).add(this.v1)),_}getPointAt(e,l){return this.getPoint(e,l)}getTangent(e,l){const _=l||new dn;return _.copy(this.v2).sub(this.v1).normalize(),_}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Rc.prototype.isLineCurve=!0;class _d extends Xl{constructor(e=new ht,l=new ht){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=l}getPoint(e,l=new ht){const _=l;return e===1?_.copy(this.v2):(_.copy(this.v2).sub(this.v1),_.multiplyScalar(e).add(this.v1)),_}getPointAt(e,l){return this.getPoint(e,l)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class uc extends Xl{constructor(e=new dn,l=new dn,_=new dn){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=l,this.v2=_}getPoint(e,l=new dn){const _=l,y=this.v0,S=this.v1,O=this.v2;return _.set(_l(e,y.x,S.x,O.x),_l(e,y.y,S.y,O.y)),_}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}uc.prototype.isQuadraticBezierCurve=!0;class nf extends Xl{constructor(e=new ht,l=new ht,_=new ht){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=l,this.v2=_}getPoint(e,l=new ht){const _=l,y=this.v0,S=this.v1,O=this.v2;return _.set(_l(e,y.x,S.x,O.x),_l(e,y.y,S.y,O.y),_l(e,y.z,S.z,O.z)),_}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}nf.prototype.isQuadraticBezierCurve3=!0;class Bh extends Xl{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,l=new dn){const _=l,y=this.points,S=(y.length-1)*e,O=Math.floor(S),k=S-O,N=y[O===0?O:O-1],G=y[O],$=y[O>y.length-2?y.length-1:O+1],K=y[O>y.length-3?y.length-1:O+2];return _.set(tf(k,N.x,G.x,$.x,K.x),tf(k,N.y,G.y,$.y,K.y)),_}copy(e){super.copy(e),this.points=[];for(let l=0,_=e.points.length;l<_;l++){const y=e.points[l];this.points.push(y.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let l=0,_=this.points.length;l<_;l++){const y=this.points[l];e.points.push(y.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let l=0,_=e.points.length;l<_;l++){const y=e.points[l];this.points.push(new dn().fromArray(y))}return this}}Bh.prototype.isSplineCurve=!0;var rf=Object.freeze({__proto__:null,ArcCurve:bs,CatmullRomCurve3:Ku,CubicBezierCurve:ws,CubicBezierCurve3:Dl,EllipseCurve:Yu,LineCurve:Rc,LineCurve3:_d,QuadraticBezierCurve:uc,QuadraticBezierCurve3:nf,SplineCurve:Bh});const bp=function(E,e,l=2){const _=e&&e.length,y=_?e[0]*l:E.length;let S=gu(E,0,y,l,!0);const O=[];if(!S||S.next===S.prev)return O;let k,N,G,$,K,ie,ne;if(_&&(S=function(ue,ye,Se,_e){const $e=[];let st,ot,Lt,Bt,di;for(st=0,ot=ye.length;st<ot;st++)Lt=ye[st]*_e,Bt=st<ot-1?ye[st+1]*_e:ue.length,di=gu(ue,Lt,Bt,_e,!1),di===di.next&&(di.steiner=!0),$e.push(Gp(di));for($e.sort(_u),st=0;st<$e.length;st++)Yl($e[st],Se),Se=Yo(Se,Se.next);return Se}(E,e,S,l)),E.length>80*l){k=G=E[0],N=$=E[1];for(let ue=l;ue<y;ue+=l)K=E[ue],ie=E[ue+1],K<k&&(k=K),ie<N&&(N=ie),K>G&&(G=K),ie>$&&($=ie);ne=Math.max(G-k,$-N),ne=ne!==0?1/ne:0}return $o(S,O,l,k,N,ne),O};function gu(E,e,l,_,y){let S,O;if(y===function(k,N,G,$){let K=0;for(let ie=N,ne=G-$;ie<G;ie+=$)K+=(k[ne]-k[ie])*(k[ie+1]+k[ne+1]),ne=ie;return K}(E,e,l,_)>0)for(S=e;S<l;S+=_)O=Jo(S,E[S],E[S+1],O);else for(S=l-_;S>=e;S-=_)O=Jo(S,E[S],E[S+1],O);return O&&xl(O,O.next)&&($c(O),O=O.next),O}function Yo(E,e){if(!E)return E;e||(e=E);let l,_=E;do if(l=!1,_.steiner||!xl(_,_.next)&&Na(_.prev,_,_.next)!==0)_=_.next;else{if($c(_),_=e=_.prev,_===_.next)break;l=!0}while(l||_!==e);return e}function $o(E,e,l,_,y,S,O){if(!E)return;!O&&S&&function($,K,ie,ne){let ue=$;do ue.z===null&&(ue.z=af(ue.x,ue.y,K,ie,ne)),ue.prevZ=ue.prev,ue.nextZ=ue.next,ue=ue.next;while(ue!==$);ue.prevZ.nextZ=null,ue.prevZ=null,function(ye){let Se,_e,$e,st,ot,Lt,Bt,di,Ti=1;do{for(_e=ye,ye=null,ot=null,Lt=0;_e;){for(Lt++,$e=_e,Bt=0,Se=0;Se<Ti&&(Bt++,$e=$e.nextZ,$e);Se++);for(di=Ti;Bt>0||di>0&&$e;)Bt!==0&&(di===0||!$e||_e.z<=$e.z)?(st=_e,_e=_e.nextZ,Bt--):(st=$e,$e=$e.nextZ,di--),ot?ot.nextZ=st:ye=st,st.prevZ=ot,ot=st;_e=$e}ot.nextZ=null,Ti*=2}while(Lt>1)}(ue)}(E,_,y,S);let k,N,G=E;for(;E.prev!==E.next;)if(k=E.prev,N=E.next,S?Xc(E,_,y,S):zl(E))e.push(k.i/l),e.push(E.i/l),e.push(N.i/l),$c(E),E=N.next,G=N.next;else if((E=N)===G){O?O===1?$o(E=hc(Yo(E),e,l),e,l,_,y,S,2):O===2&&Ic(E,e,l,_,y,S):$o(Yo(E),e,l,_,y,S,1);break}}function zl(E){const e=E.prev,l=E,_=E.next;if(Na(e,l,_)>=0)return!1;let y=E.next.next;for(;y!==E.prev;){if(vl(e.x,e.y,l.x,l.y,_.x,_.y,y.x,y.y)&&Na(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function Xc(E,e,l,_){const y=E.prev,S=E,O=E.next;if(Na(y,S,O)>=0)return!1;const k=y.x<S.x?y.x<O.x?y.x:O.x:S.x<O.x?S.x:O.x,N=y.y<S.y?y.y<O.y?y.y:O.y:S.y<O.y?S.y:O.y,G=y.x>S.x?y.x>O.x?y.x:O.x:S.x>O.x?S.x:O.x,$=y.y>S.y?y.y>O.y?y.y:O.y:S.y>O.y?S.y:O.y,K=af(k,N,e,l,_),ie=af(G,$,e,l,_);let ne=E.prevZ,ue=E.nextZ;for(;ne&&ne.z>=K&&ue&&ue.z<=ie;){if(ne!==E.prev&&ne!==E.next&&vl(y.x,y.y,S.x,S.y,O.x,O.y,ne.x,ne.y)&&Na(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,ue!==E.prev&&ue!==E.next&&vl(y.x,y.y,S.x,S.y,O.x,O.y,ue.x,ue.y)&&Na(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;ne&&ne.z>=K;){if(ne!==E.prev&&ne!==E.next&&vl(y.x,y.y,S.x,S.y,O.x,O.y,ne.x,ne.y)&&Na(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;ue&&ue.z<=ie;){if(ue!==E.prev&&ue!==E.next&&vl(y.x,y.y,S.x,S.y,O.x,O.y,ue.x,ue.y)&&Na(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function hc(E,e,l){let _=E;do{const y=_.prev,S=_.next.next;!xl(y,S)&&yu(y,_,_.next,S)&&vu(y,S)&&vu(S,y)&&(e.push(y.i/l),e.push(_.i/l),e.push(S.i/l),$c(_),$c(_.next),_=E=S),_=_.next}while(_!==E);return Yo(_)}function Ic(E,e,l,_,y,S){let O=E;do{let k=O.next.next;for(;k!==O.prev;){if(O.i!==k.i&&ip(O,k)){let N=Ko(O,k);return O=Yo(O,O.next),N=Yo(N,N.next),$o(O,e,l,_,y,S),void $o(N,e,l,_,y,S)}k=k.next}O=O.next}while(O!==E)}function _u(E,e){return E.x-e.x}function Yl(E,e){if(e=function(l,_){let y=_;const S=l.x,O=l.y;let k,N=-1/0;do{if(O<=y.y&&O>=y.next.y&&y.next.y!==y.y){const ue=y.x+(O-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(ue<=S&&ue>N){if(N=ue,ue===S){if(O===y.y)return y;if(O===y.next.y)return y.next}k=y.x<y.next.x?y:y.next}}y=y.next}while(y!==_);if(!k)return null;if(S===N)return k;const G=k,$=k.x,K=k.y;let ie,ne=1/0;y=k;do S>=y.x&&y.x>=$&&S!==y.x&&vl(O<K?S:N,O,$,K,O<K?N:S,O,y.x,y.y)&&(ie=Math.abs(O-y.y)/(S-y.x),vu(y,l)&&(ie<ne||ie===ne&&(y.x>k.x||y.x===k.x&&yl(k,y)))&&(k=y,ne=ie)),y=y.next;while(y!==G);return k}(E,e)){const l=Ko(e,E);Yo(e,e.next),Yo(l,l.next)}}function yl(E,e){return Na(E.prev,E,e.prev)<0&&Na(e.next,E,E.next)<0}function af(E,e,l,_,y){return(E=1431655765&((E=858993459&((E=252645135&((E=16711935&((E=32767*(E-l)*y)|E<<8))|E<<4))|E<<2))|E<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-_)*y)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Gp(E){let e=E,l=E;do(e.x<l.x||e.x===l.x&&e.y<l.y)&&(l=e),e=e.next;while(e!==E);return l}function vl(E,e,l,_,y,S,O,k){return(y-O)*(e-k)-(E-O)*(S-k)>=0&&(E-O)*(_-k)-(l-O)*(e-k)>=0&&(l-O)*(S-k)-(y-O)*(_-k)>=0}function ip(E,e){return E.next.i!==e.i&&E.prev.i!==e.i&&!function(l,_){let y=l;do{if(y.i!==l.i&&y.next.i!==l.i&&y.i!==_.i&&y.next.i!==_.i&&yu(y,y.next,l,_))return!0;y=y.next}while(y!==l);return!1}(E,e)&&(vu(E,e)&&vu(e,E)&&function(l,_){let y=l,S=!1;const O=(l.x+_.x)/2,k=(l.y+_.y)/2;do y.y>k!=y.next.y>k&&y.next.y!==y.y&&O<(y.next.x-y.x)*(k-y.y)/(y.next.y-y.y)+y.x&&(S=!S),y=y.next;while(y!==l);return S}(E,e)&&(Na(E.prev,E,e.prev)||Na(E,e.prev,e))||xl(E,e)&&Na(E.prev,E,E.next)>0&&Na(e.prev,e,e.next)>0)}function Na(E,e,l){return(e.y-E.y)*(l.x-e.x)-(e.x-E.x)*(l.y-e.y)}function xl(E,e){return E.x===e.x&&E.y===e.y}function yu(E,e,l,_){const y=Yc(Na(E,e,l)),S=Yc(Na(E,e,_)),O=Yc(Na(l,_,E)),k=Yc(Na(l,_,e));return y!==S&&O!==k||!(y!==0||!Ju(E,l,e))||!(S!==0||!Ju(E,_,e))||!(O!==0||!Ju(l,E,_))||!(k!==0||!Ju(l,e,_))}function Ju(E,e,l){return e.x<=Math.max(E.x,l.x)&&e.x>=Math.min(E.x,l.x)&&e.y<=Math.max(E.y,l.y)&&e.y>=Math.min(E.y,l.y)}function Yc(E){return E>0?1:E<0?-1:0}function vu(E,e){return Na(E.prev,E,E.next)<0?Na(E,e,E.next)>=0&&Na(E,E.prev,e)>=0:Na(E,e,E.prev)<0||Na(E,E.next,e)<0}function Ko(E,e){const l=new xu(E.i,E.x,E.y),_=new xu(e.i,e.x,e.y),y=E.next,S=e.prev;return E.next=e,e.prev=E,l.next=y,y.prev=l,_.next=l,l.prev=_,S.next=_,_.prev=S,_}function Jo(E,e,l,_){const y=new xu(E,e,l);return _?(y.next=_.next,y.prev=_,_.next.prev=y,_.next=y):(y.prev=y,y.next=y),y}function $c(E){E.next.prev=E.prev,E.prev.next=E.next,E.prevZ&&(E.prevZ.nextZ=E.nextZ),E.nextZ&&(E.nextZ.prevZ=E.prevZ)}function xu(E,e,l){this.i=E,this.x=e,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class So{static area(e){const l=e.length;let _=0;for(let y=l-1,S=0;S<l;y=S++)_+=e[y].x*e[S].y-e[S].x*e[y].y;return .5*_}static isClockWise(e){return So.area(e)<0}static triangulateShape(e,l){const _=[],y=[],S=[];Kc(e),xa(_,e);let O=e.length;l.forEach(Kc);for(let N=0;N<l.length;N++)y.push(O),O+=l[N].length,xa(_,l[N]);const k=bp(_,y);for(let N=0;N<k.length;N+=3)S.push(k.slice(N,N+3));return S}}function Kc(E){const e=E.length;e>2&&E[e-1].equals(E[0])&&E.pop()}function xa(E,e){for(let l=0;l<e.length;l++)E.push(e[l].x),E.push(e[l].y)}class ko extends oa{constructor(e,l){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:l},e=Array.isArray(e)?e:[e];const _=this,y=[],S=[];for(let k=0,N=e.length;k<N;k++)O(e[k]);function O(k){const N=[],G=l.curveSegments!==void 0?l.curveSegments:12,$=l.steps!==void 0?l.steps:1;let K=l.depth!==void 0?l.depth:100,ie=l.bevelEnabled===void 0||l.bevelEnabled,ne=l.bevelThickness!==void 0?l.bevelThickness:6,ue=l.bevelSize!==void 0?l.bevelSize:ne-2,ye=l.bevelOffset!==void 0?l.bevelOffset:0,Se=l.bevelSegments!==void 0?l.bevelSegments:3;const _e=l.extrudePath,$e=l.UVGenerator!==void 0?l.UVGenerator:yd;l.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),K=l.amount);let st,ot,Lt,Bt,di,Ti=!1;_e&&(st=_e.getSpacedPoints($),Ti=!0,ie=!1,ot=_e.computeFrenetFrames($,!1),Lt=new ht,Bt=new ht,di=new ht),ie||(Se=0,ne=0,ue=0,ye=0);const Ki=k.extractPoints(G);let Bi=Ki.shape;const Zi=Ki.holes;if(!So.isClockWise(Bi)){Bi=Bi.reverse();for(let $i=0,Mt=Zi.length;$i<Mt;$i++){const Oi=Zi[$i];So.isClockWise(Oi)&&(Zi[$i]=Oi.reverse())}}const hr=So.triangulateShape(Bi,Zi),Gn=Bi;for(let $i=0,Mt=Zi.length;$i<Mt;$i++){const Oi=Zi[$i];Bi=Bi.concat(Oi)}function gn($i,Mt,Oi){return Mt||console.error("THREE.ExtrudeGeometry: vec does not exist"),Mt.clone().multiplyScalar(Oi).add($i)}const Yn=Bi.length,Mr=hr.length;function Cr($i,Mt,Oi){let Ln,Bn,Rn;const Dr=$i.x-Mt.x,Qr=$i.y-Mt.y,Or=Oi.x-$i.x,Ba=Oi.y-$i.y,Ea=Dr*Dr+Qr*Qr,nl=Dr*Ba-Qr*Or;if(Math.abs(nl)>Number.EPSILON){const os=Math.sqrt(Ea),_o=Math.sqrt(Or*Or+Ba*Ba),dc=Mt.x-Qr/os,of=Mt.y+Dr/os,Jc=((Oi.x-Ba/_o-dc)*Ba-(Oi.y+Or/_o-of)*Or)/(Dr*Ba-Qr*Or);Ln=dc+Dr*Jc-$i.x,Bn=of+Qr*Jc-$i.y;const Tu=Ln*Ln+Bn*Bn;if(Tu<=2)return new dn(Ln,Bn);Rn=Math.sqrt(Tu/2)}else{let os=!1;Dr>Number.EPSILON?Or>Number.EPSILON&&(os=!0):Dr<-Number.EPSILON?Or<-Number.EPSILON&&(os=!0):Math.sign(Qr)===Math.sign(Ba)&&(os=!0),os?(Ln=-Qr,Bn=Dr,Rn=Math.sqrt(Ea)):(Ln=Dr,Bn=Qr,Rn=Math.sqrt(Ea/2))}return new dn(Ln/Rn,Bn/Rn)}const kr=[];for(let $i=0,Mt=Gn.length,Oi=Mt-1,Ln=$i+1;$i<Mt;$i++,Oi++,Ln++)Oi===Mt&&(Oi=0),Ln===Mt&&(Ln=0),kr[$i]=Cr(Gn[$i],Gn[Oi],Gn[Ln]);const Zr=[];let la,Kn=kr.concat();for(let $i=0,Mt=Zi.length;$i<Mt;$i++){const Oi=Zi[$i];la=[];for(let Ln=0,Bn=Oi.length,Rn=Bn-1,Dr=Ln+1;Ln<Bn;Ln++,Rn++,Dr++)Rn===Bn&&(Rn=0),Dr===Bn&&(Dr=0),la[Ln]=Cr(Oi[Ln],Oi[Rn],Oi[Dr]);Zr.push(la),Kn=Kn.concat(la)}for(let $i=0;$i<Se;$i++){const Mt=$i/Se,Oi=ne*Math.cos(Mt*Math.PI/2),Ln=ue*Math.sin(Mt*Math.PI/2)+ye;for(let Bn=0,Rn=Gn.length;Bn<Rn;Bn++){const Dr=gn(Gn[Bn],kr[Bn],Ln);xn(Dr.x,Dr.y,-Oi)}for(let Bn=0,Rn=Zi.length;Bn<Rn;Bn++){const Dr=Zi[Bn];la=Zr[Bn];for(let Qr=0,Or=Dr.length;Qr<Or;Qr++){const Ba=gn(Dr[Qr],la[Qr],Ln);xn(Ba.x,Ba.y,-Oi)}}}const At=ue+ye;for(let $i=0;$i<Yn;$i++){const Mt=ie?gn(Bi[$i],Kn[$i],At):Bi[$i];Ti?(Bt.copy(ot.normals[0]).multiplyScalar(Mt.x),Lt.copy(ot.binormals[0]).multiplyScalar(Mt.y),di.copy(st[0]).add(Bt).add(Lt),xn(di.x,di.y,di.z)):xn(Mt.x,Mt.y,0)}for(let $i=1;$i<=$;$i++)for(let Mt=0;Mt<Yn;Mt++){const Oi=ie?gn(Bi[Mt],Kn[Mt],At):Bi[Mt];Ti?(Bt.copy(ot.normals[$i]).multiplyScalar(Oi.x),Lt.copy(ot.binormals[$i]).multiplyScalar(Oi.y),di.copy(st[$i]).add(Bt).add(Lt),xn(di.x,di.y,di.z)):xn(Oi.x,Oi.y,K/$*$i)}for(let $i=Se-1;$i>=0;$i--){const Mt=$i/Se,Oi=ne*Math.cos(Mt*Math.PI/2),Ln=ue*Math.sin(Mt*Math.PI/2)+ye;for(let Bn=0,Rn=Gn.length;Bn<Rn;Bn++){const Dr=gn(Gn[Bn],kr[Bn],Ln);xn(Dr.x,Dr.y,K+Oi)}for(let Bn=0,Rn=Zi.length;Bn<Rn;Bn++){const Dr=Zi[Bn];la=Zr[Bn];for(let Qr=0,Or=Dr.length;Qr<Or;Qr++){const Ba=gn(Dr[Qr],la[Qr],Ln);Ti?xn(Ba.x,Ba.y+st[$-1].y,st[$-1].x+Oi):xn(Ba.x,Ba.y,K+Oi)}}}function Qt($i,Mt){let Oi=$i.length;for(;--Oi>=0;){const Ln=Oi;let Bn=Oi-1;Bn<0&&(Bn=$i.length-1);for(let Rn=0,Dr=$+2*Se;Rn<Dr;Rn++){const Qr=Yn*Rn,Or=Yn*(Rn+1);ji(Mt+Ln+Qr,Mt+Bn+Qr,Mt+Bn+Or,Mt+Ln+Or)}}}function xn($i,Mt,Oi){N.push($i),N.push(Mt),N.push(Oi)}function Vi($i,Mt,Oi){ir($i),ir(Mt),ir(Oi);const Ln=y.length/3,Bn=$e.generateTopUV(_,y,Ln-3,Ln-2,Ln-1);$n(Bn[0]),$n(Bn[1]),$n(Bn[2])}function ji($i,Mt,Oi,Ln){ir($i),ir(Mt),ir(Ln),ir(Mt),ir(Oi),ir(Ln);const Bn=y.length/3,Rn=$e.generateSideWallUV(_,y,Bn-6,Bn-3,Bn-2,Bn-1);$n(Rn[0]),$n(Rn[1]),$n(Rn[3]),$n(Rn[1]),$n(Rn[2]),$n(Rn[3])}function ir($i){y.push(N[3*$i+0]),y.push(N[3*$i+1]),y.push(N[3*$i+2])}function $n($i){S.push($i.x),S.push($i.y)}(function(){const $i=y.length/3;if(ie){let Mt=0,Oi=Yn*Mt;for(let Ln=0;Ln<Mr;Ln++){const Bn=hr[Ln];Vi(Bn[2]+Oi,Bn[1]+Oi,Bn[0]+Oi)}Mt=$+2*Se,Oi=Yn*Mt;for(let Ln=0;Ln<Mr;Ln++){const Bn=hr[Ln];Vi(Bn[0]+Oi,Bn[1]+Oi,Bn[2]+Oi)}}else{for(let Mt=0;Mt<Mr;Mt++){const Oi=hr[Mt];Vi(Oi[2],Oi[1],Oi[0])}for(let Mt=0;Mt<Mr;Mt++){const Oi=hr[Mt];Vi(Oi[0]+Yn*$,Oi[1]+Yn*$,Oi[2]+Yn*$)}}_.addGroup($i,y.length/3-$i,0)})(),function(){const $i=y.length/3;let Mt=0;Qt(Gn,Mt),Mt+=Gn.length;for(let Oi=0,Ln=Zi.length;Oi<Ln;Oi++){const Bn=Zi[Oi];Qt(Bn,Mt),Mt+=Bn.length}_.addGroup($i,y.length/3-$i,1)}()}this.setAttribute("position",new or(y,3)),this.setAttribute("uv",new or(S,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(l,_,y){if(y.shapes=[],Array.isArray(l))for(let S=0,O=l.length;S<O;S++){const k=l[S];y.shapes.push(k.uuid)}else y.shapes.push(l.uuid);return _.extrudePath!==void 0&&(y.options.extrudePath=_.extrudePath.toJSON()),y}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,l){const _=[];for(let S=0,O=e.shapes.length;S<O;S++){const k=l[e.shapes[S]];_.push(k)}const y=e.options.extrudePath;return y!==void 0&&(e.options.extrudePath=new rf[y.type]().fromJSON(y)),new ko(_,e.options)}}const yd={generateTopUV:function(E,e,l,_,y){const S=e[3*l],O=e[3*l+1],k=e[3*_],N=e[3*_+1],G=e[3*y],$=e[3*y+1];return[new dn(S,O),new dn(k,N),new dn(G,$)]},generateSideWallUV:function(E,e,l,_,y,S){const O=e[3*l],k=e[3*l+1],N=e[3*l+2],G=e[3*_],$=e[3*_+1],K=e[3*_+2],ie=e[3*y],ne=e[3*y+1],ue=e[3*y+2],ye=e[3*S],Se=e[3*S+1],_e=e[3*S+2];return Math.abs(k-$)<Math.abs(O-G)?[new dn(O,1-N),new dn(G,1-K),new dn(ie,1-ue),new dn(ye,1-_e)]:[new dn(k,1-N),new dn($,1-K),new dn(ne,1-ue),new dn(Se,1-_e)]}};class Qo extends Lc{constructor(e=1,l=0){const _=(1+Math.sqrt(5))/2;super([-1,_,0,1,_,0,-1,-_,0,1,-_,0,0,-1,_,0,1,_,0,-1,-_,0,1,-_,_,0,-1,_,0,1,-_,0,-1,-_,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,l),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:l}}static fromJSON(e){return new Qo(e.radius,e.detail)}}class bu extends oa{constructor(e,l=12,_=0,y=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:l,phiStart:_,phiLength:y},l=Math.floor(l),y=Er(y,0,2*Math.PI);const S=[],O=[],k=[],N=1/l,G=new ht,$=new dn;for(let K=0;K<=l;K++){const ie=_+K*N*y,ne=Math.sin(ie),ue=Math.cos(ie);for(let ye=0;ye<=e.length-1;ye++)G.x=e[ye].x*ne,G.y=e[ye].y,G.z=e[ye].x*ue,O.push(G.x,G.y,G.z),$.x=K/l,$.y=ye/(e.length-1),k.push($.x,$.y)}for(let K=0;K<l;K++)for(let ie=0;ie<e.length-1;ie++){const ne=ie+K*e.length,ue=ne,ye=ne+e.length,Se=ne+e.length+1,_e=ne+1;S.push(ue,ye,_e),S.push(ye,Se,_e)}if(this.setIndex(S),this.setAttribute("position",new or(O,3)),this.setAttribute("uv",new or(k,2)),this.computeVertexNormals(),y===2*Math.PI){const K=this.attributes.normal.array,ie=new ht,ne=new ht,ue=new ht,ye=l*e.length*3;for(let Se=0,_e=0;Se<e.length;Se++,_e+=3)ie.x=K[_e+0],ie.y=K[_e+1],ie.z=K[_e+2],ne.x=K[ye+_e+0],ne.y=K[ye+_e+1],ne.z=K[ye+_e+2],ue.addVectors(ie,ne).normalize(),K[_e+0]=K[ye+_e+0]=ue.x,K[_e+1]=K[ye+_e+1]=ue.y,K[_e+2]=K[ye+_e+2]=ue.z}}static fromJSON(e){return new bu(e.points,e.segments,e.phiStart,e.phiLength)}}class cl extends Lc{constructor(e=1,l=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,l),this.type="OctahedronGeometry",this.parameters={radius:e,detail:l}}static fromJSON(e){return new cl(e.radius,e.detail)}}class Pl extends oa{constructor(e,l,_){super(),this.type="ParametricGeometry",this.parameters={func:e,slices:l,stacks:_};const y=[],S=[],O=[],k=[],N=1e-5,G=new ht,$=new ht,K=new ht,ie=new ht,ne=new ht;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const ue=l+1;for(let ye=0;ye<=_;ye++){const Se=ye/_;for(let _e=0;_e<=l;_e++){const $e=_e/l;e($e,Se,$),S.push($.x,$.y,$.z),$e-N>=0?(e($e-N,Se,K),ie.subVectors($,K)):(e($e+N,Se,K),ie.subVectors(K,$)),Se-N>=0?(e($e,Se-N,K),ne.subVectors($,K)):(e($e,Se+N,K),ne.subVectors(K,$)),G.crossVectors(ie,ne).normalize(),O.push(G.x,G.y,G.z),k.push($e,Se)}}for(let ye=0;ye<_;ye++)for(let Se=0;Se<l;Se++){const _e=ye*ue+Se,$e=ye*ue+Se+1,st=(ye+1)*ue+Se+1,ot=(ye+1)*ue+Se;y.push(_e,$e,ot),y.push($e,st,ot)}this.setIndex(y),this.setAttribute("position",new or(S,3)),this.setAttribute("normal",new or(O,3)),this.setAttribute("uv",new or(k,2))}}class io extends oa{constructor(e=.5,l=1,_=8,y=1,S=0,O=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:l,thetaSegments:_,phiSegments:y,thetaStart:S,thetaLength:O},_=Math.max(3,_);const k=[],N=[],G=[],$=[];let K=e;const ie=(l-e)/(y=Math.max(1,y)),ne=new ht,ue=new dn;for(let ye=0;ye<=y;ye++){for(let Se=0;Se<=_;Se++){const _e=S+Se/_*O;ne.x=K*Math.cos(_e),ne.y=K*Math.sin(_e),N.push(ne.x,ne.y,ne.z),G.push(0,0,1),ue.x=(ne.x/l+1)/2,ue.y=(ne.y/l+1)/2,$.push(ue.x,ue.y)}K+=ie}for(let ye=0;ye<y;ye++){const Se=ye*(_+1);for(let _e=0;_e<_;_e++){const $e=_e+Se,st=$e,ot=$e+_+1,Lt=$e+_+2,Bt=$e+1;k.push(st,ot,Bt),k.push(ot,Lt,Bt)}}this.setIndex(k),this.setAttribute("position",new or(N,3)),this.setAttribute("normal",new or(G,3)),this.setAttribute("uv",new or($,2))}static fromJSON(e){return new io(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class ho extends oa{constructor(e,l=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:l};const _=[],y=[],S=[],O=[];let k=0,N=0;if(Array.isArray(e)===!1)G(e);else for(let $=0;$<e.length;$++)G(e[$]),this.addGroup(k,N,$),k+=N,N=0;function G($){const K=y.length/3,ie=$.extractPoints(l);let ne=ie.shape;const ue=ie.holes;So.isClockWise(ne)===!1&&(ne=ne.reverse());for(let Se=0,_e=ue.length;Se<_e;Se++){const $e=ue[Se];So.isClockWise($e)===!0&&(ue[Se]=$e.reverse())}const ye=So.triangulateShape(ne,ue);for(let Se=0,_e=ue.length;Se<_e;Se++){const $e=ue[Se];ne=ne.concat($e)}for(let Se=0,_e=ne.length;Se<_e;Se++){const $e=ne[Se];y.push($e.x,$e.y,0),S.push(0,0,1),O.push($e.x,$e.y)}for(let Se=0,_e=ye.length;Se<_e;Se++){const $e=ye[Se],st=$e[0]+K,ot=$e[1]+K,Lt=$e[2]+K;_.push(st,ot,Lt),N+=3}}this.setIndex(_),this.setAttribute("position",new or(y,3)),this.setAttribute("normal",new or(S,3)),this.setAttribute("uv",new or(O,2))}toJSON(){const e=super.toJSON();return function(l,_){if(_.shapes=[],Array.isArray(l))for(let y=0,S=l.length;y<S;y++){const O=l[y];_.shapes.push(O.uuid)}else _.shapes.push(l.uuid);return _}(this.parameters.shapes,e)}static fromJSON(e,l){const _=[];for(let y=0,S=e.shapes.length;y<S;y++){const O=l[e.shapes[y]];_.push(O)}return new ho(_,e.curveSegments)}}class Is extends oa{constructor(e=1,l=32,_=16,y=0,S=2*Math.PI,O=0,k=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:l,heightSegments:_,phiStart:y,phiLength:S,thetaStart:O,thetaLength:k},l=Math.max(3,Math.floor(l)),_=Math.max(2,Math.floor(_));const N=Math.min(O+k,Math.PI);let G=0;const $=[],K=new ht,ie=new ht,ne=[],ue=[],ye=[],Se=[];for(let _e=0;_e<=_;_e++){const $e=[],st=_e/_;let ot=0;_e==0&&O==0?ot=.5/l:_e==_&&N==Math.PI&&(ot=-.5/l);for(let Lt=0;Lt<=l;Lt++){const Bt=Lt/l;K.x=-e*Math.cos(y+Bt*S)*Math.sin(O+st*k),K.y=e*Math.cos(O+st*k),K.z=e*Math.sin(y+Bt*S)*Math.sin(O+st*k),ue.push(K.x,K.y,K.z),ie.copy(K).normalize(),ye.push(ie.x,ie.y,ie.z),Se.push(Bt+ot,1-st),$e.push(G++)}$.push($e)}for(let _e=0;_e<_;_e++)for(let $e=0;$e<l;$e++){const st=$[_e][$e+1],ot=$[_e][$e],Lt=$[_e+1][$e],Bt=$[_e+1][$e+1];(_e!==0||O>0)&&ne.push(st,ot,Bt),(_e!==_-1||N<Math.PI)&&ne.push(ot,Lt,Bt)}this.setIndex(ne),this.setAttribute("position",new or(ue,3)),this.setAttribute("normal",new or(ye,3)),this.setAttribute("uv",new or(Se,2))}static fromJSON(e){return new Is(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Ol extends Lc{constructor(e=1,l=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,l),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:l}}static fromJSON(e){return new Ol(e.radius,e.detail)}}class Va extends ko{constructor(e,l={}){const _=l.font;if(!_||!_.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new oa;const y=_.generateShapes(e,l.size);l.depth=l.height!==void 0?l.height:50,l.bevelThickness===void 0&&(l.bevelThickness=10),l.bevelSize===void 0&&(l.bevelSize=8),l.bevelEnabled===void 0&&(l.bevelEnabled=!1),super(y,l),this.type="TextGeometry"}}class wu extends oa{constructor(e=1,l=.4,_=8,y=6,S=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:l,radialSegments:_,tubularSegments:y,arc:S},_=Math.floor(_),y=Math.floor(y);const O=[],k=[],N=[],G=[],$=new ht,K=new ht,ie=new ht;for(let ne=0;ne<=_;ne++)for(let ue=0;ue<=y;ue++){const ye=ue/y*S,Se=ne/_*Math.PI*2;K.x=(e+l*Math.cos(Se))*Math.cos(ye),K.y=(e+l*Math.cos(Se))*Math.sin(ye),K.z=l*Math.sin(Se),k.push(K.x,K.y,K.z),$.x=e*Math.cos(ye),$.y=e*Math.sin(ye),ie.subVectors(K,$).normalize(),N.push(ie.x,ie.y,ie.z),G.push(ue/y),G.push(ne/_)}for(let ne=1;ne<=_;ne++)for(let ue=1;ue<=y;ue++){const ye=(y+1)*ne+ue-1,Se=(y+1)*(ne-1)+ue-1,_e=(y+1)*(ne-1)+ue,$e=(y+1)*ne+ue;O.push(ye,Se,$e),O.push(Se,_e,$e)}this.setIndex(O),this.setAttribute("position",new or(k,3)),this.setAttribute("normal",new or(N,3)),this.setAttribute("uv",new or(G,2))}static fromJSON(e){return new wu(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Dc extends oa{constructor(e=1,l=.4,_=64,y=8,S=2,O=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:l,tubularSegments:_,radialSegments:y,p:S,q:O},_=Math.floor(_),y=Math.floor(y);const k=[],N=[],G=[],$=[],K=new ht,ie=new ht,ne=new ht,ue=new ht,ye=new ht,Se=new ht,_e=new ht;for(let st=0;st<=_;++st){const ot=st/_*S*Math.PI*2;$e(ot,S,O,e,ne),$e(ot+.01,S,O,e,ue),Se.subVectors(ue,ne),_e.addVectors(ue,ne),ye.crossVectors(Se,_e),_e.crossVectors(ye,Se),ye.normalize(),_e.normalize();for(let Lt=0;Lt<=y;++Lt){const Bt=Lt/y*Math.PI*2,di=-l*Math.cos(Bt),Ti=l*Math.sin(Bt);K.x=ne.x+(di*_e.x+Ti*ye.x),K.y=ne.y+(di*_e.y+Ti*ye.y),K.z=ne.z+(di*_e.z+Ti*ye.z),N.push(K.x,K.y,K.z),ie.subVectors(K,ne).normalize(),G.push(ie.x,ie.y,ie.z),$.push(st/_),$.push(Lt/y)}}for(let st=1;st<=_;st++)for(let ot=1;ot<=y;ot++){const Lt=(y+1)*(st-1)+(ot-1),Bt=(y+1)*st+(ot-1),di=(y+1)*st+ot,Ti=(y+1)*(st-1)+ot;k.push(Lt,Bt,Ti),k.push(Bt,di,Ti)}function $e(st,ot,Lt,Bt,di){const Ti=Math.cos(st),Ki=Math.sin(st),Bi=Lt/ot*st,Zi=Math.cos(Bi);di.x=Bt*(2+Zi)*.5*Ti,di.y=Bt*(2+Zi)*Ki*.5,di.z=Bt*Math.sin(Bi)*.5}this.setIndex(k),this.setAttribute("position",new or(N,3)),this.setAttribute("normal",new or(G,3)),this.setAttribute("uv",new or($,2))}static fromJSON(e){return new Dc(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class d extends oa{constructor(e,l=64,_=1,y=8,S=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:l,radius:_,radialSegments:y,closed:S};const O=e.computeFrenetFrames(l,S);this.tangents=O.tangents,this.normals=O.normals,this.binormals=O.binormals;const k=new ht,N=new ht,G=new dn;let $=new ht;const K=[],ie=[],ne=[],ue=[];function ye(Se){$=e.getPointAt(Se/l,$);const _e=O.normals[Se],$e=O.binormals[Se];for(let st=0;st<=y;st++){const ot=st/y*Math.PI*2,Lt=Math.sin(ot),Bt=-Math.cos(ot);N.x=Bt*_e.x+Lt*$e.x,N.y=Bt*_e.y+Lt*$e.y,N.z=Bt*_e.z+Lt*$e.z,N.normalize(),ie.push(N.x,N.y,N.z),k.x=$.x+_*N.x,k.y=$.y+_*N.y,k.z=$.z+_*N.z,K.push(k.x,k.y,k.z)}}(function(){for(let Se=0;Se<l;Se++)ye(Se);ye(S===!1?l:0),function(){for(let Se=0;Se<=l;Se++)for(let _e=0;_e<=y;_e++)G.x=Se/l,G.y=_e/y,ne.push(G.x,G.y)}(),function(){for(let Se=1;Se<=l;Se++)for(let _e=1;_e<=y;_e++){const $e=(y+1)*(Se-1)+(_e-1),st=(y+1)*Se+(_e-1),ot=(y+1)*Se+_e,Lt=(y+1)*(Se-1)+_e;ue.push($e,st,Lt),ue.push(st,ot,Lt)}}()})(),this.setIndex(ue),this.setAttribute("position",new or(K,3)),this.setAttribute("normal",new or(ie,3)),this.setAttribute("uv",new or(ne,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new d(new rf[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class i extends oa{constructor(e){if(super(),this.type="WireframeGeometry",e.isGeometry===!0)return void console.error("THREE.WireframeGeometry no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");const l=[],_=new Set,y=new ht,S=new ht;if(e.index!==null){const O=e.attributes.position,k=e.index;let N=e.groups;N.length===0&&(N=[{start:0,count:k.count,materialIndex:0}]);for(let G=0,$=N.length;G<$;++G){const K=N[G],ie=K.start;for(let ne=ie,ue=ie+K.count;ne<ue;ne+=3)for(let ye=0;ye<3;ye++){const Se=k.getX(ne+ye),_e=k.getX(ne+(ye+1)%3);y.fromBufferAttribute(O,Se),S.fromBufferAttribute(O,_e),a(y,S,_)===!0&&(l.push(y.x,y.y,y.z),l.push(S.x,S.y,S.z))}}}else{const O=e.attributes.position;for(let k=0,N=O.count/3;k<N;k++)for(let G=0;G<3;G++){const $=3*k+G,K=3*k+(G+1)%3;y.fromBufferAttribute(O,$),S.fromBufferAttribute(O,K),a(y,S,_)===!0&&(l.push(y.x,y.y,y.z),l.push(S.x,S.y,S.z))}}this.setAttribute("position",new or(l,3))}}function a(E,e,l){const _=`${E.x},${E.y},${E.z}-${e.x},${e.y},${e.z}`,y=`${e.x},${e.y},${e.z}-${E.x},${E.y},${E.z}`;return l.has(_)!==!0&&l.has(y)!==!0&&(l.add(_,y),!0)}var f=Object.freeze({__proto__:null,BoxGeometry:Fr,BoxBufferGeometry:Fr,CircleGeometry:Oh,CircleBufferGeometry:Oh,ConeGeometry:md,ConeBufferGeometry:md,CylinderGeometry:mu,CylinderBufferGeometry:mu,DodecahedronGeometry:Zs,DodecahedronBufferGeometry:Zs,EdgesGeometry:Af,ExtrudeGeometry:ko,ExtrudeBufferGeometry:ko,IcosahedronGeometry:Qo,IcosahedronBufferGeometry:Qo,LatheGeometry:bu,LatheBufferGeometry:bu,OctahedronGeometry:cl,OctahedronBufferGeometry:cl,ParametricGeometry:Pl,ParametricBufferGeometry:Pl,PlaneGeometry:Du,PlaneBufferGeometry:Du,PolyhedronGeometry:Lc,PolyhedronBufferGeometry:Lc,RingGeometry:io,RingBufferGeometry:io,ShapeGeometry:ho,ShapeBufferGeometry:ho,SphereGeometry:Is,SphereBufferGeometry:Is,TetrahedronGeometry:Ol,TetrahedronBufferGeometry:Ol,TextGeometry:Va,TextBufferGeometry:Va,TorusGeometry:wu,TorusBufferGeometry:wu,TorusKnotGeometry:Dc,TorusKnotBufferGeometry:Dc,TubeGeometry:d,TubeBufferGeometry:d,WireframeGeometry:i});class v extends rn{constructor(e){super(),this.type="ShadowMaterial",this.color=new On(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}v.prototype.isShadowMaterial=!0;class x extends rn{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new On(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new On(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}x.prototype.isMeshStandardMaterial=!0;class T extends x{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new dn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Er(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(l){this.ior=(1+.4*l)/(1-.4*l)}}),this.sheenTint=new On(0),this.transmission=0,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationTint=new On(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularTint=new On(1,1,1),this.specularTintMap=null,this._clearcoat=0,this._transmission=0,this.setValues(e)}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheenTint.copy(e.sheenTint),this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationTint.copy(e.attenuationTint),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularTint.copy(e.specularTint),this.specularTintMap=e.specularTintMap,this}}T.prototype.isMeshPhysicalMaterial=!0;class I extends rn{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new On(16777215),this.specular=new On(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new On(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}I.prototype.isMeshPhongMaterial=!0;class F extends rn{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new On(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new On(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}F.prototype.isMeshToonMaterial=!0;class V extends rn{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}V.prototype.isMeshNormalMaterial=!0;class j extends rn{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new On(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new On(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}j.prototype.isMeshLambertMaterial=!0;class Z extends rn{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new On(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}Z.prototype.isMeshMatcapMaterial=!0;class X extends go{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}X.prototype.isLineDashedMaterial=!0;var Q=Object.freeze({__proto__:null,ShadowMaterial:v,SpriteMaterial:Wd,RawShaderMaterial:hh,ShaderMaterial:El,PointsMaterial:Ac,MeshPhysicalMaterial:T,MeshStandardMaterial:x,MeshPhongMaterial:I,MeshToonMaterial:F,MeshNormalMaterial:V,MeshLambertMaterial:j,MeshDepthMaterial:ju,MeshDistanceMaterial:mo,MeshBasicMaterial:fa,MeshMatcapMaterial:Z,LineDashedMaterial:X,LineBasicMaterial:go,Material:rn});const le={arraySlice:function(E,e,l){return le.isTypedArray(E)?new E.constructor(E.subarray(e,l!==void 0?l:E.length)):E.slice(e,l)},convertArray:function(E,e,l){return!E||!l&&E.constructor===e?E:typeof e.BYTES_PER_ELEMENT=="number"?new e(E):Array.prototype.slice.call(E)},isTypedArray:function(E){return ArrayBuffer.isView(E)&&!(E instanceof DataView)},getKeyframeOrder:function(E){const e=E.length,l=new Array(e);for(let _=0;_!==e;++_)l[_]=_;return l.sort(function(_,y){return E[_]-E[y]}),l},sortedArray:function(E,e,l){const _=E.length,y=new E.constructor(_);for(let S=0,O=0;O!==_;++S){const k=l[S]*e;for(let N=0;N!==e;++N)y[O++]=E[k+N]}return y},flattenJSON:function(E,e,l,_){let y=1,S=E[0];for(;S!==void 0&&S[_]===void 0;)S=E[y++];if(S===void 0)return;let O=S[_];if(O!==void 0)if(Array.isArray(O))do O=S[_],O!==void 0&&(e.push(S.time),l.push.apply(l,O)),S=E[y++];while(S!==void 0);else if(O.toArray!==void 0)do O=S[_],O!==void 0&&(e.push(S.time),O.toArray(l,l.length)),S=E[y++];while(S!==void 0);else do O=S[_],O!==void 0&&(e.push(S.time),l.push(O)),S=E[y++];while(S!==void 0)},subclip:function(E,e,l,_,y=30){const S=E.clone();S.name=e;const O=[];for(let N=0;N<S.tracks.length;++N){const G=S.tracks[N],$=G.getValueSize(),K=[],ie=[];for(let ne=0;ne<G.times.length;++ne){const ue=G.times[ne]*y;if(!(ue<l||ue>=_)){K.push(G.times[ne]);for(let ye=0;ye<$;++ye)ie.push(G.values[ne*$+ye])}}K.length!==0&&(G.times=le.convertArray(K,G.times.constructor),G.values=le.convertArray(ie,G.values.constructor),O.push(G))}S.tracks=O;let k=1/0;for(let N=0;N<S.tracks.length;++N)k>S.tracks[N].times[0]&&(k=S.tracks[N].times[0]);for(let N=0;N<S.tracks.length;++N)S.tracks[N].shift(-1*k);return S.resetDuration(),S},makeClipAdditive:function(E,e=0,l=E,_=30){_<=0&&(_=30);const y=l.tracks.length,S=e/_;for(let O=0;O<y;++O){const k=l.tracks[O],N=k.ValueTypeName;if(N==="bool"||N==="string")continue;const G=E.tracks.find(function(_e){return _e.name===k.name&&_e.ValueTypeName===N});if(G===void 0)continue;let $=0;const K=k.getValueSize();k.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&($=K/3);let ie=0;const ne=G.getValueSize();G.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(ie=ne/3);const ue=k.times.length-1;let ye;if(S<=k.times[0]){const _e=$,$e=K-$;ye=le.arraySlice(k.values,_e,$e)}else if(S>=k.times[ue]){const _e=ue*K+$,$e=_e+K-$;ye=le.arraySlice(k.values,_e,$e)}else{const _e=k.createInterpolant(),$e=$,st=K-$;_e.evaluate(S),ye=le.arraySlice(_e.resultBuffer,$e,st)}N==="quaternion"&&new Ls().fromArray(ye).normalize().conjugate().toArray(ye);const Se=G.times.length;for(let _e=0;_e<Se;++_e){const $e=_e*ne+ie;if(N==="quaternion")Ls.multiplyQuaternionsFlat(G.values,$e,ye,0,G.values,$e);else{const st=ne-2*ie;for(let ot=0;ot<st;++ot)G.values[$e+ot]-=ye[ot]}}}return E.blendMode=2501,E}};class se{constructor(e,l,_,y){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=y!==void 0?y:new l.constructor(_),this.sampleValues=l,this.valueSize=_,this.settings=null,this.DefaultSettings_={}}evaluate(e){const l=this.parameterPositions;let _=this._cachedIndex,y=l[_],S=l[_-1];e:{t:{let O;i:{n:if(!(e<y)){for(let k=_+2;;){if(y===void 0){if(e<S)break n;return _=l.length,this._cachedIndex=_,this.afterEnd_(_-1,e,S)}if(_===k)break;if(S=y,y=l[++_],e<y)break t}O=l.length;break i}if(e>=S)break e;{const k=l[1];e<k&&(_=2,S=k);for(let N=_-2;;){if(S===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,y);if(_===N)break;if(y=S,S=l[--_-1],e>=S)break t}O=_,_=0}}for(;_<O;){const k=_+O>>>1;e<l[k]?O=k:_=k+1}if(y=l[_],S=l[_-1],S===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,y);if(y===void 0)return _=l.length,this._cachedIndex=_,this.afterEnd_(_-1,S,e)}this._cachedIndex=_,this.intervalChanged_(_,S,y)}return this.interpolate_(_,S,e,y)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const l=this.resultBuffer,_=this.sampleValues,y=this.valueSize,S=e*y;for(let O=0;O!==y;++O)l[O]=_[S+O];return l}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}se.prototype.beforeStart_=se.prototype.copySampleValue_,se.prototype.afterEnd_=se.prototype.copySampleValue_;class me extends se{constructor(e,l,_,y){super(e,l,_,y),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,l,_){const y=this.parameterPositions;let S=e-2,O=e+1,k=y[S],N=y[O];if(k===void 0)switch(this.getSettings_().endingStart){case 2401:S=e,k=2*l-_;break;case 2402:S=y.length-2,k=l+y[S]-y[S+1];break;default:S=e,k=_}if(N===void 0)switch(this.getSettings_().endingEnd){case 2401:O=e,N=2*_-l;break;case 2402:O=1,N=_+y[1]-y[0];break;default:O=e-1,N=l}const G=.5*(_-l),$=this.valueSize;this._weightPrev=G/(l-k),this._weightNext=G/(N-_),this._offsetPrev=S*$,this._offsetNext=O*$}interpolate_(e,l,_,y){const S=this.resultBuffer,O=this.sampleValues,k=this.valueSize,N=e*k,G=N-k,$=this._offsetPrev,K=this._offsetNext,ie=this._weightPrev,ne=this._weightNext,ue=(_-l)/(y-l),ye=ue*ue,Se=ye*ue,_e=-ie*Se+2*ie*ye-ie*ue,$e=(1+ie)*Se+(-1.5-2*ie)*ye+(-.5+ie)*ue+1,st=(-1-ne)*Se+(1.5+ne)*ye+.5*ue,ot=ne*Se-ne*ye;for(let Lt=0;Lt!==k;++Lt)S[Lt]=_e*O[$+Lt]+$e*O[G+Lt]+st*O[N+Lt]+ot*O[K+Lt];return S}}class fe extends se{constructor(e,l,_,y){super(e,l,_,y)}interpolate_(e,l,_,y){const S=this.resultBuffer,O=this.sampleValues,k=this.valueSize,N=e*k,G=N-k,$=(_-l)/(y-l),K=1-$;for(let ie=0;ie!==k;++ie)S[ie]=O[G+ie]*K+O[N+ie]*$;return S}}class De extends se{constructor(e,l,_,y){super(e,l,_,y)}interpolate_(e){return this.copySampleValue_(e-1)}}class ke{constructor(e,l,_,y){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(l===void 0||l.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=le.convertArray(l,this.TimeBufferType),this.values=le.convertArray(_,this.ValueBufferType),this.setInterpolation(y||this.DefaultInterpolation)}static toJSON(e){const l=e.constructor;let _;if(l.toJSON!==this.toJSON)_=l.toJSON(e);else{_={name:e.name,times:le.convertArray(e.times,Array),values:le.convertArray(e.values,Array)};const y=e.getInterpolation();y!==e.DefaultInterpolation&&(_.interpolation=y)}return _.type=e.ValueTypeName,_}InterpolantFactoryMethodDiscrete(e){return new De(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new fe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new me(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let l;switch(e){case 2300:l=this.InterpolantFactoryMethodDiscrete;break;case 2301:l=this.InterpolantFactoryMethodLinear;break;case 2302:l=this.InterpolantFactoryMethodSmooth}if(l===void 0){const _="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(e===this.DefaultInterpolation)throw new Error(_);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",_),this}return this.createInterpolant=l,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const l=this.times;for(let _=0,y=l.length;_!==y;++_)l[_]+=e}return this}scale(e){if(e!==1){const l=this.times;for(let _=0,y=l.length;_!==y;++_)l[_]*=e}return this}trim(e,l){const _=this.times,y=_.length;let S=0,O=y-1;for(;S!==y&&_[S]<e;)++S;for(;O!==-1&&_[O]>l;)--O;if(++O,S!==0||O!==y){S>=O&&(O=Math.max(O,1),S=O-1);const k=this.getValueSize();this.times=le.arraySlice(_,S,O),this.values=le.arraySlice(this.values,S*k,O*k)}return this}validate(){let e=!0;const l=this.getValueSize();l-Math.floor(l)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const _=this.times,y=this.values,S=_.length;S===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let O=null;for(let k=0;k!==S;k++){const N=_[k];if(typeof N=="number"&&isNaN(N)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,k,N),e=!1;break}if(O!==null&&O>N){console.error("THREE.KeyframeTrack: Out of order keys.",this,k,N,O),e=!1;break}O=N}if(y!==void 0&&le.isTypedArray(y))for(let k=0,N=y.length;k!==N;++k){const G=y[k];if(isNaN(G)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,k,G),e=!1;break}}return e}optimize(){const e=le.arraySlice(this.times),l=le.arraySlice(this.values),_=this.getValueSize(),y=this.getInterpolation()===2302,S=e.length-1;let O=1;for(let k=1;k<S;++k){let N=!1;const G=e[k];if(G!==e[k+1]&&(k!==1||G!==e[0]))if(y)N=!0;else{const $=k*_,K=$-_,ie=$+_;for(let ne=0;ne!==_;++ne){const ue=l[$+ne];if(ue!==l[K+ne]||ue!==l[ie+ne]){N=!0;break}}}if(N){if(k!==O){e[O]=e[k];const $=k*_,K=O*_;for(let ie=0;ie!==_;++ie)l[K+ie]=l[$+ie]}++O}}if(S>0){e[O]=e[S];for(let k=S*_,N=O*_,G=0;G!==_;++G)l[N+G]=l[k+G];++O}return O!==e.length?(this.times=le.arraySlice(e,0,O),this.values=le.arraySlice(l,0,O*_)):(this.times=e,this.values=l),this}clone(){const e=le.arraySlice(this.times,0),l=le.arraySlice(this.values,0),_=new this.constructor(this.name,e,l);return _.createInterpolant=this.createInterpolant,_}}ke.prototype.TimeBufferType=Float32Array,ke.prototype.ValueBufferType=Float32Array,ke.prototype.DefaultInterpolation=2301;class Ne extends ke{}Ne.prototype.ValueTypeName="bool",Ne.prototype.ValueBufferType=Array,Ne.prototype.DefaultInterpolation=2300,Ne.prototype.InterpolantFactoryMethodLinear=void 0,Ne.prototype.InterpolantFactoryMethodSmooth=void 0;class tt extends ke{}tt.prototype.ValueTypeName="color";class He extends ke{}He.prototype.ValueTypeName="number";class We extends se{constructor(e,l,_,y){super(e,l,_,y)}interpolate_(e,l,_,y){const S=this.resultBuffer,O=this.sampleValues,k=this.valueSize,N=(_-l)/(y-l);let G=e*k;for(let $=G+k;G!==$;G+=4)Ls.slerpFlat(S,0,O,G-k,O,G,N);return S}}class je extends ke{InterpolantFactoryMethodLinear(e){return new We(this.times,this.values,this.getValueSize(),e)}}je.prototype.ValueTypeName="quaternion",je.prototype.DefaultInterpolation=2301,je.prototype.InterpolantFactoryMethodSmooth=void 0;class at extends ke{}at.prototype.ValueTypeName="string",at.prototype.ValueBufferType=Array,at.prototype.DefaultInterpolation=2300,at.prototype.InterpolantFactoryMethodLinear=void 0,at.prototype.InterpolantFactoryMethodSmooth=void 0;class gt extends ke{}gt.prototype.ValueTypeName="vector";class Jt{constructor(e,l=-1,_,y=2500){this.name=e,this.tracks=_,this.duration=l,this.blendMode=y,this.uuid=Sr(),this.duration<0&&this.resetDuration()}static parse(e){const l=[],_=e.tracks,y=1/(e.fps||1);for(let O=0,k=_.length;O!==k;++O)l.push(jt(_[O]).scale(y));const S=new this(e.name,e.duration,l,e.blendMode);return S.uuid=e.uuid,S}static toJSON(e){const l=[],_=e.tracks,y={name:e.name,duration:e.duration,tracks:l,uuid:e.uuid,blendMode:e.blendMode};for(let S=0,O=_.length;S!==O;++S)l.push(ke.toJSON(_[S]));return y}static CreateFromMorphTargetSequence(e,l,_,y){const S=l.length,O=[];for(let k=0;k<S;k++){let N=[],G=[];N.push((k+S-1)%S,k,(k+1)%S),G.push(0,1,0);const $=le.getKeyframeOrder(N);N=le.sortedArray(N,1,$),G=le.sortedArray(G,1,$),y||N[0]!==0||(N.push(S),G.push(G[0])),O.push(new He(".morphTargetInfluences["+l[k].name+"]",N,G).scale(1/_))}return new this(e,-1,O)}static findByName(e,l){let _=e;if(!Array.isArray(e)){const y=e;_=y.geometry&&y.geometry.animations||y.animations}for(let y=0;y<_.length;y++)if(_[y].name===l)return _[y];return null}static CreateClipsFromMorphTargetSequences(e,l,_){const y={},S=/^([\w-]*?)([\d]+)$/;for(let k=0,N=e.length;k<N;k++){const G=e[k],$=G.name.match(S);if($&&$.length>1){const K=$[1];let ie=y[K];ie||(y[K]=ie=[]),ie.push(G)}}const O=[];for(const k in y)O.push(this.CreateFromMorphTargetSequence(k,y[k],l,_));return O}static parseAnimation(e,l){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const _=function($,K,ie,ne,ue){if(ie.length!==0){const ye=[],Se=[];le.flattenJSON(ie,ye,Se,ne),ye.length!==0&&ue.push(new $(K,ye,Se))}},y=[],S=e.name||"default",O=e.fps||30,k=e.blendMode;let N=e.length||-1;const G=e.hierarchy||[];for(let $=0;$<G.length;$++){const K=G[$].keys;if(K&&K.length!==0)if(K[0].morphTargets){const ie={};let ne;for(ne=0;ne<K.length;ne++)if(K[ne].morphTargets)for(let ue=0;ue<K[ne].morphTargets.length;ue++)ie[K[ne].morphTargets[ue]]=-1;for(const ue in ie){const ye=[],Se=[];for(let _e=0;_e!==K[ne].morphTargets.length;++_e){const $e=K[ne];ye.push($e.time),Se.push($e.morphTarget===ue?1:0)}y.push(new He(".morphTargetInfluence["+ue+"]",ye,Se))}N=ie.length*O}else{const ie=".bones["+l[$].name+"]";_(gt,ie+".position",K,"pos",y),_(je,ie+".quaternion",K,"rot",y),_(gt,ie+".scale",K,"scl",y)}}return y.length===0?null:new this(S,N,y,k)}resetDuration(){let e=0;for(let l=0,_=this.tracks.length;l!==_;++l){const y=this.tracks[l];e=Math.max(e,y.times[y.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let l=0;l<this.tracks.length;l++)e=e&&this.tracks[l].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let l=0;l<this.tracks.length;l++)e.push(this.tracks[l].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function jt(E){if(E.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(l){switch(l.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return He;case"vector":case"vector2":case"vector3":case"vector4":return gt;case"color":return tt;case"quaternion":return je;case"bool":case"boolean":return Ne;case"string":return at}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+l)}(E.type);if(E.times===void 0){const l=[],_=[];le.flattenJSON(E.keys,l,_,"value"),E.times=l,E.values=_}return e.parse!==void 0?e.parse(E):new e(E.name,E.times,E.values,E.interpolation)}const fi={enabled:!1,files:{},add:function(E,e){this.enabled!==!1&&(this.files[E]=e)},get:function(E){if(this.enabled!==!1)return this.files[E]},remove:function(E){delete this.files[E]},clear:function(){this.files={}}};class ui{constructor(e,l,_){const y=this;let S,O=!1,k=0,N=0;const G=[];this.onStart=void 0,this.onLoad=e,this.onProgress=l,this.onError=_,this.itemStart=function($){N++,O===!1&&y.onStart!==void 0&&y.onStart($,k,N),O=!0},this.itemEnd=function($){k++,y.onProgress!==void 0&&y.onProgress($,k,N),k===N&&(O=!1,y.onLoad!==void 0&&y.onLoad())},this.itemError=function($){y.onError!==void 0&&y.onError($)},this.resolveURL=function($){return S?S($):$},this.setURLModifier=function($){return S=$,this},this.addHandler=function($,K){return G.push($,K),this},this.removeHandler=function($){const K=G.indexOf($);return K!==-1&&G.splice(K,2),this},this.getHandler=function($){for(let K=0,ie=G.length;K<ie;K+=2){const ne=G[K],ue=G[K+1];if(ne.global&&(ne.lastIndex=0),ne.test($))return ue}return null}}}const Pt=new ui;class Kt{constructor(e){this.manager=e!==void 0?e:Pt,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,l){const _=this;return new Promise(function(y,S){_.load(e,y,l,S)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Ii={};class Et extends Kt{constructor(e){super(e)}load(e,l,_,y){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const S=this,O=fi.get(e);if(O!==void 0)return S.manager.itemStart(e),setTimeout(function(){l&&l(O),S.manager.itemEnd(e)},0),O;if(Ii[e]!==void 0)return void Ii[e].push({onLoad:l,onProgress:_,onError:y});const k=e.match(/^data:(.*?)(;base64)?,(.*)$/);let N;if(k){const G=k[1],$=!!k[2];let K=k[3];K=decodeURIComponent(K),$&&(K=atob(K));try{let ie;const ne=(this.responseType||"").toLowerCase();switch(ne){case"arraybuffer":case"blob":const ue=new Uint8Array(K.length);for(let Se=0;Se<K.length;Se++)ue[Se]=K.charCodeAt(Se);ie=ne==="blob"?new Blob([ue.buffer],{type:G}):ue.buffer;break;case"document":ie=new DOMParser().parseFromString(K,G);break;case"json":ie=JSON.parse(K);break;default:ie=K}setTimeout(function(){l&&l(ie),S.manager.itemEnd(e)},0)}catch(ie){setTimeout(function(){y&&y(ie),S.manager.itemError(e),S.manager.itemEnd(e)},0)}}else{Ii[e]=[],Ii[e].push({onLoad:l,onProgress:_,onError:y}),N=new XMLHttpRequest,N.open("GET",e,!0),N.addEventListener("load",function(G){const $=this.response,K=Ii[e];if(delete Ii[e],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),fi.add(e,$);for(let ie=0,ne=K.length;ie<ne;ie++){const ue=K[ie];ue.onLoad&&ue.onLoad($)}S.manager.itemEnd(e)}else{for(let ie=0,ne=K.length;ie<ne;ie++){const ue=K[ie];ue.onError&&ue.onError(G)}S.manager.itemError(e),S.manager.itemEnd(e)}},!1),N.addEventListener("progress",function(G){const $=Ii[e];for(let K=0,ie=$.length;K<ie;K++){const ne=$[K];ne.onProgress&&ne.onProgress(G)}},!1),N.addEventListener("error",function(G){const $=Ii[e];delete Ii[e];for(let K=0,ie=$.length;K<ie;K++){const ne=$[K];ne.onError&&ne.onError(G)}S.manager.itemError(e),S.manager.itemEnd(e)},!1),N.addEventListener("abort",function(G){const $=Ii[e];delete Ii[e];for(let K=0,ie=$.length;K<ie;K++){const ne=$[K];ne.onError&&ne.onError(G)}S.manager.itemError(e),S.manager.itemEnd(e)},!1),this.responseType!==void 0&&(N.responseType=this.responseType),this.withCredentials!==void 0&&(N.withCredentials=this.withCredentials),N.overrideMimeType&&N.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(const G in this.requestHeader)N.setRequestHeader(G,this.requestHeader[G]);N.send(null)}return S.manager.itemStart(e),N}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class hi extends Kt{constructor(e){super(e)}load(e,l,_,y){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const S=this,O=fi.get(e);if(O!==void 0)return S.manager.itemStart(e),setTimeout(function(){l&&l(O),S.manager.itemEnd(e)},0),O;const k=document.createElementNS("http://www.w3.org/1999/xhtml","img");function N(){k.removeEventListener("load",N,!1),k.removeEventListener("error",G,!1),fi.add(e,this),l&&l(this),S.manager.itemEnd(e)}function G($){k.removeEventListener("load",N,!1),k.removeEventListener("error",G,!1),y&&y($),S.manager.itemError(e),S.manager.itemEnd(e)}return k.addEventListener("load",N,!1),k.addEventListener("error",G,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(k.crossOrigin=this.crossOrigin),S.manager.itemStart(e),k.src=e,k}}class si extends Kt{constructor(e){super(e)}load(e,l,_,y){const S=new Ru,O=new hi(this.manager);O.setCrossOrigin(this.crossOrigin),O.setPath(this.path);let k=0;function N(G){O.load(e[G],function($){S.images[G]=$,k++,k===6&&(S.needsUpdate=!0,l&&l(S))},void 0,y)}for(let G=0;G<e.length;++G)N(G);return S}}class an extends Kt{constructor(e){super(e)}load(e,l,_,y){const S=this,O=new Tc,k=new Et(this.manager);return k.setResponseType("arraybuffer"),k.setRequestHeader(this.requestHeader),k.setPath(this.path),k.setWithCredentials(S.withCredentials),k.load(e,function(N){const G=S.parse(N);G&&(G.image!==void 0?O.image=G.image:G.data!==void 0&&(O.image.width=G.width,O.image.height=G.height,O.image.data=G.data),O.wrapS=G.wrapS!==void 0?G.wrapS:1001,O.wrapT=G.wrapT!==void 0?G.wrapT:1001,O.magFilter=G.magFilter!==void 0?G.magFilter:1006,O.minFilter=G.minFilter!==void 0?G.minFilter:1006,O.anisotropy=G.anisotropy!==void 0?G.anisotropy:1,G.encoding!==void 0&&(O.encoding=G.encoding),G.flipY!==void 0&&(O.flipY=G.flipY),G.format!==void 0&&(O.format=G.format),G.type!==void 0&&(O.type=G.type),G.mipmaps!==void 0&&(O.mipmaps=G.mipmaps,O.minFilter=1008),G.mipmapCount===1&&(O.minFilter=1006),G.generateMipmaps!==void 0&&(O.generateMipmaps=G.generateMipmaps),O.needsUpdate=!0,l&&l(O,G))},_,y),O}}class zi extends Kt{constructor(e){super(e)}load(e,l,_,y){const S=new Ca,O=new hi(this.manager);return O.setCrossOrigin(this.crossOrigin),O.setPath(this.path),O.load(e,function(k){S.image=k;const N=e.search(/\.jpe?g($|\?)/i)>0||e.search(/^data\:image\/jpeg/)===0;S.format=N?1022:1023,S.needsUpdate=!0,l!==void 0&&l(S)},_,y),S}}class yi extends Xl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),l=this.curves[this.curves.length-1].getPoint(1);e.equals(l)||this.curves.push(new Rc(l,e))}getPoint(e){const l=e*this.getLength(),_=this.getCurveLengths();let y=0;for(;y<_.length;){if(_[y]>=l){const S=_[y]-l,O=this.curves[y],k=O.getLength(),N=k===0?0:1-S/k;return O.getPointAt(N)}y++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let l=0;for(let _=0,y=this.curves.length;_<y;_++)l+=this.curves[_].getLength(),e.push(l);return this.cacheLengths=e,e}getSpacedPoints(e=40){const l=[];for(let _=0;_<=e;_++)l.push(this.getPoint(_/e));return this.autoClose&&l.push(l[0]),l}getPoints(e=12){const l=[];let _;for(let y=0,S=this.curves;y<S.length;y++){const O=S[y],k=O&&O.isEllipseCurve?2*e:O&&(O.isLineCurve||O.isLineCurve3)?1:O&&O.isSplineCurve?e*O.points.length:e,N=O.getPoints(k);for(let G=0;G<N.length;G++){const $=N[G];_&&_.equals($)||(l.push($),_=$)}}return this.autoClose&&l.length>1&&!l[l.length-1].equals(l[0])&&l.push(l[0]),l}copy(e){super.copy(e),this.curves=[];for(let l=0,_=e.curves.length;l<_;l++){const y=e.curves[l];this.curves.push(y.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let l=0,_=this.curves.length;l<_;l++){const y=this.curves[l];e.curves.push(y.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let l=0,_=e.curves.length;l<_;l++){const y=e.curves[l];this.curves.push(new rf[y.type]().fromJSON(y))}return this}}class Hi extends yi{constructor(e){super(),this.type="Path",this.currentPoint=new dn,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let l=1,_=e.length;l<_;l++)this.lineTo(e[l].x,e[l].y);return this}moveTo(e,l){return this.currentPoint.set(e,l),this}lineTo(e,l){const _=new Rc(this.currentPoint.clone(),new dn(e,l));return this.curves.push(_),this.currentPoint.set(e,l),this}quadraticCurveTo(e,l,_,y){const S=new uc(this.currentPoint.clone(),new dn(e,l),new dn(_,y));return this.curves.push(S),this.currentPoint.set(_,y),this}bezierCurveTo(e,l,_,y,S,O){const k=new ws(this.currentPoint.clone(),new dn(e,l),new dn(_,y),new dn(S,O));return this.curves.push(k),this.currentPoint.set(S,O),this}splineThru(e){const l=[this.currentPoint.clone()].concat(e),_=new Bh(l);return this.curves.push(_),this.currentPoint.copy(e[e.length-1]),this}arc(e,l,_,y,S,O){const k=this.currentPoint.x,N=this.currentPoint.y;return this.absarc(e+k,l+N,_,y,S,O),this}absarc(e,l,_,y,S,O){return this.absellipse(e,l,_,_,y,S,O),this}ellipse(e,l,_,y,S,O,k,N){const G=this.currentPoint.x,$=this.currentPoint.y;return this.absellipse(e+G,l+$,_,y,S,O,k,N),this}absellipse(e,l,_,y,S,O,k,N){const G=new Yu(e,l,_,y,S,O,k,N);if(this.curves.length>0){const K=G.getPoint(0);K.equals(this.currentPoint)||this.lineTo(K.x,K.y)}this.curves.push(G);const $=G.getPoint(1);return this.currentPoint.copy($),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class en extends Hi{constructor(e){super(e),this.uuid=Sr(),this.type="Shape",this.holes=[]}getPointsHoles(e){const l=[];for(let _=0,y=this.holes.length;_<y;_++)l[_]=this.holes[_].getPoints(e);return l}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let l=0,_=e.holes.length;l<_;l++){const y=e.holes[l];this.holes.push(y.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let l=0,_=this.holes.length;l<_;l++){const y=this.holes[l];e.holes.push(y.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let l=0,_=e.holes.length;l<_;l++){const y=e.holes[l];this.holes.push(new Hi().fromJSON(y))}return this}}class bn extends we{constructor(e,l=1){super(),this.type="Light",this.color=new On(e),this.intensity=l}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const l=super.toJSON(e);return l.object.color=this.color.getHex(),l.object.intensity=this.intensity,this.groundColor!==void 0&&(l.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(l.object.distance=this.distance),this.angle!==void 0&&(l.object.angle=this.angle),this.decay!==void 0&&(l.object.decay=this.decay),this.penumbra!==void 0&&(l.object.penumbra=this.penumbra),this.shadow!==void 0&&(l.object.shadow=this.shadow.toJSON()),l}}bn.prototype.isLight=!0;class Un extends bn{constructor(e,l,_){super(e,_),this.type="HemisphereLight",this.position.copy(we.DefaultUp),this.updateMatrix(),this.groundColor=new On(l)}copy(e){return bn.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}Un.prototype.isHemisphereLight=!0;const fr=new tr,ur=new ht,lr=new ht;class wr{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new dn(512,512),this.map=null,this.mapPass=null,this.matrix=new tr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new yc,this._frameExtents=new dn(1,1),this._viewportCount=1,this._viewports=[new qr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const l=this.camera,_=this.matrix;ur.setFromMatrixPosition(e.matrixWorld),l.position.copy(ur),lr.setFromMatrixPosition(e.target.matrixWorld),l.lookAt(lr),l.updateMatrixWorld(),fr.multiplyMatrices(l.projectionMatrix,l.matrixWorldInverse),this._frustum.setFromProjectionMatrix(fr),_.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),_.multiply(l.projectionMatrix),_.multiply(l.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Tr extends wr{constructor(){super(new rr(50,1,.5,500)),this.focus=1}updateMatrices(e){const l=this.camera,_=2*cr*e.angle*this.focus,y=this.mapSize.width/this.mapSize.height,S=e.distance||l.far;_===l.fov&&y===l.aspect&&S===l.far||(l.fov=_,l.aspect=y,l.far=S,l.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}Tr.prototype.isSpotLightShadow=!0;class za extends bn{constructor(e,l,_=0,y=Math.PI/3,S=0,O=1){super(e,l),this.type="SpotLight",this.position.copy(we.DefaultUp),this.updateMatrix(),this.target=new we,this.distance=_,this.angle=y,this.penumbra=S,this.decay=O,this.shadow=new Tr}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}za.prototype.isSpotLight=!0;const Ss=new tr,qa=new ht,Pr=new ht;class ba extends wr{constructor(){super(new rr(90,1,.5,500)),this._frameExtents=new dn(4,2),this._viewportCount=6,this._viewports=[new qr(2,1,1,1),new qr(0,1,1,1),new qr(3,1,1,1),new qr(1,1,1,1),new qr(3,0,1,1),new qr(1,0,1,1)],this._cubeDirections=[new ht(1,0,0),new ht(-1,0,0),new ht(0,0,1),new ht(0,0,-1),new ht(0,1,0),new ht(0,-1,0)],this._cubeUps=[new ht(0,1,0),new ht(0,1,0),new ht(0,1,0),new ht(0,1,0),new ht(0,0,1),new ht(0,0,-1)]}updateMatrices(e,l=0){const _=this.camera,y=this.matrix,S=e.distance||_.far;S!==_.far&&(_.far=S,_.updateProjectionMatrix()),qa.setFromMatrixPosition(e.matrixWorld),_.position.copy(qa),Pr.copy(_.position),Pr.add(this._cubeDirections[l]),_.up.copy(this._cubeUps[l]),_.lookAt(Pr),_.updateMatrixWorld(),y.makeTranslation(-qa.x,-qa.y,-qa.z),Ss.multiplyMatrices(_.projectionMatrix,_.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Ss)}}ba.prototype.isPointLightShadow=!0;class In extends bn{constructor(e,l,_=0,y=1){super(e,l),this.type="PointLight",this.distance=_,this.decay=y,this.shadow=new ba}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}In.prototype.isPointLight=!0;class _r extends wr{constructor(){super(new vc(-5,5,5,-5,.5,500))}}_r.prototype.isDirectionalLightShadow=!0;class pr extends bn{constructor(e,l){super(e,l),this.type="DirectionalLight",this.position.copy(we.DefaultUp),this.updateMatrix(),this.target=new we,this.shadow=new _r}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}pr.prototype.isDirectionalLight=!0;class yr extends bn{constructor(e,l){super(e,l),this.type="AmbientLight"}}yr.prototype.isAmbientLight=!0;class Jr extends bn{constructor(e,l,_=10,y=10){super(e,l),this.type="RectAreaLight",this.width=_,this.height=y}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const l=super.toJSON(e);return l.object.width=this.width,l.object.height=this.height,l}}Jr.prototype.isRectAreaLight=!0;class is{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new ht)}set(e){for(let l=0;l<9;l++)this.coefficients[l].copy(e[l]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,l){const _=e.x,y=e.y,S=e.z,O=this.coefficients;return l.copy(O[0]).multiplyScalar(.282095),l.addScaledVector(O[1],.488603*y),l.addScaledVector(O[2],.488603*S),l.addScaledVector(O[3],.488603*_),l.addScaledVector(O[4],_*y*1.092548),l.addScaledVector(O[5],y*S*1.092548),l.addScaledVector(O[6],.315392*(3*S*S-1)),l.addScaledVector(O[7],_*S*1.092548),l.addScaledVector(O[8],.546274*(_*_-y*y)),l}getIrradianceAt(e,l){const _=e.x,y=e.y,S=e.z,O=this.coefficients;return l.copy(O[0]).multiplyScalar(.886227),l.addScaledVector(O[1],1.023328*y),l.addScaledVector(O[2],1.023328*S),l.addScaledVector(O[3],1.023328*_),l.addScaledVector(O[4],.858086*_*y),l.addScaledVector(O[5],.858086*y*S),l.addScaledVector(O[6],.743125*S*S-.247708),l.addScaledVector(O[7],.858086*_*S),l.addScaledVector(O[8],.429043*(_*_-y*y)),l}add(e){for(let l=0;l<9;l++)this.coefficients[l].add(e.coefficients[l]);return this}addScaledSH(e,l){for(let _=0;_<9;_++)this.coefficients[_].addScaledVector(e.coefficients[_],l);return this}scale(e){for(let l=0;l<9;l++)this.coefficients[l].multiplyScalar(e);return this}lerp(e,l){for(let _=0;_<9;_++)this.coefficients[_].lerp(e.coefficients[_],l);return this}equals(e){for(let l=0;l<9;l++)if(!this.coefficients[l].equals(e.coefficients[l]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,l=0){const _=this.coefficients;for(let y=0;y<9;y++)_[y].fromArray(e,l+3*y);return this}toArray(e=[],l=0){const _=this.coefficients;for(let y=0;y<9;y++)_[y].toArray(e,l+3*y);return e}static getBasisAt(e,l){const _=e.x,y=e.y,S=e.z;l[0]=.282095,l[1]=.488603*y,l[2]=.488603*S,l[3]=.488603*_,l[4]=1.092548*_*y,l[5]=1.092548*y*S,l[6]=.315392*(3*S*S-1),l[7]=1.092548*_*S,l[8]=.546274*(_*_-y*y)}}is.prototype.isSphericalHarmonics3=!0;class ns extends bn{constructor(e=new is,l=1){super(void 0,l),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const l=super.toJSON(e);return l.object.sh=this.sh.toArray(),l}}ns.prototype.isLightProbe=!0;class Es extends Kt{constructor(e){super(e),this.textures={}}load(e,l,_,y){const S=this,O=new Et(S.manager);O.setPath(S.path),O.setRequestHeader(S.requestHeader),O.setWithCredentials(S.withCredentials),O.load(e,function(k){try{l(S.parse(JSON.parse(k)))}catch(N){y?y(N):console.error(N),S.manager.itemError(e)}},_,y)}parse(e){const l=this.textures;function _(S){return l[S]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",S),l[S]}const y=new Q[e.type];if(e.uuid!==void 0&&(y.uuid=e.uuid),e.name!==void 0&&(y.name=e.name),e.color!==void 0&&y.color!==void 0&&y.color.setHex(e.color),e.roughness!==void 0&&(y.roughness=e.roughness),e.metalness!==void 0&&(y.metalness=e.metalness),e.sheenTint!==void 0&&(y.sheenTint=new On().setHex(e.sheenTint)),e.emissive!==void 0&&y.emissive!==void 0&&y.emissive.setHex(e.emissive),e.specular!==void 0&&y.specular!==void 0&&y.specular.setHex(e.specular),e.specularIntensity!==void 0&&(y.specularIntensity=e.specularIntensity),e.specularTint!==void 0&&y.specularTint!==void 0&&y.specularTint.setHex(e.specularTint),e.shininess!==void 0&&(y.shininess=e.shininess),e.clearcoat!==void 0&&(y.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(y.clearcoatRoughness=e.clearcoatRoughness),e.transmission!==void 0&&(y.transmission=e.transmission),e.thickness!==void 0&&(y.thickness=e.thickness),e.attenuationDistance!==void 0&&(y.attenuationDistance=e.attenuationDistance),e.attenuationTint!==void 0&&y.attenuationTint!==void 0&&y.attenuationTint.setHex(e.attenuationTint),e.fog!==void 0&&(y.fog=e.fog),e.flatShading!==void 0&&(y.flatShading=e.flatShading),e.blending!==void 0&&(y.blending=e.blending),e.combine!==void 0&&(y.combine=e.combine),e.side!==void 0&&(y.side=e.side),e.shadowSide!==void 0&&(y.shadowSide=e.shadowSide),e.opacity!==void 0&&(y.opacity=e.opacity),e.format!==void 0&&(y.format=e.format),e.transparent!==void 0&&(y.transparent=e.transparent),e.alphaTest!==void 0&&(y.alphaTest=e.alphaTest),e.depthTest!==void 0&&(y.depthTest=e.depthTest),e.depthWrite!==void 0&&(y.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(y.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(y.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(y.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(y.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(y.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(y.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(y.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(y.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(y.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(y.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(y.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(y.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(y.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(y.rotation=e.rotation),e.linewidth!==1&&(y.linewidth=e.linewidth),e.dashSize!==void 0&&(y.dashSize=e.dashSize),e.gapSize!==void 0&&(y.gapSize=e.gapSize),e.scale!==void 0&&(y.scale=e.scale),e.polygonOffset!==void 0&&(y.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(y.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(y.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(y.dithering=e.dithering),e.alphaToCoverage!==void 0&&(y.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(y.premultipliedAlpha=e.premultipliedAlpha),e.visible!==void 0&&(y.visible=e.visible),e.toneMapped!==void 0&&(y.toneMapped=e.toneMapped),e.userData!==void 0&&(y.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?y.vertexColors=e.vertexColors>0:y.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const S in e.uniforms){const O=e.uniforms[S];switch(y.uniforms[S]={},O.type){case"t":y.uniforms[S].value=_(O.value);break;case"c":y.uniforms[S].value=new On().setHex(O.value);break;case"v2":y.uniforms[S].value=new dn().fromArray(O.value);break;case"v3":y.uniforms[S].value=new ht().fromArray(O.value);break;case"v4":y.uniforms[S].value=new qr().fromArray(O.value);break;case"m3":y.uniforms[S].value=new Xn().fromArray(O.value);break;case"m4":y.uniforms[S].value=new tr().fromArray(O.value);break;default:y.uniforms[S].value=O.value}}if(e.defines!==void 0&&(y.defines=e.defines),e.vertexShader!==void 0&&(y.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(y.fragmentShader=e.fragmentShader),e.extensions!==void 0)for(const S in e.extensions)y.extensions[S]=e.extensions[S];if(e.shading!==void 0&&(y.flatShading=e.shading===1),e.size!==void 0&&(y.size=e.size),e.sizeAttenuation!==void 0&&(y.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(y.map=_(e.map)),e.matcap!==void 0&&(y.matcap=_(e.matcap)),e.alphaMap!==void 0&&(y.alphaMap=_(e.alphaMap)),e.bumpMap!==void 0&&(y.bumpMap=_(e.bumpMap)),e.bumpScale!==void 0&&(y.bumpScale=e.bumpScale),e.normalMap!==void 0&&(y.normalMap=_(e.normalMap)),e.normalMapType!==void 0&&(y.normalMapType=e.normalMapType),e.normalScale!==void 0){let S=e.normalScale;Array.isArray(S)===!1&&(S=[S,S]),y.normalScale=new dn().fromArray(S)}return e.displacementMap!==void 0&&(y.displacementMap=_(e.displacementMap)),e.displacementScale!==void 0&&(y.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(y.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(y.roughnessMap=_(e.roughnessMap)),e.metalnessMap!==void 0&&(y.metalnessMap=_(e.metalnessMap)),e.emissiveMap!==void 0&&(y.emissiveMap=_(e.emissiveMap)),e.emissiveIntensity!==void 0&&(y.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(y.specularMap=_(e.specularMap)),e.specularIntensityMap!==void 0&&(y.specularIntensityMap=_(e.specularIntensityMap)),e.specularTintMap!==void 0&&(y.specularTintMap=_(e.specularTintMap)),e.envMap!==void 0&&(y.envMap=_(e.envMap)),e.envMapIntensity!==void 0&&(y.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(y.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(y.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(y.lightMap=_(e.lightMap)),e.lightMapIntensity!==void 0&&(y.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(y.aoMap=_(e.aoMap)),e.aoMapIntensity!==void 0&&(y.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(y.gradientMap=_(e.gradientMap)),e.clearcoatMap!==void 0&&(y.clearcoatMap=_(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(y.clearcoatRoughnessMap=_(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(y.clearcoatNormalMap=_(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(y.clearcoatNormalScale=new dn().fromArray(e.clearcoatNormalScale)),e.transmissionMap!==void 0&&(y.transmissionMap=_(e.transmissionMap)),e.thicknessMap!==void 0&&(y.thicknessMap=_(e.thicknessMap)),y}setTextures(e){return this.textures=e,this}}class el{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let l="";for(let _=0,y=e.length;_<y;_++)l+=String.fromCharCode(e[_]);try{return decodeURIComponent(escape(l))}catch{return l}}static extractUrlBase(e){const l=e.lastIndexOf("/");return l===-1?"./":e.substr(0,l+1)}}class Ps extends oa{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}Ps.prototype.isInstancedBufferGeometry=!0;class da extends Kt{constructor(e){super(e)}load(e,l,_,y){const S=this,O=new Et(S.manager);O.setPath(S.path),O.setRequestHeader(S.requestHeader),O.setWithCredentials(S.withCredentials),O.load(e,function(k){try{l(S.parse(JSON.parse(k)))}catch(N){y?y(N):console.error(N),S.manager.itemError(e)}},_,y)}parse(e){const l={},_={};function y(K,ie){if(l[ie]!==void 0)return l[ie];const ne=K.interleavedBuffers[ie],ue=function(_e,$e){if(_[$e]!==void 0)return _[$e];const st=_e.arrayBuffers[$e],ot=new Uint32Array(st).buffer;return _[$e]=ot,ot}(K,ne.buffer),ye=fl(ne.type,ue),Se=new uu(ye,ne.stride);return Se.uuid=ne.uuid,l[ie]=Se,Se}const S=e.isInstancedBufferGeometry?new Ps:new oa,O=e.data.index;if(O!==void 0){const K=fl(O.type,O.array);S.setIndex(new aa(K,1))}const k=e.data.attributes;for(const K in k){const ie=k[K];let ne;if(ie.isInterleavedBufferAttribute){const ue=y(e.data,ie.data);ne=new hu(ue,ie.itemSize,ie.offset,ie.normalized)}else{const ue=fl(ie.type,ie.array);ne=new(ie.isInstancedBufferAttribute?Sc:aa)(ue,ie.itemSize,ie.normalized)}ie.name!==void 0&&(ne.name=ie.name),ie.usage!==void 0&&ne.setUsage(ie.usage),ie.updateRange!==void 0&&(ne.updateRange.offset=ie.updateRange.offset,ne.updateRange.count=ie.updateRange.count),S.setAttribute(K,ne)}const N=e.data.morphAttributes;if(N)for(const K in N){const ie=N[K],ne=[];for(let ue=0,ye=ie.length;ue<ye;ue++){const Se=ie[ue];let _e;if(Se.isInterleavedBufferAttribute){const $e=y(e.data,Se.data);_e=new hu($e,Se.itemSize,Se.offset,Se.normalized)}else{const $e=fl(Se.type,Se.array);_e=new aa($e,Se.itemSize,Se.normalized)}Se.name!==void 0&&(_e.name=Se.name),ne.push(_e)}S.morphAttributes[K]=ne}e.data.morphTargetsRelative&&(S.morphTargetsRelative=!0);const G=e.data.groups||e.data.drawcalls||e.data.offsets;if(G!==void 0)for(let K=0,ie=G.length;K!==ie;++K){const ne=G[K];S.addGroup(ne.start,ne.count,ne.materialIndex)}const $=e.data.boundingSphere;if($!==void 0){const K=new ht;$.center!==void 0&&K.fromArray($.center),S.boundingSphere=new zn(K,$.radius)}return e.name&&(S.name=e.name),e.userData&&(S.userData=e.userData),S}}const Pa={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Sa={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},ha={NearestFilter:1003,NearestMipmapNearestFilter:1004,NearestMipmapLinearFilter:1005,LinearFilter:1006,LinearMipmapNearestFilter:1007,LinearMipmapLinearFilter:1008};class Xa extends Kt{constructor(e){super(e),typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,l,_,y){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const S=this,O=fi.get(e);if(O!==void 0)return S.manager.itemStart(e),setTimeout(function(){l&&l(O),S.manager.itemEnd(e)},0),O;const k={};k.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",k.headers=this.requestHeader,fetch(e,k).then(function(N){return N.blob()}).then(function(N){return createImageBitmap(N,Object.assign(S.options,{colorSpaceConversion:"none"}))}).then(function(N){fi.add(e,N),l&&l(N),S.manager.itemEnd(e)}).catch(function(N){y&&y(N),S.manager.itemError(e),S.manager.itemEnd(e)}),S.manager.itemStart(e)}}Xa.prototype.isImageBitmapLoader=!0;class Os{constructor(){this.type="ShapePath",this.color=new On,this.subPaths=[],this.currentPath=null}moveTo(e,l){return this.currentPath=new Hi,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,l),this}lineTo(e,l){return this.currentPath.lineTo(e,l),this}quadraticCurveTo(e,l,_,y){return this.currentPath.quadraticCurveTo(e,l,_,y),this}bezierCurveTo(e,l,_,y,S,O){return this.currentPath.bezierCurveTo(e,l,_,y,S,O),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,l){function _($e){const st=[];for(let ot=0,Lt=$e.length;ot<Lt;ot++){const Bt=$e[ot],di=new en;di.curves=Bt.curves,st.push(di)}return st}function y($e,st){const ot=st.length;let Lt=!1;for(let Bt=ot-1,di=0;di<ot;Bt=di++){let Ti=st[Bt],Ki=st[di],Bi=Ki.x-Ti.x,Zi=Ki.y-Ti.y;if(Math.abs(Zi)>Number.EPSILON){if(Zi<0&&(Ti=st[di],Bi=-Bi,Ki=st[Bt],Zi=-Zi),$e.y<Ti.y||$e.y>Ki.y)continue;if($e.y===Ti.y){if($e.x===Ti.x)return!0}else{const hr=Zi*($e.x-Ti.x)-Bi*($e.y-Ti.y);if(hr===0)return!0;if(hr<0)continue;Lt=!Lt}}else{if($e.y!==Ti.y)continue;if(Ki.x<=$e.x&&$e.x<=Ti.x||Ti.x<=$e.x&&$e.x<=Ki.x)return!0}}return Lt}const S=So.isClockWise,O=this.subPaths;if(O.length===0)return[];if(l===!0)return _(O);let k,N,G;const $=[];if(O.length===1)return N=O[0],G=new en,G.curves=N.curves,$.push(G),$;let K=!S(O[0].getPoints());K=e?!K:K;const ie=[],ne=[];let ue,ye,Se=[],_e=0;ne[_e]=void 0,Se[_e]=[];for(let $e=0,st=O.length;$e<st;$e++)N=O[$e],ue=N.getPoints(),k=S(ue),k=e?!k:k,k?(!K&&ne[_e]&&_e++,ne[_e]={s:new en,p:ue},ne[_e].s.curves=N.curves,K&&_e++,Se[_e]=[]):Se[_e].push({h:N,p:ue[0]});if(!ne[0])return _(O);if(ne.length>1){let $e=!1;const st=[];for(let ot=0,Lt=ne.length;ot<Lt;ot++)ie[ot]=[];for(let ot=0,Lt=ne.length;ot<Lt;ot++){const Bt=Se[ot];for(let di=0;di<Bt.length;di++){const Ti=Bt[di];let Ki=!0;for(let Bi=0;Bi<ne.length;Bi++)y(Ti.p,ne[Bi].p)&&(ot!==Bi&&st.push({froms:ot,tos:Bi,hole:di}),Ki?(Ki=!1,ie[Bi].push(Ti)):$e=!0);Ki&&ie[ot].push(Ti)}}st.length>0&&($e||(Se=ie))}for(let $e=0,st=ne.length;$e<st;$e++){G=ne[$e].s,$.push(G),ye=Se[$e];for(let ot=0,Lt=ye.length;ot<Lt;ot++)G.holes.push(ye[ot].h)}return $}}class Oa{constructor(e){this.type="Font",this.data=e}generateShapes(e,l=100){const _=[],y=function(S,O,k){const N=Array.from(S),G=O/k.resolution,$=(k.boundingBox.yMax-k.boundingBox.yMin+k.underlineThickness)*G,K=[];let ie=0,ne=0;for(let ue=0;ue<N.length;ue++){const ye=N[ue];if(ye===`
`)ie=0,ne-=$;else{const Se=ks(ye,G,ie,ne,k);ie+=Se.offsetX,K.push(Se.path)}}return K}(e,l,this.data);for(let S=0,O=y.length;S<O;S++)Array.prototype.push.apply(_,y[S].toShapes());return _}}function ks(E,e,l,_,y){const S=y.glyphs[E]||y.glyphs["?"];if(!S)return void console.error('THREE.Font: character "'+E+'" does not exists in font family '+y.familyName+".");const O=new Os;let k,N,G,$,K,ie,ne,ue;if(S.o){const ye=S._cachedOutline||(S._cachedOutline=S.o.split(" "));for(let Se=0,_e=ye.length;Se<_e;)switch(ye[Se++]){case"m":k=ye[Se++]*e+l,N=ye[Se++]*e+_,O.moveTo(k,N);break;case"l":k=ye[Se++]*e+l,N=ye[Se++]*e+_,O.lineTo(k,N);break;case"q":G=ye[Se++]*e+l,$=ye[Se++]*e+_,K=ye[Se++]*e+l,ie=ye[Se++]*e+_,O.quadraticCurveTo(K,ie,G,$);break;case"b":G=ye[Se++]*e+l,$=ye[Se++]*e+_,K=ye[Se++]*e+l,ie=ye[Se++]*e+_,ne=ye[Se++]*e+l,ue=ye[Se++]*e+_,O.bezierCurveTo(K,ie,ne,ue,G,$)}}return{offsetX:S.ha*e,path:O}}Oa.prototype.isFont=!0;let ul;const tl={getContext:function(){return ul===void 0&&(ul=new(window.AudioContext||window.webkitAudioContext)),ul},setContext:function(E){ul=E}};class No extends Kt{constructor(e){super(e)}load(e,l,_,y){const S=this,O=new Et(this.manager);O.setResponseType("arraybuffer"),O.setPath(this.path),O.setRequestHeader(this.requestHeader),O.setWithCredentials(this.withCredentials),O.load(e,function(k){try{const N=k.slice(0);tl.getContext().decodeAudioData(N,function(G){l(G)})}catch(N){y?y(N):console.error(N),S.manager.itemError(e)}},_,y)}}class $l extends ns{constructor(e,l,_=1){super(void 0,_);const y=new On().set(e),S=new On().set(l),O=new ht(y.r,y.g,y.b),k=new ht(S.r,S.g,S.b),N=Math.sqrt(Math.PI),G=N*Math.sqrt(.75);this.sh.coefficients[0].copy(O).add(k).multiplyScalar(N),this.sh.coefficients[1].copy(O).sub(k).multiplyScalar(G)}}$l.prototype.isHemisphereLightProbe=!0;class Eo extends ns{constructor(e,l=1){super(void 0,l);const _=new On().set(e);this.sh.coefficients[0].set(_.r,_.g,_.b).multiplyScalar(2*Math.sqrt(Math.PI))}}Eo.prototype.isAmbientLightProbe=!0;const hl=new tr,Kl=new tr;class Bl{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Mu(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const l=Mu();e=(l-this.oldTime)/1e3,this.oldTime=l,this.elapsedTime+=e}return e}}function Mu(){return(typeof performance>"u"?Date:performance).now()}const Jl=new ht,Qu=new Ls,Lf=new ht,il=new ht;class Hp extends we{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const l=this.context.createBufferSource();return l.buffer=this.buffer,l.loop=this.loop,l.loopStart=this.loopStart,l.loopEnd=this.loopEnd,l.onended=this.onEnded.bind(this),l.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=l,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,l=this.filters.length;e<l;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,l=this.filters.length;e<l;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl!==!1)return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl!==!1)return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Uo=new ht,jp=new Ls,qp=new ht,vd=new ht;class am{constructor(e,l=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=l,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const l=this.getFrequencyData();for(let _=0;_<l.length;_++)e+=l[_];return e/l.length}}class eh{constructor(e,l,_){let y,S,O;switch(this.binding=e,this.valueSize=_,l){case"quaternion":y=this._slerp,S=this._slerpAdditive,O=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*_),this._workIndex=5;break;case"string":case"bool":y=this._select,S=this._select,O=this._setAdditiveIdentityOther,this.buffer=new Array(5*_);break;default:y=this._lerp,S=this._lerpAdditive,O=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*_)}this._mixBufferRegion=y,this._mixBufferRegionAdditive=S,this._setIdentity=O,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,l){const _=this.buffer,y=this.valueSize,S=e*y+y;let O=this.cumulativeWeight;if(O===0){for(let k=0;k!==y;++k)_[S+k]=_[k];O=l}else{O+=l;const k=l/O;this._mixBufferRegion(_,S,0,k,y)}this.cumulativeWeight=O}accumulateAdditive(e){const l=this.buffer,_=this.valueSize,y=_*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(l,y,0,e,_),this.cumulativeWeightAdditive+=e}apply(e){const l=this.valueSize,_=this.buffer,y=e*l+l,S=this.cumulativeWeight,O=this.cumulativeWeightAdditive,k=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,S<1){const N=l*this._origIndex;this._mixBufferRegion(_,y,N,1-S,l)}O>0&&this._mixBufferRegionAdditive(_,y,this._addIndex*l,1,l);for(let N=l,G=l+l;N!==G;++N)if(_[N]!==_[N+l]){k.setValue(_,y);break}}saveOriginalState(){const e=this.binding,l=this.buffer,_=this.valueSize,y=_*this._origIndex;e.getValue(l,y);for(let S=_,O=y;S!==O;++S)l[S]=l[y+S%_];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,l=e+this.valueSize;for(let _=e;_<l;_++)this.buffer[_]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,l=this._addIndex*this.valueSize;for(let _=0;_<this.valueSize;_++)this.buffer[l+_]=this.buffer[e+_]}_select(e,l,_,y,S){if(y>=.5)for(let O=0;O!==S;++O)e[l+O]=e[_+O]}_slerp(e,l,_,y){Ls.slerpFlat(e,l,e,l,e,_,y)}_slerpAdditive(e,l,_,y,S){const O=this._workIndex*S;Ls.multiplyQuaternionsFlat(e,O,e,l,e,_),Ls.slerpFlat(e,l,e,l,e,O,y)}_lerp(e,l,_,y,S){const O=1-y;for(let k=0;k!==S;++k){const N=l+k;e[N]=e[N]*O+e[_+k]*y}}_lerpAdditive(e,l,_,y,S){for(let O=0;O!==S;++O){const k=l+O;e[k]=e[k]+e[_+O]*y}}}const wp="\\[\\]\\.:\\/",Wp=new RegExp("[\\[\\]\\.:\\/]","g"),Fh="[^\\[\\]\\.:\\/]",xd="[^"+wp.replace("\\.","")+"]",Vo=/((?:WC+[\/:])*)/.source.replace("WC",Fh),sm=/(WCOD+)?/.source.replace("WCOD",xd),Rf=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Fh),om=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Fh),jm=new RegExp("^"+Vo+sm+Rf+om+"$"),Mp=["material","materials","bones"];class ms{constructor(e,l,_){this.path=l,this.parsedPath=_||ms.parseTrackName(l),this.node=ms.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,l,_){return e&&e.isAnimationObjectGroup?new ms.Composite(e,l,_):new ms(e,l,_)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Wp,"")}static parseTrackName(e){const l=jm.exec(e);if(!l)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const _={nodeName:l[2],objectName:l[3],objectIndex:l[4],propertyName:l[5],propertyIndex:l[6]},y=_.nodeName&&_.nodeName.lastIndexOf(".");if(y!==void 0&&y!==-1){const S=_.nodeName.substring(y+1);Mp.indexOf(S)!==-1&&(_.nodeName=_.nodeName.substring(0,y),_.objectName=S)}if(_.propertyName===null||_.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return _}static findNode(e,l){if(!l||l===""||l==="."||l===-1||l===e.name||l===e.uuid)return e;if(e.skeleton){const _=e.skeleton.getBoneByName(l);if(_!==void 0)return _}if(e.children){const _=function(S){for(let O=0;O<S.length;O++){const k=S[O];if(k.name===l||k.uuid===l)return k;const N=_(k.children);if(N)return N}return null},y=_(e.children);if(y)return y}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,l){e[l]=this.targetObject[this.propertyName]}_getValue_array(e,l){const _=this.resolvedProperty;for(let y=0,S=_.length;y!==S;++y)e[l++]=_[y]}_getValue_arrayElement(e,l){e[l]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,l){this.resolvedProperty.toArray(e,l)}_setValue_direct(e,l){this.targetObject[this.propertyName]=e[l]}_setValue_direct_setNeedsUpdate(e,l){this.targetObject[this.propertyName]=e[l],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,l){this.targetObject[this.propertyName]=e[l],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,l){const _=this.resolvedProperty;for(let y=0,S=_.length;y!==S;++y)_[y]=e[l++]}_setValue_array_setNeedsUpdate(e,l){const _=this.resolvedProperty;for(let y=0,S=_.length;y!==S;++y)_[y]=e[l++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,l){const _=this.resolvedProperty;for(let y=0,S=_.length;y!==S;++y)_[y]=e[l++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,l){this.resolvedProperty[this.propertyIndex]=e[l]}_setValue_arrayElement_setNeedsUpdate(e,l){this.resolvedProperty[this.propertyIndex]=e[l],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,l){this.resolvedProperty[this.propertyIndex]=e[l],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,l){this.resolvedProperty.fromArray(e,l)}_setValue_fromArray_setNeedsUpdate(e,l){this.resolvedProperty.fromArray(e,l),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,l){this.resolvedProperty.fromArray(e,l),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,l){this.bind(),this.getValue(e,l)}_setValue_unbound(e,l){this.bind(),this.setValue(e,l)}bind(){let e=this.node;const l=this.parsedPath,_=l.objectName,y=l.propertyName;let S=l.propertyIndex;if(e||(e=ms.findNode(this.rootNode,l.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(_){let G=l.objectIndex;switch(_){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let $=0;$<e.length;$++)if(e[$].name===G){G=$;break}break;default:if(e[_]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[_]}if(G!==void 0){if(e[G]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[G]}}const O=e[y];if(O===void 0){const G=l.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+G+"."+y+" but it wasn't found.",e)}let k=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?k=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(k=this.Versioning.MatrixWorldNeedsUpdate);let N=this.BindingType.Direct;if(S!==void 0){if(y==="morphTargetInfluences"){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);e.morphTargetDictionary[S]!==void 0&&(S=e.morphTargetDictionary[S])}N=this.BindingType.ArrayElement,this.resolvedProperty=O,this.propertyIndex=S}else O.fromArray!==void 0&&O.toArray!==void 0?(N=this.BindingType.HasFromToArray,this.resolvedProperty=O):Array.isArray(O)?(N=this.BindingType.EntireArray,this.resolvedProperty=O):this.propertyName=y;this.getValue=this.GetterByBindingType[N],this.setValue=this.SetterByBindingTypeAndVersioning[N][k]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ms.Composite=class{constructor(E,e,l){const _=l||ms.parseTrackName(e);this._targetGroup=E,this._bindings=E.subscribe_(e,_)}getValue(E,e){this.bind();const l=this._targetGroup.nCachedObjects_,_=this._bindings[l];_!==void 0&&_.getValue(E,e)}setValue(E,e){const l=this._bindings;for(let _=this._targetGroup.nCachedObjects_,y=l.length;_!==y;++_)l[_].setValue(E,e)}bind(){const E=this._bindings;for(let e=this._targetGroup.nCachedObjects_,l=E.length;e!==l;++e)E[e].bind()}unbind(){const E=this._bindings;for(let e=this._targetGroup.nCachedObjects_,l=E.length;e!==l;++e)E[e].unbind()}},ms.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},ms.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},ms.prototype.GetterByBindingType=[ms.prototype._getValue_direct,ms.prototype._getValue_array,ms.prototype._getValue_arrayElement,ms.prototype._getValue_toArray],ms.prototype.SetterByBindingTypeAndVersioning=[[ms.prototype._setValue_direct,ms.prototype._setValue_direct_setNeedsUpdate,ms.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ms.prototype._setValue_array,ms.prototype._setValue_array_setNeedsUpdate,ms.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ms.prototype._setValue_arrayElement,ms.prototype._setValue_arrayElement_setNeedsUpdate,ms.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ms.prototype._setValue_fromArray,ms.prototype._setValue_fromArray_setNeedsUpdate,ms.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class bd{constructor(){this.uuid=Sr(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let _=0,y=arguments.length;_!==y;++_)e[arguments[_].uuid]=_;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const l=this;this.stats={objects:{get total(){return l._objects.length},get inUse(){return this.total-l.nCachedObjects_}},get bindingsPerObject(){return l._bindings.length}}}add(){const e=this._objects,l=this._indicesByUUID,_=this._paths,y=this._parsedPaths,S=this._bindings,O=S.length;let k,N=e.length,G=this.nCachedObjects_;for(let $=0,K=arguments.length;$!==K;++$){const ie=arguments[$],ne=ie.uuid;let ue=l[ne];if(ue===void 0){ue=N++,l[ne]=ue,e.push(ie);for(let ye=0,Se=O;ye!==Se;++ye)S[ye].push(new ms(ie,_[ye],y[ye]))}else if(ue<G){k=e[ue];const ye=--G,Se=e[ye];l[Se.uuid]=ue,e[ue]=Se,l[ne]=ye,e[ye]=ie;for(let _e=0,$e=O;_e!==$e;++_e){const st=S[_e],ot=st[ye];let Lt=st[ue];st[ue]=ot,Lt===void 0&&(Lt=new ms(ie,_[_e],y[_e])),st[ye]=Lt}}else e[ue]!==k&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=G}remove(){const e=this._objects,l=this._indicesByUUID,_=this._bindings,y=_.length;let S=this.nCachedObjects_;for(let O=0,k=arguments.length;O!==k;++O){const N=arguments[O],G=N.uuid,$=l[G];if($!==void 0&&$>=S){const K=S++,ie=e[K];l[ie.uuid]=$,e[$]=ie,l[G]=K,e[K]=N;for(let ne=0,ue=y;ne!==ue;++ne){const ye=_[ne],Se=ye[K],_e=ye[$];ye[$]=Se,ye[K]=_e}}}this.nCachedObjects_=S}uncache(){const e=this._objects,l=this._indicesByUUID,_=this._bindings,y=_.length;let S=this.nCachedObjects_,O=e.length;for(let k=0,N=arguments.length;k!==N;++k){const G=arguments[k].uuid,$=l[G];if($!==void 0)if(delete l[G],$<S){const K=--S,ie=e[K],ne=--O,ue=e[ne];l[ie.uuid]=$,e[$]=ie,l[ue.uuid]=K,e[K]=ue,e.pop();for(let ye=0,Se=y;ye!==Se;++ye){const _e=_[ye],$e=_e[K],st=_e[ne];_e[$]=$e,_e[K]=st,_e.pop()}}else{const K=--O,ie=e[K];K>0&&(l[ie.uuid]=$),e[$]=ie,e.pop();for(let ne=0,ue=y;ne!==ue;++ne){const ye=_[ne];ye[$]=ye[K],ye.pop()}}}this.nCachedObjects_=S}subscribe_(e,l){const _=this._bindingsIndicesByPath;let y=_[e];const S=this._bindings;if(y!==void 0)return S[y];const O=this._paths,k=this._parsedPaths,N=this._objects,G=N.length,$=this.nCachedObjects_,K=new Array(G);y=S.length,_[e]=y,O.push(e),k.push(l),S.push(K);for(let ie=$,ne=N.length;ie!==ne;++ie){const ue=N[ie];K[ie]=new ms(ue,e,l)}return K}unsubscribe_(e){const l=this._bindingsIndicesByPath,_=l[e];if(_!==void 0){const y=this._paths,S=this._parsedPaths,O=this._bindings,k=O.length-1,N=O[k];l[e[k]]=_,O[_]=N,O.pop(),S[_]=S[k],S.pop(),y[_]=y[k],y.pop()}}}bd.prototype.isAnimationObjectGroup=!0;class np{constructor(e,l,_=null,y=l.blendMode){this._mixer=e,this._clip=l,this._localRoot=_,this.blendMode=y;const S=l.tracks,O=S.length,k=new Array(O),N={endingStart:2400,endingEnd:2400};for(let G=0;G!==O;++G){const $=S[G].createInterpolant(null);k[G]=$,$.settings=N}this._interpolantSettings=N,this._interpolants=k,this._propertyBindings=new Array(O),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,l){return this.loop=e,this.repetitions=l,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,l,_){if(e.fadeOut(l),this.fadeIn(l),_){const y=this._clip.duration,S=e._clip.duration,O=S/y,k=y/S;e.warp(1,O,l),this.warp(k,1,l)}return this}crossFadeTo(e,l,_){return e.crossFadeFrom(this,l,_)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,l,_){const y=this._mixer,S=y.time,O=this.timeScale;let k=this._timeScaleInterpolant;k===null&&(k=y._lendControlInterpolant(),this._timeScaleInterpolant=k);const N=k.parameterPositions,G=k.sampleValues;return N[0]=S,N[1]=S+_,G[0]=e/O,G[1]=l/O,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,l,_,y){if(!this.enabled)return void this._updateWeight(e);const S=this._startTime;if(S!==null){const N=(e-S)*_;if(N<0||_===0)return;this._startTime=null,l=_*N}l*=this._updateTimeScale(e);const O=this._updateTime(l),k=this._updateWeight(e);if(k>0){const N=this._interpolants,G=this._propertyBindings;switch(this.blendMode){case 2501:for(let $=0,K=N.length;$!==K;++$)N[$].evaluate(O),G[$].accumulateAdditive(k);break;case 2500:default:for(let $=0,K=N.length;$!==K;++$)N[$].evaluate(O),G[$].accumulate(y,k)}}}_updateWeight(e){let l=0;if(this.enabled){l=this.weight;const _=this._weightInterpolant;if(_!==null){const y=_.evaluate(e)[0];l*=y,e>_.parameterPositions[1]&&(this.stopFading(),y===0&&(this.enabled=!1))}}return this._effectiveWeight=l,l}_updateTimeScale(e){let l=0;if(!this.paused){l=this.timeScale;const _=this._timeScaleInterpolant;_!==null&&(l*=_.evaluate(e)[0],e>_.parameterPositions[1]&&(this.stopWarping(),l===0?this.paused=!0:this.timeScale=l))}return this._effectiveTimeScale=l,l}_updateTime(e){const l=this._clip.duration,_=this.loop;let y=this.time+e,S=this._loopCount;const O=_===2202;if(e===0)return S===-1?y:O&&(1&S)==1?l-y:y;if(_===2200){S===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(y>=l)y=l;else{if(!(y<0)){this.time=y;break e}y=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=y,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(S===-1&&(e>=0?(S=0,this._setEndings(!0,this.repetitions===0,O)):this._setEndings(this.repetitions===0,!0,O)),y>=l||y<0){const k=Math.floor(y/l);y-=l*k,S+=Math.abs(k);const N=this.repetitions-S;if(N<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,y=e>0?l:0,this.time=y,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(N===1){const G=e<0;this._setEndings(G,!G,O)}else this._setEndings(!1,!1,O);this._loopCount=S,this.time=y,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:k})}}else this.time=y;if(O&&(1&S)==1)return l-y}return y}_setEndings(e,l,_){const y=this._interpolantSettings;_?(y.endingStart=2401,y.endingEnd=2401):(y.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,y.endingEnd=l?this.zeroSlopeAtEnd?2401:2400:2402)}_scheduleFading(e,l,_){const y=this._mixer,S=y.time;let O=this._weightInterpolant;O===null&&(O=y._lendControlInterpolant(),this._weightInterpolant=O);const k=O.parameterPositions,N=O.sampleValues;return k[0]=S,N[0]=l,k[1]=S+e,N[1]=_,this}}class If extends ii{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,l){const _=e._localRoot||this._root,y=e._clip.tracks,S=y.length,O=e._propertyBindings,k=e._interpolants,N=_.uuid,G=this._bindingsByRootAndName;let $=G[N];$===void 0&&($={},G[N]=$);for(let K=0;K!==S;++K){const ie=y[K],ne=ie.name;let ue=$[ne];if(ue!==void 0)O[K]=ue;else{if(ue=O[K],ue!==void 0){ue._cacheIndex===null&&(++ue.referenceCount,this._addInactiveBinding(ue,N,ne));continue}const ye=l&&l._propertyBindings[K].binding.parsedPath;ue=new eh(ms.create(_,ne,ye),ie.ValueTypeName,ie.getValueSize()),++ue.referenceCount,this._addInactiveBinding(ue,N,ne),O[K]=ue}k[K].resultBuffer=ue.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const _=(e._localRoot||this._root).uuid,y=e._clip.uuid,S=this._actionsByClip[y];this._bindAction(e,S&&S.knownActions[0]),this._addInactiveAction(e,y,_)}const l=e._propertyBindings;for(let _=0,y=l.length;_!==y;++_){const S=l[_];S.useCount++==0&&(this._lendBinding(S),S.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const l=e._propertyBindings;for(let _=0,y=l.length;_!==y;++_){const S=l[_];--S.useCount==0&&(S.restoreOriginalState(),this._takeBackBinding(S))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const l=e._cacheIndex;return l!==null&&l<this._nActiveActions}_addInactiveAction(e,l,_){const y=this._actions,S=this._actionsByClip;let O=S[l];if(O===void 0)O={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,S[l]=O;else{const k=O.knownActions;e._byClipCacheIndex=k.length,k.push(e)}e._cacheIndex=y.length,y.push(e),O.actionByRoot[_]=e}_removeInactiveAction(e){const l=this._actions,_=l[l.length-1],y=e._cacheIndex;_._cacheIndex=y,l[y]=_,l.pop(),e._cacheIndex=null;const S=e._clip.uuid,O=this._actionsByClip,k=O[S],N=k.knownActions,G=N[N.length-1],$=e._byClipCacheIndex;G._byClipCacheIndex=$,N[$]=G,N.pop(),e._byClipCacheIndex=null,delete k.actionByRoot[(e._localRoot||this._root).uuid],N.length===0&&delete O[S],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const l=e._propertyBindings;for(let _=0,y=l.length;_!==y;++_){const S=l[_];--S.referenceCount==0&&this._removeInactiveBinding(S)}}_lendAction(e){const l=this._actions,_=e._cacheIndex,y=this._nActiveActions++,S=l[y];e._cacheIndex=y,l[y]=e,S._cacheIndex=_,l[_]=S}_takeBackAction(e){const l=this._actions,_=e._cacheIndex,y=--this._nActiveActions,S=l[y];e._cacheIndex=y,l[y]=e,S._cacheIndex=_,l[_]=S}_addInactiveBinding(e,l,_){const y=this._bindingsByRootAndName,S=this._bindings;let O=y[l];O===void 0&&(O={},y[l]=O),O[_]=e,e._cacheIndex=S.length,S.push(e)}_removeInactiveBinding(e){const l=this._bindings,_=e.binding,y=_.rootNode.uuid,S=_.path,O=this._bindingsByRootAndName,k=O[y],N=l[l.length-1],G=e._cacheIndex;N._cacheIndex=G,l[G]=N,l.pop(),delete k[S],Object.keys(k).length===0&&delete O[y]}_lendBinding(e){const l=this._bindings,_=e._cacheIndex,y=this._nActiveBindings++,S=l[y];e._cacheIndex=y,l[y]=e,S._cacheIndex=_,l[_]=S}_takeBackBinding(e){const l=this._bindings,_=e._cacheIndex,y=--this._nActiveBindings,S=l[y];e._cacheIndex=y,l[y]=e,S._cacheIndex=_,l[_]=S}_lendControlInterpolant(){const e=this._controlInterpolants,l=this._nActiveControlInterpolants++;let _=e[l];return _===void 0&&(_=new fe(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),_.__cacheIndex=l,e[l]=_),_}_takeBackControlInterpolant(e){const l=this._controlInterpolants,_=e.__cacheIndex,y=--this._nActiveControlInterpolants,S=l[y];e.__cacheIndex=y,l[y]=e,S.__cacheIndex=_,l[_]=S}clipAction(e,l,_){const y=l||this._root,S=y.uuid;let O=typeof e=="string"?Jt.findByName(y,e):e;const k=O!==null?O.uuid:e,N=this._actionsByClip[k];let G=null;if(_===void 0&&(_=O!==null?O.blendMode:2500),N!==void 0){const K=N.actionByRoot[S];if(K!==void 0&&K.blendMode===_)return K;G=N.knownActions[0],O===null&&(O=G._clip)}if(O===null)return null;const $=new np(this,O,l,_);return this._bindAction($,G),this._addInactiveAction($,k,S),$}existingAction(e,l){const _=l||this._root,y=_.uuid,S=typeof e=="string"?Jt.findByName(_,e):e,O=S?S.uuid:e,k=this._actionsByClip[O];return k!==void 0&&k.actionByRoot[y]||null}stopAllAction(){const e=this._actions;for(let l=this._nActiveActions-1;l>=0;--l)e[l].stop();return this}update(e){e*=this.timeScale;const l=this._actions,_=this._nActiveActions,y=this.time+=e,S=Math.sign(e),O=this._accuIndex^=1;for(let G=0;G!==_;++G)l[G]._update(y,e,S,O);const k=this._bindings,N=this._nActiveBindings;for(let G=0;G!==N;++G)k[G].apply(O);return this}setTime(e){this.time=0;for(let l=0;l<this._actions.length;l++)this._actions[l].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const l=this._actions,_=e.uuid,y=this._actionsByClip,S=y[_];if(S!==void 0){const O=S.knownActions;for(let k=0,N=O.length;k!==N;++k){const G=O[k];this._deactivateAction(G);const $=G._cacheIndex,K=l[l.length-1];G._cacheIndex=null,G._byClipCacheIndex=null,K._cacheIndex=$,l[$]=K,l.pop(),this._removeInactiveBindingsForAction(G)}delete y[_]}}uncacheRoot(e){const l=e.uuid,_=this._actionsByClip;for(const S in _){const O=_[S].actionByRoot[l];O!==void 0&&(this._deactivateAction(O),this._removeInactiveAction(O))}const y=this._bindingsByRootAndName[l];if(y!==void 0)for(const S in y){const O=y[S];O.restoreOriginalState(),this._removeInactiveBinding(O)}}uncacheAction(e,l){const _=this.existingAction(e,l);_!==null&&(this._deactivateAction(_),this._removeInactiveAction(_))}}If.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Df{constructor(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Df(this.value.clone===void 0?this.value:this.value.clone())}}class lm extends uu{constructor(e,l,_=1){super(e,l),this.meshPerAttribute=_}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const l=super.clone(e);return l.meshPerAttribute=this.meshPerAttribute,l}toJSON(e){const l=super.toJSON(e);return l.isInstancedInterleavedBuffer=!0,l.meshPerAttribute=this.meshPerAttribute,l}}lm.prototype.isInstancedInterleavedBuffer=!0;class cm{constructor(e,l,_,y,S){this.buffer=e,this.type=l,this.itemSize=_,this.elementSize=y,this.count=S,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,l){return this.type=e,this.elementSize=l,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}cm.prototype.isGLBufferAttribute=!0;function wm(E,e){return E.distance-e.distance}function Zp(E,e,l,_){if(E.layers.test(e.layers)&&E.raycast(e,l),_===!0){const y=E.children;for(let S=0,O=y.length;S<O;S++)Zp(y[S],e,l,!0)}}const zf=new dn;class wd{constructor(e=new dn(1/0,1/0),l=new dn(-1/0,-1/0)){this.min=e,this.max=l}set(e,l){return this.min.copy(e),this.max.copy(l),this}setFromPoints(e){this.makeEmpty();for(let l=0,_=e.length;l<_;l++)this.expandByPoint(e[l]);return this}setFromCenterAndSize(e,l){const _=zf.copy(l).multiplyScalar(.5);return this.min.copy(e).sub(_),this.max.copy(e).add(_),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,l){return l.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,l){return l.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return zf.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}wd.prototype.isBox2=!0;const Ns=new ht,th=new ht;class Mm{constructor(e=new ht,l=new ht){this.start=e,this.end=l}set(e,l){return this.start.copy(e),this.end.copy(l),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,l){return this.delta(l).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,l){Ns.subVectors(e,this.start),th.subVectors(this.end,this.start);const _=th.dot(th);let y=th.dot(Ns)/_;return l&&(y=Er(y,0,1)),y}closestPointToPoint(e,l,_){const y=this.closestPointToPointParameter(e,l);return this.delta(_).multiplyScalar(y).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}class no extends we{constructor(e){super(),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}}no.prototype.isImmediateRenderObject=!0;const Tp=new ht,Md=new ht,Pf=new tr,Td=new tr;class ih extends to{constructor(e){const l=Sp(e),_=new oa,y=[],S=[],O=new On(0,0,1),k=new On(0,1,0);for(let N=0;N<l.length;N++){const G=l[N];G.parent&&G.parent.isBone&&(y.push(0,0,0),y.push(0,0,0),S.push(O.r,O.g,O.b),S.push(k.r,k.g,k.b))}_.setAttribute("position",new or(y,3)),_.setAttribute("color",new or(S,3)),super(_,new go({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=l,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const l=this.bones,_=this.geometry,y=_.getAttribute("position");Td.copy(this.root.matrixWorld).invert();for(let S=0,O=0;S<l.length;S++){const k=l[S];k.parent&&k.parent.isBone&&(Pf.multiplyMatrices(Td,k.matrixWorld),Md.setFromMatrixPosition(Pf),y.setXYZ(O,Md.x,Md.y,Md.z),Pf.multiplyMatrices(Td,k.parent.matrixWorld),Md.setFromMatrixPosition(Pf),y.setXYZ(O+1,Md.x,Md.y,Md.z),O+=2)}_.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function Sp(E){const e=[];E&&E.isBone&&e.push(E);for(let l=0;l<E.children.length;l++)e.push.apply(e,Sp(E.children[l]));return e}const Ep=new ht,sf=new On,kh=new On;class zc extends to{constructor(e=10,l=10,_=4473924,y=8947848){_=new On(_),y=new On(y);const S=l/2,O=e/l,k=e/2,N=[],G=[];for(let K=0,ie=0,ne=-k;K<=l;K++,ne+=O){N.push(-k,0,ne,k,0,ne),N.push(ne,0,-k,ne,0,k);const ue=K===S?_:y;ue.toArray(G,ie),ie+=3,ue.toArray(G,ie),ie+=3,ue.toArray(G,ie),ie+=3,ue.toArray(G,ie),ie+=3}const $=new oa;$.setAttribute("position",new or(N,3)),$.setAttribute("color",new or(G,3)),super($,new go({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const rp=new ht,Ap=new ht,Cp=new ht,Of=new ht,ro=new _c;function Ao(E,e,l,_,y,S,O){Of.set(y,S,O).unproject(_);const k=e[E];if(k!==void 0){const N=l.getAttribute("position");for(let G=0,$=k.length;G<$;G++)N.setXYZ(k[G],Of.x,Of.y,Of.z)}}const Bf=new Js;class Xp extends to{constructor(e,l=16776960){const _=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),y=new Float32Array(24),S=new oa;S.setIndex(new aa(_,1)),S.setAttribute("position",new aa(y,3)),super(S,new go({color:l,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Bf.setFromObject(this.object),Bf.isEmpty())return;const l=Bf.min,_=Bf.max,y=this.geometry.attributes.position,S=y.array;S[0]=_.x,S[1]=_.y,S[2]=_.z,S[3]=l.x,S[4]=_.y,S[5]=_.z,S[6]=l.x,S[7]=l.y,S[8]=_.z,S[9]=_.x,S[10]=l.y,S[11]=_.z,S[12]=_.x,S[13]=_.y,S[14]=l.z,S[15]=l.x,S[16]=_.y,S[17]=l.z,S[18]=l.x,S[19]=l.y,S[20]=l.z,S[21]=_.x,S[22]=l.y,S[23]=l.z,y.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return to.prototype.copy.call(this,e),this.object=e.object,this}}const Yp=new ht;let ap,Pc;class Lp extends to{constructor(e=1){const l=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],_=new oa;_.setAttribute("position",new or(l,3)),_.setAttribute("color",new or([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(_,new go({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,l,_){const y=new On,S=this.geometry.attributes.color.array;return y.set(e),y.toArray(S,0),y.toArray(S,3),y.set(l),y.toArray(S,6),y.toArray(S,9),y.set(_),y.toArray(S,12),y.toArray(S,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const Tm=new Float32Array(1),qm=new Int32Array(Tm.buffer);Xl.create=function(E,e){return console.log("THREE.Curve.create() has been deprecated"),E.prototype=Object.create(Xl.prototype),E.prototype.constructor=E,E.prototype.getPoint=e,E},Hi.prototype.fromPoints=function(E){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(E)},zc.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},ih.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Kt.prototype.extractUrlBase=function(E){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),el.extractUrlBase(E)},Kt.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},wd.prototype.center=function(E){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(E)},wd.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},wd.prototype.isIntersectionBox=function(E){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(E)},wd.prototype.size=function(E){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(E)},Js.prototype.center=function(E){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(E)},Js.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Js.prototype.isIntersectionBox=function(E){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(E)},Js.prototype.isIntersectionSphere=function(E){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(E)},Js.prototype.size=function(E){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(E)},zn.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},yc.prototype.setFromMatrix=function(E){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(E)},Mm.prototype.center=function(E){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(E)},Xn.prototype.flattenToArrayOffset=function(E,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(E,e)},Xn.prototype.multiplyVector3=function(E){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),E.applyMatrix3(this)},Xn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Xn.prototype.applyToBufferAttribute=function(E){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),E.applyMatrix3(this)},Xn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Xn.prototype.getInverse=function(E){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(E).invert()},tr.prototype.extractPosition=function(E){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(E)},tr.prototype.flattenToArrayOffset=function(E,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(E,e)},tr.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new ht().setFromMatrixColumn(this,3)},tr.prototype.setRotationFromQuaternion=function(E){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(E)},tr.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},tr.prototype.multiplyVector3=function(E){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),E.applyMatrix4(this)},tr.prototype.multiplyVector4=function(E){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),E.applyMatrix4(this)},tr.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},tr.prototype.rotateAxis=function(E){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),E.transformDirection(this)},tr.prototype.crossVector=function(E){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),E.applyMatrix4(this)},tr.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},tr.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},tr.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},tr.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},tr.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},tr.prototype.applyToBufferAttribute=function(E){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),E.applyMatrix4(this)},tr.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},tr.prototype.makeFrustum=function(E,e,l,_,y,S){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(E,e,_,l,y,S)},tr.prototype.getInverse=function(E){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(E).invert()},tc.prototype.isIntersectionLine=function(E){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(E)},Ls.prototype.multiplyVector3=function(E){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),E.applyQuaternion(this)},Ls.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Wr.prototype.isIntersectionBox=function(E){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(E)},Wr.prototype.isIntersectionPlane=function(E){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(E)},Wr.prototype.isIntersectionSphere=function(E){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(E)},Si.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Si.prototype.barycoordFromPoint=function(E,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(E,e)},Si.prototype.midpoint=function(E){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(E)},Si.prototypenormal=function(E){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(E)},Si.prototype.plane=function(E){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(E)},Si.barycoordFromPoint=function(E,e,l,_,y){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Si.getBarycoord(E,e,l,_,y)},Si.normal=function(E,e,l,_){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Si.getNormal(E,e,l,_)},en.prototype.extractAllPoints=function(E){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(E)},en.prototype.extrude=function(E){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ko(this,E)},en.prototype.makeGeometry=function(E){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ho(this,E)},dn.prototype.fromAttribute=function(E,e,l){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(E,e,l)},dn.prototype.distanceToManhattan=function(E){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(E)},dn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},ht.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},ht.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},ht.prototype.getPositionFromMatrix=function(E){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(E)},ht.prototype.getScaleFromMatrix=function(E){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(E)},ht.prototype.getColumnFromMatrix=function(E,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,E)},ht.prototype.applyProjection=function(E){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(E)},ht.prototype.fromAttribute=function(E,e,l){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(E,e,l)},ht.prototype.distanceToManhattan=function(E){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(E)},ht.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},qr.prototype.fromAttribute=function(E,e,l){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(E,e,l)},qr.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},we.prototype.getChildByName=function(E){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(E)},we.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},we.prototype.translate=function(E,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,E)},we.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},we.prototype.applyMatrix=function(E){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(E)},Object.defineProperties(we.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(E){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=E}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),eo.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(eo.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Wl.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},rr.prototype.setLens=function(E,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(E)},Object.defineProperties(bn.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(E){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=E}},shadowCameraLeft:{set:function(E){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=E}},shadowCameraRight:{set:function(E){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=E}},shadowCameraTop:{set:function(E){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=E}},shadowCameraBottom:{set:function(E){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=E}},shadowCameraNear:{set:function(E){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=E}},shadowCameraFar:{set:function(E){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=E}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(E){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=E}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(E){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=E}},shadowMapHeight:{set:function(E){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=E}}}),Object.defineProperties(aa.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===35048},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),aa.prototype.setDynamic=function(E){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(E===!0?35048:35044),this},aa.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},aa.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},oa.prototype.addIndex=function(E){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(E)},oa.prototype.addAttribute=function(E,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?E==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(E,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(E,new aa(arguments[1],arguments[2])))},oa.prototype.addDrawCall=function(E,e,l){l!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(E,e)},oa.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},oa.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},oa.prototype.removeAttribute=function(E){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(E)},oa.prototype.applyMatrix=function(E){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(E)},Object.defineProperties(oa.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),uu.prototype.setDynamic=function(E){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(E===!0?35048:35044),this},uu.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ko.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},ko.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},ko.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Ht.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Df.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(rn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new On}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(E){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=E===1}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(E){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=E}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(El.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(E){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=E}}}),Ri.prototype.clearTarget=function(E,e,l,_){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(E),this.clear(e,l,_)},Ri.prototype.animate=function(E){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(E)},Ri.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Ri.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Ri.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Ri.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Ri.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Ri.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Ri.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Ri.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Ri.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Ri.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Ri.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Ri.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Ri.prototype.enableScissorTest=function(E){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(E)},Ri.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Ri.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Ri.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Ri.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Ri.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Ri.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Ri.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Ri.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Ri.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Ri.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Ri.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(E){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=E}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(E){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=E}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(E){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=E===!0?3001:3e3}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(us.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(gs.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(E){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=E}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(E){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=E}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(E){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=E}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(E){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=E}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(E){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=E}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(E){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=E}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(E){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=E}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(E){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=E}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(E){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=E}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(E){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=E}}}),Hp.prototype.load=function(E){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return new No().load(E,function(l){e.setBuffer(l)}),this},am.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},ec.prototype.updateCubeMap=function(E,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(E,e)},ec.prototype.clear=function(E,e,l,_){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(E,e,l,_)},lo.crossOrigin=void 0,lo.loadTexture=function(E,e,l,_){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const y=new zi;y.setCrossOrigin(this.crossOrigin);const S=y.load(E,l,void 0,_);return e&&(S.mapping=e),S},lo.loadTextureCube=function(E,e,l,_){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const y=new si;y.setCrossOrigin(this.crossOrigin);const S=y.load(E,l,void 0,_);return e&&(S.mapping=e),S},lo.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},lo.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Rp={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Ze}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Ze),U.ACESFilmicToneMapping=4,U.AddEquation=100,U.AddOperation=2,U.AdditiveAnimationBlendMode=2501,U.AdditiveBlending=2,U.AlphaFormat=1021,U.AlwaysDepth=1,U.AlwaysStencilFunc=519,U.AmbientLight=yr,U.AmbientLightProbe=Eo,U.AnimationClip=Jt,U.AnimationLoader=class extends Kt{constructor(E){super(E)}load(E,e,l,_){const y=this,S=new Et(this.manager);S.setPath(this.path),S.setRequestHeader(this.requestHeader),S.setWithCredentials(this.withCredentials),S.load(E,function(O){try{e(y.parse(JSON.parse(O)))}catch(k){_?_(k):console.error(k),y.manager.itemError(E)}},l,_)}parse(E){const e=[];for(let l=0;l<E.length;l++){const _=Jt.parse(E[l]);e.push(_)}return e}},U.AnimationMixer=If,U.AnimationObjectGroup=bd,U.AnimationUtils=le,U.ArcCurve=bs,U.ArrayCamera=Eh,U.ArrowHelper=class extends we{constructor(E=new ht(0,0,1),e=new ht(0,0,0),l=1,_=16776960,y=.2*l,S=.2*y){super(),this.type="ArrowHelper",ap===void 0&&(ap=new oa,ap.setAttribute("position",new or([0,0,0,0,1,0],3)),Pc=new mu(0,.5,1,5,1),Pc.translate(0,-.5,0)),this.position.copy(e),this.line=new To(ap,new go({color:_,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new eo(Pc,new fa({color:_,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(E),this.setLength(l,y,S)}setDirection(E){if(E.y>.99999)this.quaternion.set(0,0,0,1);else if(E.y<-.99999)this.quaternion.set(1,0,0,0);else{Yp.set(E.z,0,-E.x).normalize();const e=Math.acos(E.y);this.quaternion.setFromAxisAngle(Yp,e)}}setLength(E,e=.2*E,l=.2*e){this.line.scale.set(1,Math.max(1e-4,E-e),1),this.line.updateMatrix(),this.cone.scale.set(l,e,l),this.cone.position.y=E,this.cone.updateMatrix()}setColor(E){this.line.material.color.set(E),this.cone.material.color.set(E)}copy(E){return super.copy(E,!1),this.line.copy(E.line),this.cone.copy(E.cone),this}},U.Audio=Hp,U.AudioAnalyser=am,U.AudioContext=tl,U.AudioListener=class extends we{constructor(){super(),this.type="AudioListener",this.context=tl.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Bl}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(E){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=E,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(E){return this.gain.gain.setTargetAtTime(E,this.context.currentTime,.01),this}updateMatrixWorld(E){super.updateMatrixWorld(E);const e=this.context.listener,l=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Jl,Qu,Lf),il.set(0,0,-1).applyQuaternion(Qu),e.positionX){const _=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(Jl.x,_),e.positionY.linearRampToValueAtTime(Jl.y,_),e.positionZ.linearRampToValueAtTime(Jl.z,_),e.forwardX.linearRampToValueAtTime(il.x,_),e.forwardY.linearRampToValueAtTime(il.y,_),e.forwardZ.linearRampToValueAtTime(il.z,_),e.upX.linearRampToValueAtTime(l.x,_),e.upY.linearRampToValueAtTime(l.y,_),e.upZ.linearRampToValueAtTime(l.z,_)}else e.setPosition(Jl.x,Jl.y,Jl.z),e.setOrientation(il.x,il.y,il.z,l.x,l.y,l.z)}},U.AudioLoader=No,U.AxesHelper=Lp,U.AxisHelper=function(E){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Lp(E)},U.BackSide=1,U.BasicDepthPacking=3200,U.BasicShadowMap=0,U.BinaryTextureLoader=function(E){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new an(E)},U.Bone=Ih,U.BooleanKeyframeTrack=Ne,U.BoundingBoxHelper=function(E,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Xp(E,e)},U.Box2=wd,U.Box3=Js,U.Box3Helper=class extends to{constructor(E,e=16776960){const l=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),_=new oa;_.setIndex(new aa(l,1)),_.setAttribute("position",new or([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(_,new go({color:e,toneMapped:!1})),this.box=E,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(E){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(E))}},U.BoxBufferGeometry=Fr,U.BoxGeometry=Fr,U.BoxHelper=Xp,U.BufferAttribute=aa,U.BufferGeometry=oa,U.BufferGeometryLoader=da,U.ByteType=1010,U.Cache=fi,U.Camera=_c,U.CameraHelper=class extends to{constructor(E){const e=new oa,l=new go({color:16777215,vertexColors:!0,toneMapped:!1}),_=[],y=[],S={},O=new On(16755200),k=new On(16711680),N=new On(43775),G=new On(16777215),$=new On(3355443);function K(ne,ue,ye){ie(ne,ye),ie(ue,ye)}function ie(ne,ue){_.push(0,0,0),y.push(ue.r,ue.g,ue.b),S[ne]===void 0&&(S[ne]=[]),S[ne].push(_.length/3-1)}K("n1","n2",O),K("n2","n4",O),K("n4","n3",O),K("n3","n1",O),K("f1","f2",O),K("f2","f4",O),K("f4","f3",O),K("f3","f1",O),K("n1","f1",O),K("n2","f2",O),K("n3","f3",O),K("n4","f4",O),K("p","n1",k),K("p","n2",k),K("p","n3",k),K("p","n4",k),K("u1","u2",N),K("u2","u3",N),K("u3","u1",N),K("c","t",G),K("p","c",$),K("cn1","cn2",$),K("cn3","cn4",$),K("cf1","cf2",$),K("cf3","cf4",$),e.setAttribute("position",new or(_,3)),e.setAttribute("color",new or(y,3)),super(e,l),this.type="CameraHelper",this.camera=E,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=E.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=S,this.update()}update(){const E=this.geometry,e=this.pointMap;ro.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ao("c",e,E,ro,0,0,-1),Ao("t",e,E,ro,0,0,1),Ao("n1",e,E,ro,-1,-1,-1),Ao("n2",e,E,ro,1,-1,-1),Ao("n3",e,E,ro,-1,1,-1),Ao("n4",e,E,ro,1,1,-1),Ao("f1",e,E,ro,-1,-1,1),Ao("f2",e,E,ro,1,-1,1),Ao("f3",e,E,ro,-1,1,1),Ao("f4",e,E,ro,1,1,1),Ao("u1",e,E,ro,.7,1.1,-1),Ao("u2",e,E,ro,-.7,1.1,-1),Ao("u3",e,E,ro,0,2,-1),Ao("cf1",e,E,ro,-1,0,1),Ao("cf2",e,E,ro,1,0,1),Ao("cf3",e,E,ro,0,-1,1),Ao("cf4",e,E,ro,0,1,1),Ao("cn1",e,E,ro,-1,0,-1),Ao("cn2",e,E,ro,1,0,-1),Ao("cn3",e,E,ro,0,-1,-1),Ao("cn4",e,E,ro,0,1,-1),E.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},U.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},U.CanvasTexture=Ef,U.CatmullRomCurve3=Ku,U.CineonToneMapping=3,U.CircleBufferGeometry=Oh,U.CircleGeometry=Oh,U.ClampToEdgeWrapping=1001,U.Clock=Bl,U.Color=On,U.ColorKeyframeTrack=tt,U.CompressedTexture=pd,U.CompressedTextureLoader=class extends Kt{constructor(E){super(E)}load(E,e,l,_){const y=this,S=[],O=new pd,k=new Et(this.manager);k.setPath(this.path),k.setResponseType("arraybuffer"),k.setRequestHeader(this.requestHeader),k.setWithCredentials(y.withCredentials);let N=0;function G($){k.load(E[$],function(K){const ie=y.parse(K,!0);S[$]={width:ie.width,height:ie.height,format:ie.format,mipmaps:ie.mipmaps},N+=1,N===6&&(ie.mipmapCount===1&&(O.minFilter=1006),O.image=S,O.format=ie.format,O.needsUpdate=!0,e&&e(O))},l,_)}if(Array.isArray(E))for(let $=0,K=E.length;$<K;++$)G($);else k.load(E,function($){const K=y.parse($,!0);if(K.isCubemap){const ie=K.mipmaps.length/K.mipmapCount;for(let ne=0;ne<ie;ne++){S[ne]={mipmaps:[]};for(let ue=0;ue<K.mipmapCount;ue++)S[ne].mipmaps.push(K.mipmaps[ne*K.mipmapCount+ue]),S[ne].format=K.format,S[ne].width=K.width,S[ne].height=K.height}O.image=S}else O.image.width=K.width,O.image.height=K.height,O.mipmaps=K.mipmaps;K.mipmapCount===1&&(O.minFilter=1006),O.format=K.format,O.needsUpdate=!0,e&&e(O)},l,_);return O}},U.ConeBufferGeometry=md,U.ConeGeometry=md,U.CubeCamera=ec,U.CubeReflectionMapping=301,U.CubeRefractionMapping=302,U.CubeTexture=Ru,U.CubeTextureLoader=si,U.CubeUVReflectionMapping=306,U.CubeUVRefractionMapping=307,U.CubicBezierCurve=ws,U.CubicBezierCurve3=Dl,U.CubicInterpolant=me,U.CullFaceBack=1,U.CullFaceFront=2,U.CullFaceFrontBack=3,U.CullFaceNone=0,U.Curve=Xl,U.CurvePath=yi,U.CustomBlending=5,U.CustomToneMapping=5,U.CylinderBufferGeometry=mu,U.CylinderGeometry=mu,U.Cylindrical=class{constructor(E=1,e=0,l=0){return this.radius=E,this.theta=e,this.y=l,this}set(E,e,l){return this.radius=E,this.theta=e,this.y=l,this}copy(E){return this.radius=E.radius,this.theta=E.theta,this.y=E.y,this}setFromVector3(E){return this.setFromCartesianCoords(E.x,E.y,E.z)}setFromCartesianCoords(E,e,l){return this.radius=Math.sqrt(E*E+l*l),this.theta=Math.atan2(E,l),this.y=e,this}clone(){return new this.constructor().copy(this)}},U.DataTexture=Tc,U.DataTexture2DArray=Za,U.DataTexture3D=ph,U.DataTextureLoader=an,U.DataUtils=class{static toHalfFloat(E){Tm[0]=E;const e=qm[0];let l=e>>16&32768,_=e>>12&2047;const y=e>>23&255;return y<103?l:y>142?(l|=31744,l|=(y==255?0:1)&&8388607&e,l):y<113?(_|=2048,l|=(_>>114-y)+(_>>113-y&1),l):(l|=y-112<<10|_>>1,l+=1&_,l)}},U.DecrementStencilOp=7683,U.DecrementWrapStencilOp=34056,U.DefaultLoadingManager=Pt,U.DepthFormat=1026,U.DepthStencilFormat=1027,U.DepthTexture=Ph,U.DirectionalLight=pr,U.DirectionalLightHelper=class extends we{constructor(E,e,l){super(),this.light=E,this.light.updateMatrixWorld(),this.matrix=E.matrixWorld,this.matrixAutoUpdate=!1,this.color=l,e===void 0&&(e=1);let _=new oa;_.setAttribute("position",new or([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const y=new go({fog:!1,toneMapped:!1});this.lightPlane=new To(_,y),this.add(this.lightPlane),_=new oa,_.setAttribute("position",new or([0,0,0,0,0,1],3)),this.targetLine=new To(_,y),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){rp.setFromMatrixPosition(this.light.matrixWorld),Ap.setFromMatrixPosition(this.light.target.matrixWorld),Cp.subVectors(Ap,rp),this.lightPlane.lookAt(Ap),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Ap),this.targetLine.scale.z=Cp.length()}},U.DiscreteInterpolant=De,U.DodecahedronBufferGeometry=Zs,U.DodecahedronGeometry=Zs,U.DoubleSide=2,U.DstAlphaFactor=206,U.DstColorFactor=208,U.DynamicBufferAttribute=function(E,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new aa(E,e).setUsage(35048)},U.DynamicCopyUsage=35050,U.DynamicDrawUsage=35048,U.DynamicReadUsage=35049,U.EdgesGeometry=Af,U.EdgesHelper=function(E,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new to(new Af(E.geometry),new go({color:e!==void 0?e:16777215}))},U.EllipseCurve=Yu,U.EqualDepth=4,U.EqualStencilFunc=514,U.EquirectangularReflectionMapping=303,U.EquirectangularRefractionMapping=304,U.Euler=Ql,U.EventDispatcher=ii,U.ExtrudeBufferGeometry=ko,U.ExtrudeGeometry=ko,U.FaceColors=1,U.FileLoader=Et,U.FlatShading=1,U.Float16BufferAttribute=Wo,U.Float32Attribute=function(E,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new or(E,e)},U.Float32BufferAttribute=or,U.Float64Attribute=function(E,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new fs(E,e)},U.Float64BufferAttribute=fs,U.FloatType=1015,U.Fog=ss,U.FogExp2=Hc,U.Font=Oa,U.FontLoader=class extends Kt{constructor(E){super(E)}load(E,e,l,_){const y=this,S=new Et(this.manager);S.setPath(this.path),S.setRequestHeader(this.requestHeader),S.setWithCredentials(y.withCredentials),S.load(E,function(O){let k;try{k=JSON.parse(O)}catch{console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),k=JSON.parse(O.substring(65,O.length-2))}const N=y.parse(k);e&&e(N)},l,_)}parse(E){return new Oa(E)}},U.FrontSide=0,U.Frustum=yc,U.GLBufferAttribute=cm,U.GLSL1="100",U.GLSL3=$t,U.GammaEncoding=3007,U.GreaterDepth=6,U.GreaterEqualDepth=5,U.GreaterEqualStencilFunc=518,U.GreaterStencilFunc=516,U.GridHelper=zc,U.Group=ol,U.HalfFloatType=1016,U.HemisphereLight=Un,U.HemisphereLightHelper=class extends we{constructor(E,e,l){super(),this.light=E,this.light.updateMatrixWorld(),this.matrix=E.matrixWorld,this.matrixAutoUpdate=!1,this.color=l;const _=new cl(e);_.rotateY(.5*Math.PI),this.material=new fa({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const y=_.getAttribute("position"),S=new Float32Array(3*y.count);_.setAttribute("color",new aa(S,3)),this.add(new eo(_,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const E=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const e=E.geometry.getAttribute("color");sf.copy(this.light.color),kh.copy(this.light.groundColor);for(let l=0,_=e.count;l<_;l++){const y=l<_/2?sf:kh;e.setXYZ(l,y.r,y.g,y.b)}e.needsUpdate=!0}E.lookAt(Ep.setFromMatrixPosition(this.light.matrixWorld).negate())}},U.HemisphereLightProbe=$l,U.IcosahedronBufferGeometry=Qo,U.IcosahedronGeometry=Qo,U.ImageBitmapLoader=Xa,U.ImageLoader=hi,U.ImageUtils=lo,U.ImmediateRenderObject=no,U.IncrementStencilOp=7682,U.IncrementWrapStencilOp=34055,U.InstancedBufferAttribute=Sc,U.InstancedBufferGeometry=Ps,U.InstancedInterleavedBuffer=lm,U.InstancedMesh=fu,U.Int16Attribute=function(E,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Ts(E,e)},U.Int16BufferAttribute=Ts,U.Int32Attribute=function(E,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Gs(E,e)},U.Int32BufferAttribute=Gs,U.Int8Attribute=function(E,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Qs(E,e)},U.Int8BufferAttribute=Qs,U.IntType=1013,U.InterleavedBuffer=uu,U.InterleavedBufferAttribute=hu,U.Interpolant=se,U.InterpolateDiscrete=2300,U.InterpolateLinear=2301,U.InterpolateSmooth=2302,U.InvertStencilOp=5386,U.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},U.KeepStencilOp=7680,U.KeyframeTrack=ke,U.LOD=ud,U.LatheBufferGeometry=bu,U.LatheGeometry=bu,U.Layers=fo,U.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},U.LessDepth=2,U.LessEqualDepth=3,U.LessEqualStencilFunc=515,U.LessStencilFunc=513,U.Light=bn,U.LightProbe=ns,U.Line=To,U.Line3=Mm,U.LineBasicMaterial=go,U.LineCurve=Rc,U.LineCurve3=_d,U.LineDashedMaterial=X,U.LineLoop=Zl,U.LinePieces=1,U.LineSegments=to,U.LineStrip=0,U.LinearEncoding=3e3,U.LinearFilter=1006,U.LinearInterpolant=fe,U.LinearMipMapLinearFilter=1008,U.LinearMipMapNearestFilter=1007,U.LinearMipmapLinearFilter=1008,U.LinearMipmapNearestFilter=1007,U.LinearToneMapping=1,U.Loader=Kt,U.LoaderUtils=el,U.LoadingManager=ui,U.LogLuvEncoding=3003,U.LoopOnce=2200,U.LoopPingPong=2202,U.LoopRepeat=2201,U.LuminanceAlphaFormat=1025,U.LuminanceFormat=1024,U.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},U.Material=rn,U.MaterialLoader=Es,U.Math=$a,U.MathUtils=$a,U.Matrix3=Xn,U.Matrix4=tr,U.MaxEquation=104,U.Mesh=eo,U.MeshBasicMaterial=fa,U.MeshDepthMaterial=ju,U.MeshDistanceMaterial=mo,U.MeshFaceMaterial=function(E){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),E},U.MeshLambertMaterial=j,U.MeshMatcapMaterial=Z,U.MeshNormalMaterial=V,U.MeshPhongMaterial=I,U.MeshPhysicalMaterial=T,U.MeshStandardMaterial=x,U.MeshToonMaterial=F,U.MinEquation=103,U.MirroredRepeatWrapping=1002,U.MixOperation=1,U.MultiMaterial=function(E=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),E.isMultiMaterial=!0,E.materials=E,E.clone=function(){return E.slice()},E},U.MultiplyBlending=4,U.MultiplyOperation=0,U.NearestFilter=1003,U.NearestMipMapLinearFilter=1005,U.NearestMipMapNearestFilter=1004,U.NearestMipmapLinearFilter=1005,U.NearestMipmapNearestFilter=1004,U.NeverDepth=0,U.NeverStencilFunc=512,U.NoBlending=0,U.NoColors=0,U.NoToneMapping=0,U.NormalAnimationBlendMode=2500,U.NormalBlending=1,U.NotEqualDepth=7,U.NotEqualStencilFunc=517,U.NumberKeyframeTrack=He,U.Object3D=we,U.ObjectLoader=class extends Kt{constructor(E){super(E)}load(E,e,l,_){const y=this,S=this.path===""?el.extractUrlBase(E):this.path;this.resourcePath=this.resourcePath||S;const O=new Et(this.manager);O.setPath(this.path),O.setRequestHeader(this.requestHeader),O.setWithCredentials(this.withCredentials),O.load(E,function(k){let N=null;try{N=JSON.parse(k)}catch($){return _!==void 0&&_($),void console.error("THREE:ObjectLoader: Can't parse "+E+".",$.message)}const G=N.metadata;G!==void 0&&G.type!==void 0&&G.type.toLowerCase()!=="geometry"?y.parse(N,e):console.error("THREE.ObjectLoader: Can't load "+E)},l,_)}async loadAsync(E,e){const l=this.path===""?el.extractUrlBase(E):this.path;this.resourcePath=this.resourcePath||l;const _=new Et(this.manager);_.setPath(this.path),_.setRequestHeader(this.requestHeader),_.setWithCredentials(this.withCredentials);const y=await _.loadAsync(E,e),S=JSON.parse(y),O=S.metadata;if(O===void 0||O.type===void 0||O.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+E);return await this.parseAsync(S)}parse(E,e){const l=this.parseAnimations(E.animations),_=this.parseShapes(E.shapes),y=this.parseGeometries(E.geometries,_),S=this.parseImages(E.images,function(){e!==void 0&&e(N)}),O=this.parseTextures(E.textures,S),k=this.parseMaterials(E.materials,O),N=this.parseObject(E.object,y,k,O,l),G=this.parseSkeletons(E.skeletons,N);if(this.bindSkeletons(N,G),e!==void 0){let $=!1;for(const K in S)if(S[K]instanceof HTMLImageElement){$=!0;break}$===!1&&e(N)}return N}async parseAsync(E){const e=this.parseAnimations(E.animations),l=this.parseShapes(E.shapes),_=this.parseGeometries(E.geometries,l),y=await this.parseImagesAsync(E.images),S=this.parseTextures(E.textures,y),O=this.parseMaterials(E.materials,S),k=this.parseObject(E.object,_,O,S,e),N=this.parseSkeletons(E.skeletons,k);return this.bindSkeletons(k,N),k}parseShapes(E){const e={};if(E!==void 0)for(let l=0,_=E.length;l<_;l++){const y=new en().fromJSON(E[l]);e[y.uuid]=y}return e}parseSkeletons(E,e){const l={},_={};if(e.traverse(function(y){y.isBone&&(_[y.uuid]=y)}),E!==void 0)for(let y=0,S=E.length;y<S;y++){const O=new Dh().fromJSON(E[y],_);l[O.uuid]=O}return l}parseGeometries(E,e){const l={};if(E!==void 0){const _=new da;for(let y=0,S=E.length;y<S;y++){let O;const k=E[y];switch(k.type){case"BufferGeometry":case"InstancedBufferGeometry":O=_.parse(k);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:k.type in f?O=f[k.type].fromJSON(k,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${k.type}"`)}O.uuid=k.uuid,k.name!==void 0&&(O.name=k.name),O.isBufferGeometry===!0&&k.userData!==void 0&&(O.userData=k.userData),l[k.uuid]=O}}return l}parseMaterials(E,e){const l={},_={};if(E!==void 0){const y=new Es;y.setTextures(e);for(let S=0,O=E.length;S<O;S++){const k=E[S];if(k.type==="MultiMaterial"){const N=[];for(let G=0;G<k.materials.length;G++){const $=k.materials[G];l[$.uuid]===void 0&&(l[$.uuid]=y.parse($)),N.push(l[$.uuid])}_[k.uuid]=N}else l[k.uuid]===void 0&&(l[k.uuid]=y.parse(k)),_[k.uuid]=l[k.uuid]}}return _}parseAnimations(E){const e={};if(E!==void 0)for(let l=0;l<E.length;l++){const _=E[l],y=Jt.parse(_);e[y.uuid]=y}return e}parseImages(E,e){const l=this,_={};let y;function S(O){if(typeof O=="string"){const k=O;return function(N){return l.manager.itemStart(N),y.load(N,function(){l.manager.itemEnd(N)},void 0,function(){l.manager.itemError(N),l.manager.itemEnd(N)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(k)?k:l.resourcePath+k)}return O.data?{data:fl(O.type,O.data),width:O.width,height:O.height}:null}if(E!==void 0&&E.length>0){const O=new ui(e);y=new hi(O),y.setCrossOrigin(this.crossOrigin);for(let k=0,N=E.length;k<N;k++){const G=E[k],$=G.url;if(Array.isArray($)){_[G.uuid]=[];for(let K=0,ie=$.length;K<ie;K++){const ne=S($[K]);ne!==null&&(ne instanceof HTMLImageElement?_[G.uuid].push(ne):_[G.uuid].push(new Tc(ne.data,ne.width,ne.height)))}}else{const K=S(G.url);K!==null&&(_[G.uuid]=K)}}}return _}async parseImagesAsync(E){const e=this,l={};let _;async function y(S){if(typeof S=="string"){const O=S,k=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(O)?O:e.resourcePath+O;return await _.loadAsync(k)}return S.data?{data:fl(S.type,S.data),width:S.width,height:S.height}:null}if(E!==void 0&&E.length>0){_=new hi(this.manager),_.setCrossOrigin(this.crossOrigin);for(let S=0,O=E.length;S<O;S++){const k=E[S],N=k.url;if(Array.isArray(N)){l[k.uuid]=[];for(let G=0,$=N.length;G<$;G++){const K=N[G],ie=await y(K);ie!==null&&(ie instanceof HTMLImageElement?l[k.uuid].push(ie):l[k.uuid].push(new Tc(ie.data,ie.width,ie.height)))}}else{const G=await y(k.url);G!==null&&(l[k.uuid]=G)}}}return l}parseTextures(E,e){function l(y,S){return typeof y=="number"?y:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",y),S[y])}const _={};if(E!==void 0)for(let y=0,S=E.length;y<S;y++){const O=E[y];let k;O.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',O.uuid),e[O.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",O.image);const N=e[O.image];Array.isArray(N)?(k=new Ru(N),N.length===6&&(k.needsUpdate=!0)):(k=N&&N.data?new Tc(N.data,N.width,N.height):new Ca(N),N&&(k.needsUpdate=!0)),k.uuid=O.uuid,O.name!==void 0&&(k.name=O.name),O.mapping!==void 0&&(k.mapping=l(O.mapping,Pa)),O.offset!==void 0&&k.offset.fromArray(O.offset),O.repeat!==void 0&&k.repeat.fromArray(O.repeat),O.center!==void 0&&k.center.fromArray(O.center),O.rotation!==void 0&&(k.rotation=O.rotation),O.wrap!==void 0&&(k.wrapS=l(O.wrap[0],Sa),k.wrapT=l(O.wrap[1],Sa)),O.format!==void 0&&(k.format=O.format),O.type!==void 0&&(k.type=O.type),O.encoding!==void 0&&(k.encoding=O.encoding),O.minFilter!==void 0&&(k.minFilter=l(O.minFilter,ha)),O.magFilter!==void 0&&(k.magFilter=l(O.magFilter,ha)),O.anisotropy!==void 0&&(k.anisotropy=O.anisotropy),O.flipY!==void 0&&(k.flipY=O.flipY),O.premultiplyAlpha!==void 0&&(k.premultiplyAlpha=O.premultiplyAlpha),O.unpackAlignment!==void 0&&(k.unpackAlignment=O.unpackAlignment),_[O.uuid]=k}return _}parseObject(E,e,l,_,y){let S,O,k;function N(K){return e[K]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",K),e[K]}function G(K){if(K!==void 0){if(Array.isArray(K)){const ie=[];for(let ne=0,ue=K.length;ne<ue;ne++){const ye=K[ne];l[ye]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",ye),ie.push(l[ye])}return ie}return l[K]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",K),l[K]}}function $(K){return _[K]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",K),_[K]}switch(E.type){case"Scene":S=new Ht,E.background!==void 0&&(Number.isInteger(E.background)?S.background=new On(E.background):S.background=$(E.background)),E.environment!==void 0&&(S.environment=$(E.environment)),E.fog!==void 0&&(E.fog.type==="Fog"?S.fog=new ss(E.fog.color,E.fog.near,E.fog.far):E.fog.type==="FogExp2"&&(S.fog=new Hc(E.fog.color,E.fog.density)));break;case"PerspectiveCamera":S=new rr(E.fov,E.aspect,E.near,E.far),E.focus!==void 0&&(S.focus=E.focus),E.zoom!==void 0&&(S.zoom=E.zoom),E.filmGauge!==void 0&&(S.filmGauge=E.filmGauge),E.filmOffset!==void 0&&(S.filmOffset=E.filmOffset),E.view!==void 0&&(S.view=Object.assign({},E.view));break;case"OrthographicCamera":S=new vc(E.left,E.right,E.top,E.bottom,E.near,E.far),E.zoom!==void 0&&(S.zoom=E.zoom),E.view!==void 0&&(S.view=Object.assign({},E.view));break;case"AmbientLight":S=new yr(E.color,E.intensity);break;case"DirectionalLight":S=new pr(E.color,E.intensity);break;case"PointLight":S=new In(E.color,E.intensity,E.distance,E.decay);break;case"RectAreaLight":S=new Jr(E.color,E.intensity,E.width,E.height);break;case"SpotLight":S=new za(E.color,E.intensity,E.distance,E.angle,E.penumbra,E.decay);break;case"HemisphereLight":S=new Un(E.color,E.groundColor,E.intensity);break;case"LightProbe":S=new ns().fromJSON(E);break;case"SkinnedMesh":O=N(E.geometry),k=G(E.material),S=new Wl(O,k),E.bindMode!==void 0&&(S.bindMode=E.bindMode),E.bindMatrix!==void 0&&S.bindMatrix.fromArray(E.bindMatrix),E.skeleton!==void 0&&(S.skeleton=E.skeleton);break;case"Mesh":O=N(E.geometry),k=G(E.material),S=new eo(O,k);break;case"InstancedMesh":O=N(E.geometry),k=G(E.material);const K=E.count,ie=E.instanceMatrix,ne=E.instanceColor;S=new fu(O,k,K),S.instanceMatrix=new Sc(new Float32Array(ie.array),16),ne!==void 0&&(S.instanceColor=new Sc(new Float32Array(ne.array),ne.itemSize));break;case"LOD":S=new ud;break;case"Line":S=new To(N(E.geometry),G(E.material));break;case"LineLoop":S=new Zl(N(E.geometry),G(E.material));break;case"LineSegments":S=new to(N(E.geometry),G(E.material));break;case"PointCloud":case"Points":S=new pu(N(E.geometry),G(E.material));break;case"Sprite":S=new Il(G(E.material));break;case"Group":S=new ol;break;case"Bone":S=new Ih;break;default:S=new we}if(S.uuid=E.uuid,E.name!==void 0&&(S.name=E.name),E.matrix!==void 0?(S.matrix.fromArray(E.matrix),E.matrixAutoUpdate!==void 0&&(S.matrixAutoUpdate=E.matrixAutoUpdate),S.matrixAutoUpdate&&S.matrix.decompose(S.position,S.quaternion,S.scale)):(E.position!==void 0&&S.position.fromArray(E.position),E.rotation!==void 0&&S.rotation.fromArray(E.rotation),E.quaternion!==void 0&&S.quaternion.fromArray(E.quaternion),E.scale!==void 0&&S.scale.fromArray(E.scale)),E.castShadow!==void 0&&(S.castShadow=E.castShadow),E.receiveShadow!==void 0&&(S.receiveShadow=E.receiveShadow),E.shadow&&(E.shadow.bias!==void 0&&(S.shadow.bias=E.shadow.bias),E.shadow.normalBias!==void 0&&(S.shadow.normalBias=E.shadow.normalBias),E.shadow.radius!==void 0&&(S.shadow.radius=E.shadow.radius),E.shadow.mapSize!==void 0&&S.shadow.mapSize.fromArray(E.shadow.mapSize),E.shadow.camera!==void 0&&(S.shadow.camera=this.parseObject(E.shadow.camera))),E.visible!==void 0&&(S.visible=E.visible),E.frustumCulled!==void 0&&(S.frustumCulled=E.frustumCulled),E.renderOrder!==void 0&&(S.renderOrder=E.renderOrder),E.userData!==void 0&&(S.userData=E.userData),E.layers!==void 0&&(S.layers.mask=E.layers),E.children!==void 0){const K=E.children;for(let ie=0;ie<K.length;ie++)S.add(this.parseObject(K[ie],e,l,_,y))}if(E.animations!==void 0){const K=E.animations;for(let ie=0;ie<K.length;ie++){const ne=K[ie];S.animations.push(y[ne])}}if(E.type==="LOD"){E.autoUpdate!==void 0&&(S.autoUpdate=E.autoUpdate);const K=E.levels;for(let ie=0;ie<K.length;ie++){const ne=K[ie],ue=S.getObjectByProperty("uuid",ne.object);ue!==void 0&&S.addLevel(ue,ne.distance)}}return S}bindSkeletons(E,e){Object.keys(e).length!==0&&E.traverse(function(l){if(l.isSkinnedMesh===!0&&l.skeleton!==void 0){const _=e[l.skeleton];_===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",l.skeleton):l.bind(_,l.bindMatrix)}})}setTexturePath(E){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(E)}},U.ObjectSpaceNormalMap=1,U.OctahedronBufferGeometry=cl,U.OctahedronGeometry=cl,U.OneFactor=201,U.OneMinusDstAlphaFactor=207,U.OneMinusDstColorFactor=209,U.OneMinusSrcAlphaFactor=205,U.OneMinusSrcColorFactor=203,U.OrthographicCamera=vc,U.PCFShadowMap=1,U.PCFSoftShadowMap=2,U.PMREMGenerator=Ou,U.ParametricBufferGeometry=Pl,U.ParametricGeometry=Pl,U.Particle=function(E){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Il(E)},U.ParticleBasicMaterial=function(E){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Ac(E)},U.ParticleSystem=function(E,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new pu(E,e)},U.ParticleSystemMaterial=function(E){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Ac(E)},U.Path=Hi,U.PerspectiveCamera=rr,U.Plane=tc,U.PlaneBufferGeometry=Du,U.PlaneGeometry=Du,U.PlaneHelper=class extends To{constructor(E,e=1,l=16776960){const _=l,y=new oa;y.setAttribute("position",new or([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),y.computeBoundingSphere(),super(y,new go({color:_,toneMapped:!1})),this.type="PlaneHelper",this.plane=E,this.size=e;const S=new oa;S.setAttribute("position",new or([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),S.computeBoundingSphere(),this.add(new eo(S,new fa({color:_,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(E){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?1:0,this.lookAt(this.plane.normal),super.updateMatrixWorld(E)}},U.PointCloud=function(E,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new pu(E,e)},U.PointCloudMaterial=function(E){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Ac(E)},U.PointLight=In,U.PointLightHelper=class extends eo{constructor(E,e,l){super(new Is(e,4,2),new fa({wireframe:!0,fog:!1,toneMapped:!1})),this.light=E,this.light.updateMatrixWorld(),this.color=l,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},U.Points=pu,U.PointsMaterial=Ac,U.PolarGridHelper=class extends to{constructor(E=10,e=16,l=8,_=64,y=4473924,S=8947848){y=new On(y),S=new On(S);const O=[],k=[];for(let G=0;G<=e;G++){const $=G/e*(2*Math.PI),K=Math.sin($)*E,ie=Math.cos($)*E;O.push(0,0,0),O.push(K,0,ie);const ne=1&G?y:S;k.push(ne.r,ne.g,ne.b),k.push(ne.r,ne.g,ne.b)}for(let G=0;G<=l;G++){const $=1&G?y:S,K=E-E/l*G;for(let ie=0;ie<_;ie++){let ne=ie/_*(2*Math.PI),ue=Math.sin(ne)*K,ye=Math.cos(ne)*K;O.push(ue,0,ye),k.push($.r,$.g,$.b),ne=(ie+1)/_*(2*Math.PI),ue=Math.sin(ne)*K,ye=Math.cos(ne)*K,O.push(ue,0,ye),k.push($.r,$.g,$.b)}}const N=new oa;N.setAttribute("position",new or(O,3)),N.setAttribute("color",new or(k,3)),super(N,new go({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},U.PolyhedronBufferGeometry=Lc,U.PolyhedronGeometry=Lc,U.PositionalAudio=class extends Hp{constructor(E){super(E),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(E){return this.panner.refDistance=E,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(E){return this.panner.rolloffFactor=E,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(E){return this.panner.distanceModel=E,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(E){return this.panner.maxDistance=E,this}setDirectionalCone(E,e,l){return this.panner.coneInnerAngle=E,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=l,this}updateMatrixWorld(E){if(super.updateMatrixWorld(E),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Uo,jp,qp),vd.set(0,0,1).applyQuaternion(jp);const e=this.panner;if(e.positionX){const l=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(Uo.x,l),e.positionY.linearRampToValueAtTime(Uo.y,l),e.positionZ.linearRampToValueAtTime(Uo.z,l),e.orientationX.linearRampToValueAtTime(vd.x,l),e.orientationY.linearRampToValueAtTime(vd.y,l),e.orientationZ.linearRampToValueAtTime(vd.z,l)}else e.setPosition(Uo.x,Uo.y,Uo.z),e.setOrientation(vd.x,vd.y,vd.z)}},U.PropertyBinding=ms,U.PropertyMixer=eh,U.QuadraticBezierCurve=uc,U.QuadraticBezierCurve3=nf,U.Quaternion=Ls,U.QuaternionKeyframeTrack=je,U.QuaternionLinearInterpolant=We,U.REVISION=Ze,U.RGBADepthPacking=3201,U.RGBAFormat=1023,U.RGBAIntegerFormat=1033,U.RGBA_ASTC_10x10_Format=37819,U.RGBA_ASTC_10x5_Format=37816,U.RGBA_ASTC_10x6_Format=37817,U.RGBA_ASTC_10x8_Format=37818,U.RGBA_ASTC_12x10_Format=37820,U.RGBA_ASTC_12x12_Format=37821,U.RGBA_ASTC_4x4_Format=37808,U.RGBA_ASTC_5x4_Format=37809,U.RGBA_ASTC_5x5_Format=37810,U.RGBA_ASTC_6x5_Format=37811,U.RGBA_ASTC_6x6_Format=37812,U.RGBA_ASTC_8x5_Format=37813,U.RGBA_ASTC_8x6_Format=37814,U.RGBA_ASTC_8x8_Format=37815,U.RGBA_BPTC_Format=36492,U.RGBA_ETC2_EAC_Format=37496,U.RGBA_PVRTC_2BPPV1_Format=35843,U.RGBA_PVRTC_4BPPV1_Format=35842,U.RGBA_S3TC_DXT1_Format=33777,U.RGBA_S3TC_DXT3_Format=33778,U.RGBA_S3TC_DXT5_Format=33779,U.RGBDEncoding=3006,U.RGBEEncoding=3002,U.RGBEFormat=1023,U.RGBFormat=1022,U.RGBIntegerFormat=1032,U.RGBM16Encoding=3005,U.RGBM7Encoding=3004,U.RGB_ETC1_Format=36196,U.RGB_ETC2_Format=37492,U.RGB_PVRTC_2BPPV1_Format=35841,U.RGB_PVRTC_4BPPV1_Format=35840,U.RGB_S3TC_DXT1_Format=33776,U.RGFormat=1030,U.RGIntegerFormat=1031,U.RawShaderMaterial=hh,U.Ray=Wr,U.Raycaster=class{constructor(E,e,l=0,_=1/0){this.ray=new Wr(E,e),this.near=l,this.far=_,this.camera=null,this.layers=new fo,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(E,e){this.ray.set(E,e)}setFromCamera(E,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(E.x,E.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(E.x,E.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(E,e=!1,l=[]){return Zp(E,this,l,e),l.sort(wm),l}intersectObjects(E,e=!1,l=[]){for(let _=0,y=E.length;_<y;_++)Zp(E[_],this,l,e);return l.sort(wm),l}},U.RectAreaLight=Jr,U.RedFormat=1028,U.RedIntegerFormat=1029,U.ReinhardToneMapping=2,U.RepeatWrapping=1e3,U.ReplaceStencilOp=7681,U.ReverseSubtractEquation=102,U.RingBufferGeometry=io,U.RingGeometry=io,U.SRGB8_ALPHA8_ASTC_10x10_Format=37851,U.SRGB8_ALPHA8_ASTC_10x5_Format=37848,U.SRGB8_ALPHA8_ASTC_10x6_Format=37849,U.SRGB8_ALPHA8_ASTC_10x8_Format=37850,U.SRGB8_ALPHA8_ASTC_12x10_Format=37852,U.SRGB8_ALPHA8_ASTC_12x12_Format=37853,U.SRGB8_ALPHA8_ASTC_4x4_Format=37840,U.SRGB8_ALPHA8_ASTC_5x4_Format=37841,U.SRGB8_ALPHA8_ASTC_5x5_Format=37842,U.SRGB8_ALPHA8_ASTC_6x5_Format=37843,U.SRGB8_ALPHA8_ASTC_6x6_Format=37844,U.SRGB8_ALPHA8_ASTC_8x5_Format=37845,U.SRGB8_ALPHA8_ASTC_8x6_Format=37846,U.SRGB8_ALPHA8_ASTC_8x8_Format=37847,U.Scene=Ht,U.SceneUtils=Rp,U.ShaderChunk=Kr,U.ShaderLib=Zo,U.ShaderMaterial=El,U.ShadowMaterial=v,U.Shape=en,U.ShapeBufferGeometry=ho,U.ShapeGeometry=ho,U.ShapePath=Os,U.ShapeUtils=So,U.ShortType=1011,U.Skeleton=Dh,U.SkeletonHelper=ih,U.SkinnedMesh=Wl,U.SmoothShading=2,U.Sphere=zn,U.SphereBufferGeometry=Is,U.SphereGeometry=Is,U.Spherical=class{constructor(E=1,e=0,l=0){return this.radius=E,this.phi=e,this.theta=l,this}set(E,e,l){return this.radius=E,this.phi=e,this.theta=l,this}copy(E){return this.radius=E.radius,this.phi=E.phi,this.theta=E.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(E){return this.setFromCartesianCoords(E.x,E.y,E.z)}setFromCartesianCoords(E,e,l){return this.radius=Math.sqrt(E*E+e*e+l*l),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(E,l),this.phi=Math.acos(Er(e/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},U.SphericalHarmonics3=is,U.SplineCurve=Bh,U.SpotLight=za,U.SpotLightHelper=class extends we{constructor(E,e){super(),this.light=E,this.light.updateMatrixWorld(),this.matrix=E.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const l=new oa,_=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let S=0,O=1,k=32;S<k;S++,O++){const N=S/k*Math.PI*2,G=O/k*Math.PI*2;_.push(Math.cos(N),Math.sin(N),1,Math.cos(G),Math.sin(G),1)}l.setAttribute("position",new or(_,3));const y=new go({fog:!1,toneMapped:!1});this.cone=new to(l,y),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const E=this.light.distance?this.light.distance:1e3,e=E*Math.tan(this.light.angle);this.cone.scale.set(e,e,E),Tp.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Tp),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},U.Sprite=Il,U.SpriteMaterial=Wd,U.SrcAlphaFactor=204,U.SrcAlphaSaturateFactor=210,U.SrcColorFactor=202,U.StaticCopyUsage=35046,U.StaticDrawUsage=35044,U.StaticReadUsage=35045,U.StereoCamera=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new rr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new rr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(E){const e=this._cache;if(e.focus!==E.focus||e.fov!==E.fov||e.aspect!==E.aspect*this.aspect||e.near!==E.near||e.far!==E.far||e.zoom!==E.zoom||e.eyeSep!==this.eyeSep){e.focus=E.focus,e.fov=E.fov,e.aspect=E.aspect*this.aspect,e.near=E.near,e.far=E.far,e.zoom=E.zoom,e.eyeSep=this.eyeSep;const l=E.projectionMatrix.clone(),_=e.eyeSep/2,y=_*e.near/e.focus,S=e.near*Math.tan(gr*e.fov*.5)/e.zoom;let O,k;Kl.elements[12]=-_,hl.elements[12]=_,O=-S*e.aspect+y,k=S*e.aspect+y,l.elements[0]=2*e.near/(k-O),l.elements[8]=(k+O)/(k-O),this.cameraL.projectionMatrix.copy(l),O=-S*e.aspect-y,k=S*e.aspect-y,l.elements[0]=2*e.near/(k-O),l.elements[8]=(k+O)/(k-O),this.cameraR.projectionMatrix.copy(l)}this.cameraL.matrixWorld.copy(E.matrixWorld).multiply(Kl),this.cameraR.matrixWorld.copy(E.matrixWorld).multiply(hl)}},U.StreamCopyUsage=35042,U.StreamDrawUsage=35040,U.StreamReadUsage=35041,U.StringKeyframeTrack=at,U.SubtractEquation=101,U.SubtractiveBlending=3,U.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},U.TangentSpaceNormalMap=0,U.TetrahedronBufferGeometry=Ol,U.TetrahedronGeometry=Ol,U.TextBufferGeometry=Va,U.TextGeometry=Va,U.Texture=Ca,U.TextureLoader=zi,U.TorusBufferGeometry=wu,U.TorusGeometry=wu,U.TorusKnotBufferGeometry=Dc,U.TorusKnotGeometry=Dc,U.Triangle=Si,U.TriangleFanDrawMode=2,U.TriangleStripDrawMode=1,U.TrianglesDrawMode=0,U.TubeBufferGeometry=d,U.TubeGeometry=d,U.UVMapping=300,U.Uint16Attribute=function(E,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new al(E,e)},U.Uint16BufferAttribute=al,U.Uint32Attribute=function(E,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new _a(E,e)},U.Uint32BufferAttribute=_a,U.Uint8Attribute=function(E,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new ds(E,e)},U.Uint8BufferAttribute=ds,U.Uint8ClampedAttribute=function(E,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Fs(E,e)},U.Uint8ClampedBufferAttribute=Fs,U.Uniform=Df,U.UniformsLib=dr,U.UniformsUtils=br,U.UnsignedByteType=1009,U.UnsignedInt248Type=1020,U.UnsignedIntType=1014,U.UnsignedShort4444Type=1017,U.UnsignedShort5551Type=1018,U.UnsignedShort565Type=1019,U.UnsignedShortType=1012,U.VSMShadowMap=3,U.Vector2=dn,U.Vector3=ht,U.Vector4=qr,U.VectorKeyframeTrack=gt,U.Vertex=function(E,e,l){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new ht(E,e,l)},U.VertexColors=2,U.VideoTexture=Jd,U.WebGL1Renderer=Pn,U.WebGLCubeRenderTarget=ch,U.WebGLMultipleRenderTargets=$s,U.WebGLMultisampleRenderTarget=Lo,U.WebGLRenderTarget=gs,U.WebGLRenderTargetCube=function(E,e,l){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new ch(E,l)},U.WebGLRenderer=Ri,U.WebGLUtils=qu,U.WireframeGeometry=i,U.WireframeHelper=function(E,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new to(new i(E.geometry),new go({color:e!==void 0?e:16777215}))},U.WrapAroundEnding=2402,U.XHRLoader=function(E){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Et(E)},U.ZeroCurvatureEnding=2400,U.ZeroFactor=200,U.ZeroSlopeEnding=2401,U.ZeroStencilOp=0,U.sRGBEncoding=3001,Object.defineProperty(U,"__esModule",{value:!0})})}(vg,vg.exports)),vg.exports}var ny={exports:{}},ry={exports:{}},ay={exports:{}},Uv;function Ly(){return Uv||(Uv=1,function(En,na){const Ze=.0005555555555555556*Math.PI,St=Math.atan(3/4),ei=63710088e-1,Le=40075017;En.exports={WORLD_SIZE:1024e3,PROJECTION_WORLD_SIZE:1024e3/(ei*Math.PI*2),MERCATOR_A:ei,DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,EARTH_RADIUS:ei,EARTH_CIRCUMFERENCE:2*Math.PI*ei,EARTH_CIRCUMFERENCE_EQUATOR:Le,FOV_ORTHO:Ze,FOV:St,FOV_DEGREES:St*180/Math.PI,TILE_SIZE:512}}(ay)),ay.exports}var sy={exports:{}},Vv;function yb(){return Vv||(Vv=1,function(En,na){function U(){}U.prototype={Coords:function(Ze){if(Ze.constructor!==Array){console.error("Coords must be an array");return}if(Ze.length<2){console.error("Coords length must be at least 2");return}for(const St of Ze)if(St.constructor!==Number){console.error("Coords values must be numbers");return}if(Math.abs(Ze[1])>90){console.error("Latitude must be between -90 and 90");return}return Ze},Line:function(Ze){var St=this;if(Ze.constructor!==Array){console.error("Line must be an array");return}for(const ei of Ze)if(!St.Coords(ei)){console.error("Each coordinate in a line must be a valid Coords type");return}return Ze},Rotation:function(Ze){if(Ze.constructor===Number)Ze={z:Ze};else if(Ze.constructor===Object)for(const St of Object.keys(Ze)){if(!["x","y","z"].includes(St)){console.error("Rotation parameters must be x, y, or z");return}if(Ze[St].constructor!==Number){console.error("Individual rotation values must be numbers");return}}else{console.error("Rotation must be an object or a number");return}return Ze},Scale:function(Ze){if(Ze.constructor===Number)Ze={x:Ze,y:Ze,z:Ze};else if(Ze.constructor===Object)for(const St of Object.keys(Ze)){if(!["x","y","z"].includes(St)){console.error("Scale parameters must be x, y, or z");return}if(Ze[St].constructor!==Number){console.error("Individual scale values must be numbers");return}}else{console.error("Scale must be an object or a number");return}return Ze}},En.exports=U}(sy)),sy.exports}var Gv;function Ld(){return Gv||(Gv=1,function(En,na){var U=Oc(),Ze=Ly(),St=yb(),ei={prettyPrintMatrix:function(Le){for(var r=0;r<4;r++){var Ge=[Le[r],Le[r+4],Le[r+8],Le[r+12]];console.log(Ge.map(function(de){return de.toFixed(4)}))}},makePerspectiveMatrix:function(Le,r,Ge,de){var Je=new U.Matrix4,rt=1/Math.tan(Le/2),ai=1/(Ge-de),bi=[rt/r,0,0,0,0,rt,0,0,0,0,(de+Ge)*ai,-1,0,0,2*de*Ge*ai,0];return Je.elements=bi,Je},makeOrthographicMatrix:function(Le,r,Ge,de,Je,rt){var ai=new U.Matrix4;const bi=1/(r-Le),Ai=1/(Ge-de),qt=1/(rt-Je),xi=(r+Le)*bi,kt=(Ge+de)*Ai,Tt=Je*qt;var ln=[2*bi,0,0,0,0,2*Ai,0,0,0,0,-1*qt,0,-xi,-kt,-Tt,1];return ai.elements=ln,ai},radify:function(Le){function r(Ge){return Ge=Ge||0,Math.PI*2*Ge/360}return typeof Le=="object"?Le.length>0?Le.map(function(Ge){return r(Ge)}):[r(Le.x),r(Le.y),r(Le.z)]:r(Le)},degreeify:function(Le){function r(Ge){return Ge=Ge||0,Ge*360/(Math.PI*2)}return typeof Le=="object"?[r(Le.x),r(Le.y),r(Le.z)]:r(Le)},projectToWorld:function(Le){var r=[-Ze.MERCATOR_A*Ze.DEG2RAD*Le[0]*Ze.PROJECTION_WORLD_SIZE,-Ze.MERCATOR_A*Math.log(Math.tan(Math.PI*.25+.5*Ze.DEG2RAD*Le[1]))*Ze.PROJECTION_WORLD_SIZE];if(!Le[2])r.push(0);else{var Ge=this.projectedUnitsPerMeter(Le[1]);r.push(Le[2]*Ge)}var de=new U.Vector3(r[0],r[1],r[2]);return de},projectedUnitsPerMeter:function(Le){return Math.abs(Ze.WORLD_SIZE/Math.cos(Ze.DEG2RAD*Le)/Ze.EARTH_CIRCUMFERENCE)},_circumferenceAtLatitude:function(Le){return Ze.EARTH_CIRCUMFERENCE*Math.cos(Le*Math.PI/180)},mercatorZfromAltitude:function(Le,r){return Le/this._circumferenceAtLatitude(r)},_scaleVerticesToMeters:function(Le,r){var Ge=this.projectedUnitsPerMeter(Le[1]);this.projectToWorld(Le);for(var de=0;de<r.length;de++)r[de].multiplyScalar(Ge);return r},projectToScreen:function(Le){console.log("WARNING: Projecting to screen coordinates is not yet implemented")},unprojectFromScreen:function(Le){console.log("WARNING: unproject is not yet implemented")},unprojectFromWorld:function(Le){var r=[-Le.x/(Ze.MERCATOR_A*Ze.DEG2RAD*Ze.PROJECTION_WORLD_SIZE),2*(Math.atan(Math.exp(Le.y/(Ze.PROJECTION_WORLD_SIZE*-Ze.MERCATOR_A)))-Math.PI/4)/Ze.DEG2RAD],Ge=this.projectedUnitsPerMeter(r[1]),de=Le.z||0;return r.push(de/Ge),r},toScreenPosition:function(Le,r){var Ge=new U.Vector3,de=.5*renderer.context.canvas.width,Je=.5*renderer.context.canvas.height;return Le.updateMatrixWorld(),Ge.setFromMatrixPosition(Le.matrixWorld),Ge.project(r),Ge.x=Ge.x*de+de,Ge.y=-(Ge.y*Je)+Je,{x:Ge.x,y:Ge.y}},getFeatureCenter:function(r,Ge,de){let Je=[],rt=0,ai=0,bi=0,Ai=[...r.geometry.coordinates[0]];return r.geometry.type==="Point"?Je=[...Ai[0]]:(r.geometry.type==="MultiPolygon"&&(Ai=Ai[0]),Ai.splice(-1,1),Ai.forEach(function(qt){rt+=qt[0],ai+=qt[1]}),Je=[rt/Ai.length,ai/Ai.length]),bi=this.getObjectHeightOnFloor(r,Ge,de),Je.length<3?Je.push(bi):Je[2]=bi,Je},getObjectHeightOnFloor:function(Le,r,Ge=Le.properties.level||0){let de=Ge*(Le.properties.levelHeight||0),Je=Le.properties.base_height||Le.properties.min_height||0,ai=(r&&r.model?0:Le.properties.height-Je)+Je;return de+ai},_flipMaterialSides:function(Le){},normalizeVertices(Le){let r=new U.BufferGeometry,Ge=[];for(var de=0;de<Le.length;de++){let ai=Le[de];Ge.push(ai.x,ai.y,ai.z),Ge.push(ai.x,ai.y,ai.z)}r.setAttribute("position",new U.BufferAttribute(new Float32Array(Ge),3)),r.computeBoundingSphere();var Je=r.boundingSphere.center,rt=Le.map(function(ai){var bi=ai.sub(Je);return bi});return{vertices:rt,position:Je}},flattenVectors(Le){var r=[];for(let Ge of Le)r.push(Ge.x,Ge.y,Ge.z);return r},lnglatsToWorld:function(Le){var r=Le.map(function(Ge){var de=ei.projectToWorld(Ge),Je=new U.Vector3(de.x,de.y,de.z);return Je});return r},extend:function(Le,r){for(let Ge in r)Le[Ge]=r[Ge]},clone:function(Le){var r={};for(let Ge in Le)r[Ge]=Le[Ge];return r},clamp:function(Le,r,Ge){return Math.min(Ge,Math.max(r,Le))},types:{rotation:function(Le,r){Le||(Le=0),typeof Le=="number"&&(Le={z:Le});var Ge=this.applyDefault([Le.x,Le.y,Le.z],r),de=ei.radify(Ge);return de},scale:function(Le,r){return Le||(Le=1),typeof Le=="number"?Le=[Le,Le,Le]:this.applyDefault([Le.x,Le.y,Le.z],r)},applyDefault:function(Le,r){var Ge=Le.map(function(de,Je){return de=de||r[Je],de});return Ge}},toDecimal:function(Le,r){return Number(Le.toFixed(r))},equal:function(Le,r){const Ge=Object.keys(Le),de=Object.keys(r);if(Ge.length!==de.length||Ge.length==0&&de.length==0&&Ge!==de)return!1;for(const Je of Ge){const rt=Le[Je],ai=r[Je],bi=this.isObject(rt)&&this.isObject(ai);if(bi&&!equal(rt,ai)||!bi&&rt!==ai)return!1}return!0},isObject:function(Le){return Le!=null&&typeof Le=="object"},curveToLine:(Le,r)=>{let{width:Ge,color:de}=r,Je=new U.BufferGeometry().setFromPoints(Le.getPoints(100)),rt=new U.LineBasicMaterial({color:de,linewidth:Ge});return new U.Line(Je,rt)},curvesToLines:Le=>{var r=[16711680,2031360,2490623],Ge=Le.map((de,Je)=>{let rt={width:3,color:r[Je]||"purple"};return curveToLine(de,rt)});return Ge},_validate:function(Le,r){Le=Le||{};var Ge={};ei.extend(Ge,Le);for(let de of Object.keys(r))if(Le[de]===void 0)if(r[de]===null){console.error(de+" is required");return}else Ge[de]=r[de];else Ge[de]=Le[de];return Ge},Validator:new St,exposedMethods:["projectToWorld","projectedUnitsPerMeter","extend","unprojectFromWorld"]};En.exports=ei}(ry)),ry.exports}var Hv;function vb(){return Hv||(Hv=1,function(En,na){const U=Oc(),Ze=Ld(),St=Ly();function ei(Le,r,Ge){this.map=Le,this.camera=r,this.active=!0,this.camera.matrixAutoUpdate=!1,this.world=Ge||new U.Group,this.world.position.x=this.world.position.y=St.WORLD_SIZE/2,this.world.matrixAutoUpdate=!1,this.state={translateCenter:new U.Matrix4().makeTranslation(St.WORLD_SIZE/2,-St.WORLD_SIZE/2,0),worldSizeRatio:St.TILE_SIZE/St.WORLD_SIZE,worldSize:St.TILE_SIZE*this.map.transform.scale};let de=this;this.map.on("move",function(){de.updateCamera()}).on("resize",function(){de.setupCamera()}),this.setupCamera()}ei.prototype={setupCamera:function(){const Le=this.map.transform;this.camera.aspect=Le.width/Le.height,this.halfFov=Le._fov/2,this.cameraToCenterDistance=.5/Math.tan(this.halfFov)*Le.height;const r=Le._maxPitch*Math.PI/180;this.acuteAngle=Math.PI/2-r,this.updateCamera()},updateCamera:function(Le){if(!this.camera){console.log("nocamera");return}const r=this.map.transform;this.camera.aspect=r.width/r.height;const Ge=r.centerOffset||new U.Vector3;let de=0,Je=0;this.halfFov=r._fov/2;const rt=Math.PI/2+r._pitch,ai=Math.cos(Math.PI/2-r._pitch);this.cameraToCenterDistance=.5/Math.tan(this.halfFov)*r.height;let bi=1;const Ai=this.worldSize();if(this.map.tb.mapboxVersion>=2){bi=this.mercatorZfromAltitude(1,r.center.lat)*Ai;const oi=r._fov*(.5+r.centerOffset.y/r.height),Ci=r.elevation?r.elevation.getMinElevationBelowMSL()*bi:0,Zt=(r._camera.position[2]*Ai-Ci)/Math.cos(r._pitch),Yt=Math.sin(oi)*Zt/Math.sin(Ze.clamp(Math.PI-rt-oi,.01,Math.PI-.01));Je=ai*Yt+Zt;const vi=Zt*(1/r._horizonShift);de=Math.min(Je*1.01,vi)}else{const oi=Math.sin(this.halfFov)*this.cameraToCenterDistance/Math.sin(Math.PI-rt-this.halfFov);Je=ai*oi+this.cameraToCenterDistance,de=Je*1.01}this.cameraTranslateZ=new U.Matrix4().makeTranslation(0,0,this.cameraToCenterDistance);const qt=r.height/50,xi=Math.max(qt*ai,qt),kt=r.height,Tt=r.width;this.camera instanceof U.OrthographicCamera?this.camera.projectionMatrix=Ze.makeOrthographicMatrix(Tt/-2,Tt/2,kt/2,kt/-2,xi,de):this.camera.projectionMatrix=Ze.makePerspectiveMatrix(r._fov,Tt/kt,xi,de),this.camera.projectionMatrix.elements[8]=-Ge.x*2/r.width,this.camera.projectionMatrix.elements[9]=Ge.y*2/r.height;let ln=this.calcCameraMatrix(r._pitch,r.angle);r.elevation&&(ln.elements[14]=r._camera.position[2]*Ai),this.camera.matrixWorld.copy(ln);let Xi=r.scale*this.state.worldSizeRatio,Dt=new U.Matrix4,ni=new U.Matrix4,ci=new U.Matrix4;Dt.makeScale(Xi,Xi,Xi);let Nn=r.x||r.point.x,Fi=r.y||r.point.y;ni.makeTranslation(-Nn,Fi,0),ci.makeRotationZ(Math.PI),this.world.matrix=new U.Matrix4().premultiply(ci).premultiply(this.state.translateCenter).premultiply(Dt).premultiply(ni),this.map.fire("CameraSynced",{detail:{nearZ:xi,farZ:de,pitch:r._pitch,angle:r.angle,furthestDistance:Je,cameraToCenterDistance:this.cameraToCenterDistance,t:this.map.transform,tbProjMatrix:this.camera.projectionMatrix.elements,tbWorldMatrix:this.world.matrix.elements,cameraSyn:ei}})},worldSize(){let Le=this.map.transform;return Le.tileSize*Le.scale},worldSizeFromZoom(){let Le=this.map.transform;return Math.pow(2,Le.zoom)*Le.tileSize},mercatorZfromAltitude(Le,r){return Le/this.circumferenceAtLatitude(r)},mercatorZfromZoom(){return this.cameraToCenterDistance/this.worldSizeFromZoom()},circumferenceAtLatitude(Le){return St.EARTH_CIRCUMFERENCE*Math.cos(Le*Math.PI/180)},calcCameraMatrix(Le,r,Ge){const de=this.map.transform,Je=Le===void 0?de._pitch:Le,rt=r===void 0?de.angle:r,ai=Ge===void 0?this.cameraTranslateZ:Ge;return new U.Matrix4().premultiply(ai).premultiply(new U.Matrix4().makeRotationX(Je)).premultiply(new U.Matrix4().makeRotationZ(rt))},updateCameraState(){let Le=this.map.transform;if(!Le.height)return;const r=Le._camera.forward(),Ge=Le.cameraToCenterDistance,de=Le.point;Le._cameraZoom?Le._cameraZoom:Le._zoom;const rt=this.mercatorZfromZoom(Le)-this.mercatorZfromAltitude(Le._centerAltitude,Le.center.lat),ai=Le.cameraToCenterDistance/rt;return[de.x/this.worldSize()-r[0]*Ge/ai,de.y/this.worldSize()-r[1]*Ge/ai,this.mercatorZfromAltitude(Le._centerAltitude,Le._center.lat)+-r[2]*Ge/ai]},getWorldToCamera(Le,r){let Ge=this.map.transform;const de=new U.Matrix4,Je=new U.Matrix4,rt=Ge._camera._orientation,ai=Ge._camera.position,bi=new U.Vector3(ai[0],ai[1],ai[2]),Ai=new U.Quaternion;Ai.set(rt[0],rt[1],rt[2],rt[3]);const qt=Ai.conjugate();return bi.multiplyScalar(-Le),Je.makeTranslation(bi.x,bi.y,bi.z),de.makeRotationFromQuaternion(qt).premultiply(Je),de.elements[1]*=-1,de.elements[5]*=-1,de.elements[9]*=-1,de.elements[13]*=-1,de.elements[8]*=r,de.elements[9]*=r,de.elements[10]*=r,de.elements[11]*=r,de},translate(Le,r,Ge){let de=Ge[0]||Ge.x,Je=Ge[1]||Ge.y,rt=Ge[2]||Ge.z,ai,bi,Ai,qt,xi,kt,Tt,ln,Xi,Dt,ni,ci;return r===Le?(Le[12]=r[0]*de+r[4]*Je+r[8]*rt+r[12],Le[13]=r[1]*de+r[5]*Je+r[9]*rt+r[13],Le[14]=r[2]*de+r[6]*Je+r[10]*rt+r[14],Le[15]=r[3]*de+r[7]*Je+r[11]*rt+r[15]):(ai=r[0],bi=r[1],Ai=r[2],qt=r[3],xi=r[4],kt=r[5],Tt=r[6],ln=r[7],Xi=r[8],Dt=r[9],ni=r[10],ci=r[11],Le[0]=ai,Le[1]=bi,Le[2]=Ai,Le[3]=qt,Le[4]=xi,Le[5]=kt,Le[6]=Tt,Le[7]=ln,Le[8]=Xi,Le[9]=Dt,Le[10]=ni,Le[11]=ci,Le[12]=ai*de+xi*Je+Xi*rt+r[12],Le[13]=bi*de+kt*Je+Dt*rt+r[13],Le[14]=Ai*de+Tt*Je+ni*rt+r[14],Le[15]=qt*de+ln*Je+ci*rt+r[15]),Le}},En.exports=ei}(ny)),ny.exports}var oy={exports:{}},jv;function yx(){return jv||(jv=1,function(En,na){(function(){var U=Math.PI,Ze=Math.sin,St=Math.cos,ei=Math.tan,Le=Math.asin,r=Math.atan2,Ge=Math.acos,de=U/180,Je=1e3*60*60*24,rt=2440588,ai=2451545;function bi(it){return it.valueOf()/Je-.5+rt}function Ai(it){return new Date((it+.5-rt)*Je)}function qt(it){return bi(it)-ai}var xi=de*23.4397;function kt(it,vt){return r(Ze(it)*St(xi)-ei(vt)*Ze(xi),St(it))}function Tt(it,vt){return Le(Ze(vt)*St(xi)+St(vt)*Ze(xi)*Ze(it))}function ln(it,vt,bt){return r(Ze(it),St(it)*Ze(vt)-ei(bt)*St(vt))}function Xi(it,vt,bt){return Le(Ze(vt)*Ze(bt)+St(vt)*St(bt)*St(it))}function Dt(it,vt){return de*(280.16+360.9856235*it)-vt}function ni(it){return it<0&&(it=0),2967e-7/Math.tan(it+.00312536/(it+.08901179))}function ci(it){return de*(357.5291+.98560028*it)}function Nn(it){var vt=de*(1.9148*Ze(it)+.02*Ze(2*it)+3e-4*Ze(3*it)),bt=de*102.9372;return it+vt+bt+U}function Fi(it){var vt=ci(it),bt=Nn(vt);return{dec:Tt(bt,0),ra:kt(bt,0)}}var oi={};oi.getPosition=function(it,vt,bt){var pt=de*-bt,ti=de*vt,Wi=qt(it),mn=Fi(Wi),fn=Dt(Wi,pt)-mn.ra;return{azimuth:ln(fn,ti,mn.dec),altitude:Xi(fn,ti,mn.dec)}},oi.toJulian=function(it){return bi(it)};var Ci=oi.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];oi.addTime=function(it,vt,bt){Ci.push([it,vt,bt])};var Zt=9e-4;function Yt(it,vt){return Math.round(it-Zt-vt/(2*U))}function vi(it,vt,bt){return Zt+(it+vt)/(2*U)+bt}function ae(it,vt,bt){return ai+it+.0053*Ze(vt)-.0069*Ze(2*bt)}function ge(it,vt,bt){return Ge((Ze(it)-Ze(vt)*Ze(bt))/(St(vt)*St(bt)))}function Te(it){return-2.076*Math.sqrt(it)/60}function Re(it,vt,bt,pt,ti,Wi,mn){var fn=ge(it,bt,pt),vr=vi(fn,vt,ti);return ae(vr,Wi,mn)}oi.getTimes=function(it,vt,bt,pt){pt=pt||0;var ti=de*-bt,Wi=de*vt,mn=Te(pt),fn=qt(it),vr=Yt(fn,ti),et=vi(0,ti,vr),jr=ci(et),Ra=Nn(jr),ra=Tt(Ra,0),Pi=ae(et,jr,Ra),cn,Ye,Xe,ft,ct,Rt,Ut={solarNoon:Ai(Pi),nadir:Ai(Pi-.5)};for(cn=0,Ye=Ci.length;cn<Ye;cn+=1)Xe=Ci[cn],ft=(Xe[0]+mn)*de,ct=Re(ft,ti,Wi,ra,vr,jr,Ra),Rt=Pi-(ct-Pi),Ut[Xe[1]]=Ai(Rt),Ut[Xe[2]]=Ai(ct);return Ut};function ze(it){var vt=de*(218.316+13.176396*it),bt=de*(134.963+13.064993*it),pt=de*(93.272+13.22935*it),ti=vt+de*6.289*Ze(bt),Wi=de*5.128*Ze(pt),mn=385001-20905*St(bt);return{ra:kt(ti,Wi),dec:Tt(ti,Wi),dist:mn}}oi.getMoonPosition=function(it,vt,bt){var pt=de*-bt,ti=de*vt,Wi=qt(it),mn=ze(Wi),fn=Dt(Wi,pt)-mn.ra,vr=Xi(fn,ti,mn.dec),et=r(Ze(fn),ei(ti)*St(mn.dec)-Ze(mn.dec)*St(fn));return vr=vr+ni(vr),{azimuth:ln(fn,ti,mn.dec),altitude:vr,distance:mn.dist,parallacticAngle:et}},oi.getMoonIllumination=function(it){var vt=qt(it||new Date),bt=Fi(vt),pt=ze(vt),ti=149598e3,Wi=Ge(Ze(bt.dec)*Ze(pt.dec)+St(bt.dec)*St(pt.dec)*St(bt.ra-pt.ra)),mn=r(ti*Ze(Wi),pt.dist-ti*St(Wi)),fn=r(St(bt.dec)*Ze(bt.ra-pt.ra),Ze(bt.dec)*St(pt.dec)-St(bt.dec)*Ze(pt.dec)*St(bt.ra-pt.ra));return{fraction:(1+St(mn))/2,phase:.5+.5*mn*(fn<0?-1:1)/Math.PI,angle:fn}};function Ie(it,vt){return new Date(it.valueOf()+vt*Je/24)}oi.getMoonTimes=function(it,vt,bt,pt){var ti=new Date(it);pt?ti.setUTCHours(0,0,0,0):ti.setHours(0,0,0,0);for(var Wi=.133*de,mn=oi.getMoonPosition(ti,vt,bt).altitude-Wi,fn,vr,et,jr,Ra,ra,Pi,cn,Ye,Xe,ft,ct,Rt,Ut=1;Ut<=24&&(fn=oi.getMoonPosition(Ie(ti,Ut),vt,bt).altitude-Wi,vr=oi.getMoonPosition(Ie(ti,Ut+1),vt,bt).altitude-Wi,Ra=(mn+vr)/2-fn,ra=(vr-mn)/2,Pi=-ra/(2*Ra),cn=(Ra*Pi+ra)*Pi+fn,Ye=ra*ra-4*Ra*fn,Xe=0,Ye>=0&&(Rt=Math.sqrt(Ye)/(Math.abs(Ra)*2),ft=Pi-Rt,ct=Pi+Rt,Math.abs(ft)<=1&&Xe++,Math.abs(ct)<=1&&Xe++,ft<-1&&(ft=ct)),Xe===1?mn<0?et=Ut+ft:jr=Ut+ft:Xe===2&&(et=Ut+(cn<0?ct:ft),jr=Ut+(cn<0?ft:ct)),!(et&&jr));Ut+=2)mn=vr;var li={};return et&&(li.rise=Ie(ti,et)),jr&&(li.set=Ie(ti,jr)),!et&&!jr&&(li[cn>0?"alwaysUp":"alwaysDown"]=!0),li},En.exports=oi})()}(oy)),oy.exports}var ly={exports:{}},cy={exports:{}},qv;function e_(){return qv||(qv=1,function(En,na){var U=Ld(),Ze=Oc(),St={material:"MeshBasicMaterial",color:"black",opacity:1};function ei(Le){var r;Le?(Le=U._validate(Le,St),Le.material&&Le.material.isMaterial?r=Le.material:Le.material||Le.color||Le.opacity?r=new Ze[Le.material]({color:Le.color,transparent:Le.opacity<1}):r=Ge(),r.opacity=Le.opacity,Le.side&&(r.side=Le.side)):r=Ge();function Ge(){return new Ze[St.material]({color:St.color})}return r}En.exports=ei}(cy)),cy.exports}var uy={exports:{}},Wv;function xb(){return Wv||(Wv=1,function(En,na){const U=Oc(),Ze=Ld();function St(Le){this.map=Le,this.enrolledObjects=[],this.previousFrameTime}St.prototype={unenroll:function(Le){this.enrolledObjects.splice(this.enrolledObjects.indexOf(Le),1)},enroll:function(Le){if(Le.clock=new U.Clock,Le.hasDefaultAnimation=!1,Le.defaultAction,Le.actions=[],Le.mixer,Le.animations&&Le.animations.length>0){Le.hasDefaultAnimation=!0;let de=Le.userData.defaultAnimation?Le.userData.defaultAnimation:0;Le.mixer=new U.AnimationMixer(Le),r(de)}function r(de){for(let Je=0;Je<Le.animations.length;Je++){de>Le.animations.length&&console.log("The animation index "+de+" doesn't exist for this object");let rt=Le.animations[Je],ai=Le.mixer.clipAction(rt);Le.actions.push(ai),de===Je?(Le.defaultAction=ai,ai.setEffectiveWeight(1)):ai.setEffectiveWeight(0),ai.play()}}let Ge=!1;Object.defineProperty(Le,"isPlaying",{get(){return Ge},set(de){Ge!=de&&(Ge=de,Le.dispatchEvent({type:"IsPlayingChanged",detail:Le}))}}),this.enrolledObjects.push(Le),Le.animationQueue=[],Le.set=function(de){if(de.duration>0){let Je={start:Date.now(),expiration:Date.now()+de.duration,endState:{}};Ze.extend(de,Je);let rt=de.coords,ai=de.rotation,bi=de.scale||de.scaleX||de.scaleY||de.scaleZ;if(ai){let qt=Le.rotation;de.startRotation=[qt.x,qt.y,qt.z],de.endState.rotation=Ze.types.rotation(de.rotation,de.startRotation),de.rotationPerMs=de.endState.rotation.map(function(xi,kt){return(xi-de.startRotation[kt])/de.duration})}if(bi){let qt=Le.scale;de.startScale=[qt.x,qt.y,qt.z],de.endState.scale=Ze.types.scale(de.scale,de.startScale),de.scalePerMs=de.endState.scale.map(function(xi,kt){return(xi-de.startScale[kt])/de.duration})}rt&&(de.pathCurve=new U.CatmullRomCurve3(Ze.lnglatsToWorld([Le.coordinates,de.coords])));let Ai={type:"set",parameters:de};this.animationQueue.push(Ai),tb.map.repaint=!0}else this.stop(),de.rotation=Ze.radify(de.rotation),this._setObject(de);return this},Le.animationMethod=null,Le.stop=function(de){return Le.mixer&&(Le.isPlaying=!1,cancelAnimationFrame(Le.animationMethod)),this.animationQueue=[],this},Le.followPath=function(de,Je){let rt={type:"followPath",parameters:Ze._validate(de,ei.followPath)};return Ze.extend(rt.parameters,{pathCurve:new U.CatmullRomCurve3(Ze.lnglatsToWorld(de.path)),start:Date.now(),expiration:Date.now()+rt.parameters.duration,cb:Je}),this.animationQueue.push(rt),tb.map.repaint=!0,this},Le._setObject=function(de){Le.setScale();let Je=de.position,rt=de.rotation,ai=de.scale,bi=de.worldCoordinates,Ai=de.quaternion,qt=de.translate,xi=de.worldTranslate;if(Je){this.coordinates=Je;let Tt=Ze.projectToWorld(Je);this.position.copy(Tt)}if(qt){this.coordinates=[this.coordinates[0]+qt[0],this.coordinates[1]+qt[1],this.coordinates[2]+qt[2]];let Tt=Ze.projectToWorld(qt);this.position.copy(Tt),de.position=this.coordinates}if(xi){this.translateX(xi.x),this.translateY(xi.y),this.translateZ(xi.z);let Tt=Ze.unprojectFromWorld(this.position);this.coordinates=de.position=Tt}if(rt&&(this.rotation.set(rt[0],rt[1],rt[2]),de.rotation=new U.Vector3(rt[0],rt[1],rt[2])),ai&&(this.scale.set(ai[0],ai[1],ai[2]),de.scale=this.scale),Ai&&(this.quaternion.setFromAxisAngle(Ai[0],Ai[1]),de.rotation=Ai[0].multiplyScalar(Ai[1])),bi){this.position.copy(bi);let Tt=Ze.unprojectFromWorld(bi);this.coordinates=de.position=Tt}this.setBoundingBoxShadowFloor(),this.setReceiveShadowFloor(),this.updateMatrixWorld(),tb.map.repaint=!0;let kt={type:"ObjectChanged",detail:{object:this,action:{position:de.position,rotation:de.rotation,scale:de.scale}}};this.dispatchEvent(kt)},Le.playDefault=function(de){if(Le.mixer&&Le.hasDefaultAnimation){let Je={start:Date.now(),expiration:Date.now()+de.duration,endState:{}};Ze.extend(de,Je),Le.mixer.timeScale=de.speed||1;let rt={type:"playDefault",parameters:de};return this.animationQueue.push(rt),tb.map.repaint=!0,this}},Le.playAnimation=function(de){Le.mixer&&(de.animation&&r(de.animation),Le.playDefault(de))},Le.pauseAllActions=function(){Le.mixer&&Le.actions.forEach(function(de){de.paused=!0})},Le.unPauseAllActions=function(){Le.mixer&&Le.actions.forEach(function(de){de.paused=!1})},Le.deactivateAllActions=function(){Le.mixer&&Le.actions.forEach(function(de){de.stop()})},Le.activateAllActions=function(){Le.mixer&&Le.actions.forEach(function(de){de.play()})},Le.idle=function(){return Le.mixer&&Le.mixer.update(.01),tb.map.repaint=!0,this}},update:function(Le){if(this.previousFrameTime===void 0&&(this.previousFrameTime=Le),!this.enrolledObjects)return!1;for(let r=this.enrolledObjects.length-1;r>=0;r--){let Ge=this.enrolledObjects[r];if(!(!Ge.animationQueue||Ge.animationQueue.length===0))for(let de=Ge.animationQueue.length-1;de>=0;de--){let Je=Ge.animationQueue[de];if(!Je)continue;let rt=Je.parameters;if(!rt.expiration){Ge.animationQueue.splice(de,1),Ge.animationQueue[de]&&(Ge.animationQueue[de].parameters.start=Le);return}if(Le>=rt.expiration)rt.expiration=!1,Je.type==="playDefault"?Ge.stop():(rt.endState&&Ge._setObject(rt.endState),typeof rt.cb<"u"&&rt.cb());else{let bi=(Le-rt.start)/rt.duration;if(Je.type==="set"){let Ai={};rt.pathCurve&&(Ai.worldCoordinates=rt.pathCurve.getPoint(bi)),rt.rotationPerMs&&(Ai.rotation=rt.startRotation.map(function(qt,xi){return qt+rt.rotationPerMs[xi]*bi*rt.duration})),rt.scalePerMs&&(Ai.scale=rt.startScale.map(function(qt,xi){return qt+rt.scalePerMs[xi]*bi*rt.duration})),Ge._setObject(Ai)}if(Je.type==="followPath"){let qt={worldCoordinates:rt.pathCurve.getPointAt(bi)};if(rt.trackHeading){let xi=rt.pathCurve.getTangentAt(bi).normalize(),kt=new U.Vector3(0,0,0),Tt=new U.Vector3(0,1,0);kt.crossVectors(Tt,xi).normalize();let ln=Math.acos(Tt.dot(xi));qt.quaternion=[kt,ln]}Ge._setObject(qt)}Je.type==="playDefault"&&(Ge.activateAllActions(),Ge.isPlaying=!0,Ge.animationMethod=requestAnimationFrame(this.update),Ge.mixer.update(Ge.clock.getDelta()),tb.map.repaint=!0)}}}this.previousFrameTime=Le}};const ei={followPath:{path:null,duration:1e3,trackHeading:!0}};En.exports=St}(uy)),uy.exports}var hy={exports:{}},Zv;function t_(){return Zv||(Zv=1,function(En,na){const U=Oc();(function(){class Ze extends U.Object3D{constructor(rt){super(),this.element=rt||document.createElement("div"),this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.alwaysVisible=!1,Object.defineProperty(this,"layer",{get(){return this.parent&&this.parent.parent?this.parent.parent.layer:null}}),this.dispose=function(){this.remove(),this.element=null},this.remove=function(){this.element instanceof Element&&this.element.parentNode!==null&&this.element.parentNode.removeChild(this.element)},this.addEventListener("removed",function(){this.remove()})}copy(rt,ai){return super.copy(rt,ai),this.element=rt.element.cloneNode(!0),this}}Ze.prototype.isCSS2DObject=!0;const St=new U.Vector3,ei=new U.Matrix4,Le=new U.Matrix4,r=new U.Vector3,Ge=new U.Vector3;class de{constructor(){const rt=this;let ai,bi,Ai,qt;const xi={objects:new WeakMap,list:new Map};this.cacheList=xi.list;const kt=document.createElement("div");kt.style.overflow="hidden",this.domElement=kt,this.getSize=function(){return{width:ai,height:bi}},this.render=function(ni,ci){ni.autoUpdate===!0&&ni.updateMatrixWorld(),ci.parent===null&&ci.updateMatrixWorld(),ei.copy(ci.matrixWorldInverse),Le.multiplyMatrices(ci.projectionMatrix,ei),Tt(ni,ni,ci),Dt(ni)},this.setSize=function(ni,ci){ai=ni,bi=ci,Ai=ai/2,qt=bi/2,kt.style.width=ni+"px",kt.style.height=ci+"px"};function Tt(ni,ci,Nn){if(ni.isCSS2DObject)if(!ni.visible)xi.objects.delete({key:ni.uuid}),xi.list.delete(ni.uuid),ni.remove();else{ni.onBeforeRender(rt,ci,Nn),St.setFromMatrixPosition(ni.matrixWorld),St.applyMatrix4(Le);const oi=ni.element;var Fi;/apple/i.test(navigator.vendor)?Fi="translate(-50%,-50%) translate("+Math.round(St.x*Ai+Ai)+"px,"+Math.round(-St.y*qt+qt)+"px)":Fi="translate(-50%,-50%) translate("+(St.x*Ai+Ai)+"px,"+(-St.y*qt+qt)+"px)",oi.style.WebkitTransform=Fi,oi.style.MozTransform=Fi,oi.style.oTransform=Fi,oi.style.transform=Fi,oi.style.display=ni.visible&&St.z>=-1&&St.z<=1?"":"none";const Ci={distanceToCameraSquared:ln(Nn,ni)};xi.objects.set({key:ni.uuid},Ci),xi.list.set(ni.uuid,ni),oi.parentNode!==kt&&kt.appendChild(oi),ni.onAfterRender(rt,ci,Nn)}for(let oi=0,Ci=ni.children.length;oi<Ci;oi++)Tt(ni.children[oi],ci,Nn)}function ln(ni,ci){return r.setFromMatrixPosition(ni.matrixWorld),Ge.setFromMatrixPosition(ci.matrixWorld),r.distanceToSquared(Ge)}function Xi(ni){const ci=[];return ni.traverse(function(Nn){Nn.isCSS2DObject&&ci.push(Nn)}),ci}function Dt(ni){const ci=Xi(ni).sort(function(Fi,oi){let Ci=xi.objects.get({key:Fi.uuid}),Zt=xi.objects.get({key:oi.uuid});if(Ci&&Zt){const Yt=Ci.distanceToCameraSquared,vi=Zt.distanceToCameraSquared;return Yt-vi}}),Nn=ci.length;for(let Fi=0,oi=ci.length;Fi<oi;Fi++)ci[Fi].element.style.zIndex=Nn-Fi}}}U.CSS2DObject=Ze,U.CSS2DRenderer=de})(),En.exports={CSS2DRenderer:U.CSS2DRenderer,CSS2DObject:U.CSS2DObject}}(hy)),hy.exports}var Xv;function Pp(){return Xv||(Xv=1,function(En,na){const U=Ld();e_();const Ze=Oc(),St=xb(),ei=t_();function Le(){}Le.prototype={line:function(r){r=U._validate(r,this._defaults.line);var Ge=U.lnglatsToWorld(r.geometry),de=U.normalizeVertices(Ge),Je=U.flattenVectors(de.vertices),rt=new Float32Array(Je),ai=new Ze.BufferGeometry;ai.setAttribute("position",new Ze.BufferAttribute(rt,3));var bi=new Ze.LineBasicMaterial({color:16711680,linewidth:21}),Ai=new Ze.Line(ai,bi);return Ai.options=options||{},Ai.position.copy(de.position),Ai},extrusion:function(r){},unenroll:function(r,Ge){var de=this;Ge||de.animationManager.unenroll(r)},_addMethods:function(r,Ge){var de=this;const Je="label",rt="tooltip",ai="help",bi="shadowPlane";if(!Ge){let kt=function(Zt,Yt,vi,ae){let ge=U.radify(ae);Zt.position.sub(Yt),Zt.position.applyAxisAngle(vi,ge),Zt.position.add(Yt),Zt.rotateOnAxis(vi,ge),tb.map.repaint=!0},Ci=function(Zt){return Math.pow(2,Zt)};var qt=kt,xi=Ci;r.coordinates||(r.coordinates=[0,0,0]),Object.defineProperty(r,"model",{get(){return r.getObjectByName("model")}}),Object.defineProperty(r,"animations",{get(){const Zt=r.model;return Zt?Zt.animations:null}}),de.animationManager.enroll(r),r.setCoords=function(Zt){return r.userData.topMargin&&r.userData.feature&&(Zt[2]+=((r.userData.feature.properties.height||0)-(r.userData.feature.properties.base_height||r.userData.feature.properties.min_height||0))*(r.userData.topMargin||0)),r.coordinates=Zt,r.set({position:Zt}),r},r.setTranslate=function(Zt){return r.set({translate:Zt}),r},r.setRotation=function(Zt){typeof Zt=="number"&&(Zt={z:Zt});var Yt={x:U.radify(Zt.x)||r.rotation.x,y:U.radify(Zt.y)||r.rotation.y,z:U.radify(Zt.z)||r.rotation.z};r._setObject({rotation:[Yt.x,Yt.y,Yt.z]})},r.calculateAdjustedPosition=function(Zt,Yt,vi){let ae=Zt.slice(),ge=U.unprojectFromWorld(r.modelSize);return vi?(ae[0]-=Yt.x!=0?ge[0]/Yt.x:0,ae[1]-=Yt.y!=0?ge[1]/Yt.y:0,ae[2]-=Yt.z!=0?ge[2]/Yt.z:0):(ae[0]+=Yt.x!=0?ge[0]/Yt.x:0,ae[1]+=Yt.y!=0?ge[1]/Yt.y:0,ae[2]+=Yt.z!=0?ge[2]/Yt.z:0),ae},r.setRotationAxis=function(Zt){typeof Zt=="number"&&(Zt={z:Zt});let Yt=r.modelBox(),vi=new Ze.Vector3(Yt.max.x,Yt.max.y,Yt.min.z);Zt.x!=0&&kt(r,vi,new Ze.Vector3(0,0,1),Zt.x),Zt.y!=0&&kt(r,vi,new Ze.Vector3(0,0,1),Zt.y),Zt.z!=0&&kt(r,vi,new Ze.Vector3(0,0,1),Zt.z)},Object.defineProperty(r,"scaleGroup",{get(){return r.getObjectByName("scaleGroup")}}),Object.defineProperty(r,"boxGroup",{get(){return r.getObjectByName("boxGroup")}}),Object.defineProperty(r,"boundingBox",{get(){return r.getObjectByName("boxModel")}}),Object.defineProperty(r,"boundingBoxShadow",{get(){return r.getObjectByName("boxShadow")}}),r.drawBoundingBox=function(){let Zt=r.box3(),Yt=new Ze.Group;Yt.name="boxGroup",Yt.updateMatrixWorld(!0);let vi=new Ze.Box3Helper(Zt,Le.prototype._defaults.colors.yellow);vi.name="boxModel",Yt.add(vi),vi.layers.disable(0);let ae=Zt.clone();ae.max.z=ae.min.z;let ge=new Ze.Box3Helper(ae,Le.prototype._defaults.colors.black);ge.name="boxShadow",Yt.add(ge),ge.layers.disable(0),Yt.visible=!1,r.scaleGroup.add(Yt),r.setBoundingBoxShadowFloor()},r.setBoundingBoxShadowFloor=function(){if(r.boundingBoxShadow){let Zt=-r.modelHeight,Yt=r.rotation,vi=r.boundingBoxShadow;vi.box.max.z=vi.box.min.z=Zt,vi.rotation.y=Yt.y,vi.rotation.x=-Yt.x}},r.setAnchor=function(Zt){const Yt=r.box3(),vi=Yt.getCenter(new Ze.Vector3);switch(r.none={x:0,y:0,z:0},r.center={x:vi.x,y:vi.y,z:Yt.min.z},r.bottom={x:vi.x,y:Yt.max.y,z:Yt.min.z},r.bottomLeft={x:Yt.max.x,y:Yt.max.y,z:Yt.min.z},r.bottomRight={x:Yt.min.x,y:Yt.max.y,z:Yt.min.z},r.top={x:vi.x,y:Yt.min.y,z:Yt.min.z},r.topLeft={x:Yt.max.x,y:Yt.min.y,z:Yt.min.z},r.topRight={x:Yt.min.x,y:Yt.min.y,z:Yt.min.z},r.left={x:Yt.max.x,y:vi.y,z:Yt.min.z},r.right={x:Yt.min.x,y:vi.y,z:Yt.min.z},Zt){case"center":r.anchor=r.center;break;case"top":r.anchor=r.top;break;case"top-left":r.anchor=r.topLeft;break;case"top-right":r.anchor=r.topRight;break;case"left":r.anchor=r.left;break;case"right":r.anchor=r.right;break;case"bottom":r.anchor=r.bottom;break;case"bottom-left":default:r.anchor=r.bottomLeft;break;case"bottom-right":r.anchor=r.bottomRight;break;case"auto":case"none":r.anchor=r.none}r.model.position.set(-r.anchor.x,-r.anchor.y,-r.anchor.z)},r.setCenter=function(Zt){if(Zt&&(Zt.x!=0||Zt.y!=0||Zt.z!=0)){let Yt=r.getSize();r.anchor={x:r.anchor.x-Yt.x*Zt.x,y:r.anchor.y-Yt.y*Zt.y,z:r.anchor.z-Yt.z*Zt.z},r.model.position.set(-r.anchor.x,-r.anchor.y,-r.anchor.z)}},Object.defineProperty(r,"label",{get(){return r.getObjectByName(Je)}}),Object.defineProperty(r,"tooltip",{get(){return r.getObjectByName(rt)}}),Object.defineProperty(r,"help",{get(){return r.getObjectByName(ai)}});let Tt=!1;Object.defineProperty(r,"hidden",{get(){return Tt},set(Zt){Tt!=Zt&&(Tt=Zt,r.visibility=!Tt)}}),Object.defineProperty(r,"visibility",{get(){return r.visible},set(Zt){let Yt=Zt;if(Zt=="visible"||Zt==!0)Yt=!0,r.label&&(r.label.visible=Yt);else if(Zt=="none"||Zt==!1)Yt=!1,r.label&&r.label.alwaysVisible&&(r.label.visible=Yt),r.tooltip&&(r.tooltip.visible=Yt);else return;if(r.visible!=Yt){if(r.hidden&&Yt)return;r.visible=Yt,r.model&&r.model.traverse(function(vi){(vi.type=="Mesh"||vi.type=="SkinnedMesh")&&(Yt&&r.raycasted?vi.layers.enable(0):vi.layers.disable(0)),vi.type=="LineSegments"&&vi.layers.disableAll()})}}}),r.addLabel=function(Zt,Yt,vi,ae){Zt&&r.drawLabelHTML(Zt,Yt,vi,ae)},r.removeLabel=function(){r.removeCSS2D(Je)},r.drawLabelHTML=function(Zt,Yt=!1,vi=r.anchor,ae=.5){let ge=de.drawLabelHTML(Zt,Le.prototype._defaults.label.cssClass),Te=r.addCSS2D(ge,Je,vi,ae);return Te.alwaysVisible=Yt,Te.visible=Yt,Te},r.addTooltip=function(Zt,Yt,vi,ae=!0,ge=1){let Te=r.addHelp(Zt,rt,Yt,vi,ge);Te.visible=!1,Te.custom=ae},r.removeTooltip=function(){r.removeCSS2D(rt)},r.addHelp=function(Zt,Yt=ai,vi=!1,ae=r.anchor,ge=0){let Te=de.drawTooltip(Zt,vi),Re=r.addCSS2D(Te,Yt,ae,ge);return Re.visible=!0,Re},r.removeHelp=function(){r.removeCSS2D(ai)},r.addCSS2D=function(Zt,Yt,vi=r.anchor,ae=1){if(Zt){const ge=r.box3(),Te=ge.getSize(new Ze.Vector3);let Re={x:ge.max.x,y:ge.max.y,z:ge.min.z};r.removeCSS2D(Yt);let ze=new ei.CSS2DObject(Zt);return ze.name=Yt,ze.position.set(-Te.x*.5-r.model.position.x-vi.x+Re.x,-Te.y*.5-r.model.position.y-vi.y+Re.y,Te.z*ae),ze.visible=!1,r.scaleGroup.add(ze),ze}},r.removeCSS2D=function(Zt){let Yt=r.getObjectByName(Zt);if(Yt){Yt.dispose();let vi=r.scaleGroup.children;vi.splice(vi.indexOf(Yt),1)}},Object.defineProperty(r,"shadowPlane",{get(){return r.getObjectByName(bi)}});let ln=!1;Object.defineProperty(r,"castShadow",{get(){return ln},set(Zt){if(!(!r.model||ln===Zt)){if(r.model.traverse(function(Yt){Yt.isMesh&&(Yt.castShadow=!0)}),Zt){const Yt=r.modelSize,vi=[Yt.x,Yt.y,Yt.z,r.modelHeight],ae=Math.max(...vi)*10,ge=new Ze.PlaneBufferGeometry(ae,ae),Te=new Ze.ShadowMaterial;Te.opacity=.5;let Re=new Ze.Mesh(ge,Te);Re.name=bi,Re.layers.enable(1),Re.layers.disable(0),Re.receiveShadow=Zt,r.add(Re)}else r.traverse(function(Yt){Yt.isMesh&&Yt.material instanceof Ze.ShadowMaterial&&r.remove(Yt)});ln=Zt}}}),r.setReceiveShadowFloor=function(){if(r.castShadow){let Zt=r.shadowPlane,Yt=Zt.position,vi=Zt.rotation;if(Yt.z=-r.modelHeight,vi.y=r.rotation.y,vi.x=-r.rotation.x,r.userData.units==="meters"){const ae=r.modelSize,ge=[ae.x,ae.y,ae.z,-Yt.z],Re=Math.max(...ge)*10/Zt.geometry.parameters.width;Zt.scale.set(Re,Re,Re)}}};let Xi=!1;Object.defineProperty(r,"receiveShadow",{get(){return Xi},set(Zt){!r.model||Xi===Zt||(r.model.traverse(function(Yt){Yt.isMesh&&(Yt.receiveShadow=!0)}),Xi=Zt)}});let Dt=!1;Object.defineProperty(r,"wireframe",{get(){return Dt},set(Zt){!r.model||Dt===Zt||(r.model.traverse(function(Yt){if(Yt.type=="Mesh"||Yt.type=="SkinnedMesh"){let vi=[];Array.isArray(Yt.material)?vi=Yt.material:vi.push(Yt.material);let ae=vi[0];Zt?(Yt.userData.materials=ae,Yt.material=ae.clone(),Yt.material.wireframe=Yt.material.transparent=Zt,Yt.material.opacity=.3):(Yt.material.dispose(),Yt.material=Yt.userData.materials,Yt.userData.materials.dispose(),Yt.userData.materials=null),Zt?(Yt.layers.disable(0),Yt.layers.enable(1)):(Yt.layers.disable(1),Yt.layers.enable(0))}Yt.type=="LineSegments"&&Yt.layers.disableAll()}),Dt=Zt,r.dispatchEvent({type:"Wireframed",detail:r}))}});let ni=null;Object.defineProperty(r,"color",{get(){return ni},set(Zt){!r.model||ni===Zt||(r.model.traverse(function(Yt){if(Yt.type=="Mesh"||Yt.type=="SkinnedMesh"){let vi=[];Array.isArray(Yt.material)?vi=Yt.material:vi.push(Yt.material);let ae=vi[0];Zt?(Yt.userData.materials=ae,Yt.material=new Ze.MeshStandardMaterial,Yt.material.color.setHex(Zt)):(Yt.material.dispose(),Yt.material=Yt.userData.materials,Yt.userData.materials.dispose(),Yt.userData.materials=null)}}),ni=Zt)}});let ci=!1;Object.defineProperty(r,"selected",{get(){return ci},set(Zt){Zt?(r.userData.bbox&&!r.boundingBox&&r.drawBoundingBox(),r.boxGroup&&(r.boundingBox.material=Le.prototype._defaults.materials.boxSelectedMaterial,r.boundingBox.parent.visible=!0,r.boundingBox.layers.enable(1),r.boundingBoxShadow.layers.enable(1)),r.label&&!r.label.alwaysVisible&&(r.label.visible=!0)):(r.boxGroup&&r.remove(r.boxGroup),r.label&&!r.label.alwaysVisible&&(r.label.visible=!1),r.removeHelp()),r.tooltip&&(r.tooltip.visible=Zt),ci!=Zt&&(ci=Zt,r.dispatchEvent({type:"SelectedChange",detail:r}))}});let Nn=!0;Object.defineProperty(r,"raycasted",{get(){return Nn},set(Zt){!r.model||Nn===Zt||(r.model.traverse(function(Yt){(Yt.type=="Mesh"||Yt.type=="SkinnedMesh")&&(Zt?(Yt.layers.disable(1),Yt.layers.enable(0)):(Yt.layers.disable(0),Yt.layers.enable(1)))}),Nn=Zt)}});let Fi=!1;Object.defineProperty(r,"over",{get(){return Fi},set(Zt){Zt?(r.selected||(r.userData.bbox&&!r.boundingBox&&r.drawBoundingBox(),r.userData.tooltip&&!r.tooltip&&r.addTooltip(r.uuid,!0,r.anchor,!1),r.boxGroup&&(r.boundingBox.material=Le.prototype._defaults.materials.boxOverMaterial,r.boundingBox.parent.visible=!0,r.boundingBox.layers.enable(1),r.boundingBoxShadow.layers.enable(1))),r.label&&!r.label.alwaysVisible&&(r.label.visible=!0),r.dispatchEvent({type:"ObjectMouseOver",detail:r})):(r.selected||(r.boxGroup&&(r.remove(r.boxGroup),r.tooltip&&!r.tooltip.custom&&r.removeTooltip()),r.label&&!r.label.alwaysVisible&&(r.label.visible=!1)),r.dispatchEvent({type:"ObjectMouseOut",detail:r})),r.tooltip&&(r.tooltip.visible=Zt||r.selected),Fi=Zt}}),r.box3=function(){r.updateMatrix(),r.updateMatrixWorld(!0,!0);let Zt;if(r.model){let Yt=r.clone(!0),vi=r.model.clone();if(Zt=new Ze.Box3().setFromObject(vi),r.parent){let ae=new Ze.Matrix4,ge=new Ze.Matrix4;r.matrix.extractRotation(ae),ge.copy(ae).invert(),Yt.setRotationFromMatrix(ge),Zt=new Ze.Box3().setFromObject(vi)}}return Zt},r.modelBox=function(){return r.box3()},r.getSize=function(){return r.box3().getSize(new Ze.Vector3(0,0,0))};let oi=!1;Object.defineProperty(r,"modelSize",{get(){return oi=r.getSize(),oi},set(Zt){oi!=Zt&&(oi=Zt)}}),Object.defineProperty(r,"modelHeight",{get(){let Zt=r.coordinates[2]||0;return r.userData.units==="scene"&&(Zt*=r.unitsPerMeter/r.scale.x),Zt}}),Object.defineProperty(r,"unitsPerMeter",{get(){return Number(U.projectedUnitsPerMeter(r.coordinates[1]).toFixed(7))}}),Object.defineProperty(r,"fixedZoom",{get(){return r.userData.fixedZoom},set(Zt){r.userData.fixedZoom!==Zt&&(r.userData.fixedZoom=Zt,r.userData.units=Zt?"scene":"meters")}}),r.setFixedZoom=function(Zt){if(r.fixedZoom!=null&&r.fixedZoom!=0){Zt||(Zt=r.userData.mapScale);let Yt=Ci(r.fixedZoom);if(Yt>Zt){let vi=Yt/Zt;r.scale.set(vi,vi,vi)}else r.scale.set(1,1,1)}},r.setScale=function(Zt){if(r.userData.units!="scene"){let Yt=r.unitsPerMeter;r.scale.set(Yt,Yt,Yt)}else r.fixedZoom?(Zt&&(r.userData.mapScale=Zt),r.setFixedZoom(r.userData.mapScale)):r.scale.set(1,1,1)},r.setObjectScale=function(Zt){r.setScale(Zt),r.setBoundingBoxShadowFloor(),r.setReceiveShadowFloor()}}r.add=function(kt){return r.scaleGroup.add(kt),kt.position.z=r.coordinates[2]?-r.coordinates[2]:0,kt},r.remove=function(kt){kt&&(kt.traverse(Tt=>{if(Tt.geometry&&Tt.geometry.dispose(),Tt.material)if(Tt.material.isMaterial)Ai(Tt.material);else for(const ln of Tt.material)Ai(ln);Tt.dispose&&Tt.dispose()}),r.scaleGroup.remove(kt),tb.map.repaint=!0)},r.duplicate=function(kt){let Tt=r.clone(!0);if(Tt.getObjectByName("model").animations=r.animations,Tt.userData.feature&&(kt&&kt.feature&&(Tt.userData.feature=kt.feature),Tt.userData.feature.properties.uuid=Tt.uuid),de._addMethods(Tt),!kt||U.equal(kt.scale,r.userData.scale))return Tt.copyAnchor(r),Tt;{Tt.userData=kt,Tt.userData.isGeoGroup=!0,Tt.remove(Tt.boxGroup);const ln=U.types.rotation(kt.rotation,[0,0,0]),Xi=U.types.scale(kt.scale,[1,1,1]);return Tt.model.position.set(0,0,0),Tt.model.rotation.set(ln[0],ln[1],ln[2]),Tt.model.scale.set(Xi[0],Xi[1],Xi[2]),Tt.setAnchor(kt.anchor),Tt.setCenter(kt.adjustment),Tt}},r.copyAnchor=function(kt){r.anchor=kt.anchor,r.none={x:0,y:0,z:0},r.center=kt.center,r.bottom=kt.bottom,r.bottomLeft=kt.bottomLeft,r.bottomRight=kt.bottomRight,r.top=kt.top,r.topLeft=kt.topLeft,r.topRight=kt.topRight,r.left=kt.left,r.right=kt.right},r.dispose=function(){Le.prototype.unenroll(r),r.traverse(kt=>{if(!(kt.parent&&kt.parent.name=="world")&&kt.name!=="threeboxObject"){if(kt.geometry&&kt.geometry.dispose(),kt.material)if(kt.material.isMaterial)Ai(kt.material);else for(const Tt of kt.material)Ai(Tt);kt.dispose&&kt.dispose()}}),r.children=[]};const Ai=kt=>{kt.dispose();for(const Xi of Object.keys(kt)){const Dt=kt[Xi];Dt&&typeof Dt=="object"&&"minFilter"in Dt&&Dt.dispose()}let Tt=kt;(Tt.map||Tt.alphaMap||Tt.aoMap||Tt.bumpMap||Tt.displacementMap||Tt.emissiveMap||Tt.envMap||Tt.lightMap||Tt.metalnessMap||Tt.normalMap||Tt.roughnessMap)&&(Tt.map&&Tt.map.dispose(),Tt.alphaMap&&Tt.alphaMap.dispose(),Tt.aoMap&&Tt.aoMap.dispose(),Tt.bumpMap&&Tt.bumpMap.dispose(),Tt.displacementMap&&Tt.displacementMap.dispose(),Tt.emissiveMap&&Tt.emissiveMap.dispose(),Tt.envMap&&Tt.envMap.dispose(),Tt.lightMap&&Tt.lightMap.dispose(),Tt.metalnessMap&&Tt.metalnessMap.dispose(),Tt.normalMap&&Tt.normalMap.dispose(),Tt.roughnessMap&&Tt.roughnessMap.dispose())};return r},_makeGroup:function(r,Ge){let de=new Ze.Group;de.name="scaleGroup",de.add(r);var Je=new Ze.Group;Je.userData=Ge||{},Je.userData.isGeoGroup=!0,Je.userData.feature&&(Je.userData.feature.properties.uuid=Je.uuid);var rt=de.length;if(rt)for(o of de)Je.add(o);else Je.add(de);return Je.name="threeboxObject",Je},animationManager:new St,drawTooltip:function(r,Ge=!1){if(r){let de;if(Ge){let Je=document.createElement("div");Je.className="mapboxgl-popup-content";let rt=document.createElement("strong");rt.innerHTML=r,Je.appendChild(rt);let ai=document.createElement("div");ai.className="mapboxgl-popup-tip";let bi=document.createElement("div");bi.className="marker mapboxgl-popup-anchor-bottom",bi.appendChild(ai),bi.appendChild(Je),de=document.createElement("div"),de.className+="label3D",de.appendChild(bi)}else de=document.createElement("span"),de.className=this._defaults.tooltip.cssClass,de.innerHTML=r;return de}},drawLabelHTML:function(r,Ge){let de=document.createElement("div");return de.className+=Ge,typeof r=="string"?de.innerHTML=r:de.innerHTML=r.outerHTML,de},_defaults:{colors:{red:new Ze.Color(16711680),yellow:new Ze.Color(16776960),green:new Ze.Color(65280),black:new Ze.Color(0)},materials:{boxNormalMaterial:new Ze.LineBasicMaterial({color:new Ze.Color(16711680)}),boxOverMaterial:new Ze.LineBasicMaterial({color:new Ze.Color(16776960)}),boxSelectedMaterial:new Ze.LineBasicMaterial({color:new Ze.Color(65280)})},line:{geometry:null,color:"black",width:1,opacity:1},label:{htmlElement:null,cssClass:" label3D",alwaysVisible:!1,topMargin:-.5},tooltip:{text:"",cssClass:"toolTip text-xs",mapboxStyle:!1,topMargin:0},sphere:{position:[0,0,0],radius:1,sides:20,units:"scene",material:"MeshBasicMaterial",anchor:"bottom-left",bbox:!0,tooltip:!0,raycasted:!0},tube:{geometry:null,radius:1,sides:6,units:"scene",material:"MeshBasicMaterial",anchor:"center",bbox:!0,tooltip:!0,raycasted:!0},loadObj:{type:null,obj:null,units:"scene",scale:1,rotation:0,defaultAnimation:0,anchor:"bottom-left",bbox:!0,tooltip:!0,raycasted:!0,clone:!0},Object3D:{obj:null,units:"scene",anchor:"bottom-left",bbox:!0,tooltip:!0,raycasted:!0},extrusion:{coordinates:[[[]]],geometryOptions:{},height:100,materials:new Ze.MeshPhongMaterial({color:6684672,side:Ze.DoubleSide}),scale:1,rotation:0,units:"scene",anchor:"center",bbox:!0,tooltip:!0,raycasted:!0}},geometries:{line:["LineString"],tube:["LineString"],sphere:["Point"]}},En.exports=Le}(ly)),ly.exports}var dy={exports:{}},fy={exports:{}},Yv;function i_(){return Yv||(Yv=1,function(En,na){const U=Pp(),Ze=Ld();function St(ei){ei=Ze._validate(ei,U.prototype._defaults.Object3D);let Le=ei.obj;const r=Ze.types.rotation(ei.rotation,[0,0,0]),Ge=Ze.types.scale(ei.scale,[1,1,1]);Le.rotation.set(r[0],r[1],r[2]),Le.scale.set(Ge[0],Ge[1],Ge[2]),Le.name="model";let de=U.prototype._makeGroup(Le,ei);return ei.obj.name="model",U.prototype._addMethods(de),de.setAnchor(ei.anchor),de.setCenter(ei.adjustment),de.raycasted=ei.raycasted,de.visibility=!0,de}En.exports=St}(fy)),fy.exports}var $v;function bb(){return $v||($v=1,function(En,na){const U=Ld(),Ze=e_(),St=Oc(),ei=Pp(),Le=i_();function r(Ge){Ge=U._validate(Ge,ei.prototype._defaults.sphere);let de=new St.SphereBufferGeometry(Ge.radius,Ge.sides,Ge.sides),Je=Ze(Ge),rt=new St.Mesh(de,Je);return new Le({obj:rt,units:Ge.units,anchor:Ge.anchor,adjustment:Ge.adjustment,bbox:Ge.bbox,tooltip:Ge.tooltip,raycasted:Ge.raycasted})}En.exports=r}(dy)),dy.exports}var py={exports:{}},Kv;function wb(){return Kv||(Kv=1,function(En,na){const U=Pp(),Ze=Ld(),St=Oc(),ei=i_();function Le(r){r=Ze._validate(r,U.prototype._defaults.extrusion);let Ge=Le.prototype.buildShape(r.coordinates),de=Le.prototype.buildGeometry(Ge,r.geometryOptions),Je=new St.Mesh(de,r.materials);return r.obj=Je,new ei(r)}Le.prototype={buildShape:function(r){if(r[0]instanceof(St.Vector2||St.Vector3))return new St.Shape(r);let Ge=new St.Shape;for(let de=0;de<r.length;de++)de===0?Ge=new St.Shape(this.buildPoints(r[0],r[0])):Ge.holes.push(new St.Path(this.buildPoints(r[de],r[0])));return Ge},buildPoints:function(r,Ge){const de=[];let Je=Ze.projectToWorld([Ge[0][0],Ge[0][1],0]);for(let rt=0;rt<r.length;rt++){let ai=Ze.projectToWorld([r[rt][0],r[rt][1],0]);de.push(new St.Vector2(Ze.toDecimal(ai.x-Je.x,9),Ze.toDecimal(ai.y-Je.y,9)))}return de},buildGeometry:function(r,Ge){let de=new St.ExtrudeBufferGeometry(r,Ge);return de.computeBoundingBox(),de}},En.exports=Le}(py)),py.exports}var my={exports:{}},Jv;function Mb(){return Jv||(Jv=1,function(En,na){const U=Ld(),Ze=Pp(),St=t_();function ei(Le){Le=U._validate(Le,Ze.prototype._defaults.label);let r=Ze.prototype.drawLabelHTML(Le.htmlElement,Le.cssClass),Ge=new St.CSS2DObject(r);Ge.name="label",Ge.visible=Le.alwaysVisible,Ge.alwaysVisible=Le.alwaysVisible;var de=Ze.prototype._makeGroup(Ge,Le);return Ze.prototype._addMethods(de),de.visibility=Le.alwaysVisible,de}En.exports=ei}(my)),my.exports}var gy={exports:{}},Qv;function Tb(){return Qv||(Qv=1,function(En,na){const U=Ld(),Ze=Pp(),St=t_();Oc();function ei(Le){if(Le=U._validate(Le,Ze.prototype._defaults.tooltip),Le.text){let Ge=Ze.prototype.drawTooltip(Le.text,Le.mapboxStyle),de=new St.CSS2DObject(Ge);de.visible=!1,de.name="tooltip";var r=Ze.prototype._makeGroup(de,Le);return Ze.prototype._addMethods(r),r}}En.exports=ei}(gy)),gy.exports}var _y={exports:{}},yy={exports:{}},ex;function Sb(){return ex||(ex=1,function(En,na){const U=Oc();(function(){const Ze=/^[og]\s*(.+)?/,St=/^mtllib /,ei=/^usemtl /,Le=/^usemap /,r=new U.Vector3,Ge=new U.Vector3,de=new U.Vector3,Je=new U.Vector3,rt=new U.Vector3;function ai(){const Ai={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(qt,xi){if(this.object&&this.object.fromDeclaration===!1){this.object.name=qt,this.object.fromDeclaration=xi!==!1;return}const kt=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:qt||"",fromDeclaration:xi!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(Tt,ln){const Xi=this._finalize(!1);Xi&&(Xi.inherited||Xi.groupCount<=0)&&this.materials.splice(Xi.index,1);const Dt={index:this.materials.length,name:Tt||"",mtllib:Array.isArray(ln)&&ln.length>0?ln[ln.length-1]:"",smooth:Xi!==void 0?Xi.smooth:this.smooth,groupStart:Xi!==void 0?Xi.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(ni){const ci={index:typeof ni=="number"?ni:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return ci.clone=this.clone.bind(ci),ci}};return this.materials.push(Dt),Dt},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(Tt){const ln=this.currentMaterial();if(ln&&ln.groupEnd===-1&&(ln.groupEnd=this.geometry.vertices.length/3,ln.groupCount=ln.groupEnd-ln.groupStart,ln.inherited=!1),Tt&&this.materials.length>1)for(let Xi=this.materials.length-1;Xi>=0;Xi--)this.materials[Xi].groupCount<=0&&this.materials.splice(Xi,1);return Tt&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),ln}},kt&&kt.name&&typeof kt.clone=="function"){const Tt=kt.clone(0);Tt.inherited=!0,this.object.materials.push(Tt)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(qt,xi){const kt=parseInt(qt,10);return(kt>=0?kt-1:kt+xi/3)*3},parseNormalIndex:function(qt,xi){const kt=parseInt(qt,10);return(kt>=0?kt-1:kt+xi/3)*3},parseUVIndex:function(qt,xi){const kt=parseInt(qt,10);return(kt>=0?kt-1:kt+xi/2)*2},addVertex:function(qt,xi,kt){const Tt=this.vertices,ln=this.object.geometry.vertices;ln.push(Tt[qt+0],Tt[qt+1],Tt[qt+2]),ln.push(Tt[xi+0],Tt[xi+1],Tt[xi+2]),ln.push(Tt[kt+0],Tt[kt+1],Tt[kt+2])},addVertexPoint:function(qt){const xi=this.vertices;this.object.geometry.vertices.push(xi[qt+0],xi[qt+1],xi[qt+2])},addVertexLine:function(qt){const xi=this.vertices;this.object.geometry.vertices.push(xi[qt+0],xi[qt+1],xi[qt+2])},addNormal:function(qt,xi,kt){const Tt=this.normals,ln=this.object.geometry.normals;ln.push(Tt[qt+0],Tt[qt+1],Tt[qt+2]),ln.push(Tt[xi+0],Tt[xi+1],Tt[xi+2]),ln.push(Tt[kt+0],Tt[kt+1],Tt[kt+2])},addFaceNormal:function(qt,xi,kt){const Tt=this.vertices,ln=this.object.geometry.normals;r.fromArray(Tt,qt),Ge.fromArray(Tt,xi),de.fromArray(Tt,kt),rt.subVectors(de,Ge),Je.subVectors(r,Ge),rt.cross(Je),rt.normalize(),ln.push(rt.x,rt.y,rt.z),ln.push(rt.x,rt.y,rt.z),ln.push(rt.x,rt.y,rt.z)},addColor:function(qt,xi,kt){const Tt=this.colors,ln=this.object.geometry.colors;Tt[qt]!==void 0&&ln.push(Tt[qt+0],Tt[qt+1],Tt[qt+2]),Tt[xi]!==void 0&&ln.push(Tt[xi+0],Tt[xi+1],Tt[xi+2]),Tt[kt]!==void 0&&ln.push(Tt[kt+0],Tt[kt+1],Tt[kt+2])},addUV:function(qt,xi,kt){const Tt=this.uvs,ln=this.object.geometry.uvs;ln.push(Tt[qt+0],Tt[qt+1]),ln.push(Tt[xi+0],Tt[xi+1]),ln.push(Tt[kt+0],Tt[kt+1])},addDefaultUV:function(){const qt=this.object.geometry.uvs;qt.push(0,0),qt.push(0,0),qt.push(0,0)},addUVLine:function(qt){const xi=this.uvs;this.object.geometry.uvs.push(xi[qt+0],xi[qt+1])},addFace:function(qt,xi,kt,Tt,ln,Xi,Dt,ni,ci){const Nn=this.vertices.length;let Fi=this.parseVertexIndex(qt,Nn),oi=this.parseVertexIndex(xi,Nn),Ci=this.parseVertexIndex(kt,Nn);if(this.addVertex(Fi,oi,Ci),this.addColor(Fi,oi,Ci),Dt!==void 0&&Dt!==""){const Zt=this.normals.length;Fi=this.parseNormalIndex(Dt,Zt),oi=this.parseNormalIndex(ni,Zt),Ci=this.parseNormalIndex(ci,Zt),this.addNormal(Fi,oi,Ci)}else this.addFaceNormal(Fi,oi,Ci);if(Tt!==void 0&&Tt!==""){const Zt=this.uvs.length;Fi=this.parseUVIndex(Tt,Zt),oi=this.parseUVIndex(ln,Zt),Ci=this.parseUVIndex(Xi,Zt),this.addUV(Fi,oi,Ci),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(qt){this.object.geometry.type="Points";const xi=this.vertices.length;for(let kt=0,Tt=qt.length;kt<Tt;kt++){const ln=this.parseVertexIndex(qt[kt],xi);this.addVertexPoint(ln),this.addColor(ln)}},addLineGeometry:function(qt,xi){this.object.geometry.type="Line";const kt=this.vertices.length,Tt=this.uvs.length;for(let ln=0,Xi=qt.length;ln<Xi;ln++)this.addVertexLine(this.parseVertexIndex(qt[ln],kt));for(let ln=0,Xi=xi.length;ln<Xi;ln++)this.addUVLine(this.parseUVIndex(xi[ln],Tt))}};return Ai.startObject("",!1),Ai}class bi extends U.Loader{constructor(qt){super(qt),this.materials=null}load(qt,xi,kt,Tt){const ln=this,Xi=new U.FileLoader(this.manager);Xi.setPath(this.path),Xi.setRequestHeader(this.requestHeader),Xi.setWithCredentials(this.withCredentials),Xi.load(qt,function(Dt){try{xi(ln.parse(Dt))}catch(ni){Tt?Tt(ni):console.error(ni),ln.manager.itemError(qt)}},kt,Tt)}setMaterials(qt){return this.materials=qt,this}parse(qt){const xi=new ai;qt.indexOf(`\r
`)!==-1&&(qt=qt.replace(/\r\n/g,`
`)),qt.indexOf(`\\
`)!==-1&&(qt=qt.replace(/\\\n/g,""));const kt=qt.split(`
`);let Tt="",ln="",Xi=0,Dt=[];const ni=typeof"".trimLeft=="function";for(let Fi=0,oi=kt.length;Fi<oi;Fi++)if(Tt=kt[Fi],Tt=ni?Tt.trimLeft():Tt.trim(),Xi=Tt.length,Xi!==0&&(ln=Tt.charAt(0),ln!=="#"))if(ln==="v"){const Ci=Tt.split(/\s+/);switch(Ci[0]){case"v":xi.vertices.push(parseFloat(Ci[1]),parseFloat(Ci[2]),parseFloat(Ci[3])),Ci.length>=7?xi.colors.push(parseFloat(Ci[4]),parseFloat(Ci[5]),parseFloat(Ci[6])):xi.colors.push(void 0,void 0,void 0);break;case"vn":xi.normals.push(parseFloat(Ci[1]),parseFloat(Ci[2]),parseFloat(Ci[3]));break;case"vt":xi.uvs.push(parseFloat(Ci[1]),parseFloat(Ci[2]));break}}else if(ln==="f"){const Zt=Tt.substr(1).trim().split(/\s+/),Yt=[];for(let ae=0,ge=Zt.length;ae<ge;ae++){const Te=Zt[ae];if(Te.length>0){const Re=Te.split("/");Yt.push(Re)}}const vi=Yt[0];for(let ae=1,ge=Yt.length-1;ae<ge;ae++){const Te=Yt[ae],Re=Yt[ae+1];xi.addFace(vi[0],Te[0],Re[0],vi[1],Te[1],Re[1],vi[2],Te[2],Re[2])}}else if(ln==="l"){const Ci=Tt.substring(1).trim().split(" ");let Zt=[];const Yt=[];if(Tt.indexOf("/")===-1)Zt=Ci;else for(let vi=0,ae=Ci.length;vi<ae;vi++){const ge=Ci[vi].split("/");ge[0]!==""&&Zt.push(ge[0]),ge[1]!==""&&Yt.push(ge[1])}xi.addLineGeometry(Zt,Yt)}else if(ln==="p"){const Zt=Tt.substr(1).trim().split(" ");xi.addPointGeometry(Zt)}else if((Dt=Ze.exec(Tt))!==null){const Ci=(" "+Dt[0].substr(1).trim()).substr(1);xi.startObject(Ci)}else if(ei.test(Tt))xi.object.startMaterial(Tt.substring(7).trim(),xi.materialLibraries);else if(St.test(Tt))xi.materialLibraries.push(Tt.substring(7).trim());else if(Le.test(Tt))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(ln==="s"){if(Dt=Tt.split(" "),Dt.length>1){const Zt=Dt[1].trim().toLowerCase();xi.object.smooth=Zt!=="0"&&Zt!=="off"}else xi.object.smooth=!0;const Ci=xi.object.currentMaterial();Ci&&(Ci.smooth=xi.object.smooth)}else{if(Tt==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+Tt+'"')}xi.finalize();const ci=new U.Group;if(ci.materialLibraries=[].concat(xi.materialLibraries),!(xi.objects.length===1&&xi.objects[0].geometry.vertices.length===0)===!0)for(let Fi=0,oi=xi.objects.length;Fi<oi;Fi++){const Ci=xi.objects[Fi],Zt=Ci.geometry,Yt=Ci.materials,vi=Zt.type==="Line",ae=Zt.type==="Points";let ge=!1;if(Zt.vertices.length===0)continue;const Te=new U.BufferGeometry;Te.setAttribute("position",new U.Float32BufferAttribute(Zt.vertices,3)),Zt.normals.length>0&&Te.setAttribute("normal",new U.Float32BufferAttribute(Zt.normals,3)),Zt.colors.length>0&&(ge=!0,Te.setAttribute("color",new U.Float32BufferAttribute(Zt.colors,3))),Zt.hasUVIndices===!0&&Te.setAttribute("uv",new U.Float32BufferAttribute(Zt.uvs,2));const Re=[];for(let Ie=0,it=Yt.length;Ie<it;Ie++){const vt=Yt[Ie],bt=vt.name+"_"+vt.smooth+"_"+ge;let pt=xi.materials[bt];if(this.materials!==null){if(pt=this.materials.create(vt.name),vi&&pt&&!(pt instanceof U.LineBasicMaterial)){const ti=new U.LineBasicMaterial;U.Material.prototype.copy.call(ti,pt),ti.color.copy(pt.color),pt=ti}else if(ae&&pt&&!(pt instanceof U.PointsMaterial)){const ti=new U.PointsMaterial({size:10,sizeAttenuation:!1});U.Material.prototype.copy.call(ti,pt),ti.color.copy(pt.color),ti.map=pt.map,pt=ti}}pt===void 0&&(vi?pt=new U.LineBasicMaterial:ae?pt=new U.PointsMaterial({size:1,sizeAttenuation:!1}):pt=new U.MeshPhongMaterial,pt.name=vt.name,pt.flatShading=!vt.smooth,pt.vertexColors=ge,xi.materials[bt]=pt),Re.push(pt)}let ze;if(Re.length>1){for(let Ie=0,it=Yt.length;Ie<it;Ie++){const vt=Yt[Ie];Te.addGroup(vt.groupStart,vt.groupCount,Ie)}vi?ze=new U.LineSegments(Te,Re):ae?ze=new U.Points(Te,Re):ze=new U.Mesh(Te,Re)}else vi?ze=new U.LineSegments(Te,Re[0]):ae?ze=new U.Points(Te,Re[0]):ze=new U.Mesh(Te,Re[0]);ze.name=Ci.name,ci.add(ze)}else if(xi.vertices.length>0){const Fi=new U.PointsMaterial({size:1,sizeAttenuation:!1}),oi=new U.BufferGeometry;oi.setAttribute("position",new U.Float32BufferAttribute(xi.vertices,3)),xi.colors.length>0&&xi.colors[0]!==void 0&&(oi.setAttribute("color",new U.Float32BufferAttribute(xi.colors,3)),Fi.vertexColors=!0);const Ci=new U.Points(oi,Fi);ci.add(Ci)}return ci}}U.OBJLoader=bi})(),En.exports=U.OBJLoader}(yy)),yy.exports}var vy={exports:{}},tx;function Eb(){return tx||(tx=1,function(En,na){const U=Oc();(function(){class Ze extends U.Loader{constructor(Le){super(Le)}load(Le,r,Ge,de){const Je=this,rt=this.path===""?U.LoaderUtils.extractUrlBase(Le||""):this.path,ai=new U.FileLoader(this.manager);ai.setPath(this.path),ai.setRequestHeader(this.requestHeader),ai.setWithCredentials(this.withCredentials),ai.load(Le,function(bi){try{r(Je.parse(bi,rt))}catch(Ai){de?de(Ai):console.error(Ai),Je.manager.itemError(Le)}},Ge,de)}setMaterialOptions(Le){return this.materialOptions=Le,this}parse(Le,r){const Ge=Le.split(`
`);let de={};const Je=/\s+/,rt={};for(let bi=0;bi<Ge.length;bi++){let Ai=Ge[bi];if(Ai=Ai.trim(),Ai.length===0||Ai.charAt(0)==="#")continue;const qt=Ai.indexOf(" ");let xi=qt>=0?Ai.substring(0,qt):Ai;xi=xi.toLowerCase();let kt=qt>=0?Ai.substring(qt+1):"";if(kt=kt.trim(),xi==="newmtl")de={name:kt},rt[kt]=de;else if(xi==="ka"||xi==="kd"||xi==="ks"||xi==="ke"){const Tt=kt.split(Je,3);de[xi]=[parseFloat(Tt[0]),parseFloat(Tt[1]),parseFloat(Tt[2])]}else de[xi]=kt}const ai=new St(this.resourcePath||r,this.materialOptions);return ai.setCrossOrigin(this.crossOrigin),ai.setManager(this.manager),ai.setMaterials(rt),ai}}class St{constructor(Le="",r={}){this.baseUrl=Le,this.options=r,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:U.FrontSide,this.wrap=this.options.wrap!==void 0?this.options.wrap:U.RepeatWrapping}setCrossOrigin(Le){return this.crossOrigin=Le,this}setManager(Le){this.manager=Le}setMaterials(Le){this.materialsInfo=this.convert(Le),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(Le){if(!this.options)return Le;const r={};for(const Ge in Le){const de=Le[Ge],Je={};r[Ge]=Je;for(const rt in de){let ai=!0,bi=de[rt];const Ai=rt.toLowerCase();switch(Ai){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(bi=[bi[0]/255,bi[1]/255,bi[2]/255]),this.options&&this.options.ignoreZeroRGBs&&bi[0]===0&&bi[1]===0&&bi[2]===0&&(ai=!1);break}ai&&(Je[Ai]=bi)}}return r}preload(){for(const Le in this.materialsInfo)this.create(Le)}getIndex(Le){return this.nameLookup[Le]}getAsArray(){let Le=0;for(const r in this.materialsInfo)this.materialsArray[Le]=this.create(r),this.nameLookup[r]=Le,Le++;return this.materialsArray}create(Le){return this.materials[Le]===void 0&&this.createMaterial_(Le),this.materials[Le]}createMaterial_(Le){const r=this,Ge=this.materialsInfo[Le],de={name:Le,side:this.side};function Je(ai,bi){return typeof bi!="string"||bi===""?"":/^https?:\/\//i.test(bi)?bi:ai+bi}function rt(ai,bi){if(de[ai])return;const Ai=r.getTextureParams(bi,de),qt=r.loadTexture(Je(r.baseUrl,Ai.url));qt.repeat.copy(Ai.scale),qt.offset.copy(Ai.offset),qt.wrapS=r.wrap,qt.wrapT=r.wrap,de[ai]=qt}for(const ai in Ge){const bi=Ge[ai];let Ai;if(bi!=="")switch(ai.toLowerCase()){case"kd":de.color=new U.Color().fromArray(bi);break;case"ks":de.specular=new U.Color().fromArray(bi);break;case"ke":de.emissive=new U.Color().fromArray(bi);break;case"map_kd":rt("map",bi);break;case"map_ks":rt("specularMap",bi);break;case"map_ke":rt("emissiveMap",bi);break;case"norm":rt("normalMap",bi);break;case"map_bump":case"bump":rt("bumpMap",bi);break;case"map_d":rt("alphaMap",bi),de.transparent=!0;break;case"ns":de.shininess=parseFloat(bi);break;case"d":Ai=parseFloat(bi),Ai<1&&(de.opacity=Ai,de.transparent=!0);break;case"tr":Ai=parseFloat(bi),this.options&&this.options.invertTrProperty&&(Ai=1-Ai),Ai>0&&(de.opacity=1-Ai,de.transparent=!0);break}}return this.materials[Le]=new U.MeshPhongMaterial(de),this.materials[Le]}getTextureParams(Le,r){const Ge={scale:new U.Vector2(1,1),offset:new U.Vector2(0,0)},de=Le.split(/\s+/);let Je;return Je=de.indexOf("-bm"),Je>=0&&(r.bumpScale=parseFloat(de[Je+1]),de.splice(Je,2)),Je=de.indexOf("-s"),Je>=0&&(Ge.scale.set(parseFloat(de[Je+1]),parseFloat(de[Je+2])),de.splice(Je,4)),Je=de.indexOf("-o"),Je>=0&&(Ge.offset.set(parseFloat(de[Je+1]),parseFloat(de[Je+2])),de.splice(Je,4)),Ge.url=de.join(" ").trim(),Ge}loadTexture(Le,r,Ge,de,Je){const rt=this.manager!==void 0?this.manager:U.DefaultLoadingManager;let ai=rt.getHandler(Le);ai===null&&(ai=new U.TextureLoader(rt)),ai.setCrossOrigin&&ai.setCrossOrigin(this.crossOrigin);const bi=ai.load(Le,Ge,de,Je);return r!==void 0&&(bi.mapping=r),bi}}U.MTLLoader=Ze})(),En.exports=U.MTLLoader}(vy)),vy.exports}var xy={exports:{}},Jg={exports:{}};/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
*/var ix;function Ab(){return ix||(ix=1,function(En,na){(function(U){En.exports=U()})(function(){var U={};U.__esModule=!0;var Ze=function(Me){var be;try{be("require('worker_threads')").Worker}catch{}return na.default=function(Fe,yt,ki,Yi,wi){setImmediate(function(){return wi(Error("async operations unsupported - update to Node 12+ (or Node 10-11 with the --experimental-worker CLI flag)"),null)});var hn=function(){};return{terminate:hn,postMessage:hn}},Me}({}),St=Uint8Array,ei=Uint16Array,Le=Uint32Array,r=new St([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ge=new St([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),de=new St([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Je=function(Me,be){for(var Fe=new ei(31),yt=0;yt<31;++yt)Fe[yt]=be+=1<<Me[yt-1];var ki=new Le(Fe[30]);for(yt=1;yt<30;++yt)for(var Yi=Fe[yt];Yi<Fe[yt+1];++Yi)ki[Yi]=Yi-Fe[yt]<<5|yt;return[Fe,ki]},rt=Je(r,2),ai=rt[0],bi=rt[1];ai[28]=258,bi[258]=28;for(var Ai=Je(Ge,0),qt=Ai[0],xi=Ai[1],kt=new ei(32768),Tt=0;Tt<32768;++Tt){var ln=(43690&Tt)>>>1|(21845&Tt)<<1;kt[Tt]=((65280&(ln=(61680&(ln=(52428&ln)>>>2|(13107&ln)<<2))>>>4|(3855&ln)<<4))>>>8|(255&ln)<<8)>>>1}var Xi=function(Me,be,Fe){for(var yt=Me.length,ki=0,Yi=new ei(be);ki<yt;++ki)++Yi[Me[ki]-1];var wi,hn=new ei(be);for(ki=0;ki<be;++ki)hn[ki]=hn[ki-1]+Yi[ki-1]<<1;if(Fe){wi=new ei(1<<be);var xe=15-be;for(ki=0;ki<yt;++ki)if(Me[ki])for(var he=ki<<4|Me[ki],we=be-Me[ki],Ve=hn[Me[ki]-1]++<<we,Ee=Ve|(1<<we)-1;Ve<=Ee;++Ve)wi[kt[Ve]>>>xe]=he}else for(wi=new ei(yt),ki=0;ki<yt;++ki)Me[ki]&&(wi[ki]=kt[hn[Me[ki]-1]++]>>>15-Me[ki]);return wi},Dt=new St(288);for(Tt=0;Tt<144;++Tt)Dt[Tt]=8;for(Tt=144;Tt<256;++Tt)Dt[Tt]=9;for(Tt=256;Tt<280;++Tt)Dt[Tt]=7;for(Tt=280;Tt<288;++Tt)Dt[Tt]=8;var ni=new St(32);for(Tt=0;Tt<32;++Tt)ni[Tt]=5;var ci=Xi(Dt,9,0),Nn=Xi(Dt,9,1),Fi=Xi(ni,5,0),oi=Xi(ni,5,1),Ci=function(Me){for(var be=Me[0],Fe=1;Fe<Me.length;++Fe)Me[Fe]>be&&(be=Me[Fe]);return be},Zt=function(Me,be,Fe){var yt=be/8|0;return(Me[yt]|Me[yt+1]<<8)>>(7&be)&Fe},Yt=function(Me,be){var Fe=be/8|0;return(Me[Fe]|Me[Fe+1]<<8|Me[Fe+2]<<16)>>(7&be)},vi=function(Me){return(Me/8|0)+(7&Me&&1)},ae=function(Me,be,Fe){(be==null||be<0)&&(be=0),(Fe==null||Fe>Me.length)&&(Fe=Me.length);var yt=new(Me instanceof ei?ei:Me instanceof Le?Le:St)(Fe-be);return yt.set(Me.subarray(be,Fe)),yt},ge=function(Me,be,Fe){var yt=Me.length;if(!yt||Fe&&!Fe.l&&yt<5)return be||new St(0);var ki=!be||Fe,Yi=!Fe||Fe.i;Fe||(Fe={}),be||(be=new St(3*yt));var wi=function(Wo){var or=be.length;if(Wo>or){var fs=new St(Math.max(2*or,Wo));fs.set(be),be=fs}},hn=Fe.f||0,xe=Fe.p||0,he=Fe.b||0,we=Fe.l,Ve=Fe.d,Ee=Fe.m,ri=Fe.n,Ei=8*yt;do{if(!we){Fe.f=hn=Zt(Me,xe,1);var sn=Zt(Me,xe+1,3);if(xe+=3,!sn){var Di=Me[(Gr=vi(xe)+4)-4]|Me[Gr-3]<<8,Jn=Gr+Di;if(Jn>yt){if(Yi)throw"unexpected EOF";break}ki&&wi(he+Di),be.set(Me.subarray(Gr,Jn),he),Fe.b=he+=Di,Fe.p=xe=8*Jn;continue}if(sn==1)we=Nn,Ve=oi,Ee=9,ri=5;else{if(sn!=2)throw"invalid block type";var on=Zt(Me,xe,31)+257,Ft=Zt(Me,xe+10,15)+4,yn=on+Zt(Me,xe+5,31)+1;xe+=14;for(var Si=new St(yn),qn=new St(19),rn=0;rn<Ft;++rn)qn[de[rn]]=Zt(Me,xe+3*rn,7);xe+=3*Ft;var Cn=Ci(qn),Ar=(1<<Cn)-1;if(!Yi&&xe+yn*(Cn+7)>Ei)break;var Ir=Xi(qn,Cn,1);for(rn=0;rn<yn;){var Gr,Lr=Ir[Zt(Me,xe,Ar)];if(xe+=15&Lr,(Gr=Lr>>>4)<16)Si[rn++]=Gr;else{var xr=0,On=0;for(Gr==16?(On=3+Zt(Me,xe,3),xe+=2,xr=Si[rn-1]):Gr==17?(On=3+Zt(Me,xe,7),xe+=3):Gr==18&&(On=11+Zt(Me,xe,127),xe+=7);On--;)Si[rn++]=xr}}var fa=Si.subarray(0,on),$r=Si.subarray(on);Ee=Ci(fa),ri=Ci($r),we=Xi(fa,Ee,1),Ve=Xi($r,ri,1)}if(xe>Ei)throw"unexpected EOF"}ki&&wi(he+131072);for(var Ms=(1<<Ee)-1,aa=(1<<ri)-1,Qs=Ee+ri+18;Yi||xe+Qs<Ei;){var ds=(xr=we[Yt(Me,xe)&Ms])>>>4;if((xe+=15&xr)>Ei)throw"unexpected EOF";if(!xr)throw"invalid length/literal";if(ds<256)be[he++]=ds;else{if(ds==256){we=null;break}var Fs=ds-254;ds>264&&(Fs=Zt(Me,xe,(1<<(Gs=r[rn=ds-257]))-1)+ai[rn],xe+=Gs);var Ts=Ve[Yt(Me,xe)&aa],al=Ts>>>4;if(!Ts)throw"invalid distance";if(xe+=15&Ts,$r=qt[al],al>3){var Gs=Ge[al];$r+=Yt(Me,xe)&(1<<Gs)-1,xe+=Gs}if(xe>Ei)throw"unexpected EOF";ki&&wi(he+131072);for(var _a=he+Fs;he<_a;he+=4)be[he]=be[he-$r],be[he+1]=be[he+1-$r],be[he+2]=be[he+2-$r],be[he+3]=be[he+3-$r];he=_a}}Fe.l=we,Fe.p=xe,Fe.b=he,we&&(hn=1,Fe.m=Ee,Fe.d=Ve,Fe.n=ri)}while(!hn);return he==be.length?be:ae(be,0,he)},Te=function(Me,be,Fe){var yt=be/8|0;Me[yt]|=Fe<<=7&be,Me[yt+1]|=Fe>>>8},Re=function(Me,be,Fe){var yt=be/8|0;Me[yt]|=Fe<<=7&be,Me[yt+1]|=Fe>>>8,Me[yt+2]|=Fe>>>16},ze=function(Me,be){for(var Fe=[],yt=0;yt<Me.length;++yt)Me[yt]&&Fe.push({s:yt,f:Me[yt]});var ki=Fe.length,Yi=Fe.slice();if(!ki)return[Wi,0];if(ki==1){var wi=new St(Fe[0].s+1);return wi[Fe[0].s]=1,[wi,1]}Fe.sort(function(Si,qn){return Si.f-qn.f}),Fe.push({s:-1,f:25001});var hn=Fe[0],xe=Fe[1],he=0,we=1,Ve=2;for(Fe[0]={s:-1,f:hn.f+xe.f,l:hn,r:xe};we!=ki-1;)hn=Fe[Fe[he].f<Fe[Ve].f?he++:Ve++],xe=Fe[he!=we&&Fe[he].f<Fe[Ve].f?he++:Ve++],Fe[we++]={s:-1,f:hn.f+xe.f,l:hn,r:xe};var Ee=Yi[0].s;for(yt=1;yt<ki;++yt)Yi[yt].s>Ee&&(Ee=Yi[yt].s);var ri=new ei(Ee+1),Ei=Ie(Fe[we-1],ri,0);if(Ei>be){yt=0;var sn=0,Di=Ei-be,Jn=1<<Di;for(Yi.sort(function(Si,qn){return ri[qn.s]-ri[Si.s]||Si.f-qn.f});yt<ki;++yt){var on=Yi[yt].s;if(!(ri[on]>be))break;sn+=Jn-(1<<Ei-ri[on]),ri[on]=be}for(sn>>>=Di;sn>0;){var Ft=Yi[yt].s;ri[Ft]<be?sn-=1<<be-ri[Ft]++-1:++yt}for(;yt>=0&&sn;--yt){var yn=Yi[yt].s;ri[yn]==be&&(--ri[yn],++sn)}Ei=be}return[new St(ri),Ei]},Ie=function(Me,be,Fe){return Me.s==-1?Math.max(Ie(Me.l,be,Fe+1),Ie(Me.r,be,Fe+1)):be[Me.s]=Fe},it=function(Me){for(var be=Me.length;be&&!Me[--be];);for(var Fe=new ei(++be),yt=0,ki=Me[0],Yi=1,wi=function(xe){Fe[yt++]=xe},hn=1;hn<=be;++hn)if(Me[hn]==ki&&hn!=be)++Yi;else{if(!ki&&Yi>2){for(;Yi>138;Yi-=138)wi(32754);Yi>2&&(wi(Yi>10?Yi-11<<5|28690:Yi-3<<5|12305),Yi=0)}else if(Yi>3){for(wi(ki),--Yi;Yi>6;Yi-=6)wi(8304);Yi>2&&(wi(Yi-3<<5|8208),Yi=0)}for(;Yi--;)wi(ki);Yi=1,ki=Me[hn]}return[Fe.subarray(0,yt),be]},vt=function(Me,be){for(var Fe=0,yt=0;yt<be.length;++yt)Fe+=Me[yt]*be[yt];return Fe},bt=function(Me,be,Fe){var yt=Fe.length,ki=vi(be+2);Me[ki]=255&yt,Me[ki+1]=yt>>>8,Me[ki+2]=255^Me[ki],Me[ki+3]=255^Me[ki+1];for(var Yi=0;Yi<yt;++Yi)Me[ki+Yi+4]=Fe[Yi];return 8*(ki+4+yt)},pt=function(Me,be,Fe,yt,ki,Yi,wi,hn,xe,he,we){Te(be,we++,Fe),++ki[256];for(var Ve=ze(ki,15),Ee=Ve[0],ri=Ve[1],Ei=ze(Yi,15),sn=Ei[0],Di=Ei[1],Jn=it(Ee),on=Jn[0],Ft=Jn[1],yn=it(sn),Si=yn[0],qn=yn[1],rn=new ei(19),Cn=0;Cn<on.length;++Cn)rn[31&on[Cn]]++;for(Cn=0;Cn<Si.length;++Cn)rn[31&Si[Cn]]++;for(var Ar=ze(rn,7),Ir=Ar[0],Gr=Ar[1],Lr=19;Lr>4&&!Ir[de[Lr-1]];--Lr);var xr,On,fa,$r,Ms=he+5<<3,aa=vt(ki,Dt)+vt(Yi,ni)+wi,Qs=vt(ki,Ee)+vt(Yi,sn)+wi+14+3*Lr+vt(rn,Ir)+(2*rn[16]+3*rn[17]+7*rn[18]);if(Ms<=aa&&Ms<=Qs)return bt(be,we,Me.subarray(xe,xe+he));if(Te(be,we,1+(Qs<aa)),we+=2,Qs<aa){xr=Xi(Ee,ri,0),On=Ee,fa=Xi(sn,Di,0),$r=sn;var ds=Xi(Ir,Gr,0);for(Te(be,we,Ft-257),Te(be,we+5,qn-1),Te(be,we+10,Lr-4),we+=14,Cn=0;Cn<Lr;++Cn)Te(be,we+3*Cn,Ir[de[Cn]]);we+=3*Lr;for(var Fs=[on,Si],Ts=0;Ts<2;++Ts){var al=Fs[Ts];for(Cn=0;Cn<al.length;++Cn)Te(be,we,ds[Gs=31&al[Cn]]),we+=Ir[Gs],Gs>15&&(Te(be,we,al[Cn]>>>5&127),we+=al[Cn]>>>12)}}else xr=ci,On=Dt,fa=Fi,$r=ni;for(Cn=0;Cn<hn;++Cn)if(yt[Cn]>255){var Gs;Re(be,we,xr[257+(Gs=yt[Cn]>>>18&31)]),we+=On[Gs+257],Gs>7&&(Te(be,we,yt[Cn]>>>23&31),we+=r[Gs]);var _a=31&yt[Cn];Re(be,we,fa[_a]),we+=$r[_a],_a>3&&(Re(be,we,yt[Cn]>>>5&8191),we+=Ge[_a])}else Re(be,we,xr[yt[Cn]]),we+=On[yt[Cn]];return Re(be,we,xr[256]),we+On[256]},ti=new Le([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Wi=new St(0),mn=function(Me,be,Fe,yt,ki,Yi){var wi=Me.length,hn=new St(yt+wi+5*(1+Math.ceil(wi/7e3))+ki),xe=hn.subarray(yt,hn.length-ki),he=0;if(!be||wi<8)for(var we=0;we<=wi;we+=65535){var Ve=we+65535;Ve<wi?he=bt(xe,he,Me.subarray(we,Ve)):(xe[we]=Yi,he=bt(xe,he,Me.subarray(we,wi)))}else{for(var Ee=ti[be-1],ri=Ee>>>13,Ei=8191&Ee,sn=(1<<Fe)-1,Di=new ei(32768),Jn=new ei(sn+1),on=Math.ceil(Fe/3),Ft=2*on,yn=function(Lu){return(Me[Lu]^Me[Lu+1]<<on^Me[Lu+2]<<Ft)&sn},Si=new Le(25e3),qn=new ei(288),rn=new ei(32),Cn=0,Ar=0,Ir=(we=0,0),Gr=0,Lr=0;we<wi;++we){var xr=yn(we),On=32767&we,fa=Jn[xr];if(Di[On]=fa,Jn[xr]=On,Gr<=we){var $r=wi-we;if((Cn>7e3||Ir>24576)&&$r>423){he=pt(Me,xe,0,Si,qn,rn,Ar,Ir,Lr,we-Lr,he),Ir=Cn=Ar=0,Lr=we;for(var Ms=0;Ms<286;++Ms)qn[Ms]=0;for(Ms=0;Ms<30;++Ms)rn[Ms]=0}var aa=2,Qs=0,ds=Ei,Fs=On-fa&32767;if($r>2&&xr==yn(we-Fs))for(var Ts=Math.min(ri,$r)-1,al=Math.min(32767,we),Gs=Math.min(258,$r);Fs<=al&&--ds&&On!=fa;){if(Me[we+aa]==Me[we+aa-Fs]){for(var _a=0;_a<Gs&&Me[we+_a]==Me[we+_a-Fs];++_a);if(_a>aa){if(aa=_a,Qs=Fs,_a>Ts)break;var Wo=Math.min(Fs,_a-2),or=0;for(Ms=0;Ms<Wo;++Ms){var fs=we-Fs+Ms+32768&32767,Cu=fs-Di[fs]+32768&32767;Cu>or&&(or=Cu,fa=fs)}}}Fs+=(On=fa)-(fa=Di[On])+32768&32767}if(Qs){Si[Ir++]=268435456|bi[aa]<<18|xi[Qs];var kl=31&bi[aa],fl=31&xi[Qs];Ar+=r[kl]+Ge[fl],++qn[257+kl],++rn[fl],Gr=we+aa,++Cn}else Si[Ir++]=Me[we],++qn[Me[we]]}}he=pt(Me,xe,Yi,Si,qn,rn,Ar,Ir,Lr,we-Lr,he),!Yi&&7&he&&(he=bt(xe,he+1,Wi))}return ae(hn,0,yt+vi(he)+ki)},fn=function(){for(var Me=new Le(256),be=0;be<256;++be){for(var Fe=be,yt=9;--yt;)Fe=(1&Fe&&3988292384)^Fe>>>1;Me[be]=Fe}return Me}(),vr=function(){var Me=-1;return{p:function(be){for(var Fe=Me,yt=0;yt<be.length;++yt)Fe=fn[255&Fe^be[yt]]^Fe>>>8;Me=Fe},d:function(){return~Me}}},et=function(){var Me=1,be=0;return{p:function(Fe){for(var yt=Me,ki=be,Yi=Fe.length,wi=0;wi!=Yi;){for(var hn=Math.min(wi+2655,Yi);wi<hn;++wi)ki+=yt+=Fe[wi];yt=(65535&yt)+15*(yt>>16),ki=(65535&ki)+15*(ki>>16)}Me=yt,be=ki},d:function(){return((Me%=65521)>>>8<<16|(255&(be%=65521))<<8|be>>>8)+2*((255&Me)<<23)}}},jr=function(Me,be,Fe,yt,ki){return mn(Me,be.level==null?6:be.level,be.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(Me.length)))):12+be.mem,Fe,yt,!ki)},Ra=function(Me,be){var Fe={};for(var yt in Me)Fe[yt]=Me[yt];for(var yt in be)Fe[yt]=be[yt];return Fe},ra=function(Me,be,Fe){for(var yt=Me(),ki=""+Me,Yi=ki.slice(ki.indexOf("[")+1,ki.lastIndexOf("]")).replace(/ /g,"").split(","),wi=0;wi<yt.length;++wi){var hn=yt[wi],xe=Yi[wi];if(typeof hn=="function"){be+=";"+xe+"=";var he=""+hn;if(hn.prototype)if(he.indexOf("[native code]")!=-1){var we=he.indexOf(" ",8)+1;be+=he.slice(we,he.indexOf("(",we))}else for(var Ve in be+=he,hn.prototype)be+=";"+xe+".prototype."+Ve+"="+hn.prototype[Ve];else be+=he}else Fe[xe]=hn}return[be,Fe]},Pi=[],cn=function(Me){var be=[];for(var Fe in Me)(Me[Fe]instanceof St||Me[Fe]instanceof ei||Me[Fe]instanceof Le)&&be.push((Me[Fe]=new Me[Fe].constructor(Me[Fe])).buffer);return be},Ye=function(Me,be,Fe,yt){var ki;if(!Pi[Fe]){for(var Yi="",wi={},hn=Me.length-1,xe=0;xe<hn;++xe)Yi=(ki=ra(Me[xe],Yi,wi))[0],wi=ki[1];Pi[Fe]=ra(Me[hn],Yi,wi)}var he=Ra({},Pi[Fe][1]);return Ze.default(Pi[Fe][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+be+"}",Fe,he,cn(he),yt)},Xe=function(){return[St,ei,Le,r,Ge,de,ai,qt,Nn,oi,kt,Xi,Ci,Zt,Yt,vi,ae,ge,$s,$t,ii]},ft=function(){return[St,ei,Le,r,Ge,de,bi,xi,ci,Dt,Fi,ni,kt,ti,Wi,Xi,Te,Re,ze,Ie,it,vt,bt,pt,vi,ae,mn,jr,Ca,$t]},ct=function(){return[Nr,oo,mr,vr,fn]},Rt=function(){return[Ma,ga]},Ut=function(){return[$a,mr,et]},li=function(){return[dn]},$t=function(Me){return postMessage(Me,[Me.buffer])},ii=function(Me){return Me&&Me.size&&new St(Me.size)},Tn=function(Me,be,Fe,yt,ki,Yi){var wi=Ye(Fe,yt,ki,function(hn,xe){wi.terminate(),Yi(hn,xe)});return wi.postMessage([Me,be],be.consume?[Me.buffer]:[]),function(){wi.terminate()}},wn=function(Me){return Me.ondata=function(be,Fe){return postMessage([be,Fe],[be.buffer])},function(be){return Me.push(be.data[0],be.data[1])}},gr=function(Me,be,Fe,yt,ki){var Yi,wi=Ye(Me,yt,ki,function(hn,xe){hn?(wi.terminate(),be.ondata.call(be,hn)):(xe[1]&&wi.terminate(),be.ondata.call(be,hn,xe[0],xe[1]))});wi.postMessage(Fe),be.push=function(hn,xe){if(Yi)throw"stream finished";if(!be.ondata)throw"no stream handler";wi.postMessage([hn,Yi=xe],[hn.buffer])},be.terminate=function(){wi.terminate()}},cr=function(Me,be){return Me[be]|Me[be+1]<<8},Sr=function(Me,be){return(Me[be]|Me[be+1]<<8|Me[be+2]<<16)+2*(Me[be+3]<<23)},Er=function(Me,be){return Sr(Me,be)|4294967296*Sr(Me,be)},mr=function(Me,be,Fe){for(;Fe;++be)Me[be]=Fe,Fe>>>=8},Nr=function(Me,be){var Fe=be.filename;if(Me[0]=31,Me[1]=139,Me[2]=8,Me[8]=be.level<2?4:be.level==9?2:0,Me[9]=3,be.mtime!=0&&mr(Me,4,Math.floor(new Date(be.mtime||Date.now())/1e3)),Fe){Me[3]=8;for(var yt=0;yt<=Fe.length;++yt)Me[yt+10]=Fe.charCodeAt(yt)}},Ma=function(Me){if(Me[0]!=31||Me[1]!=139||Me[2]!=8)throw"invalid gzip data";var be=Me[3],Fe=10;4&be&&(Fe+=Me[10]|2+(Me[11]<<8));for(var yt=(be>>3&1)+(be>>4&1);yt>0;yt-=!Me[Fe++]);return Fe+(2&be)},ga=function(Me){var be=Me.length;return(Me[be-4]|Me[be-3]<<8|Me[be-2]<<16)+2*(Me[be-1]<<23)},oo=function(Me){return 10+(Me.filename&&Me.filename.length+1||0)},$a=function(Me,be){var Fe=be.level,yt=Fe==0?0:Fe<6?1:Fe==9?3:2;Me[0]=120,Me[1]=yt<<6|(yt?32-2*yt:1)},dn=function(Me){if((15&Me[0])!=8||Me[0]>>>4>7||(Me[0]<<8|Me[1])%31)throw"invalid zlib data";if(32&Me[1])throw"invalid zlib data: preset dictionaries not supported"};function Xn(Me,be){return be||typeof Me!="function"||(be=Me,Me={}),this.ondata=be,Me}var Qa=function(){function Me(be,Fe){Fe||typeof be!="function"||(Fe=be,be={}),this.ondata=Fe,this.o=be||{}}return Me.prototype.p=function(be,Fe){this.ondata(jr(be,this.o,0,0,!Fe),Fe)},Me.prototype.push=function(be,Fe){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=Fe,this.p(be,Fe||!1)},Me}();U.Deflate=Qa;var lo=function(){return function(Me,be){gr([ft,function(){return[wn,Qa]}],this,Xn.call(this,Me,be),function(Fe){var yt=new Qa(Fe.data);onmessage=wn(yt)},6)}}();function Us(Me,be,Fe){if(Fe||(Fe=be,be={}),typeof Fe!="function")throw"no callback";return Tn(Me,be,[ft],function(yt){return $t(Ca(yt.data[0],yt.data[1]))},0,Fe)}function Ca(Me,be){return jr(Me,be||{},0,0)}U.AsyncDeflate=lo,U.deflate=Us,U.deflateSync=Ca;var ja=function(){function Me(be){this.s={},this.p=new St(0),this.ondata=be}return Me.prototype.e=function(be){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var Fe=this.p.length,yt=new St(Fe+be.length);yt.set(this.p),yt.set(be,Fe),this.p=yt},Me.prototype.c=function(be){this.d=this.s.i=be||!1;var Fe=this.s.b,yt=ge(this.p,this.o,this.s);this.ondata(ae(yt,Fe,this.s.b),this.d),this.o=ae(yt,this.s.b-32768),this.s.b=this.o.length,this.p=ae(this.p,this.s.p/8|0),this.s.p&=7},Me.prototype.push=function(be,Fe){this.e(be),this.c(Fe)},Me}();U.Inflate=ja;var qr=function(){return function(Me){this.ondata=Me,gr([Xe,function(){return[wn,ja]}],this,0,function(){var be=new ja;onmessage=wn(be)},7)}}();function gs(Me,be,Fe){if(Fe||(Fe=be,be={}),typeof Fe!="function")throw"no callback";return Tn(Me,be,[Xe],function(yt){return $t($s(yt.data[0],ii(yt.data[1])))},1,Fe)}function $s(Me,be){return ge(Me,be)}U.AsyncInflate=qr,U.inflate=gs,U.inflateSync=$s;var Lo=function(){function Me(be,Fe){this.c=vr(),this.l=0,this.v=1,Qa.call(this,be,Fe)}return Me.prototype.push=function(be,Fe){Qa.prototype.push.call(this,be,Fe)},Me.prototype.p=function(be,Fe){this.c.p(be),this.l+=be.length;var yt=jr(be,this.o,this.v&&oo(this.o),Fe&&8,!Fe);this.v&&(Nr(yt,this.o),this.v=0),Fe&&(mr(yt,yt.length-8,this.c.d()),mr(yt,yt.length-4,this.l)),this.ondata(yt,Fe)},Me}();U.Gzip=Lo,U.Compress=Lo;var Ls=function(){return function(Me,be){gr([ft,ct,function(){return[wn,Qa,Lo]}],this,Xn.call(this,Me,be),function(Fe){var yt=new Lo(Fe.data);onmessage=wn(yt)},8)}}();function ht(Me,be,Fe){if(Fe||(Fe=be,be={}),typeof Fe!="function")throw"no callback";return Tn(Me,be,[ft,ct,function(){return[es]}],function(yt){return $t(es(yt.data[0],yt.data[1]))},2,Fe)}function es(Me,be){be||(be={});var Fe=vr(),yt=Me.length;Fe.p(Me);var ki=jr(Me,be,oo(be),8),Yi=ki.length;return Nr(ki,be),mr(ki,Yi-8,Fe.d()),mr(ki,Yi-4,yt),ki}U.AsyncGzip=Ls,U.AsyncCompress=Ls,U.gzip=ht,U.compress=ht,U.gzipSync=es,U.compressSync=es;var Ks=function(){function Me(be){this.v=1,ja.call(this,be)}return Me.prototype.push=function(be,Fe){if(ja.prototype.e.call(this,be),this.v){var yt=this.p.length>3?Ma(this.p):4;if(yt>=this.p.length&&!Fe)return;this.p=this.p.subarray(yt),this.v=0}if(Fe){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}ja.prototype.c.call(this,Fe)},Me}();U.Gunzip=Ks;var Js=function(){return function(Me){this.ondata=Me,gr([Xe,Rt,function(){return[wn,ja,Ks]}],this,0,function(){var be=new Ks;onmessage=wn(be)},9)}}();function Ro(Me,be,Fe){if(Fe||(Fe=be,be={}),typeof Fe!="function")throw"no callback";return Tn(Me,be,[Xe,Rt,function(){return[xs]}],function(yt){return $t(xs(yt.data[0]))},3,Fe)}function xs(Me,be){return ge(Me.subarray(Ma(Me),-8),be||new St(ga(Me)))}U.AsyncGunzip=Js,U.gunzip=Ro,U.gunzipSync=xs;var Io=function(){function Me(be,Fe){this.c=et(),this.v=1,Qa.call(this,be,Fe)}return Me.prototype.push=function(be,Fe){Qa.prototype.push.call(this,be,Fe)},Me.prototype.p=function(be,Fe){this.c.p(be);var yt=jr(be,this.o,this.v&&2,Fe&&4,!Fe);this.v&&($a(yt,this.o),this.v=0),Fe&&mr(yt,yt.length-4,this.c.d()),this.ondata(yt,Fe)},Me}();U.Zlib=Io;var Xt=function(){return function(Me,be){gr([ft,Ut,function(){return[wn,Qa,Io]}],this,Xn.call(this,Me,be),function(Fe){var yt=new Io(Fe.data);onmessage=wn(yt)},10)}}();function oe(Me,be,Fe){if(Fe||(Fe=be,be={}),typeof Fe!="function")throw"no callback";return Tn(Me,be,[ft,Ut,function(){return[pe]}],function(yt){return $t(pe(yt.data[0],yt.data[1]))},4,Fe)}function pe(Me,be){be||(be={});var Fe=et();Fe.p(Me);var yt=jr(Me,be,2,4);return $a(yt,be),mr(yt,yt.length-4,Fe.d()),yt}U.AsyncZlib=Xt,U.zlib=oe,U.zlibSync=pe;var Ce=function(){function Me(be){this.v=1,ja.call(this,be)}return Me.prototype.push=function(be,Fe){if(ja.prototype.e.call(this,be),this.v){if(this.p.length<2&&!Fe)return;this.p=this.p.subarray(2),this.v=0}if(Fe){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}ja.prototype.c.call(this,Fe)},Me}();U.Unzlib=Ce;var qe=function(){return function(Me){this.ondata=Me,gr([Xe,li,function(){return[wn,ja,Ce]}],this,0,function(){var be=new Ce;onmessage=wn(be)},11)}}();function Qe(Me,be,Fe){if(Fe||(Fe=be,be={}),typeof Fe!="function")throw"no callback";return Tn(Me,be,[Xe,li,function(){return[ut]}],function(yt){return $t(ut(yt.data[0],ii(yt.data[1])))},5,Fe)}function ut(Me,be){return ge((dn(Me),Me.subarray(2,-4)),be)}U.AsyncUnzlib=qe,U.unzlib=Qe,U.unzlibSync=ut;var It=function(){function Me(be){this.G=Ks,this.I=ja,this.Z=Ce,this.ondata=be}return Me.prototype.push=function(be,Fe){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(be,Fe);else{if(this.p&&this.p.length){var yt=new St(this.p.length+be.length);yt.set(this.p),yt.set(be,this.p.length)}else this.p=be;if(this.p.length>2){var ki=this,Yi=function(){ki.ondata.apply(ki,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(Yi):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(Yi):new this.Z(Yi),this.s.push(this.p,Fe),this.p=null}}},Me}();U.Decompress=It;var mt=function(){function Me(be){this.G=Js,this.I=qr,this.Z=qe,this.ondata=be}return Me.prototype.push=function(be,Fe){It.prototype.push.call(this,be,Fe)},Me}();function Vt(Me,be,Fe){if(Fe||(Fe=be,be={}),typeof Fe!="function")throw"no callback";return Me[0]==31&&Me[1]==139&&Me[2]==8?Ro(Me,be,Fe):(15&Me[0])!=8||Me[0]>>4>7||(Me[0]<<8|Me[1])%31?gs(Me,be,Fe):Qe(Me,be,Fe)}function Gt(Me,be){return Me[0]==31&&Me[1]==139&&Me[2]==8?xs(Me,be):(15&Me[0])!=8||Me[0]>>4>7||(Me[0]<<8|Me[1])%31?$s(Me,be):ut(Me,be)}U.AsyncDecompress=mt,U.decompress=Vt,U.decompressSync=Gt;var Wt=function(Me,be,Fe,yt){for(var ki in Me){var Yi=Me[ki],wi=be+ki;Yi instanceof St?Fe[wi]=[Yi,yt]:Array.isArray(Yi)?Fe[wi]=[Yi[0],Ra(yt,Yi[1])]:Wt(Yi,wi+"/",Fe,yt)}},Mi=typeof TextEncoder<"u"&&new TextEncoder,Qi=typeof TextDecoder<"u"&&new TextDecoder,nn=0;try{Qi.decode(Wi,{stream:!0}),nn=1}catch{}var zn=function(Me){for(var be="",Fe=0;;){var yt=Me[Fe++],ki=(yt>127)+(yt>223)+(yt>239);if(Fe+ki>Me.length)return[be,ae(Me,Fe-1)];ki?ki==3?(yt=((15&yt)<<18|(63&Me[Fe++])<<12|(63&Me[Fe++])<<6|63&Me[Fe++])-65536,be+=String.fromCharCode(55296|yt>>10,56320|1023&yt)):be+=String.fromCharCode(1&ki?(31&yt)<<6|63&Me[Fe++]:(15&yt)<<12|(63&Me[Fe++])<<6|63&Me[Fe++]):be+=String.fromCharCode(yt)}},jn=function(){function Me(be){this.ondata=be,nn?this.t=new TextDecoder:this.p=Wi}return Me.prototype.push=function(be,Fe){if(!this.ondata)throw"no callback";if(Fe||(Fe=!1),this.t)return this.ondata(this.t.decode(be,{stream:!Fe}),Fe);var yt=new St(this.p.length+be.length);yt.set(this.p),yt.set(be,this.p.length);var ki=zn(yt),Yi=ki[0],wi=ki[1];if(Fe&&wi.length)throw"invalid utf-8 data";this.p=wi,this.ondata(Yi,Fe)},Me}();U.DecodeUTF8=jn;var ar=function(){function Me(be){this.ondata=be}return Me.prototype.push=function(be,Fe){if(!this.ondata)throw"no callback";this.ondata(Wn(be),Fe||!1)},Me}();function Wn(Me,be){if(be){for(var Fe=new St(Me.length),yt=0;yt<Me.length;++yt)Fe[yt]=Me.charCodeAt(yt);return Fe}if(Mi)return Mi.encode(Me);var ki=Me.length,Yi=new St(Me.length+(Me.length>>1)),wi=0,hn=function(we){Yi[wi++]=we};for(yt=0;yt<ki;++yt){if(wi+5>Yi.length){var xe=new St(wi+8+(ki-yt<<1));xe.set(Yi),Yi=xe}var he=Me.charCodeAt(yt);he<128||be?hn(he):he<2048?(hn(192|he>>>6),hn(128|63&he)):he>55295&&he<57344?(hn(240|(he=65536+(1047552&he)|1023&Me.charCodeAt(++yt))>>>18),hn(128|he>>>12&63),hn(128|he>>>6&63),hn(128|63&he)):(hn(224|he>>>12),hn(128|he>>>6&63),hn(128|63&he))}return ae(Yi,0,wi)}function Rr(Me,be){if(be){for(var Fe="",yt=0;yt<Me.length;yt+=16384)Fe+=String.fromCharCode.apply(null,Me.subarray(yt,yt+16384));return Fe}if(Qi)return Qi.decode(Me);var ki=zn(Me);if(ki[1].length)throw"invalid utf-8 data";return ki[0]}U.EncodeUTF8=ar,U.strToU8=Wn,U.strFromU8=Rr;var Ur=function(Me){return Me==1?3:Me<6?2:Me==9?1:0},Br=function(Me,be){return be+30+cr(Me,be+26)+cr(Me,be+28)},sa=function(Me,be,Fe){var yt=cr(Me,be+28),ki=Rr(Me.subarray(be+46,be+46+yt),!(2048&cr(Me,be+8))),Yi=be+46+yt,wi=Sr(Me,be+20),hn=Fe&&wi==4294967295?Wr(Me,Yi):[wi,Sr(Me,be+24),Sr(Me,be+42)],xe=hn[0],he=hn[1],we=hn[2];return[cr(Me,be+10),xe,he,ki,Yi+cr(Me,be+30)+cr(Me,be+32),we]},Wr=function(Me,be){for(;cr(Me,be)!=1;be+=4+cr(Me,be+2));return[Er(Me,be+12),Er(Me,be+4),Er(Me,be+20)]},tr=function(Me){var be=0;if(Me)for(var Fe in Me){var yt=Me[Fe].length;if(yt>65535)throw"extra field too long";be+=yt+4}return be},Rs=function(Me,be,Fe,yt,ki,Yi,wi,hn){var xe=yt.length,he=Fe.extra,we=hn&&hn.length,Ve=tr(he);mr(Me,be,wi!=null?33639248:67324752),be+=4,wi!=null&&(Me[be++]=20,Me[be++]=Fe.os),Me[be]=20,be+=2,Me[be++]=Fe.flag<<1|(Yi==null&&8),Me[be++]=ki&&8,Me[be++]=255&Fe.compression,Me[be++]=Fe.compression>>8;var Ee=new Date(Fe.mtime==null?Date.now():Fe.mtime),ri=Ee.getFullYear()-1980;if(ri<0||ri>119)throw"date not in range 1980-2099";if(mr(Me,be,2*(ri<<24)|Ee.getMonth()+1<<21|Ee.getDate()<<16|Ee.getHours()<<11|Ee.getMinutes()<<5|Ee.getSeconds()>>>1),be+=4,Yi!=null&&(mr(Me,be,Fe.crc),mr(Me,be+4,Yi),mr(Me,be+8,Fe.size)),mr(Me,be+12,xe),mr(Me,be+14,Ve),be+=16,wi!=null&&(mr(Me,be,we),mr(Me,be+6,Fe.attrs),mr(Me,be+10,wi),be+=14),Me.set(yt,be),be+=xe,Ve)for(var Ei in he){var sn=he[Ei],Di=sn.length;mr(Me,be,+Ei),mr(Me,be+2,Di),Me.set(sn,be+4),be+=4+Di}return we&&(Me.set(hn,be),be+=we),be},Ia=function(Me,be,Fe,yt,ki){mr(Me,be,101010256),mr(Me,be+8,Fe),mr(Me,be+10,Fe),mr(Me,be+12,yt),mr(Me,be+16,ki)},Da=function(){function Me(be){this.filename=be,this.c=vr(),this.size=0,this.compression=0}return Me.prototype.process=function(be,Fe){this.ondata(null,be,Fe)},Me.prototype.push=function(be,Fe){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(be),this.size+=be.length,Fe&&(this.crc=this.c.d()),this.process(be,Fe||!1)},Me}();U.ZipPassThrough=Da;var _s=function(){function Me(be,Fe){var yt=this;Fe||(Fe={}),Da.call(this,be),this.d=new Qa(Fe,function(ki,Yi){yt.ondata(null,ki,Yi)}),this.compression=8,this.flag=Ur(Fe.level)}return Me.prototype.process=function(be,Fe){try{this.d.push(be,Fe)}catch(yt){this.ondata(yt,null,Fe)}},Me.prototype.push=function(be,Fe){Da.prototype.push.call(this,be,Fe)},Me}();U.ZipDeflate=_s;var qo=function(){function Me(be,Fe){var yt=this;Fe||(Fe={}),Da.call(this,be),this.d=new lo(Fe,function(ki,Yi,wi){yt.ondata(ki,Yi,wi)}),this.compression=8,this.flag=Ur(Fe.level),this.terminate=this.d.terminate}return Me.prototype.process=function(be,Fe){this.d.push(be,Fe)},Me.prototype.push=function(be,Fe){Da.prototype.push.call(this,be,Fe)},Me}();U.AsyncZipDeflate=qo;var dl=function(){function Me(be){this.ondata=be,this.u=[],this.d=1}return Me.prototype.add=function(be){var Fe=this;if(2&this.d)throw"stream finished";var yt=Wn(be.filename),ki=yt.length,Yi=be.comment,wi=Yi&&Wn(Yi),hn=ki!=be.filename.length||wi&&Yi.length!=wi.length,xe=ki+tr(be.extra)+30;if(ki>65535)throw"filename too long";var he=new St(xe);Rs(he,0,be,yt,hn);var we=[he],Ve=function(){for(var Di=0,Jn=we;Di<Jn.length;Di++)Fe.ondata(null,Jn[Di],!1);we=[]},Ee=this.d;this.d=0;var ri=this.u.length,Ei=Ra(be,{f:yt,u:hn,o:wi,t:function(){be.terminate&&be.terminate()},r:function(){if(Ve(),Ee){var Di=Fe.u[ri+1];Di?Di.r():Fe.d=1}Ee=1}}),sn=0;be.ondata=function(Di,Jn,on){if(Di)Fe.ondata(Di,Jn,on),Fe.terminate();else if(sn+=Jn.length,we.push(Jn),on){var Ft=new St(16);mr(Ft,0,134695760),mr(Ft,4,be.crc),mr(Ft,8,sn),mr(Ft,12,be.size),we.push(Ft),Ei.c=sn,Ei.b=xe+sn+16,Ei.crc=be.crc,Ei.size=be.size,Ee&&Ei.r(),Ee=1}else Ee&&Ve()},this.u.push(Ei)},Me.prototype.end=function(){var be=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&be.d&&(be.u.splice(-1,1),be.e())},t:function(){}}),this.d=3},Me.prototype.e=function(){for(var be=0,Fe=0,yt=0,ki=0,Yi=this.u;ki<Yi.length;ki++)yt+=46+(he=Yi[ki]).f.length+tr(he.extra)+(he.o?he.o.length:0);for(var wi=new St(yt+22),hn=0,xe=this.u;hn<xe.length;hn++){var he;Rs(wi,be,he=xe[hn],he.f,he.u,he.c,Fe,he.o),be+=46+he.f.length+tr(he.extra)+(he.o?he.o.length:0),Fe+=he.b}Ia(wi,be,this.u.length,yt,Fe),this.ondata(null,wi,!0),this.d=2},Me.prototype.terminate=function(){for(var be=0,Fe=this.u;be<Fe.length;be++)Fe[be].t();this.d=2},Me}();function Vs(Me,be,Fe){if(Fe||(Fe=be,be={}),typeof Fe!="function")throw"no callback";var yt={};Wt(Me,"",yt,be);var ki=Object.keys(yt),Yi=ki.length,wi=0,hn=0,xe=Yi,he=Array(Yi),we=[],Ve=function(){for(var sn=0;sn<we.length;++sn)we[sn]()},Ee=function(){var sn=new St(hn+22),Di=wi,Jn=hn-wi;hn=0;for(var on=0;on<xe;++on){var Ft=he[on];try{var yn=Ft.c.length;Rs(sn,hn,Ft,Ft.f,Ft.u,yn);var Si=30+Ft.f.length+tr(Ft.extra),qn=hn+Si;sn.set(Ft.c,qn),Rs(sn,wi,Ft,Ft.f,Ft.u,yn,hn,Ft.m),wi+=16+Si+(Ft.m?Ft.m.length:0),hn=qn+yn}catch(rn){return Fe(rn,null)}}Ia(sn,wi,he.length,Jn,Di),Fe(null,sn)};Yi||Ee();for(var ri=function(sn){var Di=ki[sn],Jn=yt[Di],on=Jn[0],Ft=Jn[1],yn=vr(),Si=on.length;yn.p(on);var qn=Wn(Di),rn=qn.length,Cn=Ft.comment,Ar=Cn&&Wn(Cn),Ir=Ar&&Ar.length,Gr=tr(Ft.extra),Lr=Ft.level==0?0:8,xr=function(On,fa){if(On)Ve(),Fe(On,null);else{var $r=fa.length;he[sn]=Ra(Ft,{size:Si,crc:yn.d(),c:fa,f:qn,m:Ar,u:rn!=Di.length||Ar&&Cn.length!=Ir,compression:Lr}),wi+=30+rn+Gr+$r,hn+=76+2*(rn+Gr)+(Ir||0)+$r,--Yi||Ee()}};if(rn>65535&&xr("filename too long",null),Lr)if(Si<16e4)try{xr(null,Ca(on,Ft))}catch(On){xr(On,null)}else we.push(Us(on,Ft,xr));else xr(null,on)},Ei=0;Ei<xe;++Ei)ri(Ei);return Ve}function Au(Me,be){be||(be={});var Fe={},yt=[];Wt(Me,"",Fe,be);var ki=0,Yi=0;for(var wi in Fe){var hn=Fe[wi],xe=hn[0],he=hn[1],we=he.level==0?0:8,Ve=(rn=Wn(wi)).length,Ee=he.comment,ri=Ee&&Wn(Ee),Ei=ri&&ri.length,sn=tr(he.extra);if(Ve>65535)throw"filename too long";var Di=we?Ca(xe,he):xe,Jn=Di.length,on=vr();on.p(xe),yt.push(Ra(he,{size:xe.length,crc:on.d(),c:Di,f:rn,m:ri,u:Ve!=wi.length||ri&&Ee.length!=Ei,o:ki,compression:we})),ki+=30+Ve+sn+Jn,Yi+=76+2*(Ve+sn)+(Ei||0)+Jn}for(var Ft=new St(Yi+22),yn=ki,Si=Yi-ki,qn=0;qn<yt.length;++qn){var rn;Rs(Ft,(rn=yt[qn]).o,rn,rn.f,rn.u,rn.c.length);var Cn=30+rn.f.length+tr(rn.extra);Ft.set(rn.c,rn.o+Cn),Rs(Ft,ki,rn,rn.f,rn.u,rn.c.length,rn.o,rn.m),ki+=16+Cn+(rn.m?rn.m.length:0)}return Ia(Ft,ki,yt.length,Si,yn),Ft}U.Zip=dl,U.zip=Vs,U.zipSync=Au;var Bc=function(){function Me(){}return Me.prototype.push=function(be,Fe){this.ondata(null,be,Fe)},Me.compression=0,Me}();U.UnzipPassThrough=Bc;var Ql=function(){function Me(){var be=this;this.i=new ja(function(Fe,yt){be.ondata(null,Fe,yt)})}return Me.prototype.push=function(be,Fe){try{this.i.push(be,Fe)}catch(yt){this.ondata(yt,be,Fe)}},Me.compression=8,Me}();U.UnzipInflate=Ql;var fo=function(){function Me(be,Fe){var yt=this;Fe<32e4?this.i=new ja(function(ki,Yi){yt.ondata(null,ki,Yi)}):(this.i=new qr(function(ki,Yi,wi){yt.ondata(ki,Yi,wi)}),this.terminate=this.i.terminate)}return Me.prototype.push=function(be,Fe){this.i.terminate&&(be=ae(be,0)),this.i.push(be,Fe)},Me.compression=8,Me}();U.AsyncUnzipInflate=fo;var ka=function(){function Me(be){this.onfile=be,this.k=[],this.o={0:Bc},this.p=Wi}return Me.prototype.push=function(be,Fe){var yt=this;if(!this.onfile)throw"no callback";if(this.c>0){var ki=Math.min(this.c,be.length),Yi=be.subarray(0,ki);if(this.c-=ki,this.d?this.d.push(Yi,!this.c):this.k[0].push(Yi),(be=be.subarray(ki)).length)return this.push(be,Fe)}else{var wi=0,hn=0,xe=void 0,he=void 0;this.p.length?be.length?((he=new St(this.p.length+be.length)).set(this.p),he.set(be,this.p.length)):he=this.p:he=be;for(var we=he.length,Ve=this.c,Ee=Ve&&this.d,ri=function(){var Di,Jn=Sr(he,hn);if(Jn==67324752){wi=1,xe=hn,Ei.d=null,Ei.c=0;var on=cr(he,hn+6),Ft=cr(he,hn+8),yn=2048&on,Si=8&on,qn=cr(he,hn+26),rn=cr(he,hn+28);if(we>hn+30+qn+rn){var Cn=[];Ei.k.unshift(Cn),wi=2;var Ar=Sr(he,hn+18),Ir=Sr(he,hn+22),Gr=Rr(he.subarray(hn+30,hn+=30+qn),!yn);Ar==4294967295?(Di=Si?[-2]:Wr(he,hn),Ar=Di[0],Ir=Di[1]):Si&&(Ar=-1),hn+=rn,Ei.c=Ar;var Lr={name:Gr,compression:Ft,start:function(){if(!Lr.ondata)throw"no callback";if(Ar){var xr=yt.o[Ft];if(!xr)throw"unknown compression type "+Ft;var On=Ar<0?new xr(Gr):new xr(Gr,Ar,Ir);On.ondata=function(Ms,aa,Qs){Lr.ondata(Ms,aa,Qs)};for(var fa=0,$r=Cn;fa<$r.length;fa++)On.push($r[fa],!1);yt.k[0]==Cn?yt.d=On:On.push(Wi,!0)}else Lr.ondata(null,Wi,!0)},terminate:function(){yt.k[0]==Cn&&yt.d.terminate&&yt.d.terminate()}};Ar>=0&&(Lr.size=Ar,Lr.originalSize=Ir),Ei.onfile(Lr)}return"break"}if(Ve){if(Jn==134695760)return xe=hn+=12+(Ve==-2&&8),wi=2,Ei.c=0,"break";if(Jn==33639248)return xe=hn-=4,wi=2,Ei.c=0,"break"}},Ei=this;hn<we-4&&ri()!=="break";++hn);if(this.p=Wi,Ve<0){var sn=he.subarray(0,wi?xe-12-(Ve==-2&&8)-(Sr(he,xe-16)==134695760&&4):hn);Ee?Ee.push(sn,!!wi):this.k[+(wi==2)].push(sn)}if(2&wi)return this.push(he.subarray(hn),Fe);this.p=he.subarray(hn)}if(Fe&&this.c)throw"invalid zip file"},Me.prototype.register=function(be){this.o[be.compression]=be},Me}();function Do(Me,be){if(typeof be!="function")throw"no callback";for(var Fe=[],yt=function(){for(var Ee=0;Ee<Fe.length;++Ee)Fe[Ee]()},ki={},Yi=Me.length-22;Sr(Me,Yi)!=101010256;--Yi)if(!Yi||Me.length-Yi>65558)return void be("invalid zip file",null);var wi=cr(Me,Yi+8);wi||be(null,{});var hn=wi,xe=Sr(Me,Yi+16),he=xe==4294967295;if(he){if(Yi=Sr(Me,Yi-12),Sr(Me,Yi)!=101075792)return void be("invalid zip file",null);hn=wi=Sr(Me,Yi+32),xe=Sr(Me,Yi+48)}for(var we=function(Ee){var ri=sa(Me,xe,he),Ei=ri[0],sn=ri[1],Di=ri[2],Jn=ri[3],on=ri[4],Ft=Br(Me,ri[5]);xe=on;var yn=function(qn,rn){qn?(yt(),be(qn,null)):(ki[Jn]=rn,--wi||be(null,ki))};if(Ei)if(Ei==8){var Si=Me.subarray(Ft,Ft+sn);if(sn<32e4)try{yn(null,$s(Si,new St(Di)))}catch(qn){yn(qn,null)}else Fe.push(gs(Si,{size:Di},yn))}else yn("unknown compression type "+Ei,null);else yn(null,ae(Me,Ft,Ft+sn))},Ve=0;Ve<hn;++Ve)we();return yt}function xo(Me){for(var be={},Fe=Me.length-22;Sr(Me,Fe)!=101010256;--Fe)if(!Fe||Me.length-Fe>65558)throw"invalid zip file";var yt=cr(Me,Fe+8);if(!yt)return{};var ki=Sr(Me,Fe+16),Yi=ki==4294967295;if(Yi){if(Fe=Sr(Me,Fe-12),Sr(Me,Fe)!=101075792)throw"invalid zip file";yt=Sr(Me,Fe+32),ki=Sr(Me,Fe+48)}for(var wi=0;wi<yt;++wi){var hn=sa(Me,ki,Yi),xe=hn[0],he=hn[1],we=hn[2],Ve=hn[3],Ee=hn[4],ri=Br(Me,hn[5]);if(ki=Ee,xe){if(xe!=8)throw"unknown compression type "+xe;be[Ve]=$s(Me.subarray(ri,ri+he),new St(we))}else be[Ve]=ae(Me,ri,ri+he)}return be}return U.Unzip=ka,U.unzip=Do,U.unzipSync=xo,U})}(Jg,Jg.exports)),Jg.exports}var nx;function Cb(){return nx||(nx=1,function(En,na){const U=Oc(),Ze=Ab();(function(){let St,ei,Le;class r extends U.Loader{constructor(ae){super(ae)}load(ae,ge,Te,Re){const ze=this,Ie=ze.path===""?U.LoaderUtils.extractUrlBase(ae):ze.path,it=new U.FileLoader(this.manager);it.setPath(ze.path),it.setResponseType("arraybuffer"),it.setRequestHeader(ze.requestHeader),it.setWithCredentials(ze.withCredentials),it.load(ae,function(vt){try{ge(ze.parse(vt,Ie))}catch(bt){Re?Re(bt):console.error(bt),ze.manager.itemError(ae)}},Te,Re)}parse(ae,ge){if(qt(ae))St=new ai().parse(ae);else{const Re=oi(ae);if(!xi(Re))throw new Error("THREE.FBXLoader: Unknown format.");if(kt(Re)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+kt(Re));St=new rt().parse(Re)}const Te=new U.TextureLoader(this.manager).setPath(this.resourcePath||ge).setCrossOrigin(this.crossOrigin);return new Ge(Te,this.manager).parse(St)}}class Ge{constructor(ae,ge){this.textureLoader=ae,this.manager=ge}parse(){ei=this.parseConnections();const ae=this.parseImages(),ge=this.parseTextures(ae),Te=this.parseMaterials(ge),Re=this.parseDeformers(),ze=new de().parse(Re);return this.parseScene(Re,ze,Te),Le}parseConnections(){const ae=new Map;return"Connections"in St&&St.Connections.connections.forEach(function(Te){const Re=Te[0],ze=Te[1],Ie=Te[2];ae.has(Re)||ae.set(Re,{parents:[],children:[]});const it={ID:ze,relationship:Ie};ae.get(Re).parents.push(it),ae.has(ze)||ae.set(ze,{parents:[],children:[]});const vt={ID:Re,relationship:Ie};ae.get(ze).children.push(vt)}),ae}parseImages(){const ae={},ge={};if("Video"in St.Objects){const Te=St.Objects.Video;for(const Re in Te){const ze=Te[Re],Ie=parseInt(Re);if(ae[Ie]=ze.RelativeFilename||ze.Filename,"Content"in ze){const it=ze.Content instanceof ArrayBuffer&&ze.Content.byteLength>0,vt=typeof ze.Content=="string"&&ze.Content!=="";if(it||vt){const bt=this.parseImage(Te[Re]);ge[ze.RelativeFilename||ze.Filename]=bt}}}}for(const Te in ae){const Re=ae[Te];ge[Re]!==void 0?ae[Te]=ge[Re]:ae[Te]=ae[Te].split("\\").pop()}return ae}parseImage(ae){const ge=ae.Content,Te=ae.RelativeFilename||ae.Filename,Re=Te.slice(Te.lastIndexOf(".")+1).toLowerCase();let ze;switch(Re){case"bmp":ze="image/bmp";break;case"jpg":case"jpeg":ze="image/jpeg";break;case"png":ze="image/png";break;case"tif":ze="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",Te),ze="image/tga";break;default:console.warn('FBXLoader: Image type "'+Re+'" is not supported.');return}if(typeof ge=="string")return"data:"+ze+";base64,"+ge;{const Ie=new Uint8Array(ge);return window.URL.createObjectURL(new Blob([Ie],{type:ze}))}}parseTextures(ae){const ge=new Map;if("Texture"in St.Objects){const Te=St.Objects.Texture;for(const Re in Te){const ze=this.parseTexture(Te[Re],ae);ge.set(parseInt(Re),ze)}}return ge}parseTexture(ae,ge){const Te=this.loadTexture(ae,ge);Te.ID=ae.id,Te.name=ae.attrName;const Re=ae.WrapModeU,ze=ae.WrapModeV,Ie=Re!==void 0?Re.value:0,it=ze!==void 0?ze.value:0;if(Te.wrapS=Ie===0?U.RepeatWrapping:U.ClampToEdgeWrapping,Te.wrapT=it===0?U.RepeatWrapping:U.ClampToEdgeWrapping,"Scaling"in ae){const vt=ae.Scaling.value;Te.repeat.x=vt[0],Te.repeat.y=vt[1]}return Te}loadTexture(ae,ge){let Te;const Re=this.textureLoader.path,ze=ei.get(ae.id).children;ze!==void 0&&ze.length>0&&ge[ze[0].ID]!==void 0&&(Te=ge[ze[0].ID],(Te.indexOf("blob:")===0||Te.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let Ie;const it=ae.FileName.slice(-3).toLowerCase();if(it==="tga"){const vt=this.manager.getHandler(".tga");vt===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",ae.RelativeFilename),Ie=new U.Texture):(vt.setPath(this.textureLoader.path),Ie=vt.load(Te))}else it==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",ae.RelativeFilename),Ie=new U.Texture):Ie=this.textureLoader.load(Te);return this.textureLoader.setPath(Re),Ie}parseMaterials(ae){const ge=new Map;if("Material"in St.Objects){const Te=St.Objects.Material;for(const Re in Te){const ze=this.parseMaterial(Te[Re],ae);ze!==null&&ge.set(parseInt(Re),ze)}}return ge}parseMaterial(ae,ge){const Te=ae.id,Re=ae.attrName;let ze=ae.ShadingModel;if(typeof ze=="object"&&(ze=ze.value),!ei.has(Te))return null;const Ie=this.parseParameters(ae,ge,Te);let it;switch(ze.toLowerCase()){case"phong":it=new U.MeshPhongMaterial;break;case"lambert":it=new U.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to THREE.MeshPhongMaterial.',ze),it=new U.MeshPhongMaterial;break}return it.setValues(Ie),it.name=Re,it}parseParameters(ae,ge,Te){const Re={};ae.BumpFactor&&(Re.bumpScale=ae.BumpFactor.value),ae.Diffuse?Re.color=new U.Color().fromArray(ae.Diffuse.value):ae.DiffuseColor&&(ae.DiffuseColor.type==="Color"||ae.DiffuseColor.type==="ColorRGB")&&(Re.color=new U.Color().fromArray(ae.DiffuseColor.value)),ae.DisplacementFactor&&(Re.displacementScale=ae.DisplacementFactor.value),ae.Emissive?Re.emissive=new U.Color().fromArray(ae.Emissive.value):ae.EmissiveColor&&(ae.EmissiveColor.type==="Color"||ae.EmissiveColor.type==="ColorRGB")&&(Re.emissive=new U.Color().fromArray(ae.EmissiveColor.value)),ae.EmissiveFactor&&(Re.emissiveIntensity=parseFloat(ae.EmissiveFactor.value)),ae.Opacity&&(Re.opacity=parseFloat(ae.Opacity.value)),Re.opacity<1&&(Re.transparent=!0),ae.ReflectionFactor&&(Re.reflectivity=ae.ReflectionFactor.value),ae.Shininess&&(Re.shininess=ae.Shininess.value),ae.Specular?Re.specular=new U.Color().fromArray(ae.Specular.value):ae.SpecularColor&&ae.SpecularColor.type==="Color"&&(Re.specular=new U.Color().fromArray(ae.SpecularColor.value));const ze=this;return ei.get(Te).children.forEach(function(Ie){const it=Ie.relationship;switch(it){case"Bump":Re.bumpMap=ze.getTexture(ge,Ie.ID);break;case"Maya|TEX_ao_map":Re.aoMap=ze.getTexture(ge,Ie.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":Re.map=ze.getTexture(ge,Ie.ID),Re.map!==void 0&&(Re.map.encoding=U.sRGBEncoding);break;case"DisplacementColor":Re.displacementMap=ze.getTexture(ge,Ie.ID);break;case"EmissiveColor":Re.emissiveMap=ze.getTexture(ge,Ie.ID),Re.emissiveMap!==void 0&&(Re.emissiveMap.encoding=U.sRGBEncoding);break;case"NormalMap":case"Maya|TEX_normal_map":Re.normalMap=ze.getTexture(ge,Ie.ID);break;case"ReflectionColor":Re.envMap=ze.getTexture(ge,Ie.ID),Re.envMap!==void 0&&(Re.envMap.mapping=U.EquirectangularReflectionMapping,Re.envMap.encoding=U.sRGBEncoding);break;case"SpecularColor":Re.specularMap=ze.getTexture(ge,Ie.ID),Re.specularMap!==void 0&&(Re.specularMap.encoding=U.sRGBEncoding);break;case"TransparentColor":case"TransparencyFactor":Re.alphaMap=ze.getTexture(ge,Ie.ID),Re.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",it);break}}),Re}getTexture(ae,ge){return"LayeredTexture"in St.Objects&&ge in St.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),ge=ei.get(ge).children[0].ID),ae.get(ge)}parseDeformers(){const ae={},ge={};if("Deformer"in St.Objects){const Te=St.Objects.Deformer;for(const Re in Te){const ze=Te[Re],Ie=ei.get(parseInt(Re));if(ze.attrType==="Skin"){const it=this.parseSkeleton(Ie,Te);it.ID=Re,Ie.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),it.geometryID=Ie.parents[0].ID,ae[Re]=it}else if(ze.attrType==="BlendShape"){const it={id:Re};it.rawTargets=this.parseMorphTargets(Ie,Te),it.id=Re,Ie.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),ge[Re]=it}}}return{skeletons:ae,morphTargets:ge}}parseSkeleton(ae,ge){const Te=[];return ae.children.forEach(function(Re){const ze=ge[Re.ID];if(ze.attrType!=="Cluster")return;const Ie={ID:Re.ID,indices:[],weights:[],transformLink:new U.Matrix4().fromArray(ze.TransformLink.a)};"Indexes"in ze&&(Ie.indices=ze.Indexes.a,Ie.weights=ze.Weights.a),Te.push(Ie)}),{rawBones:Te,bones:[]}}parseMorphTargets(ae,ge){const Te=[];for(let Re=0;Re<ae.children.length;Re++){const ze=ae.children[Re],Ie=ge[ze.ID],it={name:Ie.attrName,initialWeight:Ie.DeformPercent,id:Ie.id,fullWeights:Ie.FullWeights.a};if(Ie.attrType!=="BlendShapeChannel")return;it.geoID=ei.get(parseInt(ze.ID)).children.filter(function(vt){return vt.relationship===void 0})[0].ID,Te.push(it)}return Te}parseScene(ae,ge,Te){Le=new U.Group;const Re=this.parseModels(ae.skeletons,ge,Te),ze=St.Objects.Model,Ie=this;Re.forEach(function(vt){const bt=ze[vt.ID];Ie.setLookAtProperties(vt,bt),ei.get(vt.ID).parents.forEach(function(ti){const Wi=Re.get(ti.ID);Wi!==void 0&&Wi.add(vt)}),vt.parent===null&&Le.add(vt)}),this.bindSkeleton(ae.skeletons,ge,Re),this.createAmbientLight(),Le.traverse(function(vt){if(vt.userData.transformData){vt.parent&&(vt.userData.transformData.parentMatrix=vt.parent.matrix,vt.userData.transformData.parentMatrixWorld=vt.parent.matrixWorld);const bt=ci(vt.userData.transformData);vt.applyMatrix4(bt),vt.updateWorldMatrix()}});const it=new Je().parse();Le.children.length===1&&Le.children[0].isGroup&&(Le.children[0].animations=it,Le=Le.children[0]),Le.animations=it}parseModels(ae,ge,Te){const Re=new Map,ze=St.Objects.Model;for(const Ie in ze){const it=parseInt(Ie),vt=ze[Ie],bt=ei.get(it);let pt=this.buildSkeleton(bt,ae,it,vt.attrName);if(!pt){switch(vt.attrType){case"Camera":pt=this.createCamera(bt);break;case"Light":pt=this.createLight(bt);break;case"Mesh":pt=this.createMesh(bt,ge,Te);break;case"NurbsCurve":pt=this.createCurve(bt,ge);break;case"LimbNode":case"Root":pt=new U.Bone;break;case"Null":default:pt=new U.Group;break}pt.name=vt.attrName?U.PropertyBinding.sanitizeNodeName(vt.attrName):"",pt.ID=it}this.getTransformData(pt,vt),Re.set(it,pt)}return Re}buildSkeleton(ae,ge,Te,Re){let ze=null;return ae.parents.forEach(function(Ie){for(const it in ge){const vt=ge[it];vt.rawBones.forEach(function(bt,pt){if(bt.ID===Ie.ID){const ti=ze;ze=new U.Bone,ze.matrixWorld.copy(bt.transformLink),ze.name=Re?U.PropertyBinding.sanitizeNodeName(Re):"",ze.ID=Te,vt.bones[pt]=ze,ti!==null&&ze.add(ti)}})}}),ze}createCamera(ae){let ge,Te;if(ae.children.forEach(function(Re){const ze=St.Objects.NodeAttribute[Re.ID];ze!==void 0&&(Te=ze)}),Te===void 0)ge=new U.Object3D;else{let Re=0;Te.CameraProjectionType!==void 0&&Te.CameraProjectionType.value===1&&(Re=1);let ze=1;Te.NearPlane!==void 0&&(ze=Te.NearPlane.value/1e3);let Ie=1e3;Te.FarPlane!==void 0&&(Ie=Te.FarPlane.value/1e3);let it=window.innerWidth,vt=window.innerHeight;Te.AspectWidth!==void 0&&Te.AspectHeight!==void 0&&(it=Te.AspectWidth.value,vt=Te.AspectHeight.value);const bt=it/vt;let pt=45;Te.FieldOfView!==void 0&&(pt=Te.FieldOfView.value);const ti=Te.FocalLength?Te.FocalLength.value:null;switch(Re){case 0:ge=new U.PerspectiveCamera(pt,bt,ze,Ie),ti!==null&&ge.setFocalLength(ti);break;case 1:ge=new U.OrthographicCamera(-it/2,it/2,vt/2,-vt/2,ze,Ie);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+Re+"."),ge=new U.Object3D;break}}return ge}createLight(ae){let ge,Te;if(ae.children.forEach(function(Re){const ze=St.Objects.NodeAttribute[Re.ID];ze!==void 0&&(Te=ze)}),Te===void 0)ge=new U.Object3D;else{let Re;Te.LightType===void 0?Re=0:Re=Te.LightType.value;let ze=16777215;Te.Color!==void 0&&(ze=new U.Color().fromArray(Te.Color.value));let Ie=Te.Intensity===void 0?1:Te.Intensity.value/100;Te.CastLightOnObject!==void 0&&Te.CastLightOnObject.value===0&&(Ie=0);let it=0;Te.FarAttenuationEnd!==void 0&&(Te.EnableFarAttenuation!==void 0&&Te.EnableFarAttenuation.value===0?it=0:it=Te.FarAttenuationEnd.value);const vt=1;switch(Re){case 0:ge=new U.PointLight(ze,Ie,it,vt);break;case 1:ge=new U.DirectionalLight(ze,Ie);break;case 2:let bt=Math.PI/3;Te.InnerAngle!==void 0&&(bt=U.MathUtils.degToRad(Te.InnerAngle.value));let pt=0;Te.OuterAngle!==void 0&&(pt=U.MathUtils.degToRad(Te.OuterAngle.value),pt=Math.max(pt,1)),ge=new U.SpotLight(ze,Ie,it,bt,pt,vt);break;default:console.warn("THREE.FBXLoader: Unknown light type "+Te.LightType.value+", defaulting to a THREE.PointLight."),ge=new U.PointLight(ze,Ie);break}Te.CastShadows!==void 0&&Te.CastShadows.value===1&&(ge.castShadow=!0)}return ge}createMesh(ae,ge,Te){let Re,ze=null,Ie=null;const it=[];return ae.children.forEach(function(vt){ge.has(vt.ID)&&(ze=ge.get(vt.ID)),Te.has(vt.ID)&&it.push(Te.get(vt.ID))}),it.length>1?Ie=it:it.length>0?Ie=it[0]:(Ie=new U.MeshPhongMaterial({color:13421772}),it.push(Ie)),"color"in ze.attributes&&it.forEach(function(vt){vt.vertexColors=!0}),ze.FBX_Deformer?(Re=new U.SkinnedMesh(ze,Ie),Re.normalizeSkinWeights()):Re=new U.Mesh(ze,Ie),Re}createCurve(ae,ge){const Te=ae.children.reduce(function(ze,Ie){return ge.has(Ie.ID)&&(ze=ge.get(Ie.ID)),ze},null),Re=new U.LineBasicMaterial({color:3342591,linewidth:1});return new U.Line(Te,Re)}getTransformData(ae,ge){const Te={};"InheritType"in ge&&(Te.inheritType=parseInt(ge.InheritType.value)),"RotationOrder"in ge?Te.eulerOrder=Nn(ge.RotationOrder.value):Te.eulerOrder="ZYX","Lcl_Translation"in ge&&(Te.translation=ge.Lcl_Translation.value),"PreRotation"in ge&&(Te.preRotation=ge.PreRotation.value),"Lcl_Rotation"in ge&&(Te.rotation=ge.Lcl_Rotation.value),"PostRotation"in ge&&(Te.postRotation=ge.PostRotation.value),"Lcl_Scaling"in ge&&(Te.scale=ge.Lcl_Scaling.value),"ScalingOffset"in ge&&(Te.scalingOffset=ge.ScalingOffset.value),"ScalingPivot"in ge&&(Te.scalingPivot=ge.ScalingPivot.value),"RotationOffset"in ge&&(Te.rotationOffset=ge.RotationOffset.value),"RotationPivot"in ge&&(Te.rotationPivot=ge.RotationPivot.value),ae.userData.transformData=Te}setLookAtProperties(ae,ge){"LookAtProperty"in ge&&ei.get(ae.ID).children.forEach(function(Re){if(Re.relationship==="LookAtProperty"){const ze=St.Objects.Model[Re.ID];if("Lcl_Translation"in ze){const Ie=ze.Lcl_Translation.value;ae.target!==void 0?(ae.target.position.fromArray(Ie),Le.add(ae.target)):ae.lookAt(new U.Vector3().fromArray(Ie))}}})}bindSkeleton(ae,ge,Te){const Re=this.parsePoseNodes();for(const ze in ae){const Ie=ae[ze];ei.get(parseInt(Ie.ID)).parents.forEach(function(vt){if(ge.has(vt.ID)){const bt=vt.ID;ei.get(bt).parents.forEach(function(ti){Te.has(ti.ID)&&Te.get(ti.ID).bind(new U.Skeleton(Ie.bones),Re[ti.ID])})}})}}parsePoseNodes(){const ae={};if("Pose"in St.Objects){const ge=St.Objects.Pose;for(const Te in ge)if(ge[Te].attrType==="BindPose"){const Re=ge[Te].PoseNode;Array.isArray(Re)?Re.forEach(function(ze){ae[ze.Node]=new U.Matrix4().fromArray(ze.Matrix.a)}):ae[Re.Node]=new U.Matrix4().fromArray(Re.Matrix.a)}}return ae}createAmbientLight(){if("GlobalSettings"in St&&"AmbientColor"in St.GlobalSettings){const ae=St.GlobalSettings.AmbientColor.value,ge=ae[0],Te=ae[1],Re=ae[2];if(ge!==0||Te!==0||Re!==0){const ze=new U.Color(ge,Te,Re);Le.add(new U.AmbientLight(ze,1))}}}}class de{parse(ae){const ge=new Map;if("Geometry"in St.Objects){const Te=St.Objects.Geometry;for(const Re in Te){const ze=ei.get(parseInt(Re)),Ie=this.parseGeometry(ze,Te[Re],ae);ge.set(parseInt(Re),Ie)}}return ge}parseGeometry(ae,ge,Te){switch(ge.attrType){case"Mesh":return this.parseMeshGeometry(ae,ge,Te);case"NurbsCurve":return this.parseNurbsGeometry(ge)}}parseMeshGeometry(ae,ge,Te){const Re=Te.skeletons,ze=[],Ie=ae.parents.map(function(ti){return St.Objects.Model[ti.ID]});if(Ie.length===0)return;const it=ae.children.reduce(function(ti,Wi){return Re[Wi.ID]!==void 0&&(ti=Re[Wi.ID]),ti},null);ae.children.forEach(function(ti){Te.morphTargets[ti.ID]!==void 0&&ze.push(Te.morphTargets[ti.ID])});const vt=Ie[0],bt={};"RotationOrder"in vt&&(bt.eulerOrder=Nn(vt.RotationOrder.value)),"InheritType"in vt&&(bt.inheritType=parseInt(vt.InheritType.value)),"GeometricTranslation"in vt&&(bt.translation=vt.GeometricTranslation.value),"GeometricRotation"in vt&&(bt.rotation=vt.GeometricRotation.value),"GeometricScaling"in vt&&(bt.scale=vt.GeometricScaling.value);const pt=ci(bt);return this.genGeometry(ge,it,ze,pt)}genGeometry(ae,ge,Te,Re){const ze=new U.BufferGeometry;ae.attrName&&(ze.name=ae.attrName);const Ie=this.parseGeoNode(ae,ge),it=this.genBuffers(Ie),vt=new U.Float32BufferAttribute(it.vertex,3);if(vt.applyMatrix4(Re),ze.setAttribute("position",vt),it.colors.length>0&&ze.setAttribute("color",new U.Float32BufferAttribute(it.colors,3)),ge&&(ze.setAttribute("skinIndex",new U.Uint16BufferAttribute(it.weightsIndices,4)),ze.setAttribute("skinWeight",new U.Float32BufferAttribute(it.vertexWeights,4)),ze.FBX_Deformer=ge),it.normal.length>0){const bt=new U.Matrix3().getNormalMatrix(Re),pt=new U.Float32BufferAttribute(it.normal,3);pt.applyNormalMatrix(bt),ze.setAttribute("normal",pt)}if(it.uvs.forEach(function(bt,pt){let ti="uv"+(pt+1).toString();pt===0&&(ti="uv"),ze.setAttribute(ti,new U.Float32BufferAttribute(it.uvs[pt],2))}),Ie.material&&Ie.material.mappingType!=="AllSame"){let bt=it.materialIndex[0],pt=0;if(it.materialIndex.forEach(function(ti,Wi){ti!==bt&&(ze.addGroup(pt,Wi-pt,bt),bt=ti,pt=Wi)}),ze.groups.length>0){const ti=ze.groups[ze.groups.length-1],Wi=ti.start+ti.count;Wi!==it.materialIndex.length&&ze.addGroup(Wi,it.materialIndex.length-Wi,bt)}ze.groups.length===0&&ze.addGroup(0,it.materialIndex.length,it.materialIndex[0])}return this.addMorphTargets(ze,ae,Te,Re),ze}parseGeoNode(ae,ge){const Te={};if(Te.vertexPositions=ae.Vertices!==void 0?ae.Vertices.a:[],Te.vertexIndices=ae.PolygonVertexIndex!==void 0?ae.PolygonVertexIndex.a:[],ae.LayerElementColor&&(Te.color=this.parseVertexColors(ae.LayerElementColor[0])),ae.LayerElementMaterial&&(Te.material=this.parseMaterialIndices(ae.LayerElementMaterial[0])),ae.LayerElementNormal&&(Te.normal=this.parseNormals(ae.LayerElementNormal[0])),ae.LayerElementUV){Te.uv=[];let Re=0;for(;ae.LayerElementUV[Re];)ae.LayerElementUV[Re].UV&&Te.uv.push(this.parseUVs(ae.LayerElementUV[Re])),Re++}return Te.weightTable={},ge!==null&&(Te.skeleton=ge,ge.rawBones.forEach(function(Re,ze){Re.indices.forEach(function(Ie,it){Te.weightTable[Ie]===void 0&&(Te.weightTable[Ie]=[]),Te.weightTable[Ie].push({id:ze,weight:Re.weights[it]})})})),Te}genBuffers(ae){const ge={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let Te=0,Re=0,ze=!1,Ie=[],it=[],vt=[],bt=[],pt=[],ti=[];const Wi=this;return ae.vertexIndices.forEach(function(mn,fn){let vr,et=!1;mn<0&&(mn=mn^-1,et=!0);let jr=[],Ra=[];if(Ie.push(mn*3,mn*3+1,mn*3+2),ae.color){const ra=Xi(fn,Te,mn,ae.color);vt.push(ra[0],ra[1],ra[2])}if(ae.skeleton){if(ae.weightTable[mn]!==void 0&&ae.weightTable[mn].forEach(function(ra){Ra.push(ra.weight),jr.push(ra.id)}),Ra.length>4){ze||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),ze=!0);const ra=[0,0,0,0],Pi=[0,0,0,0];Ra.forEach(function(cn,Ye){let Xe=cn,ft=jr[Ye];Pi.forEach(function(ct,Rt,Ut){if(Xe>ct){Ut[Rt]=Xe,Xe=ct;const li=ra[Rt];ra[Rt]=ft,ft=li}})}),jr=ra,Ra=Pi}for(;Ra.length<4;)Ra.push(0),jr.push(0);for(let ra=0;ra<4;++ra)pt.push(Ra[ra]),ti.push(jr[ra])}if(ae.normal){const ra=Xi(fn,Te,mn,ae.normal);it.push(ra[0],ra[1],ra[2])}ae.material&&ae.material.mappingType!=="AllSame"&&(vr=Xi(fn,Te,mn,ae.material)[0]),ae.uv&&ae.uv.forEach(function(ra,Pi){const cn=Xi(fn,Te,mn,ra);bt[Pi]===void 0&&(bt[Pi]=[]),bt[Pi].push(cn[0]),bt[Pi].push(cn[1])}),Re++,et&&(Wi.genFace(ge,ae,Ie,vr,it,vt,bt,pt,ti,Re),Te++,Re=0,Ie=[],it=[],vt=[],bt=[],pt=[],ti=[])}),ge}genFace(ae,ge,Te,Re,ze,Ie,it,vt,bt,pt){for(let ti=2;ti<pt;ti++)ae.vertex.push(ge.vertexPositions[Te[0]]),ae.vertex.push(ge.vertexPositions[Te[1]]),ae.vertex.push(ge.vertexPositions[Te[2]]),ae.vertex.push(ge.vertexPositions[Te[(ti-1)*3]]),ae.vertex.push(ge.vertexPositions[Te[(ti-1)*3+1]]),ae.vertex.push(ge.vertexPositions[Te[(ti-1)*3+2]]),ae.vertex.push(ge.vertexPositions[Te[ti*3]]),ae.vertex.push(ge.vertexPositions[Te[ti*3+1]]),ae.vertex.push(ge.vertexPositions[Te[ti*3+2]]),ge.skeleton&&(ae.vertexWeights.push(vt[0]),ae.vertexWeights.push(vt[1]),ae.vertexWeights.push(vt[2]),ae.vertexWeights.push(vt[3]),ae.vertexWeights.push(vt[(ti-1)*4]),ae.vertexWeights.push(vt[(ti-1)*4+1]),ae.vertexWeights.push(vt[(ti-1)*4+2]),ae.vertexWeights.push(vt[(ti-1)*4+3]),ae.vertexWeights.push(vt[ti*4]),ae.vertexWeights.push(vt[ti*4+1]),ae.vertexWeights.push(vt[ti*4+2]),ae.vertexWeights.push(vt[ti*4+3]),ae.weightsIndices.push(bt[0]),ae.weightsIndices.push(bt[1]),ae.weightsIndices.push(bt[2]),ae.weightsIndices.push(bt[3]),ae.weightsIndices.push(bt[(ti-1)*4]),ae.weightsIndices.push(bt[(ti-1)*4+1]),ae.weightsIndices.push(bt[(ti-1)*4+2]),ae.weightsIndices.push(bt[(ti-1)*4+3]),ae.weightsIndices.push(bt[ti*4]),ae.weightsIndices.push(bt[ti*4+1]),ae.weightsIndices.push(bt[ti*4+2]),ae.weightsIndices.push(bt[ti*4+3])),ge.color&&(ae.colors.push(Ie[0]),ae.colors.push(Ie[1]),ae.colors.push(Ie[2]),ae.colors.push(Ie[(ti-1)*3]),ae.colors.push(Ie[(ti-1)*3+1]),ae.colors.push(Ie[(ti-1)*3+2]),ae.colors.push(Ie[ti*3]),ae.colors.push(Ie[ti*3+1]),ae.colors.push(Ie[ti*3+2])),ge.material&&ge.material.mappingType!=="AllSame"&&(ae.materialIndex.push(Re),ae.materialIndex.push(Re),ae.materialIndex.push(Re)),ge.normal&&(ae.normal.push(ze[0]),ae.normal.push(ze[1]),ae.normal.push(ze[2]),ae.normal.push(ze[(ti-1)*3]),ae.normal.push(ze[(ti-1)*3+1]),ae.normal.push(ze[(ti-1)*3+2]),ae.normal.push(ze[ti*3]),ae.normal.push(ze[ti*3+1]),ae.normal.push(ze[ti*3+2])),ge.uv&&ge.uv.forEach(function(Wi,mn){ae.uvs[mn]===void 0&&(ae.uvs[mn]=[]),ae.uvs[mn].push(it[mn][0]),ae.uvs[mn].push(it[mn][1]),ae.uvs[mn].push(it[mn][(ti-1)*2]),ae.uvs[mn].push(it[mn][(ti-1)*2+1]),ae.uvs[mn].push(it[mn][ti*2]),ae.uvs[mn].push(it[mn][ti*2+1])})}addMorphTargets(ae,ge,Te,Re){if(Te.length===0)return;ae.morphTargetsRelative=!0,ae.morphAttributes.position=[];const ze=this;Te.forEach(function(Ie){Ie.rawTargets.forEach(function(it){const vt=St.Objects.Geometry[it.geoID];vt!==void 0&&ze.genMorphGeometry(ae,ge,vt,Re,it.name)})})}genMorphGeometry(ae,ge,Te,Re,ze){const Ie=ge.PolygonVertexIndex!==void 0?ge.PolygonVertexIndex.a:[],it=Te.Vertices!==void 0?Te.Vertices.a:[],vt=Te.Indexes!==void 0?Te.Indexes.a:[],bt=ae.attributes.position.count*3,pt=new Float32Array(bt);for(let fn=0;fn<vt.length;fn++){const vr=vt[fn]*3;pt[vr]=it[fn*3],pt[vr+1]=it[fn*3+1],pt[vr+2]=it[fn*3+2]}const ti={vertexIndices:Ie,vertexPositions:pt},Wi=this.genBuffers(ti),mn=new U.Float32BufferAttribute(Wi.vertex,3);mn.name=ze||Te.attrName,mn.applyMatrix4(Re),ae.morphAttributes.position.push(mn)}parseNormals(ae){const ge=ae.MappingInformationType,Te=ae.ReferenceInformationType,Re=ae.Normals.a;let ze=[];return Te==="IndexToDirect"&&("NormalIndex"in ae?ze=ae.NormalIndex.a:"NormalsIndex"in ae&&(ze=ae.NormalsIndex.a)),{dataSize:3,buffer:Re,indices:ze,mappingType:ge,referenceType:Te}}parseUVs(ae){const ge=ae.MappingInformationType,Te=ae.ReferenceInformationType,Re=ae.UV.a;let ze=[];return Te==="IndexToDirect"&&(ze=ae.UVIndex.a),{dataSize:2,buffer:Re,indices:ze,mappingType:ge,referenceType:Te}}parseVertexColors(ae){const ge=ae.MappingInformationType,Te=ae.ReferenceInformationType,Re=ae.Colors.a;let ze=[];return Te==="IndexToDirect"&&(ze=ae.ColorIndex.a),{dataSize:4,buffer:Re,indices:ze,mappingType:ge,referenceType:Te}}parseMaterialIndices(ae){const ge=ae.MappingInformationType,Te=ae.ReferenceInformationType;if(ge==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:Te};const Re=ae.Materials.a,ze=[];for(let Ie=0;Ie<Re.length;++Ie)ze.push(Ie);return{dataSize:1,buffer:Re,indices:ze,mappingType:ge,referenceType:Te}}parseNurbsGeometry(ae){if(U.NURBSCurve===void 0)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new U.BufferGeometry;const ge=parseInt(ae.Order);if(isNaN(ge))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",ae.Order,ae.id),new U.BufferGeometry;const Te=ge-1,Re=ae.KnotVector.a,ze=[],Ie=ae.Points.a;for(let ti=0,Wi=Ie.length;ti<Wi;ti+=4)ze.push(new U.Vector4().fromArray(Ie,ti));let it,vt;if(ae.Form==="Closed")ze.push(ze[0]);else if(ae.Form==="Periodic"){it=Te,vt=Re.length-1-it;for(let ti=0;ti<Te;++ti)ze.push(ze[ti])}const pt=new U.NURBSCurve(Te,Re,ze,it,vt).getPoints(ze.length*12);return new U.BufferGeometry().setFromPoints(pt)}}class Je{parse(){const ae=[],ge=this.parseClips();if(ge!==void 0)for(const Te in ge){const Re=ge[Te],ze=this.addClip(Re);ae.push(ze)}return ae}parseClips(){if(St.Objects.AnimationCurve===void 0)return;const ae=this.parseAnimationCurveNodes();this.parseAnimationCurves(ae);const ge=this.parseAnimationLayers(ae);return this.parseAnimStacks(ge)}parseAnimationCurveNodes(){const ae=St.Objects.AnimationCurveNode,ge=new Map;for(const Te in ae){const Re=ae[Te];if(Re.attrName.match(/S|R|T|DeformPercent/)!==null){const ze={id:Re.id,attr:Re.attrName,curves:{}};ge.set(ze.id,ze)}}return ge}parseAnimationCurves(ae){const ge=St.Objects.AnimationCurve;for(const Te in ge){const Re={id:ge[Te].id,times:ge[Te].KeyTime.a.map(Tt),values:ge[Te].KeyValueFloat.a},ze=ei.get(Re.id);if(ze!==void 0){const Ie=ze.parents[0].ID,it=ze.parents[0].relationship;it.match(/X/)?ae.get(Ie).curves.x=Re:it.match(/Y/)?ae.get(Ie).curves.y=Re:it.match(/Z/)?ae.get(Ie).curves.z=Re:it.match(/d|DeformPercent/)&&ae.has(Ie)&&(ae.get(Ie).curves.morph=Re)}}}parseAnimationLayers(ae){const ge=St.Objects.AnimationLayer,Te=new Map;for(const Re in ge){const ze=[],Ie=ei.get(parseInt(Re));Ie!==void 0&&(Ie.children.forEach(function(vt,bt){if(ae.has(vt.ID)){const pt=ae.get(vt.ID);if(pt.curves.x!==void 0||pt.curves.y!==void 0||pt.curves.z!==void 0){if(ze[bt]===void 0){const ti=ei.get(vt.ID).parents.filter(function(Wi){return Wi.relationship!==void 0})[0].ID;if(ti!==void 0){const Wi=St.Objects.Model[ti.toString()];if(Wi===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",vt);return}const mn={modelName:Wi.attrName?U.PropertyBinding.sanitizeNodeName(Wi.attrName):"",ID:Wi.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Le.traverse(function(fn){fn.ID===Wi.id&&(mn.transform=fn.matrix,fn.userData.transformData&&(mn.eulerOrder=fn.userData.transformData.eulerOrder))}),mn.transform||(mn.transform=new U.Matrix4),"PreRotation"in Wi&&(mn.preRotation=Wi.PreRotation.value),"PostRotation"in Wi&&(mn.postRotation=Wi.PostRotation.value),ze[bt]=mn}}ze[bt]&&(ze[bt][pt.attr]=pt)}else if(pt.curves.morph!==void 0){if(ze[bt]===void 0){const ti=ei.get(vt.ID).parents.filter(function(jr){return jr.relationship!==void 0})[0].ID,Wi=ei.get(ti).parents[0].ID,mn=ei.get(Wi).parents[0].ID,fn=ei.get(mn).parents[0].ID,vr=St.Objects.Model[fn],et={modelName:vr.attrName?U.PropertyBinding.sanitizeNodeName(vr.attrName):"",morphName:St.Objects.Deformer[ti].attrName};ze[bt]=et}ze[bt][pt.attr]=pt}}}),Te.set(parseInt(Re),ze))}return Te}parseAnimStacks(ae){const ge=St.Objects.AnimationStack,Te={};for(const Re in ge){const ze=ei.get(parseInt(Re)).children;ze.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const Ie=ae.get(ze[0].ID);Te[Re]={name:ge[Re].attrName,layer:Ie}}return Te}addClip(ae){let ge=[];const Te=this;return ae.layer.forEach(function(Re){ge=ge.concat(Te.generateTracks(Re))}),new U.AnimationClip(ae.name,-1,ge)}generateTracks(ae){const ge=[];let Te=new U.Vector3,Re=new U.Quaternion,ze=new U.Vector3;if(ae.transform&&ae.transform.decompose(Te,Re,ze),Te=Te.toArray(),Re=new U.Euler().setFromQuaternion(Re,ae.eulerOrder).toArray(),ze=ze.toArray(),ae.T!==void 0&&Object.keys(ae.T.curves).length>0){const Ie=this.generateVectorTrack(ae.modelName,ae.T.curves,Te,"position");Ie!==void 0&&ge.push(Ie)}if(ae.R!==void 0&&Object.keys(ae.R.curves).length>0){const Ie=this.generateRotationTrack(ae.modelName,ae.R.curves,Re,ae.preRotation,ae.postRotation,ae.eulerOrder);Ie!==void 0&&ge.push(Ie)}if(ae.S!==void 0&&Object.keys(ae.S.curves).length>0){const Ie=this.generateVectorTrack(ae.modelName,ae.S.curves,ze,"scale");Ie!==void 0&&ge.push(Ie)}if(ae.DeformPercent!==void 0){const Ie=this.generateMorphTrack(ae);Ie!==void 0&&ge.push(Ie)}return ge}generateVectorTrack(ae,ge,Te,Re){const ze=this.getTimesForAllAxes(ge),Ie=this.getKeyframeTrackValues(ze,ge,Te);return new U.VectorKeyframeTrack(ae+"."+Re,ze,Ie)}generateRotationTrack(ae,ge,Te,Re,ze,Ie){ge.x!==void 0&&(this.interpolateRotations(ge.x),ge.x.values=ge.x.values.map(U.MathUtils.degToRad)),ge.y!==void 0&&(this.interpolateRotations(ge.y),ge.y.values=ge.y.values.map(U.MathUtils.degToRad)),ge.z!==void 0&&(this.interpolateRotations(ge.z),ge.z.values=ge.z.values.map(U.MathUtils.degToRad));const it=this.getTimesForAllAxes(ge),vt=this.getKeyframeTrackValues(it,ge,Te);Re!==void 0&&(Re=Re.map(U.MathUtils.degToRad),Re.push(Ie),Re=new U.Euler().fromArray(Re),Re=new U.Quaternion().setFromEuler(Re)),ze!==void 0&&(ze=ze.map(U.MathUtils.degToRad),ze.push(Ie),ze=new U.Euler().fromArray(ze),ze=new U.Quaternion().setFromEuler(ze).invert());const bt=new U.Quaternion,pt=new U.Euler,ti=[];for(let Wi=0;Wi<vt.length;Wi+=3)pt.set(vt[Wi],vt[Wi+1],vt[Wi+2],Ie),bt.setFromEuler(pt),Re!==void 0&&bt.premultiply(Re),ze!==void 0&&bt.multiply(ze),bt.toArray(ti,Wi/3*4);return new U.QuaternionKeyframeTrack(ae+".quaternion",it,ti)}generateMorphTrack(ae){const ge=ae.DeformPercent.curves.morph,Te=ge.values.map(function(ze){return ze/100}),Re=Le.getObjectByName(ae.modelName).morphTargetDictionary[ae.morphName];return new U.NumberKeyframeTrack(ae.modelName+".morphTargetInfluences["+Re+"]",ge.times,Te)}getTimesForAllAxes(ae){let ge=[];if(ae.x!==void 0&&(ge=ge.concat(ae.x.times)),ae.y!==void 0&&(ge=ge.concat(ae.y.times)),ae.z!==void 0&&(ge=ge.concat(ae.z.times)),ge=ge.sort(function(Te,Re){return Te-Re}),ge.length>1){let Te=1,Re=ge[0];for(let ze=1;ze<ge.length;ze++){const Ie=ge[ze];Ie!==Re&&(ge[Te]=Ie,Re=Ie,Te++)}ge=ge.slice(0,Te)}return ge}getKeyframeTrackValues(ae,ge,Te){const Re=Te,ze=[];let Ie=-1,it=-1,vt=-1;return ae.forEach(function(bt){if(ge.x&&(Ie=ge.x.times.indexOf(bt)),ge.y&&(it=ge.y.times.indexOf(bt)),ge.z&&(vt=ge.z.times.indexOf(bt)),Ie!==-1){const pt=ge.x.values[Ie];ze.push(pt),Re[0]=pt}else ze.push(Re[0]);if(it!==-1){const pt=ge.y.values[it];ze.push(pt),Re[1]=pt}else ze.push(Re[1]);if(vt!==-1){const pt=ge.z.values[vt];ze.push(pt),Re[2]=pt}else ze.push(Re[2])}),ze}interpolateRotations(ae){for(let ge=1;ge<ae.values.length;ge++){const Te=ae.values[ge-1],Re=ae.values[ge]-Te,ze=Math.abs(Re);if(ze>=180){const Ie=ze/180,it=Re/Ie;let vt=Te+it;const bt=ae.times[ge-1],ti=(ae.times[ge]-bt)/Ie;let Wi=bt+ti;const mn=[],fn=[];for(;Wi<ae.times[ge];)mn.push(Wi),Wi+=ti,fn.push(vt),vt+=it;ae.times=Yt(ae.times,ge,mn),ae.values=Yt(ae.values,ge,fn)}}}}class rt{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(ae){this.nodeStack.push(ae),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(ae,ge){this.currentProp=ae,this.currentPropName=ge}parse(ae){this.currentIndent=0,this.allNodes=new Ai,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const ge=this,Te=ae.split(/[\r\n]+/);return Te.forEach(function(Re,ze){const Ie=Re.match(/^[\s\t]*;/),it=Re.match(/^[\s\t]*$/);if(Ie||it)return;const vt=Re.match("^\\t{"+ge.currentIndent+"}(\\w+):(.*){",""),bt=Re.match("^\\t{"+ge.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),pt=Re.match("^\\t{"+(ge.currentIndent-1)+"}}");vt?ge.parseNodeBegin(Re,vt):bt?ge.parseNodeProperty(Re,bt,Te[++ze]):pt?ge.popStack():Re.match(/^[^\s\t}]/)&&ge.parseNodePropertyContinued(Re)}),this.allNodes}parseNodeBegin(ae,ge){const Te=ge[1].trim().replace(/^"/,"").replace(/"$/,""),Re=ge[2].split(",").map(function(vt){return vt.trim().replace(/^"/,"").replace(/"$/,"")}),ze={name:Te},Ie=this.parseNodeAttr(Re),it=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(Te,ze):Te in it?(Te==="PoseNode"?it.PoseNode.push(ze):it[Te].id!==void 0&&(it[Te]={},it[Te][it[Te].id]=it[Te]),Ie.id!==""&&(it[Te][Ie.id]=ze)):typeof Ie.id=="number"?(it[Te]={},it[Te][Ie.id]=ze):Te!=="Properties70"&&(Te==="PoseNode"?it[Te]=[ze]:it[Te]=ze),typeof Ie.id=="number"&&(ze.id=Ie.id),Ie.name!==""&&(ze.attrName=Ie.name),Ie.type!==""&&(ze.attrType=Ie.type),this.pushStack(ze)}parseNodeAttr(ae){let ge=ae[0];ae[0]!==""&&(ge=parseInt(ae[0]),isNaN(ge)&&(ge=ae[0]));let Te="",Re="";return ae.length>1&&(Te=ae[1].replace(/^(\w+)::/,""),Re=ae[2]),{id:ge,name:Te,type:Re}}parseNodeProperty(ae,ge,Te){let Re=ge[1].replace(/^"/,"").replace(/"$/,"").trim(),ze=ge[2].replace(/^"/,"").replace(/"$/,"").trim();Re==="Content"&&ze===","&&(ze=Te.replace(/"/g,"").replace(/,$/,"").trim());const Ie=this.getCurrentNode();if(Ie.name==="Properties70"){this.parseNodeSpecialProperty(ae,Re,ze);return}if(Re==="C"){const vt=ze.split(",").slice(1),bt=parseInt(vt[0]),pt=parseInt(vt[1]);let ti=ze.split(",").slice(3);ti=ti.map(function(Wi){return Wi.trim().replace(/^"/,"")}),Re="connections",ze=[bt,pt],Ci(ze,ti),Ie[Re]===void 0&&(Ie[Re]=[])}Re==="Node"&&(Ie.id=ze),Re in Ie&&Array.isArray(Ie[Re])?Ie[Re].push(ze):Re!=="a"?Ie[Re]=ze:Ie.a=ze,this.setCurrentProp(Ie,Re),Re==="a"&&ze.slice(-1)!==","&&(Ie.a=Fi(ze))}parseNodePropertyContinued(ae){const ge=this.getCurrentNode();ge.a+=ae,ae.slice(-1)!==","&&(ge.a=Fi(ge.a))}parseNodeSpecialProperty(ae,ge,Te){const Re=Te.split('",').map(function(pt){return pt.trim().replace(/^\"/,"").replace(/\s/,"_")}),ze=Re[0],Ie=Re[1],it=Re[2],vt=Re[3];let bt=Re[4];switch(Ie){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":bt=parseFloat(bt);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":bt=Fi(bt);break}this.getPrevNode()[ze]={type:Ie,type2:it,flag:vt,value:bt},this.setCurrentProp(this.getPrevNode(),ze)}}class ai{parse(ae){const ge=new bi(ae);ge.skip(23);const Te=ge.getUint32();if(Te<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Te);const Re=new Ai;for(;!this.endOfContent(ge);){const ze=this.parseNode(ge,Te);ze!==null&&Re.add(ze.name,ze)}return Re}endOfContent(ae){return ae.size()%16===0?(ae.getOffset()+160+16&-16)>=ae.size():ae.getOffset()+160+16>=ae.size()}parseNode(ae,ge){const Te={},Re=ge>=7500?ae.getUint64():ae.getUint32(),ze=ge>=7500?ae.getUint64():ae.getUint32();ge>=7500?ae.getUint64():ae.getUint32();const Ie=ae.getUint8(),it=ae.getString(Ie);if(Re===0)return null;const vt=[];for(let Wi=0;Wi<ze;Wi++)vt.push(this.parseProperty(ae));const bt=vt.length>0?vt[0]:"",pt=vt.length>1?vt[1]:"",ti=vt.length>2?vt[2]:"";for(Te.singleProperty=ze===1&&ae.getOffset()===Re;Re>ae.getOffset();){const Wi=this.parseNode(ae,ge);Wi!==null&&this.parseSubNode(it,Te,Wi)}return Te.propertyList=vt,typeof bt=="number"&&(Te.id=bt),pt!==""&&(Te.attrName=pt),ti!==""&&(Te.attrType=ti),it!==""&&(Te.name=it),Te}parseSubNode(ae,ge,Te){if(Te.singleProperty===!0){const Re=Te.propertyList[0];Array.isArray(Re)?(ge[Te.name]=Te,Te.a=Re):ge[Te.name]=Re}else if(ae==="Connections"&&Te.name==="C"){const Re=[];Te.propertyList.forEach(function(ze,Ie){Ie!==0&&Re.push(ze)}),ge.connections===void 0&&(ge.connections=[]),ge.connections.push(Re)}else if(Te.name==="Properties70")Object.keys(Te).forEach(function(ze){ge[ze]=Te[ze]});else if(ae==="Properties70"&&Te.name==="P"){let Re=Te.propertyList[0],ze=Te.propertyList[1];const Ie=Te.propertyList[2],it=Te.propertyList[3];let vt;Re.indexOf("Lcl ")===0&&(Re=Re.replace("Lcl ","Lcl_")),ze.indexOf("Lcl ")===0&&(ze=ze.replace("Lcl ","Lcl_")),ze==="Color"||ze==="ColorRGB"||ze==="Vector"||ze==="Vector3D"||ze.indexOf("Lcl_")===0?vt=[Te.propertyList[4],Te.propertyList[5],Te.propertyList[6]]:vt=Te.propertyList[4],ge[Re]={type:ze,type2:Ie,flag:it,value:vt}}else ge[Te.name]===void 0?typeof Te.id=="number"?(ge[Te.name]={},ge[Te.name][Te.id]=Te):ge[Te.name]=Te:Te.name==="PoseNode"?(Array.isArray(ge[Te.name])||(ge[Te.name]=[ge[Te.name]]),ge[Te.name].push(Te)):ge[Te.name][Te.id]===void 0&&(ge[Te.name][Te.id]=Te)}parseProperty(ae){const ge=ae.getString(1);let Te;switch(ge){case"C":return ae.getBoolean();case"D":return ae.getFloat64();case"F":return ae.getFloat32();case"I":return ae.getInt32();case"L":return ae.getInt64();case"R":return Te=ae.getUint32(),ae.getArrayBuffer(Te);case"S":return Te=ae.getUint32(),ae.getString(Te);case"Y":return ae.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const Re=ae.getUint32(),ze=ae.getUint32(),Ie=ae.getUint32();if(ze===0)switch(ge){case"b":case"c":return ae.getBooleanArray(Re);case"d":return ae.getFloat64Array(Re);case"f":return ae.getFloat32Array(Re);case"i":return ae.getInt32Array(Re);case"l":return ae.getInt64Array(Re)}typeof Ze>"u"&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const it=Ze.unzlibSync(new Uint8Array(ae.getArrayBuffer(Ie))),vt=new bi(it.buffer);switch(ge){case"b":case"c":return vt.getBooleanArray(Re);case"d":return vt.getFloat64Array(Re);case"f":return vt.getFloat32Array(Re);case"i":return vt.getInt32Array(Re);case"l":return vt.getInt64Array(Re)}default:throw new Error("THREE.FBXLoader: Unknown property type "+ge)}}}class bi{constructor(ae,ge){this.dv=new DataView(ae),this.offset=0,this.littleEndian=ge!==void 0?ge:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(ae){this.offset+=ae}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(ae){const ge=[];for(let Te=0;Te<ae;Te++)ge.push(this.getBoolean());return ge}getUint8(){const ae=this.dv.getUint8(this.offset);return this.offset+=1,ae}getInt16(){const ae=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,ae}getInt32(){const ae=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,ae}getInt32Array(ae){const ge=[];for(let Te=0;Te<ae;Te++)ge.push(this.getInt32());return ge}getUint32(){const ae=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,ae}getInt64(){let ae,ge;return this.littleEndian?(ae=this.getUint32(),ge=this.getUint32()):(ge=this.getUint32(),ae=this.getUint32()),ge&2147483648?(ge=~ge&4294967295,ae=~ae&4294967295,ae===4294967295&&(ge=ge+1&4294967295),ae=ae+1&4294967295,-(ge*4294967296+ae)):ge*4294967296+ae}getInt64Array(ae){const ge=[];for(let Te=0;Te<ae;Te++)ge.push(this.getInt64());return ge}getUint64(){let ae,ge;return this.littleEndian?(ae=this.getUint32(),ge=this.getUint32()):(ge=this.getUint32(),ae=this.getUint32()),ge*4294967296+ae}getFloat32(){const ae=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,ae}getFloat32Array(ae){const ge=[];for(let Te=0;Te<ae;Te++)ge.push(this.getFloat32());return ge}getFloat64(){const ae=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,ae}getFloat64Array(ae){const ge=[];for(let Te=0;Te<ae;Te++)ge.push(this.getFloat64());return ge}getArrayBuffer(ae){const ge=this.dv.buffer.slice(this.offset,this.offset+ae);return this.offset+=ae,ge}getString(ae){let ge=[];for(let Re=0;Re<ae;Re++)ge[Re]=this.getUint8();const Te=ge.indexOf(0);return Te>=0&&(ge=ge.slice(0,Te)),U.LoaderUtils.decodeText(new Uint8Array(ge))}}class Ai{add(ae,ge){this[ae]=ge}}function qt(vi){const ae="Kaydara FBX Binary  \0";return vi.byteLength>=ae.length&&ae===oi(vi,0,ae.length)}function xi(vi){const ae=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let ge=0;function Te(Re){const ze=vi[Re-1];return vi=vi.slice(ge+Re),ge++,ze}for(let Re=0;Re<ae.length;++Re)if(Te(1)===ae[Re])return!1;return!0}function kt(vi){const ae=/FBXVersion: (\d+)/,ge=vi.match(ae);if(ge)return parseInt(ge[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Tt(vi){return vi/46186158e3}const ln=[];function Xi(vi,ae,ge,Te){let Re;switch(Te.mappingType){case"ByPolygonVertex":Re=vi;break;case"ByPolygon":Re=ae;break;case"ByVertice":Re=ge;break;case"AllSame":Re=Te.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+Te.mappingType)}Te.referenceType==="IndexToDirect"&&(Re=Te.indices[Re]);const ze=Re*Te.dataSize,Ie=ze+Te.dataSize;return Zt(ln,Te.buffer,ze,Ie)}const Dt=new U.Euler,ni=new U.Vector3;function ci(vi){const ae=new U.Matrix4,ge=new U.Matrix4,Te=new U.Matrix4,Re=new U.Matrix4,ze=new U.Matrix4,Ie=new U.Matrix4,it=new U.Matrix4,vt=new U.Matrix4,bt=new U.Matrix4,pt=new U.Matrix4,ti=new U.Matrix4,Wi=new U.Matrix4,mn=vi.inheritType?vi.inheritType:0;if(vi.translation&&ae.setPosition(ni.fromArray(vi.translation)),vi.preRotation){const Rt=vi.preRotation.map(U.MathUtils.degToRad);Rt.push(vi.eulerOrder),ge.makeRotationFromEuler(Dt.fromArray(Rt))}if(vi.rotation){const Rt=vi.rotation.map(U.MathUtils.degToRad);Rt.push(vi.eulerOrder),Te.makeRotationFromEuler(Dt.fromArray(Rt))}if(vi.postRotation){const Rt=vi.postRotation.map(U.MathUtils.degToRad);Rt.push(vi.eulerOrder),Re.makeRotationFromEuler(Dt.fromArray(Rt)),Re.invert()}vi.scale&&ze.scale(ni.fromArray(vi.scale)),vi.scalingOffset&&it.setPosition(ni.fromArray(vi.scalingOffset)),vi.scalingPivot&&Ie.setPosition(ni.fromArray(vi.scalingPivot)),vi.rotationOffset&&vt.setPosition(ni.fromArray(vi.rotationOffset)),vi.rotationPivot&&bt.setPosition(ni.fromArray(vi.rotationPivot)),vi.parentMatrixWorld&&(ti.copy(vi.parentMatrix),pt.copy(vi.parentMatrixWorld));const fn=ge.clone().multiply(Te).multiply(Re),vr=new U.Matrix4;vr.extractRotation(pt);const et=new U.Matrix4;et.copyPosition(pt);const jr=et.clone().invert().multiply(pt),Ra=vr.clone().invert().multiply(jr),ra=ze,Pi=new U.Matrix4;if(mn===0)Pi.copy(vr).multiply(fn).multiply(Ra).multiply(ra);else if(mn===1)Pi.copy(vr).multiply(Ra).multiply(fn).multiply(ra);else{const Ut=new U.Matrix4().scale(new U.Vector3().setFromMatrixScale(ti)).clone().invert(),li=Ra.clone().multiply(Ut);Pi.copy(vr).multiply(fn).multiply(li).multiply(ra)}const cn=bt.clone().invert(),Ye=Ie.clone().invert();let Xe=ae.clone().multiply(vt).multiply(bt).multiply(ge).multiply(Te).multiply(Re).multiply(cn).multiply(it).multiply(Ie).multiply(ze).multiply(Ye);const ft=new U.Matrix4().copyPosition(Xe),ct=pt.clone().multiply(ft);return Wi.copyPosition(ct),Xe=Wi.clone().multiply(Pi),Xe.premultiply(pt.invert()),Xe}function Nn(vi){vi=vi||0;const ae=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return vi===6?(console.warn("THREE.FBXLoader: unsupported THREE.Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),ae[0]):ae[vi]}function Fi(vi){return vi.split(",").map(function(ge){return parseFloat(ge)})}function oi(vi,ae,ge){return ae===void 0&&(ae=0),ge===void 0&&(ge=vi.byteLength),U.LoaderUtils.decodeText(new Uint8Array(vi,ae,ge))}function Ci(vi,ae){for(let ge=0,Te=vi.length,Re=ae.length;ge<Re;ge++,Te++)vi[Te]=ae[ge]}function Zt(vi,ae,ge,Te){for(let Re=ge,ze=0;Re<Te;Re++,ze++)vi[ze]=ae[Re];return vi}function Yt(vi,ae,ge){return vi.slice(0,ae).concat(ge).concat(vi.slice(ae))}U.FBXLoader=r})(),En.exports=U.FBXLoader}(xy)),xy.exports}var by={exports:{}},rx;function Lb(){return rx||(rx=1,function(En,na){const U=Oc();(function(){class Ze extends U.Loader{constructor(Ye){super(Ye),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(Xe){return new Ge(Xe)}),this.register(function(Xe){return new bi(Xe)}),this.register(function(Xe){return new Ai(Xe)}),this.register(function(Xe){return new de(Xe)}),this.register(function(Xe){return new Je(Xe)}),this.register(function(Xe){return new rt(Xe)}),this.register(function(Xe){return new ai(Xe)}),this.register(function(Xe){return new Le(Xe)}),this.register(function(Xe){return new qt(Xe)})}load(Ye,Xe,ft,ct){const Rt=this;let Ut;this.resourcePath!==""?Ut=this.resourcePath:this.path!==""?Ut=this.path:Ut=U.LoaderUtils.extractUrlBase(Ye),this.manager.itemStart(Ye);const li=function(ii){ct?ct(ii):console.error(ii),Rt.manager.itemError(Ye),Rt.manager.itemEnd(Ye)},$t=new U.FileLoader(this.manager);$t.setPath(this.path),$t.setResponseType("arraybuffer"),$t.setRequestHeader(this.requestHeader),$t.setWithCredentials(this.withCredentials),$t.load(Ye,function(ii){try{Rt.parse(ii,Ut,function(Tn){Xe(Tn),Rt.manager.itemEnd(Ye)},li)}catch(Tn){li(Tn)}},ft,li)}setDRACOLoader(Ye){return this.dracoLoader=Ye,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(Ye){return this.ktx2Loader=Ye,this}setMeshoptDecoder(Ye){return this.meshoptDecoder=Ye,this}register(Ye){return this.pluginCallbacks.indexOf(Ye)===-1&&this.pluginCallbacks.push(Ye),this}unregister(Ye){return this.pluginCallbacks.indexOf(Ye)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(Ye),1),this}parse(Ye,Xe,ft,ct){let Rt;const Ut={},li={};if(typeof Ye=="string")Rt=Ye;else if(U.LoaderUtils.decodeText(new Uint8Array(Ye,0,4))===xi){try{Ut[ei.KHR_BINARY_GLTF]=new ln(Ye)}catch(wn){ct&&ct(wn);return}Rt=Ut[ei.KHR_BINARY_GLTF].content}else Rt=U.LoaderUtils.decodeText(new Uint8Array(Ye));const $t=JSON.parse(Rt);if($t.asset===void 0||$t.asset.version[0]<2){ct&&ct(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const ii=new et($t,{path:Xe||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});ii.fileLoader.setRequestHeader(this.requestHeader);for(let Tn=0;Tn<this.pluginCallbacks.length;Tn++){const wn=this.pluginCallbacks[Tn](ii);li[wn.name]=wn,Ut[wn.name]=!0}if($t.extensionsUsed)for(let Tn=0;Tn<$t.extensionsUsed.length;++Tn){const wn=$t.extensionsUsed[Tn],gr=$t.extensionsRequired||[];switch(wn){case ei.KHR_MATERIALS_UNLIT:Ut[wn]=new r;break;case ei.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:Ut[wn]=new ci;break;case ei.KHR_DRACO_MESH_COMPRESSION:Ut[wn]=new Xi($t,this.dracoLoader);break;case ei.KHR_TEXTURE_TRANSFORM:Ut[wn]=new Dt;break;case ei.KHR_MESH_QUANTIZATION:Ut[wn]=new Nn;break;default:gr.indexOf(wn)>=0&&li[wn]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+wn+'".')}}ii.setExtensions(Ut),ii.setPlugins(li),ii.parse(ft,ct)}}function St(){let cn={};return{get:function(Ye){return cn[Ye]},add:function(Ye,Xe){cn[Ye]=Xe},remove:function(Ye){delete cn[Ye]},removeAll:function(){cn={}}}}const ei={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class Le{constructor(Ye){this.parser=Ye,this.name=ei.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const Ye=this.parser,Xe=this.parser.json.nodes||[];for(let ft=0,ct=Xe.length;ft<ct;ft++){const Rt=Xe[ft];Rt.extensions&&Rt.extensions[this.name]&&Rt.extensions[this.name].light!==void 0&&Ye._addNodeRef(this.cache,Rt.extensions[this.name].light)}}_loadLight(Ye){const Xe=this.parser,ft="light:"+Ye;let ct=Xe.cache.get(ft);if(ct)return ct;const Rt=Xe.json,$t=((Rt.extensions&&Rt.extensions[this.name]||{}).lights||[])[Ye];let ii;const Tn=new U.Color(16777215);$t.color!==void 0&&Tn.fromArray($t.color);const wn=$t.range!==void 0?$t.range:0;switch($t.type){case"directional":ii=new U.DirectionalLight(Tn),ii.target.position.set(0,0,-1),ii.add(ii.target);break;case"point":ii=new U.PointLight(Tn),ii.distance=wn;break;case"spot":ii=new U.SpotLight(Tn),ii.distance=wn,$t.spot=$t.spot||{},$t.spot.innerConeAngle=$t.spot.innerConeAngle!==void 0?$t.spot.innerConeAngle:0,$t.spot.outerConeAngle=$t.spot.outerConeAngle!==void 0?$t.spot.outerConeAngle:Math.PI/4,ii.angle=$t.spot.outerConeAngle,ii.penumbra=1-$t.spot.innerConeAngle/$t.spot.outerConeAngle,ii.target.position.set(0,0,-1),ii.add(ii.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+$t.type)}return ii.position.set(0,0,0),ii.decay=2,$t.intensity!==void 0&&(ii.intensity=$t.intensity),ii.name=Xe.createUniqueName($t.name||"light_"+Ye),ct=Promise.resolve(ii),Xe.cache.add(ft,ct),ct}createNodeAttachment(Ye){const Xe=this,ft=this.parser,Rt=ft.json.nodes[Ye],li=(Rt.extensions&&Rt.extensions[this.name]||{}).light;return li===void 0?null:this._loadLight(li).then(function($t){return ft._getNodeRef(Xe.cache,li,$t)})}}class r{constructor(){this.name=ei.KHR_MATERIALS_UNLIT}getMaterialType(){return U.MeshBasicMaterial}extendParams(Ye,Xe,ft){const ct=[];Ye.color=new U.Color(1,1,1),Ye.opacity=1;const Rt=Xe.pbrMetallicRoughness;if(Rt){if(Array.isArray(Rt.baseColorFactor)){const Ut=Rt.baseColorFactor;Ye.color.fromArray(Ut),Ye.opacity=Ut[3]}Rt.baseColorTexture!==void 0&&ct.push(ft.assignTexture(Ye,"map",Rt.baseColorTexture))}return Promise.all(ct)}}class Ge{constructor(Ye){this.parser=Ye,this.name=ei.KHR_MATERIALS_CLEARCOAT}getMaterialType(Ye){const ft=this.parser.json.materials[Ye];return!ft.extensions||!ft.extensions[this.name]?null:U.MeshPhysicalMaterial}extendMaterialParams(Ye,Xe){const ft=this.parser,ct=ft.json.materials[Ye];if(!ct.extensions||!ct.extensions[this.name])return Promise.resolve();const Rt=[],Ut=ct.extensions[this.name];if(Ut.clearcoatFactor!==void 0&&(Xe.clearcoat=Ut.clearcoatFactor),Ut.clearcoatTexture!==void 0&&Rt.push(ft.assignTexture(Xe,"clearcoatMap",Ut.clearcoatTexture)),Ut.clearcoatRoughnessFactor!==void 0&&(Xe.clearcoatRoughness=Ut.clearcoatRoughnessFactor),Ut.clearcoatRoughnessTexture!==void 0&&Rt.push(ft.assignTexture(Xe,"clearcoatRoughnessMap",Ut.clearcoatRoughnessTexture)),Ut.clearcoatNormalTexture!==void 0&&(Rt.push(ft.assignTexture(Xe,"clearcoatNormalMap",Ut.clearcoatNormalTexture)),Ut.clearcoatNormalTexture.scale!==void 0)){const li=Ut.clearcoatNormalTexture.scale;Xe.clearcoatNormalScale=new U.Vector2(li,-li)}return Promise.all(Rt)}}class de{constructor(Ye){this.parser=Ye,this.name=ei.KHR_MATERIALS_TRANSMISSION}getMaterialType(Ye){const ft=this.parser.json.materials[Ye];return!ft.extensions||!ft.extensions[this.name]?null:U.MeshPhysicalMaterial}extendMaterialParams(Ye,Xe){const ft=this.parser,ct=ft.json.materials[Ye];if(!ct.extensions||!ct.extensions[this.name])return Promise.resolve();const Rt=[],Ut=ct.extensions[this.name];return Ut.transmissionFactor!==void 0&&(Xe.transmission=Ut.transmissionFactor),Ut.transmissionTexture!==void 0&&Rt.push(ft.assignTexture(Xe,"transmissionMap",Ut.transmissionTexture)),Promise.all(Rt)}}class Je{constructor(Ye){this.parser=Ye,this.name=ei.KHR_MATERIALS_VOLUME}getMaterialType(Ye){const ft=this.parser.json.materials[Ye];return!ft.extensions||!ft.extensions[this.name]?null:U.MeshPhysicalMaterial}extendMaterialParams(Ye,Xe){const ft=this.parser,ct=ft.json.materials[Ye];if(!ct.extensions||!ct.extensions[this.name])return Promise.resolve();const Rt=[],Ut=ct.extensions[this.name];Xe.thickness=Ut.thicknessFactor!==void 0?Ut.thicknessFactor:0,Ut.thicknessTexture!==void 0&&Rt.push(ft.assignTexture(Xe,"thicknessMap",Ut.thicknessTexture)),Xe.attenuationDistance=Ut.attenuationDistance||0;const li=Ut.attenuationColor||[1,1,1];return Xe.attenuationTint=new U.Color(li[0],li[1],li[2]),Promise.all(Rt)}}class rt{constructor(Ye){this.parser=Ye,this.name=ei.KHR_MATERIALS_IOR}getMaterialType(Ye){const ft=this.parser.json.materials[Ye];return!ft.extensions||!ft.extensions[this.name]?null:U.MeshPhysicalMaterial}extendMaterialParams(Ye,Xe){const ct=this.parser.json.materials[Ye];if(!ct.extensions||!ct.extensions[this.name])return Promise.resolve();const Rt=ct.extensions[this.name];return Xe.ior=Rt.ior!==void 0?Rt.ior:1.5,Promise.resolve()}}class ai{constructor(Ye){this.parser=Ye,this.name=ei.KHR_MATERIALS_SPECULAR}getMaterialType(Ye){const ft=this.parser.json.materials[Ye];return!ft.extensions||!ft.extensions[this.name]?null:U.MeshPhysicalMaterial}extendMaterialParams(Ye,Xe){const ft=this.parser,ct=ft.json.materials[Ye];if(!ct.extensions||!ct.extensions[this.name])return Promise.resolve();const Rt=[],Ut=ct.extensions[this.name];Xe.specularIntensity=Ut.specularFactor!==void 0?Ut.specularFactor:1,Ut.specularTexture!==void 0&&Rt.push(ft.assignTexture(Xe,"specularIntensityMap",Ut.specularTexture));const li=Ut.specularColorFactor||[1,1,1];return Xe.specularTint=new U.Color(li[0],li[1],li[2]),Ut.specularColorTexture!==void 0&&Rt.push(ft.assignTexture(Xe,"specularTintMap",Ut.specularColorTexture).then(function($t){$t.encoding=U.sRGBEncoding})),Promise.all(Rt)}}class bi{constructor(Ye){this.parser=Ye,this.name=ei.KHR_TEXTURE_BASISU}loadTexture(Ye){const Xe=this.parser,ft=Xe.json,ct=ft.textures[Ye];if(!ct.extensions||!ct.extensions[this.name])return null;const Rt=ct.extensions[this.name],Ut=ft.images[Rt.source],li=Xe.options.ktx2Loader;if(!li){if(ft.extensionsRequired&&ft.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return Xe.loadTextureImage(Ye,Ut,li)}}class Ai{constructor(Ye){this.parser=Ye,this.name=ei.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(Ye){const Xe=this.name,ft=this.parser,ct=ft.json,Rt=ct.textures[Ye];if(!Rt.extensions||!Rt.extensions[Xe])return null;const Ut=Rt.extensions[Xe],li=ct.images[Ut.source];let $t=ft.textureLoader;if(li.uri){const ii=ft.options.manager.getHandler(li.uri);ii!==null&&($t=ii)}return this.detectSupport().then(function(ii){if(ii)return ft.loadTextureImage(Ye,li,$t);if(ct.extensionsRequired&&ct.extensionsRequired.indexOf(Xe)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return ft.loadTexture(Ye)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(Ye){const Xe=new Image;Xe.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",Xe.onload=Xe.onerror=function(){Ye(Xe.height===1)}})),this.isSupported}}class qt{constructor(Ye){this.name=ei.EXT_MESHOPT_COMPRESSION,this.parser=Ye}loadBufferView(Ye){const Xe=this.parser.json,ft=Xe.bufferViews[Ye];if(ft.extensions&&ft.extensions[this.name]){const ct=ft.extensions[this.name],Rt=this.parser.getDependency("buffer",ct.buffer),Ut=this.parser.options.meshoptDecoder;if(!Ut||!Ut.supported){if(Xe.extensionsRequired&&Xe.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([Rt,Ut.ready]).then(function(li){const $t=ct.byteOffset||0,ii=ct.byteLength||0,Tn=ct.count,wn=ct.byteStride,gr=new ArrayBuffer(Tn*wn),cr=new Uint8Array(li[0],$t,ii);return Ut.decodeGltfBuffer(new Uint8Array(gr),Tn,wn,cr,ct.mode,ct.filter),gr})}else return null}}const xi="glTF",kt=12,Tt={JSON:1313821514,BIN:5130562};class ln{constructor(Ye){this.name=ei.KHR_BINARY_GLTF,this.content=null,this.body=null;const Xe=new DataView(Ye,0,kt);if(this.header={magic:U.LoaderUtils.decodeText(new Uint8Array(Ye.slice(0,4))),version:Xe.getUint32(4,!0),length:Xe.getUint32(8,!0)},this.header.magic!==xi)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const ft=this.header.length-kt,ct=new DataView(Ye,kt);let Rt=0;for(;Rt<ft;){const Ut=ct.getUint32(Rt,!0);Rt+=4;const li=ct.getUint32(Rt,!0);if(Rt+=4,li===Tt.JSON){const $t=new Uint8Array(Ye,kt+Rt,Ut);this.content=U.LoaderUtils.decodeText($t)}else if(li===Tt.BIN){const $t=kt+Rt;this.body=Ye.slice($t,$t+Ut)}Rt+=Ut}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Xi{constructor(Ye,Xe){if(!Xe)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ei.KHR_DRACO_MESH_COMPRESSION,this.json=Ye,this.dracoLoader=Xe,this.dracoLoader.preload()}decodePrimitive(Ye,Xe){const ft=this.json,ct=this.dracoLoader,Rt=Ye.extensions[this.name].bufferView,Ut=Ye.extensions[this.name].attributes,li={},$t={},ii={};for(const Tn in Ut){const wn=Te[Tn]||Tn.toLowerCase();li[wn]=Ut[Tn]}for(const Tn in Ye.attributes){const wn=Te[Tn]||Tn.toLowerCase();if(Ut[Tn]!==void 0){const gr=ft.accessors[Ye.attributes[Tn]],cr=Yt[gr.componentType];ii[wn]=cr,$t[wn]=gr.normalized===!0}}return Xe.getDependency("bufferView",Rt).then(function(Tn){return new Promise(function(wn){ct.decodeDracoFile(Tn,function(gr){for(const cr in gr.attributes){const Sr=gr.attributes[cr],Er=$t[cr];Er!==void 0&&(Sr.normalized=Er)}wn(gr)},li,ii)})})}}class Dt{constructor(){this.name=ei.KHR_TEXTURE_TRANSFORM}extendTexture(Ye,Xe){return Xe.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),Xe.offset===void 0&&Xe.rotation===void 0&&Xe.scale===void 0||(Ye=Ye.clone(),Xe.offset!==void 0&&Ye.offset.fromArray(Xe.offset),Xe.rotation!==void 0&&(Ye.rotation=Xe.rotation),Xe.scale!==void 0&&Ye.repeat.fromArray(Xe.scale),Ye.needsUpdate=!0),Ye}}class ni extends U.MeshStandardMaterial{constructor(Ye){super(),this.isGLTFSpecularGlossinessMaterial=!0;const Xe=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),ft=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),ct=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	texelSpecular = sRGBToLinear( texelSpecular );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),Rt=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),Ut=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),li={specular:{value:new U.Color().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=li,this.onBeforeCompile=function($t){for(const ii in li)$t.uniforms[ii]=li[ii];$t.fragmentShader=$t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",Xe).replace("#include <metalnessmap_pars_fragment>",ft).replace("#include <roughnessmap_fragment>",ct).replace("#include <metalnessmap_fragment>",Rt).replace("#include <lights_physical_fragment>",Ut)},Object.defineProperties(this,{specular:{get:function(){return li.specular.value},set:function($t){li.specular.value=$t}},specularMap:{get:function(){return li.specularMap.value},set:function($t){li.specularMap.value=$t,$t?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return li.glossiness.value},set:function($t){li.glossiness.value=$t}},glossinessMap:{get:function(){return li.glossinessMap.value},set:function($t){li.glossinessMap.value=$t,$t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(Ye)}copy(Ye){return super.copy(Ye),this.specularMap=Ye.specularMap,this.specular.copy(Ye.specular),this.glossinessMap=Ye.glossinessMap,this.glossiness=Ye.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class ci{constructor(){this.name=ei.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return ni}extendParams(Ye,Xe,ft){const ct=Xe.extensions[this.name];Ye.color=new U.Color(1,1,1),Ye.opacity=1;const Rt=[];if(Array.isArray(ct.diffuseFactor)){const Ut=ct.diffuseFactor;Ye.color.fromArray(Ut),Ye.opacity=Ut[3]}if(ct.diffuseTexture!==void 0&&Rt.push(ft.assignTexture(Ye,"map",ct.diffuseTexture)),Ye.emissive=new U.Color(0,0,0),Ye.glossiness=ct.glossinessFactor!==void 0?ct.glossinessFactor:1,Ye.specular=new U.Color(1,1,1),Array.isArray(ct.specularFactor)&&Ye.specular.fromArray(ct.specularFactor),ct.specularGlossinessTexture!==void 0){const Ut=ct.specularGlossinessTexture;Rt.push(ft.assignTexture(Ye,"glossinessMap",Ut)),Rt.push(ft.assignTexture(Ye,"specularMap",Ut))}return Promise.all(Rt)}createMaterial(Ye){const Xe=new ni(Ye);return Xe.fog=!0,Xe.color=Ye.color,Xe.map=Ye.map===void 0?null:Ye.map,Xe.lightMap=null,Xe.lightMapIntensity=1,Xe.aoMap=Ye.aoMap===void 0?null:Ye.aoMap,Xe.aoMapIntensity=1,Xe.emissive=Ye.emissive,Xe.emissiveIntensity=1,Xe.emissiveMap=Ye.emissiveMap===void 0?null:Ye.emissiveMap,Xe.bumpMap=Ye.bumpMap===void 0?null:Ye.bumpMap,Xe.bumpScale=1,Xe.normalMap=Ye.normalMap===void 0?null:Ye.normalMap,Xe.normalMapType=U.TangentSpaceNormalMap,Ye.normalScale&&(Xe.normalScale=Ye.normalScale),Xe.displacementMap=null,Xe.displacementScale=1,Xe.displacementBias=0,Xe.specularMap=Ye.specularMap===void 0?null:Ye.specularMap,Xe.specular=Ye.specular,Xe.glossinessMap=Ye.glossinessMap===void 0?null:Ye.glossinessMap,Xe.glossiness=Ye.glossiness,Xe.alphaMap=null,Xe.envMap=Ye.envMap===void 0?null:Ye.envMap,Xe.envMapIntensity=1,Xe.refractionRatio=.98,Xe}}class Nn{constructor(){this.name=ei.KHR_MESH_QUANTIZATION}}class Fi extends U.Interpolant{constructor(Ye,Xe,ft,ct){super(Ye,Xe,ft,ct)}copySampleValue_(Ye){const Xe=this.resultBuffer,ft=this.sampleValues,ct=this.valueSize,Rt=Ye*ct*3+ct;for(let Ut=0;Ut!==ct;Ut++)Xe[Ut]=ft[Rt+Ut];return Xe}}Fi.prototype.beforeStart_=Fi.prototype.copySampleValue_,Fi.prototype.afterEnd_=Fi.prototype.copySampleValue_,Fi.prototype.interpolate_=function(cn,Ye,Xe,ft){const ct=this.resultBuffer,Rt=this.sampleValues,Ut=this.valueSize,li=Ut*2,$t=Ut*3,ii=ft-Ye,Tn=(Xe-Ye)/ii,wn=Tn*Tn,gr=wn*Tn,cr=cn*$t,Sr=cr-$t,Er=-2*gr+3*wn,mr=gr-wn,Nr=1-Er,Ma=mr-wn+Tn;for(let ga=0;ga!==Ut;ga++){const oo=Rt[Sr+ga+Ut],$a=Rt[Sr+ga+li]*ii,dn=Rt[cr+ga+Ut],Xn=Rt[cr+ga]*ii;ct[ga]=Nr*oo+Ma*$a+Er*dn+mr*Xn}return ct};const oi=new U.Quaternion;class Ci extends Fi{interpolate_(Ye,Xe,ft,ct){const Rt=super.interpolate_(Ye,Xe,ft,ct);return oi.fromArray(Rt).normalize().toArray(Rt),Rt}}const Zt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Yt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},vi={9728:U.NearestFilter,9729:U.LinearFilter,9984:U.NearestMipmapNearestFilter,9985:U.LinearMipmapNearestFilter,9986:U.NearestMipmapLinearFilter,9987:U.LinearMipmapLinearFilter},ae={33071:U.ClampToEdgeWrapping,33648:U.MirroredRepeatWrapping,10497:U.RepeatWrapping},ge={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Te={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Re={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ze={CUBICSPLINE:void 0,LINEAR:U.InterpolateLinear,STEP:U.InterpolateDiscrete},Ie={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function it(cn,Ye){return typeof cn!="string"||cn===""?"":(/^https?:\/\//i.test(Ye)&&/^\//.test(cn)&&(Ye=Ye.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(cn)||/^data:.*,.*$/i.test(cn)||/^blob:.*$/i.test(cn)?cn:Ye+cn)}function vt(cn){return cn.DefaultMaterial===void 0&&(cn.DefaultMaterial=new U.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:U.FrontSide})),cn.DefaultMaterial}function bt(cn,Ye,Xe){for(const ft in Xe.extensions)cn[ft]===void 0&&(Ye.userData.gltfExtensions=Ye.userData.gltfExtensions||{},Ye.userData.gltfExtensions[ft]=Xe.extensions[ft])}function pt(cn,Ye){Ye.extras!==void 0&&(typeof Ye.extras=="object"?Object.assign(cn.userData,Ye.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+Ye.extras))}function ti(cn,Ye,Xe){let ft=!1,ct=!1;for(let li=0,$t=Ye.length;li<$t;li++){const ii=Ye[li];if(ii.POSITION!==void 0&&(ft=!0),ii.NORMAL!==void 0&&(ct=!0),ft&&ct)break}if(!ft&&!ct)return Promise.resolve(cn);const Rt=[],Ut=[];for(let li=0,$t=Ye.length;li<$t;li++){const ii=Ye[li];if(ft){const Tn=ii.POSITION!==void 0?Xe.getDependency("accessor",ii.POSITION):cn.attributes.position;Rt.push(Tn)}if(ct){const Tn=ii.NORMAL!==void 0?Xe.getDependency("accessor",ii.NORMAL):cn.attributes.normal;Ut.push(Tn)}}return Promise.all([Promise.all(Rt),Promise.all(Ut)]).then(function(li){const $t=li[0],ii=li[1];return ft&&(cn.morphAttributes.position=$t),ct&&(cn.morphAttributes.normal=ii),cn.morphTargetsRelative=!0,cn})}function Wi(cn,Ye){if(cn.updateMorphTargets(),Ye.weights!==void 0)for(let Xe=0,ft=Ye.weights.length;Xe<ft;Xe++)cn.morphTargetInfluences[Xe]=Ye.weights[Xe];if(Ye.extras&&Array.isArray(Ye.extras.targetNames)){const Xe=Ye.extras.targetNames;if(cn.morphTargetInfluences.length===Xe.length){cn.morphTargetDictionary={};for(let ft=0,ct=Xe.length;ft<ct;ft++)cn.morphTargetDictionary[Xe[ft]]=ft}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function mn(cn){const Ye=cn.extensions&&cn.extensions[ei.KHR_DRACO_MESH_COMPRESSION];let Xe;return Ye?Xe="draco:"+Ye.bufferView+":"+Ye.indices+":"+fn(Ye.attributes):Xe=cn.indices+":"+fn(cn.attributes)+":"+cn.mode,Xe}function fn(cn){let Ye="";const Xe=Object.keys(cn).sort();for(let ft=0,ct=Xe.length;ft<ct;ft++)Ye+=Xe[ft]+":"+cn[Xe[ft]]+";";return Ye}function vr(cn){switch(cn){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class et{constructor(Ye={},Xe={}){this.json=Ye,this.extensions={},this.plugins={},this.options=Xe,this.cache=new St,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},typeof createImageBitmap<"u"&&/Firefox/.test(navigator.userAgent)===!1?this.textureLoader=new U.ImageBitmapLoader(this.options.manager):this.textureLoader=new U.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new U.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(Ye){this.extensions=Ye}setPlugins(Ye){this.plugins=Ye}parse(Ye,Xe){const ft=this,ct=this.json,Rt=this.extensions;this.cache.removeAll(),this._invokeAll(function(Ut){return Ut._markDefs&&Ut._markDefs()}),Promise.all(this._invokeAll(function(Ut){return Ut.beforeRoot&&Ut.beforeRoot()})).then(function(){return Promise.all([ft.getDependencies("scene"),ft.getDependencies("animation"),ft.getDependencies("camera")])}).then(function(Ut){const li={scene:Ut[0][ct.scene||0],scenes:Ut[0],animations:Ut[1],cameras:Ut[2],asset:ct.asset,parser:ft,userData:{}};bt(Rt,li,ct),pt(li,ct),Promise.all(ft._invokeAll(function($t){return $t.afterRoot&&$t.afterRoot(li)})).then(function(){Ye(li)})}).catch(Xe)}_markDefs(){const Ye=this.json.nodes||[],Xe=this.json.skins||[],ft=this.json.meshes||[];for(let ct=0,Rt=Xe.length;ct<Rt;ct++){const Ut=Xe[ct].joints;for(let li=0,$t=Ut.length;li<$t;li++)Ye[Ut[li]].isBone=!0}for(let ct=0,Rt=Ye.length;ct<Rt;ct++){const Ut=Ye[ct];Ut.mesh!==void 0&&(this._addNodeRef(this.meshCache,Ut.mesh),Ut.skin!==void 0&&(ft[Ut.mesh].isSkinnedMesh=!0)),Ut.camera!==void 0&&this._addNodeRef(this.cameraCache,Ut.camera)}}_addNodeRef(Ye,Xe){Xe!==void 0&&(Ye.refs[Xe]===void 0&&(Ye.refs[Xe]=Ye.uses[Xe]=0),Ye.refs[Xe]++)}_getNodeRef(Ye,Xe,ft){if(Ye.refs[Xe]<=1)return ft;const ct=ft.clone();return ct.name+="_instance_"+Ye.uses[Xe]++,ct}_invokeOne(Ye){const Xe=Object.values(this.plugins);Xe.push(this);for(let ft=0;ft<Xe.length;ft++){const ct=Ye(Xe[ft]);if(ct)return ct}return null}_invokeAll(Ye){const Xe=Object.values(this.plugins);Xe.unshift(this);const ft=[];for(let ct=0;ct<Xe.length;ct++){const Rt=Ye(Xe[ct]);Rt&&ft.push(Rt)}return ft}getDependency(Ye,Xe){const ft=Ye+":"+Xe;let ct=this.cache.get(ft);if(!ct){switch(Ye){case"scene":ct=this.loadScene(Xe);break;case"node":ct=this.loadNode(Xe);break;case"mesh":ct=this._invokeOne(function(Rt){return Rt.loadMesh&&Rt.loadMesh(Xe)});break;case"accessor":ct=this.loadAccessor(Xe);break;case"bufferView":ct=this._invokeOne(function(Rt){return Rt.loadBufferView&&Rt.loadBufferView(Xe)});break;case"buffer":ct=this.loadBuffer(Xe);break;case"material":ct=this._invokeOne(function(Rt){return Rt.loadMaterial&&Rt.loadMaterial(Xe)});break;case"texture":ct=this._invokeOne(function(Rt){return Rt.loadTexture&&Rt.loadTexture(Xe)});break;case"skin":ct=this.loadSkin(Xe);break;case"animation":ct=this.loadAnimation(Xe);break;case"camera":ct=this.loadCamera(Xe);break;default:throw new Error("Unknown type: "+Ye)}this.cache.add(ft,ct)}return ct}getDependencies(Ye){let Xe=this.cache.get(Ye);if(!Xe){const ft=this,ct=this.json[Ye+(Ye==="mesh"?"es":"s")]||[];Xe=Promise.all(ct.map(function(Rt,Ut){return ft.getDependency(Ye,Ut)})),this.cache.add(Ye,Xe)}return Xe}loadBuffer(Ye){const Xe=this.json.buffers[Ye],ft=this.fileLoader;if(Xe.type&&Xe.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+Xe.type+" buffer type is not supported.");if(Xe.uri===void 0&&Ye===0)return Promise.resolve(this.extensions[ei.KHR_BINARY_GLTF].body);const ct=this.options;return new Promise(function(Rt,Ut){ft.load(it(Xe.uri,ct.path),Rt,void 0,function(){Ut(new Error('THREE.GLTFLoader: Failed to load buffer "'+Xe.uri+'".'))})})}loadBufferView(Ye){const Xe=this.json.bufferViews[Ye];return this.getDependency("buffer",Xe.buffer).then(function(ft){const ct=Xe.byteLength||0,Rt=Xe.byteOffset||0;return ft.slice(Rt,Rt+ct)})}loadAccessor(Ye){const Xe=this,ft=this.json,ct=this.json.accessors[Ye];if(ct.bufferView===void 0&&ct.sparse===void 0)return Promise.resolve(null);const Rt=[];return ct.bufferView!==void 0?Rt.push(this.getDependency("bufferView",ct.bufferView)):Rt.push(null),ct.sparse!==void 0&&(Rt.push(this.getDependency("bufferView",ct.sparse.indices.bufferView)),Rt.push(this.getDependency("bufferView",ct.sparse.values.bufferView))),Promise.all(Rt).then(function(Ut){const li=Ut[0],$t=ge[ct.type],ii=Yt[ct.componentType],Tn=ii.BYTES_PER_ELEMENT,wn=Tn*$t,gr=ct.byteOffset||0,cr=ct.bufferView!==void 0?ft.bufferViews[ct.bufferView].byteStride:void 0,Sr=ct.normalized===!0;let Er,mr;if(cr&&cr!==wn){const Nr=Math.floor(gr/cr),Ma="InterleavedBuffer:"+ct.bufferView+":"+ct.componentType+":"+Nr+":"+ct.count;let ga=Xe.cache.get(Ma);ga||(Er=new ii(li,Nr*cr,ct.count*cr/Tn),ga=new U.InterleavedBuffer(Er,cr/Tn),Xe.cache.add(Ma,ga)),mr=new U.InterleavedBufferAttribute(ga,$t,gr%cr/Tn,Sr)}else li===null?Er=new ii(ct.count*$t):Er=new ii(li,gr,ct.count*$t),mr=new U.BufferAttribute(Er,$t,Sr);if(ct.sparse!==void 0){const Nr=ge.SCALAR,Ma=Yt[ct.sparse.indices.componentType],ga=ct.sparse.indices.byteOffset||0,oo=ct.sparse.values.byteOffset||0,$a=new Ma(Ut[1],ga,ct.sparse.count*Nr),dn=new ii(Ut[2],oo,ct.sparse.count*$t);li!==null&&(mr=new U.BufferAttribute(mr.array.slice(),mr.itemSize,mr.normalized));for(let Xn=0,Qa=$a.length;Xn<Qa;Xn++){const lo=$a[Xn];if(mr.setX(lo,dn[Xn*$t]),$t>=2&&mr.setY(lo,dn[Xn*$t+1]),$t>=3&&mr.setZ(lo,dn[Xn*$t+2]),$t>=4&&mr.setW(lo,dn[Xn*$t+3]),$t>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse THREE.BufferAttribute.")}}return mr})}loadTexture(Ye){const Xe=this.json,ft=this.options,ct=Xe.textures[Ye],Rt=Xe.images[ct.source];let Ut=this.textureLoader;if(Rt.uri){const li=ft.manager.getHandler(Rt.uri);li!==null&&(Ut=li)}return this.loadTextureImage(Ye,Rt,Ut)}loadTextureImage(Ye,Xe,ft){const ct=this,Rt=this.json,Ut=this.options,li=Rt.textures[Ye],$t=(Xe.uri||Xe.bufferView)+":"+li.sampler;if(this.textureCache[$t])return this.textureCache[$t];const ii=self.URL||self.webkitURL;let Tn=Xe.uri||"",wn=!1,gr=!0;const cr=Tn.search(/\.jpe?g($|\?)/i)>0||Tn.search(/^data\:image\/jpeg/)===0;if((Xe.mimeType==="image/jpeg"||cr)&&(gr=!1),Xe.bufferView!==void 0)Tn=ct.getDependency("bufferView",Xe.bufferView).then(function(Er){if(Xe.mimeType==="image/png"){const Nr=new DataView(Er,25,1).getUint8(0,!1);gr=Nr===6||Nr===4||Nr===3}wn=!0;const mr=new Blob([Er],{type:Xe.mimeType});return Tn=ii.createObjectURL(mr),Tn});else if(Xe.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+Ye+" is missing URI and bufferView");const Sr=Promise.resolve(Tn).then(function(Er){return new Promise(function(mr,Nr){let Ma=mr;ft.isImageBitmapLoader===!0&&(Ma=function(ga){const oo=new U.Texture(ga);oo.needsUpdate=!0,mr(oo)}),ft.load(it(Er,Ut.path),Ma,void 0,Nr)})}).then(function(Er){wn===!0&&ii.revokeObjectURL(Tn),Er.flipY=!1,li.name&&(Er.name=li.name),gr||(Er.format=U.RGBFormat);const Nr=(Rt.samplers||{})[li.sampler]||{};return Er.magFilter=vi[Nr.magFilter]||U.LinearFilter,Er.minFilter=vi[Nr.minFilter]||U.LinearMipmapLinearFilter,Er.wrapS=ae[Nr.wrapS]||U.RepeatWrapping,Er.wrapT=ae[Nr.wrapT]||U.RepeatWrapping,ct.associations.set(Er,{type:"textures",index:Ye}),Er}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",Tn),null});return this.textureCache[$t]=Sr,Sr}assignTexture(Ye,Xe,ft){const ct=this;return this.getDependency("texture",ft.index).then(function(Rt){if(ft.texCoord!==void 0&&ft.texCoord!=0&&!(Xe==="aoMap"&&ft.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+ft.texCoord+" for texture "+Xe+" not yet supported."),ct.extensions[ei.KHR_TEXTURE_TRANSFORM]){const Ut=ft.extensions!==void 0?ft.extensions[ei.KHR_TEXTURE_TRANSFORM]:void 0;if(Ut){const li=ct.associations.get(Rt);Rt=ct.extensions[ei.KHR_TEXTURE_TRANSFORM].extendTexture(Rt,Ut),ct.associations.set(Rt,li)}}return Ye[Xe]=Rt,Rt})}assignFinalMaterial(Ye){const Xe=Ye.geometry;let ft=Ye.material;const ct=Xe.attributes.tangent!==void 0,Rt=Xe.attributes.color!==void 0,Ut=Xe.attributes.normal===void 0;if(Ye.isPoints){const li="PointsMaterial:"+ft.uuid;let $t=this.cache.get(li);$t||($t=new U.PointsMaterial,U.Material.prototype.copy.call($t,ft),$t.color.copy(ft.color),$t.map=ft.map,$t.sizeAttenuation=!1,this.cache.add(li,$t)),ft=$t}else if(Ye.isLine){const li="LineBasicMaterial:"+ft.uuid;let $t=this.cache.get(li);$t||($t=new U.LineBasicMaterial,U.Material.prototype.copy.call($t,ft),$t.color.copy(ft.color),this.cache.add(li,$t)),ft=$t}if(ct||Rt||Ut){let li="ClonedMaterial:"+ft.uuid+":";ft.isGLTFSpecularGlossinessMaterial&&(li+="specular-glossiness:"),ct&&(li+="vertex-tangents:"),Rt&&(li+="vertex-colors:"),Ut&&(li+="flat-shading:");let $t=this.cache.get(li);$t||($t=ft.clone(),Rt&&($t.vertexColors=!0),Ut&&($t.flatShading=!0),ct&&($t.normalScale&&($t.normalScale.y*=-1),$t.clearcoatNormalScale&&($t.clearcoatNormalScale.y*=-1)),this.cache.add(li,$t),this.associations.set($t,this.associations.get(ft))),ft=$t}ft.aoMap&&Xe.attributes.uv2===void 0&&Xe.attributes.uv!==void 0&&Xe.setAttribute("uv2",Xe.attributes.uv),Ye.material=ft}getMaterialType(){return U.MeshStandardMaterial}loadMaterial(Ye){const Xe=this,ft=this.json,ct=this.extensions,Rt=ft.materials[Ye];let Ut;const li={},$t=Rt.extensions||{},ii=[];if($t[ei.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const wn=ct[ei.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];Ut=wn.getMaterialType(),ii.push(wn.extendParams(li,Rt,Xe))}else if($t[ei.KHR_MATERIALS_UNLIT]){const wn=ct[ei.KHR_MATERIALS_UNLIT];Ut=wn.getMaterialType(),ii.push(wn.extendParams(li,Rt,Xe))}else{const wn=Rt.pbrMetallicRoughness||{};if(li.color=new U.Color(1,1,1),li.opacity=1,Array.isArray(wn.baseColorFactor)){const gr=wn.baseColorFactor;li.color.fromArray(gr),li.opacity=gr[3]}wn.baseColorTexture!==void 0&&ii.push(Xe.assignTexture(li,"map",wn.baseColorTexture)),li.metalness=wn.metallicFactor!==void 0?wn.metallicFactor:1,li.roughness=wn.roughnessFactor!==void 0?wn.roughnessFactor:1,wn.metallicRoughnessTexture!==void 0&&(ii.push(Xe.assignTexture(li,"metalnessMap",wn.metallicRoughnessTexture)),ii.push(Xe.assignTexture(li,"roughnessMap",wn.metallicRoughnessTexture))),Ut=this._invokeOne(function(gr){return gr.getMaterialType&&gr.getMaterialType(Ye)}),ii.push(Promise.all(this._invokeAll(function(gr){return gr.extendMaterialParams&&gr.extendMaterialParams(Ye,li)})))}Rt.doubleSided===!0&&(li.side=U.DoubleSide);const Tn=Rt.alphaMode||Ie.OPAQUE;return Tn===Ie.BLEND?(li.transparent=!0,li.depthWrite=!1):(li.format=U.RGBFormat,li.transparent=!1,Tn===Ie.MASK&&(li.alphaTest=Rt.alphaCutoff!==void 0?Rt.alphaCutoff:.5)),Rt.normalTexture!==void 0&&Ut!==U.MeshBasicMaterial&&(ii.push(Xe.assignTexture(li,"normalMap",Rt.normalTexture)),li.normalScale=new U.Vector2(1,-1),Rt.normalTexture.scale!==void 0&&li.normalScale.set(Rt.normalTexture.scale,-Rt.normalTexture.scale)),Rt.occlusionTexture!==void 0&&Ut!==U.MeshBasicMaterial&&(ii.push(Xe.assignTexture(li,"aoMap",Rt.occlusionTexture)),Rt.occlusionTexture.strength!==void 0&&(li.aoMapIntensity=Rt.occlusionTexture.strength)),Rt.emissiveFactor!==void 0&&Ut!==U.MeshBasicMaterial&&(li.emissive=new U.Color().fromArray(Rt.emissiveFactor)),Rt.emissiveTexture!==void 0&&Ut!==U.MeshBasicMaterial&&ii.push(Xe.assignTexture(li,"emissiveMap",Rt.emissiveTexture)),Promise.all(ii).then(function(){let wn;return Ut===ni?wn=ct[ei.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(li):wn=new Ut(li),Rt.name&&(wn.name=Rt.name),wn.map&&(wn.map.encoding=U.sRGBEncoding),wn.emissiveMap&&(wn.emissiveMap.encoding=U.sRGBEncoding),pt(wn,Rt),Xe.associations.set(wn,{type:"materials",index:Ye}),Rt.extensions&&bt(ct,wn,Rt),wn})}createUniqueName(Ye){const Xe=U.PropertyBinding.sanitizeNodeName(Ye||"");let ft=Xe;for(let ct=1;this.nodeNamesUsed[ft];++ct)ft=Xe+"_"+ct;return this.nodeNamesUsed[ft]=!0,ft}loadGeometries(Ye){const Xe=this,ft=this.extensions,ct=this.primitiveCache;function Rt(li){return ft[ei.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(li,Xe).then(function($t){return ra($t,li,Xe)})}const Ut=[];for(let li=0,$t=Ye.length;li<$t;li++){const ii=Ye[li],Tn=mn(ii),wn=ct[Tn];if(wn)Ut.push(wn.promise);else{let gr;ii.extensions&&ii.extensions[ei.KHR_DRACO_MESH_COMPRESSION]?gr=Rt(ii):gr=ra(new U.BufferGeometry,ii,Xe),ct[Tn]={primitive:ii,promise:gr},Ut.push(gr)}}return Promise.all(Ut)}loadMesh(Ye){const Xe=this,ft=this.json,ct=this.extensions,Rt=ft.meshes[Ye],Ut=Rt.primitives,li=[];for(let $t=0,ii=Ut.length;$t<ii;$t++){const Tn=Ut[$t].material===void 0?vt(this.cache):this.getDependency("material",Ut[$t].material);li.push(Tn)}return li.push(Xe.loadGeometries(Ut)),Promise.all(li).then(function($t){const ii=$t.slice(0,$t.length-1),Tn=$t[$t.length-1],wn=[];for(let cr=0,Sr=Tn.length;cr<Sr;cr++){const Er=Tn[cr],mr=Ut[cr];let Nr;const Ma=ii[cr];if(mr.mode===Zt.TRIANGLES||mr.mode===Zt.TRIANGLE_STRIP||mr.mode===Zt.TRIANGLE_FAN||mr.mode===void 0)Nr=Rt.isSkinnedMesh===!0?new U.SkinnedMesh(Er,Ma):new U.Mesh(Er,Ma),Nr.isSkinnedMesh===!0&&!Nr.geometry.attributes.skinWeight.normalized&&Nr.normalizeSkinWeights(),mr.mode===Zt.TRIANGLE_STRIP?Nr.geometry=Pi(Nr.geometry,U.TriangleStripDrawMode):mr.mode===Zt.TRIANGLE_FAN&&(Nr.geometry=Pi(Nr.geometry,U.TriangleFanDrawMode));else if(mr.mode===Zt.LINES)Nr=new U.LineSegments(Er,Ma);else if(mr.mode===Zt.LINE_STRIP)Nr=new U.Line(Er,Ma);else if(mr.mode===Zt.LINE_LOOP)Nr=new U.LineLoop(Er,Ma);else if(mr.mode===Zt.POINTS)Nr=new U.Points(Er,Ma);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+mr.mode);Object.keys(Nr.geometry.morphAttributes).length>0&&Wi(Nr,Rt),Nr.name=Xe.createUniqueName(Rt.name||"mesh_"+Ye),pt(Nr,Rt),mr.extensions&&bt(ct,Nr,mr),Xe.assignFinalMaterial(Nr),wn.push(Nr)}if(wn.length===1)return wn[0];const gr=new U.Group;for(let cr=0,Sr=wn.length;cr<Sr;cr++)gr.add(wn[cr]);return gr})}loadCamera(Ye){let Xe;const ft=this.json.cameras[Ye],ct=ft[ft.type];if(!ct){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return ft.type==="perspective"?Xe=new U.PerspectiveCamera(U.MathUtils.radToDeg(ct.yfov),ct.aspectRatio||1,ct.znear||1,ct.zfar||2e6):ft.type==="orthographic"&&(Xe=new U.OrthographicCamera(-ct.xmag,ct.xmag,ct.ymag,-ct.ymag,ct.znear,ct.zfar)),ft.name&&(Xe.name=this.createUniqueName(ft.name)),pt(Xe,ft),Promise.resolve(Xe)}loadSkin(Ye){const Xe=this.json.skins[Ye],ft={joints:Xe.joints};return Xe.inverseBindMatrices===void 0?Promise.resolve(ft):this.getDependency("accessor",Xe.inverseBindMatrices).then(function(ct){return ft.inverseBindMatrices=ct,ft})}loadAnimation(Ye){const ft=this.json.animations[Ye],ct=[],Rt=[],Ut=[],li=[],$t=[];for(let ii=0,Tn=ft.channels.length;ii<Tn;ii++){const wn=ft.channels[ii],gr=ft.samplers[wn.sampler],cr=wn.target,Sr=cr.node!==void 0?cr.node:cr.id,Er=ft.parameters!==void 0?ft.parameters[gr.input]:gr.input,mr=ft.parameters!==void 0?ft.parameters[gr.output]:gr.output;ct.push(this.getDependency("node",Sr)),Rt.push(this.getDependency("accessor",Er)),Ut.push(this.getDependency("accessor",mr)),li.push(gr),$t.push(cr)}return Promise.all([Promise.all(ct),Promise.all(Rt),Promise.all(Ut),Promise.all(li),Promise.all($t)]).then(function(ii){const Tn=ii[0],wn=ii[1],gr=ii[2],cr=ii[3],Sr=ii[4],Er=[];for(let Nr=0,Ma=Tn.length;Nr<Ma;Nr++){const ga=Tn[Nr],oo=wn[Nr],$a=gr[Nr],dn=cr[Nr],Xn=Sr[Nr];if(ga===void 0)continue;ga.updateMatrix(),ga.matrixAutoUpdate=!0;let Qa;switch(Re[Xn.path]){case Re.weights:Qa=U.NumberKeyframeTrack;break;case Re.rotation:Qa=U.QuaternionKeyframeTrack;break;case Re.position:case Re.scale:default:Qa=U.VectorKeyframeTrack;break}const lo=ga.name?ga.name:ga.uuid,Us=dn.interpolation!==void 0?ze[dn.interpolation]:U.InterpolateLinear,Ca=[];Re[Xn.path]===Re.weights?ga.traverse(function(qr){qr.isMesh===!0&&qr.morphTargetInfluences&&Ca.push(qr.name?qr.name:qr.uuid)}):Ca.push(lo);let ja=$a.array;if($a.normalized){const qr=vr(ja.constructor),gs=new Float32Array(ja.length);for(let $s=0,Lo=ja.length;$s<Lo;$s++)gs[$s]=ja[$s]*qr;ja=gs}for(let qr=0,gs=Ca.length;qr<gs;qr++){const $s=new Qa(Ca[qr]+"."+Re[Xn.path],oo.array,ja,Us);dn.interpolation==="CUBICSPLINE"&&($s.createInterpolant=function(Ls){const ht=this instanceof U.QuaternionKeyframeTrack?Ci:Fi;return new ht(this.times,this.values,this.getValueSize()/3,Ls)},$s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),Er.push($s)}}const mr=ft.name?ft.name:"animation_"+Ye;return new U.AnimationClip(mr,void 0,Er)})}createNodeMesh(Ye){const Xe=this.json,ft=this,ct=Xe.nodes[Ye];return ct.mesh===void 0?null:ft.getDependency("mesh",ct.mesh).then(function(Rt){const Ut=ft._getNodeRef(ft.meshCache,ct.mesh,Rt);return ct.weights!==void 0&&Ut.traverse(function(li){if(li.isMesh)for(let $t=0,ii=ct.weights.length;$t<ii;$t++)li.morphTargetInfluences[$t]=ct.weights[$t]}),Ut})}loadNode(Ye){const Xe=this.json,ft=this.extensions,ct=this,Rt=Xe.nodes[Ye],Ut=Rt.name?ct.createUniqueName(Rt.name):"";return function(){const li=[],$t=ct._invokeOne(function(ii){return ii.createNodeMesh&&ii.createNodeMesh(Ye)});return $t&&li.push($t),Rt.camera!==void 0&&li.push(ct.getDependency("camera",Rt.camera).then(function(ii){return ct._getNodeRef(ct.cameraCache,Rt.camera,ii)})),ct._invokeAll(function(ii){return ii.createNodeAttachment&&ii.createNodeAttachment(Ye)}).forEach(function(ii){li.push(ii)}),Promise.all(li)}().then(function(li){let $t;if(Rt.isBone===!0?$t=new U.Bone:li.length>1?$t=new U.Group:li.length===1?$t=li[0]:$t=new U.Object3D,$t!==li[0])for(let ii=0,Tn=li.length;ii<Tn;ii++)$t.add(li[ii]);if(Rt.name&&($t.userData.name=Rt.name,$t.name=Ut),pt($t,Rt),Rt.extensions&&bt(ft,$t,Rt),Rt.matrix!==void 0){const ii=new U.Matrix4;ii.fromArray(Rt.matrix),$t.applyMatrix4(ii)}else Rt.translation!==void 0&&$t.position.fromArray(Rt.translation),Rt.rotation!==void 0&&$t.quaternion.fromArray(Rt.rotation),Rt.scale!==void 0&&$t.scale.fromArray(Rt.scale);return ct.associations.set($t,{type:"nodes",index:Ye}),$t})}loadScene(Ye){const Xe=this.json,ft=this.extensions,ct=this.json.scenes[Ye],Rt=this,Ut=new U.Group;ct.name&&(Ut.name=Rt.createUniqueName(ct.name)),pt(Ut,ct),ct.extensions&&bt(ft,Ut,ct);const li=ct.nodes||[],$t=[];for(let ii=0,Tn=li.length;ii<Tn;ii++)$t.push(jr(li[ii],Ut,Xe,Rt));return Promise.all($t).then(function(){return Ut})}}function jr(cn,Ye,Xe,ft){const ct=Xe.nodes[cn];return ft.getDependency("node",cn).then(function(Rt){if(ct.skin===void 0)return Rt;let Ut;return ft.getDependency("skin",ct.skin).then(function(li){Ut=li;const $t=[];for(let ii=0,Tn=Ut.joints.length;ii<Tn;ii++)$t.push(ft.getDependency("node",Ut.joints[ii]));return Promise.all($t)}).then(function(li){return Rt.traverse(function($t){if(!$t.isMesh)return;const ii=[],Tn=[];for(let wn=0,gr=li.length;wn<gr;wn++){const cr=li[wn];if(cr){ii.push(cr);const Sr=new U.Matrix4;Ut.inverseBindMatrices!==void 0&&Sr.fromArray(Ut.inverseBindMatrices.array,wn*16),Tn.push(Sr)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',Ut.joints[wn])}$t.bind(new U.Skeleton(ii,Tn),$t.matrixWorld)}),Rt})}).then(function(Rt){Ye.add(Rt);const Ut=[];if(ct.children){const li=ct.children;for(let $t=0,ii=li.length;$t<ii;$t++){const Tn=li[$t];Ut.push(jr(Tn,Rt,Xe,ft))}}return Promise.all(Ut)})}function Ra(cn,Ye,Xe){const ft=Ye.attributes,ct=new U.Box3;if(ft.POSITION!==void 0){const li=Xe.json.accessors[ft.POSITION],$t=li.min,ii=li.max;if($t!==void 0&&ii!==void 0){if(ct.set(new U.Vector3($t[0],$t[1],$t[2]),new U.Vector3(ii[0],ii[1],ii[2])),li.normalized){const Tn=vr(Yt[li.componentType]);ct.min.multiplyScalar(Tn),ct.max.multiplyScalar(Tn)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const Rt=Ye.targets;if(Rt!==void 0){const li=new U.Vector3,$t=new U.Vector3;for(let ii=0,Tn=Rt.length;ii<Tn;ii++){const wn=Rt[ii];if(wn.POSITION!==void 0){const gr=Xe.json.accessors[wn.POSITION],cr=gr.min,Sr=gr.max;if(cr!==void 0&&Sr!==void 0){if($t.setX(Math.max(Math.abs(cr[0]),Math.abs(Sr[0]))),$t.setY(Math.max(Math.abs(cr[1]),Math.abs(Sr[1]))),$t.setZ(Math.max(Math.abs(cr[2]),Math.abs(Sr[2]))),gr.normalized){const Er=vr(Yt[gr.componentType]);$t.multiplyScalar(Er)}li.max($t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}ct.expandByVector(li)}cn.boundingBox=ct;const Ut=new U.Sphere;ct.getCenter(Ut.center),Ut.radius=ct.min.distanceTo(ct.max)/2,cn.boundingSphere=Ut}function ra(cn,Ye,Xe){const ft=Ye.attributes,ct=[];function Rt(Ut,li){return Xe.getDependency("accessor",Ut).then(function($t){cn.setAttribute(li,$t)})}for(const Ut in ft){const li=Te[Ut]||Ut.toLowerCase();li in cn.attributes||ct.push(Rt(ft[Ut],li))}if(Ye.indices!==void 0&&!cn.index){const Ut=Xe.getDependency("accessor",Ye.indices).then(function(li){cn.setIndex(li)});ct.push(Ut)}return pt(cn,Ye),Ra(cn,Ye,Xe),Promise.all(ct).then(function(){return Ye.targets!==void 0?ti(cn,Ye.targets,Xe):cn})}function Pi(cn,Ye){let Xe=cn.getIndex();if(Xe===null){const Ut=[],li=cn.getAttribute("position");if(li!==void 0){for(let $t=0;$t<li.count;$t++)Ut.push($t);cn.setIndex(Ut),Xe=cn.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),cn}const ft=Xe.count-2,ct=[];if(Ye===U.TriangleFanDrawMode)for(let Ut=1;Ut<=ft;Ut++)ct.push(Xe.getX(0)),ct.push(Xe.getX(Ut)),ct.push(Xe.getX(Ut+1));else for(let Ut=0;Ut<ft;Ut++)Ut%2===0?(ct.push(Xe.getX(Ut)),ct.push(Xe.getX(Ut+1)),ct.push(Xe.getX(Ut+2))):(ct.push(Xe.getX(Ut+2)),ct.push(Xe.getX(Ut+1)),ct.push(Xe.getX(Ut)));ct.length/3!==ft&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const Rt=cn.clone();return Rt.setIndex(ct),Rt}U.GLTFLoader=Ze})(),En.exports=U.GLTFLoader}(by)),by.exports}var wy={exports:{}},ax;function Rb(){return ax||(ax=1,function(En,na){const U=Oc();(function(){class Ze extends U.Loader{constructor(ei){super(ei)}load(ei,Le,r,Ge){const de=this,Je=de.path===""?U.LoaderUtils.extractUrlBase(ei):de.path,rt=new U.FileLoader(de.manager);rt.setPath(de.path),rt.setRequestHeader(de.requestHeader),rt.setWithCredentials(de.withCredentials),rt.load(ei,function(ai){try{Le(de.parse(ai,Je))}catch(bi){Ge?Ge(bi):console.error(bi),de.manager.itemError(ei)}},r,Ge)}parse(ei,Le){function r(xe,he){const we=[],Ve=xe.childNodes;for(let Ee=0,ri=Ve.length;Ee<ri;Ee++){const Ei=Ve[Ee];Ei.nodeName===he&&we.push(Ei)}return we}function Ge(xe){if(xe.length===0)return[];const he=xe.trim().split(/\s+/),we=new Array(he.length);for(let Ve=0,Ee=he.length;Ve<Ee;Ve++)we[Ve]=he[Ve];return we}function de(xe){if(xe.length===0)return[];const he=xe.trim().split(/\s+/),we=new Array(he.length);for(let Ve=0,Ee=he.length;Ve<Ee;Ve++)we[Ve]=parseFloat(he[Ve]);return we}function Je(xe){if(xe.length===0)return[];const he=xe.trim().split(/\s+/),we=new Array(he.length);for(let Ve=0,Ee=he.length;Ve<Ee;Ve++)we[Ve]=parseInt(he[Ve]);return we}function rt(xe){return xe.substring(1)}function ai(){return"three_default_"+Yi++}function bi(xe){return Object.keys(xe).length===0}function Ai(xe){return{unit:qt(r(xe,"unit")[0]),upAxis:xi(r(xe,"up_axis")[0])}}function qt(xe){return xe!==void 0&&xe.hasAttribute("meter")===!0?parseFloat(xe.getAttribute("meter")):1}function xi(xe){return xe!==void 0?xe.textContent:"Y_UP"}function kt(xe,he,we,Ve){const Ee=r(xe,he)[0];if(Ee!==void 0){const ri=r(Ee,we);for(let Ei=0;Ei<ri.length;Ei++)Ve(ri[Ei])}}function Tt(xe,he){for(const we in xe){const Ve=xe[we];Ve.build=he(xe[we])}}function ln(xe,he){return xe.build!==void 0||(xe.build=he(xe)),xe.build}function Xi(xe){const he={sources:{},samplers:{},channels:{}};let we=!1;for(let Ve=0,Ee=xe.childNodes.length;Ve<Ee;Ve++){const ri=xe.childNodes[Ve];if(ri.nodeType!==1)continue;let Ei;switch(ri.nodeName){case"source":Ei=ri.getAttribute("id"),he.sources[Ei]=qr(ri);break;case"sampler":Ei=ri.getAttribute("id"),he.samplers[Ei]=Dt(ri);break;case"channel":Ei=ri.getAttribute("target"),he.channels[Ei]=ni(ri);break;case"animation":Xi(ri),we=!0;break;default:console.log(ri)}}we===!1&&(wi.animations[xe.getAttribute("id")||U.MathUtils.generateUUID()]=he)}function Dt(xe){const he={inputs:{}};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"input":const ri=rt(Ee.getAttribute("source")),Ei=Ee.getAttribute("semantic");he.inputs[Ei]=ri;break}}return he}function ni(xe){const he={};let Ve=xe.getAttribute("target").split("/");const Ee=Ve.shift();let ri=Ve.shift();const Ei=ri.indexOf("(")!==-1,sn=ri.indexOf(".")!==-1;if(sn)Ve=ri.split("."),ri=Ve.shift(),he.member=Ve.shift();else if(Ei){const Di=ri.split("(");ri=Di.shift();for(let Jn=0;Jn<Di.length;Jn++)Di[Jn]=parseInt(Di[Jn].replace(/\)/,""));he.indices=Di}return he.id=Ee,he.sid=ri,he.arraySyntax=Ei,he.memberSyntax=sn,he.sampler=rt(xe.getAttribute("source")),he}function ci(xe){const he=[],we=xe.channels,Ve=xe.samplers,Ee=xe.sources;for(const ri in we)if(we.hasOwnProperty(ri)){const Ei=we[ri],sn=Ve[Ei.sampler],Di=sn.inputs.INPUT,Jn=sn.inputs.OUTPUT,on=Ee[Di],Ft=Ee[Jn],yn=Fi(Ei,on,Ft);vi(yn,he)}return he}function Nn(xe){return ln(wi.animations[xe],ci)}function Fi(xe,he,we){const Ve=wi.nodes[xe.id],Ee=Da(Ve.id),ri=Ve.transforms[xe.sid],Ei=Ve.matrix.clone().transpose();let sn,Di,Jn,on,Ft,yn;const Si={};switch(ri){case"matrix":for(Jn=0,on=he.array.length;Jn<on;Jn++)if(sn=he.array[Jn],Di=Jn*we.stride,Si[sn]===void 0&&(Si[sn]={}),xe.arraySyntax===!0){const Cn=we.array[Di],Ar=xe.indices[0]+4*xe.indices[1];Si[sn][Ar]=Cn}else for(Ft=0,yn=we.stride;Ft<yn;Ft++)Si[sn][Ft]=we.array[Di+Ft];break;case"translate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',ri);break;case"rotate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',ri);break;case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',ri);break}const qn=oi(Si,Ei);return{name:Ee.uuid,keyframes:qn}}function oi(xe,he){const we=[];for(const Ee in xe)we.push({time:parseFloat(Ee),value:xe[Ee]});we.sort(Ve);for(let Ee=0;Ee<16;Ee++)ae(we,Ee,he.elements[Ee]);return we;function Ve(Ee,ri){return Ee.time-ri.time}}const Ci=new U.Vector3,Zt=new U.Vector3,Yt=new U.Quaternion;function vi(xe,he){const we=xe.keyframes,Ve=xe.name,Ee=[],ri=[],Ei=[],sn=[];for(let Di=0,Jn=we.length;Di<Jn;Di++){const on=we[Di],Ft=on.time,yn=on.value;jn.fromArray(yn).transpose(),jn.decompose(Ci,Yt,Zt),Ee.push(Ft),ri.push(Ci.x,Ci.y,Ci.z),Ei.push(Yt.x,Yt.y,Yt.z,Yt.w),sn.push(Zt.x,Zt.y,Zt.z)}return ri.length>0&&he.push(new U.VectorKeyframeTrack(Ve+".position",Ee,ri)),Ei.length>0&&he.push(new U.QuaternionKeyframeTrack(Ve+".quaternion",Ee,Ei)),sn.length>0&&he.push(new U.VectorKeyframeTrack(Ve+".scale",Ee,sn)),he}function ae(xe,he,we){let Ve,Ee=!0,ri,Ei;for(ri=0,Ei=xe.length;ri<Ei;ri++)Ve=xe[ri],Ve.value[he]===void 0?Ve.value[he]=null:Ee=!1;if(Ee===!0)for(ri=0,Ei=xe.length;ri<Ei;ri++)Ve=xe[ri],Ve.value[he]=we;else ge(xe,he)}function ge(xe,he){let we,Ve;for(let Ee=0,ri=xe.length;Ee<ri;Ee++){const Ei=xe[Ee];if(Ei.value[he]===null){if(we=Te(xe,Ee,he),Ve=Re(xe,Ee,he),we===null){Ei.value[he]=Ve.value[he];continue}if(Ve===null){Ei.value[he]=we.value[he];continue}ze(Ei,we,Ve,he)}}}function Te(xe,he,we){for(;he>=0;){const Ve=xe[he];if(Ve.value[we]!==null)return Ve;he--}return null}function Re(xe,he,we){for(;he<xe.length;){const Ve=xe[he];if(Ve.value[we]!==null)return Ve;he++}return null}function ze(xe,he,we,Ve){if(we.time-he.time===0){xe.value[Ve]=he.value[Ve];return}xe.value[Ve]=(xe.time-he.time)*(we.value[Ve]-he.value[Ve])/(we.time-he.time)+he.value[Ve]}function Ie(xe){const he={name:xe.getAttribute("id")||"default",start:parseFloat(xe.getAttribute("start")||0),end:parseFloat(xe.getAttribute("end")||0),animations:[]};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"instance_animation":he.animations.push(rt(Ee.getAttribute("url")));break}}wi.clips[xe.getAttribute("id")]=he}function it(xe){const he=[],we=xe.name,Ve=xe.end-xe.start||-1,Ee=xe.animations;for(let ri=0,Ei=Ee.length;ri<Ei;ri++){const sn=Nn(Ee[ri]);for(let Di=0,Jn=sn.length;Di<Jn;Di++)he.push(sn[Di])}return new U.AnimationClip(we,Ve,he)}function vt(xe){return ln(wi.clips[xe],it)}function bt(xe){const he={};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"skin":he.id=rt(Ee.getAttribute("source")),he.skin=pt(Ee);break;case"morph":he.id=rt(Ee.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.");break}}wi.controllers[xe.getAttribute("id")]=he}function pt(xe){const he={sources:{}};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"bind_shape_matrix":he.bindShapeMatrix=de(Ee.textContent);break;case"source":const ri=Ee.getAttribute("id");he.sources[ri]=qr(Ee);break;case"joints":he.joints=ti(Ee);break;case"vertex_weights":he.vertexWeights=Wi(Ee);break}}return he}function ti(xe){const he={inputs:{}};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"input":const ri=Ee.getAttribute("semantic"),Ei=rt(Ee.getAttribute("source"));he.inputs[ri]=Ei;break}}return he}function Wi(xe){const he={inputs:{}};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"input":const ri=Ee.getAttribute("semantic"),Ei=rt(Ee.getAttribute("source")),sn=parseInt(Ee.getAttribute("offset"));he.inputs[ri]={id:Ei,offset:sn};break;case"vcount":he.vcount=Je(Ee.textContent);break;case"v":he.v=Je(Ee.textContent);break}}return he}function mn(xe){const he={id:xe.id},we=wi.geometries[he.id];return xe.skin!==void 0&&(he.skin=fn(xe.skin),we.sources.skinIndices=he.skin.indices,we.sources.skinWeights=he.skin.weights),he}function fn(xe){const we={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},Ve=xe.sources,Ee=xe.vertexWeights,ri=Ee.vcount,Ei=Ee.v,sn=Ee.inputs.JOINT.offset,Di=Ee.inputs.WEIGHT.offset,Jn=xe.sources[xe.joints.inputs.JOINT],on=xe.sources[xe.joints.inputs.INV_BIND_MATRIX],Ft=Ve[Ee.inputs.WEIGHT.id].array;let yn=0,Si,qn,rn;for(Si=0,rn=ri.length;Si<rn;Si++){const Ar=ri[Si],Ir=[];for(qn=0;qn<Ar;qn++){const Gr=Ei[yn+sn],Lr=Ei[yn+Di],xr=Ft[Lr];Ir.push({index:Gr,weight:xr}),yn+=2}for(Ir.sort(Cn),qn=0;qn<4;qn++){const Gr=Ir[qn];Gr!==void 0?(we.indices.array.push(Gr.index),we.weights.array.push(Gr.weight)):(we.indices.array.push(0),we.weights.array.push(0))}}for(xe.bindShapeMatrix?we.bindMatrix=new U.Matrix4().fromArray(xe.bindShapeMatrix).transpose():we.bindMatrix=new U.Matrix4().identity(),Si=0,rn=Jn.array.length;Si<rn;Si++){const Ar=Jn.array[Si],Ir=new U.Matrix4().fromArray(on.array,Si*on.stride).transpose();we.joints.push({name:Ar,boneInverse:Ir})}return we;function Cn(Ar,Ir){return Ir.weight-Ar.weight}}function vr(xe){return ln(wi.controllers[xe],mn)}function et(xe){const he={init_from:r(xe,"init_from")[0].textContent};wi.images[xe.getAttribute("id")]=he}function jr(xe){return xe.build!==void 0?xe.build:xe.init_from}function Ra(xe){const he=wi.images[xe];return he!==void 0?ln(he,jr):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",xe),null)}function ra(xe){const he={};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"profile_COMMON":he.profile=Pi(Ee);break}}wi.effects[xe.getAttribute("id")]=he}function Pi(xe){const he={surfaces:{},samplers:{}};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"newparam":cn(Ee,he);break;case"technique":he.technique=ft(Ee);break;case"extra":he.extra=ii(Ee);break}}return he}function cn(xe,he){const we=xe.getAttribute("sid");for(let Ve=0,Ee=xe.childNodes.length;Ve<Ee;Ve++){const ri=xe.childNodes[Ve];if(ri.nodeType===1)switch(ri.nodeName){case"surface":he.surfaces[we]=Ye(ri);break;case"sampler2D":he.samplers[we]=Xe(ri);break}}}function Ye(xe){const he={};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"init_from":he.init_from=Ee.textContent;break}}return he}function Xe(xe){const he={};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"source":he.source=Ee.textContent;break}}return he}function ft(xe){const he={};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"constant":case"lambert":case"blinn":case"phong":he.type=Ee.nodeName,he.parameters=ct(Ee);break}}return he}function ct(xe){const he={};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":he[Ee.nodeName]=Rt(Ee);break;case"transparent":he[Ee.nodeName]={opaque:Ee.getAttribute("opaque"),data:Rt(Ee)};break}}return he}function Rt(xe){const he={};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"color":he[Ee.nodeName]=de(Ee.textContent);break;case"float":he[Ee.nodeName]=parseFloat(Ee.textContent);break;case"texture":he[Ee.nodeName]={id:Ee.getAttribute("texture"),extra:Ut(Ee)};break}}return he}function Ut(xe){const he={technique:{}};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"extra":li(Ee,he);break}}return he}function li(xe,he){for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"technique":$t(Ee,he);break}}}function $t(xe,he){for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":he.technique[Ee.nodeName]=parseFloat(Ee.textContent);break;case"wrapU":case"wrapV":Ee.textContent.toUpperCase()==="TRUE"?he.technique[Ee.nodeName]=1:Ee.textContent.toUpperCase()==="FALSE"?he.technique[Ee.nodeName]=0:he.technique[Ee.nodeName]=parseInt(Ee.textContent);break}}}function ii(xe){const he={};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"technique":he.technique=Tn(Ee);break}}return he}function Tn(xe){const he={};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"double_sided":he[Ee.nodeName]=parseInt(Ee.textContent);break}}return he}function wn(xe){return xe}function gr(xe){return ln(wi.effects[xe],wn)}function cr(xe){const he={name:xe.getAttribute("name")};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"instance_effect":he.url=rt(Ee.getAttribute("url"));break}}wi.materials[xe.getAttribute("id")]=he}function Sr(xe){let he,we=xe.slice((xe.lastIndexOf(".")-1>>>0)+2);switch(we=we.toLowerCase(),we){case"tga":he=Fe;break;default:he=be}return he}function Er(xe){const he=gr(xe.url),we=he.profile.technique,Ve=he.profile.extra;let Ee;switch(we.type){case"phong":case"blinn":Ee=new U.MeshPhongMaterial;break;case"lambert":Ee=new U.MeshLambertMaterial;break;default:Ee=new U.MeshBasicMaterial;break}Ee.name=xe.name||"";function ri(Jn){const on=he.profile.samplers[Jn.id];let Ft=null;if(on!==void 0){const yn=he.profile.surfaces[on.source];Ft=Ra(yn.init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),Ft=Ra(Jn.id);if(Ft!==null){const yn=Sr(Ft);if(yn!==void 0){const Si=yn.load(Ft),qn=Jn.extra;if(qn!==void 0&&qn.technique!==void 0&&bi(qn.technique)===!1){const rn=qn.technique;Si.wrapS=rn.wrapU?U.RepeatWrapping:U.ClampToEdgeWrapping,Si.wrapT=rn.wrapV?U.RepeatWrapping:U.ClampToEdgeWrapping,Si.offset.set(rn.offsetU||0,rn.offsetV||0),Si.repeat.set(rn.repeatU||1,rn.repeatV||1)}else Si.wrapS=U.RepeatWrapping,Si.wrapT=U.RepeatWrapping;return Si}else return console.warn("THREE.ColladaLoader: THREE.Loader for texture %s not found.",Ft),null}else return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",Jn.id),null}const Ei=we.parameters;for(const Jn in Ei){const on=Ei[Jn];switch(Jn){case"diffuse":on.color&&Ee.color.fromArray(on.color),on.texture&&(Ee.map=ri(on.texture));break;case"specular":on.color&&Ee.specular&&Ee.specular.fromArray(on.color),on.texture&&(Ee.specularMap=ri(on.texture));break;case"bump":on.texture&&(Ee.normalMap=ri(on.texture));break;case"ambient":on.texture&&(Ee.lightMap=ri(on.texture));break;case"shininess":on.float&&Ee.shininess&&(Ee.shininess=on.float);break;case"emission":on.color&&Ee.emissive&&Ee.emissive.fromArray(on.color),on.texture&&(Ee.emissiveMap=ri(on.texture));break}}let sn=Ei.transparent,Di=Ei.transparency;if(Di===void 0&&sn&&(Di={float:1}),sn===void 0&&Di&&(sn={opaque:"A_ONE",data:{color:[1,1,1,1]}}),sn&&Di)if(sn.data.texture)Ee.transparent=!0;else{const Jn=sn.data.color;switch(sn.opaque){case"A_ONE":Ee.opacity=Jn[3]*Di.float;break;case"RGB_ZERO":Ee.opacity=1-Jn[0]*Di.float;break;case"A_ZERO":Ee.opacity=1-Jn[3]*Di.float;break;case"RGB_ONE":Ee.opacity=Jn[0]*Di.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',sn.opaque)}Ee.opacity<1&&(Ee.transparent=!0)}return Ve!==void 0&&Ve.technique!==void 0&&Ve.technique.double_sided===1&&(Ee.side=U.DoubleSide),Ee}function mr(xe){return ln(wi.materials[xe],Er)}function Nr(xe){const he={name:xe.getAttribute("name")};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"optics":he.optics=Ma(Ee);break}}wi.cameras[xe.getAttribute("id")]=he}function Ma(xe){for(let he=0;he<xe.childNodes.length;he++){const we=xe.childNodes[he];switch(we.nodeName){case"technique_common":return ga(we)}}return{}}function ga(xe){const he={};for(let we=0;we<xe.childNodes.length;we++){const Ve=xe.childNodes[we];switch(Ve.nodeName){case"perspective":case"orthographic":he.technique=Ve.nodeName,he.parameters=oo(Ve);break}}return he}function oo(xe){const he={};for(let we=0;we<xe.childNodes.length;we++){const Ve=xe.childNodes[we];switch(Ve.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":he[Ve.nodeName]=parseFloat(Ve.textContent);break}}return he}function $a(xe){let he;switch(xe.optics.technique){case"perspective":he=new U.PerspectiveCamera(xe.optics.parameters.yfov,xe.optics.parameters.aspect_ratio,xe.optics.parameters.znear,xe.optics.parameters.zfar);break;case"orthographic":let we=xe.optics.parameters.ymag,Ve=xe.optics.parameters.xmag;const Ee=xe.optics.parameters.aspect_ratio;Ve=Ve===void 0?we*Ee:Ve,we=we===void 0?Ve/Ee:we,Ve*=.5,we*=.5,he=new U.OrthographicCamera(-Ve,Ve,we,-we,xe.optics.parameters.znear,xe.optics.parameters.zfar);break;default:he=new U.PerspectiveCamera;break}return he.name=xe.name||"",he}function dn(xe){const he=wi.cameras[xe];return he!==void 0?ln(he,$a):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",xe),null)}function Xn(xe){let he={};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"technique_common":he=Qa(Ee);break}}wi.lights[xe.getAttribute("id")]=he}function Qa(xe){const he={};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"directional":case"point":case"spot":case"ambient":he.technique=Ee.nodeName,he.parameters=lo(Ee)}}return he}function lo(xe){const he={};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"color":const ri=de(Ee.textContent);he.color=new U.Color().fromArray(ri);break;case"falloff_angle":he.falloffAngle=parseFloat(Ee.textContent);break;case"quadratic_attenuation":const Ei=parseFloat(Ee.textContent);he.distance=Ei?Math.sqrt(1/Ei):0;break}}return he}function Us(xe){let he;switch(xe.technique){case"directional":he=new U.DirectionalLight;break;case"point":he=new U.PointLight;break;case"spot":he=new U.SpotLight;break;case"ambient":he=new U.AmbientLight;break}return xe.parameters.color&&he.color.copy(xe.parameters.color),xe.parameters.distance&&(he.distance=xe.parameters.distance),he}function Ca(xe){const he=wi.lights[xe];return he!==void 0?ln(he,Us):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",xe),null)}function ja(xe){const he={name:xe.getAttribute("name"),sources:{},vertices:{},primitives:[]},we=r(xe,"mesh")[0];if(we!==void 0){for(let Ve=0;Ve<we.childNodes.length;Ve++){const Ee=we.childNodes[Ve];if(Ee.nodeType!==1)continue;const ri=Ee.getAttribute("id");switch(Ee.nodeName){case"source":he.sources[ri]=qr(Ee);break;case"vertices":he.vertices=gs(Ee);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",Ee.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":he.primitives.push($s(Ee));break;default:console.log(Ee)}}wi.geometries[xe.getAttribute("id")]=he}}function qr(xe){const he={array:[],stride:3};for(let we=0;we<xe.childNodes.length;we++){const Ve=xe.childNodes[we];if(Ve.nodeType===1)switch(Ve.nodeName){case"float_array":he.array=de(Ve.textContent);break;case"Name_array":he.array=Ge(Ve.textContent);break;case"technique_common":const Ee=r(Ve,"accessor")[0];Ee!==void 0&&(he.stride=parseInt(Ee.getAttribute("stride")));break}}return he}function gs(xe){const he={};for(let we=0;we<xe.childNodes.length;we++){const Ve=xe.childNodes[we];Ve.nodeType===1&&(he[Ve.getAttribute("semantic")]=rt(Ve.getAttribute("source")))}return he}function $s(xe){const he={type:xe.nodeName,material:xe.getAttribute("material"),count:parseInt(xe.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let we=0,Ve=xe.childNodes.length;we<Ve;we++){const Ee=xe.childNodes[we];if(Ee.nodeType===1)switch(Ee.nodeName){case"input":const ri=rt(Ee.getAttribute("source")),Ei=Ee.getAttribute("semantic"),sn=parseInt(Ee.getAttribute("offset")),Di=parseInt(Ee.getAttribute("set")),Jn=Di>0?Ei+Di:Ei;he.inputs[Jn]={id:ri,offset:sn},he.stride=Math.max(he.stride,sn+1),Ei==="TEXCOORD"&&(he.hasUV=!0);break;case"vcount":he.vcount=Je(Ee.textContent);break;case"p":he.p=Je(Ee.textContent);break}}return he}function Lo(xe){const he={};for(let we=0;we<xe.length;we++){const Ve=xe[we];he[Ve.type]===void 0&&(he[Ve.type]=[]),he[Ve.type].push(Ve)}return he}function Ls(xe){let he=0;for(let we=0,Ve=xe.length;we<Ve;we++)xe[we].hasUV===!0&&he++;he>0&&he<xe.length&&(xe.uvsNeedsFix=!0)}function ht(xe){const he={},we=xe.sources,Ve=xe.vertices,Ee=xe.primitives;if(Ee.length===0)return{};const ri=Lo(Ee);for(const Ei in ri){const sn=ri[Ei];Ls(sn),he[Ei]=es(sn,we,Ve)}return he}function es(xe,he,we){const Ve={},Ee={array:[],stride:0},ri={array:[],stride:0},Ei={array:[],stride:0},sn={array:[],stride:0},Di={array:[],stride:0},Jn={array:[],stride:4},on={array:[],stride:4},Ft=new U.BufferGeometry,yn=[];let Si=0;for(let qn=0;qn<xe.length;qn++){const rn=xe[qn],Cn=rn.inputs;let Ar=0;switch(rn.type){case"lines":case"linestrips":Ar=rn.count*2;break;case"triangles":Ar=rn.count*3;break;case"polylist":for(let Ir=0;Ir<rn.count;Ir++){const Gr=rn.vcount[Ir];switch(Gr){case 3:Ar+=3;break;case 4:Ar+=6;break;default:Ar+=(Gr-2)*3;break}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",rn.type)}Ft.addGroup(Si,Ar,qn),Si+=Ar,rn.material&&yn.push(rn.material);for(const Ir in Cn){const Gr=Cn[Ir];switch(Ir){case"VERTEX":for(const Lr in we){const xr=we[Lr];switch(Lr){case"POSITION":const On=Ee.array.length;if(Ks(rn,he[xr],Gr.offset,Ee.array),Ee.stride=he[xr].stride,he.skinWeights&&he.skinIndices&&(Ks(rn,he.skinIndices,Gr.offset,Jn.array),Ks(rn,he.skinWeights,Gr.offset,on.array)),rn.hasUV===!1&&xe.uvsNeedsFix===!0){const fa=(Ee.array.length-On)/Ee.stride;for(let $r=0;$r<fa;$r++)Ei.array.push(0,0)}break;case"NORMAL":Ks(rn,he[xr],Gr.offset,ri.array),ri.stride=he[xr].stride;break;case"COLOR":Ks(rn,he[xr],Gr.offset,Di.array),Di.stride=he[xr].stride;break;case"TEXCOORD":Ks(rn,he[xr],Gr.offset,Ei.array),Ei.stride=he[xr].stride;break;case"TEXCOORD1":Ks(rn,he[xr],Gr.offset,sn.array),Ei.stride=he[xr].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',Lr)}}break;case"NORMAL":Ks(rn,he[Gr.id],Gr.offset,ri.array),ri.stride=he[Gr.id].stride;break;case"COLOR":Ks(rn,he[Gr.id],Gr.offset,Di.array),Di.stride=he[Gr.id].stride;break;case"TEXCOORD":Ks(rn,he[Gr.id],Gr.offset,Ei.array),Ei.stride=he[Gr.id].stride;break;case"TEXCOORD1":Ks(rn,he[Gr.id],Gr.offset,sn.array),sn.stride=he[Gr.id].stride;break}}}return Ee.array.length>0&&Ft.setAttribute("position",new U.Float32BufferAttribute(Ee.array,Ee.stride)),ri.array.length>0&&Ft.setAttribute("normal",new U.Float32BufferAttribute(ri.array,ri.stride)),Di.array.length>0&&Ft.setAttribute("color",new U.Float32BufferAttribute(Di.array,Di.stride)),Ei.array.length>0&&Ft.setAttribute("uv",new U.Float32BufferAttribute(Ei.array,Ei.stride)),sn.array.length>0&&Ft.setAttribute("uv2",new U.Float32BufferAttribute(sn.array,sn.stride)),Jn.array.length>0&&Ft.setAttribute("skinIndex",new U.Float32BufferAttribute(Jn.array,Jn.stride)),on.array.length>0&&Ft.setAttribute("skinWeight",new U.Float32BufferAttribute(on.array,on.stride)),Ve.data=Ft,Ve.type=xe[0].type,Ve.materialKeys=yn,Ve}function Ks(xe,he,we,Ve){const Ee=xe.p,ri=xe.stride,Ei=xe.vcount;function sn(on){let Ft=Ee[on+we]*Jn;const yn=Ft+Jn;for(;Ft<yn;Ft++)Ve.push(Di[Ft])}const Di=he.array,Jn=he.stride;if(xe.vcount!==void 0){let on=0;for(let Ft=0,yn=Ei.length;Ft<yn;Ft++){const Si=Ei[Ft];if(Si===4){const qn=on+ri*0,rn=on+ri*1,Cn=on+ri*2,Ar=on+ri*3;sn(qn),sn(rn),sn(Ar),sn(rn),sn(Cn),sn(Ar)}else if(Si===3){const qn=on+ri*0,rn=on+ri*1,Cn=on+ri*2;sn(qn),sn(rn),sn(Cn)}else if(Si>4)for(let qn=1,rn=Si-2;qn<=rn;qn++){const Cn=on+ri*0,Ar=on+ri*qn,Ir=on+ri*(qn+1);sn(Cn),sn(Ar),sn(Ir)}on+=ri*Si}}else for(let on=0,Ft=Ee.length;on<Ft;on+=ri)sn(on)}function Js(xe){return ln(wi.geometries[xe],ht)}function Ro(xe){const he={name:xe.getAttribute("name")||"",joints:{},links:[]};for(let we=0;we<xe.childNodes.length;we++){const Ve=xe.childNodes[we];if(Ve.nodeType===1)switch(Ve.nodeName){case"technique_common":Xt(Ve,he);break}}wi.kinematicsModels[xe.getAttribute("id")]=he}function xs(xe){return xe.build!==void 0?xe.build:xe}function Io(xe){return ln(wi.kinematicsModels[xe],xs)}function Xt(xe,he){for(let we=0;we<xe.childNodes.length;we++){const Ve=xe.childNodes[we];if(Ve.nodeType===1)switch(Ve.nodeName){case"joint":he.joints[Ve.getAttribute("sid")]=oe(Ve);break;case"link":he.links.push(Ce(Ve));break}}}function oe(xe){let he;for(let we=0;we<xe.childNodes.length;we++){const Ve=xe.childNodes[we];if(Ve.nodeType===1)switch(Ve.nodeName){case"prismatic":case"revolute":he=pe(Ve);break}}return he}function pe(xe){const he={sid:xe.getAttribute("sid"),name:xe.getAttribute("name")||"",axis:new U.Vector3,limits:{min:0,max:0},type:xe.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let we=0;we<xe.childNodes.length;we++){const Ve=xe.childNodes[we];if(Ve.nodeType===1)switch(Ve.nodeName){case"axis":const Ee=de(Ve.textContent);he.axis.fromArray(Ee);break;case"limits":const ri=Ve.getElementsByTagName("max")[0],Ei=Ve.getElementsByTagName("min")[0];he.limits.max=parseFloat(ri.textContent),he.limits.min=parseFloat(Ei.textContent);break}}return he.limits.min>=he.limits.max&&(he.static=!0),he.middlePosition=(he.limits.min+he.limits.max)/2,he}function Ce(xe){const he={sid:xe.getAttribute("sid"),name:xe.getAttribute("name")||"",attachments:[],transforms:[]};for(let we=0;we<xe.childNodes.length;we++){const Ve=xe.childNodes[we];if(Ve.nodeType===1)switch(Ve.nodeName){case"attachment_full":he.attachments.push(qe(Ve));break;case"matrix":case"translate":case"rotate":he.transforms.push(Qe(Ve));break}}return he}function qe(xe){const he={joint:xe.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let we=0;we<xe.childNodes.length;we++){const Ve=xe.childNodes[we];if(Ve.nodeType===1)switch(Ve.nodeName){case"link":he.links.push(Ce(Ve));break;case"matrix":case"translate":case"rotate":he.transforms.push(Qe(Ve));break}}return he}function Qe(xe){const he={type:xe.nodeName},we=de(xe.textContent);switch(he.type){case"matrix":he.obj=new U.Matrix4,he.obj.fromArray(we).transpose();break;case"translate":he.obj=new U.Vector3,he.obj.fromArray(we);break;case"rotate":he.obj=new U.Vector3,he.obj.fromArray(we),he.angle=U.MathUtils.degToRad(we[3]);break}return he}function ut(xe){const he={name:xe.getAttribute("name")||"",rigidBodies:{}};for(let we=0;we<xe.childNodes.length;we++){const Ve=xe.childNodes[we];if(Ve.nodeType===1)switch(Ve.nodeName){case"rigid_body":he.rigidBodies[Ve.getAttribute("name")]={},It(Ve,he.rigidBodies[Ve.getAttribute("name")]);break}}wi.physicsModels[xe.getAttribute("id")]=he}function It(xe,he){for(let we=0;we<xe.childNodes.length;we++){const Ve=xe.childNodes[we];if(Ve.nodeType===1)switch(Ve.nodeName){case"technique_common":mt(Ve,he);break}}}function mt(xe,he){for(let we=0;we<xe.childNodes.length;we++){const Ve=xe.childNodes[we];if(Ve.nodeType===1)switch(Ve.nodeName){case"inertia":he.inertia=de(Ve.textContent);break;case"mass":he.mass=de(Ve.textContent)[0];break}}}function Vt(xe){const he={bindJointAxis:[]};for(let we=0;we<xe.childNodes.length;we++){const Ve=xe.childNodes[we];if(Ve.nodeType===1)switch(Ve.nodeName){case"bind_joint_axis":he.bindJointAxis.push(Gt(Ve));break}}wi.kinematicsScenes[rt(xe.getAttribute("url"))]=he}function Gt(xe){const he={target:xe.getAttribute("target").split("/").pop()};for(let we=0;we<xe.childNodes.length;we++){const Ve=xe.childNodes[we];if(Ve.nodeType===1)switch(Ve.nodeName){case"axis":const Ee=Ve.getElementsByTagName("param")[0];he.axis=Ee.textContent;const ri=he.axis.split("inst_").pop().split("axis")[0];he.jointIndex=ri.substr(0,ri.length-1);break}}return he}function Wt(xe){return xe.build!==void 0?xe.build:xe}function Mi(xe){return ln(wi.kinematicsScenes[xe],Wt)}function Qi(){const xe=Object.keys(wi.kinematicsModels)[0],he=Object.keys(wi.kinematicsScenes)[0],we=Object.keys(wi.visualScenes)[0];if(xe===void 0||he===void 0)return;const Ve=Io(xe),Ee=Mi(he),ri=Vs(we),Ei=Ee.bindJointAxis,sn={};for(let on=0,Ft=Ei.length;on<Ft;on++){const yn=Ei[on],Si=ka.querySelector('[sid="'+yn.target+'"]');if(Si){const qn=Si.parentElement;Di(yn.jointIndex,qn)}}function Di(on,Ft){const yn=Ft.getAttribute("name"),Si=Ve.joints[on];ri.traverse(function(qn){qn.name===yn&&(sn[on]={object:qn,transforms:nn(Ft),joint:Si,position:Si.zeroPosition})})}const Jn=new U.Matrix4;ki={joints:Ve&&Ve.joints,getJointValue:function(on){const Ft=sn[on];if(Ft)return Ft.position;console.warn("THREE.ColladaLoader: Joint "+on+" doesn't exist.")},setJointValue:function(on,Ft){const yn=sn[on];if(yn){const Si=yn.joint;if(Ft>Si.limits.max||Ft<Si.limits.min)console.warn("THREE.ColladaLoader: Joint "+on+" value "+Ft+" outside of limits (min: "+Si.limits.min+", max: "+Si.limits.max+").");else if(Si.static)console.warn("THREE.ColladaLoader: Joint "+on+" is static.");else{const qn=yn.object,rn=Si.axis,Cn=yn.transforms;jn.identity();for(let Ar=0;Ar<Cn.length;Ar++){const Ir=Cn[Ar];if(Ir.sid&&Ir.sid.indexOf(on)!==-1)switch(Si.type){case"revolute":jn.multiply(Jn.makeRotationAxis(rn,U.MathUtils.degToRad(Ft)));break;case"prismatic":jn.multiply(Jn.makeTranslation(rn.x*Ft,rn.y*Ft,rn.z*Ft));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+Si.type);break}else switch(Ir.type){case"matrix":jn.multiply(Ir.obj);break;case"translate":jn.multiply(Jn.makeTranslation(Ir.obj.x,Ir.obj.y,Ir.obj.z));break;case"scale":jn.scale(Ir.obj);break;case"rotate":jn.multiply(Jn.makeRotationAxis(Ir.obj,Ir.angle));break}}qn.matrix.copy(jn),qn.matrix.decompose(qn.position,qn.quaternion,qn.scale),sn[on].position=Ft}}else console.log("THREE.ColladaLoader: "+on+" does not exist.")}}}function nn(xe){const he=[],we=ka.querySelector('[id="'+xe.id+'"]');for(let Ve=0;Ve<we.childNodes.length;Ve++){const Ee=we.childNodes[Ve];if(Ee.nodeType!==1)continue;let ri,Ei;switch(Ee.nodeName){case"matrix":ri=de(Ee.textContent);const sn=new U.Matrix4().fromArray(ri).transpose();he.push({sid:Ee.getAttribute("sid"),type:Ee.nodeName,obj:sn});break;case"translate":case"scale":ri=de(Ee.textContent),Ei=new U.Vector3().fromArray(ri),he.push({sid:Ee.getAttribute("sid"),type:Ee.nodeName,obj:Ei});break;case"rotate":ri=de(Ee.textContent),Ei=new U.Vector3().fromArray(ri);const Di=U.MathUtils.degToRad(ri[3]);he.push({sid:Ee.getAttribute("sid"),type:Ee.nodeName,obj:Ei,angle:Di});break}}return he}function zn(xe){const he=xe.getElementsByTagName("node");for(let we=0;we<he.length;we++){const Ve=he[we];Ve.hasAttribute("id")===!1&&Ve.setAttribute("id",ai())}}const jn=new U.Matrix4,ar=new U.Vector3;function Wn(xe){const he={name:xe.getAttribute("name")||"",type:xe.getAttribute("type"),id:xe.getAttribute("id"),sid:xe.getAttribute("sid"),matrix:new U.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let we=0;we<xe.childNodes.length;we++){const Ve=xe.childNodes[we];if(Ve.nodeType!==1)continue;let Ee;switch(Ve.nodeName){case"node":he.nodes.push(Ve.getAttribute("id")),Wn(Ve);break;case"instance_camera":he.instanceCameras.push(rt(Ve.getAttribute("url")));break;case"instance_controller":he.instanceControllers.push(Rr(Ve));break;case"instance_light":he.instanceLights.push(rt(Ve.getAttribute("url")));break;case"instance_geometry":he.instanceGeometries.push(Rr(Ve));break;case"instance_node":he.instanceNodes.push(rt(Ve.getAttribute("url")));break;case"matrix":Ee=de(Ve.textContent),he.matrix.multiply(jn.fromArray(Ee).transpose()),he.transforms[Ve.getAttribute("sid")]=Ve.nodeName;break;case"translate":Ee=de(Ve.textContent),ar.fromArray(Ee),he.matrix.multiply(jn.makeTranslation(ar.x,ar.y,ar.z)),he.transforms[Ve.getAttribute("sid")]=Ve.nodeName;break;case"rotate":Ee=de(Ve.textContent);const ri=U.MathUtils.degToRad(Ee[3]);he.matrix.multiply(jn.makeRotationAxis(ar.fromArray(Ee),ri)),he.transforms[Ve.getAttribute("sid")]=Ve.nodeName;break;case"scale":Ee=de(Ve.textContent),he.matrix.scale(ar.fromArray(Ee)),he.transforms[Ve.getAttribute("sid")]=Ve.nodeName;break;case"extra":break;default:console.log(Ve)}}return Ia(he.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",he.id):wi.nodes[he.id]=he,he}function Rr(xe){const he={id:rt(xe.getAttribute("url")),materials:{},skeletons:[]};for(let we=0;we<xe.childNodes.length;we++){const Ve=xe.childNodes[we];switch(Ve.nodeName){case"bind_material":const Ee=Ve.getElementsByTagName("instance_material");for(let ri=0;ri<Ee.length;ri++){const Ei=Ee[ri],sn=Ei.getAttribute("symbol"),Di=Ei.getAttribute("target");he.materials[sn]=rt(Di)}break;case"skeleton":he.skeletons.push(rt(Ve.textContent));break}}return he}function Ur(xe,he){const we=[],Ve=[];let Ee,ri,Ei;for(Ee=0;Ee<xe.length;Ee++){const Jn=xe[Ee];let on;if(Ia(Jn))on=Da(Jn),Br(on,he,we);else if(dl(Jn)){const yn=wi.visualScenes[Jn].children;for(let Si=0;Si<yn.length;Si++){const qn=yn[Si];if(qn.type==="JOINT"){const rn=Da(qn.id);Br(rn,he,we)}}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",Jn)}for(Ee=0;Ee<he.length;Ee++)for(ri=0;ri<we.length;ri++)if(Ei=we[ri],Ei.bone.name===he[Ee].name){Ve[Ee]=Ei,Ei.processed=!0;break}for(Ee=0;Ee<we.length;Ee++)Ei=we[Ee],Ei.processed===!1&&(Ve.push(Ei),Ei.processed=!0);const sn=[],Di=[];for(Ee=0;Ee<Ve.length;Ee++)Ei=Ve[Ee],sn.push(Ei.bone),Di.push(Ei.boneInverse);return new U.Skeleton(sn,Di)}function Br(xe,he,we){xe.traverse(function(Ve){if(Ve.isBone===!0){let Ee;for(let ri=0;ri<he.length;ri++){const Ei=he[ri];if(Ei.name===Ve.name){Ee=Ei.boneInverse;break}}Ee===void 0&&(Ee=new U.Matrix4),we.push({bone:Ve,boneInverse:Ee,processed:!1})}})}function sa(xe){const he=[],we=xe.matrix,Ve=xe.nodes,Ee=xe.type,ri=xe.instanceCameras,Ei=xe.instanceControllers,sn=xe.instanceLights,Di=xe.instanceGeometries,Jn=xe.instanceNodes;for(let Ft=0,yn=Ve.length;Ft<yn;Ft++)he.push(Da(Ve[Ft]));for(let Ft=0,yn=ri.length;Ft<yn;Ft++){const Si=dn(ri[Ft]);Si!==null&&he.push(Si.clone())}for(let Ft=0,yn=Ei.length;Ft<yn;Ft++){const Si=Ei[Ft],qn=vr(Si.id),rn=Js(qn.id),Cn=Rs(rn,Si.materials),Ar=Si.skeletons,Ir=qn.skin.joints,Gr=Ur(Ar,Ir);for(let Lr=0,xr=Cn.length;Lr<xr;Lr++){const On=Cn[Lr];On.isSkinnedMesh&&(On.bind(Gr,qn.skin.bindMatrix),On.normalizeSkinWeights()),he.push(On)}}for(let Ft=0,yn=sn.length;Ft<yn;Ft++){const Si=Ca(sn[Ft]);Si!==null&&he.push(Si.clone())}for(let Ft=0,yn=Di.length;Ft<yn;Ft++){const Si=Di[Ft],qn=Js(Si.id),rn=Rs(qn,Si.materials);for(let Cn=0,Ar=rn.length;Cn<Ar;Cn++)he.push(rn[Cn])}for(let Ft=0,yn=Jn.length;Ft<yn;Ft++)he.push(Da(Jn[Ft]).clone());let on;if(Ve.length===0&&he.length===1)on=he[0];else{on=Ee==="JOINT"?new U.Bone:new U.Group;for(let Ft=0;Ft<he.length;Ft++)on.add(he[Ft])}return on.name=Ee==="JOINT"?xe.sid:xe.name,on.matrix.copy(we),on.matrix.decompose(on.position,on.quaternion,on.scale),on}const Wr=new U.MeshBasicMaterial({color:16711935});function tr(xe,he){const we=[];for(let Ve=0,Ee=xe.length;Ve<Ee;Ve++){const ri=he[xe[Ve]];ri===void 0?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",xe[Ve]),we.push(Wr)):we.push(mr(ri))}return we}function Rs(xe,he){const we=[];for(const Ve in xe){const Ee=xe[Ve],ri=tr(Ee.materialKeys,he);ri.length===0&&(Ve==="lines"||Ve==="linestrips"?ri.push(new U.LineBasicMaterial):ri.push(new U.MeshPhongMaterial));const Ei=Ee.data.attributes.skinIndex!==void 0,sn=ri.length===1?ri[0]:ri;let Di;switch(Ve){case"lines":Di=new U.LineSegments(Ee.data,sn);break;case"linestrips":Di=new U.Line(Ee.data,sn);break;case"triangles":case"polylist":Ei?Di=new U.SkinnedMesh(Ee.data,sn):Di=new U.Mesh(Ee.data,sn);break}we.push(Di)}return we}function Ia(xe){return wi.nodes[xe]!==void 0}function Da(xe){return ln(wi.nodes[xe],sa)}function _s(xe){const he={name:xe.getAttribute("name"),children:[]};zn(xe);const we=r(xe,"node");for(let Ve=0;Ve<we.length;Ve++)he.children.push(Wn(we[Ve]));wi.visualScenes[xe.getAttribute("id")]=he}function qo(xe){const he=new U.Group;he.name=xe.name;const we=xe.children;for(let Ve=0;Ve<we.length;Ve++){const Ee=we[Ve];he.add(Da(Ee.id))}return he}function dl(xe){return wi.visualScenes[xe]!==void 0}function Vs(xe){return ln(wi.visualScenes[xe],qo)}function Au(xe){const he=r(xe,"instance_visual_scene")[0];return Vs(rt(he.getAttribute("url")))}function Bc(){const xe=wi.clips;if(bi(xe)===!0){if(bi(wi.animations)===!1){const he=[];for(const we in wi.animations){const Ve=Nn(we);for(let Ee=0,ri=Ve.length;Ee<ri;Ee++)he.push(Ve[Ee])}yt.push(new U.AnimationClip("default",-1,he))}}else for(const he in xe)yt.push(vt(he))}function Ql(xe){let he="";const we=[xe];for(;we.length;){const Ve=we.shift();Ve.nodeType===Node.TEXT_NODE?he+=Ve.textContent:(he+=`
`,we.push.apply(we,Ve.childNodes))}return he.trim()}if(ei.length===0)return{scene:new U.Scene};const fo=new DOMParser().parseFromString(ei,"application/xml"),ka=r(fo,"COLLADA")[0],Do=fo.getElementsByTagName("parsererror")[0];if(Do!==void 0){const xe=r(Do,"div")[0];let he;return xe?he=xe.textContent:he=Ql(Do),console.error(`THREE.ColladaLoader: Failed to parse collada file.
`,he),null}const xo=ka.getAttribute("version");console.log("THREE.ColladaLoader: File version",xo);const Me=Ai(r(ka,"asset")[0]),be=new U.TextureLoader(this.manager);be.setPath(this.resourcePath||Le).setCrossOrigin(this.crossOrigin);let Fe;U.TGALoader&&(Fe=new U.TGALoader(this.manager),Fe.setPath(this.resourcePath||Le));const yt=[];let ki={},Yi=0;const wi={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};kt(ka,"library_animations","animation",Xi),kt(ka,"library_animation_clips","animation_clip",Ie),kt(ka,"library_controllers","controller",bt),kt(ka,"library_images","image",et),kt(ka,"library_effects","effect",ra),kt(ka,"library_materials","material",cr),kt(ka,"library_cameras","camera",Nr),kt(ka,"library_lights","light",Xn),kt(ka,"library_geometries","geometry",ja),kt(ka,"library_nodes","node",Wn),kt(ka,"library_visual_scenes","visual_scene",_s),kt(ka,"library_kinematics_models","kinematics_model",Ro),kt(ka,"library_physics_models","physics_model",ut),kt(ka,"scene","instance_kinematics_scene",Vt),Tt(wi.animations,ci),Tt(wi.clips,it),Tt(wi.controllers,mn),Tt(wi.images,jr),Tt(wi.effects,wn),Tt(wi.materials,Er),Tt(wi.cameras,$a),Tt(wi.lights,Us),Tt(wi.geometries,ht),Tt(wi.visualScenes,qo),Bc(),Qi();const hn=Au(r(ka,"scene")[0]);return hn.animations=yt,Me.upAxis==="Z_UP"&&hn.quaternion.setFromEuler(new U.Euler(-Math.PI/2,0,0)),hn.scale.multiplyScalar(Me.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),yt},kinematics:ki,library:wi,scene:hn}}}U.ColladaLoader=Ze})(),En.exports=U.ColladaLoader}(wy)),wy.exports}var sx;function Ib(){return sx||(sx=1,function(En,na){const U=Ld(),Ze=Pp(),St=Sb(),ei=Eb(),Le=Cb(),r=Lb(),Ge=Rb(),de=new St,Je=new ei,rt=new r,ai=new Le,bi=new Ge;function Ai(qt,xi,kt){if(qt===void 0)return console.error("Invalid options provided to loadObj()");qt=U._validate(qt,Ze.prototype._defaults.loadObj);let Tt;switch(qt.type||(qt.type="mtl"),qt.type){case"mtl":Tt=de;break;case"gltf":case"glb":Tt=rt;break;case"fbx":Tt=ai;break;case"dae":Tt=bi;break}Je.load(qt.mtl,ln,()=>null,Dt=>{console.warn("No material file found "+Dt.stack)});function ln(Dt){Dt&&qt.type=="mtl"&&(Dt.preload(),Tt.setMaterials(Dt)),Tt.load(qt.obj,ni=>{let ci=[];switch(qt.type){case"mtl":ni=ni.children[0];break;case"gltf":case"glb":case"dae":ci=ni.animations,ni=ni.scene;break;case"fbx":ci=ni.animations;break}ni.animations=ci;const Nn=U.types.rotation(qt.rotation,[0,0,0]),Fi=U.types.scale(qt.scale,[1,1,1]);ni.rotation.set(Nn[0],Nn[1],Nn[2]),ni.scale.set(Fi[0],Fi[1],Fi[2]),qt.normalize&&Xi(ni),ni.name="model";let oi=Ze.prototype._makeGroup(ni,qt);Ze.prototype._addMethods(oi),oi.setAnchor(qt.anchor),oi.setCenter(qt.adjustment),oi.raycasted=qt.raycasted,kt(oi),xi(oi),oi.setFixedZoom(qt.mapScale),oi.idle()},()=>null,ni=>{console.error("Could not load model file: "+qt.obj+` 
 `+ni.stack),kt("Error loading the model")})}function Xi(Dt){Dt.traverse(function(ni){if(ni.isMesh){let ci;ni.material.type=="MeshStandardMaterial"?(ni.material.metalness&&(ni.material.metalness*=.1),ni.material.glossiness&&(ni.material.glossiness*=.25),ci=new THREE.Color(12,12,12)):ni.material.type=="MeshPhongMaterial"&&(ni.material.shininess=.1,ci=new THREE.Color(20,20,20)),ni.material.specular&&ni.material.specular.isColor&&(ni.material.specular=ci)}})}}En.exports=Ai}(_y)),_y.exports}var My={exports:{}},ox;function Db(){return ox||(ox=1,function(En,na){const U=Oc(),Ze=Ld(),St=Pp();function ei(Le){Le=Ze._validate(Le,St.prototype._defaults.line);var r=Ze.lnglatsToWorld(Le.geometry),Ge=Ze.normalizeVertices(r),de=Ze.flattenVectors(Ge.vertices),Je=new U.LineGeometry;Je.setPositions(de);let rt=new U.LineMaterial({color:Le.color,linewidth:Le.width,dashed:!1,opacity:Le.opacity});return rt.resolution.set(window.innerWidth,window.innerHeight),rt.isMaterial=!0,rt.transparent=!0,rt.depthWrite=!1,ei=new U.Line2(Je,rt),ei.position.copy(Ge.position),ei.computeLineDistances(),ei}En.exports=ei,function(){const Le=new U.Box3,r=new U.Vector3;class Ge extends U.InstancedBufferGeometry{constructor(){super(),this.type="LineSegmentsGeometry";const Je=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],rt=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],ai=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(ai),this.setAttribute("position",new U.Float32BufferAttribute(Je,3)),this.setAttribute("uv",new U.Float32BufferAttribute(rt,2))}applyMatrix4(Je){const rt=this.attributes.instanceStart,ai=this.attributes.instanceEnd;return rt!==void 0&&(rt.applyMatrix4(Je),ai.applyMatrix4(Je),rt.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(Je){let rt;Je instanceof Float32Array?rt=Je:Array.isArray(Je)&&(rt=new Float32Array(Je));const ai=new U.InstancedInterleavedBuffer(rt,6,1);return this.setAttribute("instanceStart",new U.InterleavedBufferAttribute(ai,3,0)),this.setAttribute("instanceEnd",new U.InterleavedBufferAttribute(ai,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(Je){let rt;Je instanceof Float32Array?rt=Je:Array.isArray(Je)&&(rt=new Float32Array(Je));const ai=new U.InstancedInterleavedBuffer(rt,6,1);return this.setAttribute("instanceColorStart",new U.InterleavedBufferAttribute(ai,3,0)),this.setAttribute("instanceColorEnd",new U.InterleavedBufferAttribute(ai,3,3)),this}fromWireframeGeometry(Je){return this.setPositions(Je.attributes.position.array),this}fromEdgesGeometry(Je){return this.setPositions(Je.attributes.position.array),this}fromMesh(Je){return this.fromWireframeGeometry(new U.WireframeGeometry(Je.geometry)),this}fromLineSegments(Je){const rt=Je.geometry;if(rt.isGeometry){console.error("THREE.LineSegmentsGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else rt.isBufferGeometry&&this.setPositions(rt.attributes.position.array);return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new U.Box3);const Je=this.attributes.instanceStart,rt=this.attributes.instanceEnd;Je!==void 0&&rt!==void 0&&(this.boundingBox.setFromBufferAttribute(Je),Le.setFromBufferAttribute(rt),this.boundingBox.union(Le))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new U.Sphere),this.boundingBox===null&&this.computeBoundingBox();const Je=this.attributes.instanceStart,rt=this.attributes.instanceEnd;if(Je!==void 0&&rt!==void 0){const ai=this.boundingSphere.center;this.boundingBox.getCenter(ai);let bi=0;for(let Ai=0,qt=Je.count;Ai<qt;Ai++)r.fromBufferAttribute(Je,Ai),bi=Math.max(bi,ai.distanceToSquared(r)),r.fromBufferAttribute(rt,Ai),bi=Math.max(bi,ai.distanceToSquared(r));this.boundingSphere.radius=Math.sqrt(bi),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(Je){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(Je)}}Ge.prototype.isLineSegmentsGeometry=!0,U.LineSegmentsGeometry=Ge}(),function(){class Le extends U.LineSegmentsGeometry{constructor(){super(),this.type="LineGeometry"}setPositions(Ge){for(var de=Ge.length-3,Je=new Float32Array(2*de),rt=0;rt<de;rt+=3)Je[2*rt]=Ge[rt],Je[2*rt+1]=Ge[rt+1],Je[2*rt+2]=Ge[rt+2],Je[2*rt+3]=Ge[rt+3],Je[2*rt+4]=Ge[rt+4],Je[2*rt+5]=Ge[rt+5];return super.setPositions(Je),this}setColors(Ge){for(var de=Ge.length-3,Je=new Float32Array(2*de),rt=0;rt<de;rt+=3)Je[2*rt]=Ge[rt],Je[2*rt+1]=Ge[rt+1],Je[2*rt+2]=Ge[rt+2],Je[2*rt+3]=Ge[rt+3],Je[2*rt+4]=Ge[rt+4],Je[2*rt+5]=Ge[rt+5];return super.setColors(Je),this}fromLine(Ge){var de=Ge.geometry;if(de.isGeometry){console.error("THREE.LineGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else de.isBufferGeometry&&this.setPositions(de.attributes.position.array);return this}}Le.prototype.isLineGeometry=!0,U.LineGeometry=Le}(),function(){class Le extends U.LineSegmentsGeometry{constructor(Ge){super(),this.type="WireframeGeometry2",this.fromWireframeGeometry(new U.WireframeGeometry(Ge))}}Le.prototype.isWireframeGeometry2=!0,U.WireframeGeometry2=Le}(),function(){U.UniformsLib.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new U.Vector2(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},U.ShaderLib.line={uniforms:U.UniformsUtils.merge([U.UniformsLib.common,U.UniformsLib.fog,U.UniformsLib.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		varying vec2 vUv;
		varying vec4 worldPos;
		varying vec3 worldStart;
		varying vec3 worldEnd;

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;

			#endif

			float aspect = resolution.x / resolution.y;

			vUv = uv;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			worldStart = start.xyz;
			worldEnd = end.xyz;

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segements overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;
		varying vec4 worldPos;
		varying vec3 worldStart;
		varying vec3 worldEnd;

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		varying vec2 vUv;

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class Le extends U.ShaderMaterial{constructor(Ge){super({type:"LineMaterial",uniforms:U.UniformsUtils.clone(U.ShaderLib.line.uniforms),vertexShader:U.ShaderLib.line.vertexShader,fragmentShader:U.ShaderLib.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(de){this.uniforms.diffuse.value=de}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(de){de===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(de){this.uniforms.linewidth.value=de}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(de){!!de!="USE_DASH"in this.defines&&(this.needsUpdate=!0),de===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(de){this.uniforms.dashScale.value=de}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(de){this.uniforms.dashSize.value=de}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(de){this.uniforms.dashOffset.value=de}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(de){this.uniforms.gapSize.value=de}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(de){this.uniforms.opacity.value=de}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(de){this.uniforms.resolution.value.copy(de)}},alphaToCoverage:{enumerable:!0,get:function(){return"ALPHA_TO_COVERAGE"in this.defines},set:function(de){!!de!="ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),de===!0?(this.defines.ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(Ge)}}Le.prototype.isLineMaterial=!0,U.LineMaterial=Le}(),function(){const Le=new U.Vector3,r=new U.Vector3,Ge=new U.Vector4,de=new U.Vector4,Je=new U.Vector4,rt=new U.Vector3,ai=new U.Matrix4,bi=new U.Line3,Ai=new U.Vector3,qt=new U.Box3,xi=new U.Sphere,kt=new U.Vector4;class Tt extends U.Mesh{constructor(Xi=new U.LineSegmentsGeometry,Dt=new U.LineMaterial({color:Math.random()*16777215})){super(Xi,Dt),this.type="LineSegments2"}computeLineDistances(){const Xi=this.geometry,Dt=Xi.attributes.instanceStart,ni=Xi.attributes.instanceEnd,ci=new Float32Array(2*Dt.count);for(let Fi=0,oi=0,Ci=Dt.count;Fi<Ci;Fi++,oi+=2)Le.fromBufferAttribute(Dt,Fi),r.fromBufferAttribute(ni,Fi),ci[oi]=oi===0?0:ci[oi-1],ci[oi+1]=ci[oi]+Le.distanceTo(r);const Nn=new U.InstancedInterleavedBuffer(ci,2,1);return Xi.setAttribute("instanceDistanceStart",new U.InterleavedBufferAttribute(Nn,1,0)),Xi.setAttribute("instanceDistanceEnd",new U.InterleavedBufferAttribute(Nn,1,1)),this}raycast(Xi,Dt){Xi.camera===null&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');const ni=Xi.params.Line2!==void 0&&Xi.params.Line2.threshold||0,ci=Xi.ray,Nn=Xi.camera,Fi=Nn.projectionMatrix,oi=this.matrixWorld,Ci=this.geometry,Zt=this.material,Yt=Zt.resolution,vi=Zt.linewidth+ni,ae=Ci.attributes.instanceStart,ge=Ci.attributes.instanceEnd,Te=-Nn.near,Re=2*Math.max(vi/Yt.width,vi/Yt.height);Ci.boundingSphere===null&&Ci.computeBoundingSphere(),xi.copy(Ci.boundingSphere).applyMatrix4(oi);const ze=Math.max(Nn.near,xi.distanceToPoint(ci.origin));kt.set(0,0,-ze,1).applyMatrix4(Nn.projectionMatrix),kt.multiplyScalar(1/kt.w),kt.applyMatrix4(Nn.projectionMatrixInverse);const Ie=Math.abs(Re/kt.w)*.5;if(xi.radius+=Ie,Xi.ray.intersectsSphere(xi)===!1)return;Ci.boundingBox===null&&Ci.computeBoundingBox(),qt.copy(Ci.boundingBox).applyMatrix4(oi);const it=Math.max(Nn.near,qt.distanceToPoint(ci.origin));kt.set(0,0,-it,1).applyMatrix4(Nn.projectionMatrix),kt.multiplyScalar(1/kt.w),kt.applyMatrix4(Nn.projectionMatrixInverse);const vt=Math.abs(Re/kt.w)*.5;if(qt.max.x+=vt,qt.max.y+=vt,qt.max.z+=vt,qt.min.x-=vt,qt.min.y-=vt,qt.min.z-=vt,Xi.ray.intersectsBox(qt)!==!1){ci.at(1,Je),Je.w=1,Je.applyMatrix4(Nn.matrixWorldInverse),Je.applyMatrix4(Fi),Je.multiplyScalar(1/Je.w),Je.x*=Yt.x/2,Je.y*=Yt.y/2,Je.z=0,rt.copy(Je),ai.multiplyMatrices(Nn.matrixWorldInverse,oi);for(let pt=0,ti=ae.count;pt<ti;pt++){Ge.fromBufferAttribute(ae,pt),de.fromBufferAttribute(ge,pt),Ge.w=1,de.w=1,Ge.applyMatrix4(ai),de.applyMatrix4(ai);var bt=Ge.z>Te&&de.z>Te;if(bt)continue;if(Ge.z>Te){const et=Ge.z-de.z,jr=(Ge.z-Te)/et;Ge.lerp(de,jr)}else if(de.z>Te){const et=de.z-Ge.z,jr=(de.z-Te)/et;de.lerp(Ge,jr)}Ge.applyMatrix4(Fi),de.applyMatrix4(Fi),Ge.multiplyScalar(1/Ge.w),de.multiplyScalar(1/de.w),Ge.x*=Yt.x/2,Ge.y*=Yt.y/2,de.x*=Yt.x/2,de.y*=Yt.y/2,bi.start.copy(Ge),bi.start.z=0,bi.end.copy(de),bi.end.z=0;const Wi=bi.closestPointToPointParameter(rt,!0);bi.at(Wi,Ai);const mn=U.MathUtils.lerp(Ge.z,de.z,Wi),fn=mn>=-1&&mn<=1,vr=rt.distanceTo(Ai)<vi*.5;if(fn&&vr){bi.start.fromBufferAttribute(ae,pt),bi.end.fromBufferAttribute(ge,pt),bi.start.applyMatrix4(oi),bi.end.applyMatrix4(oi);const et=new U.Vector3,jr=new U.Vector3;ci.distanceSqToSegment(bi.start,bi.end,jr,et),Dt.push({point:jr,pointOnLine:et,distance:ci.origin.distanceTo(jr),object:this,face:null,faceIndex:pt,uv:null,uv2:null})}}}}}Tt.prototype.LineSegments2=!0,U.LineSegments2=Tt}(),function(){class Le extends U.LineSegments2{constructor(Ge=new U.LineGeometry,de=new U.LineMaterial({color:Math.random()*16777215})){super(Ge,de),this.type="Line2"}}Le.prototype.isLine2=!0,U.Line2=Le}(),function(){const Le=new U.Vector3,r=new U.Vector3;class Ge extends U.Mesh{constructor(Je=new U.LineSegmentsGeometry,rt=new U.LineMaterial({color:Math.random()*16777215})){super(Je,rt),this.type="Wireframe"}computeLineDistances(){const Je=this.geometry,rt=Je.attributes.instanceStart,ai=Je.attributes.instanceEnd,bi=new Float32Array(2*rt.count);for(let qt=0,xi=0,kt=rt.count;qt<kt;qt++,xi+=2)Le.fromBufferAttribute(rt,qt),r.fromBufferAttribute(ai,qt),bi[xi]=xi===0?0:bi[xi-1],bi[xi+1]=bi[xi]+Le.distanceTo(r);const Ai=new U.InstancedInterleavedBuffer(bi,2,1);return Je.setAttribute("instanceDistanceStart",new U.InterleavedBufferAttribute(Ai,1,0)),Je.setAttribute("instanceDistanceEnd",new U.InterleavedBufferAttribute(Ai,1,1)),this}}Ge.prototype.isWireframe=!0,U.Wireframe=Ge}()}(My)),My.exports}var Ty={exports:{}},lx;function zb(){return lx||(lx=1,function(En,na){const U=Ld(),Ze=e_(),St=Pp(),ei=Oc(),Le=i_();function r(Ge,de){Ge=U._validate(Ge,St.prototype._defaults.tube);let Je=[];Ge.geometry.forEach(qt=>{Je.push(new ei.Vector3(qt[0],qt[1],qt[2]))});const rt=new ei.CatmullRomCurve3(Je);let ai=new ei.TubeGeometry(rt,Je.length,Ge.radius,Ge.sides,!1),bi=Ze(Ge),Ai=new ei.Mesh(ai,bi);return new Le({obj:Ai,units:Ge.units,anchor:Ge.anchor,adjustment:Ge.adjustment,bbox:Ge.bbox,tooltip:Ge.tooltip,raycasted:Ge.raycasted})}En.exports=r}(Ty)),Ty.exports}var Sy={exports:{}},cx;function Pb(){return cx||(cx=1,function(En,na){const U=t_();function Ze(St){this.map=St,this.renderer=new U.CSS2DRenderer,this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight),this.renderer.domElement.style.position="absolute",this.renderer.domElement.id="labelCanvas",this.renderer.domElement.style.top=0,this.renderer.domElement.style.zIndex="0",this.map.getCanvasContainer().appendChild(this.renderer.domElement),this.scene,this.camera,this.dispose=function(){this.map.getCanvasContainer().removeChild(this.renderer.domElement),this.renderer.domElement.remove(),this.renderer={}},this.setSize=function(ei,Le){this.renderer.setSize(ei,Le)},this.map.on("resize",(function(){this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight)}).bind(this)),this.state={reset:function(){}},this.render=async function(ei,Le){return this.scene=ei,this.camera=Le,new Promise(r=>{r(this.renderer.render(ei,Le))})},this.toggleLabels=async function(ei,Le){return new Promise(r=>{r(this.setVisibility(ei,Le,this.scene,this.camera,this.renderer))})},this.setVisibility=function(ei,Le,r,Ge,de){var Je=this.renderer.cacheList;Je.forEach(function(rt){rt.visible!=Le&&rt.layer===ei&&(Le&&rt.alwaysVisible||!Le)&&(rt.visible=Le,de.renderObject(rt,r,Ge))})}}En.exports=Ze}(Sy)),Sy.exports}var Ey={exports:{}},ux;function Ob(){return ux||(ux=1,function(En,na){yx();class U{constructor(St,ei){this.id=St.layerId,this.type="custom",this.renderingMode="3d",this.opacity=.5,this.buildingsLayerId=St.buildingsLayerId,this.minAltitude=St.minAltitude||.1,this.tb=ei}onAdd(St,ei){this.map=St;const Le=`
			uniform mat4 u_matrix;
			uniform float u_height_factor;
			uniform float u_altitude;
			uniform float u_azimuth;
			attribute vec2 a_pos;
			attribute vec4 a_normal_ed;
			attribute lowp vec2 a_base;
			attribute lowp vec2 a_height;
			void main() {
				float base = max(0.0, a_base.x);
				float height = max(0.0, a_height.x);
				float t = mod(a_normal_ed.x, 2.0);
				vec4 pos = vec4(a_pos, t > 0.0 ? height : base, 1);
				float len = pos.z * u_height_factor / tan(u_altitude);
				pos.x += cos(u_azimuth) * len;
				pos.y += sin(u_azimuth) * len;
				pos.z = 0.0;
				gl_Position = u_matrix * pos;
			}
			`,r=`
			void main() {
				gl_FragColor = vec4(0.0, 0.0, 0.0, 0.7);
			}
			`,Ge=ei.createShader(ei.VERTEX_SHADER);ei.shaderSource(Ge,Le),ei.compileShader(Ge);const de=ei.createShader(ei.FRAGMENT_SHADER);ei.shaderSource(de,r),ei.compileShader(de),this.program=ei.createProgram(),ei.attachShader(this.program,Ge),ei.attachShader(this.program,de),ei.linkProgram(this.program),ei.validateProgram(this.program),this.uMatrix=ei.getUniformLocation(this.program,"u_matrix"),this.uHeightFactor=ei.getUniformLocation(this.program,"u_height_factor"),this.uAltitude=ei.getUniformLocation(this.program,"u_altitude"),this.uAzimuth=ei.getUniformLocation(this.program,"u_azimuth"),this.aPos=ei.getAttribLocation(this.program,"a_pos"),this.aNormal=ei.getAttribLocation(this.program,"a_normal_ed"),this.aBase=ei.getAttribLocation(this.program,"a_base"),this.aHeight=ei.getAttribLocation(this.program,"a_height")}render(St,ei){St.useProgram(this.program);const Le=this.map.style.sourceCaches.composite,r=Le.getVisibleCoordinates().reverse(),Ge=this.map.getLayer(this.buildingsLayerId),de=this.map.painter.context,{lng:Je,lat:rt}=this.map.getCenter(),ai=this.tb.getSunPosition(this.tb.lightDateTime,[Je,rt]);St.uniform1f(this.uAltitude,ai.altitude>this.minAltitude?ai.altitude:0),St.uniform1f(this.uAzimuth,ai.azimuth+3*Math.PI/2),St.enable(St.BLEND),St.blendFunc(St.SRC_ALPHA,St.ONE_MINUS_SRC_ALPHA),St.getExtension("EXT_blend_minmax"),St.disable(St.DEPTH_TEST);for(const bi of r){const Ai=Le.getTile(bi),qt=Ai.getBucket(Ge);if(!qt)continue;const[xi,kt]=qt.programConfigurations.programConfigurations[this.buildingsLayerId]._buffers;St.uniformMatrix4fv(this.uMatrix,!1,bi.posMatrix),St.uniform1f(this.uHeightFactor,Math.pow(2,bi.overscaledZ)/Ai.tileSize/8);for(const Tt of qt.segments.get()){const ln=de.currentNumAttributes||0,Xi=2;for(let ni=Xi;ni<ln;ni++)St.disableVertexAttribArray(ni);const Dt=Tt.vertexOffset||0;St.enableVertexAttribArray(this.aPos),St.enableVertexAttribArray(this.aNormal),St.enableVertexAttribArray(this.aHeight),St.enableVertexAttribArray(this.aBase),qt.layoutVertexBuffer.bind(),St.vertexAttribPointer(this.aPos,2,St.SHORT,!1,12,12*Dt),St.vertexAttribPointer(this.aNormal,4,St.SHORT,!1,12,4+12*Dt),xi.bind(),St.vertexAttribPointer(this.aHeight,1,St.FLOAT,!1,4,4*Dt),kt.bind(),St.vertexAttribPointer(this.aBase,1,St.FLOAT,!1,4,4*Dt),qt.indexBuffer.bind(),de.currentNumAttributes=Xi,St.drawElements(St.TRIANGLES,Tt.primitiveLength*3,St.UNSIGNED_SHORT,Tt.primitiveOffset*3*2)}}}}En.exports=U}(Ey)),Ey.exports}var hx;function Bb(){return hx||(hx=1,function(En,na){const U=Oc(),Ze=vb(),St=Ld(),ei=yx(),Le=Ly(),r=Pp(),Ge=e_(),de=bb(),Je=wb(),rt=Mb(),ai=Tb(),bi=Ib(),Ai=i_(),qt=Db(),xi=zb(),kt=Pb(),Tt=Ob();function ln(Dt,ni,ci){this.init(Dt,ni,ci)}ln.prototype={repaint:function(){this.map.repaint=!0},init:function(Dt,ni,ci){this.options=St._validate(ci||{},Xi),this.map=Dt,this.map.tb=this,this.objects=new r,this.mapboxVersion=parseFloat(this.map.version),this.renderer=new U.WebGLRenderer({alpha:!0,antialias:!0,preserveDrawingBuffer:ci.preserveDrawingBuffer,canvas:Dt.getCanvas(),context:ni}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.map.getCanvas().clientWidth,this.map.getCanvas().clientHeight),this.renderer.outputEncoding=U.sRGBEncoding,this.renderer.autoClear=!1,this.labelRenderer=new kt(this.map),this.scene=new U.Scene,this.world=new U.Group,this.world.name="world",this.scene.add(this.world),this.objectsCache=new Map,this.zoomLayers=[],this.fov=this.options.fov,this.orthographic=this.options.orthographic||!1,this.raycaster=new U.Raycaster,this.raycaster.layers.set(0),this.mapCenter=this.map.getCenter(),this.mapCenterUnits=St.projectToWorld([this.mapCenter.lng,this.mapCenter.lat]),this.lightDateTime=new Date,this.lightLng=this.mapCenter.lng,this.lightLat=this.mapCenter.lat,this.sunPosition,this.rotationStep=5,this.gridStep=6,this.altitudeStep=.1,this.defaultCursor="default",this.lights=this.initLights,this.options.defaultLights&&this.defaultLights(),this.options.realSunlight&&this.realSunlight(this.options.realSunlightHelper),this.skyLayerName="sky-layer",this.terrainSourceName="mapbox-dem",this.terrainExaggeration=1,this.terrainLayerName="",this.enableSelectingFeatures=this.options.enableSelectingFeatures||!1,this.enableSelectingObjects=this.options.enableSelectingObjects||!1,this.enableDraggingObjects=this.options.enableDraggingObjects||!1,this.enableRotatingObjects=this.options.enableRotatingObjects||!1,this.enableTooltips=this.options.enableTooltips||!1,this.multiLayer=this.options.multiLayer||!1,this.enableHelpTooltips=this.options.enableHelpTooltips||!1,this.map.on("style.load",function(){this.tb.zoomLayers=[],this.tb.options.multiLayer&&this.addLayer({id:"threebox_layer",type:"custom",renderingMode:"3d",map:this,onAdd:function(Fi,oi){},render:function(Fi,oi){this.map.tb.update()}}),this.once("idle",()=>{this.tb.setObjectsScale()}),this.tb.options.sky&&(this.tb.sky=!0),this.tb.options.terrain&&(this.tb.terrain=!0),["satellite","mapbox-mapbox-satellite","satelliteLayer"].forEach(Fi=>{this.getLayer(Fi)&&(this.tb.terrainLayerName=Fi)})}),this.map.on("load",function(){this.selectedObject,this.selectedFeature,this.draggedObject;let Nn;this.overedObject,this.overedFeature;let Fi=this.getCanvasContainer();this.getCanvasContainer().style.cursor=this.tb.defaultCursor;let oi,Ci=[],Zt,Yt,vi,ae;function ge(pt){var ti=Fi.getBoundingClientRect();return{x:pt.originalEvent.clientX-ti.left-Fi.clientLeft,y:pt.originalEvent.clientY-ti.top-Fi.clientTop}}this.unselectObject=function(){this.selectedObject.selected=!1,this.selectedObject=null},this.outObject=function(){this.overedObject.over=!1,this.overedObject=null},this.unselectFeature=function(pt){typeof pt.id>"u"||(this.setFeatureState({source:pt.source,sourceLayer:pt.sourceLayer,id:pt.id},{select:!1}),this.removeTooltip(pt),pt=this.queryRenderedFeatures({layers:[pt.layer.id],filter:["==",["id"],pt.id]})[0],pt&&this.fire("SelectedFeatureChange",{detail:pt}),this.selectedFeature=null)},this.selectFeature=function(pt){this.selectedFeature=pt,this.setFeatureState({source:this.selectedFeature.source,sourceLayer:this.selectedFeature.sourceLayer,id:this.selectedFeature.id},{select:!0}),this.selectedFeature=this.queryRenderedFeatures({layers:[this.selectedFeature.layer.id],filter:["==",["id"],this.selectedFeature.id]})[0],this.addTooltip(this.selectedFeature),this.fire("SelectedFeatureChange",{detail:this.selectedFeature})},this.outFeature=function(pt){this.overedFeature&&typeof this.overedFeature<"u"&&this.overedFeature.id!=pt&&(Dt.setFeatureState({source:this.overedFeature.source,sourceLayer:this.overedFeature.sourceLayer,id:this.overedFeature.id},{hover:!1}),this.removeTooltip(this.overedFeature),this.overedFeature=null)},this.addTooltip=function(pt){if(!this.tb.enableTooltips)return;let ti=this.tb.getFeatureCenter(pt),Wi=this.tb.tooltip({text:pt.properties.name||pt.id||pt.type,mapboxStyle:!0,feature:pt});Wi.setCoords(ti),this.tb.add(Wi,pt.layer.id),pt.tooltip=Wi,pt.tooltip.tooltip.visible=!0},this.removeTooltip=function(pt){pt.tooltip&&(pt.tooltip.visibility=!1,this.tb.remove(pt.tooltip),pt.tooltip=null)},Dt.onContextMenu=function(pt){alert("contextMenu")},this.onClick=function(pt){let ti,Wi=[];if(Dt.tb.enableSelectingObjects&&(Wi=this.tb.queryRenderedFeatures(pt.point)),ti=typeof Wi[0]=="object",ti){let mn=ln.prototype.findParent3DObject(Wi[0]);if(mn){if(this.selectedFeature&&this.unselectFeature(this.selectedFeature),!this.selectedObject)this.selectedObject=mn,this.selectedObject.selected=!0;else if(this.selectedObject.uuid!=mn.uuid)this.selectedObject.selected=!1,mn.selected=!0,this.selectedObject=mn;else if(this.selectedObject.uuid==mn.uuid){this.unselectObject();return}this.selectedObject.dispatchEvent({type:"Wireframed",detail:this.selectedObject}),this.selectedObject.dispatchEvent({type:"IsPlayingChanged",detail:this.selectedObject}),this.repaint=!0,pt.preventDefault()}}else{let mn=[];if(Dt.tb.enableSelectingFeatures&&(mn=this.queryRenderedFeatures(pt.point)),mn.length>0&&mn[0].layer.type=="fill-extrusion"&&typeof mn[0].id<"u"){if(this.selectedObject&&this.unselectObject(),!this.selectedFeature)this.selectFeature(mn[0]);else if(this.selectedFeature.id!=mn[0].id)this.unselectFeature(this.selectedFeature),this.selectFeature(mn[0]);else if(this.selectedFeature.id==mn[0].id){this.unselectFeature(this.selectedFeature);return}}}},this.onMouseMove=function(pt){let ti=ge(pt);if(this.getCanvasContainer().style.cursor=this.tb.defaultCursor,pt.originalEvent.altKey&&this.draggedObject){if(!Dt.tb.enableRotatingObjects)return;Nn="rotate",this.getCanvasContainer().style.cursor="move",Math.min(oi.x,ti.x),Math.max(oi.x,ti.x),Math.min(oi.y,ti.y),Math.max(oi.y,ti.y);let fn={x:0,y:0,z:Math.round(ae[2]+~~((ti.x-oi.x)/this.tb.rotationStep)%360*this.tb.rotationStep%360)};this.draggedObject.setRotation(fn),Dt.tb.enableHelpTooltips&&this.draggedObject.addHelp("rot: "+fn.z+"&#176;");return}if(pt.originalEvent.shiftKey&&this.draggedObject){if(!Dt.tb.enableDraggingObjects)return;Nn="translate",this.getCanvasContainer().style.cursor="move";let fn=pt.lngLat,vr=[Number((fn.lng+Zt).toFixed(this.tb.gridStep)),Number((fn.lat+Yt).toFixed(this.tb.gridStep)),this.draggedObject.modelHeight];this.draggedObject.setCoords(vr),Dt.tb.enableHelpTooltips&&this.draggedObject.addHelp("lng: "+vr[0]+"&#176;, lat: "+vr[1]+"&#176;");return}if(pt.originalEvent.ctrlKey&&this.draggedObject){if(!Dt.tb.enableDraggingObjects)return;Nn="altitude",this.getCanvasContainer().style.cursor="move";let fn=pt.point.y*this.tb.altitudeStep,vr=[this.draggedObject.coordinates[0],this.draggedObject.coordinates[1],Number((-fn-vi).toFixed(this.tb.gridStep))];this.draggedObject.setCoords(vr),Dt.tb.enableHelpTooltips&&this.draggedObject.addHelp("alt: "+vr[2]+"m");return}let Wi,mn=[];if(Dt.tb.enableSelectingObjects&&(mn=this.tb.queryRenderedFeatures(pt.point)),Wi=typeof mn[0]=="object",Wi){let fn=ln.prototype.findParent3DObject(mn[0]);fn&&(this.outFeature(this.overedFeature),this.getCanvasContainer().style.cursor="pointer",!this.selectedObject||fn.uuid!=this.selectedObject.uuid?(this.overedObject&&this.overedObject.uuid!=fn.uuid&&this.outObject(),fn.over=!0,this.overedObject=fn):this.selectedObject&&fn.uuid==this.selectedObject.uuid&&(fn.over=!0,this.overedObject=fn),this.repaint=!0,pt.preventDefault())}else{this.overedObject&&this.outObject();let fn=[];Dt.tb.enableSelectingFeatures&&(fn=this.queryRenderedFeatures(pt.point)),fn.length>0&&(this.outFeature(fn[0]),fn[0].layer.type=="fill-extrusion"&&typeof fn[0].id<"u"&&(!this.selectedFeature||this.selectedFeature.id!=fn[0].id)&&(this.getCanvasContainer().style.cursor="pointer",this.overedFeature=fn[0],this.setFeatureState({source:this.overedFeature.source,sourceLayer:this.overedFeature.sourceLayer,id:this.overedFeature.id},{hover:!0}),this.overedFeature=Dt.queryRenderedFeatures({layers:[this.overedFeature.layer.id],filter:["==",["id"],this.overedFeature.id]})[0],this.addTooltip(this.overedFeature)))}},this.onMouseDown=function(pt){(pt.originalEvent.shiftKey||pt.originalEvent.altKey||pt.originalEvent.ctrlKey)&&pt.originalEvent.button===0&&this.selectedObject&&(!Dt.tb.enableDraggingObjects&&!Dt.tb.enableRotatingObjects||(pt.preventDefault(),Dt.getCanvasContainer().style.cursor="move",Dt.once("mouseup",this.onMouseUp),this.draggedObject=this.selectedObject,oi=ge(pt),Ci=this.draggedObject.coordinates,ae=St.degreeify(this.draggedObject.rotation),Zt=Ci[0]-pt.lngLat.lng,Yt=Ci[1]-pt.lngLat.lat,vi=-this.draggedObject.modelHeight-pt.point.y*this.tb.altitudeStep))},this.onMouseUp=function(pt){this.getCanvasContainer().style.cursor=this.tb.defaultCursor,this.off("mouseup",this.onMouseUp),this.off("mouseout",this.onMouseUp),this.dragPan.enable(),this.draggedObject&&(this.draggedObject.dispatchEvent({type:"ObjectDragged",detail:{draggedObject:this.draggedObject,draggedAction:Nn}}),this.draggedObject.removeHelp(),this.draggedObject=null,Nn=null)},this.onMouseOut=function(pt){if(this.overedFeature){let ti=this.queryRenderedFeatures(pt.point);ti.length>0&&this.overedFeature.id!=ti[0].id&&(this.getCanvasContainer().style.cursor=this.tb.defaultCursor,this.outFeature(ti[0]))}},this.onZoom=function(pt){this.tb.zoomLayers.forEach(ti=>{this.tb.toggleLayer(ti)}),this.tb.setObjectsScale()};let Te=!1,Re=17,ze=91,Ie=16,it=83;function vt(pt){pt.which===Re||pt.which,pt.which===Ie&&(Te=!0);let ti=this.selectedObject;if(Te&&pt.which===it&&ti){let Wi=St.toDecimal;if(ti.help)ti.removeHelp();else{let mn=ti.modelSize,fn=1;ti.userData.units!=="meters"&&(fn=St.projectedUnitsPerMeter(ti.coordinates[1]),fn||(fn=1),fn=Wi(fn,7)),Dt.tb.enableHelpTooltips&&ti.addHelp("size(m): "+Wi(mn.x/fn,3)+" W, "+Wi(mn.y/fn,3)+" L, "+Wi(mn.z/fn,3)+" H"),this.repaint=!0}return!1}}function bt(pt){pt.which==Re||pt.which==ze,pt.which===Ie&&(Te=!1)}this.on("click",this.onClick),this.on("mousemove",this.onMouseMove),this.on("mouseout",this.onMouseOut),this.on("mousedown",this.onMouseDown),this.on("zoom",this.onZoom),this.on("zoomend",this.onZoom),document.addEventListener("keydown",vt.bind(this),!0),document.addEventListener("keyup",bt.bind(this))})},get sky(){return this.options.sky},set sky(Dt){Dt?this.createSkyLayer():this.removeLayer(this.skyLayerName),this.options.sky=Dt},get terrain(){return this.options.terrain},set terrain(Dt){if(this.terrainLayerName="",Dt)this.createTerrainLayer();else{if(this.mapboxVersion<2){console.warn("Terrain layer are only supported by Mapbox-gl-js > v2.0");return}this.map.getTerrain()&&(this.map.setTerrain(null),this.map.removeSource(this.terrainSourceName))}this.options.terrain=Dt},get fov(){return this.options.fov},set fov(Dt){this.camera instanceof U.PerspectiveCamera&&this.options.fov!==Dt&&(this.map.transform.fov=Dt,this.camera.fov=this.map.transform.fov,this.cameraSync.setupCamera(),this.map.repaint=!0,this.options.fov=Dt)},get orthographic(){return this.options.orthographic},set orthographic(Dt){const ni=this.map.getCanvas().clientHeight,ci=this.map.getCanvas().clientWidth;Dt?(this.map.transform.fov=0,this.camera=new U.OrthographicCamera(ci/-2,ci/2,ni/2,ni/-2,.1,1e21)):(this.map.transform.fov=this.fov,this.camera=new U.PerspectiveCamera(this.map.transform.fov,ci/ni,.1,1e21)),this.camera.layers.enable(0),this.camera.layers.enable(1),this.cameraSync=new Ze(this.map,this.camera,this.world),this.map.repaint=!0,this.options.orthographic=Dt},createSkyLayer:function(){if(this.mapboxVersion<2){console.warn("Sky layer are only supported by Mapbox-gl-js > v2.0"),this.options.sky=!1;return}this.map.getLayer(this.skyLayerName)||(this.map.addLayer({id:this.skyLayerName,type:"sky",paint:{"sky-opacity":["interpolate",["linear"],["zoom"],0,0,5,.3,8,1],"sky-type":"atmosphere","sky-atmosphere-sun":this.getSunSky(this.lightDateTime),"sky-atmosphere-sun-intensity":10}}),this.map.once("idle",()=>{this.setSunlight(),this.repaint()}))},createTerrainLayer:function(){if(this.mapboxVersion<2){console.warn("Terrain layer are only supported by Mapbox-gl-js > v2.0"),this.options.terrain=!1;return}this.map.getTerrain()||(this.map.addSource(this.terrainSourceName,{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),this.map.setTerrain({source:this.terrainSourceName,exaggeration:this.terrainExaggeration}),this.map.once("idle",()=>{this.cameraSync.updateCamera(),this.repaint()}))},sphere:function(Dt){return this.setDefaultView(Dt,this.options),de(Dt,this.world)},line:qt,label:rt,tooltip:ai,tube:function(Dt){return this.setDefaultView(Dt,this.options),xi(Dt,this.world)},extrusion:function(Dt){return this.setDefaultView(Dt,this.options),Je(Dt)},Object3D:function(Dt){return this.setDefaultView(Dt,this.options),Ai(Dt)},loadObj:async function(ni,ci){if(this.setDefaultView(ni,this.options),ni.clone===!1)return new Promise(async Nn=>{bi(ni,ci,async Fi=>{Nn(Fi)})});{let Nn=this.objectsCache.get(ni.obj);Nn?Nn.promise.then(Fi=>{ci(Fi.duplicate(ni))}).catch(Fi=>{this.objectsCache.delete(ni.obj),console.error("Could not load model file: "+ni.obj)}):this.objectsCache.set(ni.obj,{promise:new Promise(async(Fi,oi)=>{bi(ni,ci,async Ci=>{Ci.duplicate?Fi(Ci.duplicate()):oi(Ci)})})})}},material:function(Dt){return Ge(Dt)},initLights:{ambientLight:null,dirLight:null,dirLightBack:null,dirLightHelper:null,hemiLight:null,pointLight:null},utils:St,SunCalc:ei,Constants:Le,projectToWorld:function(Dt){return this.utils.projectToWorld(Dt)},unprojectFromWorld:function(Dt){return this.utils.unprojectFromWorld(Dt)},projectedUnitsPerMeter:function(Dt){return this.utils.projectedUnitsPerMeter(Dt)},getFeatureCenter:function(ni,ci,Nn){return St.getFeatureCenter(ni,ci,Nn)},getObjectHeightOnFloor:function(Dt,ni,ci){return St.getObjectHeightOnFloor(Dt,ni,ci)},queryRenderedFeatures:function(Dt){let ni=new U.Vector2;return ni.x=Dt.x/this.map.transform.width*2-1,ni.y=1-Dt.y/this.map.transform.height*2,this.raycaster.setFromCamera(ni,this.camera),this.raycaster.intersectObjects(this.world.children,!0)},findParent3DObject:function(Dt){var ni;return Dt.object.traverseAncestors(function(ci){ci.parent&&ci.parent.type=="Group"&&ci.userData.obj&&(ni=ci)}),ni},setLayoutProperty:function(Dt,ni,ci){this.map.setLayoutProperty(Dt,ni,ci),ci!=null&&ni==="visibility"&&this.world.children.filter(Nn=>Nn.layer===Dt).forEach(Nn=>{Nn.visibility=ci})},setLayerZoomRange:function(Dt,ni,ci){this.map.getLayer(Dt)&&(this.map.setLayerZoomRange(Dt,ni,ci),this.zoomLayers.includes(Dt)||this.zoomLayers.push(Dt),this.toggleLayer(Dt))},setLayerHeigthProperty:function(Dt,ni){let ci=this.map.getLayer(Dt);if(ci)if(ci.type=="fill-extrusion"){let Nn=this.map.getStyle().sources[ci.source].data;Nn.features.forEach(function(oi){oi.properties.level=ni}),this.map.getSource(ci.source).setData(Nn)}else ci.type=="custom"&&this.world.children.forEach(function(Nn){let Fi=Nn.userData.feature;if(Fi&&Fi.layer===Dt){let oi=this.tb.getFeatureCenter(Fi,Nn,ni);Nn.setCoords(oi)}})},setObjectsScale:function(){this.world.children.filter(Dt=>Dt.fixedZoom!=null).forEach(Dt=>{Dt.setObjectScale(this.map.transform.scale)})},setStyle:function(Dt,ni){this.clear().then(()=>{this.map.setStyle(Dt,ni)})},toggleLayer:function(Dt,ni=!0){let ci=this.map.getLayer(Dt);if(ci){if(!ni){this.toggle(ci.id,!1);return}let Nn=this.map.getZoom();if(ci.minzoom&&Nn<ci.minzoom){this.toggle(ci.id,!1);return}if(ci.maxzoom&&Nn>=ci.maxzoom){this.toggle(ci.id,!1);return}this.toggle(ci.id,!0)}},toggle:function(Dt,ni){this.setLayoutProperty(Dt,"visibility",ni?"visible":"none"),this.labelRenderer.toggleLabels(Dt,ni)},update:function(){this.map.repaint&&(this.map.repaint=!1);var Dt=Date.now();this.objects.animationManager.update(Dt),this.updateLightHelper(),this.renderer.resetState(),this.renderer.render(this.scene,this.camera),this.labelRenderer.render(this.scene,this.camera),this.options.passiveRendering===!1&&this.map.triggerRepaint()},add:function(Dt,ni,ci){if(!this.enableTooltips&&Dt.tooltip&&(Dt.tooltip.visibility=!1),this.world.add(Dt),ni){Dt.layer=ni,Dt.source=ci;let Nn=this.map.getLayer(ni);if(Nn){let Fi=Nn.visibility,oi=typeof Fi>"u";Dt.visibility=!!(oi||Fi==="visible")}}},removeByName:function(Dt){let ni=this.world.getObjectByName(Dt);ni&&this.remove(ni)},remove:function(Dt){this.map.selectedObject&&Dt.uuid==this.map.selectedObject.uuid&&this.map.unselectObject(),this.map.draggedObject&&Dt.uuid==this.map.draggedObject.uuid&&(this.map.draggedObject=null),Dt.dispose&&Dt.dispose(),this.world.remove(Dt),Dt=null},clear:async function(Dt=null,ni=!1){return new Promise((ci,Nn)=>{let Fi=[];this.world.children.forEach(function(oi){Fi.push(oi)});for(let oi=0;oi<Fi.length;oi++){let Ci=Fi[oi];(Ci.layer===Dt||!Dt)&&this.remove(Ci)}ni&&this.objectsCache.forEach(oi=>{oi.promise.then(Ci=>{Ci.dispose(),Ci=null})}),ci("clear")})},removeLayer:function(Dt){this.clear(Dt,!0).then(()=>{this.map.removeLayer(Dt)})},getSunPosition:function(Dt,ni){return ei.getPosition(Dt||Date.now(),ni[1],ni[0])},getSunTimes:function(Dt,ni){return ei.getTimes(Dt,ni[1],ni[0],ni[2]?ni[2]:0)},setBuildingShadows:function(Dt){if(this.map.getLayer(Dt.buildingsLayerId)){let ni=new Tt(Dt,this);this.map.addLayer(ni,Dt.buildingsLayerId)}else console.warn("The layer '"+Dt.buildingsLayerId+"' does not exist in the map.")},setSunlight:function(Dt=new Date,ni){if(!this.lights.dirLight||!this.options.realSunlight){console.warn("To use setSunlight it's required to set realSunlight : true in Threebox initial options.");return}var ci=new Date(Dt.getTime());if(ni?ni.lng&&ni.lat?this.mapCenter=ni:this.mapCenter={lng:ni[0],lat:ni[1]}:this.mapCenter=this.map.getCenter(),this.lightDateTime&&this.lightDateTime.getTime()===ci.getTime()&&this.lightLng===this.mapCenter.lng&&this.lightLat===this.mapCenter.lat)return;this.lightDateTime=ci,this.lightLng=this.mapCenter.lng,this.lightLat=this.mapCenter.lat,this.sunPosition=this.getSunPosition(ci,[this.mapCenter.lng,this.mapCenter.lat]);let Nn=this.sunPosition.altitude,Fi=Math.PI+this.sunPosition.azimuth,oi=Le.WORLD_SIZE/2,Ci=Math.sin(Nn),Zt=Math.cos(Nn),Yt=Math.cos(Fi)*Zt,vi=Math.sin(Fi)*Zt;this.lights.dirLight.position.set(vi,Yt,Ci),this.lights.dirLight.position.multiplyScalar(oi),this.lights.dirLight.intensity=Math.max(Ci,0),this.lights.hemiLight.intensity=Math.max(Ci*1,.1),this.lights.dirLight.updateMatrixWorld(),this.updateLightHelper(),this.map.loaded()&&(this.updateSunGround(this.sunPosition),this.map.setLight({anchor:"map",position:[3,180+this.sunPosition.azimuth*180/Math.PI,90-this.sunPosition.altitude*180/Math.PI],intensity:Math.cos(this.sunPosition.altitude),color:`hsl(40, ${50*Math.cos(this.sunPosition.altitude)}%, ${Math.max(20,20+96*Math.sin(this.sunPosition.altitude))}%)`},{duration:0}),this.sky&&this.updateSunSky(this.getSunSky(ci,this.sunPosition)))},getSunSky:function(Dt,ni){if(!ni){var ci=this.map.getCenter();ni=this.getSunPosition(Dt||Date.now(),[ci.lng,ci.lat])}var Nn=180+ni.azimuth*180/Math.PI,Fi=90-ni.altitude*180/Math.PI;return[Nn,Fi]},updateSunSky:function(Dt){this.sky&&this.map.setPaintProperty(this.skyLayerName,"sky-atmosphere-sun",Dt)},updateSunGround:function(Dt){this.terrainLayerName!=""&&this.map.setPaintProperty(this.terrainLayerName,"raster-opacity",Math.max(Math.min(1,Dt.altitude*4),.25))},updateLightHelper:function(){this.lights.dirLightHelper&&(this.lights.dirLightHelper.position.setFromMatrixPosition(this.lights.dirLight.matrixWorld),this.lights.dirLightHelper.updateMatrix(),this.lights.dirLightHelper.update())},dispose:async function(){return console.log(this.memory()),new Promise(Dt=>{Dt(this.clear(null,!0).then(ni=>(this.map.remove(),this.map={},this.scene.remove(this.world),this.world.children=[],this.world=null,this.objectsCache.clear(),this.labelRenderer.dispose(),console.log(this.memory()),this.renderer.dispose(),ni)))})},defaultLights:function(){this.lights.ambientLight=new U.AmbientLight(new U.Color("hsl(0, 0%, 100%)"),.75),this.scene.add(this.lights.ambientLight),this.lights.dirLightBack=new U.DirectionalLight(new U.Color("hsl(0, 0%, 100%)"),.25),this.lights.dirLightBack.position.set(30,100,100),this.scene.add(this.lights.dirLightBack),this.lights.dirLight=new U.DirectionalLight(new U.Color("hsl(0, 0%, 100%)"),.25),this.lights.dirLight.position.set(-30,100,-100),this.scene.add(this.lights.dirLight)},realSunlight:function(Dt=!1){this.renderer.shadowMap.enabled=!0,this.lights.dirLight=new U.DirectionalLight(16777215,1),this.scene.add(this.lights.dirLight),Dt&&(this.lights.dirLightHelper=new U.DirectionalLightHelper(this.lights.dirLight,5),this.scene.add(this.lights.dirLightHelper));let ni=1e3,ci=2,Nn=8192;this.lights.dirLight.castShadow=!0,this.lights.dirLight.shadow.radius=ci,this.lights.dirLight.shadow.mapSize.width=Nn,this.lights.dirLight.shadow.mapSize.height=Nn,this.lights.dirLight.shadow.camera.top=this.lights.dirLight.shadow.camera.right=ni,this.lights.dirLight.shadow.camera.bottom=this.lights.dirLight.shadow.camera.left=-1e3,this.lights.dirLight.shadow.camera.near=1,this.lights.dirLight.shadow.camera.visible=!0,this.lights.dirLight.shadow.camera.far=4e8,this.lights.hemiLight=new U.HemisphereLight(new U.Color(16777215),new U.Color(16777215),.6),this.lights.hemiLight.color.setHSL(.661,.96,.12),this.lights.hemiLight.groundColor.setHSL(.11,.96,.14),this.lights.hemiLight.position.set(0,0,50),this.scene.add(this.lights.hemiLight),this.setSunlight(),this.map.once("idle",()=>{this.setSunlight(),this.repaint()})},setDefaultView:function(Dt,ni){Dt.bbox=(Dt.bbox||Dt.bbox==null)&&ni.enableSelectingObjects,Dt.tooltip=(Dt.tooltip||Dt.tooltip==null)&&ni.enableTooltips,Dt.mapScale=this.map.transform.scale},memory:function(){return this.renderer.info.memory},programs:function(){return this.renderer.info.programs.length},version:"2.2.7"};var Xi={defaultLights:!1,realSunlight:!1,realSunlightHelper:!1,passiveRendering:!0,preserveDrawingBuffer:!1,enableSelectingFeatures:!1,enableSelectingObjects:!1,enableDraggingObjects:!1,enableRotatingObjects:!1,enableTooltips:!1,enableHelpTooltips:!1,multiLayer:!1,orthographic:!1,fov:Le.FOV_DEGREES,sky:!1,terrain:!1};En.exports=ln}(iy)),iy.exports}var dx;function Fb(){return dx||(dx=1,function(En,na){En.exports={Threebox:Bb(),THREE:Oc()}}(ty)),ty.exports}var kb=Fb(),Ay={exports:{}},fx;function Nb(){return fx||(fx=1,function(En){function na(de){if(de=Object.assign({},de),!(this instanceof na))throw new Error("MapboxLanguage needs to be called with the new keyword");this.setLanguage=this.setLanguage.bind(this),this._initialStyleUpdate=this._initialStyleUpdate.bind(this),this._defaultLanguage=de.defaultLanguage,this._isLanguageField=de.languageField||/^name_/,this._getLanguageField=de.getLanguageField||function(rt){return rt==="mul"?"name":`name_${rt}`},this._languageSource=de.languageSource||null,this._languageTransform=de.languageTransform,this._excludedLayerIds=de.excludedLayerIds||[],this.supportedLanguages=de.supportedLanguages||["ar","de","en","es","fr","it","ja","ko","mul","pt","ru","vi","zh-Hans","zh-Hant"]}const U=/^\{name/;function Ze(de,Je){const rt=Array.isArray(Je)&&Je[0]==="get";return rt&&U.test(Je[1])&&console.warn("This plugin no longer supports the use of token syntax (e.g. {name}). Please use a get expression. See https://docs.mapbox.com/mapbox-gl-js/style-spec/expressions/ for more details."),rt&&de.test(Je[1])}function St(de,Je,rt){if(Array.isArray(Je))for(let ai=1;ai<Je.length;ai++)Array.isArray(Je[ai])&&(Ze(de,Je[ai])&&(Je[ai][1]=rt),St(de,Je[ai],rt))}function ei(de,Je,rt){if(Ze(de,Je)&&(Je[1]=rt),St(de,Je,rt),Je[0]==="get"&&Je[1]==="name"){const ai=Je.slice();Je=["coalesce",["get",rt],ai]}return Je}function Le(de,Je,rt,ai){return Je.layout&&Je.layout["text-field"]&&ai.indexOf(Je.id)===-1?Object.assign({},Je,{layout:Object.assign({},Je.layout,{"text-field":ei(de,Je.layout["text-field"],rt)})}):Je}function r(de){const Je=Object.keys(de.sources).filter(rt=>{const ai=de.sources[rt].url;return ai&&ai.indexOf("mapbox.mapbox-streets-v8")>-1||/mapbox-streets-v[1-9][1-9]/.test(ai)});if(!Je.length)throw new Error('If using MapboxLanguage with a Mapbox style, the style must be based on vector tile version 8, e.g. "streets-v11"');return Je[0]}na.prototype.setLanguage=function(de,Je){if(this.supportedLanguages.indexOf(Je)<0)throw new Error(`Language ${Je} is not supported`);const rt=this._languageSource||r(de);if(!rt)return de;const ai=this._getLanguageField(Je),bi=this._isLanguageField,Ai=this._excludedLayerIds,qt=de.layers.map(kt=>kt.source===rt?Le(bi,kt,ai,Ai):kt),xi=Object.assign({},de,{layers:qt});return this._languageTransform?this._languageTransform(xi,Je):xi},na.prototype._initialStyleUpdate=function(){const de=this._map.getStyle(),Je=this._defaultLanguage||Ge(this.supportedLanguages);this._map.setStyle(this.setLanguage(de,Je))};function Ge(de){const Je=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage,rt=Je&&Je.split("-");let ai=Je;return rt.length>1&&(ai=rt[0]),de.indexOf(ai)>-1?ai:null}na.prototype.onAdd=function(de){return this._map=de,this._map.on("style.load",this._initialStyleUpdate),this._container=document.createElement("div"),this._container},na.prototype.onRemove=function(){this._map.off("style.load",this._initialStyleUpdate),this._map=void 0},En.exports=na}(Ay)),Ay.exports}var Ub=Nb();const Vb=px(Ub);_x.accessToken="pk.eyJ1IjoiYWRyYWJsZXp6eiIsImEiOiJjbTg3bmc0cnQwaDk3MnFwc2M4YmhodndoIn0.jCgi76WKYLwbMxEv_siuWA";function Gb(){const na=[106.514698,29.520672],U={x:90,y:32,z:0};return mx.useEffect(()=>{const Ze=new _x.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[106.515298,29.513572],zoom:15.5,minZoom:15.5,maxZoom:20,pitch:40,bearing:53});Ze.addControl(new Vb({defaultLanguage:"zh-Hans"}));const St=window.tb=new kb.Threebox(Ze,Ze.getCanvas().getContext("webgl"),{defaultLights:!0});return Ze.on("load",()=>{Ze.addLayer({id:"custom-threebox-model",type:"custom",renderingMode:"3d",onAdd:function(){const Le={obj:"https://tbai.oss-cn-chengdu.aliyuncs.com/mzc/mzc.glb",type:"glb",scale:{x:.65,y:.65,z:.65},units:"meters",rotation:U};St.loadObj(Le,r=>{r.setCoords(na),r.setRotation({x:0,y:0,z:241}),St.add(r)})},render:function(){St.update()}})}),()=>Ze.remove()},[]),xg.jsx(xg.Fragment,{children:xg.jsx("div",{id:"map",style:{width:"100%",height:"100vh"}})})}fb.createRoot(document.getElementById("root")).render(xg.jsx(mx.StrictMode,{children:xg.jsx(Gb,{})}));
